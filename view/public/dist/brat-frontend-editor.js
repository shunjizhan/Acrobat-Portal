console.log(11111);

(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()({1:[function(require,module,exports){
module.exports = "<div id=\"brat-frontend-editor\">\n    <div id=\"commentpopup\"></div>\n    <div id=\"svg\"></div>\n\n    <!-- Span dialog (view+edit) -->\n    <form id=\"span_form\" class=\"dialog\" title=\"Span\">\n        <!-- Span dialog annotated text -->\n        <fieldset id=\"span_selected_fset\">\n            <legend>Text</legend>\n            <a target=\"brat_linked\" id=\"span_highlight_link\" href=\"#\">Link</a>\n            <div id=\"span_selected\"/>\n        </fieldset>\n        <!-- Span dialog search links -->\n        <fieldset id=\"span_search_fieldset\">\n            <legend>Search</legend>\n            <div id=\"span_search_links\"/>\n        </fieldset>\n        <!-- Span dialog type selector -->\n        <fieldset>\n            <div id=\"entity_and_event_wrapper\" class=\"split_wrapper\">\n                <div id=\"span_entity_section\" class=\"wrapper_half_left\">\n                    <div id=\"entity_label\" class=\"label-like\">\n                        Entity type\n                    </div>\n                    <div id=\"entity_types\" class=\"scroll_wrapper_upper\">\n                        <div class=\"scroller\"></div>\n                    </div>\n                    <!-- NOTE: the attribute labels must be *outside* of the\n                         divs they logically belong to prevent scrollers\n                         overflowing them. -->\n                    <div id=\"entity_attribute_label\" class=\"label-like wrapper_lower_label\">\n                        Entity attributes\n                    </div>\n                    <div id=\"entity_attributes\" class=\"scroll_wrapper_lower\">\n                        <div class=\"scroller small-buttons\"></div>\n                    </div>\n                </div>\n                <div id=\"span_event_section\" class=\"wrapper_half_right\">\n                    <div id=\"event_label\" class=\"label-like\">\n                        Event type\n                    </div>\n                    <div id=\"event_types\" class=\"scroll_wrapper_upper\">\n                        <div class=\"scroller\"></div>\n                    </div>\n                    <div id=\"event_attribute_label\" class=\"wrapper_lower_label label-like\">\n                        Event attributes\n                    </div>\n                    <div id=\"event_attributes\" class=\"scroll_wrapper_lower\">\n                        <div class=\"scroller small-buttons\"></div>\n                    </div>\n                </div>\n            </div>\n        </fieldset>\n        <!-- Span dialog normalization -->\n        <fieldset id=\"norm_fieldset\">\n            <legend>Normalization</legend>\n            <div id=\"norm_container\">\n                <select id=\"span_norm_db\"/>\n                <a id=\"span_norm_db_link\" target=\"brat_linked\" href=\"#\" title=\"Search DB\"><img class=\"brat-fugue-shadowless-magnifier\" src=\"static/img/Fugue-shadowless-magnifier.png\" style=\"vertical-align: middle\"/></a>\n                <span class=\"span_norm_label\">ID:</span>\n                <input id=\"span_norm_id\" class=\"span_norm_id_input\"\n                       style=\"width:20%\"/>\n                <span class=\"span_norm_label\">Ref:</span>\n                <input id=\"span_norm_txt\" class=\"span_norm_txt_input\"\n                       readonly=\"readonly\" style=\"width:45%\"\n                       placeholder=\"Click here to search\"/>\n                <a id=\"span_norm_ref_link\" target=\"brat_linked\" href=\"#\" title=\"See in DB\"><img class=\"brat-fugue-shadowless-external\" src=\"static/img/Fugue-shadowless-external.png\" style=\"vertical-align: middle\"/></a>\n                <input id=\"clear_norm_button\" type=\"button\"\n                       value=\"&#x2715;\" title=\"Clear normalization\"/>\n            </div>\n        </fieldset>\n        <!-- Span dialog notes -->\n        <fieldset>\n            <legend>Notes</legend>\n            <div id=\"notes_container\">\n                <input id=\"span_notes\" class=\"borderless\"/>\n                <input id=\"clear_notes_button\" type=\"button\"\n                       value=\"&#x2715;\" title=\"Clear notes\"/>\n            </div>\n        </fieldset>\n    </form>\n\n    <!-- Rapid mode span dialog -->\n    <form id=\"rapid_span_form\" class=\"dialog\" title=\"Span type\">\n        <fieldset id=\"rapid_span_selected_fset\">\n            <legend>Text</legend>\n            <div id=\"rapid_span_selected\"/>\n        </fieldset>\n        <div id=\"rapid_span_types\" class=\"scroll_fset\" style=\"height:250px\">\n            <fieldset>\n                <legend>Select type</legend>\n                <div class=\"scroller\" id=\"rapid_span_types_div\">\n                    <!-- filled dynamically -->\n                </div>\n            </fieldset>\n        </div>\n    </form>\n\n    <!-- Arc dialog -->\n    <form id=\"arc_form\" class=\"dialog\" title=\"Arc\">\n        <fieldset id=\"arc_origin_fset\">\n            <legend>From</legend>\n            <a target=\"brat_linked\" id=\"arc_highlight_link\" href=\"#\">Link</a>\n            <div id=\"arc_origin\"/>\n        </fieldset>\n\n        <fieldset id=\"arc_target_fset\">\n            <legend>To</legend>\n            <div id=\"arc_target\"/>\n        </fieldset>\n\n        <div id=\"arc_roles\" class=\"scroll_fset\">\n            <fieldset>\n                <legend>Type</legend>\n                <div class=\"scroller\"/>\n            </fieldset>\n        </div>\n\n        <fieldset id=\"arc_notes_fieldset\">\n            <legend>Notes</legend>\n            <input id=\"arc_notes\" class=\"borderless\"/>\n        </fieldset>\n\n    </form>\n\n    <!-- Split span annotation dialog -->\n    <form id=\"split_form\" class=\"dialog\" title=\"Split the Span\">\n        <fieldset>\n            <legend>Split Roles</legend>\n            <div id=\"split_roles\" class=\"scroll_fset\"/>\n        </fieldset>\n    </form>\n\n    <!-- Spinner -->\n    <!--<div id=\"waiter\" class=\"dialog\" title=\"Please wait\">\n        <img class=\"brat-spinner\" src=\"static/img/spinner.gif\"/>\n    </div>-->\n</div>";

},{}],2:[function(require,module,exports){
/*!
 * jQuery UI 1.8.16
 *
 * Copyright 2011, AUTHORS.txt (http://jqueryui.com/about)
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * http://jquery.org/license
 *
 * http://docs.jquery.com/UI
 */
(function(c,j){function k(a,b){var d=a.nodeName.toLowerCase();if("area"===d){b=a.parentNode;d=b.name;if(!a.href||!d||b.nodeName.toLowerCase()!=="map")return false;a=c("img[usemap=#"+d+"]")[0];return!!a&&l(a)}return(/input|select|textarea|button|object/.test(d)?!a.disabled:"a"==d?a.href||b:b)&&l(a)}function l(a){return!c(a).parents().andSelf().filter(function(){return c.curCSS(this,"visibility")==="hidden"||c.expr.filters.hidden(this)}).length}c.ui=c.ui||{};if(!c.ui.version){c.extend(c.ui,{version:"1.8.16",
keyCode:{ALT:18,BACKSPACE:8,CAPS_LOCK:20,COMMA:188,COMMAND:91,COMMAND_LEFT:91,COMMAND_RIGHT:93,CONTROL:17,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,INSERT:45,LEFT:37,MENU:93,NUMPAD_ADD:107,NUMPAD_DECIMAL:110,NUMPAD_DIVIDE:111,NUMPAD_ENTER:108,NUMPAD_MULTIPLY:106,NUMPAD_SUBTRACT:109,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SHIFT:16,SPACE:32,TAB:9,UP:38,WINDOWS:91}});c.fn.extend({propAttr:c.fn.prop||c.fn.attr,_focus:c.fn.focus,focus:function(a,b){return typeof a==="number"?this.each(function(){var d=
this;setTimeout(function(){c(d).focus();b&&b.call(d)},a)}):this._focus.apply(this,arguments)},scrollParent:function(){var a;a=c.browser.msie&&/(static|relative)/.test(this.css("position"))||/absolute/.test(this.css("position"))?this.parents().filter(function(){return/(relative|absolute|fixed)/.test(c.curCSS(this,"position",1))&&/(auto|scroll)/.test(c.curCSS(this,"overflow",1)+c.curCSS(this,"overflow-y",1)+c.curCSS(this,"overflow-x",1))}).eq(0):this.parents().filter(function(){return/(auto|scroll)/.test(c.curCSS(this,
"overflow",1)+c.curCSS(this,"overflow-y",1)+c.curCSS(this,"overflow-x",1))}).eq(0);return/fixed/.test(this.css("position"))||!a.length?c(document):a},zIndex:function(a){if(a!==j)return this.css("zIndex",a);if(this.length){a=c(this[0]);for(var b;a.length&&a[0]!==document;){b=a.css("position");if(b==="absolute"||b==="relative"||b==="fixed"){b=parseInt(a.css("zIndex"),10);if(!isNaN(b)&&b!==0)return b}a=a.parent()}}return 0},disableSelection:function(){return this.bind((c.support.selectstart?"selectstart":
"mousedown")+".ui-disableSelection",function(a){a.preventDefault()})},enableSelection:function(){return this.unbind(".ui-disableSelection")}});c.each(["Width","Height"],function(a,b){function d(f,g,m,n){c.each(e,function(){g-=parseFloat(c.curCSS(f,"padding"+this,true))||0;if(m)g-=parseFloat(c.curCSS(f,"border"+this+"Width",true))||0;if(n)g-=parseFloat(c.curCSS(f,"margin"+this,true))||0});return g}var e=b==="Width"?["Left","Right"]:["Top","Bottom"],h=b.toLowerCase(),i={innerWidth:c.fn.innerWidth,innerHeight:c.fn.innerHeight,
outerWidth:c.fn.outerWidth,outerHeight:c.fn.outerHeight};c.fn["inner"+b]=function(f){if(f===j)return i["inner"+b].call(this);return this.each(function(){c(this).css(h,d(this,f)+"px")})};c.fn["outer"+b]=function(f,g){if(typeof f!=="number")return i["outer"+b].call(this,f);return this.each(function(){c(this).css(h,d(this,f,true,g)+"px")})}});c.extend(c.expr[":"],{data:function(a,b,d){return!!c.data(a,d[3])},focusable:function(a){return k(a,!isNaN(c.attr(a,"tabindex")))},tabbable:function(a){var b=c.attr(a,
"tabindex"),d=isNaN(b);return(d||b>=0)&&k(a,!d)}});c(function(){var a=document.body,b=a.appendChild(b=document.createElement("div"));c.extend(b.style,{minHeight:"100px",height:"auto",padding:0,borderWidth:0});c.support.minHeight=b.offsetHeight===100;c.support.selectstart="onselectstart"in b;a.removeChild(b).style.display="none"});c.extend(c.ui,{plugin:{add:function(a,b,d){a=c.ui[a].prototype;for(var e in d){a.plugins[e]=a.plugins[e]||[];a.plugins[e].push([b,d[e]])}},call:function(a,b,d){if((b=a.plugins[b])&&
a.element[0].parentNode)for(var e=0;e<b.length;e++)a.options[b[e][0]]&&b[e][1].apply(a.element,d)}},contains:function(a,b){return document.compareDocumentPosition?a.compareDocumentPosition(b)&16:a!==b&&a.contains(b)},hasScroll:function(a,b){if(c(a).css("overflow")==="hidden")return false;b=b&&b==="left"?"scrollLeft":"scrollTop";var d=false;if(a[b]>0)return true;a[b]=1;d=a[b]>0;a[b]=0;return d},isOverAxis:function(a,b,d){return a>b&&a<b+d},isOver:function(a,b,d,e,h,i){return c.ui.isOverAxis(a,d,h)&&
c.ui.isOverAxis(b,e,i)}})}})(jQuery);
;/*!
 * jQuery UI Widget 1.8.16
 *
 * Copyright 2011, AUTHORS.txt (http://jqueryui.com/about)
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * http://jquery.org/license
 *
 * http://docs.jquery.com/UI/Widget
 */
(function(b,j){if(b.cleanData){var k=b.cleanData;b.cleanData=function(a){for(var c=0,d;(d=a[c])!=null;c++)try{b(d).triggerHandler("remove")}catch(e){}k(a)}}else{var l=b.fn.remove;b.fn.remove=function(a,c){return this.each(function(){if(!c)if(!a||b.filter(a,[this]).length)b("*",this).add([this]).each(function(){try{b(this).triggerHandler("remove")}catch(d){}});return l.call(b(this),a,c)})}}b.widget=function(a,c,d){var e=a.split(".")[0],f;a=a.split(".")[1];f=e+"-"+a;if(!d){d=c;c=b.Widget}b.expr[":"][f]=
function(h){return!!b.data(h,a)};b[e]=b[e]||{};b[e][a]=function(h,g){arguments.length&&this._createWidget(h,g)};c=new c;c.options=b.extend(true,{},c.options);b[e][a].prototype=b.extend(true,c,{namespace:e,widgetName:a,widgetEventPrefix:b[e][a].prototype.widgetEventPrefix||a,widgetBaseClass:f},d);b.widget.bridge(a,b[e][a])};b.widget.bridge=function(a,c){b.fn[a]=function(d){var e=typeof d==="string",f=Array.prototype.slice.call(arguments,1),h=this;d=!e&&f.length?b.extend.apply(null,[true,d].concat(f)):
d;if(e&&d.charAt(0)==="_")return h;e?this.each(function(){var g=b.data(this,a),i=g&&b.isFunction(g[d])?g[d].apply(g,f):g;if(i!==g&&i!==j){h=i;return false}}):this.each(function(){var g=b.data(this,a);g?g.option(d||{})._init():b.data(this,a,new c(d,this))});return h}};b.Widget=function(a,c){arguments.length&&this._createWidget(a,c)};b.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",options:{disabled:false},_createWidget:function(a,c){b.data(c,this.widgetName,this);this.element=b(c);this.options=
b.extend(true,{},this.options,this._getCreateOptions(),a);var d=this;this.element.bind("remove."+this.widgetName,function(){d.destroy()});this._create();this._trigger("create");this._init()},_getCreateOptions:function(){return b.metadata&&b.metadata.get(this.element[0])[this.widgetName]},_create:function(){},_init:function(){},destroy:function(){this.element.unbind("."+this.widgetName).removeData(this.widgetName);this.widget().unbind("."+this.widgetName).removeAttr("aria-disabled").removeClass(this.widgetBaseClass+
"-disabled ui-state-disabled")},widget:function(){return this.element},option:function(a,c){var d=a;if(arguments.length===0)return b.extend({},this.options);if(typeof a==="string"){if(c===j)return this.options[a];d={};d[a]=c}this._setOptions(d);return this},_setOptions:function(a){var c=this;b.each(a,function(d,e){c._setOption(d,e)});return this},_setOption:function(a,c){this.options[a]=c;if(a==="disabled")this.widget()[c?"addClass":"removeClass"](this.widgetBaseClass+"-disabled ui-state-disabled").attr("aria-disabled",
c);return this},enable:function(){return this._setOption("disabled",false)},disable:function(){return this._setOption("disabled",true)},_trigger:function(a,c,d){var e=this.options[a];c=b.Event(c);c.type=(a===this.widgetEventPrefix?a:this.widgetEventPrefix+a).toLowerCase();d=d||{};if(c.originalEvent){a=b.event.props.length;for(var f;a;){f=b.event.props[--a];c[f]=c.originalEvent[f]}}this.element.trigger(c,d);return!(b.isFunction(e)&&e.call(this.element[0],c,d)===false||c.isDefaultPrevented())}}})(jQuery);
;/*!
 * jQuery UI Mouse 1.8.16
 *
 * Copyright 2011, AUTHORS.txt (http://jqueryui.com/about)
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * http://jquery.org/license
 *
 * http://docs.jquery.com/UI/Mouse
 *
 * Depends:
 *	jquery.ui.widget.js
 */
(function(b){var d=false;b(document).mouseup(function(){d=false});b.widget("ui.mouse",{options:{cancel:":input,option",distance:1,delay:0},_mouseInit:function(){var a=this;this.element.bind("mousedown."+this.widgetName,function(c){return a._mouseDown(c)}).bind("click."+this.widgetName,function(c){if(true===b.data(c.target,a.widgetName+".preventClickEvent")){b.removeData(c.target,a.widgetName+".preventClickEvent");c.stopImmediatePropagation();return false}});this.started=false},_mouseDestroy:function(){this.element.unbind("."+
this.widgetName)},_mouseDown:function(a){if(!d){this._mouseStarted&&this._mouseUp(a);this._mouseDownEvent=a;var c=this,f=a.which==1,g=typeof this.options.cancel=="string"&&a.target.nodeName?b(a.target).closest(this.options.cancel).length:false;if(!f||g||!this._mouseCapture(a))return true;this.mouseDelayMet=!this.options.delay;if(!this.mouseDelayMet)this._mouseDelayTimer=setTimeout(function(){c.mouseDelayMet=true},this.options.delay);if(this._mouseDistanceMet(a)&&this._mouseDelayMet(a)){this._mouseStarted=
this._mouseStart(a)!==false;if(!this._mouseStarted){a.preventDefault();return true}}true===b.data(a.target,this.widgetName+".preventClickEvent")&&b.removeData(a.target,this.widgetName+".preventClickEvent");this._mouseMoveDelegate=function(e){return c._mouseMove(e)};this._mouseUpDelegate=function(e){return c._mouseUp(e)};b(document).bind("mousemove."+this.widgetName,this._mouseMoveDelegate).bind("mouseup."+this.widgetName,this._mouseUpDelegate);a.preventDefault();return d=true}},_mouseMove:function(a){if(b.browser.msie&&
!(document.documentMode>=9)&&!a.button)return this._mouseUp(a);if(this._mouseStarted){this._mouseDrag(a);return a.preventDefault()}if(this._mouseDistanceMet(a)&&this._mouseDelayMet(a))(this._mouseStarted=this._mouseStart(this._mouseDownEvent,a)!==false)?this._mouseDrag(a):this._mouseUp(a);return!this._mouseStarted},_mouseUp:function(a){b(document).unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate);if(this._mouseStarted){this._mouseStarted=
false;a.target==this._mouseDownEvent.target&&b.data(a.target,this.widgetName+".preventClickEvent",true);this._mouseStop(a)}return false},_mouseDistanceMet:function(a){return Math.max(Math.abs(this._mouseDownEvent.pageX-a.pageX),Math.abs(this._mouseDownEvent.pageY-a.pageY))>=this.options.distance},_mouseDelayMet:function(){return this.mouseDelayMet},_mouseStart:function(){},_mouseDrag:function(){},_mouseStop:function(){},_mouseCapture:function(){return true}})})(jQuery);
;/*
 * jQuery UI Position 1.8.16
 *
 * Copyright 2011, AUTHORS.txt (http://jqueryui.com/about)
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * http://jquery.org/license
 *
 * http://docs.jquery.com/UI/Position
 */
(function(c){c.ui=c.ui||{};var n=/left|center|right/,o=/top|center|bottom/,t=c.fn.position,u=c.fn.offset;c.fn.position=function(b){if(!b||!b.of)return t.apply(this,arguments);b=c.extend({},b);var a=c(b.of),d=a[0],g=(b.collision||"flip").split(" "),e=b.offset?b.offset.split(" "):[0,0],h,k,j;if(d.nodeType===9){h=a.width();k=a.height();j={top:0,left:0}}else if(d.setTimeout){h=a.width();k=a.height();j={top:a.scrollTop(),left:a.scrollLeft()}}else if(d.preventDefault){b.at="left top";h=k=0;j={top:b.of.pageY,
left:b.of.pageX}}else{h=a.outerWidth();k=a.outerHeight();j=a.offset()}c.each(["my","at"],function(){var f=(b[this]||"").split(" ");if(f.length===1)f=n.test(f[0])?f.concat(["center"]):o.test(f[0])?["center"].concat(f):["center","center"];f[0]=n.test(f[0])?f[0]:"center";f[1]=o.test(f[1])?f[1]:"center";b[this]=f});if(g.length===1)g[1]=g[0];e[0]=parseInt(e[0],10)||0;if(e.length===1)e[1]=e[0];e[1]=parseInt(e[1],10)||0;if(b.at[0]==="right")j.left+=h;else if(b.at[0]==="center")j.left+=h/2;if(b.at[1]==="bottom")j.top+=
k;else if(b.at[1]==="center")j.top+=k/2;j.left+=e[0];j.top+=e[1];return this.each(function(){var f=c(this),l=f.outerWidth(),m=f.outerHeight(),p=parseInt(c.curCSS(this,"marginLeft",true))||0,q=parseInt(c.curCSS(this,"marginTop",true))||0,v=l+p+(parseInt(c.curCSS(this,"marginRight",true))||0),w=m+q+(parseInt(c.curCSS(this,"marginBottom",true))||0),i=c.extend({},j),r;if(b.my[0]==="right")i.left-=l;else if(b.my[0]==="center")i.left-=l/2;if(b.my[1]==="bottom")i.top-=m;else if(b.my[1]==="center")i.top-=
m/2;i.left=Math.round(i.left);i.top=Math.round(i.top);r={left:i.left-p,top:i.top-q};c.each(["left","top"],function(s,x){c.ui.position[g[s]]&&c.ui.position[g[s]][x](i,{targetWidth:h,targetHeight:k,elemWidth:l,elemHeight:m,collisionPosition:r,collisionWidth:v,collisionHeight:w,offset:e,my:b.my,at:b.at})});c.fn.bgiframe&&f.bgiframe();f.offset(c.extend(i,{using:b.using}))})};c.ui.position={fit:{left:function(b,a){var d=c(window);d=a.collisionPosition.left+a.collisionWidth-d.width()-d.scrollLeft();b.left=
d>0?b.left-d:Math.max(b.left-a.collisionPosition.left,b.left)},top:function(b,a){var d=c(window);d=a.collisionPosition.top+a.collisionHeight-d.height()-d.scrollTop();b.top=d>0?b.top-d:Math.max(b.top-a.collisionPosition.top,b.top)}},flip:{left:function(b,a){if(a.at[0]!=="center"){var d=c(window);d=a.collisionPosition.left+a.collisionWidth-d.width()-d.scrollLeft();var g=a.my[0]==="left"?-a.elemWidth:a.my[0]==="right"?a.elemWidth:0,e=a.at[0]==="left"?a.targetWidth:-a.targetWidth,h=-2*a.offset[0];b.left+=
a.collisionPosition.left<0?g+e+h:d>0?g+e+h:0}},top:function(b,a){if(a.at[1]!=="center"){var d=c(window);d=a.collisionPosition.top+a.collisionHeight-d.height()-d.scrollTop();var g=a.my[1]==="top"?-a.elemHeight:a.my[1]==="bottom"?a.elemHeight:0,e=a.at[1]==="top"?a.targetHeight:-a.targetHeight,h=-2*a.offset[1];b.top+=a.collisionPosition.top<0?g+e+h:d>0?g+e+h:0}}}};if(!c.offset.setOffset){c.offset.setOffset=function(b,a){if(/static/.test(c.curCSS(b,"position")))b.style.position="relative";var d=c(b),
g=d.offset(),e=parseInt(c.curCSS(b,"top",true),10)||0,h=parseInt(c.curCSS(b,"left",true),10)||0;g={top:a.top-g.top+e,left:a.left-g.left+h};"using"in a?a.using.call(b,g):d.css(g)};c.fn.offset=function(b){var a=this[0];if(!a||!a.ownerDocument)return null;if(b)return this.each(function(){c.offset.setOffset(this,b)});return u.call(this)}}})(jQuery);
;/*
 * jQuery UI Draggable 1.8.16
 *
 * Copyright 2011, AUTHORS.txt (http://jqueryui.com/about)
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * http://jquery.org/license
 *
 * http://docs.jquery.com/UI/Draggables
 *
 * Depends:
 *	jquery.ui.core.js
 *	jquery.ui.mouse.js
 *	jquery.ui.widget.js
 */
(function(d){d.widget("ui.draggable",d.ui.mouse,{widgetEventPrefix:"drag",options:{addClasses:true,appendTo:"parent",axis:false,connectToSortable:false,containment:false,cursor:"auto",cursorAt:false,grid:false,handle:false,helper:"original",iframeFix:false,opacity:false,refreshPositions:false,revert:false,revertDuration:500,scope:"default",scroll:true,scrollSensitivity:20,scrollSpeed:20,snap:false,snapMode:"both",snapTolerance:20,stack:false,zIndex:false},_create:function(){if(this.options.helper==
"original"&&!/^(?:r|a|f)/.test(this.element.css("position")))this.element[0].style.position="relative";this.options.addClasses&&this.element.addClass("ui-draggable");this.options.disabled&&this.element.addClass("ui-draggable-disabled");this._mouseInit()},destroy:function(){if(this.element.data("draggable")){this.element.removeData("draggable").unbind(".draggable").removeClass("ui-draggable ui-draggable-dragging ui-draggable-disabled");this._mouseDestroy();return this}},_mouseCapture:function(a){var b=
this.options;if(this.helper||b.disabled||d(a.target).is(".ui-resizable-handle"))return false;this.handle=this._getHandle(a);if(!this.handle)return false;if(b.iframeFix)d(b.iframeFix===true?"iframe":b.iframeFix).each(function(){d('<div class="ui-draggable-iframeFix" style="background: #fff;"></div>').css({width:this.offsetWidth+"px",height:this.offsetHeight+"px",position:"absolute",opacity:"0.001",zIndex:1E3}).css(d(this).offset()).appendTo("body")});return true},_mouseStart:function(a){var b=this.options;
this.helper=this._createHelper(a);this._cacheHelperProportions();if(d.ui.ddmanager)d.ui.ddmanager.current=this;this._cacheMargins();this.cssPosition=this.helper.css("position");this.scrollParent=this.helper.scrollParent();this.offset=this.positionAbs=this.element.offset();this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left};d.extend(this.offset,{click:{left:a.pageX-this.offset.left,top:a.pageY-this.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()});
this.originalPosition=this.position=this._generatePosition(a);this.originalPageX=a.pageX;this.originalPageY=a.pageY;b.cursorAt&&this._adjustOffsetFromHelper(b.cursorAt);b.containment&&this._setContainment();if(this._trigger("start",a)===false){this._clear();return false}this._cacheHelperProportions();d.ui.ddmanager&&!b.dropBehaviour&&d.ui.ddmanager.prepareOffsets(this,a);this.helper.addClass("ui-draggable-dragging");this._mouseDrag(a,true);d.ui.ddmanager&&d.ui.ddmanager.dragStart(this,a);return true},
_mouseDrag:function(a,b){this.position=this._generatePosition(a);this.positionAbs=this._convertPositionTo("absolute");if(!b){b=this._uiHash();if(this._trigger("drag",a,b)===false){this._mouseUp({});return false}this.position=b.position}if(!this.options.axis||this.options.axis!="y")this.helper[0].style.left=this.position.left+"px";if(!this.options.axis||this.options.axis!="x")this.helper[0].style.top=this.position.top+"px";d.ui.ddmanager&&d.ui.ddmanager.drag(this,a);return false},_mouseStop:function(a){var b=
false;if(d.ui.ddmanager&&!this.options.dropBehaviour)b=d.ui.ddmanager.drop(this,a);if(this.dropped){b=this.dropped;this.dropped=false}if((!this.element[0]||!this.element[0].parentNode)&&this.options.helper=="original")return false;if(this.options.revert=="invalid"&&!b||this.options.revert=="valid"&&b||this.options.revert===true||d.isFunction(this.options.revert)&&this.options.revert.call(this.element,b)){var c=this;d(this.helper).animate(this.originalPosition,parseInt(this.options.revertDuration,
10),function(){c._trigger("stop",a)!==false&&c._clear()})}else this._trigger("stop",a)!==false&&this._clear();return false},_mouseUp:function(a){this.options.iframeFix===true&&d("div.ui-draggable-iframeFix").each(function(){this.parentNode.removeChild(this)});d.ui.ddmanager&&d.ui.ddmanager.dragStop(this,a);return d.ui.mouse.prototype._mouseUp.call(this,a)},cancel:function(){this.helper.is(".ui-draggable-dragging")?this._mouseUp({}):this._clear();return this},_getHandle:function(a){var b=!this.options.handle||
!d(this.options.handle,this.element).length?true:false;d(this.options.handle,this.element).find("*").andSelf().each(function(){if(this==a.target)b=true});return b},_createHelper:function(a){var b=this.options;a=d.isFunction(b.helper)?d(b.helper.apply(this.element[0],[a])):b.helper=="clone"?this.element.clone().removeAttr("id"):this.element;a.parents("body").length||a.appendTo(b.appendTo=="parent"?this.element[0].parentNode:b.appendTo);a[0]!=this.element[0]&&!/(fixed|absolute)/.test(a.css("position"))&&
a.css("position","absolute");return a},_adjustOffsetFromHelper:function(a){if(typeof a=="string")a=a.split(" ");if(d.isArray(a))a={left:+a[0],top:+a[1]||0};if("left"in a)this.offset.click.left=a.left+this.margins.left;if("right"in a)this.offset.click.left=this.helperProportions.width-a.right+this.margins.left;if("top"in a)this.offset.click.top=a.top+this.margins.top;if("bottom"in a)this.offset.click.top=this.helperProportions.height-a.bottom+this.margins.top},_getParentOffset:function(){this.offsetParent=
this.helper.offsetParent();var a=this.offsetParent.offset();if(this.cssPosition=="absolute"&&this.scrollParent[0]!=document&&d.ui.contains(this.scrollParent[0],this.offsetParent[0])){a.left+=this.scrollParent.scrollLeft();a.top+=this.scrollParent.scrollTop()}if(this.offsetParent[0]==document.body||this.offsetParent[0].tagName&&this.offsetParent[0].tagName.toLowerCase()=="html"&&d.browser.msie)a={top:0,left:0};return{top:a.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:a.left+(parseInt(this.offsetParent.css("borderLeftWidth"),
10)||0)}},_getRelativeOffset:function(){if(this.cssPosition=="relative"){var a=this.element.position();return{top:a.top-(parseInt(this.helper.css("top"),10)||0)+this.scrollParent.scrollTop(),left:a.left-(parseInt(this.helper.css("left"),10)||0)+this.scrollParent.scrollLeft()}}else return{top:0,left:0}},_cacheMargins:function(){this.margins={left:parseInt(this.element.css("marginLeft"),10)||0,top:parseInt(this.element.css("marginTop"),10)||0,right:parseInt(this.element.css("marginRight"),10)||0,bottom:parseInt(this.element.css("marginBottom"),
10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var a=this.options;if(a.containment=="parent")a.containment=this.helper[0].parentNode;if(a.containment=="document"||a.containment=="window")this.containment=[a.containment=="document"?0:d(window).scrollLeft()-this.offset.relative.left-this.offset.parent.left,a.containment=="document"?0:d(window).scrollTop()-this.offset.relative.top-this.offset.parent.top,
(a.containment=="document"?0:d(window).scrollLeft())+d(a.containment=="document"?document:window).width()-this.helperProportions.width-this.margins.left,(a.containment=="document"?0:d(window).scrollTop())+(d(a.containment=="document"?document:window).height()||document.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top];if(!/^(document|window|parent)$/.test(a.containment)&&a.containment.constructor!=Array){a=d(a.containment);var b=a[0];if(b){a.offset();var c=d(b).css("overflow")!=
"hidden";this.containment=[(parseInt(d(b).css("borderLeftWidth"),10)||0)+(parseInt(d(b).css("paddingLeft"),10)||0),(parseInt(d(b).css("borderTopWidth"),10)||0)+(parseInt(d(b).css("paddingTop"),10)||0),(c?Math.max(b.scrollWidth,b.offsetWidth):b.offsetWidth)-(parseInt(d(b).css("borderLeftWidth"),10)||0)-(parseInt(d(b).css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left-this.margins.right,(c?Math.max(b.scrollHeight,b.offsetHeight):b.offsetHeight)-(parseInt(d(b).css("borderTopWidth"),
10)||0)-(parseInt(d(b).css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top-this.margins.bottom];this.relative_container=a}}else if(a.containment.constructor==Array)this.containment=a.containment},_convertPositionTo:function(a,b){if(!b)b=this.position;a=a=="absolute"?1:-1;var c=this.cssPosition=="absolute"&&!(this.scrollParent[0]!=document&&d.ui.contains(this.scrollParent[0],this.offsetParent[0]))?this.offsetParent:this.scrollParent,f=/(html|body)/i.test(c[0].tagName);return{top:b.top+
this.offset.relative.top*a+this.offset.parent.top*a-(d.browser.safari&&d.browser.version<526&&this.cssPosition=="fixed"?0:(this.cssPosition=="fixed"?-this.scrollParent.scrollTop():f?0:c.scrollTop())*a),left:b.left+this.offset.relative.left*a+this.offset.parent.left*a-(d.browser.safari&&d.browser.version<526&&this.cssPosition=="fixed"?0:(this.cssPosition=="fixed"?-this.scrollParent.scrollLeft():f?0:c.scrollLeft())*a)}},_generatePosition:function(a){var b=this.options,c=this.cssPosition=="absolute"&&
!(this.scrollParent[0]!=document&&d.ui.contains(this.scrollParent[0],this.offsetParent[0]))?this.offsetParent:this.scrollParent,f=/(html|body)/i.test(c[0].tagName),e=a.pageX,h=a.pageY;if(this.originalPosition){var g;if(this.containment){if(this.relative_container){g=this.relative_container.offset();g=[this.containment[0]+g.left,this.containment[1]+g.top,this.containment[2]+g.left,this.containment[3]+g.top]}else g=this.containment;if(a.pageX-this.offset.click.left<g[0])e=g[0]+this.offset.click.left;
if(a.pageY-this.offset.click.top<g[1])h=g[1]+this.offset.click.top;if(a.pageX-this.offset.click.left>g[2])e=g[2]+this.offset.click.left;if(a.pageY-this.offset.click.top>g[3])h=g[3]+this.offset.click.top}if(b.grid){h=b.grid[1]?this.originalPageY+Math.round((h-this.originalPageY)/b.grid[1])*b.grid[1]:this.originalPageY;h=g?!(h-this.offset.click.top<g[1]||h-this.offset.click.top>g[3])?h:!(h-this.offset.click.top<g[1])?h-b.grid[1]:h+b.grid[1]:h;e=b.grid[0]?this.originalPageX+Math.round((e-this.originalPageX)/
b.grid[0])*b.grid[0]:this.originalPageX;e=g?!(e-this.offset.click.left<g[0]||e-this.offset.click.left>g[2])?e:!(e-this.offset.click.left<g[0])?e-b.grid[0]:e+b.grid[0]:e}}return{top:h-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+(d.browser.safari&&d.browser.version<526&&this.cssPosition=="fixed"?0:this.cssPosition=="fixed"?-this.scrollParent.scrollTop():f?0:c.scrollTop()),left:e-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+(d.browser.safari&&d.browser.version<
526&&this.cssPosition=="fixed"?0:this.cssPosition=="fixed"?-this.scrollParent.scrollLeft():f?0:c.scrollLeft())}},_clear:function(){this.helper.removeClass("ui-draggable-dragging");this.helper[0]!=this.element[0]&&!this.cancelHelperRemoval&&this.helper.remove();this.helper=null;this.cancelHelperRemoval=false},_trigger:function(a,b,c){c=c||this._uiHash();d.ui.plugin.call(this,a,[b,c]);if(a=="drag")this.positionAbs=this._convertPositionTo("absolute");return d.Widget.prototype._trigger.call(this,a,b,
c)},plugins:{},_uiHash:function(){return{helper:this.helper,position:this.position,originalPosition:this.originalPosition,offset:this.positionAbs}}});d.extend(d.ui.draggable,{version:"1.8.16"});d.ui.plugin.add("draggable","connectToSortable",{start:function(a,b){var c=d(this).data("draggable"),f=c.options,e=d.extend({},b,{item:c.element});c.sortables=[];d(f.connectToSortable).each(function(){var h=d.data(this,"sortable");if(h&&!h.options.disabled){c.sortables.push({instance:h,shouldRevert:h.options.revert});
h.refreshPositions();h._trigger("activate",a,e)}})},stop:function(a,b){var c=d(this).data("draggable"),f=d.extend({},b,{item:c.element});d.each(c.sortables,function(){if(this.instance.isOver){this.instance.isOver=0;c.cancelHelperRemoval=true;this.instance.cancelHelperRemoval=false;if(this.shouldRevert)this.instance.options.revert=true;this.instance._mouseStop(a);this.instance.options.helper=this.instance.options._helper;c.options.helper=="original"&&this.instance.currentItem.css({top:"auto",left:"auto"})}else{this.instance.cancelHelperRemoval=
false;this.instance._trigger("deactivate",a,f)}})},drag:function(a,b){var c=d(this).data("draggable"),f=this;d.each(c.sortables,function(){this.instance.positionAbs=c.positionAbs;this.instance.helperProportions=c.helperProportions;this.instance.offset.click=c.offset.click;if(this.instance._intersectsWith(this.instance.containerCache)){if(!this.instance.isOver){this.instance.isOver=1;this.instance.currentItem=d(f).clone().removeAttr("id").appendTo(this.instance.element).data("sortable-item",true);
this.instance.options._helper=this.instance.options.helper;this.instance.options.helper=function(){return b.helper[0]};a.target=this.instance.currentItem[0];this.instance._mouseCapture(a,true);this.instance._mouseStart(a,true,true);this.instance.offset.click.top=c.offset.click.top;this.instance.offset.click.left=c.offset.click.left;this.instance.offset.parent.left-=c.offset.parent.left-this.instance.offset.parent.left;this.instance.offset.parent.top-=c.offset.parent.top-this.instance.offset.parent.top;
c._trigger("toSortable",a);c.dropped=this.instance.element;c.currentItem=c.element;this.instance.fromOutside=c}this.instance.currentItem&&this.instance._mouseDrag(a)}else if(this.instance.isOver){this.instance.isOver=0;this.instance.cancelHelperRemoval=true;this.instance.options.revert=false;this.instance._trigger("out",a,this.instance._uiHash(this.instance));this.instance._mouseStop(a,true);this.instance.options.helper=this.instance.options._helper;this.instance.currentItem.remove();this.instance.placeholder&&
this.instance.placeholder.remove();c._trigger("fromSortable",a);c.dropped=false}})}});d.ui.plugin.add("draggable","cursor",{start:function(){var a=d("body"),b=d(this).data("draggable").options;if(a.css("cursor"))b._cursor=a.css("cursor");a.css("cursor",b.cursor)},stop:function(){var a=d(this).data("draggable").options;a._cursor&&d("body").css("cursor",a._cursor)}});d.ui.plugin.add("draggable","opacity",{start:function(a,b){a=d(b.helper);b=d(this).data("draggable").options;if(a.css("opacity"))b._opacity=
a.css("opacity");a.css("opacity",b.opacity)},stop:function(a,b){a=d(this).data("draggable").options;a._opacity&&d(b.helper).css("opacity",a._opacity)}});d.ui.plugin.add("draggable","scroll",{start:function(){var a=d(this).data("draggable");if(a.scrollParent[0]!=document&&a.scrollParent[0].tagName!="HTML")a.overflowOffset=a.scrollParent.offset()},drag:function(a){var b=d(this).data("draggable"),c=b.options,f=false;if(b.scrollParent[0]!=document&&b.scrollParent[0].tagName!="HTML"){if(!c.axis||c.axis!=
"x")if(b.overflowOffset.top+b.scrollParent[0].offsetHeight-a.pageY<c.scrollSensitivity)b.scrollParent[0].scrollTop=f=b.scrollParent[0].scrollTop+c.scrollSpeed;else if(a.pageY-b.overflowOffset.top<c.scrollSensitivity)b.scrollParent[0].scrollTop=f=b.scrollParent[0].scrollTop-c.scrollSpeed;if(!c.axis||c.axis!="y")if(b.overflowOffset.left+b.scrollParent[0].offsetWidth-a.pageX<c.scrollSensitivity)b.scrollParent[0].scrollLeft=f=b.scrollParent[0].scrollLeft+c.scrollSpeed;else if(a.pageX-b.overflowOffset.left<
c.scrollSensitivity)b.scrollParent[0].scrollLeft=f=b.scrollParent[0].scrollLeft-c.scrollSpeed}else{if(!c.axis||c.axis!="x")if(a.pageY-d(document).scrollTop()<c.scrollSensitivity)f=d(document).scrollTop(d(document).scrollTop()-c.scrollSpeed);else if(d(window).height()-(a.pageY-d(document).scrollTop())<c.scrollSensitivity)f=d(document).scrollTop(d(document).scrollTop()+c.scrollSpeed);if(!c.axis||c.axis!="y")if(a.pageX-d(document).scrollLeft()<c.scrollSensitivity)f=d(document).scrollLeft(d(document).scrollLeft()-
c.scrollSpeed);else if(d(window).width()-(a.pageX-d(document).scrollLeft())<c.scrollSensitivity)f=d(document).scrollLeft(d(document).scrollLeft()+c.scrollSpeed)}f!==false&&d.ui.ddmanager&&!c.dropBehaviour&&d.ui.ddmanager.prepareOffsets(b,a)}});d.ui.plugin.add("draggable","snap",{start:function(){var a=d(this).data("draggable"),b=a.options;a.snapElements=[];d(b.snap.constructor!=String?b.snap.items||":data(draggable)":b.snap).each(function(){var c=d(this),f=c.offset();this!=a.element[0]&&a.snapElements.push({item:this,
width:c.outerWidth(),height:c.outerHeight(),top:f.top,left:f.left})})},drag:function(a,b){for(var c=d(this).data("draggable"),f=c.options,e=f.snapTolerance,h=b.offset.left,g=h+c.helperProportions.width,n=b.offset.top,o=n+c.helperProportions.height,i=c.snapElements.length-1;i>=0;i--){var j=c.snapElements[i].left,l=j+c.snapElements[i].width,k=c.snapElements[i].top,m=k+c.snapElements[i].height;if(j-e<h&&h<l+e&&k-e<n&&n<m+e||j-e<h&&h<l+e&&k-e<o&&o<m+e||j-e<g&&g<l+e&&k-e<n&&n<m+e||j-e<g&&g<l+e&&k-e<o&&
o<m+e){if(f.snapMode!="inner"){var p=Math.abs(k-o)<=e,q=Math.abs(m-n)<=e,r=Math.abs(j-g)<=e,s=Math.abs(l-h)<=e;if(p)b.position.top=c._convertPositionTo("relative",{top:k-c.helperProportions.height,left:0}).top-c.margins.top;if(q)b.position.top=c._convertPositionTo("relative",{top:m,left:0}).top-c.margins.top;if(r)b.position.left=c._convertPositionTo("relative",{top:0,left:j-c.helperProportions.width}).left-c.margins.left;if(s)b.position.left=c._convertPositionTo("relative",{top:0,left:l}).left-c.margins.left}var t=
p||q||r||s;if(f.snapMode!="outer"){p=Math.abs(k-n)<=e;q=Math.abs(m-o)<=e;r=Math.abs(j-h)<=e;s=Math.abs(l-g)<=e;if(p)b.position.top=c._convertPositionTo("relative",{top:k,left:0}).top-c.margins.top;if(q)b.position.top=c._convertPositionTo("relative",{top:m-c.helperProportions.height,left:0}).top-c.margins.top;if(r)b.position.left=c._convertPositionTo("relative",{top:0,left:j}).left-c.margins.left;if(s)b.position.left=c._convertPositionTo("relative",{top:0,left:l-c.helperProportions.width}).left-c.margins.left}if(!c.snapElements[i].snapping&&
(p||q||r||s||t))c.options.snap.snap&&c.options.snap.snap.call(c.element,a,d.extend(c._uiHash(),{snapItem:c.snapElements[i].item}));c.snapElements[i].snapping=p||q||r||s||t}else{c.snapElements[i].snapping&&c.options.snap.release&&c.options.snap.release.call(c.element,a,d.extend(c._uiHash(),{snapItem:c.snapElements[i].item}));c.snapElements[i].snapping=false}}}});d.ui.plugin.add("draggable","stack",{start:function(){var a=d(this).data("draggable").options;a=d.makeArray(d(a.stack)).sort(function(c,f){return(parseInt(d(c).css("zIndex"),
10)||0)-(parseInt(d(f).css("zIndex"),10)||0)});if(a.length){var b=parseInt(a[0].style.zIndex)||0;d(a).each(function(c){this.style.zIndex=b+c});this[0].style.zIndex=b+a.length}}});d.ui.plugin.add("draggable","zIndex",{start:function(a,b){a=d(b.helper);b=d(this).data("draggable").options;if(a.css("zIndex"))b._zIndex=a.css("zIndex");a.css("zIndex",b.zIndex)},stop:function(a,b){a=d(this).data("draggable").options;a._zIndex&&d(b.helper).css("zIndex",a._zIndex)}})})(jQuery);
;/*
 * jQuery UI Droppable 1.8.16
 *
 * Copyright 2011, AUTHORS.txt (http://jqueryui.com/about)
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * http://jquery.org/license
 *
 * http://docs.jquery.com/UI/Droppables
 *
 * Depends:
 *	jquery.ui.core.js
 *	jquery.ui.widget.js
 *	jquery.ui.mouse.js
 *	jquery.ui.draggable.js
 */
(function(d){d.widget("ui.droppable",{widgetEventPrefix:"drop",options:{accept:"*",activeClass:false,addClasses:true,greedy:false,hoverClass:false,scope:"default",tolerance:"intersect"},_create:function(){var a=this.options,b=a.accept;this.isover=0;this.isout=1;this.accept=d.isFunction(b)?b:function(c){return c.is(b)};this.proportions={width:this.element[0].offsetWidth,height:this.element[0].offsetHeight};d.ui.ddmanager.droppables[a.scope]=d.ui.ddmanager.droppables[a.scope]||[];d.ui.ddmanager.droppables[a.scope].push(this);
a.addClasses&&this.element.addClass("ui-droppable")},destroy:function(){for(var a=d.ui.ddmanager.droppables[this.options.scope],b=0;b<a.length;b++)a[b]==this&&a.splice(b,1);this.element.removeClass("ui-droppable ui-droppable-disabled").removeData("droppable").unbind(".droppable");return this},_setOption:function(a,b){if(a=="accept")this.accept=d.isFunction(b)?b:function(c){return c.is(b)};d.Widget.prototype._setOption.apply(this,arguments)},_activate:function(a){var b=d.ui.ddmanager.current;this.options.activeClass&&
this.element.addClass(this.options.activeClass);b&&this._trigger("activate",a,this.ui(b))},_deactivate:function(a){var b=d.ui.ddmanager.current;this.options.activeClass&&this.element.removeClass(this.options.activeClass);b&&this._trigger("deactivate",a,this.ui(b))},_over:function(a){var b=d.ui.ddmanager.current;if(!(!b||(b.currentItem||b.element)[0]==this.element[0]))if(this.accept.call(this.element[0],b.currentItem||b.element)){this.options.hoverClass&&this.element.addClass(this.options.hoverClass);
this._trigger("over",a,this.ui(b))}},_out:function(a){var b=d.ui.ddmanager.current;if(!(!b||(b.currentItem||b.element)[0]==this.element[0]))if(this.accept.call(this.element[0],b.currentItem||b.element)){this.options.hoverClass&&this.element.removeClass(this.options.hoverClass);this._trigger("out",a,this.ui(b))}},_drop:function(a,b){var c=b||d.ui.ddmanager.current;if(!c||(c.currentItem||c.element)[0]==this.element[0])return false;var e=false;this.element.find(":data(droppable)").not(".ui-draggable-dragging").each(function(){var g=
d.data(this,"droppable");if(g.options.greedy&&!g.options.disabled&&g.options.scope==c.options.scope&&g.accept.call(g.element[0],c.currentItem||c.element)&&d.ui.intersect(c,d.extend(g,{offset:g.element.offset()}),g.options.tolerance)){e=true;return false}});if(e)return false;if(this.accept.call(this.element[0],c.currentItem||c.element)){this.options.activeClass&&this.element.removeClass(this.options.activeClass);this.options.hoverClass&&this.element.removeClass(this.options.hoverClass);this._trigger("drop",
a,this.ui(c));return this.element}return false},ui:function(a){return{draggable:a.currentItem||a.element,helper:a.helper,position:a.position,offset:a.positionAbs}}});d.extend(d.ui.droppable,{version:"1.8.16"});d.ui.intersect=function(a,b,c){if(!b.offset)return false;var e=(a.positionAbs||a.position.absolute).left,g=e+a.helperProportions.width,f=(a.positionAbs||a.position.absolute).top,h=f+a.helperProportions.height,i=b.offset.left,k=i+b.proportions.width,j=b.offset.top,l=j+b.proportions.height;
switch(c){case "fit":return i<=e&&g<=k&&j<=f&&h<=l;case "intersect":return i<e+a.helperProportions.width/2&&g-a.helperProportions.width/2<k&&j<f+a.helperProportions.height/2&&h-a.helperProportions.height/2<l;case "pointer":return d.ui.isOver((a.positionAbs||a.position.absolute).top+(a.clickOffset||a.offset.click).top,(a.positionAbs||a.position.absolute).left+(a.clickOffset||a.offset.click).left,j,i,b.proportions.height,b.proportions.width);case "touch":return(f>=j&&f<=l||h>=j&&h<=l||f<j&&h>l)&&(e>=
i&&e<=k||g>=i&&g<=k||e<i&&g>k);default:return false}};d.ui.ddmanager={current:null,droppables:{"default":[]},prepareOffsets:function(a,b){var c=d.ui.ddmanager.droppables[a.options.scope]||[],e=b?b.type:null,g=(a.currentItem||a.element).find(":data(droppable)").andSelf(),f=0;a:for(;f<c.length;f++)if(!(c[f].options.disabled||a&&!c[f].accept.call(c[f].element[0],a.currentItem||a.element))){for(var h=0;h<g.length;h++)if(g[h]==c[f].element[0]){c[f].proportions.height=0;continue a}c[f].visible=c[f].element.css("display")!=
"none";if(c[f].visible){e=="mousedown"&&c[f]._activate.call(c[f],b);c[f].offset=c[f].element.offset();c[f].proportions={width:c[f].element[0].offsetWidth,height:c[f].element[0].offsetHeight}}}},drop:function(a,b){var c=false;d.each(d.ui.ddmanager.droppables[a.options.scope]||[],function(){if(this.options){if(!this.options.disabled&&this.visible&&d.ui.intersect(a,this,this.options.tolerance))c=c||this._drop.call(this,b);if(!this.options.disabled&&this.visible&&this.accept.call(this.element[0],a.currentItem||
a.element)){this.isout=1;this.isover=0;this._deactivate.call(this,b)}}});return c},dragStart:function(a,b){a.element.parents(":not(body,html)").bind("scroll.droppable",function(){a.options.refreshPositions||d.ui.ddmanager.prepareOffsets(a,b)})},drag:function(a,b){a.options.refreshPositions&&d.ui.ddmanager.prepareOffsets(a,b);d.each(d.ui.ddmanager.droppables[a.options.scope]||[],function(){if(!(this.options.disabled||this.greedyChild||!this.visible)){var c=d.ui.intersect(a,this,this.options.tolerance);
if(c=!c&&this.isover==1?"isout":c&&this.isover==0?"isover":null){var e;if(this.options.greedy){var g=this.element.parents(":data(droppable):eq(0)");if(g.length){e=d.data(g[0],"droppable");e.greedyChild=c=="isover"?1:0}}if(e&&c=="isover"){e.isover=0;e.isout=1;e._out.call(e,b)}this[c]=1;this[c=="isout"?"isover":"isout"]=0;this[c=="isover"?"_over":"_out"].call(this,b);if(e&&c=="isout"){e.isout=0;e.isover=1;e._over.call(e,b)}}}})},dragStop:function(a,b){a.element.parents(":not(body,html)").unbind("scroll.droppable");
a.options.refreshPositions||d.ui.ddmanager.prepareOffsets(a,b)}}})(jQuery);
;/*
 * jQuery UI Resizable 1.8.16
 *
 * Copyright 2011, AUTHORS.txt (http://jqueryui.com/about)
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * http://jquery.org/license
 *
 * http://docs.jquery.com/UI/Resizables
 *
 * Depends:
 *	jquery.ui.core.js
 *	jquery.ui.mouse.js
 *	jquery.ui.widget.js
 */
(function(e){e.widget("ui.resizable",e.ui.mouse,{widgetEventPrefix:"resize",options:{alsoResize:false,animate:false,animateDuration:"slow",animateEasing:"swing",aspectRatio:false,autoHide:false,containment:false,ghost:false,grid:false,handles:"e,s,se",helper:false,maxHeight:null,maxWidth:null,minHeight:10,minWidth:10,zIndex:1E3},_create:function(){var b=this,a=this.options;this.element.addClass("ui-resizable");e.extend(this,{_aspectRatio:!!a.aspectRatio,aspectRatio:a.aspectRatio,originalElement:this.element,
_proportionallyResizeElements:[],_helper:a.helper||a.ghost||a.animate?a.helper||"ui-resizable-helper":null});if(this.element[0].nodeName.match(/canvas|textarea|input|select|button|img/i)){/relative/.test(this.element.css("position"))&&e.browser.opera&&this.element.css({position:"relative",top:"auto",left:"auto"});this.element.wrap(e('<div class="ui-wrapper" style="overflow: hidden;"></div>').css({position:this.element.css("position"),width:this.element.outerWidth(),height:this.element.outerHeight(),
top:this.element.css("top"),left:this.element.css("left")}));this.element=this.element.parent().data("resizable",this.element.data("resizable"));this.elementIsWrapper=true;this.element.css({marginLeft:this.originalElement.css("marginLeft"),marginTop:this.originalElement.css("marginTop"),marginRight:this.originalElement.css("marginRight"),marginBottom:this.originalElement.css("marginBottom")});this.originalElement.css({marginLeft:0,marginTop:0,marginRight:0,marginBottom:0});this.originalResizeStyle=
this.originalElement.css("resize");this.originalElement.css("resize","none");this._proportionallyResizeElements.push(this.originalElement.css({position:"static",zoom:1,display:"block"}));this.originalElement.css({margin:this.originalElement.css("margin")});this._proportionallyResize()}this.handles=a.handles||(!e(".ui-resizable-handle",this.element).length?"e,s,se":{n:".ui-resizable-n",e:".ui-resizable-e",s:".ui-resizable-s",w:".ui-resizable-w",se:".ui-resizable-se",sw:".ui-resizable-sw",ne:".ui-resizable-ne",
nw:".ui-resizable-nw"});if(this.handles.constructor==String){if(this.handles=="all")this.handles="n,e,s,w,se,sw,ne,nw";var c=this.handles.split(",");this.handles={};for(var d=0;d<c.length;d++){var f=e.trim(c[d]),g=e('<div class="ui-resizable-handle '+("ui-resizable-"+f)+'"></div>');/sw|se|ne|nw/.test(f)&&g.css({zIndex:++a.zIndex});"se"==f&&g.addClass("ui-icon ui-icon-gripsmall-diagonal-se");this.handles[f]=".ui-resizable-"+f;this.element.append(g)}}this._renderAxis=function(h){h=h||this.element;for(var i in this.handles){if(this.handles[i].constructor==
String)this.handles[i]=e(this.handles[i],this.element).show();if(this.elementIsWrapper&&this.originalElement[0].nodeName.match(/textarea|input|select|button/i)){var j=e(this.handles[i],this.element),l=0;l=/sw|ne|nw|se|n|s/.test(i)?j.outerHeight():j.outerWidth();j=["padding",/ne|nw|n/.test(i)?"Top":/se|sw|s/.test(i)?"Bottom":/^e$/.test(i)?"Right":"Left"].join("");h.css(j,l);this._proportionallyResize()}e(this.handles[i])}};this._renderAxis(this.element);this._handles=e(".ui-resizable-handle",this.element).disableSelection();
this._handles.mouseover(function(){if(!b.resizing){if(this.className)var h=this.className.match(/ui-resizable-(se|sw|ne|nw|n|e|s|w)/i);b.axis=h&&h[1]?h[1]:"se"}});if(a.autoHide){this._handles.hide();e(this.element).addClass("ui-resizable-autohide").hover(function(){if(!a.disabled){e(this).removeClass("ui-resizable-autohide");b._handles.show()}},function(){if(!a.disabled)if(!b.resizing){e(this).addClass("ui-resizable-autohide");b._handles.hide()}})}this._mouseInit()},destroy:function(){this._mouseDestroy();
var b=function(c){e(c).removeClass("ui-resizable ui-resizable-disabled ui-resizable-resizing").removeData("resizable").unbind(".resizable").find(".ui-resizable-handle").remove()};if(this.elementIsWrapper){b(this.element);var a=this.element;a.after(this.originalElement.css({position:a.css("position"),width:a.outerWidth(),height:a.outerHeight(),top:a.css("top"),left:a.css("left")})).remove()}this.originalElement.css("resize",this.originalResizeStyle);b(this.originalElement);return this},_mouseCapture:function(b){var a=
false;for(var c in this.handles)if(e(this.handles[c])[0]==b.target)a=true;return!this.options.disabled&&a},_mouseStart:function(b){var a=this.options,c=this.element.position(),d=this.element;this.resizing=true;this.documentScroll={top:e(document).scrollTop(),left:e(document).scrollLeft()};if(d.is(".ui-draggable")||/absolute/.test(d.css("position")))d.css({position:"absolute",top:c.top,left:c.left});e.browser.opera&&/relative/.test(d.css("position"))&&d.css({position:"relative",top:"auto",left:"auto"});
this._renderProxy();c=m(this.helper.css("left"));var f=m(this.helper.css("top"));if(a.containment){c+=e(a.containment).scrollLeft()||0;f+=e(a.containment).scrollTop()||0}this.offset=this.helper.offset();this.position={left:c,top:f};this.size=this._helper?{width:d.outerWidth(),height:d.outerHeight()}:{width:d.width(),height:d.height()};this.originalSize=this._helper?{width:d.outerWidth(),height:d.outerHeight()}:{width:d.width(),height:d.height()};this.originalPosition={left:c,top:f};this.sizeDiff=
{width:d.outerWidth()-d.width(),height:d.outerHeight()-d.height()};this.originalMousePosition={left:b.pageX,top:b.pageY};this.aspectRatio=typeof a.aspectRatio=="number"?a.aspectRatio:this.originalSize.width/this.originalSize.height||1;a=e(".ui-resizable-"+this.axis).css("cursor");e("body").css("cursor",a=="auto"?this.axis+"-resize":a);d.addClass("ui-resizable-resizing");this._propagate("start",b);return true},_mouseDrag:function(b){var a=this.helper,c=this.originalMousePosition,d=this._change[this.axis];
if(!d)return false;c=d.apply(this,[b,b.pageX-c.left||0,b.pageY-c.top||0]);this._updateVirtualBoundaries(b.shiftKey);if(this._aspectRatio||b.shiftKey)c=this._updateRatio(c,b);c=this._respectSize(c,b);this._propagate("resize",b);a.css({top:this.position.top+"px",left:this.position.left+"px",width:this.size.width+"px",height:this.size.height+"px"});!this._helper&&this._proportionallyResizeElements.length&&this._proportionallyResize();this._updateCache(c);this._trigger("resize",b,this.ui());return false},
_mouseStop:function(b){this.resizing=false;var a=this.options,c=this;if(this._helper){var d=this._proportionallyResizeElements,f=d.length&&/textarea/i.test(d[0].nodeName);d=f&&e.ui.hasScroll(d[0],"left")?0:c.sizeDiff.height;f=f?0:c.sizeDiff.width;f={width:c.helper.width()-f,height:c.helper.height()-d};d=parseInt(c.element.css("left"),10)+(c.position.left-c.originalPosition.left)||null;var g=parseInt(c.element.css("top"),10)+(c.position.top-c.originalPosition.top)||null;a.animate||this.element.css(e.extend(f,
{top:g,left:d}));c.helper.height(c.size.height);c.helper.width(c.size.width);this._helper&&!a.animate&&this._proportionallyResize()}e("body").css("cursor","auto");this.element.removeClass("ui-resizable-resizing");this._propagate("stop",b);this._helper&&this.helper.remove();return false},_updateVirtualBoundaries:function(b){var a=this.options,c,d,f;a={minWidth:k(a.minWidth)?a.minWidth:0,maxWidth:k(a.maxWidth)?a.maxWidth:Infinity,minHeight:k(a.minHeight)?a.minHeight:0,maxHeight:k(a.maxHeight)?a.maxHeight:
Infinity};if(this._aspectRatio||b){b=a.minHeight*this.aspectRatio;d=a.minWidth/this.aspectRatio;c=a.maxHeight*this.aspectRatio;f=a.maxWidth/this.aspectRatio;if(b>a.minWidth)a.minWidth=b;if(d>a.minHeight)a.minHeight=d;if(c<a.maxWidth)a.maxWidth=c;if(f<a.maxHeight)a.maxHeight=f}this._vBoundaries=a},_updateCache:function(b){this.offset=this.helper.offset();if(k(b.left))this.position.left=b.left;if(k(b.top))this.position.top=b.top;if(k(b.height))this.size.height=b.height;if(k(b.width))this.size.width=
b.width},_updateRatio:function(b){var a=this.position,c=this.size,d=this.axis;if(k(b.height))b.width=b.height*this.aspectRatio;else if(k(b.width))b.height=b.width/this.aspectRatio;if(d=="sw"){b.left=a.left+(c.width-b.width);b.top=null}if(d=="nw"){b.top=a.top+(c.height-b.height);b.left=a.left+(c.width-b.width)}return b},_respectSize:function(b){var a=this._vBoundaries,c=this.axis,d=k(b.width)&&a.maxWidth&&a.maxWidth<b.width,f=k(b.height)&&a.maxHeight&&a.maxHeight<b.height,g=k(b.width)&&a.minWidth&&
a.minWidth>b.width,h=k(b.height)&&a.minHeight&&a.minHeight>b.height;if(g)b.width=a.minWidth;if(h)b.height=a.minHeight;if(d)b.width=a.maxWidth;if(f)b.height=a.maxHeight;var i=this.originalPosition.left+this.originalSize.width,j=this.position.top+this.size.height,l=/sw|nw|w/.test(c);c=/nw|ne|n/.test(c);if(g&&l)b.left=i-a.minWidth;if(d&&l)b.left=i-a.maxWidth;if(h&&c)b.top=j-a.minHeight;if(f&&c)b.top=j-a.maxHeight;if((a=!b.width&&!b.height)&&!b.left&&b.top)b.top=null;else if(a&&!b.top&&b.left)b.left=
null;return b},_proportionallyResize:function(){if(this._proportionallyResizeElements.length)for(var b=this.helper||this.element,a=0;a<this._proportionallyResizeElements.length;a++){var c=this._proportionallyResizeElements[a];if(!this.borderDif){var d=[c.css("borderTopWidth"),c.css("borderRightWidth"),c.css("borderBottomWidth"),c.css("borderLeftWidth")],f=[c.css("paddingTop"),c.css("paddingRight"),c.css("paddingBottom"),c.css("paddingLeft")];this.borderDif=e.map(d,function(g,h){g=parseInt(g,10)||
0;h=parseInt(f[h],10)||0;return g+h})}e.browser.msie&&(e(b).is(":hidden")||e(b).parents(":hidden").length)||c.css({height:b.height()-this.borderDif[0]-this.borderDif[2]||0,width:b.width()-this.borderDif[1]-this.borderDif[3]||0})}},_renderProxy:function(){var b=this.options;this.elementOffset=this.element.offset();if(this._helper){this.helper=this.helper||e('<div style="overflow:hidden;"></div>');var a=e.browser.msie&&e.browser.version<7,c=a?1:0;a=a?2:-1;this.helper.addClass(this._helper).css({width:this.element.outerWidth()+
a,height:this.element.outerHeight()+a,position:"absolute",left:this.elementOffset.left-c+"px",top:this.elementOffset.top-c+"px",zIndex:++b.zIndex});this.helper.appendTo("body").disableSelection()}else this.helper=this.element},_change:{e:function(b,a){return{width:this.originalSize.width+a}},w:function(b,a){return{left:this.originalPosition.left+a,width:this.originalSize.width-a}},n:function(b,a,c){return{top:this.originalPosition.top+c,height:this.originalSize.height-c}},s:function(b,a,c){return{height:this.originalSize.height+
c}},se:function(b,a,c){return e.extend(this._change.s.apply(this,arguments),this._change.e.apply(this,[b,a,c]))},sw:function(b,a,c){return e.extend(this._change.s.apply(this,arguments),this._change.w.apply(this,[b,a,c]))},ne:function(b,a,c){return e.extend(this._change.n.apply(this,arguments),this._change.e.apply(this,[b,a,c]))},nw:function(b,a,c){return e.extend(this._change.n.apply(this,arguments),this._change.w.apply(this,[b,a,c]))}},_propagate:function(b,a){e.ui.plugin.call(this,b,[a,this.ui()]);
b!="resize"&&this._trigger(b,a,this.ui())},plugins:{},ui:function(){return{originalElement:this.originalElement,element:this.element,helper:this.helper,position:this.position,size:this.size,originalSize:this.originalSize,originalPosition:this.originalPosition}}});e.extend(e.ui.resizable,{version:"1.8.16"});e.ui.plugin.add("resizable","alsoResize",{start:function(){var b=e(this).data("resizable").options,a=function(c){e(c).each(function(){var d=e(this);d.data("resizable-alsoresize",{width:parseInt(d.width(),
10),height:parseInt(d.height(),10),left:parseInt(d.css("left"),10),top:parseInt(d.css("top"),10),position:d.css("position")})})};if(typeof b.alsoResize=="object"&&!b.alsoResize.parentNode)if(b.alsoResize.length){b.alsoResize=b.alsoResize[0];a(b.alsoResize)}else e.each(b.alsoResize,function(c){a(c)});else a(b.alsoResize)},resize:function(b,a){var c=e(this).data("resizable");b=c.options;var d=c.originalSize,f=c.originalPosition,g={height:c.size.height-d.height||0,width:c.size.width-d.width||0,top:c.position.top-
f.top||0,left:c.position.left-f.left||0},h=function(i,j){e(i).each(function(){var l=e(this),q=e(this).data("resizable-alsoresize"),p={},r=j&&j.length?j:l.parents(a.originalElement[0]).length?["width","height"]:["width","height","top","left"];e.each(r,function(n,o){if((n=(q[o]||0)+(g[o]||0))&&n>=0)p[o]=n||null});if(e.browser.opera&&/relative/.test(l.css("position"))){c._revertToRelativePosition=true;l.css({position:"absolute",top:"auto",left:"auto"})}l.css(p)})};typeof b.alsoResize=="object"&&!b.alsoResize.nodeType?
e.each(b.alsoResize,function(i,j){h(i,j)}):h(b.alsoResize)},stop:function(){var b=e(this).data("resizable"),a=b.options,c=function(d){e(d).each(function(){var f=e(this);f.css({position:f.data("resizable-alsoresize").position})})};if(b._revertToRelativePosition){b._revertToRelativePosition=false;typeof a.alsoResize=="object"&&!a.alsoResize.nodeType?e.each(a.alsoResize,function(d){c(d)}):c(a.alsoResize)}e(this).removeData("resizable-alsoresize")}});e.ui.plugin.add("resizable","animate",{stop:function(b){var a=
e(this).data("resizable"),c=a.options,d=a._proportionallyResizeElements,f=d.length&&/textarea/i.test(d[0].nodeName),g=f&&e.ui.hasScroll(d[0],"left")?0:a.sizeDiff.height;f={width:a.size.width-(f?0:a.sizeDiff.width),height:a.size.height-g};g=parseInt(a.element.css("left"),10)+(a.position.left-a.originalPosition.left)||null;var h=parseInt(a.element.css("top"),10)+(a.position.top-a.originalPosition.top)||null;a.element.animate(e.extend(f,h&&g?{top:h,left:g}:{}),{duration:c.animateDuration,easing:c.animateEasing,
step:function(){var i={width:parseInt(a.element.css("width"),10),height:parseInt(a.element.css("height"),10),top:parseInt(a.element.css("top"),10),left:parseInt(a.element.css("left"),10)};d&&d.length&&e(d[0]).css({width:i.width,height:i.height});a._updateCache(i);a._propagate("resize",b)}})}});e.ui.plugin.add("resizable","containment",{start:function(){var b=e(this).data("resizable"),a=b.element,c=b.options.containment;if(a=c instanceof e?c.get(0):/parent/.test(c)?a.parent().get(0):c){b.containerElement=
e(a);if(/document/.test(c)||c==document){b.containerOffset={left:0,top:0};b.containerPosition={left:0,top:0};b.parentData={element:e(document),left:0,top:0,width:e(document).width(),height:e(document).height()||document.body.parentNode.scrollHeight}}else{var d=e(a),f=[];e(["Top","Right","Left","Bottom"]).each(function(i,j){f[i]=m(d.css("padding"+j))});b.containerOffset=d.offset();b.containerPosition=d.position();b.containerSize={height:d.innerHeight()-f[3],width:d.innerWidth()-f[1]};c=b.containerOffset;
var g=b.containerSize.height,h=b.containerSize.width;h=e.ui.hasScroll(a,"left")?a.scrollWidth:h;g=e.ui.hasScroll(a)?a.scrollHeight:g;b.parentData={element:a,left:c.left,top:c.top,width:h,height:g}}}},resize:function(b){var a=e(this).data("resizable"),c=a.options,d=a.containerOffset,f=a.position;b=a._aspectRatio||b.shiftKey;var g={top:0,left:0},h=a.containerElement;if(h[0]!=document&&/static/.test(h.css("position")))g=d;if(f.left<(a._helper?d.left:0)){a.size.width+=a._helper?a.position.left-d.left:
a.position.left-g.left;if(b)a.size.height=a.size.width/c.aspectRatio;a.position.left=c.helper?d.left:0}if(f.top<(a._helper?d.top:0)){a.size.height+=a._helper?a.position.top-d.top:a.position.top;if(b)a.size.width=a.size.height*c.aspectRatio;a.position.top=a._helper?d.top:0}a.offset.left=a.parentData.left+a.position.left;a.offset.top=a.parentData.top+a.position.top;c=Math.abs((a._helper?a.offset.left-g.left:a.offset.left-g.left)+a.sizeDiff.width);d=Math.abs((a._helper?a.offset.top-g.top:a.offset.top-
d.top)+a.sizeDiff.height);f=a.containerElement.get(0)==a.element.parent().get(0);g=/relative|absolute/.test(a.containerElement.css("position"));if(f&&g)c-=a.parentData.left;if(c+a.size.width>=a.parentData.width){a.size.width=a.parentData.width-c;if(b)a.size.height=a.size.width/a.aspectRatio}if(d+a.size.height>=a.parentData.height){a.size.height=a.parentData.height-d;if(b)a.size.width=a.size.height*a.aspectRatio}},stop:function(){var b=e(this).data("resizable"),a=b.options,c=b.containerOffset,d=b.containerPosition,
f=b.containerElement,g=e(b.helper),h=g.offset(),i=g.outerWidth()-b.sizeDiff.width;g=g.outerHeight()-b.sizeDiff.height;b._helper&&!a.animate&&/relative/.test(f.css("position"))&&e(this).css({left:h.left-d.left-c.left,width:i,height:g});b._helper&&!a.animate&&/static/.test(f.css("position"))&&e(this).css({left:h.left-d.left-c.left,width:i,height:g})}});e.ui.plugin.add("resizable","ghost",{start:function(){var b=e(this).data("resizable"),a=b.options,c=b.size;b.ghost=b.originalElement.clone();b.ghost.css({opacity:0.25,
display:"block",position:"relative",height:c.height,width:c.width,margin:0,left:0,top:0}).addClass("ui-resizable-ghost").addClass(typeof a.ghost=="string"?a.ghost:"");b.ghost.appendTo(b.helper)},resize:function(){var b=e(this).data("resizable");b.ghost&&b.ghost.css({position:"relative",height:b.size.height,width:b.size.width})},stop:function(){var b=e(this).data("resizable");b.ghost&&b.helper&&b.helper.get(0).removeChild(b.ghost.get(0))}});e.ui.plugin.add("resizable","grid",{resize:function(){var b=
e(this).data("resizable"),a=b.options,c=b.size,d=b.originalSize,f=b.originalPosition,g=b.axis;a.grid=typeof a.grid=="number"?[a.grid,a.grid]:a.grid;var h=Math.round((c.width-d.width)/(a.grid[0]||1))*(a.grid[0]||1);a=Math.round((c.height-d.height)/(a.grid[1]||1))*(a.grid[1]||1);if(/^(se|s|e)$/.test(g)){b.size.width=d.width+h;b.size.height=d.height+a}else if(/^(ne)$/.test(g)){b.size.width=d.width+h;b.size.height=d.height+a;b.position.top=f.top-a}else{if(/^(sw)$/.test(g)){b.size.width=d.width+h;b.size.height=
d.height+a}else{b.size.width=d.width+h;b.size.height=d.height+a;b.position.top=f.top-a}b.position.left=f.left-h}}});var m=function(b){return parseInt(b,10)||0},k=function(b){return!isNaN(parseInt(b,10))}})(jQuery);
;/*
 * jQuery UI Selectable 1.8.16
 *
 * Copyright 2011, AUTHORS.txt (http://jqueryui.com/about)
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * http://jquery.org/license
 *
 * http://docs.jquery.com/UI/Selectables
 *
 * Depends:
 *	jquery.ui.core.js
 *	jquery.ui.mouse.js
 *	jquery.ui.widget.js
 */
(function(e){e.widget("ui.selectable",e.ui.mouse,{options:{appendTo:"body",autoRefresh:true,distance:0,filter:"*",tolerance:"touch"},_create:function(){var c=this;this.element.addClass("ui-selectable");this.dragged=false;var f;this.refresh=function(){f=e(c.options.filter,c.element[0]);f.each(function(){var d=e(this),b=d.offset();e.data(this,"selectable-item",{element:this,$element:d,left:b.left,top:b.top,right:b.left+d.outerWidth(),bottom:b.top+d.outerHeight(),startselected:false,selected:d.hasClass("ui-selected"),
selecting:d.hasClass("ui-selecting"),unselecting:d.hasClass("ui-unselecting")})})};this.refresh();this.selectees=f.addClass("ui-selectee");this._mouseInit();this.helper=e("<div class='ui-selectable-helper'></div>")},destroy:function(){this.selectees.removeClass("ui-selectee").removeData("selectable-item");this.element.removeClass("ui-selectable ui-selectable-disabled").removeData("selectable").unbind(".selectable");this._mouseDestroy();return this},_mouseStart:function(c){var f=this;this.opos=[c.pageX,
c.pageY];if(!this.options.disabled){var d=this.options;this.selectees=e(d.filter,this.element[0]);this._trigger("start",c);e(d.appendTo).append(this.helper);this.helper.css({left:c.clientX,top:c.clientY,width:0,height:0});d.autoRefresh&&this.refresh();this.selectees.filter(".ui-selected").each(function(){var b=e.data(this,"selectable-item");b.startselected=true;if(!c.metaKey){b.$element.removeClass("ui-selected");b.selected=false;b.$element.addClass("ui-unselecting");b.unselecting=true;f._trigger("unselecting",
c,{unselecting:b.element})}});e(c.target).parents().andSelf().each(function(){var b=e.data(this,"selectable-item");if(b){var g=!c.metaKey||!b.$element.hasClass("ui-selected");b.$element.removeClass(g?"ui-unselecting":"ui-selected").addClass(g?"ui-selecting":"ui-unselecting");b.unselecting=!g;b.selecting=g;(b.selected=g)?f._trigger("selecting",c,{selecting:b.element}):f._trigger("unselecting",c,{unselecting:b.element});return false}})}},_mouseDrag:function(c){var f=this;this.dragged=true;if(!this.options.disabled){var d=
this.options,b=this.opos[0],g=this.opos[1],h=c.pageX,i=c.pageY;if(b>h){var j=h;h=b;b=j}if(g>i){j=i;i=g;g=j}this.helper.css({left:b,top:g,width:h-b,height:i-g});this.selectees.each(function(){var a=e.data(this,"selectable-item");if(!(!a||a.element==f.element[0])){var k=false;if(d.tolerance=="touch")k=!(a.left>h||a.right<b||a.top>i||a.bottom<g);else if(d.tolerance=="fit")k=a.left>b&&a.right<h&&a.top>g&&a.bottom<i;if(k){if(a.selected){a.$element.removeClass("ui-selected");a.selected=false}if(a.unselecting){a.$element.removeClass("ui-unselecting");
a.unselecting=false}if(!a.selecting){a.$element.addClass("ui-selecting");a.selecting=true;f._trigger("selecting",c,{selecting:a.element})}}else{if(a.selecting)if(c.metaKey&&a.startselected){a.$element.removeClass("ui-selecting");a.selecting=false;a.$element.addClass("ui-selected");a.selected=true}else{a.$element.removeClass("ui-selecting");a.selecting=false;if(a.startselected){a.$element.addClass("ui-unselecting");a.unselecting=true}f._trigger("unselecting",c,{unselecting:a.element})}if(a.selected)if(!c.metaKey&&
!a.startselected){a.$element.removeClass("ui-selected");a.selected=false;a.$element.addClass("ui-unselecting");a.unselecting=true;f._trigger("unselecting",c,{unselecting:a.element})}}}});return false}},_mouseStop:function(c){var f=this;this.dragged=false;e(".ui-unselecting",this.element[0]).each(function(){var d=e.data(this,"selectable-item");d.$element.removeClass("ui-unselecting");d.unselecting=false;d.startselected=false;f._trigger("unselected",c,{unselected:d.element})});e(".ui-selecting",this.element[0]).each(function(){var d=
e.data(this,"selectable-item");d.$element.removeClass("ui-selecting").addClass("ui-selected");d.selecting=false;d.selected=true;d.startselected=true;f._trigger("selected",c,{selected:d.element})});this._trigger("stop",c);this.helper.remove();return false}});e.extend(e.ui.selectable,{version:"1.8.16"})})(jQuery);
;/*
 * jQuery UI Sortable 1.8.16
 *
 * Copyright 2011, AUTHORS.txt (http://jqueryui.com/about)
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * http://jquery.org/license
 *
 * http://docs.jquery.com/UI/Sortables
 *
 * Depends:
 *	jquery.ui.core.js
 *	jquery.ui.mouse.js
 *	jquery.ui.widget.js
 */
(function(d){d.widget("ui.sortable",d.ui.mouse,{widgetEventPrefix:"sort",options:{appendTo:"parent",axis:false,connectWith:false,containment:false,cursor:"auto",cursorAt:false,dropOnEmpty:true,forcePlaceholderSize:false,forceHelperSize:false,grid:false,handle:false,helper:"original",items:"> *",opacity:false,placeholder:false,revert:false,scroll:true,scrollSensitivity:20,scrollSpeed:20,scope:"default",tolerance:"intersect",zIndex:1E3},_create:function(){var a=this.options;this.containerCache={};this.element.addClass("ui-sortable");
this.refresh();this.floating=this.items.length?a.axis==="x"||/left|right/.test(this.items[0].item.css("float"))||/inline|table-cell/.test(this.items[0].item.css("display")):false;this.offset=this.element.offset();this._mouseInit()},destroy:function(){this.element.removeClass("ui-sortable ui-sortable-disabled").removeData("sortable").unbind(".sortable");this._mouseDestroy();for(var a=this.items.length-1;a>=0;a--)this.items[a].item.removeData("sortable-item");return this},_setOption:function(a,b){if(a===
"disabled"){this.options[a]=b;this.widget()[b?"addClass":"removeClass"]("ui-sortable-disabled")}else d.Widget.prototype._setOption.apply(this,arguments)},_mouseCapture:function(a,b){if(this.reverting)return false;if(this.options.disabled||this.options.type=="static")return false;this._refreshItems(a);var c=null,e=this;d(a.target).parents().each(function(){if(d.data(this,"sortable-item")==e){c=d(this);return false}});if(d.data(a.target,"sortable-item")==e)c=d(a.target);if(!c)return false;if(this.options.handle&&
!b){var f=false;d(this.options.handle,c).find("*").andSelf().each(function(){if(this==a.target)f=true});if(!f)return false}this.currentItem=c;this._removeCurrentsFromItems();return true},_mouseStart:function(a,b,c){b=this.options;var e=this;this.currentContainer=this;this.refreshPositions();this.helper=this._createHelper(a);this._cacheHelperProportions();this._cacheMargins();this.scrollParent=this.helper.scrollParent();this.offset=this.currentItem.offset();this.offset={top:this.offset.top-this.margins.top,
left:this.offset.left-this.margins.left};this.helper.css("position","absolute");this.cssPosition=this.helper.css("position");d.extend(this.offset,{click:{left:a.pageX-this.offset.left,top:a.pageY-this.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()});this.originalPosition=this._generatePosition(a);this.originalPageX=a.pageX;this.originalPageY=a.pageY;b.cursorAt&&this._adjustOffsetFromHelper(b.cursorAt);this.domPosition={prev:this.currentItem.prev()[0],parent:this.currentItem.parent()[0]};
this.helper[0]!=this.currentItem[0]&&this.currentItem.hide();this._createPlaceholder();b.containment&&this._setContainment();if(b.cursor){if(d("body").css("cursor"))this._storedCursor=d("body").css("cursor");d("body").css("cursor",b.cursor)}if(b.opacity){if(this.helper.css("opacity"))this._storedOpacity=this.helper.css("opacity");this.helper.css("opacity",b.opacity)}if(b.zIndex){if(this.helper.css("zIndex"))this._storedZIndex=this.helper.css("zIndex");this.helper.css("zIndex",b.zIndex)}if(this.scrollParent[0]!=
document&&this.scrollParent[0].tagName!="HTML")this.overflowOffset=this.scrollParent.offset();this._trigger("start",a,this._uiHash());this._preserveHelperProportions||this._cacheHelperProportions();if(!c)for(c=this.containers.length-1;c>=0;c--)this.containers[c]._trigger("activate",a,e._uiHash(this));if(d.ui.ddmanager)d.ui.ddmanager.current=this;d.ui.ddmanager&&!b.dropBehaviour&&d.ui.ddmanager.prepareOffsets(this,a);this.dragging=true;this.helper.addClass("ui-sortable-helper");this._mouseDrag(a);
return true},_mouseDrag:function(a){this.position=this._generatePosition(a);this.positionAbs=this._convertPositionTo("absolute");if(!this.lastPositionAbs)this.lastPositionAbs=this.positionAbs;if(this.options.scroll){var b=this.options,c=false;if(this.scrollParent[0]!=document&&this.scrollParent[0].tagName!="HTML"){if(this.overflowOffset.top+this.scrollParent[0].offsetHeight-a.pageY<b.scrollSensitivity)this.scrollParent[0].scrollTop=c=this.scrollParent[0].scrollTop+b.scrollSpeed;else if(a.pageY-this.overflowOffset.top<
b.scrollSensitivity)this.scrollParent[0].scrollTop=c=this.scrollParent[0].scrollTop-b.scrollSpeed;if(this.overflowOffset.left+this.scrollParent[0].offsetWidth-a.pageX<b.scrollSensitivity)this.scrollParent[0].scrollLeft=c=this.scrollParent[0].scrollLeft+b.scrollSpeed;else if(a.pageX-this.overflowOffset.left<b.scrollSensitivity)this.scrollParent[0].scrollLeft=c=this.scrollParent[0].scrollLeft-b.scrollSpeed}else{if(a.pageY-d(document).scrollTop()<b.scrollSensitivity)c=d(document).scrollTop(d(document).scrollTop()-
b.scrollSpeed);else if(d(window).height()-(a.pageY-d(document).scrollTop())<b.scrollSensitivity)c=d(document).scrollTop(d(document).scrollTop()+b.scrollSpeed);if(a.pageX-d(document).scrollLeft()<b.scrollSensitivity)c=d(document).scrollLeft(d(document).scrollLeft()-b.scrollSpeed);else if(d(window).width()-(a.pageX-d(document).scrollLeft())<b.scrollSensitivity)c=d(document).scrollLeft(d(document).scrollLeft()+b.scrollSpeed)}c!==false&&d.ui.ddmanager&&!b.dropBehaviour&&d.ui.ddmanager.prepareOffsets(this,
a)}this.positionAbs=this._convertPositionTo("absolute");if(!this.options.axis||this.options.axis!="y")this.helper[0].style.left=this.position.left+"px";if(!this.options.axis||this.options.axis!="x")this.helper[0].style.top=this.position.top+"px";for(b=this.items.length-1;b>=0;b--){c=this.items[b];var e=c.item[0],f=this._intersectsWithPointer(c);if(f)if(e!=this.currentItem[0]&&this.placeholder[f==1?"next":"prev"]()[0]!=e&&!d.ui.contains(this.placeholder[0],e)&&(this.options.type=="semi-dynamic"?!d.ui.contains(this.element[0],
e):true)){this.direction=f==1?"down":"up";if(this.options.tolerance=="pointer"||this._intersectsWithSides(c))this._rearrange(a,c);else break;this._trigger("change",a,this._uiHash());break}}this._contactContainers(a);d.ui.ddmanager&&d.ui.ddmanager.drag(this,a);this._trigger("sort",a,this._uiHash());this.lastPositionAbs=this.positionAbs;return false},_mouseStop:function(a,b){if(a){d.ui.ddmanager&&!this.options.dropBehaviour&&d.ui.ddmanager.drop(this,a);if(this.options.revert){var c=this;b=c.placeholder.offset();
c.reverting=true;d(this.helper).animate({left:b.left-this.offset.parent.left-c.margins.left+(this.offsetParent[0]==document.body?0:this.offsetParent[0].scrollLeft),top:b.top-this.offset.parent.top-c.margins.top+(this.offsetParent[0]==document.body?0:this.offsetParent[0].scrollTop)},parseInt(this.options.revert,10)||500,function(){c._clear(a)})}else this._clear(a,b);return false}},cancel:function(){var a=this;if(this.dragging){this._mouseUp({target:null});this.options.helper=="original"?this.currentItem.css(this._storedCSS).removeClass("ui-sortable-helper"):
this.currentItem.show();for(var b=this.containers.length-1;b>=0;b--){this.containers[b]._trigger("deactivate",null,a._uiHash(this));if(this.containers[b].containerCache.over){this.containers[b]._trigger("out",null,a._uiHash(this));this.containers[b].containerCache.over=0}}}if(this.placeholder){this.placeholder[0].parentNode&&this.placeholder[0].parentNode.removeChild(this.placeholder[0]);this.options.helper!="original"&&this.helper&&this.helper[0].parentNode&&this.helper.remove();d.extend(this,{helper:null,
dragging:false,reverting:false,_noFinalSort:null});this.domPosition.prev?d(this.domPosition.prev).after(this.currentItem):d(this.domPosition.parent).prepend(this.currentItem)}return this},serialize:function(a){var b=this._getItemsAsjQuery(a&&a.connected),c=[];a=a||{};d(b).each(function(){var e=(d(a.item||this).attr(a.attribute||"id")||"").match(a.expression||/(.+)[-=_](.+)/);if(e)c.push((a.key||e[1]+"[]")+"="+(a.key&&a.expression?e[1]:e[2]))});!c.length&&a.key&&c.push(a.key+"=");return c.join("&")},
toArray:function(a){var b=this._getItemsAsjQuery(a&&a.connected),c=[];a=a||{};b.each(function(){c.push(d(a.item||this).attr(a.attribute||"id")||"")});return c},_intersectsWith:function(a){var b=this.positionAbs.left,c=b+this.helperProportions.width,e=this.positionAbs.top,f=e+this.helperProportions.height,g=a.left,h=g+a.width,i=a.top,k=i+a.height,j=this.offset.click.top,l=this.offset.click.left;j=e+j>i&&e+j<k&&b+l>g&&b+l<h;return this.options.tolerance=="pointer"||this.options.forcePointerForContainers||
this.options.tolerance!="pointer"&&this.helperProportions[this.floating?"width":"height"]>a[this.floating?"width":"height"]?j:g<b+this.helperProportions.width/2&&c-this.helperProportions.width/2<h&&i<e+this.helperProportions.height/2&&f-this.helperProportions.height/2<k},_intersectsWithPointer:function(a){var b=d.ui.isOverAxis(this.positionAbs.top+this.offset.click.top,a.top,a.height);a=d.ui.isOverAxis(this.positionAbs.left+this.offset.click.left,a.left,a.width);b=b&&a;a=this._getDragVerticalDirection();
var c=this._getDragHorizontalDirection();if(!b)return false;return this.floating?c&&c=="right"||a=="down"?2:1:a&&(a=="down"?2:1)},_intersectsWithSides:function(a){var b=d.ui.isOverAxis(this.positionAbs.top+this.offset.click.top,a.top+a.height/2,a.height);a=d.ui.isOverAxis(this.positionAbs.left+this.offset.click.left,a.left+a.width/2,a.width);var c=this._getDragVerticalDirection(),e=this._getDragHorizontalDirection();return this.floating&&e?e=="right"&&a||e=="left"&&!a:c&&(c=="down"&&b||c=="up"&&!b)},
_getDragVerticalDirection:function(){var a=this.positionAbs.top-this.lastPositionAbs.top;return a!=0&&(a>0?"down":"up")},_getDragHorizontalDirection:function(){var a=this.positionAbs.left-this.lastPositionAbs.left;return a!=0&&(a>0?"right":"left")},refresh:function(a){this._refreshItems(a);this.refreshPositions();return this},_connectWith:function(){var a=this.options;return a.connectWith.constructor==String?[a.connectWith]:a.connectWith},_getItemsAsjQuery:function(a){var b=[],c=[],e=this._connectWith();
if(e&&a)for(a=e.length-1;a>=0;a--)for(var f=d(e[a]),g=f.length-1;g>=0;g--){var h=d.data(f[g],"sortable");if(h&&h!=this&&!h.options.disabled)c.push([d.isFunction(h.options.items)?h.options.items.call(h.element):d(h.options.items,h.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),h])}c.push([d.isFunction(this.options.items)?this.options.items.call(this.element,null,{options:this.options,item:this.currentItem}):d(this.options.items,this.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),
this]);for(a=c.length-1;a>=0;a--)c[a][0].each(function(){b.push(this)});return d(b)},_removeCurrentsFromItems:function(){for(var a=this.currentItem.find(":data(sortable-item)"),b=0;b<this.items.length;b++)for(var c=0;c<a.length;c++)a[c]==this.items[b].item[0]&&this.items.splice(b,1)},_refreshItems:function(a){this.items=[];this.containers=[this];var b=this.items,c=[[d.isFunction(this.options.items)?this.options.items.call(this.element[0],a,{item:this.currentItem}):d(this.options.items,this.element),
this]],e=this._connectWith();if(e)for(var f=e.length-1;f>=0;f--)for(var g=d(e[f]),h=g.length-1;h>=0;h--){var i=d.data(g[h],"sortable");if(i&&i!=this&&!i.options.disabled){c.push([d.isFunction(i.options.items)?i.options.items.call(i.element[0],a,{item:this.currentItem}):d(i.options.items,i.element),i]);this.containers.push(i)}}for(f=c.length-1;f>=0;f--){a=c[f][1];e=c[f][0];h=0;for(g=e.length;h<g;h++){i=d(e[h]);i.data("sortable-item",a);b.push({item:i,instance:a,width:0,height:0,left:0,top:0})}}},refreshPositions:function(a){if(this.offsetParent&&
this.helper)this.offset.parent=this._getParentOffset();for(var b=this.items.length-1;b>=0;b--){var c=this.items[b];if(!(c.instance!=this.currentContainer&&this.currentContainer&&c.item[0]!=this.currentItem[0])){var e=this.options.toleranceElement?d(this.options.toleranceElement,c.item):c.item;if(!a){c.width=e.outerWidth();c.height=e.outerHeight()}e=e.offset();c.left=e.left;c.top=e.top}}if(this.options.custom&&this.options.custom.refreshContainers)this.options.custom.refreshContainers.call(this);else for(b=
this.containers.length-1;b>=0;b--){e=this.containers[b].element.offset();this.containers[b].containerCache.left=e.left;this.containers[b].containerCache.top=e.top;this.containers[b].containerCache.width=this.containers[b].element.outerWidth();this.containers[b].containerCache.height=this.containers[b].element.outerHeight()}return this},_createPlaceholder:function(a){var b=a||this,c=b.options;if(!c.placeholder||c.placeholder.constructor==String){var e=c.placeholder;c.placeholder={element:function(){var f=
d(document.createElement(b.currentItem[0].nodeName)).addClass(e||b.currentItem[0].className+" ui-sortable-placeholder").removeClass("ui-sortable-helper")[0];if(!e)f.style.visibility="hidden";return f},update:function(f,g){if(!(e&&!c.forcePlaceholderSize)){g.height()||g.height(b.currentItem.innerHeight()-parseInt(b.currentItem.css("paddingTop")||0,10)-parseInt(b.currentItem.css("paddingBottom")||0,10));g.width()||g.width(b.currentItem.innerWidth()-parseInt(b.currentItem.css("paddingLeft")||0,10)-parseInt(b.currentItem.css("paddingRight")||
0,10))}}}}b.placeholder=d(c.placeholder.element.call(b.element,b.currentItem));b.currentItem.after(b.placeholder);c.placeholder.update(b,b.placeholder)},_contactContainers:function(a){for(var b=null,c=null,e=this.containers.length-1;e>=0;e--)if(!d.ui.contains(this.currentItem[0],this.containers[e].element[0]))if(this._intersectsWith(this.containers[e].containerCache)){if(!(b&&d.ui.contains(this.containers[e].element[0],b.element[0]))){b=this.containers[e];c=e}}else if(this.containers[e].containerCache.over){this.containers[e]._trigger("out",
a,this._uiHash(this));this.containers[e].containerCache.over=0}if(b)if(this.containers.length===1){this.containers[c]._trigger("over",a,this._uiHash(this));this.containers[c].containerCache.over=1}else if(this.currentContainer!=this.containers[c]){b=1E4;e=null;for(var f=this.positionAbs[this.containers[c].floating?"left":"top"],g=this.items.length-1;g>=0;g--)if(d.ui.contains(this.containers[c].element[0],this.items[g].item[0])){var h=this.items[g][this.containers[c].floating?"left":"top"];if(Math.abs(h-
f)<b){b=Math.abs(h-f);e=this.items[g]}}if(e||this.options.dropOnEmpty){this.currentContainer=this.containers[c];e?this._rearrange(a,e,null,true):this._rearrange(a,null,this.containers[c].element,true);this._trigger("change",a,this._uiHash());this.containers[c]._trigger("change",a,this._uiHash(this));this.options.placeholder.update(this.currentContainer,this.placeholder);this.containers[c]._trigger("over",a,this._uiHash(this));this.containers[c].containerCache.over=1}}},_createHelper:function(a){var b=
this.options;a=d.isFunction(b.helper)?d(b.helper.apply(this.element[0],[a,this.currentItem])):b.helper=="clone"?this.currentItem.clone():this.currentItem;a.parents("body").length||d(b.appendTo!="parent"?b.appendTo:this.currentItem[0].parentNode)[0].appendChild(a[0]);if(a[0]==this.currentItem[0])this._storedCSS={width:this.currentItem[0].style.width,height:this.currentItem[0].style.height,position:this.currentItem.css("position"),top:this.currentItem.css("top"),left:this.currentItem.css("left")};if(a[0].style.width==
""||b.forceHelperSize)a.width(this.currentItem.width());if(a[0].style.height==""||b.forceHelperSize)a.height(this.currentItem.height());return a},_adjustOffsetFromHelper:function(a){if(typeof a=="string")a=a.split(" ");if(d.isArray(a))a={left:+a[0],top:+a[1]||0};if("left"in a)this.offset.click.left=a.left+this.margins.left;if("right"in a)this.offset.click.left=this.helperProportions.width-a.right+this.margins.left;if("top"in a)this.offset.click.top=a.top+this.margins.top;if("bottom"in a)this.offset.click.top=
this.helperProportions.height-a.bottom+this.margins.top},_getParentOffset:function(){this.offsetParent=this.helper.offsetParent();var a=this.offsetParent.offset();if(this.cssPosition=="absolute"&&this.scrollParent[0]!=document&&d.ui.contains(this.scrollParent[0],this.offsetParent[0])){a.left+=this.scrollParent.scrollLeft();a.top+=this.scrollParent.scrollTop()}if(this.offsetParent[0]==document.body||this.offsetParent[0].tagName&&this.offsetParent[0].tagName.toLowerCase()=="html"&&d.browser.msie)a=
{top:0,left:0};return{top:a.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:a.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if(this.cssPosition=="relative"){var a=this.currentItem.position();return{top:a.top-(parseInt(this.helper.css("top"),10)||0)+this.scrollParent.scrollTop(),left:a.left-(parseInt(this.helper.css("left"),10)||0)+this.scrollParent.scrollLeft()}}else return{top:0,left:0}},_cacheMargins:function(){this.margins={left:parseInt(this.currentItem.css("marginLeft"),
10)||0,top:parseInt(this.currentItem.css("marginTop"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var a=this.options;if(a.containment=="parent")a.containment=this.helper[0].parentNode;if(a.containment=="document"||a.containment=="window")this.containment=[0-this.offset.relative.left-this.offset.parent.left,0-this.offset.relative.top-this.offset.parent.top,d(a.containment=="document"?
document:window).width()-this.helperProportions.width-this.margins.left,(d(a.containment=="document"?document:window).height()||document.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top];if(!/^(document|window|parent)$/.test(a.containment)){var b=d(a.containment)[0];a=d(a.containment).offset();var c=d(b).css("overflow")!="hidden";this.containment=[a.left+(parseInt(d(b).css("borderLeftWidth"),10)||0)+(parseInt(d(b).css("paddingLeft"),10)||0)-this.margins.left,a.top+(parseInt(d(b).css("borderTopWidth"),
10)||0)+(parseInt(d(b).css("paddingTop"),10)||0)-this.margins.top,a.left+(c?Math.max(b.scrollWidth,b.offsetWidth):b.offsetWidth)-(parseInt(d(b).css("borderLeftWidth"),10)||0)-(parseInt(d(b).css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left,a.top+(c?Math.max(b.scrollHeight,b.offsetHeight):b.offsetHeight)-(parseInt(d(b).css("borderTopWidth"),10)||0)-(parseInt(d(b).css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top]}},_convertPositionTo:function(a,b){if(!b)b=
this.position;a=a=="absolute"?1:-1;var c=this.cssPosition=="absolute"&&!(this.scrollParent[0]!=document&&d.ui.contains(this.scrollParent[0],this.offsetParent[0]))?this.offsetParent:this.scrollParent,e=/(html|body)/i.test(c[0].tagName);return{top:b.top+this.offset.relative.top*a+this.offset.parent.top*a-(d.browser.safari&&this.cssPosition=="fixed"?0:(this.cssPosition=="fixed"?-this.scrollParent.scrollTop():e?0:c.scrollTop())*a),left:b.left+this.offset.relative.left*a+this.offset.parent.left*a-(d.browser.safari&&
this.cssPosition=="fixed"?0:(this.cssPosition=="fixed"?-this.scrollParent.scrollLeft():e?0:c.scrollLeft())*a)}},_generatePosition:function(a){var b=this.options,c=this.cssPosition=="absolute"&&!(this.scrollParent[0]!=document&&d.ui.contains(this.scrollParent[0],this.offsetParent[0]))?this.offsetParent:this.scrollParent,e=/(html|body)/i.test(c[0].tagName);if(this.cssPosition=="relative"&&!(this.scrollParent[0]!=document&&this.scrollParent[0]!=this.offsetParent[0]))this.offset.relative=this._getRelativeOffset();
var f=a.pageX,g=a.pageY;if(this.originalPosition){if(this.containment){if(a.pageX-this.offset.click.left<this.containment[0])f=this.containment[0]+this.offset.click.left;if(a.pageY-this.offset.click.top<this.containment[1])g=this.containment[1]+this.offset.click.top;if(a.pageX-this.offset.click.left>this.containment[2])f=this.containment[2]+this.offset.click.left;if(a.pageY-this.offset.click.top>this.containment[3])g=this.containment[3]+this.offset.click.top}if(b.grid){g=this.originalPageY+Math.round((g-
this.originalPageY)/b.grid[1])*b.grid[1];g=this.containment?!(g-this.offset.click.top<this.containment[1]||g-this.offset.click.top>this.containment[3])?g:!(g-this.offset.click.top<this.containment[1])?g-b.grid[1]:g+b.grid[1]:g;f=this.originalPageX+Math.round((f-this.originalPageX)/b.grid[0])*b.grid[0];f=this.containment?!(f-this.offset.click.left<this.containment[0]||f-this.offset.click.left>this.containment[2])?f:!(f-this.offset.click.left<this.containment[0])?f-b.grid[0]:f+b.grid[0]:f}}return{top:g-
this.offset.click.top-this.offset.relative.top-this.offset.parent.top+(d.browser.safari&&this.cssPosition=="fixed"?0:this.cssPosition=="fixed"?-this.scrollParent.scrollTop():e?0:c.scrollTop()),left:f-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+(d.browser.safari&&this.cssPosition=="fixed"?0:this.cssPosition=="fixed"?-this.scrollParent.scrollLeft():e?0:c.scrollLeft())}},_rearrange:function(a,b,c,e){c?c[0].appendChild(this.placeholder[0]):b.item[0].parentNode.insertBefore(this.placeholder[0],
this.direction=="down"?b.item[0]:b.item[0].nextSibling);this.counter=this.counter?++this.counter:1;var f=this,g=this.counter;window.setTimeout(function(){g==f.counter&&f.refreshPositions(!e)},0)},_clear:function(a,b){this.reverting=false;var c=[];!this._noFinalSort&&this.currentItem.parent().length&&this.placeholder.before(this.currentItem);this._noFinalSort=null;if(this.helper[0]==this.currentItem[0]){for(var e in this._storedCSS)if(this._storedCSS[e]=="auto"||this._storedCSS[e]=="static")this._storedCSS[e]=
"";this.currentItem.css(this._storedCSS).removeClass("ui-sortable-helper")}else this.currentItem.show();this.fromOutside&&!b&&c.push(function(f){this._trigger("receive",f,this._uiHash(this.fromOutside))});if((this.fromOutside||this.domPosition.prev!=this.currentItem.prev().not(".ui-sortable-helper")[0]||this.domPosition.parent!=this.currentItem.parent()[0])&&!b)c.push(function(f){this._trigger("update",f,this._uiHash())});if(!d.ui.contains(this.element[0],this.currentItem[0])){b||c.push(function(f){this._trigger("remove",
f,this._uiHash())});for(e=this.containers.length-1;e>=0;e--)if(d.ui.contains(this.containers[e].element[0],this.currentItem[0])&&!b){c.push(function(f){return function(g){f._trigger("receive",g,this._uiHash(this))}}.call(this,this.containers[e]));c.push(function(f){return function(g){f._trigger("update",g,this._uiHash(this))}}.call(this,this.containers[e]))}}for(e=this.containers.length-1;e>=0;e--){b||c.push(function(f){return function(g){f._trigger("deactivate",g,this._uiHash(this))}}.call(this,
this.containers[e]));if(this.containers[e].containerCache.over){c.push(function(f){return function(g){f._trigger("out",g,this._uiHash(this))}}.call(this,this.containers[e]));this.containers[e].containerCache.over=0}}this._storedCursor&&d("body").css("cursor",this._storedCursor);this._storedOpacity&&this.helper.css("opacity",this._storedOpacity);if(this._storedZIndex)this.helper.css("zIndex",this._storedZIndex=="auto"?"":this._storedZIndex);this.dragging=false;if(this.cancelHelperRemoval){if(!b){this._trigger("beforeStop",
a,this._uiHash());for(e=0;e<c.length;e++)c[e].call(this,a);this._trigger("stop",a,this._uiHash())}return false}b||this._trigger("beforeStop",a,this._uiHash());this.placeholder[0].parentNode.removeChild(this.placeholder[0]);this.helper[0]!=this.currentItem[0]&&this.helper.remove();this.helper=null;if(!b){for(e=0;e<c.length;e++)c[e].call(this,a);this._trigger("stop",a,this._uiHash())}this.fromOutside=false;return true},_trigger:function(){d.Widget.prototype._trigger.apply(this,arguments)===false&&this.cancel()},
_uiHash:function(a){var b=a||this;return{helper:b.helper,placeholder:b.placeholder||d([]),position:b.position,originalPosition:b.originalPosition,offset:b.positionAbs,item:b.currentItem,sender:a?a.element:null}}});d.extend(d.ui.sortable,{version:"1.8.16"})})(jQuery);
;/*
 * jQuery UI Accordion 1.8.16
 *
 * Copyright 2011, AUTHORS.txt (http://jqueryui.com/about)
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * http://jquery.org/license
 *
 * http://docs.jquery.com/UI/Accordion
 *
 * Depends:
 *	jquery.ui.core.js
 *	jquery.ui.widget.js
 */
(function(c){c.widget("ui.accordion",{options:{active:0,animated:"slide",autoHeight:true,clearStyle:false,collapsible:false,event:"click",fillSpace:false,header:"> li > :first-child,> :not(li):even",icons:{header:"ui-icon-triangle-1-e",headerSelected:"ui-icon-triangle-1-s"},navigation:false,navigationFilter:function(){return this.href.toLowerCase()===location.href.toLowerCase()}},_create:function(){var a=this,b=a.options;a.running=0;a.element.addClass("ui-accordion ui-widget ui-helper-reset").children("li").addClass("ui-accordion-li-fix");
a.headers=a.element.find(b.header).addClass("ui-accordion-header ui-helper-reset ui-state-default ui-corner-all").bind("mouseenter.accordion",function(){b.disabled||c(this).addClass("ui-state-hover")}).bind("mouseleave.accordion",function(){b.disabled||c(this).removeClass("ui-state-hover")}).bind("focus.accordion",function(){b.disabled||c(this).addClass("ui-state-focus")}).bind("blur.accordion",function(){b.disabled||c(this).removeClass("ui-state-focus")});a.headers.next().addClass("ui-accordion-content ui-helper-reset ui-widget-content ui-corner-bottom");
if(b.navigation){var d=a.element.find("a").filter(b.navigationFilter).eq(0);if(d.length){var h=d.closest(".ui-accordion-header");a.active=h.length?h:d.closest(".ui-accordion-content").prev()}}a.active=a._findActive(a.active||b.active).addClass("ui-state-default ui-state-active").toggleClass("ui-corner-all").toggleClass("ui-corner-top");a.active.next().addClass("ui-accordion-content-active");a._createIcons();a.resize();a.element.attr("role","tablist");a.headers.attr("role","tab").bind("keydown.accordion",
function(f){return a._keydown(f)}).next().attr("role","tabpanel");a.headers.not(a.active||"").attr({"aria-expanded":"false","aria-selected":"false",tabIndex:-1}).next().hide();a.active.length?a.active.attr({"aria-expanded":"true","aria-selected":"true",tabIndex:0}):a.headers.eq(0).attr("tabIndex",0);c.browser.safari||a.headers.find("a").attr("tabIndex",-1);b.event&&a.headers.bind(b.event.split(" ").join(".accordion ")+".accordion",function(f){a._clickHandler.call(a,f,this);f.preventDefault()})},_createIcons:function(){var a=
this.options;if(a.icons){c("<span></span>").addClass("ui-icon "+a.icons.header).prependTo(this.headers);this.active.children(".ui-icon").toggleClass(a.icons.header).toggleClass(a.icons.headerSelected);this.element.addClass("ui-accordion-icons")}},_destroyIcons:function(){this.headers.children(".ui-icon").remove();this.element.removeClass("ui-accordion-icons")},destroy:function(){var a=this.options;this.element.removeClass("ui-accordion ui-widget ui-helper-reset").removeAttr("role");this.headers.unbind(".accordion").removeClass("ui-accordion-header ui-accordion-disabled ui-helper-reset ui-state-default ui-corner-all ui-state-active ui-state-disabled ui-corner-top").removeAttr("role").removeAttr("aria-expanded").removeAttr("aria-selected").removeAttr("tabIndex");
this.headers.find("a").removeAttr("tabIndex");this._destroyIcons();var b=this.headers.next().css("display","").removeAttr("role").removeClass("ui-helper-reset ui-widget-content ui-corner-bottom ui-accordion-content ui-accordion-content-active ui-accordion-disabled ui-state-disabled");if(a.autoHeight||a.fillHeight)b.css("height","");return c.Widget.prototype.destroy.call(this)},_setOption:function(a,b){c.Widget.prototype._setOption.apply(this,arguments);a=="active"&&this.activate(b);if(a=="icons"){this._destroyIcons();
b&&this._createIcons()}if(a=="disabled")this.headers.add(this.headers.next())[b?"addClass":"removeClass"]("ui-accordion-disabled ui-state-disabled")},_keydown:function(a){if(!(this.options.disabled||a.altKey||a.ctrlKey)){var b=c.ui.keyCode,d=this.headers.length,h=this.headers.index(a.target),f=false;switch(a.keyCode){case b.RIGHT:case b.DOWN:f=this.headers[(h+1)%d];break;case b.LEFT:case b.UP:f=this.headers[(h-1+d)%d];break;case b.SPACE:case b.ENTER:this._clickHandler({target:a.target},a.target);
a.preventDefault()}if(f){c(a.target).attr("tabIndex",-1);c(f).attr("tabIndex",0);f.focus();return false}return true}},resize:function(){var a=this.options,b;if(a.fillSpace){if(c.browser.msie){var d=this.element.parent().css("overflow");this.element.parent().css("overflow","hidden")}b=this.element.parent().height();c.browser.msie&&this.element.parent().css("overflow",d);this.headers.each(function(){b-=c(this).outerHeight(true)});this.headers.next().each(function(){c(this).height(Math.max(0,b-c(this).innerHeight()+
c(this).height()))}).css("overflow","auto")}else if(a.autoHeight){b=0;this.headers.next().each(function(){b=Math.max(b,c(this).height("").height())}).height(b)}return this},activate:function(a){this.options.active=a;a=this._findActive(a)[0];this._clickHandler({target:a},a);return this},_findActive:function(a){return a?typeof a==="number"?this.headers.filter(":eq("+a+")"):this.headers.not(this.headers.not(a)):a===false?c([]):this.headers.filter(":eq(0)")},_clickHandler:function(a,b){var d=this.options;
if(!d.disabled)if(a.target){a=c(a.currentTarget||b);b=a[0]===this.active[0];d.active=d.collapsible&&b?false:this.headers.index(a);if(!(this.running||!d.collapsible&&b)){var h=this.active;j=a.next();g=this.active.next();e={options:d,newHeader:b&&d.collapsible?c([]):a,oldHeader:this.active,newContent:b&&d.collapsible?c([]):j,oldContent:g};var f=this.headers.index(this.active[0])>this.headers.index(a[0]);this.active=b?c([]):a;this._toggle(j,g,e,b,f);h.removeClass("ui-state-active ui-corner-top").addClass("ui-state-default ui-corner-all").children(".ui-icon").removeClass(d.icons.headerSelected).addClass(d.icons.header);
if(!b){a.removeClass("ui-state-default ui-corner-all").addClass("ui-state-active ui-corner-top").children(".ui-icon").removeClass(d.icons.header).addClass(d.icons.headerSelected);a.next().addClass("ui-accordion-content-active")}}}else if(d.collapsible){this.active.removeClass("ui-state-active ui-corner-top").addClass("ui-state-default ui-corner-all").children(".ui-icon").removeClass(d.icons.headerSelected).addClass(d.icons.header);this.active.next().addClass("ui-accordion-content-active");var g=this.active.next(),
e={options:d,newHeader:c([]),oldHeader:d.active,newContent:c([]),oldContent:g},j=this.active=c([]);this._toggle(j,g,e)}},_toggle:function(a,b,d,h,f){var g=this,e=g.options;g.toShow=a;g.toHide=b;g.data=d;var j=function(){if(g)return g._completed.apply(g,arguments)};g._trigger("changestart",null,g.data);g.running=b.size()===0?a.size():b.size();if(e.animated){d={};d=e.collapsible&&h?{toShow:c([]),toHide:b,complete:j,down:f,autoHeight:e.autoHeight||e.fillSpace}:{toShow:a,toHide:b,complete:j,down:f,autoHeight:e.autoHeight||
e.fillSpace};if(!e.proxied)e.proxied=e.animated;if(!e.proxiedDuration)e.proxiedDuration=e.duration;e.animated=c.isFunction(e.proxied)?e.proxied(d):e.proxied;e.duration=c.isFunction(e.proxiedDuration)?e.proxiedDuration(d):e.proxiedDuration;h=c.ui.accordion.animations;var i=e.duration,k=e.animated;if(k&&!h[k]&&!c.easing[k])k="slide";h[k]||(h[k]=function(l){this.slide(l,{easing:k,duration:i||700})});h[k](d)}else{if(e.collapsible&&h)a.toggle();else{b.hide();a.show()}j(true)}b.prev().attr({"aria-expanded":"false",
"aria-selected":"false",tabIndex:-1}).blur();a.prev().attr({"aria-expanded":"true","aria-selected":"true",tabIndex:0}).focus()},_completed:function(a){this.running=a?0:--this.running;if(!this.running){this.options.clearStyle&&this.toShow.add(this.toHide).css({height:"",overflow:""});this.toHide.removeClass("ui-accordion-content-active");if(this.toHide.length)this.toHide.parent()[0].className=this.toHide.parent()[0].className;this._trigger("change",null,this.data)}}});c.extend(c.ui.accordion,{version:"1.8.16",
animations:{slide:function(a,b){a=c.extend({easing:"swing",duration:300},a,b);if(a.toHide.size())if(a.toShow.size()){var d=a.toShow.css("overflow"),h=0,f={},g={},e;b=a.toShow;e=b[0].style.width;b.width(parseInt(b.parent().width(),10)-parseInt(b.css("paddingLeft"),10)-parseInt(b.css("paddingRight"),10)-(parseInt(b.css("borderLeftWidth"),10)||0)-(parseInt(b.css("borderRightWidth"),10)||0));c.each(["height","paddingTop","paddingBottom"],function(j,i){g[i]="hide";j=(""+c.css(a.toShow[0],i)).match(/^([\d+-.]+)(.*)$/);
f[i]={value:j[1],unit:j[2]||"px"}});a.toShow.css({height:0,overflow:"hidden"}).show();a.toHide.filter(":hidden").each(a.complete).end().filter(":visible").animate(g,{step:function(j,i){if(i.prop=="height")h=i.end-i.start===0?0:(i.now-i.start)/(i.end-i.start);a.toShow[0].style[i.prop]=h*f[i.prop].value+f[i.prop].unit},duration:a.duration,easing:a.easing,complete:function(){a.autoHeight||a.toShow.css("height","");a.toShow.css({width:e,overflow:d});a.complete()}})}else a.toHide.animate({height:"hide",
paddingTop:"hide",paddingBottom:"hide"},a);else a.toShow.animate({height:"show",paddingTop:"show",paddingBottom:"show"},a)},bounceslide:function(a){this.slide(a,{easing:a.down?"easeOutBounce":"swing",duration:a.down?1E3:200})}}})})(jQuery);
;/*
 * jQuery UI Autocomplete 1.8.16
 *
 * Copyright 2011, AUTHORS.txt (http://jqueryui.com/about)
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * http://jquery.org/license
 *
 * http://docs.jquery.com/UI/Autocomplete
 *
 * Depends:
 *	jquery.ui.core.js
 *	jquery.ui.widget.js
 *	jquery.ui.position.js
 */
(function(d){var e=0;d.widget("ui.autocomplete",{options:{appendTo:"body",autoFocus:false,delay:300,minLength:1,position:{my:"left top",at:"left bottom",collision:"none"},source:null},pending:0,_create:function(){var a=this,b=this.element[0].ownerDocument,g;this.element.addClass("ui-autocomplete-input").attr("autocomplete","off").attr({role:"textbox","aria-autocomplete":"list","aria-haspopup":"true"}).bind("keydown.autocomplete",function(c){if(!(a.options.disabled||a.element.propAttr("readOnly"))){g=
false;var f=d.ui.keyCode;switch(c.keyCode){case f.PAGE_UP:a._move("previousPage",c);break;case f.PAGE_DOWN:a._move("nextPage",c);break;case f.UP:a._move("previous",c);c.preventDefault();break;case f.DOWN:a._move("next",c);c.preventDefault();break;case f.ENTER:case f.NUMPAD_ENTER:if(a.menu.active){g=true;c.preventDefault()}case f.TAB:if(!a.menu.active)return;a.menu.select(c);break;case f.ESCAPE:a.element.val(a.term);a.close(c);break;default:clearTimeout(a.searching);a.searching=setTimeout(function(){if(a.term!=
a.element.val()){a.selectedItem=null;a.search(null,c)}},a.options.delay);break}}}).bind("keypress.autocomplete",function(c){if(g){g=false;c.preventDefault()}}).bind("focus.autocomplete",function(){if(!a.options.disabled){a.selectedItem=null;a.previous=a.element.val()}}).bind("blur.autocomplete",function(c){if(!a.options.disabled){clearTimeout(a.searching);a.closing=setTimeout(function(){a.close(c);a._change(c)},150)}});this._initSource();this.response=function(){return a._response.apply(a,arguments)};
this.menu=d("<ul></ul>").addClass("ui-autocomplete").appendTo(d(this.options.appendTo||"body",b)[0]).mousedown(function(c){var f=a.menu.element[0];d(c.target).closest(".ui-menu-item").length||setTimeout(function(){d(document).one("mousedown",function(h){h.target!==a.element[0]&&h.target!==f&&!d.ui.contains(f,h.target)&&a.close()})},1);setTimeout(function(){clearTimeout(a.closing)},13)}).menu({focus:function(c,f){f=f.item.data("item.autocomplete");false!==a._trigger("focus",c,{item:f})&&/^key/.test(c.originalEvent.type)&&
a.element.val(f.value)},selected:function(c,f){var h=f.item.data("item.autocomplete"),i=a.previous;if(a.element[0]!==b.activeElement){a.element.focus();a.previous=i;setTimeout(function(){a.previous=i;a.selectedItem=h},1)}false!==a._trigger("select",c,{item:h})&&a.element.val(h.value);a.term=a.element.val();a.close(c);a.selectedItem=h},blur:function(){a.menu.element.is(":visible")&&a.element.val()!==a.term&&a.element.val(a.term)}}).zIndex(this.element.zIndex()+1).css({top:0,left:0}).hide().data("menu");
d.fn.bgiframe&&this.menu.element.bgiframe()},destroy:function(){this.element.removeClass("ui-autocomplete-input").removeAttr("autocomplete").removeAttr("role").removeAttr("aria-autocomplete").removeAttr("aria-haspopup");this.menu.element.remove();d.Widget.prototype.destroy.call(this)},_setOption:function(a,b){d.Widget.prototype._setOption.apply(this,arguments);a==="source"&&this._initSource();if(a==="appendTo")this.menu.element.appendTo(d(b||"body",this.element[0].ownerDocument)[0]);a==="disabled"&&
b&&this.xhr&&this.xhr.abort()},_initSource:function(){var a=this,b,g;if(d.isArray(this.options.source)){b=this.options.source;this.source=function(c,f){f(d.ui.autocomplete.filter(b,c.term))}}else if(typeof this.options.source==="string"){g=this.options.source;this.source=function(c,f){a.xhr&&a.xhr.abort();a.xhr=d.ajax({url:g,data:c,dataType:"json",autocompleteRequest:++e,success:function(h){this.autocompleteRequest===e&&f(h)},error:function(){this.autocompleteRequest===e&&f([])}})}}else this.source=
this.options.source},search:function(a,b){a=a!=null?a:this.element.val();this.term=this.element.val();if(a.length<this.options.minLength)return this.close(b);clearTimeout(this.closing);if(this._trigger("search",b)!==false)return this._search(a)},_search:function(a){this.pending++;this.element.addClass("ui-autocomplete-loading");this.source({term:a},this.response)},_response:function(a){if(!this.options.disabled&&a&&a.length){a=this._normalize(a);this._suggest(a);this._trigger("open")}else this.close();
this.pending--;this.pending||this.element.removeClass("ui-autocomplete-loading")},close:function(a){clearTimeout(this.closing);if(this.menu.element.is(":visible")){this.menu.element.hide();this.menu.deactivate();this._trigger("close",a)}},_change:function(a){this.previous!==this.element.val()&&this._trigger("change",a,{item:this.selectedItem})},_normalize:function(a){if(a.length&&a[0].label&&a[0].value)return a;return d.map(a,function(b){if(typeof b==="string")return{label:b,value:b};return d.extend({label:b.label||
b.value,value:b.value||b.label},b)})},_suggest:function(a){var b=this.menu.element.empty().zIndex(this.element.zIndex()+1);this._renderMenu(b,a);this.menu.deactivate();this.menu.refresh();b.show();this._resizeMenu();b.position(d.extend({of:this.element},this.options.position));this.options.autoFocus&&this.menu.next(new d.Event("mouseover"))},_resizeMenu:function(){var a=this.menu.element;a.outerWidth(Math.max(a.width("").outerWidth(),this.element.outerWidth()))},_renderMenu:function(a,b){var g=this;
d.each(b,function(c,f){g._renderItem(a,f)})},_renderItem:function(a,b){return d("<li></li>").data("item.autocomplete",b).append(d("<a></a>").text(b.label)).appendTo(a)},_move:function(a,b){if(this.menu.element.is(":visible"))if(this.menu.first()&&/^previous/.test(a)||this.menu.last()&&/^next/.test(a)){this.element.val(this.term);this.menu.deactivate()}else this.menu[a](b);else this.search(null,b)},widget:function(){return this.menu.element}});d.extend(d.ui.autocomplete,{escapeRegex:function(a){return a.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,
"\\$&")},filter:function(a,b){var g=new RegExp(d.ui.autocomplete.escapeRegex(b),"i");return d.grep(a,function(c){return g.test(c.label||c.value||c)})}})})(jQuery);
(function(d){d.widget("ui.menu",{_create:function(){var e=this;this.element.addClass("ui-menu ui-widget ui-widget-content ui-corner-all").attr({role:"listbox","aria-activedescendant":"ui-active-menuitem"}).click(function(a){if(d(a.target).closest(".ui-menu-item a").length){a.preventDefault();e.select(a)}});this.refresh()},refresh:function(){var e=this;this.element.children("li:not(.ui-menu-item):has(a)").addClass("ui-menu-item").attr("role","menuitem").children("a").addClass("ui-corner-all").attr("tabindex",
-1).mouseenter(function(a){e.activate(a,d(this).parent())}).mouseleave(function(){e.deactivate()})},activate:function(e,a){this.deactivate();if(this.hasScroll()){var b=a.offset().top-this.element.offset().top,g=this.element.scrollTop(),c=this.element.height();if(b<0)this.element.scrollTop(g+b);else b>=c&&this.element.scrollTop(g+b-c+a.height())}this.active=a.eq(0).children("a").addClass("ui-state-hover").attr("id","ui-active-menuitem").end();this._trigger("focus",e,{item:a})},deactivate:function(){if(this.active){this.active.children("a").removeClass("ui-state-hover").removeAttr("id");
this._trigger("blur");this.active=null}},next:function(e){this.move("next",".ui-menu-item:first",e)},previous:function(e){this.move("prev",".ui-menu-item:last",e)},first:function(){return this.active&&!this.active.prevAll(".ui-menu-item").length},last:function(){return this.active&&!this.active.nextAll(".ui-menu-item").length},move:function(e,a,b){if(this.active){e=this.active[e+"All"](".ui-menu-item").eq(0);e.length?this.activate(b,e):this.activate(b,this.element.children(a))}else this.activate(b,
this.element.children(a))},nextPage:function(e){if(this.hasScroll())if(!this.active||this.last())this.activate(e,this.element.children(".ui-menu-item:first"));else{var a=this.active.offset().top,b=this.element.height(),g=this.element.children(".ui-menu-item").filter(function(){var c=d(this).offset().top-a-b+d(this).height();return c<10&&c>-10});g.length||(g=this.element.children(".ui-menu-item:last"));this.activate(e,g)}else this.activate(e,this.element.children(".ui-menu-item").filter(!this.active||
this.last()?":first":":last"))},previousPage:function(e){if(this.hasScroll())if(!this.active||this.first())this.activate(e,this.element.children(".ui-menu-item:last"));else{var a=this.active.offset().top,b=this.element.height();result=this.element.children(".ui-menu-item").filter(function(){var g=d(this).offset().top-a+b-d(this).height();return g<10&&g>-10});result.length||(result=this.element.children(".ui-menu-item:first"));this.activate(e,result)}else this.activate(e,this.element.children(".ui-menu-item").filter(!this.active||
this.first()?":last":":first"))},hasScroll:function(){return this.element.height()<this.element[d.fn.prop?"prop":"attr"]("scrollHeight")},select:function(e){this._trigger("selected",e,{item:this.active})}})})(jQuery);
;/*
 * jQuery UI Button 1.8.16
 *
 * Copyright 2011, AUTHORS.txt (http://jqueryui.com/about)
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * http://jquery.org/license
 *
 * http://docs.jquery.com/UI/Button
 *
 * Depends:
 *	jquery.ui.core.js
 *	jquery.ui.widget.js
 */
(function(b){var h,i,j,g,l=function(){var a=b(this).find(":ui-button");setTimeout(function(){a.button("refresh")},1)},k=function(a){var c=a.name,e=a.form,f=b([]);if(c)f=e?b(e).find("[name='"+c+"']"):b("[name='"+c+"']",a.ownerDocument).filter(function(){return!this.form});return f};b.widget("ui.button",{options:{disabled:null,text:true,label:null,icons:{primary:null,secondary:null}},_create:function(){this.element.closest("form").unbind("reset.button").bind("reset.button",l);if(typeof this.options.disabled!==
"boolean")this.options.disabled=this.element.propAttr("disabled");this._determineButtonType();this.hasTitle=!!this.buttonElement.attr("title");var a=this,c=this.options,e=this.type==="checkbox"||this.type==="radio",f="ui-state-hover"+(!e?" ui-state-active":"");if(c.label===null)c.label=this.buttonElement.html();if(this.element.is(":disabled"))c.disabled=true;this.buttonElement.addClass("ui-button ui-widget ui-state-default ui-corner-all").attr("role","button").bind("mouseenter.button",function(){if(!c.disabled){b(this).addClass("ui-state-hover");
this===h&&b(this).addClass("ui-state-active")}}).bind("mouseleave.button",function(){c.disabled||b(this).removeClass(f)}).bind("click.button",function(d){if(c.disabled){d.preventDefault();d.stopImmediatePropagation()}});this.element.bind("focus.button",function(){a.buttonElement.addClass("ui-state-focus")}).bind("blur.button",function(){a.buttonElement.removeClass("ui-state-focus")});if(e){this.element.bind("change.button",function(){g||a.refresh()});this.buttonElement.bind("mousedown.button",function(d){if(!c.disabled){g=
false;i=d.pageX;j=d.pageY}}).bind("mouseup.button",function(d){if(!c.disabled)if(i!==d.pageX||j!==d.pageY)g=true})}if(this.type==="checkbox")this.buttonElement.bind("click.button",function(){if(c.disabled||g)return false;b(this).toggleClass("ui-state-active");a.buttonElement.attr("aria-pressed",a.element[0].checked)});else if(this.type==="radio")this.buttonElement.bind("click.button",function(){if(c.disabled||g)return false;b(this).addClass("ui-state-active");a.buttonElement.attr("aria-pressed","true");
var d=a.element[0];k(d).not(d).map(function(){return b(this).button("widget")[0]}).removeClass("ui-state-active").attr("aria-pressed","false")});else{this.buttonElement.bind("mousedown.button",function(){if(c.disabled)return false;b(this).addClass("ui-state-active");h=this;b(document).one("mouseup",function(){h=null})}).bind("mouseup.button",function(){if(c.disabled)return false;b(this).removeClass("ui-state-active")}).bind("keydown.button",function(d){if(c.disabled)return false;if(d.keyCode==b.ui.keyCode.SPACE||
d.keyCode==b.ui.keyCode.ENTER)b(this).addClass("ui-state-active")}).bind("keyup.button",function(){b(this).removeClass("ui-state-active")});this.buttonElement.is("a")&&this.buttonElement.keyup(function(d){d.keyCode===b.ui.keyCode.SPACE&&b(this).click()})}this._setOption("disabled",c.disabled);this._resetButton()},_determineButtonType:function(){this.type=this.element.is(":checkbox")?"checkbox":this.element.is(":radio")?"radio":this.element.is("input")?"input":"button";if(this.type==="checkbox"||this.type===
"radio"){var a=this.element.parents().filter(":last"),c="label[for='"+this.element.attr("id")+"']";this.buttonElement=a.find(c);if(!this.buttonElement.length){a=a.length?a.siblings():this.element.siblings();this.buttonElement=a.filter(c);if(!this.buttonElement.length)this.buttonElement=a.find(c)}this.element.addClass("ui-helper-hidden-accessible");(a=this.element.is(":checked"))&&this.buttonElement.addClass("ui-state-active");this.buttonElement.attr("aria-pressed",a)}else this.buttonElement=this.element},
widget:function(){return this.buttonElement},destroy:function(){this.element.removeClass("ui-helper-hidden-accessible");this.buttonElement.removeClass("ui-button ui-widget ui-state-default ui-corner-all ui-state-hover ui-state-active  ui-button-icons-only ui-button-icon-only ui-button-text-icons ui-button-text-icon-primary ui-button-text-icon-secondary ui-button-text-only").removeAttr("role").removeAttr("aria-pressed").html(this.buttonElement.find(".ui-button-text").html());this.hasTitle||this.buttonElement.removeAttr("title");
b.Widget.prototype.destroy.call(this)},_setOption:function(a,c){b.Widget.prototype._setOption.apply(this,arguments);if(a==="disabled")c?this.element.propAttr("disabled",true):this.element.propAttr("disabled",false);else this._resetButton()},refresh:function(){var a=this.element.is(":disabled");a!==this.options.disabled&&this._setOption("disabled",a);if(this.type==="radio")k(this.element[0]).each(function(){b(this).is(":checked")?b(this).button("widget").addClass("ui-state-active").attr("aria-pressed",
"true"):b(this).button("widget").removeClass("ui-state-active").attr("aria-pressed","false")});else if(this.type==="checkbox")this.element.is(":checked")?this.buttonElement.addClass("ui-state-active").attr("aria-pressed","true"):this.buttonElement.removeClass("ui-state-active").attr("aria-pressed","false")},_resetButton:function(){if(this.type==="input")this.options.label&&this.element.val(this.options.label);else{var a=this.buttonElement.removeClass("ui-button-icons-only ui-button-icon-only ui-button-text-icons ui-button-text-icon-primary ui-button-text-icon-secondary ui-button-text-only"),
c=b("<span></span>").addClass("ui-button-text").html(this.options.label).appendTo(a.empty()).text(),e=this.options.icons,f=e.primary&&e.secondary,d=[];if(e.primary||e.secondary){if(this.options.text)d.push("ui-button-text-icon"+(f?"s":e.primary?"-primary":"-secondary"));e.primary&&a.prepend("<span class='ui-button-icon-primary ui-icon "+e.primary+"'></span>");e.secondary&&a.append("<span class='ui-button-icon-secondary ui-icon "+e.secondary+"'></span>");if(!this.options.text){d.push(f?"ui-button-icons-only":
"ui-button-icon-only");this.hasTitle||a.attr("title",c)}}else d.push("ui-button-text-only");a.addClass(d.join(" "))}}});b.widget("ui.buttonset",{options:{items:":button, :submit, :reset, :checkbox, :radio, a, :data(button)"},_create:function(){this.element.addClass("ui-buttonset")},_init:function(){this.refresh()},_setOption:function(a,c){a==="disabled"&&this.buttons.button("option",a,c);b.Widget.prototype._setOption.apply(this,arguments)},refresh:function(){var a=this.element.css("direction")===
"ltr";this.buttons=this.element.find(this.options.items).filter(":ui-button").button("refresh").end().not(":ui-button").button().end().map(function(){return b(this).button("widget")[0]}).removeClass("ui-corner-all ui-corner-left ui-corner-right").filter(":first").addClass(a?"ui-corner-left":"ui-corner-right").end().filter(":last").addClass(a?"ui-corner-right":"ui-corner-left").end().end()},destroy:function(){this.element.removeClass("ui-buttonset");this.buttons.map(function(){return b(this).button("widget")[0]}).removeClass("ui-corner-left ui-corner-right").end().button("destroy");
b.Widget.prototype.destroy.call(this)}})})(jQuery);
;/*
 * jQuery UI Dialog 1.8.16
 *
 * Copyright 2011, AUTHORS.txt (http://jqueryui.com/about)
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * http://jquery.org/license
 *
 * http://docs.jquery.com/UI/Dialog
 *
 * Depends:
 *	jquery.ui.core.js
 *	jquery.ui.widget.js
 *  jquery.ui.button.js
 *	jquery.ui.draggable.js
 *	jquery.ui.mouse.js
 *	jquery.ui.position.js
 *	jquery.ui.resizable.js
 */
(function(c,l){var m={buttons:true,height:true,maxHeight:true,maxWidth:true,minHeight:true,minWidth:true,width:true},n={maxHeight:true,maxWidth:true,minHeight:true,minWidth:true},o=c.attrFn||{val:true,css:true,html:true,text:true,data:true,width:true,height:true,offset:true,click:true};c.widget("ui.dialog",{options:{autoOpen:true,buttons:{},closeOnEscape:true,closeText:"close",dialogClass:"",draggable:true,hide:null,height:"auto",maxHeight:false,maxWidth:false,minHeight:150,minWidth:150,modal:false,
position:{my:"center",at:"center",collision:"fit",using:function(a){var b=c(this).css(a).offset().top;b<0&&c(this).css("top",a.top-b)}},resizable:true,show:null,stack:true,title:"",width:300,zIndex:1E3},_create:function(){this.originalTitle=this.element.attr("title");if(typeof this.originalTitle!=="string")this.originalTitle="";this.options.title=this.options.title||this.originalTitle;var a=this,b=a.options,d=b.title||"&#160;",e=c.ui.dialog.getTitleId(a.element),g=(a.uiDialog=c("<div></div>")).appendTo(document.body).hide().addClass("ui-dialog ui-widget ui-widget-content ui-corner-all "+
b.dialogClass).css({zIndex:b.zIndex}).attr("tabIndex",-1).css("outline",0).keydown(function(i){if(b.closeOnEscape&&!i.isDefaultPrevented()&&i.keyCode&&i.keyCode===c.ui.keyCode.ESCAPE){a.close(i);i.preventDefault()}}).attr({role:"dialog","aria-labelledby":e}).mousedown(function(i){a.moveToTop(false,i)});a.element.show().removeAttr("title").addClass("ui-dialog-content ui-widget-content").appendTo(g);var f=(a.uiDialogTitlebar=c("<div></div>")).addClass("ui-dialog-titlebar ui-widget-header ui-corner-all ui-helper-clearfix").prependTo(g),
h=c('<a href="#"></a>').addClass("ui-dialog-titlebar-close ui-corner-all").attr("role","button").hover(function(){h.addClass("ui-state-hover")},function(){h.removeClass("ui-state-hover")}).focus(function(){h.addClass("ui-state-focus")}).blur(function(){h.removeClass("ui-state-focus")}).click(function(i){a.close(i);return false}).appendTo(f);(a.uiDialogTitlebarCloseText=c("<span></span>")).addClass("ui-icon ui-icon-closethick").text(b.closeText).appendTo(h);c("<span></span>").addClass("ui-dialog-title").attr("id",
e).html(d).prependTo(f);if(c.isFunction(b.beforeclose)&&!c.isFunction(b.beforeClose))b.beforeClose=b.beforeclose;f.find("*").add(f).disableSelection();b.draggable&&c.fn.draggable&&a._makeDraggable();b.resizable&&c.fn.resizable&&a._makeResizable();a._createButtons(b.buttons);a._isOpen=false;c.fn.bgiframe&&g.bgiframe()},_init:function(){this.options.autoOpen&&this.open()},destroy:function(){var a=this;a.overlay&&a.overlay.destroy();a.uiDialog.hide();a.element.unbind(".dialog").removeData("dialog").removeClass("ui-dialog-content ui-widget-content").hide().appendTo("body");
a.uiDialog.remove();a.originalTitle&&a.element.attr("title",a.originalTitle);return a},widget:function(){return this.uiDialog},close:function(a){var b=this,d,e;if(false!==b._trigger("beforeClose",a)){b.overlay&&b.overlay.destroy();b.uiDialog.unbind("keypress.ui-dialog");b._isOpen=false;if(b.options.hide)b.uiDialog.hide(b.options.hide,function(){b._trigger("close",a)});else{b.uiDialog.hide();b._trigger("close",a)}c.ui.dialog.overlay.resize();if(b.options.modal){d=0;c(".ui-dialog").each(function(){if(this!==
b.uiDialog[0]){e=c(this).css("z-index");isNaN(e)||(d=Math.max(d,e))}});c.ui.dialog.maxZ=d}return b}},isOpen:function(){return this._isOpen},moveToTop:function(a,b){var d=this,e=d.options;if(e.modal&&!a||!e.stack&&!e.modal)return d._trigger("focus",b);if(e.zIndex>c.ui.dialog.maxZ)c.ui.dialog.maxZ=e.zIndex;if(d.overlay){c.ui.dialog.maxZ+=1;d.overlay.$el.css("z-index",c.ui.dialog.overlay.maxZ=c.ui.dialog.maxZ)}a={scrollTop:d.element.scrollTop(),scrollLeft:d.element.scrollLeft()};c.ui.dialog.maxZ+=1;
d.uiDialog.css("z-index",c.ui.dialog.maxZ);d.element.attr(a);d._trigger("focus",b);return d},open:function(){if(!this._isOpen){var a=this,b=a.options,d=a.uiDialog;a.overlay=b.modal?new c.ui.dialog.overlay(a):null;a._size();a._position(b.position);d.show(b.show);a.moveToTop(true);b.modal&&d.bind("keypress.ui-dialog",function(e){if(e.keyCode===c.ui.keyCode.TAB){var g=c(":tabbable",this),f=g.filter(":first");g=g.filter(":last");if(e.target===g[0]&&!e.shiftKey){f.focus(1);return false}else if(e.target===
f[0]&&e.shiftKey){g.focus(1);return false}}});c(a.element.find(":tabbable").get().concat(d.find(".ui-dialog-buttonpane :tabbable").get().concat(d.get()))).eq(0).focus();a._isOpen=true;a._trigger("open");return a}},_createButtons:function(a){var b=this,d=false,e=c("<div></div>").addClass("ui-dialog-buttonpane ui-widget-content ui-helper-clearfix"),g=c("<div></div>").addClass("ui-dialog-buttonset").appendTo(e);b.uiDialog.find(".ui-dialog-buttonpane").remove();typeof a==="object"&&a!==null&&c.each(a,
function(){return!(d=true)});if(d){c.each(a,function(f,h){h=c.isFunction(h)?{click:h,text:f}:h;var i=c('<button type="button"></button>').click(function(){h.click.apply(b.element[0],arguments)}).appendTo(g);c.each(h,function(j,k){if(j!=="click")j in o?i[j](k):i.attr(j,k)});c.fn.button&&i.button()});e.appendTo(b.uiDialog)}},_makeDraggable:function(){function a(f){return{position:f.position,offset:f.offset}}var b=this,d=b.options,e=c(document),g;b.uiDialog.draggable({cancel:".ui-dialog-content, .ui-dialog-titlebar-close",
handle:".ui-dialog-titlebar",containment:"document",start:function(f,h){g=d.height==="auto"?"auto":c(this).height();c(this).height(c(this).height()).addClass("ui-dialog-dragging");b._trigger("dragStart",f,a(h))},drag:function(f,h){b._trigger("drag",f,a(h))},stop:function(f,h){d.position=[h.position.left-e.scrollLeft(),h.position.top-e.scrollTop()];c(this).removeClass("ui-dialog-dragging").height(g);b._trigger("dragStop",f,a(h));c.ui.dialog.overlay.resize()}})},_makeResizable:function(a){function b(f){return{originalPosition:f.originalPosition,
originalSize:f.originalSize,position:f.position,size:f.size}}a=a===l?this.options.resizable:a;var d=this,e=d.options,g=d.uiDialog.css("position");a=typeof a==="string"?a:"n,e,s,w,se,sw,ne,nw";d.uiDialog.resizable({cancel:".ui-dialog-content",containment:"document",alsoResize:d.element,maxWidth:e.maxWidth,maxHeight:e.maxHeight,minWidth:e.minWidth,minHeight:d._minHeight(),handles:a,start:function(f,h){c(this).addClass("ui-dialog-resizing");d._trigger("resizeStart",f,b(h))},resize:function(f,h){d._trigger("resize",
f,b(h))},stop:function(f,h){c(this).removeClass("ui-dialog-resizing");e.height=c(this).height();e.width=c(this).width();d._trigger("resizeStop",f,b(h));c.ui.dialog.overlay.resize()}}).css("position",g).find(".ui-resizable-se").addClass("ui-icon ui-icon-grip-diagonal-se")},_minHeight:function(){var a=this.options;return a.height==="auto"?a.minHeight:Math.min(a.minHeight,a.height)},_position:function(a){var b=[],d=[0,0],e;if(a){if(typeof a==="string"||typeof a==="object"&&"0"in a){b=a.split?a.split(" "):
[a[0],a[1]];if(b.length===1)b[1]=b[0];c.each(["left","top"],function(g,f){if(+b[g]===b[g]){d[g]=b[g];b[g]=f}});a={my:b.join(" "),at:b.join(" "),offset:d.join(" ")}}a=c.extend({},c.ui.dialog.prototype.options.position,a)}else a=c.ui.dialog.prototype.options.position;(e=this.uiDialog.is(":visible"))||this.uiDialog.show();this.uiDialog.css({top:0,left:0}).position(c.extend({of:window},a));e||this.uiDialog.hide()},_setOptions:function(a){var b=this,d={},e=false;c.each(a,function(g,f){b._setOption(g,f);
if(g in m)e=true;if(g in n)d[g]=f});e&&this._size();this.uiDialog.is(":data(resizable)")&&this.uiDialog.resizable("option",d)},_setOption:function(a,b){var d=this,e=d.uiDialog;switch(a){case "beforeclose":a="beforeClose";break;case "buttons":d._createButtons(b);break;case "closeText":d.uiDialogTitlebarCloseText.text(""+b);break;case "dialogClass":e.removeClass(d.options.dialogClass).addClass("ui-dialog ui-widget ui-widget-content ui-corner-all "+b);break;case "disabled":b?e.addClass("ui-dialog-disabled"):
e.removeClass("ui-dialog-disabled");break;case "draggable":var g=e.is(":data(draggable)");g&&!b&&e.draggable("destroy");!g&&b&&d._makeDraggable();break;case "position":d._position(b);break;case "resizable":(g=e.is(":data(resizable)"))&&!b&&e.resizable("destroy");g&&typeof b==="string"&&e.resizable("option","handles",b);!g&&b!==false&&d._makeResizable(b);break;case "title":c(".ui-dialog-title",d.uiDialogTitlebar).html(""+(b||"&#160;"));break}c.Widget.prototype._setOption.apply(d,arguments)},_size:function(){var a=
this.options,b,d,e=this.uiDialog.is(":visible");this.element.show().css({width:"auto",minHeight:0,height:0});if(a.minWidth>a.width)a.width=a.minWidth;b=this.uiDialog.css({height:"auto",width:a.width}).height();d=Math.max(0,a.minHeight-b);if(a.height==="auto")if(c.support.minHeight)this.element.css({minHeight:d,height:"auto"});else{this.uiDialog.show();a=this.element.css("height","auto").height();e||this.uiDialog.hide();this.element.height(Math.max(a,d))}else this.element.height(Math.max(a.height-
b,0));this.uiDialog.is(":data(resizable)")&&this.uiDialog.resizable("option","minHeight",this._minHeight())}});c.extend(c.ui.dialog,{version:"1.8.16",uuid:0,maxZ:0,getTitleId:function(a){a=a.attr("id");if(!a){this.uuid+=1;a=this.uuid}return"ui-dialog-title-"+a},overlay:function(a){this.$el=c.ui.dialog.overlay.create(a)}});c.extend(c.ui.dialog.overlay,{instances:[],oldInstances:[],maxZ:0,events:c.map("focus,mousedown,mouseup,keydown,keypress,click".split(","),function(a){return a+".dialog-overlay"}).join(" "),
create:function(a){if(this.instances.length===0){setTimeout(function(){c.ui.dialog.overlay.instances.length&&c(document).bind(c.ui.dialog.overlay.events,function(d){if(c(d.target).zIndex()<c.ui.dialog.overlay.maxZ)return false})},1);c(document).bind("keydown.dialog-overlay",function(d){if(a.options.closeOnEscape&&!d.isDefaultPrevented()&&d.keyCode&&d.keyCode===c.ui.keyCode.ESCAPE){a.close(d);d.preventDefault()}});c(window).bind("resize.dialog-overlay",c.ui.dialog.overlay.resize)}var b=(this.oldInstances.pop()||
c("<div></div>").addClass("ui-widget-overlay")).appendTo(document.body).css({width:this.width(),height:this.height()});c.fn.bgiframe&&b.bgiframe();this.instances.push(b);return b},destroy:function(a){var b=c.inArray(a,this.instances);b!=-1&&this.oldInstances.push(this.instances.splice(b,1)[0]);this.instances.length===0&&c([document,window]).unbind(".dialog-overlay");a.remove();var d=0;c.each(this.instances,function(){d=Math.max(d,this.css("z-index"))});this.maxZ=d},height:function(){var a,b;if(c.browser.msie&&
c.browser.version<7){a=Math.max(document.documentElement.scrollHeight,document.body.scrollHeight);b=Math.max(document.documentElement.offsetHeight,document.body.offsetHeight);return a<b?c(window).height()+"px":a+"px"}else return c(document).height()+"px"},width:function(){var a,b;if(c.browser.msie){a=Math.max(document.documentElement.scrollWidth,document.body.scrollWidth);b=Math.max(document.documentElement.offsetWidth,document.body.offsetWidth);return a<b?c(window).width()+"px":a+"px"}else return c(document).width()+
"px"},resize:function(){var a=c([]);c.each(c.ui.dialog.overlay.instances,function(){a=a.add(this)});a.css({width:0,height:0}).css({width:c.ui.dialog.overlay.width(),height:c.ui.dialog.overlay.height()})}});c.extend(c.ui.dialog.overlay.prototype,{destroy:function(){c.ui.dialog.overlay.destroy(this.$el)}})})(jQuery);
;/*
 * jQuery UI Slider 1.8.16
 *
 * Copyright 2011, AUTHORS.txt (http://jqueryui.com/about)
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * http://jquery.org/license
 *
 * http://docs.jquery.com/UI/Slider
 *
 * Depends:
 *	jquery.ui.core.js
 *	jquery.ui.mouse.js
 *	jquery.ui.widget.js
 */
(function(d){d.widget("ui.slider",d.ui.mouse,{widgetEventPrefix:"slide",options:{animate:false,distance:0,max:100,min:0,orientation:"horizontal",range:false,step:1,value:0,values:null},_create:function(){var a=this,b=this.options,c=this.element.find(".ui-slider-handle").addClass("ui-state-default ui-corner-all"),f=b.values&&b.values.length||1,e=[];this._mouseSliding=this._keySliding=false;this._animateOff=true;this._handleIndex=null;this._detectOrientation();this._mouseInit();this.element.addClass("ui-slider ui-slider-"+
this.orientation+" ui-widget ui-widget-content ui-corner-all"+(b.disabled?" ui-slider-disabled ui-disabled":""));this.range=d([]);if(b.range){if(b.range===true){if(!b.values)b.values=[this._valueMin(),this._valueMin()];if(b.values.length&&b.values.length!==2)b.values=[b.values[0],b.values[0]]}this.range=d("<div></div>").appendTo(this.element).addClass("ui-slider-range ui-widget-header"+(b.range==="min"||b.range==="max"?" ui-slider-range-"+b.range:""))}for(var j=c.length;j<f;j+=1)e.push("<a class='ui-slider-handle ui-state-default ui-corner-all' href='#'></a>");
this.handles=c.add(d(e.join("")).appendTo(a.element));this.handle=this.handles.eq(0);this.handles.add(this.range).filter("a").click(function(g){g.preventDefault()}).hover(function(){b.disabled||d(this).addClass("ui-state-hover")},function(){d(this).removeClass("ui-state-hover")}).focus(function(){if(b.disabled)d(this).blur();else{d(".ui-slider .ui-state-focus").removeClass("ui-state-focus");d(this).addClass("ui-state-focus")}}).blur(function(){d(this).removeClass("ui-state-focus")});this.handles.each(function(g){d(this).data("index.ui-slider-handle",
g)});this.handles.keydown(function(g){var k=true,l=d(this).data("index.ui-slider-handle"),i,h,m;if(!a.options.disabled){switch(g.keyCode){case d.ui.keyCode.HOME:case d.ui.keyCode.END:case d.ui.keyCode.PAGE_UP:case d.ui.keyCode.PAGE_DOWN:case d.ui.keyCode.UP:case d.ui.keyCode.RIGHT:case d.ui.keyCode.DOWN:case d.ui.keyCode.LEFT:k=false;if(!a._keySliding){a._keySliding=true;d(this).addClass("ui-state-active");i=a._start(g,l);if(i===false)return}break}m=a.options.step;i=a.options.values&&a.options.values.length?
(h=a.values(l)):(h=a.value());switch(g.keyCode){case d.ui.keyCode.HOME:h=a._valueMin();break;case d.ui.keyCode.END:h=a._valueMax();break;case d.ui.keyCode.PAGE_UP:h=a._trimAlignValue(i+(a._valueMax()-a._valueMin())/5);break;case d.ui.keyCode.PAGE_DOWN:h=a._trimAlignValue(i-(a._valueMax()-a._valueMin())/5);break;case d.ui.keyCode.UP:case d.ui.keyCode.RIGHT:if(i===a._valueMax())return;h=a._trimAlignValue(i+m);break;case d.ui.keyCode.DOWN:case d.ui.keyCode.LEFT:if(i===a._valueMin())return;h=a._trimAlignValue(i-
m);break}a._slide(g,l,h);return k}}).keyup(function(g){var k=d(this).data("index.ui-slider-handle");if(a._keySliding){a._keySliding=false;a._stop(g,k);a._change(g,k);d(this).removeClass("ui-state-active")}});this._refreshValue();this._animateOff=false},destroy:function(){this.handles.remove();this.range.remove();this.element.removeClass("ui-slider ui-slider-horizontal ui-slider-vertical ui-slider-disabled ui-widget ui-widget-content ui-corner-all").removeData("slider").unbind(".slider");this._mouseDestroy();
return this},_mouseCapture:function(a){var b=this.options,c,f,e,j,g;if(b.disabled)return false;this.elementSize={width:this.element.outerWidth(),height:this.element.outerHeight()};this.elementOffset=this.element.offset();c=this._normValueFromMouse({x:a.pageX,y:a.pageY});f=this._valueMax()-this._valueMin()+1;j=this;this.handles.each(function(k){var l=Math.abs(c-j.values(k));if(f>l){f=l;e=d(this);g=k}});if(b.range===true&&this.values(1)===b.min){g+=1;e=d(this.handles[g])}if(this._start(a,g)===false)return false;
this._mouseSliding=true;j._handleIndex=g;e.addClass("ui-state-active").focus();b=e.offset();this._clickOffset=!d(a.target).parents().andSelf().is(".ui-slider-handle")?{left:0,top:0}:{left:a.pageX-b.left-e.width()/2,top:a.pageY-b.top-e.height()/2-(parseInt(e.css("borderTopWidth"),10)||0)-(parseInt(e.css("borderBottomWidth"),10)||0)+(parseInt(e.css("marginTop"),10)||0)};this.handles.hasClass("ui-state-hover")||this._slide(a,g,c);return this._animateOff=true},_mouseStart:function(){return true},_mouseDrag:function(a){var b=
this._normValueFromMouse({x:a.pageX,y:a.pageY});this._slide(a,this._handleIndex,b);return false},_mouseStop:function(a){this.handles.removeClass("ui-state-active");this._mouseSliding=false;this._stop(a,this._handleIndex);this._change(a,this._handleIndex);this._clickOffset=this._handleIndex=null;return this._animateOff=false},_detectOrientation:function(){this.orientation=this.options.orientation==="vertical"?"vertical":"horizontal"},_normValueFromMouse:function(a){var b;if(this.orientation==="horizontal"){b=
this.elementSize.width;a=a.x-this.elementOffset.left-(this._clickOffset?this._clickOffset.left:0)}else{b=this.elementSize.height;a=a.y-this.elementOffset.top-(this._clickOffset?this._clickOffset.top:0)}b=a/b;if(b>1)b=1;if(b<0)b=0;if(this.orientation==="vertical")b=1-b;a=this._valueMax()-this._valueMin();return this._trimAlignValue(this._valueMin()+b*a)},_start:function(a,b){var c={handle:this.handles[b],value:this.value()};if(this.options.values&&this.options.values.length){c.value=this.values(b);
c.values=this.values()}return this._trigger("start",a,c)},_slide:function(a,b,c){var f;if(this.options.values&&this.options.values.length){f=this.values(b?0:1);if(this.options.values.length===2&&this.options.range===true&&(b===0&&c>f||b===1&&c<f))c=f;if(c!==this.values(b)){f=this.values();f[b]=c;a=this._trigger("slide",a,{handle:this.handles[b],value:c,values:f});this.values(b?0:1);a!==false&&this.values(b,c,true)}}else if(c!==this.value()){a=this._trigger("slide",a,{handle:this.handles[b],value:c});
a!==false&&this.value(c)}},_stop:function(a,b){var c={handle:this.handles[b],value:this.value()};if(this.options.values&&this.options.values.length){c.value=this.values(b);c.values=this.values()}this._trigger("stop",a,c)},_change:function(a,b){if(!this._keySliding&&!this._mouseSliding){var c={handle:this.handles[b],value:this.value()};if(this.options.values&&this.options.values.length){c.value=this.values(b);c.values=this.values()}this._trigger("change",a,c)}},value:function(a){if(arguments.length){this.options.value=
this._trimAlignValue(a);this._refreshValue();this._change(null,0)}else return this._value()},values:function(a,b){var c,f,e;if(arguments.length>1){this.options.values[a]=this._trimAlignValue(b);this._refreshValue();this._change(null,a)}else if(arguments.length)if(d.isArray(arguments[0])){c=this.options.values;f=arguments[0];for(e=0;e<c.length;e+=1){c[e]=this._trimAlignValue(f[e]);this._change(null,e)}this._refreshValue()}else return this.options.values&&this.options.values.length?this._values(a):
this.value();else return this._values()},_setOption:function(a,b){var c,f=0;if(d.isArray(this.options.values))f=this.options.values.length;d.Widget.prototype._setOption.apply(this,arguments);switch(a){case "disabled":if(b){this.handles.filter(".ui-state-focus").blur();this.handles.removeClass("ui-state-hover");this.handles.propAttr("disabled",true);this.element.addClass("ui-disabled")}else{this.handles.propAttr("disabled",false);this.element.removeClass("ui-disabled")}break;case "orientation":this._detectOrientation();
this.element.removeClass("ui-slider-horizontal ui-slider-vertical").addClass("ui-slider-"+this.orientation);this._refreshValue();break;case "value":this._animateOff=true;this._refreshValue();this._change(null,0);this._animateOff=false;break;case "values":this._animateOff=true;this._refreshValue();for(c=0;c<f;c+=1)this._change(null,c);this._animateOff=false;break}},_value:function(){var a=this.options.value;return a=this._trimAlignValue(a)},_values:function(a){var b,c;if(arguments.length){b=this.options.values[a];
return b=this._trimAlignValue(b)}else{b=this.options.values.slice();for(c=0;c<b.length;c+=1)b[c]=this._trimAlignValue(b[c]);return b}},_trimAlignValue:function(a){if(a<=this._valueMin())return this._valueMin();if(a>=this._valueMax())return this._valueMax();var b=this.options.step>0?this.options.step:1,c=(a-this._valueMin())%b;a=a-c;if(Math.abs(c)*2>=b)a+=c>0?b:-b;return parseFloat(a.toFixed(5))},_valueMin:function(){return this.options.min},_valueMax:function(){return this.options.max},_refreshValue:function(){var a=
this.options.range,b=this.options,c=this,f=!this._animateOff?b.animate:false,e,j={},g,k,l,i;if(this.options.values&&this.options.values.length)this.handles.each(function(h){e=(c.values(h)-c._valueMin())/(c._valueMax()-c._valueMin())*100;j[c.orientation==="horizontal"?"left":"bottom"]=e+"%";d(this).stop(1,1)[f?"animate":"css"](j,b.animate);if(c.options.range===true)if(c.orientation==="horizontal"){if(h===0)c.range.stop(1,1)[f?"animate":"css"]({left:e+"%"},b.animate);if(h===1)c.range[f?"animate":"css"]({width:e-
g+"%"},{queue:false,duration:b.animate})}else{if(h===0)c.range.stop(1,1)[f?"animate":"css"]({bottom:e+"%"},b.animate);if(h===1)c.range[f?"animate":"css"]({height:e-g+"%"},{queue:false,duration:b.animate})}g=e});else{k=this.value();l=this._valueMin();i=this._valueMax();e=i!==l?(k-l)/(i-l)*100:0;j[c.orientation==="horizontal"?"left":"bottom"]=e+"%";this.handle.stop(1,1)[f?"animate":"css"](j,b.animate);if(a==="min"&&this.orientation==="horizontal")this.range.stop(1,1)[f?"animate":"css"]({width:e+"%"},
b.animate);if(a==="max"&&this.orientation==="horizontal")this.range[f?"animate":"css"]({width:100-e+"%"},{queue:false,duration:b.animate});if(a==="min"&&this.orientation==="vertical")this.range.stop(1,1)[f?"animate":"css"]({height:e+"%"},b.animate);if(a==="max"&&this.orientation==="vertical")this.range[f?"animate":"css"]({height:100-e+"%"},{queue:false,duration:b.animate})}}});d.extend(d.ui.slider,{version:"1.8.16"})})(jQuery);
;/*
 * jQuery UI Tabs 1.8.16
 *
 * Copyright 2011, AUTHORS.txt (http://jqueryui.com/about)
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * http://jquery.org/license
 *
 * http://docs.jquery.com/UI/Tabs
 *
 * Depends:
 *	jquery.ui.core.js
 *	jquery.ui.widget.js
 */
(function(d,p){function u(){return++v}function w(){return++x}var v=0,x=0;d.widget("ui.tabs",{options:{add:null,ajaxOptions:null,cache:false,cookie:null,collapsible:false,disable:null,disabled:[],enable:null,event:"click",fx:null,idPrefix:"ui-tabs-",load:null,panelTemplate:"<div></div>",remove:null,select:null,show:null,spinner:"<em>Loading&#8230;</em>",tabTemplate:"<li><a href='#{href}'><span>#{label}</span></a></li>"},_create:function(){this._tabify(true)},_setOption:function(b,e){if(b=="selected")this.options.collapsible&&
e==this.options.selected||this.select(e);else{this.options[b]=e;this._tabify()}},_tabId:function(b){return b.title&&b.title.replace(/\s/g,"_").replace(/[^\w\u00c0-\uFFFF-]/g,"")||this.options.idPrefix+u()},_sanitizeSelector:function(b){return b.replace(/:/g,"\\:")},_cookie:function(){var b=this.cookie||(this.cookie=this.options.cookie.name||"ui-tabs-"+w());return d.cookie.apply(null,[b].concat(d.makeArray(arguments)))},_ui:function(b,e){return{tab:b,panel:e,index:this.anchors.index(b)}},_cleanup:function(){this.lis.filter(".ui-state-processing").removeClass("ui-state-processing").find("span:data(label.tabs)").each(function(){var b=
d(this);b.html(b.data("label.tabs")).removeData("label.tabs")})},_tabify:function(b){function e(g,f){g.css("display","");!d.support.opacity&&f.opacity&&g[0].style.removeAttribute("filter")}var a=this,c=this.options,h=/^#.+/;this.list=this.element.find("ol,ul").eq(0);this.lis=d(" > li:has(a[href])",this.list);this.anchors=this.lis.map(function(){return d("a",this)[0]});this.panels=d([]);this.anchors.each(function(g,f){var i=d(f).attr("href"),l=i.split("#")[0],q;if(l&&(l===location.toString().split("#")[0]||
(q=d("base")[0])&&l===q.href)){i=f.hash;f.href=i}if(h.test(i))a.panels=a.panels.add(a.element.find(a._sanitizeSelector(i)));else if(i&&i!=="#"){d.data(f,"href.tabs",i);d.data(f,"load.tabs",i.replace(/#.*$/,""));i=a._tabId(f);f.href="#"+i;f=a.element.find("#"+i);if(!f.length){f=d(c.panelTemplate).attr("id",i).addClass("ui-tabs-panel ui-widget-content ui-corner-bottom").insertAfter(a.panels[g-1]||a.list);f.data("destroy.tabs",true)}a.panels=a.panels.add(f)}else c.disabled.push(g)});if(b){this.element.addClass("ui-tabs ui-widget ui-widget-content ui-corner-all");
this.list.addClass("ui-tabs-nav ui-helper-reset ui-helper-clearfix ui-widget-header ui-corner-all");this.lis.addClass("ui-state-default ui-corner-top");this.panels.addClass("ui-tabs-panel ui-widget-content ui-corner-bottom");if(c.selected===p){location.hash&&this.anchors.each(function(g,f){if(f.hash==location.hash){c.selected=g;return false}});if(typeof c.selected!=="number"&&c.cookie)c.selected=parseInt(a._cookie(),10);if(typeof c.selected!=="number"&&this.lis.filter(".ui-tabs-selected").length)c.selected=
this.lis.index(this.lis.filter(".ui-tabs-selected"));c.selected=c.selected||(this.lis.length?0:-1)}else if(c.selected===null)c.selected=-1;c.selected=c.selected>=0&&this.anchors[c.selected]||c.selected<0?c.selected:0;c.disabled=d.unique(c.disabled.concat(d.map(this.lis.filter(".ui-state-disabled"),function(g){return a.lis.index(g)}))).sort();d.inArray(c.selected,c.disabled)!=-1&&c.disabled.splice(d.inArray(c.selected,c.disabled),1);this.panels.addClass("ui-tabs-hide");this.lis.removeClass("ui-tabs-selected ui-state-active");
if(c.selected>=0&&this.anchors.length){a.element.find(a._sanitizeSelector(a.anchors[c.selected].hash)).removeClass("ui-tabs-hide");this.lis.eq(c.selected).addClass("ui-tabs-selected ui-state-active");a.element.queue("tabs",function(){a._trigger("show",null,a._ui(a.anchors[c.selected],a.element.find(a._sanitizeSelector(a.anchors[c.selected].hash))[0]))});this.load(c.selected)}d(window).bind("unload",function(){a.lis.add(a.anchors).unbind(".tabs");a.lis=a.anchors=a.panels=null})}else c.selected=this.lis.index(this.lis.filter(".ui-tabs-selected"));
this.element[c.collapsible?"addClass":"removeClass"]("ui-tabs-collapsible");c.cookie&&this._cookie(c.selected,c.cookie);b=0;for(var j;j=this.lis[b];b++)d(j)[d.inArray(b,c.disabled)!=-1&&!d(j).hasClass("ui-tabs-selected")?"addClass":"removeClass"]("ui-state-disabled");c.cache===false&&this.anchors.removeData("cache.tabs");this.lis.add(this.anchors).unbind(".tabs");if(c.event!=="mouseover"){var k=function(g,f){f.is(":not(.ui-state-disabled)")&&f.addClass("ui-state-"+g)},n=function(g,f){f.removeClass("ui-state-"+
g)};this.lis.bind("mouseover.tabs",function(){k("hover",d(this))});this.lis.bind("mouseout.tabs",function(){n("hover",d(this))});this.anchors.bind("focus.tabs",function(){k("focus",d(this).closest("li"))});this.anchors.bind("blur.tabs",function(){n("focus",d(this).closest("li"))})}var m,o;if(c.fx)if(d.isArray(c.fx)){m=c.fx[0];o=c.fx[1]}else m=o=c.fx;var r=o?function(g,f){d(g).closest("li").addClass("ui-tabs-selected ui-state-active");f.hide().removeClass("ui-tabs-hide").animate(o,o.duration||"normal",
function(){e(f,o);a._trigger("show",null,a._ui(g,f[0]))})}:function(g,f){d(g).closest("li").addClass("ui-tabs-selected ui-state-active");f.removeClass("ui-tabs-hide");a._trigger("show",null,a._ui(g,f[0]))},s=m?function(g,f){f.animate(m,m.duration||"normal",function(){a.lis.removeClass("ui-tabs-selected ui-state-active");f.addClass("ui-tabs-hide");e(f,m);a.element.dequeue("tabs")})}:function(g,f){a.lis.removeClass("ui-tabs-selected ui-state-active");f.addClass("ui-tabs-hide");a.element.dequeue("tabs")};
this.anchors.bind(c.event+".tabs",function(){var g=this,f=d(g).closest("li"),i=a.panels.filter(":not(.ui-tabs-hide)"),l=a.element.find(a._sanitizeSelector(g.hash));if(f.hasClass("ui-tabs-selected")&&!c.collapsible||f.hasClass("ui-state-disabled")||f.hasClass("ui-state-processing")||a.panels.filter(":animated").length||a._trigger("select",null,a._ui(this,l[0]))===false){this.blur();return false}c.selected=a.anchors.index(this);a.abort();if(c.collapsible)if(f.hasClass("ui-tabs-selected")){c.selected=
-1;c.cookie&&a._cookie(c.selected,c.cookie);a.element.queue("tabs",function(){s(g,i)}).dequeue("tabs");this.blur();return false}else if(!i.length){c.cookie&&a._cookie(c.selected,c.cookie);a.element.queue("tabs",function(){r(g,l)});a.load(a.anchors.index(this));this.blur();return false}c.cookie&&a._cookie(c.selected,c.cookie);if(l.length){i.length&&a.element.queue("tabs",function(){s(g,i)});a.element.queue("tabs",function(){r(g,l)});a.load(a.anchors.index(this))}else throw"jQuery UI Tabs: Mismatching fragment identifier.";
d.browser.msie&&this.blur()});this.anchors.bind("click.tabs",function(){return false})},_getIndex:function(b){if(typeof b=="string")b=this.anchors.index(this.anchors.filter("[href$="+b+"]"));return b},destroy:function(){var b=this.options;this.abort();this.element.unbind(".tabs").removeClass("ui-tabs ui-widget ui-widget-content ui-corner-all ui-tabs-collapsible").removeData("tabs");this.list.removeClass("ui-tabs-nav ui-helper-reset ui-helper-clearfix ui-widget-header ui-corner-all");this.anchors.each(function(){var e=
d.data(this,"href.tabs");if(e)this.href=e;var a=d(this).unbind(".tabs");d.each(["href","load","cache"],function(c,h){a.removeData(h+".tabs")})});this.lis.unbind(".tabs").add(this.panels).each(function(){d.data(this,"destroy.tabs")?d(this).remove():d(this).removeClass("ui-state-default ui-corner-top ui-tabs-selected ui-state-active ui-state-hover ui-state-focus ui-state-disabled ui-tabs-panel ui-widget-content ui-corner-bottom ui-tabs-hide")});b.cookie&&this._cookie(null,b.cookie);return this},add:function(b,
e,a){if(a===p)a=this.anchors.length;var c=this,h=this.options;e=d(h.tabTemplate.replace(/#\{href\}/g,b).replace(/#\{label\}/g,e));b=!b.indexOf("#")?b.replace("#",""):this._tabId(d("a",e)[0]);e.addClass("ui-state-default ui-corner-top").data("destroy.tabs",true);var j=c.element.find("#"+b);j.length||(j=d(h.panelTemplate).attr("id",b).data("destroy.tabs",true));j.addClass("ui-tabs-panel ui-widget-content ui-corner-bottom ui-tabs-hide");if(a>=this.lis.length){e.appendTo(this.list);j.appendTo(this.list[0].parentNode)}else{e.insertBefore(this.lis[a]);
j.insertBefore(this.panels[a])}h.disabled=d.map(h.disabled,function(k){return k>=a?++k:k});this._tabify();if(this.anchors.length==1){h.selected=0;e.addClass("ui-tabs-selected ui-state-active");j.removeClass("ui-tabs-hide");this.element.queue("tabs",function(){c._trigger("show",null,c._ui(c.anchors[0],c.panels[0]))});this.load(0)}this._trigger("add",null,this._ui(this.anchors[a],this.panels[a]));return this},remove:function(b){b=this._getIndex(b);var e=this.options,a=this.lis.eq(b).remove(),c=this.panels.eq(b).remove();
if(a.hasClass("ui-tabs-selected")&&this.anchors.length>1)this.select(b+(b+1<this.anchors.length?1:-1));e.disabled=d.map(d.grep(e.disabled,function(h){return h!=b}),function(h){return h>=b?--h:h});this._tabify();this._trigger("remove",null,this._ui(a.find("a")[0],c[0]));return this},enable:function(b){b=this._getIndex(b);var e=this.options;if(d.inArray(b,e.disabled)!=-1){this.lis.eq(b).removeClass("ui-state-disabled");e.disabled=d.grep(e.disabled,function(a){return a!=b});this._trigger("enable",null,
this._ui(this.anchors[b],this.panels[b]));return this}},disable:function(b){b=this._getIndex(b);var e=this.options;if(b!=e.selected){this.lis.eq(b).addClass("ui-state-disabled");e.disabled.push(b);e.disabled.sort();this._trigger("disable",null,this._ui(this.anchors[b],this.panels[b]))}return this},select:function(b){b=this._getIndex(b);if(b==-1)if(this.options.collapsible&&this.options.selected!=-1)b=this.options.selected;else return this;this.anchors.eq(b).trigger(this.options.event+".tabs");return this},
load:function(b){b=this._getIndex(b);var e=this,a=this.options,c=this.anchors.eq(b)[0],h=d.data(c,"load.tabs");this.abort();if(!h||this.element.queue("tabs").length!==0&&d.data(c,"cache.tabs"))this.element.dequeue("tabs");else{this.lis.eq(b).addClass("ui-state-processing");if(a.spinner){var j=d("span",c);j.data("label.tabs",j.html()).html(a.spinner)}this.xhr=d.ajax(d.extend({},a.ajaxOptions,{url:h,success:function(k,n){e.element.find(e._sanitizeSelector(c.hash)).html(k);e._cleanup();a.cache&&d.data(c,
"cache.tabs",true);e._trigger("load",null,e._ui(e.anchors[b],e.panels[b]));try{a.ajaxOptions.success(k,n)}catch(m){}},error:function(k,n){e._cleanup();e._trigger("load",null,e._ui(e.anchors[b],e.panels[b]));try{a.ajaxOptions.error(k,n,b,c)}catch(m){}}}));e.element.dequeue("tabs");return this}},abort:function(){this.element.queue([]);this.panels.stop(false,true);this.element.queue("tabs",this.element.queue("tabs").splice(-2,2));if(this.xhr){this.xhr.abort();delete this.xhr}this._cleanup();return this},
url:function(b,e){this.anchors.eq(b).removeData("cache.tabs").data("load.tabs",e);return this},length:function(){return this.anchors.length}});d.extend(d.ui.tabs,{version:"1.8.16"});d.extend(d.ui.tabs.prototype,{rotation:null,rotate:function(b,e){var a=this,c=this.options,h=a._rotate||(a._rotate=function(j){clearTimeout(a.rotation);a.rotation=setTimeout(function(){var k=c.selected;a.select(++k<a.anchors.length?k:0)},b);j&&j.stopPropagation()});e=a._unrotate||(a._unrotate=!e?function(j){j.clientX&&
a.rotate(null)}:function(){t=c.selected;h()});if(b){this.element.bind("tabsshow",h);this.anchors.bind(c.event+".tabs",e);h()}else{clearTimeout(a.rotation);this.element.unbind("tabsshow",h);this.anchors.unbind(c.event+".tabs",e);delete this._rotate;delete this._unrotate}return this}})})(jQuery);
;/*
 * jQuery UI Datepicker 1.8.16
 *
 * Copyright 2011, AUTHORS.txt (http://jqueryui.com/about)
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * http://jquery.org/license
 *
 * http://docs.jquery.com/UI/Datepicker
 *
 * Depends:
 *	jquery.ui.core.js
 */
(function(d,C){function M(){this.debug=false;this._curInst=null;this._keyEvent=false;this._disabledInputs=[];this._inDialog=this._datepickerShowing=false;this._mainDivId="ui-datepicker-div";this._inlineClass="ui-datepicker-inline";this._appendClass="ui-datepicker-append";this._triggerClass="ui-datepicker-trigger";this._dialogClass="ui-datepicker-dialog";this._disableClass="ui-datepicker-disabled";this._unselectableClass="ui-datepicker-unselectable";this._currentClass="ui-datepicker-current-day";this._dayOverClass=
"ui-datepicker-days-cell-over";this.regional=[];this.regional[""]={closeText:"Done",prevText:"Prev",nextText:"Next",currentText:"Today",monthNames:["January","February","March","April","May","June","July","August","September","October","November","December"],monthNamesShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],dayNames:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],dayNamesShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],dayNamesMin:["Su",
"Mo","Tu","We","Th","Fr","Sa"],weekHeader:"Wk",dateFormat:"mm/dd/yy",firstDay:0,isRTL:false,showMonthAfterYear:false,yearSuffix:""};this._defaults={showOn:"focus",showAnim:"fadeIn",showOptions:{},defaultDate:null,appendText:"",buttonText:"...",buttonImage:"",buttonImageOnly:false,hideIfNoPrevNext:false,navigationAsDateFormat:false,gotoCurrent:false,changeMonth:false,changeYear:false,yearRange:"c-10:c+10",showOtherMonths:false,selectOtherMonths:false,showWeek:false,calculateWeek:this.iso8601Week,shortYearCutoff:"+10",
minDate:null,maxDate:null,duration:"fast",beforeShowDay:null,beforeShow:null,onSelect:null,onChangeMonthYear:null,onClose:null,numberOfMonths:1,showCurrentAtPos:0,stepMonths:1,stepBigMonths:12,altField:"",altFormat:"",constrainInput:true,showButtonPanel:false,autoSize:false,disabled:false};d.extend(this._defaults,this.regional[""]);this.dpDiv=N(d('<div id="'+this._mainDivId+'" class="ui-datepicker ui-widget ui-widget-content ui-helper-clearfix ui-corner-all"></div>'))}function N(a){return a.bind("mouseout",
function(b){b=d(b.target).closest("button, .ui-datepicker-prev, .ui-datepicker-next, .ui-datepicker-calendar td a");b.length&&b.removeClass("ui-state-hover ui-datepicker-prev-hover ui-datepicker-next-hover")}).bind("mouseover",function(b){b=d(b.target).closest("button, .ui-datepicker-prev, .ui-datepicker-next, .ui-datepicker-calendar td a");if(!(d.datepicker._isDisabledDatepicker(J.inline?a.parent()[0]:J.input[0])||!b.length)){b.parents(".ui-datepicker-calendar").find("a").removeClass("ui-state-hover");
b.addClass("ui-state-hover");b.hasClass("ui-datepicker-prev")&&b.addClass("ui-datepicker-prev-hover");b.hasClass("ui-datepicker-next")&&b.addClass("ui-datepicker-next-hover")}})}function H(a,b){d.extend(a,b);for(var c in b)if(b[c]==null||b[c]==C)a[c]=b[c];return a}d.extend(d.ui,{datepicker:{version:"1.8.16"}});var B=(new Date).getTime(),J;d.extend(M.prototype,{markerClassName:"hasDatepicker",maxRows:4,log:function(){this.debug&&console.log.apply("",arguments)},_widgetDatepicker:function(){return this.dpDiv},
setDefaults:function(a){H(this._defaults,a||{});return this},_attachDatepicker:function(a,b){var c=null;for(var e in this._defaults){var f=a.getAttribute("date:"+e);if(f){c=c||{};try{c[e]=eval(f)}catch(h){c[e]=f}}}e=a.nodeName.toLowerCase();f=e=="div"||e=="span";if(!a.id){this.uuid+=1;a.id="dp"+this.uuid}var i=this._newInst(d(a),f);i.settings=d.extend({},b||{},c||{});if(e=="input")this._connectDatepicker(a,i);else f&&this._inlineDatepicker(a,i)},_newInst:function(a,b){return{id:a[0].id.replace(/([^A-Za-z0-9_-])/g,
"\\\\$1"),input:a,selectedDay:0,selectedMonth:0,selectedYear:0,drawMonth:0,drawYear:0,inline:b,dpDiv:!b?this.dpDiv:N(d('<div class="'+this._inlineClass+' ui-datepicker ui-widget ui-widget-content ui-helper-clearfix ui-corner-all"></div>'))}},_connectDatepicker:function(a,b){var c=d(a);b.append=d([]);b.trigger=d([]);if(!c.hasClass(this.markerClassName)){this._attachments(c,b);c.addClass(this.markerClassName).keydown(this._doKeyDown).keypress(this._doKeyPress).keyup(this._doKeyUp).bind("setData.datepicker",
function(e,f,h){b.settings[f]=h}).bind("getData.datepicker",function(e,f){return this._get(b,f)});this._autoSize(b);d.data(a,"datepicker",b);b.settings.disabled&&this._disableDatepicker(a)}},_attachments:function(a,b){var c=this._get(b,"appendText"),e=this._get(b,"isRTL");b.append&&b.append.remove();if(c){b.append=d('<span class="'+this._appendClass+'">'+c+"</span>");a[e?"before":"after"](b.append)}a.unbind("focus",this._showDatepicker);b.trigger&&b.trigger.remove();c=this._get(b,"showOn");if(c==
"focus"||c=="both")a.focus(this._showDatepicker);if(c=="button"||c=="both"){c=this._get(b,"buttonText");var f=this._get(b,"buttonImage");b.trigger=d(this._get(b,"buttonImageOnly")?d("<img/>").addClass(this._triggerClass).attr({src:f,alt:c,title:c}):d('<button type="button"></button>').addClass(this._triggerClass).html(f==""?c:d("<img/>").attr({src:f,alt:c,title:c})));a[e?"before":"after"](b.trigger);b.trigger.click(function(){d.datepicker._datepickerShowing&&d.datepicker._lastInput==a[0]?d.datepicker._hideDatepicker():
d.datepicker._showDatepicker(a[0]);return false})}},_autoSize:function(a){if(this._get(a,"autoSize")&&!a.inline){var b=new Date(2009,11,20),c=this._get(a,"dateFormat");if(c.match(/[DM]/)){var e=function(f){for(var h=0,i=0,g=0;g<f.length;g++)if(f[g].length>h){h=f[g].length;i=g}return i};b.setMonth(e(this._get(a,c.match(/MM/)?"monthNames":"monthNamesShort")));b.setDate(e(this._get(a,c.match(/DD/)?"dayNames":"dayNamesShort"))+20-b.getDay())}a.input.attr("size",this._formatDate(a,b).length)}},_inlineDatepicker:function(a,
b){var c=d(a);if(!c.hasClass(this.markerClassName)){c.addClass(this.markerClassName).append(b.dpDiv).bind("setData.datepicker",function(e,f,h){b.settings[f]=h}).bind("getData.datepicker",function(e,f){return this._get(b,f)});d.data(a,"datepicker",b);this._setDate(b,this._getDefaultDate(b),true);this._updateDatepicker(b);this._updateAlternate(b);b.settings.disabled&&this._disableDatepicker(a);b.dpDiv.css("display","block")}},_dialogDatepicker:function(a,b,c,e,f){a=this._dialogInst;if(!a){this.uuid+=
1;this._dialogInput=d('<input type="text" id="'+("dp"+this.uuid)+'" style="position: absolute; top: -100px; width: 0px; z-index: -10;"/>');this._dialogInput.keydown(this._doKeyDown);d("body").append(this._dialogInput);a=this._dialogInst=this._newInst(this._dialogInput,false);a.settings={};d.data(this._dialogInput[0],"datepicker",a)}H(a.settings,e||{});b=b&&b.constructor==Date?this._formatDate(a,b):b;this._dialogInput.val(b);this._pos=f?f.length?f:[f.pageX,f.pageY]:null;if(!this._pos)this._pos=[document.documentElement.clientWidth/
2-100+(document.documentElement.scrollLeft||document.body.scrollLeft),document.documentElement.clientHeight/2-150+(document.documentElement.scrollTop||document.body.scrollTop)];this._dialogInput.css("left",this._pos[0]+20+"px").css("top",this._pos[1]+"px");a.settings.onSelect=c;this._inDialog=true;this.dpDiv.addClass(this._dialogClass);this._showDatepicker(this._dialogInput[0]);d.blockUI&&d.blockUI(this.dpDiv);d.data(this._dialogInput[0],"datepicker",a);return this},_destroyDatepicker:function(a){var b=
d(a),c=d.data(a,"datepicker");if(b.hasClass(this.markerClassName)){var e=a.nodeName.toLowerCase();d.removeData(a,"datepicker");if(e=="input"){c.append.remove();c.trigger.remove();b.removeClass(this.markerClassName).unbind("focus",this._showDatepicker).unbind("keydown",this._doKeyDown).unbind("keypress",this._doKeyPress).unbind("keyup",this._doKeyUp)}else if(e=="div"||e=="span")b.removeClass(this.markerClassName).empty()}},_enableDatepicker:function(a){var b=d(a),c=d.data(a,"datepicker");if(b.hasClass(this.markerClassName)){var e=
a.nodeName.toLowerCase();if(e=="input"){a.disabled=false;c.trigger.filter("button").each(function(){this.disabled=false}).end().filter("img").css({opacity:"1.0",cursor:""})}else if(e=="div"||e=="span"){b=b.children("."+this._inlineClass);b.children().removeClass("ui-state-disabled");b.find("select.ui-datepicker-month, select.ui-datepicker-year").removeAttr("disabled")}this._disabledInputs=d.map(this._disabledInputs,function(f){return f==a?null:f})}},_disableDatepicker:function(a){var b=d(a),c=d.data(a,
"datepicker");if(b.hasClass(this.markerClassName)){var e=a.nodeName.toLowerCase();if(e=="input"){a.disabled=true;c.trigger.filter("button").each(function(){this.disabled=true}).end().filter("img").css({opacity:"0.5",cursor:"default"})}else if(e=="div"||e=="span"){b=b.children("."+this._inlineClass);b.children().addClass("ui-state-disabled");b.find("select.ui-datepicker-month, select.ui-datepicker-year").attr("disabled","disabled")}this._disabledInputs=d.map(this._disabledInputs,function(f){return f==
a?null:f});this._disabledInputs[this._disabledInputs.length]=a}},_isDisabledDatepicker:function(a){if(!a)return false;for(var b=0;b<this._disabledInputs.length;b++)if(this._disabledInputs[b]==a)return true;return false},_getInst:function(a){try{return d.data(a,"datepicker")}catch(b){throw"Missing instance data for this datepicker";}},_optionDatepicker:function(a,b,c){var e=this._getInst(a);if(arguments.length==2&&typeof b=="string")return b=="defaults"?d.extend({},d.datepicker._defaults):e?b=="all"?
d.extend({},e.settings):this._get(e,b):null;var f=b||{};if(typeof b=="string"){f={};f[b]=c}if(e){this._curInst==e&&this._hideDatepicker();var h=this._getDateDatepicker(a,true),i=this._getMinMaxDate(e,"min"),g=this._getMinMaxDate(e,"max");H(e.settings,f);if(i!==null&&f.dateFormat!==C&&f.minDate===C)e.settings.minDate=this._formatDate(e,i);if(g!==null&&f.dateFormat!==C&&f.maxDate===C)e.settings.maxDate=this._formatDate(e,g);this._attachments(d(a),e);this._autoSize(e);this._setDate(e,h);this._updateAlternate(e);
this._updateDatepicker(e)}},_changeDatepicker:function(a,b,c){this._optionDatepicker(a,b,c)},_refreshDatepicker:function(a){(a=this._getInst(a))&&this._updateDatepicker(a)},_setDateDatepicker:function(a,b){if(a=this._getInst(a)){this._setDate(a,b);this._updateDatepicker(a);this._updateAlternate(a)}},_getDateDatepicker:function(a,b){(a=this._getInst(a))&&!a.inline&&this._setDateFromField(a,b);return a?this._getDate(a):null},_doKeyDown:function(a){var b=d.datepicker._getInst(a.target),c=true,e=b.dpDiv.is(".ui-datepicker-rtl");
b._keyEvent=true;if(d.datepicker._datepickerShowing)switch(a.keyCode){case 9:d.datepicker._hideDatepicker();c=false;break;case 13:c=d("td."+d.datepicker._dayOverClass+":not(."+d.datepicker._currentClass+")",b.dpDiv);c[0]&&d.datepicker._selectDay(a.target,b.selectedMonth,b.selectedYear,c[0]);if(a=d.datepicker._get(b,"onSelect")){c=d.datepicker._formatDate(b);a.apply(b.input?b.input[0]:null,[c,b])}else d.datepicker._hideDatepicker();return false;case 27:d.datepicker._hideDatepicker();break;case 33:d.datepicker._adjustDate(a.target,
a.ctrlKey?-d.datepicker._get(b,"stepBigMonths"):-d.datepicker._get(b,"stepMonths"),"M");break;case 34:d.datepicker._adjustDate(a.target,a.ctrlKey?+d.datepicker._get(b,"stepBigMonths"):+d.datepicker._get(b,"stepMonths"),"M");break;case 35:if(a.ctrlKey||a.metaKey)d.datepicker._clearDate(a.target);c=a.ctrlKey||a.metaKey;break;case 36:if(a.ctrlKey||a.metaKey)d.datepicker._gotoToday(a.target);c=a.ctrlKey||a.metaKey;break;case 37:if(a.ctrlKey||a.metaKey)d.datepicker._adjustDate(a.target,e?+1:-1,"D");c=
a.ctrlKey||a.metaKey;if(a.originalEvent.altKey)d.datepicker._adjustDate(a.target,a.ctrlKey?-d.datepicker._get(b,"stepBigMonths"):-d.datepicker._get(b,"stepMonths"),"M");break;case 38:if(a.ctrlKey||a.metaKey)d.datepicker._adjustDate(a.target,-7,"D");c=a.ctrlKey||a.metaKey;break;case 39:if(a.ctrlKey||a.metaKey)d.datepicker._adjustDate(a.target,e?-1:+1,"D");c=a.ctrlKey||a.metaKey;if(a.originalEvent.altKey)d.datepicker._adjustDate(a.target,a.ctrlKey?+d.datepicker._get(b,"stepBigMonths"):+d.datepicker._get(b,
"stepMonths"),"M");break;case 40:if(a.ctrlKey||a.metaKey)d.datepicker._adjustDate(a.target,+7,"D");c=a.ctrlKey||a.metaKey;break;default:c=false}else if(a.keyCode==36&&a.ctrlKey)d.datepicker._showDatepicker(this);else c=false;if(c){a.preventDefault();a.stopPropagation()}},_doKeyPress:function(a){var b=d.datepicker._getInst(a.target);if(d.datepicker._get(b,"constrainInput")){b=d.datepicker._possibleChars(d.datepicker._get(b,"dateFormat"));var c=String.fromCharCode(a.charCode==C?a.keyCode:a.charCode);
return a.ctrlKey||a.metaKey||c<" "||!b||b.indexOf(c)>-1}},_doKeyUp:function(a){a=d.datepicker._getInst(a.target);if(a.input.val()!=a.lastVal)try{if(d.datepicker.parseDate(d.datepicker._get(a,"dateFormat"),a.input?a.input.val():null,d.datepicker._getFormatConfig(a))){d.datepicker._setDateFromField(a);d.datepicker._updateAlternate(a);d.datepicker._updateDatepicker(a)}}catch(b){d.datepicker.log(b)}return true},_showDatepicker:function(a){a=a.target||a;if(a.nodeName.toLowerCase()!="input")a=d("input",
a.parentNode)[0];if(!(d.datepicker._isDisabledDatepicker(a)||d.datepicker._lastInput==a)){var b=d.datepicker._getInst(a);if(d.datepicker._curInst&&d.datepicker._curInst!=b){d.datepicker._datepickerShowing&&d.datepicker._triggerOnClose(d.datepicker._curInst);d.datepicker._curInst.dpDiv.stop(true,true)}var c=d.datepicker._get(b,"beforeShow");c=c?c.apply(a,[a,b]):{};if(c!==false){H(b.settings,c);b.lastVal=null;d.datepicker._lastInput=a;d.datepicker._setDateFromField(b);if(d.datepicker._inDialog)a.value=
"";if(!d.datepicker._pos){d.datepicker._pos=d.datepicker._findPos(a);d.datepicker._pos[1]+=a.offsetHeight}var e=false;d(a).parents().each(function(){e|=d(this).css("position")=="fixed";return!e});if(e&&d.browser.opera){d.datepicker._pos[0]-=document.documentElement.scrollLeft;d.datepicker._pos[1]-=document.documentElement.scrollTop}c={left:d.datepicker._pos[0],top:d.datepicker._pos[1]};d.datepicker._pos=null;b.dpDiv.empty();b.dpDiv.css({position:"absolute",display:"block",top:"-1000px"});d.datepicker._updateDatepicker(b);
c=d.datepicker._checkOffset(b,c,e);b.dpDiv.css({position:d.datepicker._inDialog&&d.blockUI?"static":e?"fixed":"absolute",display:"none",left:c.left+"px",top:c.top+"px"});if(!b.inline){c=d.datepicker._get(b,"showAnim");var f=d.datepicker._get(b,"duration"),h=function(){var i=b.dpDiv.find("iframe.ui-datepicker-cover");if(i.length){var g=d.datepicker._getBorders(b.dpDiv);i.css({left:-g[0],top:-g[1],width:b.dpDiv.outerWidth(),height:b.dpDiv.outerHeight()})}};b.dpDiv.zIndex(d(a).zIndex()+1);d.datepicker._datepickerShowing=
true;d.effects&&d.effects[c]?b.dpDiv.show(c,d.datepicker._get(b,"showOptions"),f,h):b.dpDiv[c||"show"](c?f:null,h);if(!c||!f)h();b.input.is(":visible")&&!b.input.is(":disabled")&&b.input.focus();d.datepicker._curInst=b}}}},_updateDatepicker:function(a){this.maxRows=4;var b=d.datepicker._getBorders(a.dpDiv);J=a;a.dpDiv.empty().append(this._generateHTML(a));var c=a.dpDiv.find("iframe.ui-datepicker-cover");c.length&&c.css({left:-b[0],top:-b[1],width:a.dpDiv.outerWidth(),height:a.dpDiv.outerHeight()});
a.dpDiv.find("."+this._dayOverClass+" a").mouseover();b=this._getNumberOfMonths(a);c=b[1];a.dpDiv.removeClass("ui-datepicker-multi-2 ui-datepicker-multi-3 ui-datepicker-multi-4").width("");c>1&&a.dpDiv.addClass("ui-datepicker-multi-"+c).css("width",17*c+"em");a.dpDiv[(b[0]!=1||b[1]!=1?"add":"remove")+"Class"]("ui-datepicker-multi");a.dpDiv[(this._get(a,"isRTL")?"add":"remove")+"Class"]("ui-datepicker-rtl");a==d.datepicker._curInst&&d.datepicker._datepickerShowing&&a.input&&a.input.is(":visible")&&
!a.input.is(":disabled")&&a.input[0]!=document.activeElement&&a.input.focus();if(a.yearshtml){var e=a.yearshtml;setTimeout(function(){e===a.yearshtml&&a.yearshtml&&a.dpDiv.find("select.ui-datepicker-year:first").replaceWith(a.yearshtml);e=a.yearshtml=null},0)}},_getBorders:function(a){var b=function(c){return{thin:1,medium:2,thick:3}[c]||c};return[parseFloat(b(a.css("border-left-width"))),parseFloat(b(a.css("border-top-width")))]},_checkOffset:function(a,b,c){var e=a.dpDiv.outerWidth(),f=a.dpDiv.outerHeight(),
h=a.input?a.input.outerWidth():0,i=a.input?a.input.outerHeight():0,g=document.documentElement.clientWidth+d(document).scrollLeft(),j=document.documentElement.clientHeight+d(document).scrollTop();b.left-=this._get(a,"isRTL")?e-h:0;b.left-=c&&b.left==a.input.offset().left?d(document).scrollLeft():0;b.top-=c&&b.top==a.input.offset().top+i?d(document).scrollTop():0;b.left-=Math.min(b.left,b.left+e>g&&g>e?Math.abs(b.left+e-g):0);b.top-=Math.min(b.top,b.top+f>j&&j>f?Math.abs(f+i):0);return b},_findPos:function(a){for(var b=
this._get(this._getInst(a),"isRTL");a&&(a.type=="hidden"||a.nodeType!=1||d.expr.filters.hidden(a));)a=a[b?"previousSibling":"nextSibling"];a=d(a).offset();return[a.left,a.top]},_triggerOnClose:function(a){var b=this._get(a,"onClose");if(b)b.apply(a.input?a.input[0]:null,[a.input?a.input.val():"",a])},_hideDatepicker:function(a){var b=this._curInst;if(!(!b||a&&b!=d.data(a,"datepicker")))if(this._datepickerShowing){a=this._get(b,"showAnim");var c=this._get(b,"duration"),e=function(){d.datepicker._tidyDialog(b);
this._curInst=null};d.effects&&d.effects[a]?b.dpDiv.hide(a,d.datepicker._get(b,"showOptions"),c,e):b.dpDiv[a=="slideDown"?"slideUp":a=="fadeIn"?"fadeOut":"hide"](a?c:null,e);a||e();d.datepicker._triggerOnClose(b);this._datepickerShowing=false;this._lastInput=null;if(this._inDialog){this._dialogInput.css({position:"absolute",left:"0",top:"-100px"});if(d.blockUI){d.unblockUI();d("body").append(this.dpDiv)}}this._inDialog=false}},_tidyDialog:function(a){a.dpDiv.removeClass(this._dialogClass).unbind(".ui-datepicker-calendar")},
_checkExternalClick:function(a){if(d.datepicker._curInst){a=d(a.target);a[0].id!=d.datepicker._mainDivId&&a.parents("#"+d.datepicker._mainDivId).length==0&&!a.hasClass(d.datepicker.markerClassName)&&!a.hasClass(d.datepicker._triggerClass)&&d.datepicker._datepickerShowing&&!(d.datepicker._inDialog&&d.blockUI)&&d.datepicker._hideDatepicker()}},_adjustDate:function(a,b,c){a=d(a);var e=this._getInst(a[0]);if(!this._isDisabledDatepicker(a[0])){this._adjustInstDate(e,b+(c=="M"?this._get(e,"showCurrentAtPos"):
0),c);this._updateDatepicker(e)}},_gotoToday:function(a){a=d(a);var b=this._getInst(a[0]);if(this._get(b,"gotoCurrent")&&b.currentDay){b.selectedDay=b.currentDay;b.drawMonth=b.selectedMonth=b.currentMonth;b.drawYear=b.selectedYear=b.currentYear}else{var c=new Date;b.selectedDay=c.getDate();b.drawMonth=b.selectedMonth=c.getMonth();b.drawYear=b.selectedYear=c.getFullYear()}this._notifyChange(b);this._adjustDate(a)},_selectMonthYear:function(a,b,c){a=d(a);var e=this._getInst(a[0]);e["selected"+(c=="M"?
"Month":"Year")]=e["draw"+(c=="M"?"Month":"Year")]=parseInt(b.options[b.selectedIndex].value,10);this._notifyChange(e);this._adjustDate(a)},_selectDay:function(a,b,c,e){var f=d(a);if(!(d(e).hasClass(this._unselectableClass)||this._isDisabledDatepicker(f[0]))){f=this._getInst(f[0]);f.selectedDay=f.currentDay=d("a",e).html();f.selectedMonth=f.currentMonth=b;f.selectedYear=f.currentYear=c;this._selectDate(a,this._formatDate(f,f.currentDay,f.currentMonth,f.currentYear))}},_clearDate:function(a){a=d(a);
this._getInst(a[0]);this._selectDate(a,"")},_selectDate:function(a,b){a=this._getInst(d(a)[0]);b=b!=null?b:this._formatDate(a);a.input&&a.input.val(b);this._updateAlternate(a);var c=this._get(a,"onSelect");if(c)c.apply(a.input?a.input[0]:null,[b,a]);else a.input&&a.input.trigger("change");if(a.inline)this._updateDatepicker(a);else{this._hideDatepicker();this._lastInput=a.input[0];typeof a.input[0]!="object"&&a.input.focus();this._lastInput=null}},_updateAlternate:function(a){var b=this._get(a,"altField");
if(b){var c=this._get(a,"altFormat")||this._get(a,"dateFormat"),e=this._getDate(a),f=this.formatDate(c,e,this._getFormatConfig(a));d(b).each(function(){d(this).val(f)})}},noWeekends:function(a){a=a.getDay();return[a>0&&a<6,""]},iso8601Week:function(a){a=new Date(a.getTime());a.setDate(a.getDate()+4-(a.getDay()||7));var b=a.getTime();a.setMonth(0);a.setDate(1);return Math.floor(Math.round((b-a)/864E5)/7)+1},parseDate:function(a,b,c){if(a==null||b==null)throw"Invalid arguments";b=typeof b=="object"?
b.toString():b+"";if(b=="")return null;var e=(c?c.shortYearCutoff:null)||this._defaults.shortYearCutoff;e=typeof e!="string"?e:(new Date).getFullYear()%100+parseInt(e,10);for(var f=(c?c.dayNamesShort:null)||this._defaults.dayNamesShort,h=(c?c.dayNames:null)||this._defaults.dayNames,i=(c?c.monthNamesShort:null)||this._defaults.monthNamesShort,g=(c?c.monthNames:null)||this._defaults.monthNames,j=c=-1,l=-1,u=-1,k=false,o=function(p){(p=A+1<a.length&&a.charAt(A+1)==p)&&A++;return p},m=function(p){var D=
o(p);p=new RegExp("^\\d{1,"+(p=="@"?14:p=="!"?20:p=="y"&&D?4:p=="o"?3:2)+"}");p=b.substring(q).match(p);if(!p)throw"Missing number at position "+q;q+=p[0].length;return parseInt(p[0],10)},n=function(p,D,K){p=d.map(o(p)?K:D,function(w,x){return[[x,w]]}).sort(function(w,x){return-(w[1].length-x[1].length)});var E=-1;d.each(p,function(w,x){w=x[1];if(b.substr(q,w.length).toLowerCase()==w.toLowerCase()){E=x[0];q+=w.length;return false}});if(E!=-1)return E+1;else throw"Unknown name at position "+q;},s=
function(){if(b.charAt(q)!=a.charAt(A))throw"Unexpected literal at position "+q;q++},q=0,A=0;A<a.length;A++)if(k)if(a.charAt(A)=="'"&&!o("'"))k=false;else s();else switch(a.charAt(A)){case "d":l=m("d");break;case "D":n("D",f,h);break;case "o":u=m("o");break;case "m":j=m("m");break;case "M":j=n("M",i,g);break;case "y":c=m("y");break;case "@":var v=new Date(m("@"));c=v.getFullYear();j=v.getMonth()+1;l=v.getDate();break;case "!":v=new Date((m("!")-this._ticksTo1970)/1E4);c=v.getFullYear();j=v.getMonth()+
1;l=v.getDate();break;case "'":if(o("'"))s();else k=true;break;default:s()}if(q<b.length)throw"Extra/unparsed characters found in date: "+b.substring(q);if(c==-1)c=(new Date).getFullYear();else if(c<100)c+=(new Date).getFullYear()-(new Date).getFullYear()%100+(c<=e?0:-100);if(u>-1){j=1;l=u;do{e=this._getDaysInMonth(c,j-1);if(l<=e)break;j++;l-=e}while(1)}v=this._daylightSavingAdjust(new Date(c,j-1,l));if(v.getFullYear()!=c||v.getMonth()+1!=j||v.getDate()!=l)throw"Invalid date";return v},ATOM:"yy-mm-dd",
COOKIE:"D, dd M yy",ISO_8601:"yy-mm-dd",RFC_822:"D, d M y",RFC_850:"DD, dd-M-y",RFC_1036:"D, d M y",RFC_1123:"D, d M yy",RFC_2822:"D, d M yy",RSS:"D, d M y",TICKS:"!",TIMESTAMP:"@",W3C:"yy-mm-dd",_ticksTo1970:(718685+Math.floor(492.5)-Math.floor(19.7)+Math.floor(4.925))*24*60*60*1E7,formatDate:function(a,b,c){if(!b)return"";var e=(c?c.dayNamesShort:null)||this._defaults.dayNamesShort,f=(c?c.dayNames:null)||this._defaults.dayNames,h=(c?c.monthNamesShort:null)||this._defaults.monthNamesShort;c=(c?c.monthNames:
null)||this._defaults.monthNames;var i=function(o){(o=k+1<a.length&&a.charAt(k+1)==o)&&k++;return o},g=function(o,m,n){m=""+m;if(i(o))for(;m.length<n;)m="0"+m;return m},j=function(o,m,n,s){return i(o)?s[m]:n[m]},l="",u=false;if(b)for(var k=0;k<a.length;k++)if(u)if(a.charAt(k)=="'"&&!i("'"))u=false;else l+=a.charAt(k);else switch(a.charAt(k)){case "d":l+=g("d",b.getDate(),2);break;case "D":l+=j("D",b.getDay(),e,f);break;case "o":l+=g("o",Math.round(((new Date(b.getFullYear(),b.getMonth(),b.getDate())).getTime()-
(new Date(b.getFullYear(),0,0)).getTime())/864E5),3);break;case "m":l+=g("m",b.getMonth()+1,2);break;case "M":l+=j("M",b.getMonth(),h,c);break;case "y":l+=i("y")?b.getFullYear():(b.getYear()%100<10?"0":"")+b.getYear()%100;break;case "@":l+=b.getTime();break;case "!":l+=b.getTime()*1E4+this._ticksTo1970;break;case "'":if(i("'"))l+="'";else u=true;break;default:l+=a.charAt(k)}return l},_possibleChars:function(a){for(var b="",c=false,e=function(h){(h=f+1<a.length&&a.charAt(f+1)==h)&&f++;return h},f=
0;f<a.length;f++)if(c)if(a.charAt(f)=="'"&&!e("'"))c=false;else b+=a.charAt(f);else switch(a.charAt(f)){case "d":case "m":case "y":case "@":b+="0123456789";break;case "D":case "M":return null;case "'":if(e("'"))b+="'";else c=true;break;default:b+=a.charAt(f)}return b},_get:function(a,b){return a.settings[b]!==C?a.settings[b]:this._defaults[b]},_setDateFromField:function(a,b){if(a.input.val()!=a.lastVal){var c=this._get(a,"dateFormat"),e=a.lastVal=a.input?a.input.val():null,f,h;f=h=this._getDefaultDate(a);
var i=this._getFormatConfig(a);try{f=this.parseDate(c,e,i)||h}catch(g){this.log(g);e=b?"":e}a.selectedDay=f.getDate();a.drawMonth=a.selectedMonth=f.getMonth();a.drawYear=a.selectedYear=f.getFullYear();a.currentDay=e?f.getDate():0;a.currentMonth=e?f.getMonth():0;a.currentYear=e?f.getFullYear():0;this._adjustInstDate(a)}},_getDefaultDate:function(a){return this._restrictMinMax(a,this._determineDate(a,this._get(a,"defaultDate"),new Date))},_determineDate:function(a,b,c){var e=function(h){var i=new Date;
i.setDate(i.getDate()+h);return i},f=function(h){try{return d.datepicker.parseDate(d.datepicker._get(a,"dateFormat"),h,d.datepicker._getFormatConfig(a))}catch(i){}var g=(h.toLowerCase().match(/^c/)?d.datepicker._getDate(a):null)||new Date,j=g.getFullYear(),l=g.getMonth();g=g.getDate();for(var u=/([+-]?[0-9]+)\s*(d|D|w|W|m|M|y|Y)?/g,k=u.exec(h);k;){switch(k[2]||"d"){case "d":case "D":g+=parseInt(k[1],10);break;case "w":case "W":g+=parseInt(k[1],10)*7;break;case "m":case "M":l+=parseInt(k[1],10);g=
Math.min(g,d.datepicker._getDaysInMonth(j,l));break;case "y":case "Y":j+=parseInt(k[1],10);g=Math.min(g,d.datepicker._getDaysInMonth(j,l));break}k=u.exec(h)}return new Date(j,l,g)};if(b=(b=b==null||b===""?c:typeof b=="string"?f(b):typeof b=="number"?isNaN(b)?c:e(b):new Date(b.getTime()))&&b.toString()=="Invalid Date"?c:b){b.setHours(0);b.setMinutes(0);b.setSeconds(0);b.setMilliseconds(0)}return this._daylightSavingAdjust(b)},_daylightSavingAdjust:function(a){if(!a)return null;a.setHours(a.getHours()>
12?a.getHours()+2:0);return a},_setDate:function(a,b,c){var e=!b,f=a.selectedMonth,h=a.selectedYear;b=this._restrictMinMax(a,this._determineDate(a,b,new Date));a.selectedDay=a.currentDay=b.getDate();a.drawMonth=a.selectedMonth=a.currentMonth=b.getMonth();a.drawYear=a.selectedYear=a.currentYear=b.getFullYear();if((f!=a.selectedMonth||h!=a.selectedYear)&&!c)this._notifyChange(a);this._adjustInstDate(a);if(a.input)a.input.val(e?"":this._formatDate(a))},_getDate:function(a){return!a.currentYear||a.input&&
a.input.val()==""?null:this._daylightSavingAdjust(new Date(a.currentYear,a.currentMonth,a.currentDay))},_generateHTML:function(a){var b=new Date;b=this._daylightSavingAdjust(new Date(b.getFullYear(),b.getMonth(),b.getDate()));var c=this._get(a,"isRTL"),e=this._get(a,"showButtonPanel"),f=this._get(a,"hideIfNoPrevNext"),h=this._get(a,"navigationAsDateFormat"),i=this._getNumberOfMonths(a),g=this._get(a,"showCurrentAtPos"),j=this._get(a,"stepMonths"),l=i[0]!=1||i[1]!=1,u=this._daylightSavingAdjust(!a.currentDay?
new Date(9999,9,9):new Date(a.currentYear,a.currentMonth,a.currentDay)),k=this._getMinMaxDate(a,"min"),o=this._getMinMaxDate(a,"max");g=a.drawMonth-g;var m=a.drawYear;if(g<0){g+=12;m--}if(o){var n=this._daylightSavingAdjust(new Date(o.getFullYear(),o.getMonth()-i[0]*i[1]+1,o.getDate()));for(n=k&&n<k?k:n;this._daylightSavingAdjust(new Date(m,g,1))>n;){g--;if(g<0){g=11;m--}}}a.drawMonth=g;a.drawYear=m;n=this._get(a,"prevText");n=!h?n:this.formatDate(n,this._daylightSavingAdjust(new Date(m,g-j,1)),this._getFormatConfig(a));
n=this._canAdjustMonth(a,-1,m,g)?'<a class="ui-datepicker-prev ui-corner-all" onclick="DP_jQuery_'+B+".datepicker._adjustDate('#"+a.id+"', -"+j+", 'M');\" title=\""+n+'"><span class="ui-icon ui-icon-circle-triangle-'+(c?"e":"w")+'">'+n+"</span></a>":f?"":'<a class="ui-datepicker-prev ui-corner-all ui-state-disabled" title="'+n+'"><span class="ui-icon ui-icon-circle-triangle-'+(c?"e":"w")+'">'+n+"</span></a>";var s=this._get(a,"nextText");s=!h?s:this.formatDate(s,this._daylightSavingAdjust(new Date(m,
g+j,1)),this._getFormatConfig(a));f=this._canAdjustMonth(a,+1,m,g)?'<a class="ui-datepicker-next ui-corner-all" onclick="DP_jQuery_'+B+".datepicker._adjustDate('#"+a.id+"', +"+j+", 'M');\" title=\""+s+'"><span class="ui-icon ui-icon-circle-triangle-'+(c?"w":"e")+'">'+s+"</span></a>":f?"":'<a class="ui-datepicker-next ui-corner-all ui-state-disabled" title="'+s+'"><span class="ui-icon ui-icon-circle-triangle-'+(c?"w":"e")+'">'+s+"</span></a>";j=this._get(a,"currentText");s=this._get(a,"gotoCurrent")&&
a.currentDay?u:b;j=!h?j:this.formatDate(j,s,this._getFormatConfig(a));h=!a.inline?'<button type="button" class="ui-datepicker-close ui-state-default ui-priority-primary ui-corner-all" onclick="DP_jQuery_'+B+'.datepicker._hideDatepicker();">'+this._get(a,"closeText")+"</button>":"";e=e?'<div class="ui-datepicker-buttonpane ui-widget-content">'+(c?h:"")+(this._isInRange(a,s)?'<button type="button" class="ui-datepicker-current ui-state-default ui-priority-secondary ui-corner-all" onclick="DP_jQuery_'+
B+".datepicker._gotoToday('#"+a.id+"');\">"+j+"</button>":"")+(c?"":h)+"</div>":"";h=parseInt(this._get(a,"firstDay"),10);h=isNaN(h)?0:h;j=this._get(a,"showWeek");s=this._get(a,"dayNames");this._get(a,"dayNamesShort");var q=this._get(a,"dayNamesMin"),A=this._get(a,"monthNames"),v=this._get(a,"monthNamesShort"),p=this._get(a,"beforeShowDay"),D=this._get(a,"showOtherMonths"),K=this._get(a,"selectOtherMonths");this._get(a,"calculateWeek");for(var E=this._getDefaultDate(a),w="",x=0;x<i[0];x++){var O=
"";this.maxRows=4;for(var G=0;G<i[1];G++){var P=this._daylightSavingAdjust(new Date(m,g,a.selectedDay)),t=" ui-corner-all",y="";if(l){y+='<div class="ui-datepicker-group';if(i[1]>1)switch(G){case 0:y+=" ui-datepicker-group-first";t=" ui-corner-"+(c?"right":"left");break;case i[1]-1:y+=" ui-datepicker-group-last";t=" ui-corner-"+(c?"left":"right");break;default:y+=" ui-datepicker-group-middle";t="";break}y+='">'}y+='<div class="ui-datepicker-header ui-widget-header ui-helper-clearfix'+t+'">'+(/all|left/.test(t)&&
x==0?c?f:n:"")+(/all|right/.test(t)&&x==0?c?n:f:"")+this._generateMonthYearHeader(a,g,m,k,o,x>0||G>0,A,v)+'</div><table class="ui-datepicker-calendar"><thead><tr>';var z=j?'<th class="ui-datepicker-week-col">'+this._get(a,"weekHeader")+"</th>":"";for(t=0;t<7;t++){var r=(t+h)%7;z+="<th"+((t+h+6)%7>=5?' class="ui-datepicker-week-end"':"")+'><span title="'+s[r]+'">'+q[r]+"</span></th>"}y+=z+"</tr></thead><tbody>";z=this._getDaysInMonth(m,g);if(m==a.selectedYear&&g==a.selectedMonth)a.selectedDay=Math.min(a.selectedDay,
z);t=(this._getFirstDayOfMonth(m,g)-h+7)%7;z=Math.ceil((t+z)/7);this.maxRows=z=l?this.maxRows>z?this.maxRows:z:z;r=this._daylightSavingAdjust(new Date(m,g,1-t));for(var Q=0;Q<z;Q++){y+="<tr>";var R=!j?"":'<td class="ui-datepicker-week-col">'+this._get(a,"calculateWeek")(r)+"</td>";for(t=0;t<7;t++){var I=p?p.apply(a.input?a.input[0]:null,[r]):[true,""],F=r.getMonth()!=g,L=F&&!K||!I[0]||k&&r<k||o&&r>o;R+='<td class="'+((t+h+6)%7>=5?" ui-datepicker-week-end":"")+(F?" ui-datepicker-other-month":"")+(r.getTime()==
P.getTime()&&g==a.selectedMonth&&a._keyEvent||E.getTime()==r.getTime()&&E.getTime()==P.getTime()?" "+this._dayOverClass:"")+(L?" "+this._unselectableClass+" ui-state-disabled":"")+(F&&!D?"":" "+I[1]+(r.getTime()==u.getTime()?" "+this._currentClass:"")+(r.getTime()==b.getTime()?" ui-datepicker-today":""))+'"'+((!F||D)&&I[2]?' title="'+I[2]+'"':"")+(L?"":' onclick="DP_jQuery_'+B+".datepicker._selectDay('#"+a.id+"',"+r.getMonth()+","+r.getFullYear()+', this);return false;"')+">"+(F&&!D?"&#xa0;":L?'<span class="ui-state-default">'+
r.getDate()+"</span>":'<a class="ui-state-default'+(r.getTime()==b.getTime()?" ui-state-highlight":"")+(r.getTime()==u.getTime()?" ui-state-active":"")+(F?" ui-priority-secondary":"")+'" href="#">'+r.getDate()+"</a>")+"</td>";r.setDate(r.getDate()+1);r=this._daylightSavingAdjust(r)}y+=R+"</tr>"}g++;if(g>11){g=0;m++}y+="</tbody></table>"+(l?"</div>"+(i[0]>0&&G==i[1]-1?'<div class="ui-datepicker-row-break"></div>':""):"");O+=y}w+=O}w+=e+(d.browser.msie&&parseInt(d.browser.version,10)<7&&!a.inline?'<iframe src="javascript:false;" class="ui-datepicker-cover" frameborder="0"></iframe>':
"");a._keyEvent=false;return w},_generateMonthYearHeader:function(a,b,c,e,f,h,i,g){var j=this._get(a,"changeMonth"),l=this._get(a,"changeYear"),u=this._get(a,"showMonthAfterYear"),k='<div class="ui-datepicker-title">',o="";if(h||!j)o+='<span class="ui-datepicker-month">'+i[b]+"</span>";else{i=e&&e.getFullYear()==c;var m=f&&f.getFullYear()==c;o+='<select class="ui-datepicker-month" onchange="DP_jQuery_'+B+".datepicker._selectMonthYear('#"+a.id+"', this, 'M');\" >";for(var n=0;n<12;n++)if((!i||n>=e.getMonth())&&
(!m||n<=f.getMonth()))o+='<option value="'+n+'"'+(n==b?' selected="selected"':"")+">"+g[n]+"</option>";o+="</select>"}u||(k+=o+(h||!(j&&l)?"&#xa0;":""));if(!a.yearshtml){a.yearshtml="";if(h||!l)k+='<span class="ui-datepicker-year">'+c+"</span>";else{g=this._get(a,"yearRange").split(":");var s=(new Date).getFullYear();i=function(q){q=q.match(/c[+-].*/)?c+parseInt(q.substring(1),10):q.match(/[+-].*/)?s+parseInt(q,10):parseInt(q,10);return isNaN(q)?s:q};b=i(g[0]);g=Math.max(b,i(g[1]||""));b=e?Math.max(b,
e.getFullYear()):b;g=f?Math.min(g,f.getFullYear()):g;for(a.yearshtml+='<select class="ui-datepicker-year" onchange="DP_jQuery_'+B+".datepicker._selectMonthYear('#"+a.id+"', this, 'Y');\" >";b<=g;b++)a.yearshtml+='<option value="'+b+'"'+(b==c?' selected="selected"':"")+">"+b+"</option>";a.yearshtml+="</select>";k+=a.yearshtml;a.yearshtml=null}}k+=this._get(a,"yearSuffix");if(u)k+=(h||!(j&&l)?"&#xa0;":"")+o;k+="</div>";return k},_adjustInstDate:function(a,b,c){var e=a.drawYear+(c=="Y"?b:0),f=a.drawMonth+
(c=="M"?b:0);b=Math.min(a.selectedDay,this._getDaysInMonth(e,f))+(c=="D"?b:0);e=this._restrictMinMax(a,this._daylightSavingAdjust(new Date(e,f,b)));a.selectedDay=e.getDate();a.drawMonth=a.selectedMonth=e.getMonth();a.drawYear=a.selectedYear=e.getFullYear();if(c=="M"||c=="Y")this._notifyChange(a)},_restrictMinMax:function(a,b){var c=this._getMinMaxDate(a,"min");a=this._getMinMaxDate(a,"max");b=c&&b<c?c:b;return b=a&&b>a?a:b},_notifyChange:function(a){var b=this._get(a,"onChangeMonthYear");if(b)b.apply(a.input?
a.input[0]:null,[a.selectedYear,a.selectedMonth+1,a])},_getNumberOfMonths:function(a){a=this._get(a,"numberOfMonths");return a==null?[1,1]:typeof a=="number"?[1,a]:a},_getMinMaxDate:function(a,b){return this._determineDate(a,this._get(a,b+"Date"),null)},_getDaysInMonth:function(a,b){return 32-this._daylightSavingAdjust(new Date(a,b,32)).getDate()},_getFirstDayOfMonth:function(a,b){return(new Date(a,b,1)).getDay()},_canAdjustMonth:function(a,b,c,e){var f=this._getNumberOfMonths(a);c=this._daylightSavingAdjust(new Date(c,
e+(b<0?b:f[0]*f[1]),1));b<0&&c.setDate(this._getDaysInMonth(c.getFullYear(),c.getMonth()));return this._isInRange(a,c)},_isInRange:function(a,b){var c=this._getMinMaxDate(a,"min");a=this._getMinMaxDate(a,"max");return(!c||b.getTime()>=c.getTime())&&(!a||b.getTime()<=a.getTime())},_getFormatConfig:function(a){var b=this._get(a,"shortYearCutoff");b=typeof b!="string"?b:(new Date).getFullYear()%100+parseInt(b,10);return{shortYearCutoff:b,dayNamesShort:this._get(a,"dayNamesShort"),dayNames:this._get(a,
"dayNames"),monthNamesShort:this._get(a,"monthNamesShort"),monthNames:this._get(a,"monthNames")}},_formatDate:function(a,b,c,e){if(!b){a.currentDay=a.selectedDay;a.currentMonth=a.selectedMonth;a.currentYear=a.selectedYear}b=b?typeof b=="object"?b:this._daylightSavingAdjust(new Date(e,c,b)):this._daylightSavingAdjust(new Date(a.currentYear,a.currentMonth,a.currentDay));return this.formatDate(this._get(a,"dateFormat"),b,this._getFormatConfig(a))}});d.fn.datepicker=function(a){if(!this.length)return this;
if(!d.datepicker.initialized){d(document).mousedown(d.datepicker._checkExternalClick).find("body").append(d.datepicker.dpDiv);d.datepicker.initialized=true}var b=Array.prototype.slice.call(arguments,1);if(typeof a=="string"&&(a=="isDisabled"||a=="getDate"||a=="widget"))return d.datepicker["_"+a+"Datepicker"].apply(d.datepicker,[this[0]].concat(b));if(a=="option"&&arguments.length==2&&typeof arguments[1]=="string")return d.datepicker["_"+a+"Datepicker"].apply(d.datepicker,[this[0]].concat(b));return this.each(function(){typeof a==
"string"?d.datepicker["_"+a+"Datepicker"].apply(d.datepicker,[this].concat(b)):d.datepicker._attachDatepicker(this,a)})};d.datepicker=new M;d.datepicker.initialized=false;d.datepicker.uuid=(new Date).getTime();d.datepicker.version="1.8.16";window["DP_jQuery_"+B]=d})(jQuery);
;/*
 * jQuery UI Progressbar 1.8.16
 *
 * Copyright 2011, AUTHORS.txt (http://jqueryui.com/about)
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * http://jquery.org/license
 *
 * http://docs.jquery.com/UI/Progressbar
 *
 * Depends:
 *   jquery.ui.core.js
 *   jquery.ui.widget.js
 */
(function(b,d){b.widget("ui.progressbar",{options:{value:0,max:100},min:0,_create:function(){this.element.addClass("ui-progressbar ui-widget ui-widget-content ui-corner-all").attr({role:"progressbar","aria-valuemin":this.min,"aria-valuemax":this.options.max,"aria-valuenow":this._value()});this.valueDiv=b("<div class='ui-progressbar-value ui-widget-header ui-corner-left'></div>").appendTo(this.element);this.oldValue=this._value();this._refreshValue()},destroy:function(){this.element.removeClass("ui-progressbar ui-widget ui-widget-content ui-corner-all").removeAttr("role").removeAttr("aria-valuemin").removeAttr("aria-valuemax").removeAttr("aria-valuenow");
this.valueDiv.remove();b.Widget.prototype.destroy.apply(this,arguments)},value:function(a){if(a===d)return this._value();this._setOption("value",a);return this},_setOption:function(a,c){if(a==="value"){this.options.value=c;this._refreshValue();this._value()===this.options.max&&this._trigger("complete")}b.Widget.prototype._setOption.apply(this,arguments)},_value:function(){var a=this.options.value;if(typeof a!=="number")a=0;return Math.min(this.options.max,Math.max(this.min,a))},_percentage:function(){return 100*
this._value()/this.options.max},_refreshValue:function(){var a=this.value(),c=this._percentage();if(this.oldValue!==a){this.oldValue=a;this._trigger("change")}this.valueDiv.toggle(a>this.min).toggleClass("ui-corner-right",a===this.options.max).width(c.toFixed(0)+"%");this.element.attr("aria-valuenow",a)}});b.extend(b.ui.progressbar,{version:"1.8.16"})})(jQuery);
;/*
 * jQuery UI Effects 1.8.16
 *
 * Copyright 2011, AUTHORS.txt (http://jqueryui.com/about)
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * http://jquery.org/license
 *
 * http://docs.jquery.com/UI/Effects/
 */
jQuery.effects||function(f,j){function m(c){var a;if(c&&c.constructor==Array&&c.length==3)return c;if(a=/rgb\(\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*\)/.exec(c))return[parseInt(a[1],10),parseInt(a[2],10),parseInt(a[3],10)];if(a=/rgb\(\s*([0-9]+(?:\.[0-9]+)?)\%\s*,\s*([0-9]+(?:\.[0-9]+)?)\%\s*,\s*([0-9]+(?:\.[0-9]+)?)\%\s*\)/.exec(c))return[parseFloat(a[1])*2.55,parseFloat(a[2])*2.55,parseFloat(a[3])*2.55];if(a=/#([a-fA-F0-9]{2})([a-fA-F0-9]{2})([a-fA-F0-9]{2})/.exec(c))return[parseInt(a[1],
16),parseInt(a[2],16),parseInt(a[3],16)];if(a=/#([a-fA-F0-9])([a-fA-F0-9])([a-fA-F0-9])/.exec(c))return[parseInt(a[1]+a[1],16),parseInt(a[2]+a[2],16),parseInt(a[3]+a[3],16)];if(/rgba\(0, 0, 0, 0\)/.exec(c))return n.transparent;return n[f.trim(c).toLowerCase()]}function s(c,a){var b;do{b=f.curCSS(c,a);if(b!=""&&b!="transparent"||f.nodeName(c,"body"))break;a="backgroundColor"}while(c=c.parentNode);return m(b)}function o(){var c=document.defaultView?document.defaultView.getComputedStyle(this,null):this.currentStyle,
a={},b,d;if(c&&c.length&&c[0]&&c[c[0]])for(var e=c.length;e--;){b=c[e];if(typeof c[b]=="string"){d=b.replace(/\-(\w)/g,function(g,h){return h.toUpperCase()});a[d]=c[b]}}else for(b in c)if(typeof c[b]==="string")a[b]=c[b];return a}function p(c){var a,b;for(a in c){b=c[a];if(b==null||f.isFunction(b)||a in t||/scrollbar/.test(a)||!/color/i.test(a)&&isNaN(parseFloat(b)))delete c[a]}return c}function u(c,a){var b={_:0},d;for(d in a)if(c[d]!=a[d])b[d]=a[d];return b}function k(c,a,b,d){if(typeof c=="object"){d=
a;b=null;a=c;c=a.effect}if(f.isFunction(a)){d=a;b=null;a={}}if(typeof a=="number"||f.fx.speeds[a]){d=b;b=a;a={}}if(f.isFunction(b)){d=b;b=null}a=a||{};b=b||a.duration;b=f.fx.off?0:typeof b=="number"?b:b in f.fx.speeds?f.fx.speeds[b]:f.fx.speeds._default;d=d||a.complete;return[c,a,b,d]}function l(c){if(!c||typeof c==="number"||f.fx.speeds[c])return true;if(typeof c==="string"&&!f.effects[c])return true;return false}f.effects={};f.each(["backgroundColor","borderBottomColor","borderLeftColor","borderRightColor",
"borderTopColor","borderColor","color","outlineColor"],function(c,a){f.fx.step[a]=function(b){if(!b.colorInit){b.start=s(b.elem,a);b.end=m(b.end);b.colorInit=true}b.elem.style[a]="rgb("+Math.max(Math.min(parseInt(b.pos*(b.end[0]-b.start[0])+b.start[0],10),255),0)+","+Math.max(Math.min(parseInt(b.pos*(b.end[1]-b.start[1])+b.start[1],10),255),0)+","+Math.max(Math.min(parseInt(b.pos*(b.end[2]-b.start[2])+b.start[2],10),255),0)+")"}});var n={aqua:[0,255,255],azure:[240,255,255],beige:[245,245,220],black:[0,
0,0],blue:[0,0,255],brown:[165,42,42],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgrey:[169,169,169],darkgreen:[0,100,0],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkviolet:[148,0,211],fuchsia:[255,0,255],gold:[255,215,0],green:[0,128,0],indigo:[75,0,130],khaki:[240,230,140],lightblue:[173,216,230],lightcyan:[224,255,255],lightgreen:[144,238,144],lightgrey:[211,
211,211],lightpink:[255,182,193],lightyellow:[255,255,224],lime:[0,255,0],magenta:[255,0,255],maroon:[128,0,0],navy:[0,0,128],olive:[128,128,0],orange:[255,165,0],pink:[255,192,203],purple:[128,0,128],violet:[128,0,128],red:[255,0,0],silver:[192,192,192],white:[255,255,255],yellow:[255,255,0],transparent:[255,255,255]},q=["add","remove","toggle"],t={border:1,borderBottom:1,borderColor:1,borderLeft:1,borderRight:1,borderTop:1,borderWidth:1,margin:1,padding:1};f.effects.animateClass=function(c,a,b,
d){if(f.isFunction(b)){d=b;b=null}return this.queue(function(){var e=f(this),g=e.attr("style")||" ",h=p(o.call(this)),r,v=e.attr("class");f.each(q,function(w,i){c[i]&&e[i+"Class"](c[i])});r=p(o.call(this));e.attr("class",v);e.animate(u(h,r),{queue:false,duration:a,easing:b,complete:function(){f.each(q,function(w,i){c[i]&&e[i+"Class"](c[i])});if(typeof e.attr("style")=="object"){e.attr("style").cssText="";e.attr("style").cssText=g}else e.attr("style",g);d&&d.apply(this,arguments);f.dequeue(this)}})})};
f.fn.extend({_addClass:f.fn.addClass,addClass:function(c,a,b,d){return a?f.effects.animateClass.apply(this,[{add:c},a,b,d]):this._addClass(c)},_removeClass:f.fn.removeClass,removeClass:function(c,a,b,d){return a?f.effects.animateClass.apply(this,[{remove:c},a,b,d]):this._removeClass(c)},_toggleClass:f.fn.toggleClass,toggleClass:function(c,a,b,d,e){return typeof a=="boolean"||a===j?b?f.effects.animateClass.apply(this,[a?{add:c}:{remove:c},b,d,e]):this._toggleClass(c,a):f.effects.animateClass.apply(this,
[{toggle:c},a,b,d])},switchClass:function(c,a,b,d,e){return f.effects.animateClass.apply(this,[{add:a,remove:c},b,d,e])}});f.extend(f.effects,{version:"1.8.16",save:function(c,a){for(var b=0;b<a.length;b++)a[b]!==null&&c.data("ec.storage."+a[b],c[0].style[a[b]])},restore:function(c,a){for(var b=0;b<a.length;b++)a[b]!==null&&c.css(a[b],c.data("ec.storage."+a[b]))},setMode:function(c,a){if(a=="toggle")a=c.is(":hidden")?"show":"hide";return a},getBaseline:function(c,a){var b;switch(c[0]){case "top":b=
0;break;case "middle":b=0.5;break;case "bottom":b=1;break;default:b=c[0]/a.height}switch(c[1]){case "left":c=0;break;case "center":c=0.5;break;case "right":c=1;break;default:c=c[1]/a.width}return{x:c,y:b}},createWrapper:function(c){if(c.parent().is(".ui-effects-wrapper"))return c.parent();var a={width:c.outerWidth(true),height:c.outerHeight(true),"float":c.css("float")},b=f("<div></div>").addClass("ui-effects-wrapper").css({fontSize:"100%",background:"transparent",border:"none",margin:0,padding:0}),
d=document.activeElement;c.wrap(b);if(c[0]===d||f.contains(c[0],d))f(d).focus();b=c.parent();if(c.css("position")=="static"){b.css({position:"relative"});c.css({position:"relative"})}else{f.extend(a,{position:c.css("position"),zIndex:c.css("z-index")});f.each(["top","left","bottom","right"],function(e,g){a[g]=c.css(g);if(isNaN(parseInt(a[g],10)))a[g]="auto"});c.css({position:"relative",top:0,left:0,right:"auto",bottom:"auto"})}return b.css(a).show()},removeWrapper:function(c){var a,b=document.activeElement;
if(c.parent().is(".ui-effects-wrapper")){a=c.parent().replaceWith(c);if(c[0]===b||f.contains(c[0],b))f(b).focus();return a}return c},setTransition:function(c,a,b,d){d=d||{};f.each(a,function(e,g){unit=c.cssUnit(g);if(unit[0]>0)d[g]=unit[0]*b+unit[1]});return d}});f.fn.extend({effect:function(c){var a=k.apply(this,arguments),b={options:a[1],duration:a[2],callback:a[3]};a=b.options.mode;var d=f.effects[c];if(f.fx.off||!d)return a?this[a](b.duration,b.callback):this.each(function(){b.callback&&b.callback.call(this)});
return d.call(this,b)},_show:f.fn.show,show:function(c){if(l(c))return this._show.apply(this,arguments);else{var a=k.apply(this,arguments);a[1].mode="show";return this.effect.apply(this,a)}},_hide:f.fn.hide,hide:function(c){if(l(c))return this._hide.apply(this,arguments);else{var a=k.apply(this,arguments);a[1].mode="hide";return this.effect.apply(this,a)}},__toggle:f.fn.toggle,toggle:function(c){if(l(c)||typeof c==="boolean"||f.isFunction(c))return this.__toggle.apply(this,arguments);else{var a=k.apply(this,
arguments);a[1].mode="toggle";return this.effect.apply(this,a)}},cssUnit:function(c){var a=this.css(c),b=[];f.each(["em","px","%","pt"],function(d,e){if(a.indexOf(e)>0)b=[parseFloat(a),e]});return b}});f.easing.jswing=f.easing.swing;f.extend(f.easing,{def:"easeOutQuad",swing:function(c,a,b,d,e){return f.easing[f.easing.def](c,a,b,d,e)},easeInQuad:function(c,a,b,d,e){return d*(a/=e)*a+b},easeOutQuad:function(c,a,b,d,e){return-d*(a/=e)*(a-2)+b},easeInOutQuad:function(c,a,b,d,e){if((a/=e/2)<1)return d/
2*a*a+b;return-d/2*(--a*(a-2)-1)+b},easeInCubic:function(c,a,b,d,e){return d*(a/=e)*a*a+b},easeOutCubic:function(c,a,b,d,e){return d*((a=a/e-1)*a*a+1)+b},easeInOutCubic:function(c,a,b,d,e){if((a/=e/2)<1)return d/2*a*a*a+b;return d/2*((a-=2)*a*a+2)+b},easeInQuart:function(c,a,b,d,e){return d*(a/=e)*a*a*a+b},easeOutQuart:function(c,a,b,d,e){return-d*((a=a/e-1)*a*a*a-1)+b},easeInOutQuart:function(c,a,b,d,e){if((a/=e/2)<1)return d/2*a*a*a*a+b;return-d/2*((a-=2)*a*a*a-2)+b},easeInQuint:function(c,a,b,
d,e){return d*(a/=e)*a*a*a*a+b},easeOutQuint:function(c,a,b,d,e){return d*((a=a/e-1)*a*a*a*a+1)+b},easeInOutQuint:function(c,a,b,d,e){if((a/=e/2)<1)return d/2*a*a*a*a*a+b;return d/2*((a-=2)*a*a*a*a+2)+b},easeInSine:function(c,a,b,d,e){return-d*Math.cos(a/e*(Math.PI/2))+d+b},easeOutSine:function(c,a,b,d,e){return d*Math.sin(a/e*(Math.PI/2))+b},easeInOutSine:function(c,a,b,d,e){return-d/2*(Math.cos(Math.PI*a/e)-1)+b},easeInExpo:function(c,a,b,d,e){return a==0?b:d*Math.pow(2,10*(a/e-1))+b},easeOutExpo:function(c,
a,b,d,e){return a==e?b+d:d*(-Math.pow(2,-10*a/e)+1)+b},easeInOutExpo:function(c,a,b,d,e){if(a==0)return b;if(a==e)return b+d;if((a/=e/2)<1)return d/2*Math.pow(2,10*(a-1))+b;return d/2*(-Math.pow(2,-10*--a)+2)+b},easeInCirc:function(c,a,b,d,e){return-d*(Math.sqrt(1-(a/=e)*a)-1)+b},easeOutCirc:function(c,a,b,d,e){return d*Math.sqrt(1-(a=a/e-1)*a)+b},easeInOutCirc:function(c,a,b,d,e){if((a/=e/2)<1)return-d/2*(Math.sqrt(1-a*a)-1)+b;return d/2*(Math.sqrt(1-(a-=2)*a)+1)+b},easeInElastic:function(c,a,b,
d,e){c=1.70158;var g=0,h=d;if(a==0)return b;if((a/=e)==1)return b+d;g||(g=e*0.3);if(h<Math.abs(d)){h=d;c=g/4}else c=g/(2*Math.PI)*Math.asin(d/h);return-(h*Math.pow(2,10*(a-=1))*Math.sin((a*e-c)*2*Math.PI/g))+b},easeOutElastic:function(c,a,b,d,e){c=1.70158;var g=0,h=d;if(a==0)return b;if((a/=e)==1)return b+d;g||(g=e*0.3);if(h<Math.abs(d)){h=d;c=g/4}else c=g/(2*Math.PI)*Math.asin(d/h);return h*Math.pow(2,-10*a)*Math.sin((a*e-c)*2*Math.PI/g)+d+b},easeInOutElastic:function(c,a,b,d,e){c=1.70158;var g=
0,h=d;if(a==0)return b;if((a/=e/2)==2)return b+d;g||(g=e*0.3*1.5);if(h<Math.abs(d)){h=d;c=g/4}else c=g/(2*Math.PI)*Math.asin(d/h);if(a<1)return-0.5*h*Math.pow(2,10*(a-=1))*Math.sin((a*e-c)*2*Math.PI/g)+b;return h*Math.pow(2,-10*(a-=1))*Math.sin((a*e-c)*2*Math.PI/g)*0.5+d+b},easeInBack:function(c,a,b,d,e,g){if(g==j)g=1.70158;return d*(a/=e)*a*((g+1)*a-g)+b},easeOutBack:function(c,a,b,d,e,g){if(g==j)g=1.70158;return d*((a=a/e-1)*a*((g+1)*a+g)+1)+b},easeInOutBack:function(c,a,b,d,e,g){if(g==j)g=1.70158;
if((a/=e/2)<1)return d/2*a*a*(((g*=1.525)+1)*a-g)+b;return d/2*((a-=2)*a*(((g*=1.525)+1)*a+g)+2)+b},easeInBounce:function(c,a,b,d,e){return d-f.easing.easeOutBounce(c,e-a,0,d,e)+b},easeOutBounce:function(c,a,b,d,e){return(a/=e)<1/2.75?d*7.5625*a*a+b:a<2/2.75?d*(7.5625*(a-=1.5/2.75)*a+0.75)+b:a<2.5/2.75?d*(7.5625*(a-=2.25/2.75)*a+0.9375)+b:d*(7.5625*(a-=2.625/2.75)*a+0.984375)+b},easeInOutBounce:function(c,a,b,d,e){if(a<e/2)return f.easing.easeInBounce(c,a*2,0,d,e)*0.5+b;return f.easing.easeOutBounce(c,
a*2-e,0,d,e)*0.5+d*0.5+b}})}(jQuery);
;/*
 * jQuery UI Effects Blind 1.8.16
 *
 * Copyright 2011, AUTHORS.txt (http://jqueryui.com/about)
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * http://jquery.org/license
 *
 * http://docs.jquery.com/UI/Effects/Blind
 *
 * Depends:
 *	jquery.effects.core.js
 */
(function(b){b.effects.blind=function(c){return this.queue(function(){var a=b(this),g=["position","top","bottom","left","right"],f=b.effects.setMode(a,c.options.mode||"hide"),d=c.options.direction||"vertical";b.effects.save(a,g);a.show();var e=b.effects.createWrapper(a).css({overflow:"hidden"}),h=d=="vertical"?"height":"width";d=d=="vertical"?e.height():e.width();f=="show"&&e.css(h,0);var i={};i[h]=f=="show"?d:0;e.animate(i,c.duration,c.options.easing,function(){f=="hide"&&a.hide();b.effects.restore(a,
g);b.effects.removeWrapper(a);c.callback&&c.callback.apply(a[0],arguments);a.dequeue()})})}})(jQuery);
;/*
 * jQuery UI Effects Bounce 1.8.16
 *
 * Copyright 2011, AUTHORS.txt (http://jqueryui.com/about)
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * http://jquery.org/license
 *
 * http://docs.jquery.com/UI/Effects/Bounce
 *
 * Depends:
 *	jquery.effects.core.js
 */
(function(e){e.effects.bounce=function(b){return this.queue(function(){var a=e(this),l=["position","top","bottom","left","right"],h=e.effects.setMode(a,b.options.mode||"effect"),d=b.options.direction||"up",c=b.options.distance||20,m=b.options.times||5,i=b.duration||250;/show|hide/.test(h)&&l.push("opacity");e.effects.save(a,l);a.show();e.effects.createWrapper(a);var f=d=="up"||d=="down"?"top":"left";d=d=="up"||d=="left"?"pos":"neg";c=b.options.distance||(f=="top"?a.outerHeight({margin:true})/3:a.outerWidth({margin:true})/
3);if(h=="show")a.css("opacity",0).css(f,d=="pos"?-c:c);if(h=="hide")c/=m*2;h!="hide"&&m--;if(h=="show"){var g={opacity:1};g[f]=(d=="pos"?"+=":"-=")+c;a.animate(g,i/2,b.options.easing);c/=2;m--}for(g=0;g<m;g++){var j={},k={};j[f]=(d=="pos"?"-=":"+=")+c;k[f]=(d=="pos"?"+=":"-=")+c;a.animate(j,i/2,b.options.easing).animate(k,i/2,b.options.easing);c=h=="hide"?c*2:c/2}if(h=="hide"){g={opacity:0};g[f]=(d=="pos"?"-=":"+=")+c;a.animate(g,i/2,b.options.easing,function(){a.hide();e.effects.restore(a,l);e.effects.removeWrapper(a);
b.callback&&b.callback.apply(this,arguments)})}else{j={};k={};j[f]=(d=="pos"?"-=":"+=")+c;k[f]=(d=="pos"?"+=":"-=")+c;a.animate(j,i/2,b.options.easing).animate(k,i/2,b.options.easing,function(){e.effects.restore(a,l);e.effects.removeWrapper(a);b.callback&&b.callback.apply(this,arguments)})}a.queue("fx",function(){a.dequeue()});a.dequeue()})}})(jQuery);
;/*
 * jQuery UI Effects Clip 1.8.16
 *
 * Copyright 2011, AUTHORS.txt (http://jqueryui.com/about)
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * http://jquery.org/license
 *
 * http://docs.jquery.com/UI/Effects/Clip
 *
 * Depends:
 *	jquery.effects.core.js
 */
(function(b){b.effects.clip=function(e){return this.queue(function(){var a=b(this),i=["position","top","bottom","left","right","height","width"],f=b.effects.setMode(a,e.options.mode||"hide"),c=e.options.direction||"vertical";b.effects.save(a,i);a.show();var d=b.effects.createWrapper(a).css({overflow:"hidden"});d=a[0].tagName=="IMG"?d:a;var g={size:c=="vertical"?"height":"width",position:c=="vertical"?"top":"left"};c=c=="vertical"?d.height():d.width();if(f=="show"){d.css(g.size,0);d.css(g.position,
c/2)}var h={};h[g.size]=f=="show"?c:0;h[g.position]=f=="show"?0:c/2;d.animate(h,{queue:false,duration:e.duration,easing:e.options.easing,complete:function(){f=="hide"&&a.hide();b.effects.restore(a,i);b.effects.removeWrapper(a);e.callback&&e.callback.apply(a[0],arguments);a.dequeue()}})})}})(jQuery);
;/*
 * jQuery UI Effects Drop 1.8.16
 *
 * Copyright 2011, AUTHORS.txt (http://jqueryui.com/about)
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * http://jquery.org/license
 *
 * http://docs.jquery.com/UI/Effects/Drop
 *
 * Depends:
 *	jquery.effects.core.js
 */
(function(c){c.effects.drop=function(d){return this.queue(function(){var a=c(this),h=["position","top","bottom","left","right","opacity"],e=c.effects.setMode(a,d.options.mode||"hide"),b=d.options.direction||"left";c.effects.save(a,h);a.show();c.effects.createWrapper(a);var f=b=="up"||b=="down"?"top":"left";b=b=="up"||b=="left"?"pos":"neg";var g=d.options.distance||(f=="top"?a.outerHeight({margin:true})/2:a.outerWidth({margin:true})/2);if(e=="show")a.css("opacity",0).css(f,b=="pos"?-g:g);var i={opacity:e==
"show"?1:0};i[f]=(e=="show"?b=="pos"?"+=":"-=":b=="pos"?"-=":"+=")+g;a.animate(i,{queue:false,duration:d.duration,easing:d.options.easing,complete:function(){e=="hide"&&a.hide();c.effects.restore(a,h);c.effects.removeWrapper(a);d.callback&&d.callback.apply(this,arguments);a.dequeue()}})})}})(jQuery);
;/*
 * jQuery UI Effects Explode 1.8.16
 *
 * Copyright 2011, AUTHORS.txt (http://jqueryui.com/about)
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * http://jquery.org/license
 *
 * http://docs.jquery.com/UI/Effects/Explode
 *
 * Depends:
 *	jquery.effects.core.js
 */
(function(j){j.effects.explode=function(a){return this.queue(function(){var c=a.options.pieces?Math.round(Math.sqrt(a.options.pieces)):3,d=a.options.pieces?Math.round(Math.sqrt(a.options.pieces)):3;a.options.mode=a.options.mode=="toggle"?j(this).is(":visible")?"hide":"show":a.options.mode;var b=j(this).show().css("visibility","hidden"),g=b.offset();g.top-=parseInt(b.css("marginTop"),10)||0;g.left-=parseInt(b.css("marginLeft"),10)||0;for(var h=b.outerWidth(true),i=b.outerHeight(true),e=0;e<c;e++)for(var f=
0;f<d;f++)b.clone().appendTo("body").wrap("<div></div>").css({position:"absolute",visibility:"visible",left:-f*(h/d),top:-e*(i/c)}).parent().addClass("ui-effects-explode").css({position:"absolute",overflow:"hidden",width:h/d,height:i/c,left:g.left+f*(h/d)+(a.options.mode=="show"?(f-Math.floor(d/2))*(h/d):0),top:g.top+e*(i/c)+(a.options.mode=="show"?(e-Math.floor(c/2))*(i/c):0),opacity:a.options.mode=="show"?0:1}).animate({left:g.left+f*(h/d)+(a.options.mode=="show"?0:(f-Math.floor(d/2))*(h/d)),top:g.top+
e*(i/c)+(a.options.mode=="show"?0:(e-Math.floor(c/2))*(i/c)),opacity:a.options.mode=="show"?1:0},a.duration||500);setTimeout(function(){a.options.mode=="show"?b.css({visibility:"visible"}):b.css({visibility:"visible"}).hide();a.callback&&a.callback.apply(b[0]);b.dequeue();j("div.ui-effects-explode").remove()},a.duration||500)})}})(jQuery);
;/*
 * jQuery UI Effects Fade 1.8.16
 *
 * Copyright 2011, AUTHORS.txt (http://jqueryui.com/about)
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * http://jquery.org/license
 *
 * http://docs.jquery.com/UI/Effects/Fade
 *
 * Depends:
 *	jquery.effects.core.js
 */
(function(b){b.effects.fade=function(a){return this.queue(function(){var c=b(this),d=b.effects.setMode(c,a.options.mode||"hide");c.animate({opacity:d},{queue:false,duration:a.duration,easing:a.options.easing,complete:function(){a.callback&&a.callback.apply(this,arguments);c.dequeue()}})})}})(jQuery);
;/*
 * jQuery UI Effects Fold 1.8.16
 *
 * Copyright 2011, AUTHORS.txt (http://jqueryui.com/about)
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * http://jquery.org/license
 *
 * http://docs.jquery.com/UI/Effects/Fold
 *
 * Depends:
 *	jquery.effects.core.js
 */
(function(c){c.effects.fold=function(a){return this.queue(function(){var b=c(this),j=["position","top","bottom","left","right"],d=c.effects.setMode(b,a.options.mode||"hide"),g=a.options.size||15,h=!!a.options.horizFirst,k=a.duration?a.duration/2:c.fx.speeds._default/2;c.effects.save(b,j);b.show();var e=c.effects.createWrapper(b).css({overflow:"hidden"}),f=d=="show"!=h,l=f?["width","height"]:["height","width"];f=f?[e.width(),e.height()]:[e.height(),e.width()];var i=/([0-9]+)%/.exec(g);if(i)g=parseInt(i[1],
10)/100*f[d=="hide"?0:1];if(d=="show")e.css(h?{height:0,width:g}:{height:g,width:0});h={};i={};h[l[0]]=d=="show"?f[0]:g;i[l[1]]=d=="show"?f[1]:0;e.animate(h,k,a.options.easing).animate(i,k,a.options.easing,function(){d=="hide"&&b.hide();c.effects.restore(b,j);c.effects.removeWrapper(b);a.callback&&a.callback.apply(b[0],arguments);b.dequeue()})})}})(jQuery);
;/*
 * jQuery UI Effects Highlight 1.8.16
 *
 * Copyright 2011, AUTHORS.txt (http://jqueryui.com/about)
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * http://jquery.org/license
 *
 * http://docs.jquery.com/UI/Effects/Highlight
 *
 * Depends:
 *	jquery.effects.core.js
 */
(function(b){b.effects.highlight=function(c){return this.queue(function(){var a=b(this),e=["backgroundImage","backgroundColor","opacity"],d=b.effects.setMode(a,c.options.mode||"show"),f={backgroundColor:a.css("backgroundColor")};if(d=="hide")f.opacity=0;b.effects.save(a,e);a.show().css({backgroundImage:"none",backgroundColor:c.options.color||"#ffff99"}).animate(f,{queue:false,duration:c.duration,easing:c.options.easing,complete:function(){d=="hide"&&a.hide();b.effects.restore(a,e);d=="show"&&!b.support.opacity&&
this.style.removeAttribute("filter");c.callback&&c.callback.apply(this,arguments);a.dequeue()}})})}})(jQuery);
;/*
 * jQuery UI Effects Pulsate 1.8.16
 *
 * Copyright 2011, AUTHORS.txt (http://jqueryui.com/about)
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * http://jquery.org/license
 *
 * http://docs.jquery.com/UI/Effects/Pulsate
 *
 * Depends:
 *	jquery.effects.core.js
 */
(function(d){d.effects.pulsate=function(a){return this.queue(function(){var b=d(this),c=d.effects.setMode(b,a.options.mode||"show");times=(a.options.times||5)*2-1;duration=a.duration?a.duration/2:d.fx.speeds._default/2;isVisible=b.is(":visible");animateTo=0;if(!isVisible){b.css("opacity",0).show();animateTo=1}if(c=="hide"&&isVisible||c=="show"&&!isVisible)times--;for(c=0;c<times;c++){b.animate({opacity:animateTo},duration,a.options.easing);animateTo=(animateTo+1)%2}b.animate({opacity:animateTo},duration,
a.options.easing,function(){animateTo==0&&b.hide();a.callback&&a.callback.apply(this,arguments)});b.queue("fx",function(){b.dequeue()}).dequeue()})}})(jQuery);
;/*
 * jQuery UI Effects Scale 1.8.16
 *
 * Copyright 2011, AUTHORS.txt (http://jqueryui.com/about)
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * http://jquery.org/license
 *
 * http://docs.jquery.com/UI/Effects/Scale
 *
 * Depends:
 *	jquery.effects.core.js
 */
(function(c){c.effects.puff=function(b){return this.queue(function(){var a=c(this),e=c.effects.setMode(a,b.options.mode||"hide"),g=parseInt(b.options.percent,10)||150,h=g/100,i={height:a.height(),width:a.width()};c.extend(b.options,{fade:true,mode:e,percent:e=="hide"?g:100,from:e=="hide"?i:{height:i.height*h,width:i.width*h}});a.effect("scale",b.options,b.duration,b.callback);a.dequeue()})};c.effects.scale=function(b){return this.queue(function(){var a=c(this),e=c.extend(true,{},b.options),g=c.effects.setMode(a,
b.options.mode||"effect"),h=parseInt(b.options.percent,10)||(parseInt(b.options.percent,10)==0?0:g=="hide"?0:100),i=b.options.direction||"both",f=b.options.origin;if(g!="effect"){e.origin=f||["middle","center"];e.restore=true}f={height:a.height(),width:a.width()};a.from=b.options.from||(g=="show"?{height:0,width:0}:f);h={y:i!="horizontal"?h/100:1,x:i!="vertical"?h/100:1};a.to={height:f.height*h.y,width:f.width*h.x};if(b.options.fade){if(g=="show"){a.from.opacity=0;a.to.opacity=1}if(g=="hide"){a.from.opacity=
1;a.to.opacity=0}}e.from=a.from;e.to=a.to;e.mode=g;a.effect("size",e,b.duration,b.callback);a.dequeue()})};c.effects.size=function(b){return this.queue(function(){var a=c(this),e=["position","top","bottom","left","right","width","height","overflow","opacity"],g=["position","top","bottom","left","right","overflow","opacity"],h=["width","height","overflow"],i=["fontSize"],f=["borderTopWidth","borderBottomWidth","paddingTop","paddingBottom"],k=["borderLeftWidth","borderRightWidth","paddingLeft","paddingRight"],
p=c.effects.setMode(a,b.options.mode||"effect"),n=b.options.restore||false,m=b.options.scale||"both",l=b.options.origin,j={height:a.height(),width:a.width()};a.from=b.options.from||j;a.to=b.options.to||j;if(l){l=c.effects.getBaseline(l,j);a.from.top=(j.height-a.from.height)*l.y;a.from.left=(j.width-a.from.width)*l.x;a.to.top=(j.height-a.to.height)*l.y;a.to.left=(j.width-a.to.width)*l.x}var d={from:{y:a.from.height/j.height,x:a.from.width/j.width},to:{y:a.to.height/j.height,x:a.to.width/j.width}};
if(m=="box"||m=="both"){if(d.from.y!=d.to.y){e=e.concat(f);a.from=c.effects.setTransition(a,f,d.from.y,a.from);a.to=c.effects.setTransition(a,f,d.to.y,a.to)}if(d.from.x!=d.to.x){e=e.concat(k);a.from=c.effects.setTransition(a,k,d.from.x,a.from);a.to=c.effects.setTransition(a,k,d.to.x,a.to)}}if(m=="content"||m=="both")if(d.from.y!=d.to.y){e=e.concat(i);a.from=c.effects.setTransition(a,i,d.from.y,a.from);a.to=c.effects.setTransition(a,i,d.to.y,a.to)}c.effects.save(a,n?e:g);a.show();c.effects.createWrapper(a);
a.css("overflow","hidden").css(a.from);if(m=="content"||m=="both"){f=f.concat(["marginTop","marginBottom"]).concat(i);k=k.concat(["marginLeft","marginRight"]);h=e.concat(f).concat(k);a.find("*[width]").each(function(){child=c(this);n&&c.effects.save(child,h);var o={height:child.height(),width:child.width()};child.from={height:o.height*d.from.y,width:o.width*d.from.x};child.to={height:o.height*d.to.y,width:o.width*d.to.x};if(d.from.y!=d.to.y){child.from=c.effects.setTransition(child,f,d.from.y,child.from);
child.to=c.effects.setTransition(child,f,d.to.y,child.to)}if(d.from.x!=d.to.x){child.from=c.effects.setTransition(child,k,d.from.x,child.from);child.to=c.effects.setTransition(child,k,d.to.x,child.to)}child.css(child.from);child.animate(child.to,b.duration,b.options.easing,function(){n&&c.effects.restore(child,h)})})}a.animate(a.to,{queue:false,duration:b.duration,easing:b.options.easing,complete:function(){a.to.opacity===0&&a.css("opacity",a.from.opacity);p=="hide"&&a.hide();c.effects.restore(a,
n?e:g);c.effects.removeWrapper(a);b.callback&&b.callback.apply(this,arguments);a.dequeue()}})})}})(jQuery);
;/*
 * jQuery UI Effects Shake 1.8.16
 *
 * Copyright 2011, AUTHORS.txt (http://jqueryui.com/about)
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * http://jquery.org/license
 *
 * http://docs.jquery.com/UI/Effects/Shake
 *
 * Depends:
 *	jquery.effects.core.js
 */
(function(d){d.effects.shake=function(a){return this.queue(function(){var b=d(this),j=["position","top","bottom","left","right"];d.effects.setMode(b,a.options.mode||"effect");var c=a.options.direction||"left",e=a.options.distance||20,l=a.options.times||3,f=a.duration||a.options.duration||140;d.effects.save(b,j);b.show();d.effects.createWrapper(b);var g=c=="up"||c=="down"?"top":"left",h=c=="up"||c=="left"?"pos":"neg";c={};var i={},k={};c[g]=(h=="pos"?"-=":"+=")+e;i[g]=(h=="pos"?"+=":"-=")+e*2;k[g]=
(h=="pos"?"-=":"+=")+e*2;b.animate(c,f,a.options.easing);for(e=1;e<l;e++)b.animate(i,f,a.options.easing).animate(k,f,a.options.easing);b.animate(i,f,a.options.easing).animate(c,f/2,a.options.easing,function(){d.effects.restore(b,j);d.effects.removeWrapper(b);a.callback&&a.callback.apply(this,arguments)});b.queue("fx",function(){b.dequeue()});b.dequeue()})}})(jQuery);
;/*
 * jQuery UI Effects Slide 1.8.16
 *
 * Copyright 2011, AUTHORS.txt (http://jqueryui.com/about)
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * http://jquery.org/license
 *
 * http://docs.jquery.com/UI/Effects/Slide
 *
 * Depends:
 *	jquery.effects.core.js
 */
(function(c){c.effects.slide=function(d){return this.queue(function(){var a=c(this),h=["position","top","bottom","left","right"],f=c.effects.setMode(a,d.options.mode||"show"),b=d.options.direction||"left";c.effects.save(a,h);a.show();c.effects.createWrapper(a).css({overflow:"hidden"});var g=b=="up"||b=="down"?"top":"left";b=b=="up"||b=="left"?"pos":"neg";var e=d.options.distance||(g=="top"?a.outerHeight({margin:true}):a.outerWidth({margin:true}));if(f=="show")a.css(g,b=="pos"?isNaN(e)?"-"+e:-e:e);
var i={};i[g]=(f=="show"?b=="pos"?"+=":"-=":b=="pos"?"-=":"+=")+e;a.animate(i,{queue:false,duration:d.duration,easing:d.options.easing,complete:function(){f=="hide"&&a.hide();c.effects.restore(a,h);c.effects.removeWrapper(a);d.callback&&d.callback.apply(this,arguments);a.dequeue()}})})}})(jQuery);
;/*
 * jQuery UI Effects Transfer 1.8.16
 *
 * Copyright 2011, AUTHORS.txt (http://jqueryui.com/about)
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * http://jquery.org/license
 *
 * http://docs.jquery.com/UI/Effects/Transfer
 *
 * Depends:
 *	jquery.effects.core.js
 */
(function(e){e.effects.transfer=function(a){return this.queue(function(){var b=e(this),c=e(a.options.to),d=c.offset();c={top:d.top,left:d.left,height:c.innerHeight(),width:c.innerWidth()};d=b.offset();var f=e('<div class="ui-effects-transfer"></div>').appendTo(document.body).addClass(a.options.className).css({top:d.top,left:d.left,height:b.innerHeight(),width:b.innerWidth(),position:"absolute"}).animate(c,a.duration,a.options.easing,function(){f.remove();a.callback&&a.callback.apply(b[0],arguments);
b.dequeue()})})}})(jQuery);
;
},{}],3:[function(require,module,exports){

(function($){$.toJSON=function(o)
{if(typeof(JSON)=='object'&&JSON.stringify)
return JSON.stringify(o);var type=typeof(o);if(o===null)
return"null";if(type=="undefined")
return undefined;if(type=="number"||type=="boolean")
return o+"";if(type=="string")
return $.quoteString(o);if(type=='object')
{if(typeof o.toJSON=="function")
return $.toJSON(o.toJSON());if(o.constructor===Date)
{var month=o.getUTCMonth()+1;if(month<10)month='0'+month;var day=o.getUTCDate();if(day<10)day='0'+day;var year=o.getUTCFullYear();var hours=o.getUTCHours();if(hours<10)hours='0'+hours;var minutes=o.getUTCMinutes();if(minutes<10)minutes='0'+minutes;var seconds=o.getUTCSeconds();if(seconds<10)seconds='0'+seconds;var milli=o.getUTCMilliseconds();if(milli<100)milli='0'+milli;if(milli<10)milli='0'+milli;return'"'+year+'-'+month+'-'+day+'T'+
hours+':'+minutes+':'+seconds+'.'+milli+'Z"';}
if(o.constructor===Array)
{var ret=[];for(var i=0;i<o.length;i++)
ret.push($.toJSON(o[i])||"null");return"["+ret.join(",")+"]";}
var pairs=[];for(var k in o){var name;var type=typeof k;if(type=="number")
name='"'+k+'"';else if(type=="string")
name=$.quoteString(k);else
continue;if(typeof o[k]=="function")
continue;var val=$.toJSON(o[k]);pairs.push(name+":"+val);}
return"{"+pairs.join(", ")+"}";}};$.evalJSON=function(src)
{if(typeof(JSON)=='object'&&JSON.parse)
return JSON.parse(src);return eval("("+src+")");};$.secureEvalJSON=function(src)
{if(typeof(JSON)=='object'&&JSON.parse)
return JSON.parse(src);var filtered=src;filtered=filtered.replace(/\\["\\\/bfnrtu]/g,'@');filtered=filtered.replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,']');filtered=filtered.replace(/(?:^|:|,)(?:\s*\[)+/g,'');if(/^[\],:{}\s]*$/.test(filtered))
return eval("("+src+")");else
throw new SyntaxError("Error parsing JSON, source is not valid.");};$.quoteString=function(string)
{if(string.match(_escapeable))
{return'"'+string.replace(_escapeable,function(a)
{var c=_meta[a];if(typeof c==='string')return c;c=a.charCodeAt();return'\\u00'+Math.floor(c/16).toString(16)+(c%16).toString(16);})+'"';}
return'"'+string+'"';};var _escapeable=/["\\\x00-\x1f\x7f-\x9f]/g;var _meta={'\b':'\\b','\t':'\\t','\n':'\\n','\f':'\\f','\r':'\\r','"':'\\"','\\':'\\\\'};})(jQuery);
},{}],4:[function(require,module,exports){
/**
 * sprintf and vsprintf for jQuery
 * somewhat based on http://jan.moesen.nu/code/javascript/sprintf-and-printf-in-javascript/
 * 
 * Copyright (c) 2008 Sabin Iacob (m0n5t3r) <iacobs@m0n5t3r.info>
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details. 
 *
 * @license http://www.gnu.org/licenses/gpl.html 
 * @project jquery.sprintf
 */
(function($){
	var formats = {
		'b': function(val) {return parseInt(val, 10).toString(2);},
		'c': function(val) {return String.fromCharCode(parseInt(val, 10));},
		'd': function(val) {return parseInt(val, 10);},
		'u': function(val) {return Math.abs(val);},
		'f': function(val, p) {
			p = parseInt(p, 10); 
			val = parseFloat(val);
			if(isNaN(p && val)) {
				return NaN;
			}
			return p && val.toFixed(p) || val;
		},
		'o': function(val) {return parseInt(val, 10).toString(8);},
		's': function(val) {return val;},
		'x': function(val) {return ('' + parseInt(val, 10).toString(16)).toLowerCase();},
		'X': function(val) {return ('' + parseInt(val, 10).toString(16)).toUpperCase();}
	};

	var re = /%(?:(\d+)?(?:\.(\d+))?|\(([^)]+)\))([%bcdufosxX])/g;

	var dispatch = function(data){
		if(data.length == 1 && typeof data[0] == 'object') { //python-style printf
			data = data[0];
			return function(match, w, p, lbl, fmt, off, str) {
				return formats[fmt](data[lbl]);
			};
		} else { // regular, somewhat incomplete, printf
			var idx = 0; 
			return function(match, w, p, lbl, fmt, off, str) {
				if(fmt == '%') {
					return '%';
				}
				return formats[fmt](data[idx++], p);
			};
		}
	};

	$.extend({
		sprintf: function(format) {
			var argv = Array.apply(null, arguments).slice(1);
			return format.replace(re, dispatch(argv));
		},
		vsprintf: function(format, data) {
			return format.replace(re, dispatch(data));
		}
	});
})(jQuery);

},{}],5:[function(require,module,exports){
/* http://keith-wood.name/svg.html
   SVG for jQuery v1.4.3.
   Written by Keith Wood (kbwood{at}iinet.com.au) August 2007.
   Dual licensed under the GPL (http://dev.jquery.com/browser/trunk/jquery/GPL-LICENSE.txt) and 
   MIT (http://dev.jquery.com/browser/trunk/jquery/MIT-LICENSE.txt) licenses. 
   Please attribute the author if you use it. */
(function($){function SVGManager(){this._settings=[];this._extensions=[];this.regional=[];this.regional['']={errorLoadingText:'Error loading',notSupportedText:'This browser does not support SVG'};this.local=this.regional[''];this._uuid=new Date().getTime();this._renesis=detectActiveX('RenesisX.RenesisCtrl')}function detectActiveX(a){try{return!!(window.ActiveXObject&&new ActiveXObject(a))}catch(e){return false}}var p='svgwrapper';$.extend(SVGManager.prototype,{markerClassName:'hasSVG',svgNS:'http://www.w3.org/2000/svg',xlinkNS:'http://www.w3.org/1999/xlink',_wrapperClass:SVGWrapper,_attrNames:{class_:'class',in_:'in',alignmentBaseline:'alignment-baseline',baselineShift:'baseline-shift',clipPath:'clip-path',clipRule:'clip-rule',colorInterpolation:'color-interpolation',colorInterpolationFilters:'color-interpolation-filters',colorRendering:'color-rendering',dominantBaseline:'dominant-baseline',enableBackground:'enable-background',fillOpacity:'fill-opacity',fillRule:'fill-rule',floodColor:'flood-color',floodOpacity:'flood-opacity',fontFamily:'font-family',fontSize:'font-size',fontSizeAdjust:'font-size-adjust',fontStretch:'font-stretch',fontStyle:'font-style',fontVariant:'font-variant',fontWeight:'font-weight',glyphOrientationHorizontal:'glyph-orientation-horizontal',glyphOrientationVertical:'glyph-orientation-vertical',horizAdvX:'horiz-adv-x',horizOriginX:'horiz-origin-x',imageRendering:'image-rendering',letterSpacing:'letter-spacing',lightingColor:'lighting-color',markerEnd:'marker-end',markerMid:'marker-mid',markerStart:'marker-start',stopColor:'stop-color',stopOpacity:'stop-opacity',strikethroughPosition:'strikethrough-position',strikethroughThickness:'strikethrough-thickness',strokeDashArray:'stroke-dasharray',strokeDashOffset:'stroke-dashoffset',strokeLineCap:'stroke-linecap',strokeLineJoin:'stroke-linejoin',strokeMiterLimit:'stroke-miterlimit',strokeOpacity:'stroke-opacity',strokeWidth:'stroke-width',textAnchor:'text-anchor',textDecoration:'text-decoration',textRendering:'text-rendering',underlinePosition:'underline-position',underlineThickness:'underline-thickness',vertAdvY:'vert-adv-y',vertOriginY:'vert-origin-y',wordSpacing:'word-spacing',writingMode:'writing-mode'},_attachSVG:function(a,b){var c=(a.namespaceURI==this.svgNS?a:null);var a=(c?null:a);if($(a||c).hasClass(this.markerClassName)){return}if(typeof b=='string'){b={loadURL:b}}else if(typeof b=='function'){b={onLoad:b}}$(a||c).addClass(this.markerClassName);try{if(!c){c=document.createElementNS(this.svgNS,'svg');c.setAttribute('version','1.1');c.setAttribute('width',a.clientWidth);c.setAttribute('height',a.clientHeight);a.appendChild(c)}this._afterLoad(a,c,b||{})}catch(e){if($.browser.msie){if(!a.id){a.id='svg'+(this._uuid++)}this._settings[a.id]=b;a.innerHTML='<embed type="image/svg+xml" width="100%" '+'height="100%" src="'+(b.initPath||'')+'blank.svg"/>'}else{a.innerHTML='<p class="svg_error">'+this.local.notSupportedText+'</p>'}}},_registerSVG:function(){for(var i=0;i<document.embeds.length;i++){var a=document.embeds[i].parentNode;if(!$(a).hasClass($.svg.markerClassName)||$.data(a,p)){continue}var b=null;try{b=document.embeds[i].getSVGDocument()}catch(e){setTimeout($.svg._registerSVG,250);return}b=(b?b.documentElement:null);if(b){$.svg._afterLoad(a,b)}}},_afterLoad:function(a,b,c){var c=c||this._settings[a.id];this._settings[a?a.id:'']=null;var d=new this._wrapperClass(b,a);$.data(a||b,p,d);try{if(c.loadURL){d.load(c.loadURL,c)}if(c.settings){d.configure(c.settings)}if(c.onLoad&&!c.loadURL){c.onLoad.apply(a||b,[d])}}catch(e){alert(e)}},_getSVG:function(a){a=(typeof a=='string'?$(a)[0]:(a.jquery?a[0]:a));return $.data(a,p)},_destroySVG:function(a){var b=$(a);if(!b.hasClass(this.markerClassName)){return}b.removeClass(this.markerClassName);if(a.namespaceURI!=this.svgNS){b.empty()}$.removeData(a,p)},addExtension:function(a,b){this._extensions.push([a,b])}});function SVGWrapper(a,b){this._svg=a;this._container=b;for(var i=0;i<$.svg._extensions.length;i++){var c=$.svg._extensions[i];this[c[0]]=new c[1](this)}}$.extend(SVGWrapper.prototype,{_width:function(){return(this._container?this._container.clientWidth:this._svg.width)},_height:function(){return(this._container?this._container.clientHeight:this._svg.height)},root:function(){return this._svg},configure:function(a,b){if(b){for(var i=this._svg.attributes.length-1;i>=0;i--){var c=this._svg.attributes.item(i);if(!(c.nodeName=='onload'||c.nodeName=='version'||c.nodeName.substring(0,5)=='xmlns')){this._svg.attributes.removeNamedItem(c.nodeName)}}}for(var d in a){this._svg.setAttribute(d,a[d])}return this},getElementById:function(a){return this._svg.ownerDocument.getElementById(a)},change:function(a,b){if(a){for(var c in b){if(b[c]==null){a.removeAttribute(c)}else{a.setAttribute(c,b[c])}}}return this},_args:function(b,c,d){c.splice(0,0,'parent');c.splice(c.length,0,'settings');var e={};var f=0;if(b[0]!=null&&b[0].jquery){b[0]=b[0][0]}if(b[0]!=null&&!(typeof b[0]=='object'&&b[0].nodeName)){e['parent']=null;f=1}for(var i=0;i<b.length;i++){e[c[i+f]]=b[i]}if(d){$.each(d,function(i,a){if(typeof e[a]=='object'){e.settings=e[a];e[a]=null}})}return e},title:function(a,b,c){var d=this._args(arguments,['text']);var e=this._makeNode(d.parent,'title',d.settings||{});e.appendChild(this._svg.ownerDocument.createTextNode(d.text));return e},describe:function(a,b,c){var d=this._args(arguments,['text']);var e=this._makeNode(d.parent,'desc',d.settings||{});e.appendChild(this._svg.ownerDocument.createTextNode(d.text));return e},defs:function(a,b,c){var d=this._args(arguments,['id'],['id']);return this._makeNode(d.parent,'defs',$.extend((d.id?{id:d.id}:{}),d.settings||{}))},symbol:function(a,b,c,d,e,f,g){var h=this._args(arguments,['id','x1','y1','width','height']);return this._makeNode(h.parent,'symbol',$.extend({id:h.id,viewBox:h.x1+' '+h.y1+' '+h.width+' '+h.height},h.settings||{}))},marker:function(a,b,c,d,e,f,g,h){var i=this._args(arguments,['id','refX','refY','mWidth','mHeight','orient'],['orient']);return this._makeNode(i.parent,'marker',$.extend({id:i.id,refX:i.refX,refY:i.refY,markerWidth:i.mWidth,markerHeight:i.mHeight,orient:i.orient||'auto'},i.settings||{}))},style:function(a,b,c){var d=this._args(arguments,['styles']);var e=this._makeNode(d.parent,'style',$.extend({type:'text/css'},d.settings||{}));e.appendChild(this._svg.ownerDocument.createTextNode(d.styles));if($.browser.opera){$('head').append('<style type="text/css">'+d.styles+'</style>')}return e},script:function(a,b,c,d){var e=this._args(arguments,['script','type'],['type']);var f=this._makeNode(e.parent,'script',$.extend({type:e.type||'text/javascript'},e.settings||{}));f.appendChild(this._svg.ownerDocument.createTextNode(this._escapeXML(e.script)));if(!$.browser.mozilla){$.globalEval(e.script)}return f},linearGradient:function(a,b,c,d,e,f,g,h){var i=this._args(arguments,['id','stops','x1','y1','x2','y2'],['x1']);var j=$.extend({id:i.id},(i.x1!=null?{x1:i.x1,y1:i.y1,x2:i.x2,y2:i.y2}:{}));return this._gradient(i.parent,'linearGradient',$.extend(j,i.settings||{}),i.stops)},radialGradient:function(a,b,c,d,e,r,f,g,h){var i=this._args(arguments,['id','stops','cx','cy','r','fx','fy'],['cx']);var j=$.extend({id:i.id},(i.cx!=null?{cx:i.cx,cy:i.cy,r:i.r,fx:i.fx,fy:i.fy}:{}));return this._gradient(i.parent,'radialGradient',$.extend(j,i.settings||{}),i.stops)},_gradient:function(a,b,c,d){var e=this._makeNode(a,b,c);for(var i=0;i<d.length;i++){var f=d[i];this._makeNode(e,'stop',$.extend({offset:f[0],stopColor:f[1]},(f[2]!=null?{stopOpacity:f[2]}:{})))}return e},pattern:function(a,b,x,y,c,d,e,f,g,h,i){var j=this._args(arguments,['id','x','y','width','height','vx','vy','vwidth','vheight'],['vx']);var k=$.extend({id:j.id,x:j.x,y:j.y,width:j.width,height:j.height},(j.vx!=null?{viewBox:j.vx+' '+j.vy+' '+j.vwidth+' '+j.vheight}:{}));return this._makeNode(j.parent,'pattern',$.extend(k,j.settings||{}))},mask:function(a,b,x,y,c,d,e){var f=this._args(arguments,['id','x','y','width','height']);return this._makeNode(f.parent,'mask',$.extend({id:f.id,x:f.x,y:f.y,width:f.width,height:f.height},f.settings||{}))},createPath:function(){return new SVGPath()},createText:function(){return new SVGText()},svg:function(a,x,y,b,c,d,e,f,g,h){var i=this._args(arguments,['x','y','width','height','vx','vy','vwidth','vheight'],['vx']);var j=$.extend({x:i.x,y:i.y,width:i.width,height:i.height},(i.vx!=null?{viewBox:i.vx+' '+i.vy+' '+i.vwidth+' '+i.vheight}:{}));return this._makeNode(i.parent,'svg',$.extend(j,i.settings||{}))},group:function(a,b,c){var d=this._args(arguments,['id'],['id']);return this._makeNode(d.parent,'g',$.extend({id:d.id},d.settings||{}))},use:function(a,x,y,b,c,d,e){var f=this._args(arguments,['x','y','width','height','ref']);if(typeof f.x=='string'){f.ref=f.x;f.settings=f.y;f.x=f.y=f.width=f.height=null}var g=this._makeNode(f.parent,'use',$.extend({x:f.x,y:f.y,width:f.width,height:f.height},f.settings||{}));g.setAttributeNS($.svg.xlinkNS,'href',f.ref);return g},link:function(a,b,c){var d=this._args(arguments,['ref']);var e=this._makeNode(d.parent,'a',d.settings);e.setAttributeNS($.svg.xlinkNS,'href',d.ref);return e},image:function(a,x,y,b,c,d,e){var f=this._args(arguments,['x','y','width','height','ref']);var g=this._makeNode(f.parent,'image',$.extend({x:f.x,y:f.y,width:f.width,height:f.height},f.settings||{}));g.setAttributeNS($.svg.xlinkNS,'href',f.ref);return g},path:function(a,b,c){var d=this._args(arguments,['path']);return this._makeNode(d.parent,'path',$.extend({d:(d.path.path?d.path.path():d.path)},d.settings||{}))},rect:function(a,x,y,b,c,d,e,f){var g=this._args(arguments,['x','y','width','height','rx','ry'],['rx']);return this._makeNode(g.parent,'rect',$.extend({x:g.x,y:g.y,width:g.width,height:g.height},(g.rx?{rx:g.rx,ry:g.ry}:{}),g.settings||{}))},circle:function(a,b,c,r,d){var e=this._args(arguments,['cx','cy','r']);return this._makeNode(e.parent,'circle',$.extend({cx:e.cx,cy:e.cy,r:e.r},e.settings||{}))},ellipse:function(a,b,c,d,e,f){var g=this._args(arguments,['cx','cy','rx','ry']);return this._makeNode(g.parent,'ellipse',$.extend({cx:g.cx,cy:g.cy,rx:g.rx,ry:g.ry},g.settings||{}))},line:function(a,b,c,d,e,f){var g=this._args(arguments,['x1','y1','x2','y2']);return this._makeNode(g.parent,'line',$.extend({x1:g.x1,y1:g.y1,x2:g.x2,y2:g.y2},g.settings||{}))},polyline:function(a,b,c){var d=this._args(arguments,['points']);return this._poly(d.parent,'polyline',d.points,d.settings)},polygon:function(a,b,c){var d=this._args(arguments,['points']);return this._poly(d.parent,'polygon',d.points,d.settings)},_poly:function(a,b,c,d){var e='';for(var i=0;i<c.length;i++){e+=c[i].join()+' '}return this._makeNode(a,b,$.extend({points:$.trim(e)},d||{}))},text:function(a,x,y,b,c){var d=this._args(arguments,['x','y','value']);if(typeof d.x=='string'&&arguments.length<4){d.value=d.x;d.settings=d.y;d.x=d.y=null}return this._text(d.parent,'text',d.value,$.extend({x:(d.x&&isArray(d.x)?d.x.join(' '):d.x),y:(d.y&&isArray(d.y)?d.y.join(' '):d.y)},d.settings||{}))},textpath:function(a,b,c,d){var e=this._args(arguments,['path','value']);var f=this._text(e.parent,'textPath',e.value,e.settings||{});f.setAttributeNS($.svg.xlinkNS,'href',e.path);return f},_text:function(a,b,c,d){var e=this._makeNode(a,b,d);if(typeof c=='string'){e.appendChild(e.ownerDocument.createTextNode(c))}else{for(var i=0;i<c._parts.length;i++){var f=c._parts[i];if(f[0]=='tspan'){var g=this._makeNode(e,f[0],f[2]);g.appendChild(e.ownerDocument.createTextNode(f[1]));e.appendChild(g)}else if(f[0]=='tref'){var g=this._makeNode(e,f[0],f[2]);g.setAttributeNS($.svg.xlinkNS,'href',f[1]);e.appendChild(g)}else if(f[0]=='textpath'){var h=$.extend({},f[2]);h.href=null;var g=this._makeNode(e,f[0],h);g.setAttributeNS($.svg.xlinkNS,'href',f[2].href);g.appendChild(e.ownerDocument.createTextNode(f[1]));e.appendChild(g)}else{e.appendChild(e.ownerDocument.createTextNode(f[1]))}}}return e},other:function(a,b,c){var d=this._args(arguments,['name']);return this._makeNode(d.parent,d.name,d.settings||{})},_makeNode:function(a,b,c){a=a||this._svg;var d=this._svg.ownerDocument.createElementNS($.svg.svgNS,b);for(var b in c){var e=c[b];if(e!=null&&e!=null&&(typeof e!='string'||e!='')){d.setAttribute($.svg._attrNames[b]||b,e)}}a.appendChild(d);return d},add:function(b,c){var d=this._args((arguments.length==1?[null,b]:arguments),['node']);var f=this;d.parent=d.parent||this._svg;try{if($.svg._renesis){throw'Force traversal';}d.parent.appendChild(d.node.cloneNode(true))}catch(e){d.node=(d.node.jquery?d.node:$(d.node));d.node.each(function(){var a=f._cloneAsSVG(this);if(a){d.parent.appendChild(a)}})}return this},_cloneAsSVG:function(a){var b=null;if(a.nodeType==1){b=this._svg.ownerDocument.createElementNS($.svg.svgNS,this._checkName(a.nodeName));for(var i=0;i<a.attributes.length;i++){var c=a.attributes.item(i);if(c.nodeName!='xmlns'&&c.nodeValue){if(c.prefix=='xlink'){b.setAttributeNS($.svg.xlinkNS,c.localName,c.nodeValue)}else{b.setAttribute(this._checkName(c.nodeName),c.nodeValue)}}}for(var i=0;i<a.childNodes.length;i++){var d=this._cloneAsSVG(a.childNodes[i]);if(d){b.appendChild(d)}}}else if(a.nodeType==3){if($.trim(a.nodeValue)){b=this._svg.ownerDocument.createTextNode(a.nodeValue)}}else if(a.nodeType==4){if($.trim(a.nodeValue)){try{b=this._svg.ownerDocument.createCDATASection(a.nodeValue)}catch(e){b=this._svg.ownerDocument.createTextNode(a.nodeValue.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;'))}}}return b},_checkName:function(a){a=(a.substring(0,1)>='A'&&a.substring(0,1)<='Z'?a.toLowerCase():a);return(a.substring(0,4)=='svg:'?a.substring(4):a)},load:function(h,j){j=(typeof j=='boolean'?{addTo:j}:(typeof j=='function'?{onLoad:j}:j||{}));if(!j.addTo){this.clear(false)}var k=[this._svg.getAttribute('width'),this._svg.getAttribute('height')];var l=this;var m=function(a){a=$.svg.local.errorLoadingText+': '+a;if(j.onLoad){j.onLoad.apply(l._container||l._svg,[l,a])}else{l.text(null,10,20,a)}};var n=function(a){var b=new ActiveXObject('Microsoft.XMLDOM');b.validateOnParse=false;b.resolveExternals=false;b.async=false;b.loadXML(a);if(b.parseError.errorCode!=0){m(b.parseError.reason);return null}return b};var o=function(a){if(!a){return}if(a.documentElement.nodeName!='svg'){var b=a.getElementsByTagName('parsererror');var c=(b.length?b[0].getElementsByTagName('div'):[]);m(!b.length?'???':(c.length?c[0]:b[0]).firstChild.nodeValue);return}var d={};for(var i=0;i<a.documentElement.attributes.length;i++){var f=a.documentElement.attributes.item(i);if(!(f.nodeName=='version'||f.nodeName.substring(0,5)=='xmlns')){d[f.nodeName]=f.nodeValue}}l.configure(d,true);var g=a.documentElement.childNodes;for(var i=0;i<g.length;i++){try{if($.svg._renesis){throw'Force traversal';}l._svg.appendChild(g[i].cloneNode(true));if(g[i].nodeName=='script'){$.globalEval(g[i].textContent)}}catch(e){l.add(null,g[i])}}if(!j.changeSize){l.configure({width:k[0],height:k[1]})}if(j.onLoad){j.onLoad.apply(l._container||l._svg,[l])}};if(h.match('<svg')){o($.browser.msie?n(h):new DOMParser().parseFromString(h,'text/xml'))}else{$.ajax({url:h,dataType:($.browser.msie?'text':'xml'),success:function(a){o($.browser.msie?n(a):a)},error:function(a,b,c){m(b+(c?' '+c.message:''))}})}return this},remove:function(a){a=(a.jquery?a[0]:a);a.parentNode.removeChild(a);return this},clear:function(a){if(a){this.configure({},true)}while(this._svg.firstChild){this._svg.removeChild(this._svg.firstChild)}return this},toSVG:function(a){a=a||this._svg;return(typeof XMLSerializer=='undefined'?this._toSVG(a):new XMLSerializer().serializeToString(a))},_toSVG:function(a){var b='';if(!a){return b}if(a.nodeType==3){b=a.nodeValue}else if(a.nodeType==4){b='<![CDATA['+a.nodeValue+']]>'}else{b='<'+a.nodeName;if(a.attributes){for(var i=0;i<a.attributes.length;i++){var c=a.attributes.item(i);if(!($.trim(c.nodeValue)==''||c.nodeValue.match(/^\[object/)||c.nodeValue.match(/^function/))){b+=' '+(c.namespaceURI==$.svg.xlinkNS?'xlink:':'')+c.nodeName+'="'+c.nodeValue+'"'}}}if(a.firstChild){b+='>';var d=a.firstChild;while(d){b+=this._toSVG(d);d=d.nextSibling}b+='</'+a.nodeName+'>'}else{b+='/>'}}return b},_escapeXML:function(a){a=a.replace(/&/g,'&amp;');a=a.replace(/</g,'&lt;');a=a.replace(/>/g,'&gt;');return a}});function SVGPath(){this._path=''}$.extend(SVGPath.prototype,{reset:function(){this._path='';return this},move:function(x,y,a){a=(isArray(x)?y:a);return this._coords((a?'m':'M'),x,y)},line:function(x,y,a){a=(isArray(x)?y:a);return this._coords((a?'l':'L'),x,y)},horiz:function(x,a){this._path+=(a?'h':'H')+(isArray(x)?x.join(' '):x);return this},vert:function(y,a){this._path+=(a?'v':'V')+(isArray(y)?y.join(' '):y);return this},curveC:function(a,b,c,d,x,y,e){e=(isArray(a)?b:e);return this._coords((e?'c':'C'),a,b,c,d,x,y)},smoothC:function(a,b,x,y,c){c=(isArray(a)?b:c);return this._coords((c?'s':'S'),a,b,x,y)},curveQ:function(a,b,x,y,c){c=(isArray(a)?b:c);return this._coords((c?'q':'Q'),a,b,x,y)},smoothQ:function(x,y,a){a=(isArray(x)?y:a);return this._coords((a?'t':'T'),x,y)},_coords:function(a,b,c,d,e,f,g){if(isArray(b)){for(var i=0;i<b.length;i++){var h=b[i];this._path+=(i==0?a:' ')+h[0]+','+h[1]+(h.length<4?'':' '+h[2]+','+h[3]+(h.length<6?'':' '+h[4]+','+h[5]))}}else{this._path+=a+b+','+c+(d==null?'':' '+d+','+e+(f==null?'':' '+f+','+g))}return this},arc:function(a,b,c,d,e,x,y,f){f=(isArray(a)?b:f);this._path+=(f?'a':'A');if(isArray(a)){for(var i=0;i<a.length;i++){var g=a[i];this._path+=(i==0?'':' ')+g[0]+','+g[1]+' '+g[2]+' '+(g[3]?'1':'0')+','+(g[4]?'1':'0')+' '+g[5]+','+g[6]}}else{this._path+=a+','+b+' '+c+' '+(d?'1':'0')+','+(e?'1':'0')+' '+x+','+y}return this},close:function(){this._path+='z';return this},path:function(){return this._path}});SVGPath.prototype.moveTo=SVGPath.prototype.move;SVGPath.prototype.lineTo=SVGPath.prototype.line;SVGPath.prototype.horizTo=SVGPath.prototype.horiz;SVGPath.prototype.vertTo=SVGPath.prototype.vert;SVGPath.prototype.curveCTo=SVGPath.prototype.curveC;SVGPath.prototype.smoothCTo=SVGPath.prototype.smoothC;SVGPath.prototype.curveQTo=SVGPath.prototype.curveQ;SVGPath.prototype.smoothQTo=SVGPath.prototype.smoothQ;SVGPath.prototype.arcTo=SVGPath.prototype.arc;function SVGText(){this._parts=[]}$.extend(SVGText.prototype,{reset:function(){this._parts=[];return this},string:function(a){this._parts[this._parts.length]=['text',a];return this},span:function(a,b){this._parts[this._parts.length]=['tspan',a,b];return this},ref:function(a,b){this._parts[this._parts.length]=['tref',a,b];return this},path:function(a,b,c){this._parts[this._parts.length]=['textpath',b,$.extend({href:a},c||{})];return this}});$.fn.svg=function(a){var b=Array.prototype.slice.call(arguments,1);if(typeof a=='string'&&a=='get'){return $.svg['_'+a+'SVG'].apply($.svg,[this[0]].concat(b))}return this.each(function(){if(typeof a=='string'){$.svg['_'+a+'SVG'].apply($.svg,[this].concat(b))}else{$.svg._attachSVG(this,a||{})}})};function isArray(a){return(a&&a.constructor==Array)}$.svg=new SVGManager()})(jQuery);
},{}],6:[function(require,module,exports){
/* http://keith-wood.name/svg.html
   SVG/jQuery DOM compatibility for jQuery v1.4.3.
   Written by Keith Wood (kbwood{at}iinet.com.au) April 2009.
   Dual licensed under the GPL (http://dev.jquery.com/browser/trunk/jquery/GPL-LICENSE.txt) and 
   MIT (http://dev.jquery.com/browser/trunk/jquery/MIT-LICENSE.txt) licenses. 
   Please attribute the author if you use it. */
(function($){$.fn.addClass=function(e){return function(d){d=d||'';return this.each(function(){if(isSVGElem(this)){var c=this;$.each(d.split(/\s+/),function(i,a){var b=(c.className?c.className.baseVal:c.getAttribute('class'));if($.inArray(a,b.split(/\s+/))==-1){b+=(b?' ':'')+a;(c.className?c.className.baseVal=b:c.setAttribute('class',b))}})}else{e.apply($(this),[d])}})}}($.fn.addClass);$.fn.removeClass=function(e){return function(d){d=d||'';return this.each(function(){if(isSVGElem(this)){var c=this;$.each(d.split(/\s+/),function(i,a){var b=(c.className?c.className.baseVal:c.getAttribute('class'));b=$.grep(b.split(/\s+/),function(n,i){return n!=a}).join(' ');(c.className?c.className.baseVal=b:c.setAttribute('class',b))})}else{e.apply($(this),[d])}})}}($.fn.removeClass);$.fn.toggleClass=function(c){return function(a,b){return this.each(function(){if(isSVGElem(this)){if(typeof b!=='boolean'){b=!$(this).hasClass(a)}$(this)[(b?'add':'remove')+'Class'](a)}else{c.apply($(this),[a,b])}})}}($.fn.toggleClass);$.fn.hasClass=function(d){return function(b){b=b||'';var c=false;this.each(function(){if(isSVGElem(this)){var a=(this.className?this.className.baseVal:this.getAttribute('class')).split(/\s+/);c=($.inArray(b,a)>-1)}else{c=(d.apply($(this),[b]))}return!c});return c}}($.fn.hasClass);$.fn.attr=function(h){return function(b,c,d){if(typeof b==='string'&&c===undefined){var e=h.apply(this,[b,c,d]);if(e&&e.baseVal&&e.baseVal.numberOfItems!=null){c='';e=e.baseVal;for(var i=0;i<e.numberOfItems;i++){var f=e.getItem(i);switch(f.type){case 1:c+=' matrix('+f.matrix.a+','+f.matrix.b+','+f.matrix.c+','+f.matrix.d+','+f.matrix.e+','+f.matrix.f+')';break;case 2:c+=' translate('+f.matrix.e+','+f.matrix.f+')';break;case 3:c+=' scale('+f.matrix.a+','+f.matrix.d+')';break;case 4:c+=' rotate('+f.angle+')';break;case 5:c+=' skewX('+f.angle+')';break;case 6:c+=' skewY('+f.angle+')';break}}e=c.substring(1)}return(e&&e.baseVal?e.baseVal.valueAsString:e)}var g=b;if(typeof b==='string'){g={};g[b]=c}return this.each(function(){if(isSVGElem(this)){for(var n in g){var a=($.isFunction(g[n])?g[n]():g[n]);(d?this.style[n]=a:this.setAttribute(n,a))}}else{h.apply($(this),[b,c,d])}})}}($.fn.attr);$.fn.removeAttr=function(b){return function(a){return this.each(function(){if(isSVGElem(this)){(this[a]&&this[a].baseVal?this[a].baseVal.value='':this.setAttribute(a,''))}else{b.apply($(this),[a])}})}}($.fn.removeAttr);function anySVG(a){for(var i=0;i<a.length;i++){if(a[i].nodeType==1&&a[i].namespaceURI==$.svg.svgNS){return true}}return false}$.expr.relative['+']=function(d){return function(a,b,c){d(a,b,c||anySVG(a))}}($.expr.relative['+']);$.expr.relative['>']=function(d){return function(a,b,c){d(a,b,c||anySVG(a))}}($.expr.relative['>']);$.expr.relative['']=function(d){return function(a,b,c){d(a,b,c||anySVG(a))}}($.expr.relative['']);$.expr.relative['~']=function(d){return function(a,b,c){d(a,b,c||anySVG(a))}}($.expr.relative['~']);$.expr.find.ID=function(d){return function(a,b,c){return(isSVGElem(b)?[b.ownerDocument.getElementById(a[1])]:d(a,b,c))}}($.expr.find.ID);var j=document.createElement('div');j.appendChild(document.createComment(''));if(j.getElementsByTagName('*').length>0){$.expr.find.TAG=function(a,b){var c=b.getElementsByTagName(a[1]);if(a[1]==='*'){var d=[];for(var i=0;c[i]||c.item(i);i++){if((c[i]||c.item(i)).nodeType===1){d.push(c[i]||c.item(i))}}c=d}return c}}$.expr.preFilter.CLASS=function(a,b,c,d,f,g){a=' '+a[1].replace(/\\/g,'')+' ';if(g){return a}for(var i=0,elem={};elem!=null;i++){elem=b[i];if(!elem){try{elem=b.item(i)}catch(e){}}if(elem){var h=(!isSVGElem(elem)?elem.className:(elem.className?elem.className.baseVal:'')||elem.getAttribute('class'));if(f^(h&&(' '+h+' ').indexOf(a)>-1)){if(!c)d.push(elem)}else if(c){b[i]=false}}}return false};$.expr.filter.CLASS=function(a,b){var c=(!isSVGElem(a)?a.className:(a.className?a.className.baseVal:a.getAttribute('class')));return(' '+c+' ').indexOf(b)>-1};$.expr.filter.ATTR=function(g){return function(c,d){var e=null;if(isSVGElem(c)){e=d[1];$.expr.attrHandle[e]=function(a){var b=a.getAttribute(e);return b&&b.baseVal||b}}var f=g(c,d);if(e){$.expr.attrHandle[e]=null}return f}}($.expr.filter.ATTR);function isSVGElem(a){return(a.nodeType==1&&a.namespaceURI==$.svg.svgNS)}})(jQuery);
},{}],7:[function(require,module,exports){
(function () {
    function create(window) {
        window = window || eval("require('js"+"dom')").jsdom().createWindow();

        // assume window is a jsdom instance...
        // jsdom includes an incomplete version of XMLHttpRequest
        try {
            window.XMLHttpRequest = eval("require('xml"+"httprequest')").XMLHttpRequest;
            // trick jQuery into thinking CORS is supported (should be in node-XMLHttpRequest)
            window.XMLHttpRequest.prototype.withCredentials = false;
        }
        catch (e) {}

        var location = window.location,
            navigator = window.navigator,
            XMLHttpRequest = window.XMLHttpRequest;

/*!
 * jQuery JavaScript Library v1.7.1
 * http://jquery.com/
 *
 * Copyright 2011, John Resig
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * http://jquery.org/license
 *
 * Includes Sizzle.js
 * http://sizzlejs.com/
 * Copyright 2011, The Dojo Foundation
 * Released under the MIT, BSD, and GPL Licenses.
 *
 * Date: Mon Nov 21 21:11:03 2011 -0500
 */
(function( window, undefined ) {

// Use the correct document accordingly with window argument (sandbox)
    var document = window.document,
        navigator = window.navigator,
        location = window.location;
    var jQuery = (function() {

// Define a local copy of jQuery
        var jQuery = function( selector, context ) {
                // The jQuery object is actually just the init constructor 'enhanced'
                return new jQuery.fn.init( selector, context, rootjQuery );
            },

        // Map over jQuery in case of overwrite
            _jQuery = window.jQuery,

        // Map over the $ in case of overwrite
            _$ = window.$,

        // A central reference to the root jQuery(document)
            rootjQuery,

        // A simple way to check for HTML strings or ID strings
        // Prioritize #id over <tag> to avoid XSS via location.hash (#9521)
            quickExpr = /^(?:[^#<]*(<[\w\W]+>)[^>]*$|#([\w\-]*)$)/,

        // Check if a string has a non-whitespace character in it
            rnotwhite = /\S/,

        // Used for trimming whitespace
            trimLeft = /^\s+/,
            trimRight = /\s+$/,

        // Match a standalone tag
            rsingleTag = /^<(\w+)\s*\/?>(?:<\/\1>)?$/,

        // JSON RegExp
            rvalidchars = /^[\],:{}\s]*$/,
            rvalidescape = /\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,
            rvalidtokens = /"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,
            rvalidbraces = /(?:^|:|,)(?:\s*\[)+/g,

        // Useragent RegExp
            rwebkit = /(webkit)[ \/]([\w.]+)/,
            ropera = /(opera)(?:.*version)?[ \/]([\w.]+)/,
            rmsie = /(msie) ([\w.]+)/,
            rmozilla = /(mozilla)(?:.*? rv:([\w.]+))?/,

        // Matches dashed string for camelizing
            rdashAlpha = /-([a-z]|[0-9])/ig,
            rmsPrefix = /^-ms-/,

        // Used by jQuery.camelCase as callback to replace()
            fcamelCase = function( all, letter ) {
                return ( letter + "" ).toUpperCase();
            },

        // Keep a UserAgent string for use with jQuery.browser
            userAgent = navigator.userAgent,

        // For matching the engine and version of the browser
            browserMatch,

        // The deferred used on DOM ready
            readyList,

        // The ready event handler
            DOMContentLoaded,

        // Save a reference to some core methods
            toString = Object.prototype.toString,
            hasOwn = Object.prototype.hasOwnProperty,
            push = Array.prototype.push,
            slice = Array.prototype.slice,
            trim = String.prototype.trim,
            indexOf = Array.prototype.indexOf,

        // [[Class]] -> type pairs
            class2type = {};

        jQuery.fn = jQuery.prototype = {
            constructor: jQuery,
            init: function( selector, context, rootjQuery ) {
                var match, elem, ret, doc;

                // Handle $(""), $(null), or $(undefined)
                if ( !selector ) {
                    return this;
                }

                // Handle $(DOMElement)
                if ( selector.nodeType ) {
                    this.context = this[0] = selector;
                    this.length = 1;
                    return this;
                }

                // The body element only exists once, optimize finding it
                if ( selector === "body" && !context && document.body ) {
                    this.context = document;
                    this[0] = document.body;
                    this.selector = selector;
                    this.length = 1;
                    return this;
                }

                // Handle HTML strings
                if ( typeof selector === "string" ) {
                    // Are we dealing with HTML string or an ID?
                    if ( selector.charAt(0) === "<" && selector.charAt( selector.length - 1 ) === ">" && selector.length >= 3 ) {
                        // Assume that strings that start and end with <> are HTML and skip the regex check
                        match = [ null, selector, null ];

                    } else {
                        match = quickExpr.exec( selector );
                    }

                    // Verify a match, and that no context was specified for #id
                    if ( match && (match[1] || !context) ) {

                        // HANDLE: $(html) -> $(array)
                        if ( match[1] ) {
                            context = context instanceof jQuery ? context[0] : context;
                            doc = ( context ? context.ownerDocument || context : document );

                            // If a single string is passed in and it's a single tag
                            // just do a createElement and skip the rest
                            ret = rsingleTag.exec( selector );

                            if ( ret ) {
                                if ( jQuery.isPlainObject( context ) ) {
                                    selector = [ document.createElement( ret[1] ) ];
                                    jQuery.fn.attr.call( selector, context, true );

                                } else {
                                    selector = [ doc.createElement( ret[1] ) ];
                                }

                            } else {
                                ret = jQuery.buildFragment( [ match[1] ], [ doc ] );
                                selector = ( ret.cacheable ? jQuery.clone(ret.fragment) : ret.fragment ).childNodes;
                            }

                            return jQuery.merge( this, selector );

                            // HANDLE: $("#id")
                        } else {
                            elem = document.getElementById( match[2] );

                            // Check parentNode to catch when Blackberry 4.6 returns
                            // nodes that are no longer in the document #6963
                            if ( elem && elem.parentNode ) {
                                // Handle the case where IE and Opera return items
                                // by name instead of ID
                                if ( elem.id !== match[2] ) {
                                    return rootjQuery.find( selector );
                                }

                                // Otherwise, we inject the element directly into the jQuery object
                                this.length = 1;
                                this[0] = elem;
                            }

                            this.context = document;
                            this.selector = selector;
                            return this;
                        }

                        // HANDLE: $(expr, $(...))
                    } else if ( !context || context.jquery ) {
                        return ( context || rootjQuery ).find( selector );

                        // HANDLE: $(expr, context)
                        // (which is just equivalent to: $(context).find(expr)
                    } else {
                        return this.constructor( context ).find( selector );
                    }

                    // HANDLE: $(function)
                    // Shortcut for document ready
                } else if ( jQuery.isFunction( selector ) ) {
                    return rootjQuery.ready( selector );
                }

                if ( selector.selector !== undefined ) {
                    this.selector = selector.selector;
                    this.context = selector.context;
                }

                return jQuery.makeArray( selector, this );
            },

            // Start with an empty selector
            selector: "",

            // The current version of jQuery being used
            jquery: "1.7.1",

            // The default length of a jQuery object is 0
            length: 0,

            // The number of elements contained in the matched element set
            size: function() {
                return this.length;
            },

            toArray: function() {
                return slice.call( this, 0 );
            },

            // Get the Nth element in the matched element set OR
            // Get the whole matched element set as a clean array
            get: function( num ) {
                return num == null ?

                    // Return a 'clean' array
                    this.toArray() :

                    // Return just the object
                    ( num < 0 ? this[ this.length + num ] : this[ num ] );
            },

            // Take an array of elements and push it onto the stack
            // (returning the new matched element set)
            pushStack: function( elems, name, selector ) {
                // Build a new jQuery matched element set
                var ret = this.constructor();

                if ( jQuery.isArray( elems ) ) {
                    push.apply( ret, elems );

                } else {
                    jQuery.merge( ret, elems );
                }

                // Add the old object onto the stack (as a reference)
                ret.prevObject = this;

                ret.context = this.context;

                if ( name === "find" ) {
                    ret.selector = this.selector + ( this.selector ? " " : "" ) + selector;
                } else if ( name ) {
                    ret.selector = this.selector + "." + name + "(" + selector + ")";
                }

                // Return the newly-formed element set
                return ret;
            },

            // Execute a callback for every element in the matched set.
            // (You can seed the arguments with an array of args, but this is
            // only used internally.)
            each: function( callback, args ) {
                return jQuery.each( this, callback, args );
            },

            ready: function( fn ) {
                // Attach the listeners
                jQuery.bindReady();

                // Add the callback
                readyList.add( fn );

                return this;
            },

            eq: function( i ) {
                i = +i;
                return i === -1 ?
                    this.slice( i ) :
                    this.slice( i, i + 1 );
            },

            first: function() {
                return this.eq( 0 );
            },

            last: function() {
                return this.eq( -1 );
            },

            slice: function() {
                return this.pushStack( slice.apply( this, arguments ),
                    "slice", slice.call(arguments).join(",") );
            },

            map: function( callback ) {
                return this.pushStack( jQuery.map(this, function( elem, i ) {
                    return callback.call( elem, i, elem );
                }));
            },

            end: function() {
                return this.prevObject || this.constructor(null);
            },

            // For internal use only.
            // Behaves like an Array's method, not like a jQuery method.
            push: push,
            sort: [].sort,
            splice: [].splice
        };

// Give the init function the jQuery prototype for later instantiation
        jQuery.fn.init.prototype = jQuery.fn;

        jQuery.extend = jQuery.fn.extend = function() {
            var options, name, src, copy, copyIsArray, clone,
                target = arguments[0] || {},
                i = 1,
                length = arguments.length,
                deep = false;

            // Handle a deep copy situation
            if ( typeof target === "boolean" ) {
                deep = target;
                target = arguments[1] || {};
                // skip the boolean and the target
                i = 2;
            }

            // Handle case when target is a string or something (possible in deep copy)
            if ( typeof target !== "object" && !jQuery.isFunction(target) ) {
                target = {};
            }

            // extend jQuery itself if only one argument is passed
            if ( length === i ) {
                target = this;
                --i;
            }

            for ( ; i < length; i++ ) {
                // Only deal with non-null/undefined values
                if ( (options = arguments[ i ]) != null ) {
                    // Extend the base object
                    for ( name in options ) {
                        src = target[ name ];
                        copy = options[ name ];

                        // Prevent never-ending loop
                        if ( target === copy ) {
                            continue;
                        }

                        // Recurse if we're merging plain objects or arrays
                        if ( deep && copy && ( jQuery.isPlainObject(copy) || (copyIsArray = jQuery.isArray(copy)) ) ) {
                            if ( copyIsArray ) {
                                copyIsArray = false;
                                clone = src && jQuery.isArray(src) ? src : [];

                            } else {
                                clone = src && jQuery.isPlainObject(src) ? src : {};
                            }

                            // Never move original objects, clone them
                            target[ name ] = jQuery.extend( deep, clone, copy );

                            // Don't bring in undefined values
                        } else if ( copy !== undefined ) {
                            target[ name ] = copy;
                        }
                    }
                }
            }

            // Return the modified object
            return target;
        };

        jQuery.extend({
            noConflict: function( deep ) {
                if ( window.$ === jQuery ) {
                    window.$ = _$;
                }

                if ( deep && window.jQuery === jQuery ) {
                    window.jQuery = _jQuery;
                }

                return jQuery;
            },

            // Is the DOM ready to be used? Set to true once it occurs.
            isReady: false,

            // A counter to track how many items to wait for before
            // the ready event fires. See #6781
            readyWait: 1,

            // Hold (or release) the ready event
            holdReady: function( hold ) {
                if ( hold ) {
                    jQuery.readyWait++;
                } else {
                    jQuery.ready( true );
                }
            },

            // Handle when the DOM is ready
            ready: function( wait ) {
                // Either a released hold or an DOMready/load event and not yet ready
                if ( (wait === true && !--jQuery.readyWait) || (wait !== true && !jQuery.isReady) ) {
                    // Make sure body exists, at least, in case IE gets a little overzealous (ticket #5443).
                    if ( !document.body ) {
                        return setTimeout( jQuery.ready, 1 );
                    }

                    // Remember that the DOM is ready
                    jQuery.isReady = true;

                    // If a normal DOM Ready event fired, decrement, and wait if need be
                    if ( wait !== true && --jQuery.readyWait > 0 ) {
                        return;
                    }

                    // If there are functions bound, to execute
                    readyList.fireWith( document, [ jQuery ] );

                    // Trigger any bound ready events
                    if ( jQuery.fn.trigger ) {
                        jQuery( document ).trigger( "ready" ).off( "ready" );
                    }
                }
            },

            bindReady: function() {
                if ( readyList ) {
                    return;
                }

                readyList = jQuery.Callbacks( "once memory" );

                // Catch cases where $(document).ready() is called after the
                // browser event has already occurred.
                if ( document.readyState === "complete" ) {
                    // Handle it asynchronously to allow scripts the opportunity to delay ready
                    return setTimeout( jQuery.ready, 1 );
                }

                // Mozilla, Opera and webkit nightlies currently support this event
                if ( document.addEventListener ) {
                    // Use the handy event callback
                    document.addEventListener( "DOMContentLoaded", DOMContentLoaded, false );

                    // A fallback to window.onload, that will always work
                    window.addEventListener( "load", jQuery.ready, false );

                    // If IE event model is used
                } else if ( document.attachEvent ) {
                    // ensure firing before onload,
                    // maybe late but safe also for iframes
                    document.attachEvent( "onreadystatechange", DOMContentLoaded );

                    // A fallback to window.onload, that will always work
                    window.attachEvent( "onload", jQuery.ready );

                    // If IE and not a frame
                    // continually check to see if the document is ready
                    var toplevel = false;

                    try {
                        toplevel = window.frameElement == null;
                    } catch(e) {}

                    if ( document.documentElement.doScroll && toplevel ) {
                        doScrollCheck();
                    }
                }
            },

            // See test/unit/core.js for details concerning isFunction.
            // Since version 1.3, DOM methods and functions like alert
            // aren't supported. They return false on IE (#2968).
            isFunction: function( obj ) {
                return jQuery.type(obj) === "function";
            },

            isArray: Array.isArray || function( obj ) {
                return jQuery.type(obj) === "array";
            },

            // A crude way of determining if an object is a window
            isWindow: function( obj ) {
                return obj && typeof obj === "object" && "setInterval" in obj;
            },

            isNumeric: function( obj ) {
                return !isNaN( parseFloat(obj) ) && isFinite( obj );
            },

            type: function( obj ) {
                return obj == null ?
                    String( obj ) :
                class2type[ toString.call(obj) ] || "object";
            },

            isPlainObject: function( obj ) {
                // Must be an Object.
                // Because of IE, we also have to check the presence of the constructor property.
                // Make sure that DOM nodes and window objects don't pass through, as well
                if ( !obj || jQuery.type(obj) !== "object" || obj.nodeType || jQuery.isWindow( obj ) ) {
                    return false;
                }

                try {
                    // Not own constructor property must be Object
                    if ( obj.constructor &&
                        !hasOwn.call(obj, "constructor") &&
                        !hasOwn.call(obj.constructor.prototype, "isPrototypeOf") ) {
                        return false;
                    }
                } catch ( e ) {
                    // IE8,9 Will throw exceptions on certain host objects #9897
                    return false;
                }

                // Own properties are enumerated firstly, so to speed up,
                // if last one is own, then all properties are own.

                var key;
                for ( key in obj ) {}

                return key === undefined || hasOwn.call( obj, key );
            },

            isEmptyObject: function( obj ) {
                for ( var name in obj ) {
                    return false;
                }
                return true;
            },

            error: function( msg ) {
                throw new Error( msg );
            },

            parseJSON: function( data ) {
                if ( typeof data !== "string" || !data ) {
                    return null;
                }

                // Make sure leading/trailing whitespace is removed (IE can't handle it)
                data = jQuery.trim( data );

                // Attempt to parse using the native JSON parser first
                if ( window.JSON && window.JSON.parse ) {
                    return window.JSON.parse( data );
                }

                // Make sure the incoming data is actual JSON
                // Logic borrowed from http://json.org/json2.js
                if ( rvalidchars.test( data.replace( rvalidescape, "@" )
                        .replace( rvalidtokens, "]" )
                        .replace( rvalidbraces, "")) ) {

                    return ( new Function( "return " + data ) )();

                }
                jQuery.error( "Invalid JSON: " + data );
            },

            // Cross-browser xml parsing
            parseXML: function( data ) {
                var xml, tmp;
                try {
                    if ( window.DOMParser ) { // Standard
                        tmp = new DOMParser();
                        xml = tmp.parseFromString( data , "text/xml" );
                    } else { // IE
                        xml = new ActiveXObject( "Microsoft.XMLDOM" );
                        xml.async = "false";
                        xml.loadXML( data );
                    }
                } catch( e ) {
                    xml = undefined;
                }
                if ( !xml || !xml.documentElement || xml.getElementsByTagName( "parsererror" ).length ) {
                    jQuery.error( "Invalid XML: " + data );
                }
                return xml;
            },

            noop: function() {},

            // Evaluates a script in a global context
            // Workarounds based on findings by Jim Driscoll
            // http://weblogs.java.net/blog/driscoll/archive/2009/09/08/eval-javascript-global-context
            globalEval: function( data ) {
                if ( data && rnotwhite.test( data ) ) {
                    // We use execScript on Internet Explorer
                    // We use an anonymous function so that context is window
                    // rather than jQuery in Firefox
                    ( window.execScript || function( data ) {
                        window[ "eval" ].call( window, data );
                    } )( data );
                }
            },

            // Convert dashed to camelCase; used by the css and data modules
            // Microsoft forgot to hump their vendor prefix (#9572)
            camelCase: function( string ) {
                return string.replace( rmsPrefix, "ms-" ).replace( rdashAlpha, fcamelCase );
            },

            nodeName: function( elem, name ) {
                return elem.nodeName && elem.nodeName.toUpperCase() === name.toUpperCase();
            },

            // args is for internal usage only
            each: function( object, callback, args ) {
                var name, i = 0,
                    length = object.length,
                    isObj = length === undefined || jQuery.isFunction( object );

                if ( args ) {
                    if ( isObj ) {
                        for ( name in object ) {
                            if ( callback.apply( object[ name ], args ) === false ) {
                                break;
                            }
                        }
                    } else {
                        for ( ; i < length; ) {
                            if ( callback.apply( object[ i++ ], args ) === false ) {
                                break;
                            }
                        }
                    }

                    // A special, fast, case for the most common use of each
                } else {
                    if ( isObj ) {
                        for ( name in object ) {
                            if ( callback.call( object[ name ], name, object[ name ] ) === false ) {
                                break;
                            }
                        }
                    } else {
                        for ( ; i < length; ) {
                            if ( callback.call( object[ i ], i, object[ i++ ] ) === false ) {
                                break;
                            }
                        }
                    }
                }

                return object;
            },

            // Use native String.trim function wherever possible
            trim: trim ?
                function( text ) {
                    return text == null ?
                        "" :
                        trim.call( text );
                } :

                // Otherwise use our own trimming functionality
                function( text ) {
                    return text == null ?
                        "" :
                        text.toString().replace( trimLeft, "" ).replace( trimRight, "" );
                },

            // results is for internal usage only
            makeArray: function( array, results ) {
                var ret = results || [];

                if ( array != null ) {
                    // The window, strings (and functions) also have 'length'
                    // Tweaked logic slightly to handle Blackberry 4.7 RegExp issues #6930
                    var type = jQuery.type( array );

                    if ( array.length == null || type === "string" || type === "function" || type === "regexp" || jQuery.isWindow( array ) ) {
                        push.call( ret, array );
                    } else {
                        jQuery.merge( ret, array );
                    }
                }

                return ret;
            },

            inArray: function( elem, array, i ) {
                var len;

                if ( array ) {
                    if ( indexOf ) {
                        return indexOf.call( array, elem, i );
                    }

                    len = array.length;
                    i = i ? i < 0 ? Math.max( 0, len + i ) : i : 0;

                    for ( ; i < len; i++ ) {
                        // Skip accessing in sparse arrays
                        if ( i in array && array[ i ] === elem ) {
                            return i;
                        }
                    }
                }

                return -1;
            },

            merge: function( first, second ) {
                var i = first.length,
                    j = 0;

                if ( typeof second.length === "number" ) {
                    for ( var l = second.length; j < l; j++ ) {
                        first[ i++ ] = second[ j ];
                    }

                } else {
                    while ( second[j] !== undefined ) {
                        first[ i++ ] = second[ j++ ];
                    }
                }

                first.length = i;

                return first;
            },

            grep: function( elems, callback, inv ) {
                var ret = [], retVal;
                inv = !!inv;

                // Go through the array, only saving the items
                // that pass the validator function
                for ( var i = 0, length = elems.length; i < length; i++ ) {
                    retVal = !!callback( elems[ i ], i );
                    if ( inv !== retVal ) {
                        ret.push( elems[ i ] );
                    }
                }

                return ret;
            },

            // arg is for internal usage only
            map: function( elems, callback, arg ) {
                var value, key, ret = [],
                    i = 0,
                    length = elems.length,
                // jquery objects are treated as arrays
                    isArray = elems instanceof jQuery || length !== undefined && typeof length === "number" && ( ( length > 0 && elems[ 0 ] && elems[ length -1 ] ) || length === 0 || jQuery.isArray( elems ) ) ;

                // Go through the array, translating each of the items to their
                if ( isArray ) {
                    for ( ; i < length; i++ ) {
                        value = callback( elems[ i ], i, arg );

                        if ( value != null ) {
                            ret[ ret.length ] = value;
                        }
                    }

                    // Go through every key on the object,
                } else {
                    for ( key in elems ) {
                        value = callback( elems[ key ], key, arg );

                        if ( value != null ) {
                            ret[ ret.length ] = value;
                        }
                    }
                }

                // Flatten any nested arrays
                return ret.concat.apply( [], ret );
            },

            // A global GUID counter for objects
            guid: 1,

            // Bind a function to a context, optionally partially applying any
            // arguments.
            proxy: function( fn, context ) {
                if ( typeof context === "string" ) {
                    var tmp = fn[ context ];
                    context = fn;
                    fn = tmp;
                }

                // Quick check to determine if target is callable, in the spec
                // this throws a TypeError, but we will just return undefined.
                if ( !jQuery.isFunction( fn ) ) {
                    return undefined;
                }

                // Simulated bind
                var args = slice.call( arguments, 2 ),
                    proxy = function() {
                        return fn.apply( context, args.concat( slice.call( arguments ) ) );
                    };

                // Set the guid of unique handler to the same of original handler, so it can be removed
                proxy.guid = fn.guid = fn.guid || proxy.guid || jQuery.guid++;

                return proxy;
            },

            // Mutifunctional method to get and set values to a collection
            // The value/s can optionally be executed if it's a function
            access: function( elems, key, value, exec, fn, pass ) {
                var length = elems.length;

                // Setting many attributes
                if ( typeof key === "object" ) {
                    for ( var k in key ) {
                        jQuery.access( elems, k, key[k], exec, fn, value );
                    }
                    return elems;
                }

                // Setting one attribute
                if ( value !== undefined ) {
                    // Optionally, function values get executed if exec is true
                    exec = !pass && exec && jQuery.isFunction(value);

                    for ( var i = 0; i < length; i++ ) {
                        fn( elems[i], key, exec ? value.call( elems[i], i, fn( elems[i], key ) ) : value, pass );
                    }

                    return elems;
                }

                // Getting an attribute
                return length ? fn( elems[0], key ) : undefined;
            },

            now: function() {
                return ( new Date() ).getTime();
            },

            // Use of jQuery.browser is frowned upon.
            // More details: http://docs.jquery.com/Utilities/jQuery.browser
            uaMatch: function( ua ) {
                ua = ua.toLowerCase();

                var match = rwebkit.exec( ua ) ||
                    ropera.exec( ua ) ||
                    rmsie.exec( ua ) ||
                    ua.indexOf("compatible") < 0 && rmozilla.exec( ua ) ||
                    [];

                return { browser: match[1] || "", version: match[2] || "0" };
            },

            sub: function() {
                function jQuerySub( selector, context ) {
                    return new jQuerySub.fn.init( selector, context );
                }
                jQuery.extend( true, jQuerySub, this );
                jQuerySub.superclass = this;
                jQuerySub.fn = jQuerySub.prototype = this();
                jQuerySub.fn.constructor = jQuerySub;
                jQuerySub.sub = this.sub;
                jQuerySub.fn.init = function init( selector, context ) {
                    if ( context && context instanceof jQuery && !(context instanceof jQuerySub) ) {
                        context = jQuerySub( context );
                    }

                    return jQuery.fn.init.call( this, selector, context, rootjQuerySub );
                };
                jQuerySub.fn.init.prototype = jQuerySub.fn;
                var rootjQuerySub = jQuerySub(document);
                return jQuerySub;
            },

            browser: {}
        });

// Populate the class2type map
        jQuery.each("Boolean Number String Function Array Date RegExp Object".split(" "), function(i, name) {
            class2type[ "[object " + name + "]" ] = name.toLowerCase();
        });

        browserMatch = jQuery.uaMatch( userAgent );
        if ( browserMatch.browser ) {
            jQuery.browser[ browserMatch.browser ] = true;
            jQuery.browser.version = browserMatch.version;
        }

// Deprecated, use jQuery.browser.webkit instead
        if ( jQuery.browser.webkit ) {
            jQuery.browser.safari = true;
        }

// IE doesn't match non-breaking spaces with \s
        if ( rnotwhite.test( "\xA0" ) ) {
            trimLeft = /^[\s\xA0]+/;
            trimRight = /[\s\xA0]+$/;
        }

// All jQuery objects should point back to these
        rootjQuery = jQuery(document);

// Cleanup functions for the document ready method
        if ( document.addEventListener ) {
            DOMContentLoaded = function() {
                document.removeEventListener( "DOMContentLoaded", DOMContentLoaded, false );
                jQuery.ready();
            };

        } else if ( document.attachEvent ) {
            DOMContentLoaded = function() {
                // Make sure body exists, at least, in case IE gets a little overzealous (ticket #5443).
                if ( document.readyState === "complete" ) {
                    document.detachEvent( "onreadystatechange", DOMContentLoaded );
                    jQuery.ready();
                }
            };
        }

// The DOM ready check for Internet Explorer
        function doScrollCheck() {
            if ( jQuery.isReady ) {
                return;
            }

            try {
                // If IE is used, use the trick by Diego Perini
                // http://javascript.nwbox.com/IEContentLoaded/
                document.documentElement.doScroll("left");
            } catch(e) {
                setTimeout( doScrollCheck, 1 );
                return;
            }

            // and execute any waiting functions
            jQuery.ready();
        }

        return jQuery;

    })();


// String to Object flags format cache
    var flagsCache = {};

// Convert String-formatted flags into Object-formatted ones and store in cache
    function createFlags( flags ) {
        var object = flagsCache[ flags ] = {},
            i, length;
        flags = flags.split( /\s+/ );
        for ( i = 0, length = flags.length; i < length; i++ ) {
            object[ flags[i] ] = true;
        }
        return object;
    }

    /*
     * Create a callback list using the following parameters:
     *
     *	flags:	an optional list of space-separated flags that will change how
     *			the callback list behaves
     *
     * By default a callback list will act like an event callback list and can be
     * "fired" multiple times.
     *
     * Possible flags:
     *
     *	once:			will ensure the callback list can only be fired once (like a Deferred)
     *
     *	memory:			will keep track of previous values and will call any callback added
     *					after the list has been fired right away with the latest "memorized"
     *					values (like a Deferred)
     *
     *	unique:			will ensure a callback can only be added once (no duplicate in the list)
     *
     *	stopOnFalse:	interrupt callings when a callback returns false
     *
     */
    jQuery.Callbacks = function( flags ) {

        // Convert flags from String-formatted to Object-formatted
        // (we check in cache first)
        flags = flags ? ( flagsCache[ flags ] || createFlags( flags ) ) : {};

        var // Actual callback list
            list = [],
        // Stack of fire calls for repeatable lists
            stack = [],
        // Last fire value (for non-forgettable lists)
            memory,
        // Flag to know if list is currently firing
            firing,
        // First callback to fire (used internally by add and fireWith)
            firingStart,
        // End of the loop when firing
            firingLength,
        // Index of currently firing callback (modified by remove if needed)
            firingIndex,
        // Add one or several callbacks to the list
            add = function( args ) {
                var i,
                    length,
                    elem,
                    type,
                    actual;
                for ( i = 0, length = args.length; i < length; i++ ) {
                    elem = args[ i ];
                    type = jQuery.type( elem );
                    if ( type === "array" ) {
                        // Inspect recursively
                        add( elem );
                    } else if ( type === "function" ) {
                        // Add if not in unique mode and callback is not in
                        if ( !flags.unique || !self.has( elem ) ) {
                            list.push( elem );
                        }
                    }
                }
            },
        // Fire callbacks
            fire = function( context, args ) {
                args = args || [];
                memory = !flags.memory || [ context, args ];
                firing = true;
                firingIndex = firingStart || 0;
                firingStart = 0;
                firingLength = list.length;
                for ( ; list && firingIndex < firingLength; firingIndex++ ) {
                    if ( list[ firingIndex ].apply( context, args ) === false && flags.stopOnFalse ) {
                        memory = true; // Mark as halted
                        break;
                    }
                }
                firing = false;
                if ( list ) {
                    if ( !flags.once ) {
                        if ( stack && stack.length ) {
                            memory = stack.shift();
                            self.fireWith( memory[ 0 ], memory[ 1 ] );
                        }
                    } else if ( memory === true ) {
                        self.disable();
                    } else {
                        list = [];
                    }
                }
            },
        // Actual Callbacks object
            self = {
                // Add a callback or a collection of callbacks to the list
                add: function() {
                    if ( list ) {
                        var length = list.length;
                        add( arguments );
                        // Do we need to add the callbacks to the
                        // current firing batch?
                        if ( firing ) {
                            firingLength = list.length;
                            // With memory, if we're not firing then
                            // we should call right away, unless previous
                            // firing was halted (stopOnFalse)
                        } else if ( memory && memory !== true ) {
                            firingStart = length;
                            fire( memory[ 0 ], memory[ 1 ] );
                        }
                    }
                    return this;
                },
                // Remove a callback from the list
                remove: function() {
                    if ( list ) {
                        var args = arguments,
                            argIndex = 0,
                            argLength = args.length;
                        for ( ; argIndex < argLength ; argIndex++ ) {
                            for ( var i = 0; i < list.length; i++ ) {
                                if ( args[ argIndex ] === list[ i ] ) {
                                    // Handle firingIndex and firingLength
                                    if ( firing ) {
                                        if ( i <= firingLength ) {
                                            firingLength--;
                                            if ( i <= firingIndex ) {
                                                firingIndex--;
                                            }
                                        }
                                    }
                                    // Remove the element
                                    list.splice( i--, 1 );
                                    // If we have some unicity property then
                                    // we only need to do this once
                                    if ( flags.unique ) {
                                        break;
                                    }
                                }
                            }
                        }
                    }
                    return this;
                },
                // Control if a given callback is in the list
                has: function( fn ) {
                    if ( list ) {
                        var i = 0,
                            length = list.length;
                        for ( ; i < length; i++ ) {
                            if ( fn === list[ i ] ) {
                                return true;
                            }
                        }
                    }
                    return false;
                },
                // Remove all callbacks from the list
                empty: function() {
                    list = [];
                    return this;
                },
                // Have the list do nothing anymore
                disable: function() {
                    list = stack = memory = undefined;
                    return this;
                },
                // Is it disabled?
                disabled: function() {
                    return !list;
                },
                // Lock the list in its current state
                lock: function() {
                    stack = undefined;
                    if ( !memory || memory === true ) {
                        self.disable();
                    }
                    return this;
                },
                // Is it locked?
                locked: function() {
                    return !stack;
                },
                // Call all callbacks with the given context and arguments
                fireWith: function( context, args ) {
                    if ( stack ) {
                        if ( firing ) {
                            if ( !flags.once ) {
                                stack.push( [ context, args ] );
                            }
                        } else if ( !( flags.once && memory ) ) {
                            fire( context, args );
                        }
                    }
                    return this;
                },
                // Call all the callbacks with the given arguments
                fire: function() {
                    self.fireWith( this, arguments );
                    return this;
                },
                // To know if the callbacks have already been called at least once
                fired: function() {
                    return !!memory;
                }
            };

        return self;
    };




    var // Static reference to slice
        sliceDeferred = [].slice;

    jQuery.extend({

        Deferred: function( func ) {
            var doneList = jQuery.Callbacks( "once memory" ),
                failList = jQuery.Callbacks( "once memory" ),
                progressList = jQuery.Callbacks( "memory" ),
                state = "pending",
                lists = {
                    resolve: doneList,
                    reject: failList,
                    notify: progressList
                },
                promise = {
                    done: doneList.add,
                    fail: failList.add,
                    progress: progressList.add,

                    state: function() {
                        return state;
                    },

                    // Deprecated
                    isResolved: doneList.fired,
                    isRejected: failList.fired,

                    then: function( doneCallbacks, failCallbacks, progressCallbacks ) {
                        deferred.done( doneCallbacks ).fail( failCallbacks ).progress( progressCallbacks );
                        return this;
                    },
                    always: function() {
                        deferred.done.apply( deferred, arguments ).fail.apply( deferred, arguments );
                        return this;
                    },
                    pipe: function( fnDone, fnFail, fnProgress ) {
                        return jQuery.Deferred(function( newDefer ) {
                            jQuery.each( {
                                done: [ fnDone, "resolve" ],
                                fail: [ fnFail, "reject" ],
                                progress: [ fnProgress, "notify" ]
                            }, function( handler, data ) {
                                var fn = data[ 0 ],
                                    action = data[ 1 ],
                                    returned;
                                if ( jQuery.isFunction( fn ) ) {
                                    deferred[ handler ](function() {
                                        returned = fn.apply( this, arguments );
                                        if ( returned && jQuery.isFunction( returned.promise ) ) {
                                            returned.promise().then( newDefer.resolve, newDefer.reject, newDefer.notify );
                                        } else {
                                            newDefer[ action + "With" ]( this === deferred ? newDefer : this, [ returned ] );
                                        }
                                    });
                                } else {
                                    deferred[ handler ]( newDefer[ action ] );
                                }
                            });
                        }).promise();
                    },
                    // Get a promise for this deferred
                    // If obj is provided, the promise aspect is added to the object
                    promise: function( obj ) {
                        if ( obj == null ) {
                            obj = promise;
                        } else {
                            for ( var key in promise ) {
                                obj[ key ] = promise[ key ];
                            }
                        }
                        return obj;
                    }
                },
                deferred = promise.promise({}),
                key;

            for ( key in lists ) {
                deferred[ key ] = lists[ key ].fire;
                deferred[ key + "With" ] = lists[ key ].fireWith;
            }

            // Handle state
            deferred.done( function() {
                state = "resolved";
            }, failList.disable, progressList.lock ).fail( function() {
                state = "rejected";
            }, doneList.disable, progressList.lock );

            // Call given func if any
            if ( func ) {
                func.call( deferred, deferred );
            }

            // All done!
            return deferred;
        },

        // Deferred helper
        when: function( firstParam ) {
            var args = sliceDeferred.call( arguments, 0 ),
                i = 0,
                length = args.length,
                pValues = new Array( length ),
                count = length,
                pCount = length,
                deferred = length <= 1 && firstParam && jQuery.isFunction( firstParam.promise ) ?
                    firstParam :
                    jQuery.Deferred(),
                promise = deferred.promise();
            function resolveFunc( i ) {
                return function( value ) {
                    args[ i ] = arguments.length > 1 ? sliceDeferred.call( arguments, 0 ) : value;
                    if ( !( --count ) ) {
                        deferred.resolveWith( deferred, args );
                    }
                };
            }
            function progressFunc( i ) {
                return function( value ) {
                    pValues[ i ] = arguments.length > 1 ? sliceDeferred.call( arguments, 0 ) : value;
                    deferred.notifyWith( promise, pValues );
                };
            }
            if ( length > 1 ) {
                for ( ; i < length; i++ ) {
                    if ( args[ i ] && args[ i ].promise && jQuery.isFunction( args[ i ].promise ) ) {
                        args[ i ].promise().then( resolveFunc(i), deferred.reject, progressFunc(i) );
                    } else {
                        --count;
                    }
                }
                if ( !count ) {
                    deferred.resolveWith( deferred, args );
                }
            } else if ( deferred !== firstParam ) {
                deferred.resolveWith( deferred, length ? [ firstParam ] : [] );
            }
            return promise;
        }
    });




    jQuery.support = (function() {

        var support,
            all,
            a,
            select,
            opt,
            input,
            marginDiv,
            fragment,
            tds,
            events,
            eventName,
            i,
            isSupported,
            div = document.createElement( "div" ),
            documentElement = document.documentElement;

        // Preliminary tests
        div.setAttribute("className", "t");
        div.innerHTML = "   <link/><table></table><a href='/a' style='top:1px;float:left;opacity:.55;'>a</a><input type='checkbox'/>";

        all = div.getElementsByTagName( "*" );
        a = div.getElementsByTagName( "a" )[ 0 ];

        // Can't get basic test support
        if ( !all || !all.length || !a ) {
            return {};
        }

        // First batch of supports tests
        select = document.createElement( "select" );
        opt = select.appendChild( document.createElement("option") );
        input = div.getElementsByTagName( "input" )[ 0 ];

        support = {
            // IE strips leading whitespace when .innerHTML is used
            leadingWhitespace: ( div.firstChild.nodeType === 3 ),

            // Make sure that tbody elements aren't automatically inserted
            // IE will insert them into empty tables
            tbody: !div.getElementsByTagName("tbody").length,

            // Make sure that link elements get serialized correctly by innerHTML
            // This requires a wrapper element in IE
            htmlSerialize: !!div.getElementsByTagName("link").length,

            // Get the style information from getAttribute
            // (IE uses .cssText instead)
            style: /top/.test( a.getAttribute("style") ),

            // Make sure that URLs aren't manipulated
            // (IE normalizes it by default)
            hrefNormalized: ( a.getAttribute("href") === "/a" ),

            // Make sure that element opacity exists
            // (IE uses filter instead)
            // Use a regex to work around a WebKit issue. See #5145
            opacity: /^0.55/.test( a.style.opacity ),

            // Verify style float existence
            // (IE uses styleFloat instead of cssFloat)
            cssFloat: !!a.style.cssFloat,

            // Make sure that if no value is specified for a checkbox
            // that it defaults to "on".
            // (WebKit defaults to "" instead)
            checkOn: ( input.value === "on" ),

            // Make sure that a selected-by-default option has a working selected property.
            // (WebKit defaults to false instead of true, IE too, if it's in an optgroup)
            optSelected: opt.selected,

            // Test setAttribute on camelCase class. If it works, we need attrFixes when doing get/setAttribute (ie6/7)
            getSetAttribute: div.className !== "t",

            // Tests for enctype support on a form(#6743)
            enctype: !!document.createElement("form").enctype,

            // Makes sure cloning an html5 element does not cause problems
            // Where outerHTML is undefined, this still works
            html5Clone: document.createElement("nav").cloneNode( true ).outerHTML !== "<:nav></:nav>",

            // Will be defined later
            submitBubbles: true,
            changeBubbles: true,
            focusinBubbles: false,
            deleteExpando: true,
            noCloneEvent: true,
            inlineBlockNeedsLayout: false,
            shrinkWrapBlocks: false,
            reliableMarginRight: true
        };

        // Make sure checked status is properly cloned
        input.checked = true;
        support.noCloneChecked = input.cloneNode( true ).checked;

        // Make sure that the options inside disabled selects aren't marked as disabled
        // (WebKit marks them as disabled)
        select.disabled = true;
        support.optDisabled = !opt.disabled;

        // Test to see if it's possible to delete an expando from an element
        // Fails in Internet Explorer
        try {
            delete div.test;
        } catch( e ) {
            support.deleteExpando = false;
        }

        if ( !div.addEventListener && div.attachEvent && div.fireEvent ) {
            div.attachEvent( "onclick", function() {
                // Cloning a node shouldn't copy over any
                // bound event handlers (IE does this)
                support.noCloneEvent = false;
            });
            div.cloneNode( true ).fireEvent( "onclick" );
        }

        // Check if a radio maintains its value
        // after being appended to the DOM
        input = document.createElement("input");
        input.value = "t";
        input.setAttribute("type", "radio");
        support.radioValue = input.value === "t";

        input.setAttribute("checked", "checked");
        div.appendChild( input );
        fragment = document.createDocumentFragment();
        fragment.appendChild( div.lastChild );

        // WebKit doesn't clone checked state correctly in fragments
        support.checkClone = fragment.cloneNode( true ).cloneNode( true ).lastChild.checked;

        // Check if a disconnected checkbox will retain its checked
        // value of true after appended to the DOM (IE6/7)
        support.appendChecked = input.checked;

        fragment.removeChild( input );
        fragment.appendChild( div );

        div.innerHTML = "";

        // Check if div with explicit width and no margin-right incorrectly
        // gets computed margin-right based on width of container. For more
        // info see bug #3333
        // Fails in WebKit before Feb 2011 nightlies
        // WebKit Bug 13343 - getComputedStyle returns wrong value for margin-right
        if ( window.getComputedStyle ) {
            marginDiv = document.createElement( "div" );
            marginDiv.style.width = "0";
            marginDiv.style.marginRight = "0";
            div.style.width = "2px";
            div.appendChild( marginDiv );
            support.reliableMarginRight =
                ( parseInt( ( window.getComputedStyle( marginDiv, null ) || { marginRight: 0 } ).marginRight, 10 ) || 0 ) === 0;
        }

        // Technique from Juriy Zaytsev
        // http://perfectionkills.com/detecting-event-support-without-browser-sniffing/
        // We only care about the case where non-standard event systems
        // are used, namely in IE. Short-circuiting here helps us to
        // avoid an eval call (in setAttribute) which can cause CSP
        // to go haywire. See: https://developer.mozilla.org/en/Security/CSP
        if ( div.attachEvent ) {
            for( i in {
                submit: 1,
                change: 1,
                focusin: 1
            }) {
                eventName = "on" + i;
                isSupported = ( eventName in div );
                if ( !isSupported ) {
                    div.setAttribute( eventName, "return;" );
                    isSupported = ( typeof div[ eventName ] === "function" );
                }
                support[ i + "Bubbles" ] = isSupported;
            }
        }

        fragment.removeChild( div );

        // Null elements to avoid leaks in IE
        fragment = select = opt = marginDiv = div = input = null;

        // Run tests that need a body at doc ready
        jQuery(function() {
            var container, outer, inner, table, td, offsetSupport,
                conMarginTop, ptlm, vb, style, html,
                body = document.getElementsByTagName("body")[0];

            if ( !body ) {
                // Return for frameset docs that don't have a body
                return;
            }

            conMarginTop = 1;
            ptlm = "position:absolute;top:0;left:0;width:1px;height:1px;margin:0;";
            vb = "visibility:hidden;border:0;";
            style = "style='" + ptlm + "border:5px solid #000;padding:0;'";
            html = "<div " + style + "><div></div></div>" +
                "<table " + style + " cellpadding='0' cellspacing='0'>" +
                "<tr><td></td></tr></table>";

            container = document.createElement("div");
            container.style.cssText = vb + "width:0;height:0;position:static;top:0;margin-top:" + conMarginTop + "px";
            body.insertBefore( container, body.firstChild );

            // Construct the test element
            div = document.createElement("div");
            container.appendChild( div );

            // Check if table cells still have offsetWidth/Height when they are set
            // to display:none and there are still other visible table cells in a
            // table row; if so, offsetWidth/Height are not reliable for use when
            // determining if an element has been hidden directly using
            // display:none (it is still safe to use offsets if a parent element is
            // hidden; don safety goggles and see bug #4512 for more information).
            // (only IE 8 fails this test)
            div.innerHTML = "<table><tr><td style='padding:0;border:0;display:none'></td><td>t</td></tr></table>";
            tds = div.getElementsByTagName( "td" );
            isSupported = ( tds[ 0 ].offsetHeight === 0 );

            tds[ 0 ].style.display = "";
            tds[ 1 ].style.display = "none";

            // Check if empty table cells still have offsetWidth/Height
            // (IE <= 8 fail this test)
            support.reliableHiddenOffsets = isSupported && ( tds[ 0 ].offsetHeight === 0 );

            // Figure out if the W3C box model works as expected
            div.innerHTML = "";
            div.style.width = div.style.paddingLeft = "1px";
            jQuery.boxModel = support.boxModel = div.offsetWidth === 2;

            if ( typeof div.style.zoom !== "undefined" ) {
                // Check if natively block-level elements act like inline-block
                // elements when setting their display to 'inline' and giving
                // them layout
                // (IE < 8 does this)
                div.style.display = "inline";
                div.style.zoom = 1;
                support.inlineBlockNeedsLayout = ( div.offsetWidth === 2 );

                // Check if elements with layout shrink-wrap their children
                // (IE 6 does this)
                div.style.display = "";
                div.innerHTML = "<div style='width:4px;'></div>";
                support.shrinkWrapBlocks = ( div.offsetWidth !== 2 );
            }

            div.style.cssText = ptlm + vb;
            div.innerHTML = html;

            outer = div.firstChild;
            inner = outer.firstChild;
            td = outer.nextSibling.firstChild.firstChild;

            offsetSupport = {
                doesNotAddBorder: ( inner.offsetTop !== 5 ),
                doesAddBorderForTableAndCells: ( td.offsetTop === 5 )
            };

            inner.style.position = "fixed";
            inner.style.top = "20px";

            // safari subtracts parent border width here which is 5px
            offsetSupport.fixedPosition = ( inner.offsetTop === 20 || inner.offsetTop === 15 );
            inner.style.position = inner.style.top = "";

            outer.style.overflow = "hidden";
            outer.style.position = "relative";

            offsetSupport.subtractsBorderForOverflowNotVisible = ( inner.offsetTop === -5 );
            offsetSupport.doesNotIncludeMarginInBodyOffset = ( body.offsetTop !== conMarginTop );

            body.removeChild( container );
            div  = container = null;

            jQuery.extend( support, offsetSupport );
        });

        return support;
    })();




    var rbrace = /^(?:\{.*\}|\[.*\])$/,
        rmultiDash = /([A-Z])/g;

    jQuery.extend({
        cache: {},

        // Please use with caution
        uuid: 0,

        // Unique for each copy of jQuery on the page
        // Non-digits removed to match rinlinejQuery
        expando: "jQuery" + ( jQuery.fn.jquery + Math.random() ).replace( /\D/g, "" ),

        // The following elements throw uncatchable exceptions if you
        // attempt to add expando properties to them.
        noData: {
            "embed": true,
            // Ban all objects except for Flash (which handle expandos)
            "object": "clsid:D27CDB6E-AE6D-11cf-96B8-444553540000",
            "applet": true
        },

        hasData: function( elem ) {
            elem = elem.nodeType ? jQuery.cache[ elem[jQuery.expando] ] : elem[ jQuery.expando ];
            return !!elem && !isEmptyDataObject( elem );
        },

        data: function( elem, name, data, pvt /* Internal Use Only */ ) {
            if ( !jQuery.acceptData( elem ) ) {
                return;
            }

            var privateCache, thisCache, ret,
                internalKey = jQuery.expando,
                getByName = typeof name === "string",

            // We have to handle DOM nodes and JS objects differently because IE6-7
            // can't GC object references properly across the DOM-JS boundary
                isNode = elem.nodeType,

            // Only DOM nodes need the global jQuery cache; JS object data is
            // attached directly to the object so GC can occur automatically
                cache = isNode ? jQuery.cache : elem,

            // Only defining an ID for JS objects if its cache already exists allows
            // the code to shortcut on the same path as a DOM node with no cache
                id = isNode ? elem[ internalKey ] : elem[ internalKey ] && internalKey,
                isEvents = name === "events";

            // Avoid doing any more work than we need to when trying to get data on an
            // object that has no data at all
            if ( (!id || !cache[id] || (!isEvents && !pvt && !cache[id].data)) && getByName && data === undefined ) {
                return;
            }

            if ( !id ) {
                // Only DOM nodes need a new unique ID for each element since their data
                // ends up in the global cache
                if ( isNode ) {
                    elem[ internalKey ] = id = ++jQuery.uuid;
                } else {
                    id = internalKey;
                }
            }

            if ( !cache[ id ] ) {
                cache[ id ] = {};

                // Avoids exposing jQuery metadata on plain JS objects when the object
                // is serialized using JSON.stringify
                if ( !isNode ) {
                    cache[ id ].toJSON = jQuery.noop;
                }
            }

            // An object can be passed to jQuery.data instead of a key/value pair; this gets
            // shallow copied over onto the existing cache
            if ( typeof name === "object" || typeof name === "function" ) {
                if ( pvt ) {
                    cache[ id ] = jQuery.extend( cache[ id ], name );
                } else {
                    cache[ id ].data = jQuery.extend( cache[ id ].data, name );
                }
            }

            privateCache = thisCache = cache[ id ];

            // jQuery data() is stored in a separate object inside the object's internal data
            // cache in order to avoid key collisions between internal data and user-defined
            // data.
            if ( !pvt ) {
                if ( !thisCache.data ) {
                    thisCache.data = {};
                }

                thisCache = thisCache.data;
            }

            if ( data !== undefined ) {
                thisCache[ jQuery.camelCase( name ) ] = data;
            }

            // Users should not attempt to inspect the internal events object using jQuery.data,
            // it is undocumented and subject to change. But does anyone listen? No.
            if ( isEvents && !thisCache[ name ] ) {
                return privateCache.events;
            }

            // Check for both converted-to-camel and non-converted data property names
            // If a data property was specified
            if ( getByName ) {

                // First Try to find as-is property data
                ret = thisCache[ name ];

                // Test for null|undefined property data
                if ( ret == null ) {

                    // Try to find the camelCased property
                    ret = thisCache[ jQuery.camelCase( name ) ];
                }
            } else {
                ret = thisCache;
            }

            return ret;
        },

        removeData: function( elem, name, pvt /* Internal Use Only */ ) {
            if ( !jQuery.acceptData( elem ) ) {
                return;
            }

            var thisCache, i, l,

            // Reference to internal data cache key
                internalKey = jQuery.expando,

                isNode = elem.nodeType,

            // See jQuery.data for more information
                cache = isNode ? jQuery.cache : elem,

            // See jQuery.data for more information
                id = isNode ? elem[ internalKey ] : internalKey;

            // If there is already no cache entry for this object, there is no
            // purpose in continuing
            if ( !cache[ id ] ) {
                return;
            }

            if ( name ) {

                thisCache = pvt ? cache[ id ] : cache[ id ].data;

                if ( thisCache ) {

                    // Support array or space separated string names for data keys
                    if ( !jQuery.isArray( name ) ) {

                        // try the string as a key before any manipulation
                        if ( name in thisCache ) {
                            name = [ name ];
                        } else {

                            // split the camel cased version by spaces unless a key with the spaces exists
                            name = jQuery.camelCase( name );
                            if ( name in thisCache ) {
                                name = [ name ];
                            } else {
                                name = name.split( " " );
                            }
                        }
                    }

                    for ( i = 0, l = name.length; i < l; i++ ) {
                        delete thisCache[ name[i] ];
                    }

                    // If there is no data left in the cache, we want to continue
                    // and let the cache object itself get destroyed
                    if ( !( pvt ? isEmptyDataObject : jQuery.isEmptyObject )( thisCache ) ) {
                        return;
                    }
                }
            }

            // See jQuery.data for more information
            if ( !pvt ) {
                delete cache[ id ].data;

                // Don't destroy the parent cache unless the internal data object
                // had been the only thing left in it
                if ( !isEmptyDataObject(cache[ id ]) ) {
                    return;
                }
            }

            // Browsers that fail expando deletion also refuse to delete expandos on
            // the window, but it will allow it on all other JS objects; other browsers
            // don't care
            // Ensure that `cache` is not a window object #10080
            if ( jQuery.support.deleteExpando || !cache.setInterval ) {
                delete cache[ id ];
            } else {
                cache[ id ] = null;
            }

            // We destroyed the cache and need to eliminate the expando on the node to avoid
            // false lookups in the cache for entries that no longer exist
            if ( isNode ) {
                // IE does not allow us to delete expando properties from nodes,
                // nor does it have a removeAttribute function on Document nodes;
                // we must handle all of these cases
                if ( jQuery.support.deleteExpando ) {
                    delete elem[ internalKey ];
                } else if ( elem.removeAttribute ) {
                    elem.removeAttribute( internalKey );
                } else {
                    elem[ internalKey ] = null;
                }
            }
        },

        // For internal use only.
        _data: function( elem, name, data ) {
            return jQuery.data( elem, name, data, true );
        },

        // A method for determining if a DOM node can handle the data expando
        acceptData: function( elem ) {
            if ( elem.nodeName ) {
                var match = jQuery.noData[ elem.nodeName.toLowerCase() ];

                if ( match ) {
                    return !(match === true || elem.getAttribute("classid") !== match);
                }
            }

            return true;
        }
    });

    jQuery.fn.extend({
        data: function( key, value ) {
            var parts, attr, name,
                data = null;

            if ( typeof key === "undefined" ) {
                if ( this.length ) {
                    data = jQuery.data( this[0] );

                    if ( this[0].nodeType === 1 && !jQuery._data( this[0], "parsedAttrs" ) ) {
                        attr = this[0].attributes;
                        for ( var i = 0, l = attr.length; i < l; i++ ) {
                            name = attr[i].name;

                            if ( name.indexOf( "data-" ) === 0 ) {
                                name = jQuery.camelCase( name.substring(5) );

                                dataAttr( this[0], name, data[ name ] );
                            }
                        }
                        jQuery._data( this[0], "parsedAttrs", true );
                    }
                }

                return data;

            } else if ( typeof key === "object" ) {
                return this.each(function() {
                    jQuery.data( this, key );
                });
            }

            parts = key.split(".");
            parts[1] = parts[1] ? "." + parts[1] : "";

            if ( value === undefined ) {
                data = this.triggerHandler("getData" + parts[1] + "!", [parts[0]]);

                // Try to fetch any internally stored data first
                if ( data === undefined && this.length ) {
                    data = jQuery.data( this[0], key );
                    data = dataAttr( this[0], key, data );
                }

                return data === undefined && parts[1] ?
                    this.data( parts[0] ) :
                    data;

            } else {
                return this.each(function() {
                    var self = jQuery( this ),
                        args = [ parts[0], value ];

                    self.triggerHandler( "setData" + parts[1] + "!", args );
                    jQuery.data( this, key, value );
                    self.triggerHandler( "changeData" + parts[1] + "!", args );
                });
            }
        },

        removeData: function( key ) {
            return this.each(function() {
                jQuery.removeData( this, key );
            });
        }
    });

    function dataAttr( elem, key, data ) {
        // If nothing was found internally, try to fetch any
        // data from the HTML5 data-* attribute
        if ( data === undefined && elem.nodeType === 1 ) {

            var name = "data-" + key.replace( rmultiDash, "-$1" ).toLowerCase();

            data = elem.getAttribute( name );

            if ( typeof data === "string" ) {
                try {
                    data = data === "true" ? true :
                        data === "false" ? false :
                            data === "null" ? null :
                                jQuery.isNumeric( data ) ? parseFloat( data ) :
                                    rbrace.test( data ) ? jQuery.parseJSON( data ) :
                                        data;
                } catch( e ) {}

                // Make sure we set the data so it isn't changed later
                jQuery.data( elem, key, data );

            } else {
                data = undefined;
            }
        }

        return data;
    }

// checks a cache object for emptiness
    function isEmptyDataObject( obj ) {
        for ( var name in obj ) {

            // if the public data object is empty, the private is still empty
            if ( name === "data" && jQuery.isEmptyObject( obj[name] ) ) {
                continue;
            }
            if ( name !== "toJSON" ) {
                return false;
            }
        }

        return true;
    }




    function handleQueueMarkDefer( elem, type, src ) {
        var deferDataKey = type + "defer",
            queueDataKey = type + "queue",
            markDataKey = type + "mark",
            defer = jQuery._data( elem, deferDataKey );
        if ( defer &&
            ( src === "queue" || !jQuery._data(elem, queueDataKey) ) &&
            ( src === "mark" || !jQuery._data(elem, markDataKey) ) ) {
            // Give room for hard-coded callbacks to fire first
            // and eventually mark/queue something else on the element
            setTimeout( function() {
                if ( !jQuery._data( elem, queueDataKey ) &&
                    !jQuery._data( elem, markDataKey ) ) {
                    jQuery.removeData( elem, deferDataKey, true );
                    defer.fire();
                }
            }, 0 );
        }
    }

    jQuery.extend({

        _mark: function( elem, type ) {
            if ( elem ) {
                type = ( type || "fx" ) + "mark";
                jQuery._data( elem, type, (jQuery._data( elem, type ) || 0) + 1 );
            }
        },

        _unmark: function( force, elem, type ) {
            if ( force !== true ) {
                type = elem;
                elem = force;
                force = false;
            }
            if ( elem ) {
                type = type || "fx";
                var key = type + "mark",
                    count = force ? 0 : ( (jQuery._data( elem, key ) || 1) - 1 );
                if ( count ) {
                    jQuery._data( elem, key, count );
                } else {
                    jQuery.removeData( elem, key, true );
                    handleQueueMarkDefer( elem, type, "mark" );
                }
            }
        },

        queue: function( elem, type, data ) {
            var q;
            if ( elem ) {
                type = ( type || "fx" ) + "queue";
                q = jQuery._data( elem, type );

                // Speed up dequeue by getting out quickly if this is just a lookup
                if ( data ) {
                    if ( !q || jQuery.isArray(data) ) {
                        q = jQuery._data( elem, type, jQuery.makeArray(data) );
                    } else {
                        q.push( data );
                    }
                }
                return q || [];
            }
        },

        dequeue: function( elem, type ) {
            type = type || "fx";

            var queue = jQuery.queue( elem, type ),
                fn = queue.shift(),
                hooks = {};

            // If the fx queue is dequeued, always remove the progress sentinel
            if ( fn === "inprogress" ) {
                fn = queue.shift();
            }

            if ( fn ) {
                // Add a progress sentinel to prevent the fx queue from being
                // automatically dequeued
                if ( type === "fx" ) {
                    queue.unshift( "inprogress" );
                }

                jQuery._data( elem, type + ".run", hooks );
                fn.call( elem, function() {
                    jQuery.dequeue( elem, type );
                }, hooks );
            }

            if ( !queue.length ) {
                jQuery.removeData( elem, type + "queue " + type + ".run", true );
                handleQueueMarkDefer( elem, type, "queue" );
            }
        }
    });

    jQuery.fn.extend({
        queue: function( type, data ) {
            if ( typeof type !== "string" ) {
                data = type;
                type = "fx";
            }

            if ( data === undefined ) {
                return jQuery.queue( this[0], type );
            }
            return this.each(function() {
                var queue = jQuery.queue( this, type, data );

                if ( type === "fx" && queue[0] !== "inprogress" ) {
                    jQuery.dequeue( this, type );
                }
            });
        },
        dequeue: function( type ) {
            return this.each(function() {
                jQuery.dequeue( this, type );
            });
        },
        // Based off of the plugin by Clint Helfers, with permission.
        // http://blindsignals.com/index.php/2009/07/jquery-delay/
        delay: function( time, type ) {
            time = jQuery.fx ? jQuery.fx.speeds[ time ] || time : time;
            type = type || "fx";

            return this.queue( type, function( next, hooks ) {
                var timeout = setTimeout( next, time );
                hooks.stop = function() {
                    clearTimeout( timeout );
                };
            });
        },
        clearQueue: function( type ) {
            return this.queue( type || "fx", [] );
        },
        // Get a promise resolved when queues of a certain type
        // are emptied (fx is the type by default)
        promise: function( type, object ) {
            if ( typeof type !== "string" ) {
                object = type;
                type = undefined;
            }
            type = type || "fx";
            var defer = jQuery.Deferred(),
                elements = this,
                i = elements.length,
                count = 1,
                deferDataKey = type + "defer",
                queueDataKey = type + "queue",
                markDataKey = type + "mark",
                tmp;
            function resolve() {
                if ( !( --count ) ) {
                    defer.resolveWith( elements, [ elements ] );
                }
            }
            while( i-- ) {
                if (( tmp = jQuery.data( elements[ i ], deferDataKey, undefined, true ) ||
                        ( jQuery.data( elements[ i ], queueDataKey, undefined, true ) ||
                        jQuery.data( elements[ i ], markDataKey, undefined, true ) ) &&
                        jQuery.data( elements[ i ], deferDataKey, jQuery.Callbacks( "once memory" ), true ) )) {
                    count++;
                    tmp.add( resolve );
                }
            }
            resolve();
            return defer.promise();
        }
    });




    var rclass = /[\n\t\r]/g,
        rspace = /\s+/,
        rreturn = /\r/g,
        rtype = /^(?:button|input)$/i,
        rfocusable = /^(?:button|input|object|select|textarea)$/i,
        rclickable = /^a(?:rea)?$/i,
        rboolean = /^(?:autofocus|autoplay|async|checked|controls|defer|disabled|hidden|loop|multiple|open|readonly|required|scoped|selected)$/i,
        getSetAttribute = jQuery.support.getSetAttribute,
        nodeHook, boolHook, fixSpecified;

    jQuery.fn.extend({
        attr: function( name, value ) {
            return jQuery.access( this, name, value, true, jQuery.attr );
        },

        removeAttr: function( name ) {
            return this.each(function() {
                jQuery.removeAttr( this, name );
            });
        },

        prop: function( name, value ) {
            return jQuery.access( this, name, value, true, jQuery.prop );
        },

        removeProp: function( name ) {
            name = jQuery.propFix[ name ] || name;
            return this.each(function() {
                // try/catch handles cases where IE balks (such as removing a property on window)
                try {
                    this[ name ] = undefined;
                    delete this[ name ];
                } catch( e ) {}
            });
        },

        addClass: function( value ) {
            var classNames, i, l, elem,
                setClass, c, cl;

            if ( jQuery.isFunction( value ) ) {
                return this.each(function( j ) {
                    jQuery( this ).addClass( value.call(this, j, this.className) );
                });
            }

            if ( value && typeof value === "string" ) {
                classNames = value.split( rspace );

                for ( i = 0, l = this.length; i < l; i++ ) {
                    elem = this[ i ];

                    if ( elem.nodeType === 1 ) {
                        if ( !elem.className && classNames.length === 1 ) {
                            elem.className = value;

                        } else {
                            setClass = " " + elem.className + " ";

                            for ( c = 0, cl = classNames.length; c < cl; c++ ) {
                                if ( !~setClass.indexOf( " " + classNames[ c ] + " " ) ) {
                                    setClass += classNames[ c ] + " ";
                                }
                            }
                            elem.className = jQuery.trim( setClass );
                        }
                    }
                }
            }

            return this;
        },

        removeClass: function( value ) {
            var classNames, i, l, elem, className, c, cl;

            if ( jQuery.isFunction( value ) ) {
                return this.each(function( j ) {
                    jQuery( this ).removeClass( value.call(this, j, this.className) );
                });
            }

            if ( (value && typeof value === "string") || value === undefined ) {
                classNames = ( value || "" ).split( rspace );

                for ( i = 0, l = this.length; i < l; i++ ) {
                    elem = this[ i ];

                    if ( elem.nodeType === 1 && elem.className ) {
                        if ( value ) {
                            className = (" " + elem.className + " ").replace( rclass, " " );
                            for ( c = 0, cl = classNames.length; c < cl; c++ ) {
                                className = className.replace(" " + classNames[ c ] + " ", " ");
                            }
                            elem.className = jQuery.trim( className );

                        } else {
                            elem.className = "";
                        }
                    }
                }
            }

            return this;
        },

        toggleClass: function( value, stateVal ) {
            var type = typeof value,
                isBool = typeof stateVal === "boolean";

            if ( jQuery.isFunction( value ) ) {
                return this.each(function( i ) {
                    jQuery( this ).toggleClass( value.call(this, i, this.className, stateVal), stateVal );
                });
            }

            return this.each(function() {
                if ( type === "string" ) {
                    // toggle individual class names
                    var className,
                        i = 0,
                        self = jQuery( this ),
                        state = stateVal,
                        classNames = value.split( rspace );

                    while ( (className = classNames[ i++ ]) ) {
                        // check each className given, space seperated list
                        state = isBool ? state : !self.hasClass( className );
                        self[ state ? "addClass" : "removeClass" ]( className );
                    }

                } else if ( type === "undefined" || type === "boolean" ) {
                    if ( this.className ) {
                        // store className if set
                        jQuery._data( this, "__className__", this.className );
                    }

                    // toggle whole className
                    this.className = this.className || value === false ? "" : jQuery._data( this, "__className__" ) || "";
                }
            });
        },

        hasClass: function( selector ) {
            var className = " " + selector + " ",
                i = 0,
                l = this.length;
            for ( ; i < l; i++ ) {
                if ( this[i].nodeType === 1 && (" " + this[i].className + " ").replace(rclass, " ").indexOf( className ) > -1 ) {
                    return true;
                }
            }

            return false;
        },

        val: function( value ) {
            var hooks, ret, isFunction,
                elem = this[0];

            if ( !arguments.length ) {
                if ( elem ) {
                    hooks = jQuery.valHooks[ elem.nodeName.toLowerCase() ] || jQuery.valHooks[ elem.type ];

                    if ( hooks && "get" in hooks && (ret = hooks.get( elem, "value" )) !== undefined ) {
                        return ret;
                    }

                    ret = elem.value;

                    return typeof ret === "string" ?
                        // handle most common string cases
                        ret.replace(rreturn, "") :
                        // handle cases where value is null/undef or number
                        ret == null ? "" : ret;
                }

                return;
            }

            isFunction = jQuery.isFunction( value );

            return this.each(function( i ) {
                var self = jQuery(this), val;

                if ( this.nodeType !== 1 ) {
                    return;
                }

                if ( isFunction ) {
                    val = value.call( this, i, self.val() );
                } else {
                    val = value;
                }

                // Treat null/undefined as ""; convert numbers to string
                if ( val == null ) {
                    val = "";
                } else if ( typeof val === "number" ) {
                    val += "";
                } else if ( jQuery.isArray( val ) ) {
                    val = jQuery.map(val, function ( value ) {
                        return value == null ? "" : value + "";
                    });
                }

                hooks = jQuery.valHooks[ this.nodeName.toLowerCase() ] || jQuery.valHooks[ this.type ];

                // If set returns undefined, fall back to normal setting
                if ( !hooks || !("set" in hooks) || hooks.set( this, val, "value" ) === undefined ) {
                    this.value = val;
                }
            });
        }
    });

    jQuery.extend({
        valHooks: {
            option: {
                get: function( elem ) {
                    // attributes.value is undefined in Blackberry 4.7 but
                    // uses .value. See #6932
                    var val = elem.attributes.value;
                    return !val || val.specified ? elem.value : elem.text;
                }
            },
            select: {
                get: function( elem ) {
                    var value, i, max, option,
                        index = elem.selectedIndex,
                        values = [],
                        options = elem.options,
                        one = elem.type === "select-one";

                    // Nothing was selected
                    if ( index < 0 ) {
                        return null;
                    }

                    // Loop through all the selected options
                    i = one ? index : 0;
                    max = one ? index + 1 : options.length;
                    for ( ; i < max; i++ ) {
                        option = options[ i ];

                        // Don't return options that are disabled or in a disabled optgroup
                        if ( option.selected && (jQuery.support.optDisabled ? !option.disabled : option.getAttribute("disabled") === null) &&
                            (!option.parentNode.disabled || !jQuery.nodeName( option.parentNode, "optgroup" )) ) {

                            // Get the specific value for the option
                            value = jQuery( option ).val();

                            // We don't need an array for one selects
                            if ( one ) {
                                return value;
                            }

                            // Multi-Selects return an array
                            values.push( value );
                        }
                    }

                    // Fixes Bug #2551 -- select.val() broken in IE after form.reset()
                    if ( one && !values.length && options.length ) {
                        return jQuery( options[ index ] ).val();
                    }

                    return values;
                },

                set: function( elem, value ) {
                    var values = jQuery.makeArray( value );

                    jQuery(elem).find("option").each(function() {
                        this.selected = jQuery.inArray( jQuery(this).val(), values ) >= 0;
                    });

                    if ( !values.length ) {
                        elem.selectedIndex = -1;
                    }
                    return values;
                }
            }
        },

        attrFn: {
            val: true,
            css: true,
            html: true,
            text: true,
            data: true,
            width: true,
            height: true,
            offset: true
        },

        attr: function( elem, name, value, pass ) {
            var ret, hooks, notxml,
                nType = elem.nodeType;

            // don't get/set attributes on text, comment and attribute nodes
            if ( !elem || nType === 3 || nType === 8 || nType === 2 ) {
                return;
            }

            if ( pass && name in jQuery.attrFn ) {
                return jQuery( elem )[ name ]( value );
            }

            // Fallback to prop when attributes are not supported
            if ( typeof elem.getAttribute === "undefined" ) {
                return jQuery.prop( elem, name, value );
            }

            notxml = nType !== 1 || !jQuery.isXMLDoc( elem );

            // All attributes are lowercase
            // Grab necessary hook if one is defined
            if ( notxml ) {
                name = name.toLowerCase();
                hooks = jQuery.attrHooks[ name ] || ( rboolean.test( name ) ? boolHook : nodeHook );
            }

            if ( value !== undefined ) {

                if ( value === null ) {
                    jQuery.removeAttr( elem, name );
                    return;

                } else if ( hooks && "set" in hooks && notxml && (ret = hooks.set( elem, value, name )) !== undefined ) {
                    return ret;

                } else {
                    elem.setAttribute( name, "" + value );
                    return value;
                }

            } else if ( hooks && "get" in hooks && notxml && (ret = hooks.get( elem, name )) !== null ) {
                return ret;

            } else {

                ret = elem.getAttribute( name );

                // Non-existent attributes return null, we normalize to undefined
                return ret === null ?
                    undefined :
                    ret;
            }
        },

        removeAttr: function( elem, value ) {
            var propName, attrNames, name, l,
                i = 0;

            if ( value && elem.nodeType === 1 ) {
                attrNames = value.toLowerCase().split( rspace );
                l = attrNames.length;

                for ( ; i < l; i++ ) {
                    name = attrNames[ i ];

                    if ( name ) {
                        propName = jQuery.propFix[ name ] || name;

                        // See #9699 for explanation of this approach (setting first, then removal)
                        jQuery.attr( elem, name, "" );
                        elem.removeAttribute( getSetAttribute ? name : propName );

                        // Set corresponding property to false for boolean attributes
                        if ( rboolean.test( name ) && propName in elem ) {
                            elem[ propName ] = false;
                        }
                    }
                }
            }
        },

        attrHooks: {
            type: {
                set: function( elem, value ) {
                    // We can't allow the type property to be changed (since it causes problems in IE)
                    if ( rtype.test( elem.nodeName ) && elem.parentNode ) {
                        jQuery.error( "type property can't be changed" );
                    } else if ( !jQuery.support.radioValue && value === "radio" && jQuery.nodeName(elem, "input") ) {
                        // Setting the type on a radio button after the value resets the value in IE6-9
                        // Reset value to it's default in case type is set after value
                        // This is for element creation
                        var val = elem.value;
                        elem.setAttribute( "type", value );
                        if ( val ) {
                            elem.value = val;
                        }
                        return value;
                    }
                }
            },
            // Use the value property for back compat
            // Use the nodeHook for button elements in IE6/7 (#1954)
            value: {
                get: function( elem, name ) {
                    if ( nodeHook && jQuery.nodeName( elem, "button" ) ) {
                        return nodeHook.get( elem, name );
                    }
                    return name in elem ?
                        elem.value :
                        null;
                },
                set: function( elem, value, name ) {
                    if ( nodeHook && jQuery.nodeName( elem, "button" ) ) {
                        return nodeHook.set( elem, value, name );
                    }
                    // Does not return so that setAttribute is also used
                    elem.value = value;
                }
            }
        },

        propFix: {
            tabindex: "tabIndex",
            readonly: "readOnly",
            "for": "htmlFor",
            "class": "className",
            maxlength: "maxLength",
            cellspacing: "cellSpacing",
            cellpadding: "cellPadding",
            rowspan: "rowSpan",
            colspan: "colSpan",
            usemap: "useMap",
            frameborder: "frameBorder",
            contenteditable: "contentEditable"
        },

        prop: function( elem, name, value ) {
            var ret, hooks, notxml,
                nType = elem.nodeType;

            // don't get/set properties on text, comment and attribute nodes
            if ( !elem || nType === 3 || nType === 8 || nType === 2 ) {
                return;
            }

            notxml = nType !== 1 || !jQuery.isXMLDoc( elem );

            if ( notxml ) {
                // Fix name and attach hooks
                name = jQuery.propFix[ name ] || name;
                hooks = jQuery.propHooks[ name ];
            }

            if ( value !== undefined ) {
                if ( hooks && "set" in hooks && (ret = hooks.set( elem, value, name )) !== undefined ) {
                    return ret;

                } else {
                    return ( elem[ name ] = value );
                }

            } else {
                if ( hooks && "get" in hooks && (ret = hooks.get( elem, name )) !== null ) {
                    return ret;

                } else {
                    return elem[ name ];
                }
            }
        },

        propHooks: {
            tabIndex: {
                get: function( elem ) {
                    // elem.tabIndex doesn't always return the correct value when it hasn't been explicitly set
                    // http://fluidproject.org/blog/2008/01/09/getting-setting-and-removing-tabindex-values-with-javascript/
                    var attributeNode = elem.getAttributeNode("tabindex");

                    return attributeNode && attributeNode.specified ?
                        parseInt( attributeNode.value, 10 ) :
                        rfocusable.test( elem.nodeName ) || rclickable.test( elem.nodeName ) && elem.href ?
                            0 :
                            undefined;
                }
            }
        }
    });

// Add the tabIndex propHook to attrHooks for back-compat (different case is intentional)
    jQuery.attrHooks.tabindex = jQuery.propHooks.tabIndex;

// Hook for boolean attributes
    boolHook = {
        get: function( elem, name ) {
            // Align boolean attributes with corresponding properties
            // Fall back to attribute presence where some booleans are not supported
            var attrNode,
                property = jQuery.prop( elem, name );
            return property === true || typeof property !== "boolean" && ( attrNode = elem.getAttributeNode(name) ) && attrNode.nodeValue !== false ?
                name.toLowerCase() :
                undefined;
        },
        set: function( elem, value, name ) {
            var propName;
            if ( value === false ) {
                // Remove boolean attributes when set to false
                jQuery.removeAttr( elem, name );
            } else {
                // value is true since we know at this point it's type boolean and not false
                // Set boolean attributes to the same name and set the DOM property
                propName = jQuery.propFix[ name ] || name;
                if ( propName in elem ) {
                    // Only set the IDL specifically if it already exists on the element
                    elem[ propName ] = true;
                }

                elem.setAttribute( name, name.toLowerCase() );
            }
            return name;
        }
    };

// IE6/7 do not support getting/setting some attributes with get/setAttribute
    if ( !getSetAttribute ) {

        fixSpecified = {
            name: true,
            id: true
        };

        // Use this for any attribute in IE6/7
        // This fixes almost every IE6/7 issue
        nodeHook = jQuery.valHooks.button = {
            get: function( elem, name ) {
                var ret;
                ret = elem.getAttributeNode( name );
                return ret && ( fixSpecified[ name ] ? ret.nodeValue !== "" : ret.specified ) ?
                    ret.nodeValue :
                    undefined;
            },
            set: function( elem, value, name ) {
                // Set the existing or create a new attribute node
                var ret = elem.getAttributeNode( name );
                if ( !ret ) {
                    ret = document.createAttribute( name );
                    elem.setAttributeNode( ret );
                }
                return ( ret.nodeValue = value + "" );
            }
        };

        // Apply the nodeHook to tabindex
        jQuery.attrHooks.tabindex.set = nodeHook.set;

        // Set width and height to auto instead of 0 on empty string( Bug #8150 )
        // This is for removals
        jQuery.each([ "width", "height" ], function( i, name ) {
            jQuery.attrHooks[ name ] = jQuery.extend( jQuery.attrHooks[ name ], {
                set: function( elem, value ) {
                    if ( value === "" ) {
                        elem.setAttribute( name, "auto" );
                        return value;
                    }
                }
            });
        });

        // Set contenteditable to false on removals(#10429)
        // Setting to empty string throws an error as an invalid value
        jQuery.attrHooks.contenteditable = {
            get: nodeHook.get,
            set: function( elem, value, name ) {
                if ( value === "" ) {
                    value = "false";
                }
                nodeHook.set( elem, value, name );
            }
        };
    }


// Some attributes require a special call on IE
    if ( !jQuery.support.hrefNormalized ) {
        jQuery.each([ "href", "src", "width", "height" ], function( i, name ) {
            jQuery.attrHooks[ name ] = jQuery.extend( jQuery.attrHooks[ name ], {
                get: function( elem ) {
                    var ret = elem.getAttribute( name, 2 );
                    return ret === null ? undefined : ret;
                }
            });
        });
    }

    if ( !jQuery.support.style ) {
        jQuery.attrHooks.style = {
            get: function( elem ) {
                // Return undefined in the case of empty string
                // Normalize to lowercase since IE uppercases css property names
                return elem.style.cssText.toLowerCase() || undefined;
            },
            set: function( elem, value ) {
                return ( elem.style.cssText = "" + value );
            }
        };
    }

// Safari mis-reports the default selected property of an option
// Accessing the parent's selectedIndex property fixes it
    if ( !jQuery.support.optSelected ) {
        jQuery.propHooks.selected = jQuery.extend( jQuery.propHooks.selected, {
            get: function( elem ) {
                var parent = elem.parentNode;

                if ( parent ) {
                    parent.selectedIndex;

                    // Make sure that it also works with optgroups, see #5701
                    if ( parent.parentNode ) {
                        parent.parentNode.selectedIndex;
                    }
                }
                return null;
            }
        });
    }

// IE6/7 call enctype encoding
    if ( !jQuery.support.enctype ) {
        jQuery.propFix.enctype = "encoding";
    }

// Radios and checkboxes getter/setter
    if ( !jQuery.support.checkOn ) {
        jQuery.each([ "radio", "checkbox" ], function() {
            jQuery.valHooks[ this ] = {
                get: function( elem ) {
                    // Handle the case where in Webkit "" is returned instead of "on" if a value isn't specified
                    return elem.getAttribute("value") === null ? "on" : elem.value;
                }
            };
        });
    }
    jQuery.each([ "radio", "checkbox" ], function() {
        jQuery.valHooks[ this ] = jQuery.extend( jQuery.valHooks[ this ], {
            set: function( elem, value ) {
                if ( jQuery.isArray( value ) ) {
                    return ( elem.checked = jQuery.inArray( jQuery(elem).val(), value ) >= 0 );
                }
            }
        });
    });




    var rformElems = /^(?:textarea|input|select)$/i,
        rtypenamespace = /^([^\.]*)?(?:\.(.+))?$/,
        rhoverHack = /\bhover(\.\S+)?\b/,
        rkeyEvent = /^key/,
        rmouseEvent = /^(?:mouse|contextmenu)|click/,
        rfocusMorph = /^(?:focusinfocus|focusoutblur)$/,
        rquickIs = /^(\w*)(?:#([\w\-]+))?(?:\.([\w\-]+))?$/,
        quickParse = function( selector ) {
            var quick = rquickIs.exec( selector );
            if ( quick ) {
                //   0  1    2   3
                // [ _, tag, id, class ]
                quick[1] = ( quick[1] || "" ).toLowerCase();
                quick[3] = quick[3] && new RegExp( "(?:^|\\s)" + quick[3] + "(?:\\s|$)" );
            }
            return quick;
        },
        quickIs = function( elem, m ) {
            var attrs = elem.attributes || {};
            return (
                (!m[1] || elem.nodeName.toLowerCase() === m[1]) &&
                (!m[2] || (attrs.id || {}).value === m[2]) &&
                (!m[3] || m[3].test( (attrs[ "class" ] || {}).value ))
            );
        },
        hoverHack = function( events ) {
            return jQuery.event.special.hover ? events : events.replace( rhoverHack, "mouseenter$1 mouseleave$1" );
        };

    /*
     * Helper functions for managing events -- not part of the public interface.
     * Props to Dean Edwards' addEvent library for many of the ideas.
     */
    jQuery.event = {

        add: function( elem, types, handler, data, selector ) {

            var elemData, eventHandle, events,
                t, tns, type, namespaces, handleObj,
                handleObjIn, quick, handlers, special;

            // Don't attach events to noData or text/comment nodes (allow plain objects tho)
            if ( elem.nodeType === 3 || elem.nodeType === 8 || !types || !handler || !(elemData = jQuery._data( elem )) ) {
                return;
            }

            // Caller can pass in an object of custom data in lieu of the handler
            if ( handler.handler ) {
                handleObjIn = handler;
                handler = handleObjIn.handler;
            }

            // Make sure that the handler has a unique ID, used to find/remove it later
            if ( !handler.guid ) {
                handler.guid = jQuery.guid++;
            }

            // Init the element's event structure and main handler, if this is the first
            events = elemData.events;
            if ( !events ) {
                elemData.events = events = {};
            }
            eventHandle = elemData.handle;
            if ( !eventHandle ) {
                elemData.handle = eventHandle = function( e ) {
                    // Discard the second event of a jQuery.event.trigger() and
                    // when an event is called after a page has unloaded
                    return typeof jQuery !== "undefined" && (!e || jQuery.event.triggered !== e.type) ?
                        jQuery.event.dispatch.apply( eventHandle.elem, arguments ) :
                        undefined;
                };
                // Add elem as a property of the handle fn to prevent a memory leak with IE non-native events
                eventHandle.elem = elem;
            }

            // Handle multiple events separated by a space
            // jQuery(...).bind("mouseover mouseout", fn);
            types = jQuery.trim( hoverHack(types) ).split( " " );
            for ( t = 0; t < types.length; t++ ) {

                tns = rtypenamespace.exec( types[t] ) || [];
                type = tns[1];
                namespaces = ( tns[2] || "" ).split( "." ).sort();

                // If event changes its type, use the special event handlers for the changed type
                special = jQuery.event.special[ type ] || {};

                // If selector defined, determine special event api type, otherwise given type
                type = ( selector ? special.delegateType : special.bindType ) || type;

                // Update special based on newly reset type
                special = jQuery.event.special[ type ] || {};

                // handleObj is passed to all event handlers
                handleObj = jQuery.extend({
                    type: type,
                    origType: tns[1],
                    data: data,
                    handler: handler,
                    guid: handler.guid,
                    selector: selector,
                    quick: quickParse( selector ),
                    namespace: namespaces.join(".")
                }, handleObjIn );

                // Init the event handler queue if we're the first
                handlers = events[ type ];
                if ( !handlers ) {
                    handlers = events[ type ] = [];
                    handlers.delegateCount = 0;

                    // Only use addEventListener/attachEvent if the special events handler returns false
                    if ( !special.setup || special.setup.call( elem, data, namespaces, eventHandle ) === false ) {
                        // Bind the global event handler to the element
                        if ( elem.addEventListener ) {
                            elem.addEventListener( type, eventHandle, false );

                        } else if ( elem.attachEvent ) {
                            elem.attachEvent( "on" + type, eventHandle );
                        }
                    }
                }

                if ( special.add ) {
                    special.add.call( elem, handleObj );

                    if ( !handleObj.handler.guid ) {
                        handleObj.handler.guid = handler.guid;
                    }
                }

                // Add to the element's handler list, delegates in front
                if ( selector ) {
                    handlers.splice( handlers.delegateCount++, 0, handleObj );
                } else {
                    handlers.push( handleObj );
                }

                // Keep track of which events have ever been used, for event optimization
                jQuery.event.global[ type ] = true;
            }

            // Nullify elem to prevent memory leaks in IE
            elem = null;
        },

        global: {},

        // Detach an event or set of events from an element
        remove: function( elem, types, handler, selector, mappedTypes ) {

            var elemData = jQuery.hasData( elem ) && jQuery._data( elem ),
                t, tns, type, origType, namespaces, origCount,
                j, events, special, handle, eventType, handleObj;

            if ( !elemData || !(events = elemData.events) ) {
                return;
            }

            // Once for each type.namespace in types; type may be omitted
            types = jQuery.trim( hoverHack( types || "" ) ).split(" ");
            for ( t = 0; t < types.length; t++ ) {
                tns = rtypenamespace.exec( types[t] ) || [];
                type = origType = tns[1];
                namespaces = tns[2];

                // Unbind all events (on this namespace, if provided) for the element
                if ( !type ) {
                    for ( type in events ) {
                        jQuery.event.remove( elem, type + types[ t ], handler, selector, true );
                    }
                    continue;
                }

                special = jQuery.event.special[ type ] || {};
                type = ( selector? special.delegateType : special.bindType ) || type;
                eventType = events[ type ] || [];
                origCount = eventType.length;
                namespaces = namespaces ? new RegExp("(^|\\.)" + namespaces.split(".").sort().join("\\.(?:.*\\.)?") + "(\\.|$)") : null;

                // Remove matching events
                for ( j = 0; j < eventType.length; j++ ) {
                    handleObj = eventType[ j ];

                    if ( ( mappedTypes || origType === handleObj.origType ) &&
                        ( !handler || handler.guid === handleObj.guid ) &&
                        ( !namespaces || namespaces.test( handleObj.namespace ) ) &&
                        ( !selector || selector === handleObj.selector || selector === "**" && handleObj.selector ) ) {
                        eventType.splice( j--, 1 );

                        if ( handleObj.selector ) {
                            eventType.delegateCount--;
                        }
                        if ( special.remove ) {
                            special.remove.call( elem, handleObj );
                        }
                    }
                }

                // Remove generic event handler if we removed something and no more handlers exist
                // (avoids potential for endless recursion during removal of special event handlers)
                if ( eventType.length === 0 && origCount !== eventType.length ) {
                    if ( !special.teardown || special.teardown.call( elem, namespaces ) === false ) {
                        jQuery.removeEvent( elem, type, elemData.handle );
                    }

                    delete events[ type ];
                }
            }

            // Remove the expando if it's no longer used
            if ( jQuery.isEmptyObject( events ) ) {
                handle = elemData.handle;
                if ( handle ) {
                    handle.elem = null;
                }

                // removeData also checks for emptiness and clears the expando if empty
                // so use it instead of delete
                jQuery.removeData( elem, [ "events", "handle" ], true );
            }
        },

        // Events that are safe to short-circuit if no handlers are attached.
        // Native DOM events should not be added, they may have inline handlers.
        customEvent: {
            "getData": true,
            "setData": true,
            "changeData": true
        },

        trigger: function( event, data, elem, onlyHandlers ) {
            // Don't do events on text and comment nodes
            if ( elem && (elem.nodeType === 3 || elem.nodeType === 8) ) {
                return;
            }

            // Event object or event type
            var type = event.type || event,
                namespaces = [],
                cache, exclusive, i, cur, old, ontype, special, handle, eventPath, bubbleType;

            // focus/blur morphs to focusin/out; ensure we're not firing them right now
            if ( rfocusMorph.test( type + jQuery.event.triggered ) ) {
                return;
            }

            if ( type.indexOf( "!" ) >= 0 ) {
                // Exclusive events trigger only for the exact event (no namespaces)
                type = type.slice(0, -1);
                exclusive = true;
            }

            if ( type.indexOf( "." ) >= 0 ) {
                // Namespaced trigger; create a regexp to match event type in handle()
                namespaces = type.split(".");
                type = namespaces.shift();
                namespaces.sort();
            }

            if ( (!elem || jQuery.event.customEvent[ type ]) && !jQuery.event.global[ type ] ) {
                // No jQuery handlers for this event type, and it can't have inline handlers
                return;
            }

            // Caller can pass in an Event, Object, or just an event type string
            event = typeof event === "object" ?
                // jQuery.Event object
                event[ jQuery.expando ] ? event :
                    // Object literal
                    new jQuery.Event( type, event ) :
                // Just the event type (string)
                new jQuery.Event( type );

            event.type = type;
            event.isTrigger = true;
            event.exclusive = exclusive;
            event.namespace = namespaces.join( "." );
            event.namespace_re = event.namespace? new RegExp("(^|\\.)" + namespaces.join("\\.(?:.*\\.)?") + "(\\.|$)") : null;
            ontype = type.indexOf( ":" ) < 0 ? "on" + type : "";

            // Handle a global trigger
            if ( !elem ) {

                // TODO: Stop taunting the data cache; remove global events and always attach to document
                cache = jQuery.cache;
                for ( i in cache ) {
                    if ( cache[ i ].events && cache[ i ].events[ type ] ) {
                        jQuery.event.trigger( event, data, cache[ i ].handle.elem, true );
                    }
                }
                return;
            }

            // Clean up the event in case it is being reused
            event.result = undefined;
            if ( !event.target ) {
                event.target = elem;
            }

            // Clone any incoming data and prepend the event, creating the handler arg list
            data = data != null ? jQuery.makeArray( data ) : [];
            data.unshift( event );

            // Allow special events to draw outside the lines
            special = jQuery.event.special[ type ] || {};
            if ( special.trigger && special.trigger.apply( elem, data ) === false ) {
                return;
            }

            // Determine event propagation path in advance, per W3C events spec (#9951)
            // Bubble up to document, then to window; watch for a global ownerDocument var (#9724)
            eventPath = [[ elem, special.bindType || type ]];
            if ( !onlyHandlers && !special.noBubble && !jQuery.isWindow( elem ) ) {

                bubbleType = special.delegateType || type;
                cur = rfocusMorph.test( bubbleType + type ) ? elem : elem.parentNode;
                old = null;
                for ( ; cur; cur = cur.parentNode ) {
                    eventPath.push([ cur, bubbleType ]);
                    old = cur;
                }

                // Only add window if we got to document (e.g., not plain obj or detached DOM)
                if ( old && old === elem.ownerDocument ) {
                    eventPath.push([ old.defaultView || old.parentWindow || window, bubbleType ]);
                }
            }

            // Fire handlers on the event path
            for ( i = 0; i < eventPath.length && !event.isPropagationStopped(); i++ ) {

                cur = eventPath[i][0];
                event.type = eventPath[i][1];

                handle = ( jQuery._data( cur, "events" ) || {} )[ event.type ] && jQuery._data( cur, "handle" );
                if ( handle ) {
                    handle.apply( cur, data );
                }
                // Note that this is a bare JS function and not a jQuery handler
                handle = ontype && cur[ ontype ];
                if ( handle && jQuery.acceptData( cur ) && handle.apply( cur, data ) === false ) {
                    event.preventDefault();
                }
            }
            event.type = type;

            // If nobody prevented the default action, do it now
            if ( !onlyHandlers && !event.isDefaultPrevented() ) {

                if ( (!special._default || special._default.apply( elem.ownerDocument, data ) === false) &&
                    !(type === "click" && jQuery.nodeName( elem, "a" )) && jQuery.acceptData( elem ) ) {

                    // Call a native DOM method on the target with the same name name as the event.
                    // Can't use an .isFunction() check here because IE6/7 fails that test.
                    // Don't do default actions on window, that's where global variables be (#6170)
                    // IE<9 dies on focus/blur to hidden element (#1486)
                    if ( ontype && elem[ type ] && ((type !== "focus" && type !== "blur") || event.target.offsetWidth !== 0) && !jQuery.isWindow( elem ) ) {

                        // Don't re-trigger an onFOO event when we call its FOO() method
                        old = elem[ ontype ];

                        if ( old ) {
                            elem[ ontype ] = null;
                        }

                        // Prevent re-triggering of the same event, since we already bubbled it above
                        jQuery.event.triggered = type;
                        elem[ type ]();
                        jQuery.event.triggered = undefined;

                        if ( old ) {
                            elem[ ontype ] = old;
                        }
                    }
                }
            }

            return event.result;
        },

        dispatch: function( event ) {

            // Make a writable jQuery.Event from the native event object
            event = jQuery.event.fix( event || window.event );

            var handlers = ( (jQuery._data( this, "events" ) || {} )[ event.type ] || []),
                delegateCount = handlers.delegateCount,
                args = [].slice.call( arguments, 0 ),
                run_all = !event.exclusive && !event.namespace,
                handlerQueue = [],
                i, j, cur, jqcur, ret, selMatch, matched, matches, handleObj, sel, related;

            // Use the fix-ed jQuery.Event rather than the (read-only) native event
            args[0] = event;
            event.delegateTarget = this;

            // Determine handlers that should run if there are delegated events
            // Avoid disabled elements in IE (#6911) and non-left-click bubbling in Firefox (#3861)
            if ( delegateCount && !event.target.disabled && !(event.button && event.type === "click") ) {

                // Pregenerate a single jQuery object for reuse with .is()
                jqcur = jQuery(this);
                jqcur.context = this.ownerDocument || this;

                for ( cur = event.target; cur != this; cur = cur.parentNode || this ) {
                    selMatch = {};
                    matches = [];
                    jqcur[0] = cur;
                    for ( i = 0; i < delegateCount; i++ ) {
                        handleObj = handlers[ i ];
                        sel = handleObj.selector;

                        if ( selMatch[ sel ] === undefined ) {
                            selMatch[ sel ] = (
                                handleObj.quick ? quickIs( cur, handleObj.quick ) : jqcur.is( sel )
                            );
                        }
                        if ( selMatch[ sel ] ) {
                            matches.push( handleObj );
                        }
                    }
                    if ( matches.length ) {
                        handlerQueue.push({ elem: cur, matches: matches });
                    }
                }
            }

            // Add the remaining (directly-bound) handlers
            if ( handlers.length > delegateCount ) {
                handlerQueue.push({ elem: this, matches: handlers.slice( delegateCount ) });
            }

            // Run delegates first; they may want to stop propagation beneath us
            for ( i = 0; i < handlerQueue.length && !event.isPropagationStopped(); i++ ) {
                matched = handlerQueue[ i ];
                event.currentTarget = matched.elem;

                for ( j = 0; j < matched.matches.length && !event.isImmediatePropagationStopped(); j++ ) {
                    handleObj = matched.matches[ j ];

                    // Triggered event must either 1) be non-exclusive and have no namespace, or
                    // 2) have namespace(s) a subset or equal to those in the bound event (both can have no namespace).
                    if ( run_all || (!event.namespace && !handleObj.namespace) || event.namespace_re && event.namespace_re.test( handleObj.namespace ) ) {

                        event.data = handleObj.data;
                        event.handleObj = handleObj;

                        ret = ( (jQuery.event.special[ handleObj.origType ] || {}).handle || handleObj.handler )
                            .apply( matched.elem, args );

                        if ( ret !== undefined ) {
                            event.result = ret;
                            if ( ret === false ) {
                                event.preventDefault();
                                event.stopPropagation();
                            }
                        }
                    }
                }
            }

            return event.result;
        },

        // Includes some event props shared by KeyEvent and MouseEvent
        // *** attrChange attrName relatedNode srcElement  are not normalized, non-W3C, deprecated, will be removed in 1.8 ***
        props: "attrChange attrName relatedNode srcElement altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),

        fixHooks: {},

        keyHooks: {
            props: "char charCode key keyCode".split(" "),
            filter: function( event, original ) {

                // Add which for key events
                if ( event.which == null ) {
                    event.which = original.charCode != null ? original.charCode : original.keyCode;
                }

                return event;
            }
        },

        mouseHooks: {
            props: "button buttons clientX clientY fromElement offsetX offsetY pageX pageY screenX screenY toElement".split(" "),
            filter: function( event, original ) {
                var eventDoc, doc, body,
                    button = original.button,
                    fromElement = original.fromElement;

                // Calculate pageX/Y if missing and clientX/Y available
                if ( event.pageX == null && original.clientX != null ) {
                    eventDoc = event.target.ownerDocument || document;
                    doc = eventDoc.documentElement;
                    body = eventDoc.body;

                    event.pageX = original.clientX + ( doc && doc.scrollLeft || body && body.scrollLeft || 0 ) - ( doc && doc.clientLeft || body && body.clientLeft || 0 );
                    event.pageY = original.clientY + ( doc && doc.scrollTop  || body && body.scrollTop  || 0 ) - ( doc && doc.clientTop  || body && body.clientTop  || 0 );
                }

                // Add relatedTarget, if necessary
                if ( !event.relatedTarget && fromElement ) {
                    event.relatedTarget = fromElement === event.target ? original.toElement : fromElement;
                }

                // Add which for click: 1 === left; 2 === middle; 3 === right
                // Note: button is not normalized, so don't use it
                if ( !event.which && button !== undefined ) {
                    event.which = ( button & 1 ? 1 : ( button & 2 ? 3 : ( button & 4 ? 2 : 0 ) ) );
                }

                return event;
            }
        },

        fix: function( event ) {
            if ( event[ jQuery.expando ] ) {
                return event;
            }

            // Create a writable copy of the event object and normalize some properties
            var i, prop,
                originalEvent = event,
                fixHook = jQuery.event.fixHooks[ event.type ] || {},
                copy = fixHook.props ? this.props.concat( fixHook.props ) : this.props;

            event = jQuery.Event( originalEvent );

            for ( i = copy.length; i; ) {
                prop = copy[ --i ];
                event[ prop ] = originalEvent[ prop ];
            }

            // Fix target property, if necessary (#1925, IE 6/7/8 & Safari2)
            if ( !event.target ) {
                event.target = originalEvent.srcElement || document;
            }

            // Target should not be a text node (#504, Safari)
            if ( event.target.nodeType === 3 ) {
                event.target = event.target.parentNode;
            }

            // For mouse/key events; add metaKey if it's not there (#3368, IE6/7/8)
            if ( event.metaKey === undefined ) {
                event.metaKey = event.ctrlKey;
            }

            return fixHook.filter? fixHook.filter( event, originalEvent ) : event;
        },

        special: {
            ready: {
                // Make sure the ready event is setup
                setup: jQuery.bindReady
            },

            load: {
                // Prevent triggered image.load events from bubbling to window.load
                noBubble: true
            },

            focus: {
                delegateType: "focusin"
            },
            blur: {
                delegateType: "focusout"
            },

            beforeunload: {
                setup: function( data, namespaces, eventHandle ) {
                    // We only want to do this special case on windows
                    if ( jQuery.isWindow( this ) ) {
                        this.onbeforeunload = eventHandle;
                    }
                },

                teardown: function( namespaces, eventHandle ) {
                    if ( this.onbeforeunload === eventHandle ) {
                        this.onbeforeunload = null;
                    }
                }
            }
        },

        simulate: function( type, elem, event, bubble ) {
            // Piggyback on a donor event to simulate a different one.
            // Fake originalEvent to avoid donor's stopPropagation, but if the
            // simulated event prevents default then we do the same on the donor.
            var e = jQuery.extend(
                new jQuery.Event(),
                event,
                { type: type,
                    isSimulated: true,
                    originalEvent: {}
                }
            );
            if ( bubble ) {
                jQuery.event.trigger( e, null, elem );
            } else {
                jQuery.event.dispatch.call( elem, e );
            }
            if ( e.isDefaultPrevented() ) {
                event.preventDefault();
            }
        }
    };

// Some plugins are using, but it's undocumented/deprecated and will be removed.
// The 1.7 special event interface should provide all the hooks needed now.
    jQuery.event.handle = jQuery.event.dispatch;

    jQuery.removeEvent = document.removeEventListener ?
        function( elem, type, handle ) {
            if ( elem.removeEventListener ) {
                elem.removeEventListener( type, handle, false );
            }
        } :
        function( elem, type, handle ) {
            if ( elem.detachEvent ) {
                elem.detachEvent( "on" + type, handle );
            }
        };

    jQuery.Event = function( src, props ) {
        // Allow instantiation without the 'new' keyword
        if ( !(this instanceof jQuery.Event) ) {
            return new jQuery.Event( src, props );
        }

        // Event object
        if ( src && src.type ) {
            this.originalEvent = src;
            this.type = src.type;

            // Events bubbling up the document may have been marked as prevented
            // by a handler lower down the tree; reflect the correct value.
            this.isDefaultPrevented = ( src.defaultPrevented || src.returnValue === false ||
            src.getPreventDefault && src.getPreventDefault() ) ? returnTrue : returnFalse;

            // Event type
        } else {
            this.type = src;
        }

        // Put explicitly provided properties onto the event object
        if ( props ) {
            jQuery.extend( this, props );
        }

        // Create a timestamp if incoming event doesn't have one
        this.timeStamp = src && src.timeStamp || jQuery.now();

        // Mark it as fixed
        this[ jQuery.expando ] = true;
    };

    function returnFalse() {
        return false;
    }
    function returnTrue() {
        return true;
    }

// jQuery.Event is based on DOM3 Events as specified by the ECMAScript Language Binding
// http://www.w3.org/TR/2003/WD-DOM-Level-3-Events-20030331/ecma-script-binding.html
    jQuery.Event.prototype = {
        preventDefault: function() {
            this.isDefaultPrevented = returnTrue;

            var e = this.originalEvent;
            if ( !e ) {
                return;
            }

            // if preventDefault exists run it on the original event
            if ( e.preventDefault ) {
                e.preventDefault();

                // otherwise set the returnValue property of the original event to false (IE)
            } else {
                e.returnValue = false;
            }
        },
        stopPropagation: function() {
            this.isPropagationStopped = returnTrue;

            var e = this.originalEvent;
            if ( !e ) {
                return;
            }
            // if stopPropagation exists run it on the original event
            if ( e.stopPropagation ) {
                e.stopPropagation();
            }
            // otherwise set the cancelBubble property of the original event to true (IE)
            e.cancelBubble = true;
        },
        stopImmediatePropagation: function() {
            this.isImmediatePropagationStopped = returnTrue;
            this.stopPropagation();
        },
        isDefaultPrevented: returnFalse,
        isPropagationStopped: returnFalse,
        isImmediatePropagationStopped: returnFalse
    };

// Create mouseenter/leave events using mouseover/out and event-time checks
    jQuery.each({
        mouseenter: "mouseover",
        mouseleave: "mouseout"
    }, function( orig, fix ) {
        jQuery.event.special[ orig ] = {
            delegateType: fix,
            bindType: fix,

            handle: function( event ) {
                var target = this,
                    related = event.relatedTarget,
                    handleObj = event.handleObj,
                    selector = handleObj.selector,
                    ret;

                // For mousenter/leave call the handler if related is outside the target.
                // NB: No relatedTarget if the mouse left/entered the browser window
                if ( !related || (related !== target && !jQuery.contains( target, related )) ) {
                    event.type = handleObj.origType;
                    ret = handleObj.handler.apply( this, arguments );
                    event.type = fix;
                }
                return ret;
            }
        };
    });

// IE submit delegation
    if ( !jQuery.support.submitBubbles ) {

        jQuery.event.special.submit = {
            setup: function() {
                // Only need this for delegated form submit events
                if ( jQuery.nodeName( this, "form" ) ) {
                    return false;
                }

                // Lazy-add a submit handler when a descendant form may potentially be submitted
                jQuery.event.add( this, "click._submit keypress._submit", function( e ) {
                    // Node name check avoids a VML-related crash in IE (#9807)
                    var elem = e.target,
                        form = jQuery.nodeName( elem, "input" ) || jQuery.nodeName( elem, "button" ) ? elem.form : undefined;
                    if ( form && !form._submit_attached ) {
                        jQuery.event.add( form, "submit._submit", function( event ) {
                            // If form was submitted by the user, bubble the event up the tree
                            if ( this.parentNode && !event.isTrigger ) {
                                jQuery.event.simulate( "submit", this.parentNode, event, true );
                            }
                        });
                        form._submit_attached = true;
                    }
                });
                // return undefined since we don't need an event listener
            },

            teardown: function() {
                // Only need this for delegated form submit events
                if ( jQuery.nodeName( this, "form" ) ) {
                    return false;
                }

                // Remove delegated handlers; cleanData eventually reaps submit handlers attached above
                jQuery.event.remove( this, "._submit" );
            }
        };
    }

// IE change delegation and checkbox/radio fix
    if ( !jQuery.support.changeBubbles ) {

        jQuery.event.special.change = {

            setup: function() {

                if ( rformElems.test( this.nodeName ) ) {
                    // IE doesn't fire change on a check/radio until blur; trigger it on click
                    // after a propertychange. Eat the blur-change in special.change.handle.
                    // This still fires onchange a second time for check/radio after blur.
                    if ( this.type === "checkbox" || this.type === "radio" ) {
                        jQuery.event.add( this, "propertychange._change", function( event ) {
                            if ( event.originalEvent.propertyName === "checked" ) {
                                this._just_changed = true;
                            }
                        });
                        jQuery.event.add( this, "click._change", function( event ) {
                            if ( this._just_changed && !event.isTrigger ) {
                                this._just_changed = false;
                                jQuery.event.simulate( "change", this, event, true );
                            }
                        });
                    }
                    return false;
                }
                // Delegated event; lazy-add a change handler on descendant inputs
                jQuery.event.add( this, "beforeactivate._change", function( e ) {
                    var elem = e.target;

                    if ( rformElems.test( elem.nodeName ) && !elem._change_attached ) {
                        jQuery.event.add( elem, "change._change", function( event ) {
                            if ( this.parentNode && !event.isSimulated && !event.isTrigger ) {
                                jQuery.event.simulate( "change", this.parentNode, event, true );
                            }
                        });
                        elem._change_attached = true;
                    }
                });
            },

            handle: function( event ) {
                var elem = event.target;

                // Swallow native change events from checkbox/radio, we already triggered them above
                if ( this !== elem || event.isSimulated || event.isTrigger || (elem.type !== "radio" && elem.type !== "checkbox") ) {
                    return event.handleObj.handler.apply( this, arguments );
                }
            },

            teardown: function() {
                jQuery.event.remove( this, "._change" );

                return rformElems.test( this.nodeName );
            }
        };
    }

// Create "bubbling" focus and blur events
    if ( !jQuery.support.focusinBubbles ) {
        jQuery.each({ focus: "focusin", blur: "focusout" }, function( orig, fix ) {

            // Attach a single capturing handler while someone wants focusin/focusout
            var attaches = 0,
                handler = function( event ) {
                    jQuery.event.simulate( fix, event.target, jQuery.event.fix( event ), true );
                };

            jQuery.event.special[ fix ] = {
                setup: function() {
                    if ( attaches++ === 0 ) {
                        document.addEventListener( orig, handler, true );
                    }
                },
                teardown: function() {
                    if ( --attaches === 0 ) {
                        document.removeEventListener( orig, handler, true );
                    }
                }
            };
        });
    }

    jQuery.fn.extend({

        on: function( types, selector, data, fn, /*INTERNAL*/ one ) {
            var origFn, type;

            // Types can be a map of types/handlers
            if ( typeof types === "object" ) {
                // ( types-Object, selector, data )
                if ( typeof selector !== "string" ) {
                    // ( types-Object, data )
                    data = selector;
                    selector = undefined;
                }
                for ( type in types ) {
                    this.on( type, selector, data, types[ type ], one );
                }
                return this;
            }

            if ( data == null && fn == null ) {
                // ( types, fn )
                fn = selector;
                data = selector = undefined;
            } else if ( fn == null ) {
                if ( typeof selector === "string" ) {
                    // ( types, selector, fn )
                    fn = data;
                    data = undefined;
                } else {
                    // ( types, data, fn )
                    fn = data;
                    data = selector;
                    selector = undefined;
                }
            }
            if ( fn === false ) {
                fn = returnFalse;
            } else if ( !fn ) {
                return this;
            }

            if ( one === 1 ) {
                origFn = fn;
                fn = function( event ) {
                    // Can use an empty set, since event contains the info
                    jQuery().off( event );
                    return origFn.apply( this, arguments );
                };
                // Use same guid so caller can remove using origFn
                fn.guid = origFn.guid || ( origFn.guid = jQuery.guid++ );
            }
            return this.each( function() {
                jQuery.event.add( this, types, fn, data, selector );
            });
        },
        one: function( types, selector, data, fn ) {
            return this.on.call( this, types, selector, data, fn, 1 );
        },
        off: function( types, selector, fn ) {
            if ( types && types.preventDefault && types.handleObj ) {
                // ( event )  dispatched jQuery.Event
                var handleObj = types.handleObj;
                jQuery( types.delegateTarget ).off(
                    handleObj.namespace? handleObj.type + "." + handleObj.namespace : handleObj.type,
                    handleObj.selector,
                    handleObj.handler
                );
                return this;
            }
            if ( typeof types === "object" ) {
                // ( types-object [, selector] )
                for ( var type in types ) {
                    this.off( type, selector, types[ type ] );
                }
                return this;
            }
            if ( selector === false || typeof selector === "function" ) {
                // ( types [, fn] )
                fn = selector;
                selector = undefined;
            }
            if ( fn === false ) {
                fn = returnFalse;
            }
            return this.each(function() {
                jQuery.event.remove( this, types, fn, selector );
            });
        },

        bind: function( types, data, fn ) {
            return this.on( types, null, data, fn );
        },
        unbind: function( types, fn ) {
            return this.off( types, null, fn );
        },

        live: function( types, data, fn ) {
            jQuery( this.context ).on( types, this.selector, data, fn );
            return this;
        },
        die: function( types, fn ) {
            jQuery( this.context ).off( types, this.selector || "**", fn );
            return this;
        },

        delegate: function( selector, types, data, fn ) {
            return this.on( types, selector, data, fn );
        },
        undelegate: function( selector, types, fn ) {
            // ( namespace ) or ( selector, types [, fn] )
            return arguments.length == 1? this.off( selector, "**" ) : this.off( types, selector, fn );
        },

        trigger: function( type, data ) {
            return this.each(function() {
                jQuery.event.trigger( type, data, this );
            });
        },
        triggerHandler: function( type, data ) {
            if ( this[0] ) {
                return jQuery.event.trigger( type, data, this[0], true );
            }
        },

        toggle: function( fn ) {
            // Save reference to arguments for access in closure
            var args = arguments,
                guid = fn.guid || jQuery.guid++,
                i = 0,
                toggler = function( event ) {
                    // Figure out which function to execute
                    var lastToggle = ( jQuery._data( this, "lastToggle" + fn.guid ) || 0 ) % i;
                    jQuery._data( this, "lastToggle" + fn.guid, lastToggle + 1 );

                    // Make sure that clicks stop
                    event.preventDefault();

                    // and execute the function
                    return args[ lastToggle ].apply( this, arguments ) || false;
                };

            // link all the functions, so any of them can unbind this click handler
            toggler.guid = guid;
            while ( i < args.length ) {
                args[ i++ ].guid = guid;
            }

            return this.click( toggler );
        },

        hover: function( fnOver, fnOut ) {
            return this.mouseenter( fnOver ).mouseleave( fnOut || fnOver );
        }
    });

    jQuery.each( ("blur focus focusin focusout load resize scroll unload click dblclick " +
    "mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave " +
    "change select submit keydown keypress keyup error contextmenu").split(" "), function( i, name ) {

        // Handle event binding
        jQuery.fn[ name ] = function( data, fn ) {
            if ( fn == null ) {
                fn = data;
                data = null;
            }

            return arguments.length > 0 ?
                this.on( name, null, data, fn ) :
                this.trigger( name );
        };

        if ( jQuery.attrFn ) {
            jQuery.attrFn[ name ] = true;
        }

        if ( rkeyEvent.test( name ) ) {
            jQuery.event.fixHooks[ name ] = jQuery.event.keyHooks;
        }

        if ( rmouseEvent.test( name ) ) {
            jQuery.event.fixHooks[ name ] = jQuery.event.mouseHooks;
        }
    });



    /*!
     * Sizzle CSS Selector Engine
     *  Copyright 2011, The Dojo Foundation
     *  Released under the MIT, BSD, and GPL Licenses.
     *  More information: http://sizzlejs.com/
     */
    (function(){

        var chunker = /((?:\((?:\([^()]+\)|[^()]+)+\)|\[(?:\[[^\[\]]*\]|['"][^'"]*['"]|[^\[\]'"]+)+\]|\\.|[^ >+~,(\[\\]+)+|[>+~])(\s*,\s*)?((?:.|\r|\n)*)/g,
            expando = "sizcache" + (Math.random() + '').replace('.', ''),
            done = 0,
            toString = Object.prototype.toString,
            hasDuplicate = false,
            baseHasDuplicate = true,
            rBackslash = /\\/g,
            rReturn = /\r\n/g,
            rNonWord = /\W/;

// Here we check if the JavaScript engine is using some sort of
// optimization where it does not always call our comparision
// function. If that is the case, discard the hasDuplicate value.
//   Thus far that includes Google Chrome.
        [0, 0].sort(function() {
            baseHasDuplicate = false;
            return 0;
        });

        var Sizzle = function( selector, context, results, seed ) {
            results = results || [];
            context = context || document;

            var origContext = context;

            if ( context.nodeType !== 1 && context.nodeType !== 9 ) {
                return [];
            }

            if ( !selector || typeof selector !== "string" ) {
                return results;
            }

            var m, set, checkSet, extra, ret, cur, pop, i,
                prune = true,
                contextXML = Sizzle.isXML( context ),
                parts = [],
                soFar = selector;

            // Reset the position of the chunker regexp (start from head)
            do {
                chunker.exec( "" );
                m = chunker.exec( soFar );

                if ( m ) {
                    soFar = m[3];

                    parts.push( m[1] );

                    if ( m[2] ) {
                        extra = m[3];
                        break;
                    }
                }
            } while ( m );

            if ( parts.length > 1 && origPOS.exec( selector ) ) {

                if ( parts.length === 2 && Expr.relative[ parts[0] ] ) {
                    set = posProcess( parts[0] + parts[1], context, seed );

                } else {
                    set = Expr.relative[ parts[0] ] ?
                        [ context ] :
                        Sizzle( parts.shift(), context );

                    while ( parts.length ) {
                        selector = parts.shift();

                        if ( Expr.relative[ selector ] ) {
                            selector += parts.shift();
                        }

                        set = posProcess( selector, set, seed );
                    }
                }

            } else {
                // Take a shortcut and set the context if the root selector is an ID
                // (but not if it'll be faster if the inner selector is an ID)
                if ( !seed && parts.length > 1 && context.nodeType === 9 && !contextXML &&
                    Expr.match.ID.test(parts[0]) && !Expr.match.ID.test(parts[parts.length - 1]) ) {

                    ret = Sizzle.find( parts.shift(), context, contextXML );
                    context = ret.expr ?
                        Sizzle.filter( ret.expr, ret.set )[0] :
                        ret.set[0];
                }

                if ( context ) {
                    ret = seed ?
                    { expr: parts.pop(), set: makeArray(seed) } :
                        Sizzle.find( parts.pop(), parts.length === 1 && (parts[0] === "~" || parts[0] === "+") && context.parentNode ? context.parentNode : context, contextXML );

                    set = ret.expr ?
                        Sizzle.filter( ret.expr, ret.set ) :
                        ret.set;

                    if ( parts.length > 0 ) {
                        checkSet = makeArray( set );

                    } else {
                        prune = false;
                    }

                    while ( parts.length ) {
                        cur = parts.pop();
                        pop = cur;

                        if ( !Expr.relative[ cur ] ) {
                            cur = "";
                        } else {
                            pop = parts.pop();
                        }

                        if ( pop == null ) {
                            pop = context;
                        }

                        Expr.relative[ cur ]( checkSet, pop, contextXML );
                    }

                } else {
                    checkSet = parts = [];
                }
            }

            if ( !checkSet ) {
                checkSet = set;
            }

            if ( !checkSet ) {
                Sizzle.error( cur || selector );
            }

            if ( toString.call(checkSet) === "[object Array]" ) {
                if ( !prune ) {
                    results.push.apply( results, checkSet );

                } else if ( context && context.nodeType === 1 ) {
                    for ( i = 0; checkSet[i] != null; i++ ) {
                        if ( checkSet[i] && (checkSet[i] === true || checkSet[i].nodeType === 1 && Sizzle.contains(context, checkSet[i])) ) {
                            results.push( set[i] );
                        }
                    }

                } else {
                    for ( i = 0; checkSet[i] != null; i++ ) {
                        if ( checkSet[i] && checkSet[i].nodeType === 1 ) {
                            results.push( set[i] );
                        }
                    }
                }

            } else {
                makeArray( checkSet, results );
            }

            if ( extra ) {
                Sizzle( extra, origContext, results, seed );
                Sizzle.uniqueSort( results );
            }

            return results;
        };

        Sizzle.uniqueSort = function( results ) {
            if ( sortOrder ) {
                hasDuplicate = baseHasDuplicate;
                results.sort( sortOrder );

                if ( hasDuplicate ) {
                    for ( var i = 1; i < results.length; i++ ) {
                        if ( results[i] === results[ i - 1 ] ) {
                            results.splice( i--, 1 );
                        }
                    }
                }
            }

            return results;
        };

        Sizzle.matches = function( expr, set ) {
            return Sizzle( expr, null, null, set );
        };

        Sizzle.matchesSelector = function( node, expr ) {
            return Sizzle( expr, null, null, [node] ).length > 0;
        };

        Sizzle.find = function( expr, context, isXML ) {
            var set, i, len, match, type, left;

            if ( !expr ) {
                return [];
            }

            for ( i = 0, len = Expr.order.length; i < len; i++ ) {
                type = Expr.order[i];

                if ( (match = Expr.leftMatch[ type ].exec( expr )) ) {
                    left = match[1];
                    match.splice( 1, 1 );

                    if ( left.substr( left.length - 1 ) !== "\\" ) {
                        match[1] = (match[1] || "").replace( rBackslash, "" );
                        set = Expr.find[ type ]( match, context, isXML );

                        if ( set != null ) {
                            expr = expr.replace( Expr.match[ type ], "" );
                            break;
                        }
                    }
                }
            }

            if ( !set ) {
                set = typeof context.getElementsByTagName !== "undefined" ?
                    context.getElementsByTagName( "*" ) :
                    [];
            }

            return { set: set, expr: expr };
        };

        Sizzle.filter = function( expr, set, inplace, not ) {
            var match, anyFound,
                type, found, item, filter, left,
                i, pass,
                old = expr,
                result = [],
                curLoop = set,
                isXMLFilter = set && set[0] && Sizzle.isXML( set[0] );

            while ( expr && set.length ) {
                for ( type in Expr.filter ) {
                    if ( (match = Expr.leftMatch[ type ].exec( expr )) != null && match[2] ) {
                        filter = Expr.filter[ type ];
                        left = match[1];

                        anyFound = false;

                        match.splice(1,1);

                        if ( left.substr( left.length - 1 ) === "\\" ) {
                            continue;
                        }

                        if ( curLoop === result ) {
                            result = [];
                        }

                        if ( Expr.preFilter[ type ] ) {
                            match = Expr.preFilter[ type ]( match, curLoop, inplace, result, not, isXMLFilter );

                            if ( !match ) {
                                anyFound = found = true;

                            } else if ( match === true ) {
                                continue;
                            }
                        }

                        if ( match ) {
                            for ( i = 0; (item = curLoop[i]) != null; i++ ) {
                                if ( item ) {
                                    found = filter( item, match, i, curLoop );
                                    pass = not ^ found;

                                    if ( inplace && found != null ) {
                                        if ( pass ) {
                                            anyFound = true;

                                        } else {
                                            curLoop[i] = false;
                                        }

                                    } else if ( pass ) {
                                        result.push( item );
                                        anyFound = true;
                                    }
                                }
                            }
                        }

                        if ( found !== undefined ) {
                            if ( !inplace ) {
                                curLoop = result;
                            }

                            expr = expr.replace( Expr.match[ type ], "" );

                            if ( !anyFound ) {
                                return [];
                            }

                            break;
                        }
                    }
                }

                // Improper expression
                if ( expr === old ) {
                    if ( anyFound == null ) {
                        Sizzle.error( expr );

                    } else {
                        break;
                    }
                }

                old = expr;
            }

            return curLoop;
        };

        Sizzle.error = function( msg ) {
            throw new Error( "Syntax error, unrecognized expression: " + msg );
        };

        /**
         * Utility function for retreiving the text value of an array of DOM nodes
         * @param {Array|Element} elem
         */
        var getText = Sizzle.getText = function( elem ) {
            var i, node,
                nodeType = elem.nodeType,
                ret = "";

            if ( nodeType ) {
                if ( nodeType === 1 || nodeType === 9 ) {
                    // Use textContent || innerText for elements
                    if ( typeof elem.textContent === 'string' ) {
                        return elem.textContent;
                    } else if ( typeof elem.innerText === 'string' ) {
                        // Replace IE's carriage returns
                        return elem.innerText.replace( rReturn, '' );
                    } else {
                        // Traverse it's children
                        for ( elem = elem.firstChild; elem; elem = elem.nextSibling) {
                            ret += getText( elem );
                        }
                    }
                } else if ( nodeType === 3 || nodeType === 4 ) {
                    return elem.nodeValue;
                }
            } else {

                // If no nodeType, this is expected to be an array
                for ( i = 0; (node = elem[i]); i++ ) {
                    // Do not traverse comment nodes
                    if ( node.nodeType !== 8 ) {
                        ret += getText( node );
                    }
                }
            }
            return ret;
        };

        var Expr = Sizzle.selectors = {
            order: [ "ID", "NAME", "TAG" ],

            match: {
                ID: /#((?:[\w\u00c0-\uFFFF\-]|\\.)+)/,
                CLASS: /\.((?:[\w\u00c0-\uFFFF\-]|\\.)+)/,
                NAME: /\[name=['"]*((?:[\w\u00c0-\uFFFF\-]|\\.)+)['"]*\]/,
                ATTR: /\[\s*((?:[\w\u00c0-\uFFFF\-]|\\.)+)\s*(?:(\S?=)\s*(?:(['"])(.*?)\3|(#?(?:[\w\u00c0-\uFFFF\-]|\\.)*)|)|)\s*\]/,
                TAG: /^((?:[\w\u00c0-\uFFFF\*\-]|\\.)+)/,
                CHILD: /:(only|nth|last|first)-child(?:\(\s*(even|odd|(?:[+\-]?\d+|(?:[+\-]?\d*)?n\s*(?:[+\-]\s*\d+)?))\s*\))?/,
                POS: /:(nth|eq|gt|lt|first|last|even|odd)(?:\((\d*)\))?(?=[^\-]|$)/,
                PSEUDO: /:((?:[\w\u00c0-\uFFFF\-]|\\.)+)(?:\((['"]?)((?:\([^\)]+\)|[^\(\)]*)+)\2\))?/
            },

            leftMatch: {},

            attrMap: {
                "class": "className",
                "for": "htmlFor"
            },

            attrHandle: {
                href: function( elem ) {
                    return elem.getAttribute( "href" );
                },
                type: function( elem ) {
                    return elem.getAttribute( "type" );
                }
            },

            relative: {
                "+": function(checkSet, part){
                    var isPartStr = typeof part === "string",
                        isTag = isPartStr && !rNonWord.test( part ),
                        isPartStrNotTag = isPartStr && !isTag;

                    if ( isTag ) {
                        part = part.toLowerCase();
                    }

                    for ( var i = 0, l = checkSet.length, elem; i < l; i++ ) {
                        if ( (elem = checkSet[i]) ) {
                            while ( (elem = elem.previousSibling) && elem.nodeType !== 1 ) {}

                            checkSet[i] = isPartStrNotTag || elem && elem.nodeName.toLowerCase() === part ?
                            elem || false :
                            elem === part;
                        }
                    }

                    if ( isPartStrNotTag ) {
                        Sizzle.filter( part, checkSet, true );
                    }
                },

                ">": function( checkSet, part ) {
                    var elem,
                        isPartStr = typeof part === "string",
                        i = 0,
                        l = checkSet.length;

                    if ( isPartStr && !rNonWord.test( part ) ) {
                        part = part.toLowerCase();

                        for ( ; i < l; i++ ) {
                            elem = checkSet[i];

                            if ( elem ) {
                                var parent = elem.parentNode;
                                checkSet[i] = parent.nodeName.toLowerCase() === part ? parent : false;
                            }
                        }

                    } else {
                        for ( ; i < l; i++ ) {
                            elem = checkSet[i];

                            if ( elem ) {
                                checkSet[i] = isPartStr ?
                                    elem.parentNode :
                                elem.parentNode === part;
                            }
                        }

                        if ( isPartStr ) {
                            Sizzle.filter( part, checkSet, true );
                        }
                    }
                },

                "": function(checkSet, part, isXML){
                    var nodeCheck,
                        doneName = done++,
                        checkFn = dirCheck;

                    if ( typeof part === "string" && !rNonWord.test( part ) ) {
                        part = part.toLowerCase();
                        nodeCheck = part;
                        checkFn = dirNodeCheck;
                    }

                    checkFn( "parentNode", part, doneName, checkSet, nodeCheck, isXML );
                },

                "~": function( checkSet, part, isXML ) {
                    var nodeCheck,
                        doneName = done++,
                        checkFn = dirCheck;

                    if ( typeof part === "string" && !rNonWord.test( part ) ) {
                        part = part.toLowerCase();
                        nodeCheck = part;
                        checkFn = dirNodeCheck;
                    }

                    checkFn( "previousSibling", part, doneName, checkSet, nodeCheck, isXML );
                }
            },

            find: {
                ID: function( match, context, isXML ) {
                    if ( typeof context.getElementById !== "undefined" && !isXML ) {
                        var m = context.getElementById(match[1]);
                        // Check parentNode to catch when Blackberry 4.6 returns
                        // nodes that are no longer in the document #6963
                        return m && m.parentNode ? [m] : [];
                    }
                },

                NAME: function( match, context ) {
                    if ( typeof context.getElementsByName !== "undefined" ) {
                        var ret = [],
                            results = context.getElementsByName( match[1] );

                        for ( var i = 0, l = results.length; i < l; i++ ) {
                            if ( results[i].getAttribute("name") === match[1] ) {
                                ret.push( results[i] );
                            }
                        }

                        return ret.length === 0 ? null : ret;
                    }
                },

                TAG: function( match, context ) {
                    if ( typeof context.getElementsByTagName !== "undefined" ) {
                        return context.getElementsByTagName( match[1] );
                    }
                }
            },
            preFilter: {
                CLASS: function( match, curLoop, inplace, result, not, isXML ) {
                    match = " " + match[1].replace( rBackslash, "" ) + " ";

                    if ( isXML ) {
                        return match;
                    }

                    for ( var i = 0, elem; (elem = curLoop[i]) != null; i++ ) {
                        if ( elem ) {
                            if ( not ^ (elem.className && (" " + elem.className + " ").replace(/[\t\n\r]/g, " ").indexOf(match) >= 0) ) {
                                if ( !inplace ) {
                                    result.push( elem );
                                }

                            } else if ( inplace ) {
                                curLoop[i] = false;
                            }
                        }
                    }

                    return false;
                },

                ID: function( match ) {
                    return match[1].replace( rBackslash, "" );
                },

                TAG: function( match, curLoop ) {
                    return match[1].replace( rBackslash, "" ).toLowerCase();
                },

                CHILD: function( match ) {
                    if ( match[1] === "nth" ) {
                        if ( !match[2] ) {
                            Sizzle.error( match[0] );
                        }

                        match[2] = match[2].replace(/^\+|\s*/g, '');

                        // parse equations like 'even', 'odd', '5', '2n', '3n+2', '4n-1', '-n+6'
                        var test = /(-?)(\d*)(?:n([+\-]?\d*))?/.exec(
                            match[2] === "even" && "2n" || match[2] === "odd" && "2n+1" ||
                            !/\D/.test( match[2] ) && "0n+" + match[2] || match[2]);

                        // calculate the numbers (first)n+(last) including if they are negative
                        match[2] = (test[1] + (test[2] || 1)) - 0;
                        match[3] = test[3] - 0;
                    }
                    else if ( match[2] ) {
                        Sizzle.error( match[0] );
                    }

                    // TODO: Move to normal caching system
                    match[0] = done++;

                    return match;
                },

                ATTR: function( match, curLoop, inplace, result, not, isXML ) {
                    var name = match[1] = match[1].replace( rBackslash, "" );

                    if ( !isXML && Expr.attrMap[name] ) {
                        match[1] = Expr.attrMap[name];
                    }

                    // Handle if an un-quoted value was used
                    match[4] = ( match[4] || match[5] || "" ).replace( rBackslash, "" );

                    if ( match[2] === "~=" ) {
                        match[4] = " " + match[4] + " ";
                    }

                    return match;
                },

                PSEUDO: function( match, curLoop, inplace, result, not ) {
                    if ( match[1] === "not" ) {
                        // If we're dealing with a complex expression, or a simple one
                        if ( ( chunker.exec(match[3]) || "" ).length > 1 || /^\w/.test(match[3]) ) {
                            match[3] = Sizzle(match[3], null, null, curLoop);

                        } else {
                            var ret = Sizzle.filter(match[3], curLoop, inplace, true ^ not);

                            if ( !inplace ) {
                                result.push.apply( result, ret );
                            }

                            return false;
                        }

                    } else if ( Expr.match.POS.test( match[0] ) || Expr.match.CHILD.test( match[0] ) ) {
                        return true;
                    }

                    return match;
                },

                POS: function( match ) {
                    match.unshift( true );

                    return match;
                }
            },

            filters: {
                enabled: function( elem ) {
                    return elem.disabled === false && elem.type !== "hidden";
                },

                disabled: function( elem ) {
                    return elem.disabled === true;
                },

                checked: function( elem ) {
                    return elem.checked === true;
                },

                selected: function( elem ) {
                    // Accessing this property makes selected-by-default
                    // options in Safari work properly
                    if ( elem.parentNode ) {
                        elem.parentNode.selectedIndex;
                    }

                    return elem.selected === true;
                },

                parent: function( elem ) {
                    return !!elem.firstChild;
                },

                empty: function( elem ) {
                    return !elem.firstChild;
                },

                has: function( elem, i, match ) {
                    return !!Sizzle( match[3], elem ).length;
                },

                header: function( elem ) {
                    return (/h\d/i).test( elem.nodeName );
                },

                text: function( elem ) {
                    var attr = elem.getAttribute( "type" ), type = elem.type;
                    // IE6 and 7 will map elem.type to 'text' for new HTML5 types (search, etc)
                    // use getAttribute instead to test this case
                    return elem.nodeName.toLowerCase() === "input" && "text" === type && ( attr === type || attr === null );
                },

                radio: function( elem ) {
                    return elem.nodeName.toLowerCase() === "input" && "radio" === elem.type;
                },

                checkbox: function( elem ) {
                    return elem.nodeName.toLowerCase() === "input" && "checkbox" === elem.type;
                },

                file: function( elem ) {
                    return elem.nodeName.toLowerCase() === "input" && "file" === elem.type;
                },

                password: function( elem ) {
                    return elem.nodeName.toLowerCase() === "input" && "password" === elem.type;
                },

                submit: function( elem ) {
                    var name = elem.nodeName.toLowerCase();
                    return (name === "input" || name === "button") && "submit" === elem.type;
                },

                image: function( elem ) {
                    return elem.nodeName.toLowerCase() === "input" && "image" === elem.type;
                },

                reset: function( elem ) {
                    var name = elem.nodeName.toLowerCase();
                    return (name === "input" || name === "button") && "reset" === elem.type;
                },

                button: function( elem ) {
                    var name = elem.nodeName.toLowerCase();
                    return name === "input" && "button" === elem.type || name === "button";
                },

                input: function( elem ) {
                    return (/input|select|textarea|button/i).test( elem.nodeName );
                },

                focus: function( elem ) {
                    return elem === elem.ownerDocument.activeElement;
                }
            },
            setFilters: {
                first: function( elem, i ) {
                    return i === 0;
                },

                last: function( elem, i, match, array ) {
                    return i === array.length - 1;
                },

                even: function( elem, i ) {
                    return i % 2 === 0;
                },

                odd: function( elem, i ) {
                    return i % 2 === 1;
                },

                lt: function( elem, i, match ) {
                    return i < match[3] - 0;
                },

                gt: function( elem, i, match ) {
                    return i > match[3] - 0;
                },

                nth: function( elem, i, match ) {
                    return match[3] - 0 === i;
                },

                eq: function( elem, i, match ) {
                    return match[3] - 0 === i;
                }
            },
            filter: {
                PSEUDO: function( elem, match, i, array ) {
                    var name = match[1],
                        filter = Expr.filters[ name ];

                    if ( filter ) {
                        return filter( elem, i, match, array );

                    } else if ( name === "contains" ) {
                        return (elem.textContent || elem.innerText || getText([ elem ]) || "").indexOf(match[3]) >= 0;

                    } else if ( name === "not" ) {
                        var not = match[3];

                        for ( var j = 0, l = not.length; j < l; j++ ) {
                            if ( not[j] === elem ) {
                                return false;
                            }
                        }

                        return true;

                    } else {
                        Sizzle.error( name );
                    }
                },

                CHILD: function( elem, match ) {
                    var first, last,
                        doneName, parent, cache,
                        count, diff,
                        type = match[1],
                        node = elem;

                    switch ( type ) {
                        case "only":
                        case "first":
                            while ( (node = node.previousSibling) )	 {
                                if ( node.nodeType === 1 ) {
                                    return false;
                                }
                            }

                            if ( type === "first" ) {
                                return true;
                            }

                            node = elem;

                        case "last":
                            while ( (node = node.nextSibling) )	 {
                                if ( node.nodeType === 1 ) {
                                    return false;
                                }
                            }

                            return true;

                        case "nth":
                            first = match[2];
                            last = match[3];

                            if ( first === 1 && last === 0 ) {
                                return true;
                            }

                            doneName = match[0];
                            parent = elem.parentNode;

                            if ( parent && (parent[ expando ] !== doneName || !elem.nodeIndex) ) {
                                count = 0;

                                for ( node = parent.firstChild; node; node = node.nextSibling ) {
                                    if ( node.nodeType === 1 ) {
                                        node.nodeIndex = ++count;
                                    }
                                }

                                parent[ expando ] = doneName;
                            }

                            diff = elem.nodeIndex - last;

                            if ( first === 0 ) {
                                return diff === 0;

                            } else {
                                return ( diff % first === 0 && diff / first >= 0 );
                            }
                    }
                },

                ID: function( elem, match ) {
                    return elem.nodeType === 1 && elem.getAttribute("id") === match;
                },

                TAG: function( elem, match ) {
                    return (match === "*" && elem.nodeType === 1) || !!elem.nodeName && elem.nodeName.toLowerCase() === match;
                },

                CLASS: function( elem, match ) {
                    return (" " + (elem.className || elem.getAttribute("class")) + " ")
                            .indexOf( match ) > -1;
                },

                ATTR: function( elem, match ) {
                    var name = match[1],
                        result = Sizzle.attr ?
                            Sizzle.attr( elem, name ) :
                            Expr.attrHandle[ name ] ?
                                Expr.attrHandle[ name ]( elem ) :
                                elem[ name ] != null ?
                                    elem[ name ] :
                                    elem.getAttribute( name ),
                        value = result + "",
                        type = match[2],
                        check = match[4];

                    return result == null ?
                    type === "!=" :
                        !type && Sizzle.attr ?
                        result != null :
                            type === "=" ?
                            value === check :
                                type === "*=" ?
                                value.indexOf(check) >= 0 :
                                    type === "~=" ?
                                    (" " + value + " ").indexOf(check) >= 0 :
                                        !check ?
                                        value && result !== false :
                                            type === "!=" ?
                                            value !== check :
                                                type === "^=" ?
                                                value.indexOf(check) === 0 :
                                                    type === "$=" ?
                                                    value.substr(value.length - check.length) === check :
                                                        type === "|=" ?
                                                        value === check || value.substr(0, check.length + 1) === check + "-" :
                                                            false;
                },

                POS: function( elem, match, i, array ) {
                    var name = match[2],
                        filter = Expr.setFilters[ name ];

                    if ( filter ) {
                        return filter( elem, i, match, array );
                    }
                }
            }
        };

        var origPOS = Expr.match.POS,
            fescape = function(all, num){
                return "\\" + (num - 0 + 1);
            };

        for ( var type in Expr.match ) {
            Expr.match[ type ] = new RegExp( Expr.match[ type ].source + (/(?![^\[]*\])(?![^\(]*\))/.source) );
            Expr.leftMatch[ type ] = new RegExp( /(^(?:.|\r|\n)*?)/.source + Expr.match[ type ].source.replace(/\\(\d+)/g, fescape) );
        }

        var makeArray = function( array, results ) {
            array = Array.prototype.slice.call( array, 0 );

            if ( results ) {
                results.push.apply( results, array );
                return results;
            }

            return array;
        };

// Perform a simple check to determine if the browser is capable of
// converting a NodeList to an array using builtin methods.
// Also verifies that the returned array holds DOM nodes
// (which is not the case in the Blackberry browser)
        try {
            Array.prototype.slice.call( document.documentElement.childNodes, 0 )[0].nodeType;

// Provide a fallback method if it does not work
        } catch( e ) {
            makeArray = function( array, results ) {
                var i = 0,
                    ret = results || [];

                if ( toString.call(array) === "[object Array]" ) {
                    Array.prototype.push.apply( ret, array );

                } else {
                    if ( typeof array.length === "number" ) {
                        for ( var l = array.length; i < l; i++ ) {
                            ret.push( array[i] );
                        }

                    } else {
                        for ( ; array[i]; i++ ) {
                            ret.push( array[i] );
                        }
                    }
                }

                return ret;
            };
        }

        var sortOrder, siblingCheck;

        if ( document.documentElement.compareDocumentPosition ) {
            sortOrder = function( a, b ) {
                if ( a === b ) {
                    hasDuplicate = true;
                    return 0;
                }

                if ( !a.compareDocumentPosition || !b.compareDocumentPosition ) {
                    return a.compareDocumentPosition ? -1 : 1;
                }

                return a.compareDocumentPosition(b) & 4 ? -1 : 1;
            };

        } else {
            sortOrder = function( a, b ) {
                // The nodes are identical, we can exit early
                if ( a === b ) {
                    hasDuplicate = true;
                    return 0;

                    // Fallback to using sourceIndex (in IE) if it's available on both nodes
                } else if ( a.sourceIndex && b.sourceIndex ) {
                    return a.sourceIndex - b.sourceIndex;
                }

                var al, bl,
                    ap = [],
                    bp = [],
                    aup = a.parentNode,
                    bup = b.parentNode,
                    cur = aup;

                // If the nodes are siblings (or identical) we can do a quick check
                if ( aup === bup ) {
                    return siblingCheck( a, b );

                    // If no parents were found then the nodes are disconnected
                } else if ( !aup ) {
                    return -1;

                } else if ( !bup ) {
                    return 1;
                }

                // Otherwise they're somewhere else in the tree so we need
                // to build up a full list of the parentNodes for comparison
                while ( cur ) {
                    ap.unshift( cur );
                    cur = cur.parentNode;
                }

                cur = bup;

                while ( cur ) {
                    bp.unshift( cur );
                    cur = cur.parentNode;
                }

                al = ap.length;
                bl = bp.length;

                // Start walking down the tree looking for a discrepancy
                for ( var i = 0; i < al && i < bl; i++ ) {
                    if ( ap[i] !== bp[i] ) {
                        return siblingCheck( ap[i], bp[i] );
                    }
                }

                // We ended someplace up the tree so do a sibling check
                return i === al ?
                    siblingCheck( a, bp[i], -1 ) :
                    siblingCheck( ap[i], b, 1 );
            };

            siblingCheck = function( a, b, ret ) {
                if ( a === b ) {
                    return ret;
                }

                var cur = a.nextSibling;

                while ( cur ) {
                    if ( cur === b ) {
                        return -1;
                    }

                    cur = cur.nextSibling;
                }

                return 1;
            };
        }

// Check to see if the browser returns elements by name when
// querying by getElementById (and provide a workaround)
        (function(){
            // We're going to inject a fake input element with a specified name
            var form = document.createElement("div"),
                id = "script" + (new Date()).getTime(),
                root = document.documentElement;

            form.innerHTML = "<a name='" + id + "'/>";

            // Inject it into the root element, check its status, and remove it quickly
            root.insertBefore( form, root.firstChild );

            // The workaround has to do additional checks after a getElementById
            // Which slows things down for other browsers (hence the branching)
            if ( document.getElementById( id ) ) {
                Expr.find.ID = function( match, context, isXML ) {
                    if ( typeof context.getElementById !== "undefined" && !isXML ) {
                        var m = context.getElementById(match[1]);

                        return m ?
                            m.id === match[1] || typeof m.getAttributeNode !== "undefined" && m.getAttributeNode("id").nodeValue === match[1] ?
                                [m] :
                                undefined :
                            [];
                    }
                };

                Expr.filter.ID = function( elem, match ) {
                    var node = typeof elem.getAttributeNode !== "undefined" && elem.getAttributeNode("id");

                    return elem.nodeType === 1 && node && node.nodeValue === match;
                };
            }

            root.removeChild( form );

            // release memory in IE
            root = form = null;
        })();

        (function(){
            // Check to see if the browser returns only elements
            // when doing getElementsByTagName("*")

            // Create a fake element
            var div = document.createElement("div");
            div.appendChild( document.createComment("") );

            // Make sure no comments are found
            if ( div.getElementsByTagName("*").length > 0 ) {
                Expr.find.TAG = function( match, context ) {
                    var results = context.getElementsByTagName( match[1] );

                    // Filter out possible comments
                    if ( match[1] === "*" ) {
                        var tmp = [];

                        for ( var i = 0; results[i]; i++ ) {
                            if ( results[i].nodeType === 1 ) {
                                tmp.push( results[i] );
                            }
                        }

                        results = tmp;
                    }

                    return results;
                };
            }

            // Check to see if an attribute returns normalized href attributes
            div.innerHTML = "<a href='#'></a>";

            if ( div.firstChild && typeof div.firstChild.getAttribute !== "undefined" &&
                div.firstChild.getAttribute("href") !== "#" ) {

                Expr.attrHandle.href = function( elem ) {
                    return elem.getAttribute( "href", 2 );
                };
            }

            // release memory in IE
            div = null;
        })();

        if ( document.querySelectorAll ) {
            (function(){
                var oldSizzle = Sizzle,
                    div = document.createElement("div"),
                    id = "__sizzle__";

                div.innerHTML = "<p class='TEST'></p>";

                // Safari can't handle uppercase or unicode characters when
                // in quirks mode.
                if ( div.querySelectorAll && div.querySelectorAll(".TEST").length === 0 ) {
                    return;
                }

                Sizzle = function( query, context, extra, seed ) {
                    context = context || document;

                    // Only use querySelectorAll on non-XML documents
                    // (ID selectors don't work in non-HTML documents)
                    if ( !seed && !Sizzle.isXML(context) ) {
                        // See if we find a selector to speed up
                        var match = /^(\w+$)|^\.([\w\-]+$)|^#([\w\-]+$)/.exec( query );

                        if ( match && (context.nodeType === 1 || context.nodeType === 9) ) {
                            // Speed-up: Sizzle("TAG")
                            if ( match[1] ) {
                                return makeArray( context.getElementsByTagName( query ), extra );

                                // Speed-up: Sizzle(".CLASS")
                            } else if ( match[2] && Expr.find.CLASS && context.getElementsByClassName ) {
                                return makeArray( context.getElementsByClassName( match[2] ), extra );
                            }
                        }

                        if ( context.nodeType === 9 ) {
                            // Speed-up: Sizzle("body")
                            // The body element only exists once, optimize finding it
                            if ( query === "body" && context.body ) {
                                return makeArray( [ context.body ], extra );

                                // Speed-up: Sizzle("#ID")
                            } else if ( match && match[3] ) {
                                var elem = context.getElementById( match[3] );

                                // Check parentNode to catch when Blackberry 4.6 returns
                                // nodes that are no longer in the document #6963
                                if ( elem && elem.parentNode ) {
                                    // Handle the case where IE and Opera return items
                                    // by name instead of ID
                                    if ( elem.id === match[3] ) {
                                        return makeArray( [ elem ], extra );
                                    }

                                } else {
                                    return makeArray( [], extra );
                                }
                            }

                            try {
                                return makeArray( context.querySelectorAll(query), extra );
                            } catch(qsaError) {}

                            // qSA works strangely on Element-rooted queries
                            // We can work around this by specifying an extra ID on the root
                            // and working up from there (Thanks to Andrew Dupont for the technique)
                            // IE 8 doesn't work on object elements
                        } else if ( context.nodeType === 1 && context.nodeName.toLowerCase() !== "object" ) {
                            var oldContext = context,
                                old = context.getAttribute( "id" ),
                                nid = old || id,
                                hasParent = context.parentNode,
                                relativeHierarchySelector = /^\s*[+~]/.test( query );

                            if ( !old ) {
                                context.setAttribute( "id", nid );
                            } else {
                                nid = nid.replace( /'/g, "\\$&" );
                            }
                            if ( relativeHierarchySelector && hasParent ) {
                                context = context.parentNode;
                            }

                            try {
                                if ( !relativeHierarchySelector || hasParent ) {
                                    return makeArray( context.querySelectorAll( "[id='" + nid + "'] " + query ), extra );
                                }

                            } catch(pseudoError) {
                            } finally {
                                if ( !old ) {
                                    oldContext.removeAttribute( "id" );
                                }
                            }
                        }
                    }

                    return oldSizzle(query, context, extra, seed);
                };

                for ( var prop in oldSizzle ) {
                    Sizzle[ prop ] = oldSizzle[ prop ];
                }

                // release memory in IE
                div = null;
            })();
        }

        (function(){
            var html = document.documentElement,
                matches = html.matchesSelector || html.mozMatchesSelector || html.webkitMatchesSelector || html.msMatchesSelector;

            if ( matches ) {
                // Check to see if it's possible to do matchesSelector
                // on a disconnected node (IE 9 fails this)
                var disconnectedMatch = !matches.call( document.createElement( "div" ), "div" ),
                    pseudoWorks = false;

                try {
                    // This should fail with an exception
                    // Gecko does not error, returns false instead
                    matches.call( document.documentElement, "[test!='']:sizzle" );

                } catch( pseudoError ) {
                    pseudoWorks = true;
                }

                Sizzle.matchesSelector = function( node, expr ) {
                    // Make sure that attribute selectors are quoted
                    expr = expr.replace(/\=\s*([^'"\]]*)\s*\]/g, "='$1']");

                    if ( !Sizzle.isXML( node ) ) {
                        try {
                            if ( pseudoWorks || !Expr.match.PSEUDO.test( expr ) && !/!=/.test( expr ) ) {
                                var ret = matches.call( node, expr );

                                // IE 9's matchesSelector returns false on disconnected nodes
                                if ( ret || !disconnectedMatch ||
                                    // As well, disconnected nodes are said to be in a document
                                    // fragment in IE 9, so check for that
                                    node.document && node.document.nodeType !== 11 ) {
                                    return ret;
                                }
                            }
                        } catch(e) {}
                    }

                    return Sizzle(expr, null, null, [node]).length > 0;
                };
            }
        })();

        (function(){
            var div = document.createElement("div");

            div.innerHTML = "<div class='test e'></div><div class='test'></div>";

            // Opera can't find a second classname (in 9.6)
            // Also, make sure that getElementsByClassName actually exists
            if ( !div.getElementsByClassName || div.getElementsByClassName("e").length === 0 ) {
                return;
            }

            // Safari caches class attributes, doesn't catch changes (in 3.2)
            div.lastChild.className = "e";

            if ( div.getElementsByClassName("e").length === 1 ) {
                return;
            }

            Expr.order.splice(1, 0, "CLASS");
            Expr.find.CLASS = function( match, context, isXML ) {
                if ( typeof context.getElementsByClassName !== "undefined" && !isXML ) {
                    return context.getElementsByClassName(match[1]);
                }
            };

            // release memory in IE
            div = null;
        })();

        function dirNodeCheck( dir, cur, doneName, checkSet, nodeCheck, isXML ) {
            for ( var i = 0, l = checkSet.length; i < l; i++ ) {
                var elem = checkSet[i];

                if ( elem ) {
                    var match = false;

                    elem = elem[dir];

                    while ( elem ) {
                        if ( elem[ expando ] === doneName ) {
                            match = checkSet[elem.sizset];
                            break;
                        }

                        if ( elem.nodeType === 1 && !isXML ){
                            elem[ expando ] = doneName;
                            elem.sizset = i;
                        }

                        if ( elem.nodeName.toLowerCase() === cur ) {
                            match = elem;
                            break;
                        }

                        elem = elem[dir];
                    }

                    checkSet[i] = match;
                }
            }
        }

        function dirCheck( dir, cur, doneName, checkSet, nodeCheck, isXML ) {
            for ( var i = 0, l = checkSet.length; i < l; i++ ) {
                var elem = checkSet[i];

                if ( elem ) {
                    var match = false;

                    elem = elem[dir];

                    while ( elem ) {
                        if ( elem[ expando ] === doneName ) {
                            match = checkSet[elem.sizset];
                            break;
                        }

                        if ( elem.nodeType === 1 ) {
                            if ( !isXML ) {
                                elem[ expando ] = doneName;
                                elem.sizset = i;
                            }

                            if ( typeof cur !== "string" ) {
                                if ( elem === cur ) {
                                    match = true;
                                    break;
                                }

                            } else if ( Sizzle.filter( cur, [elem] ).length > 0 ) {
                                match = elem;
                                break;
                            }
                        }

                        elem = elem[dir];
                    }

                    checkSet[i] = match;
                }
            }
        }

        if ( document.documentElement.contains ) {
            Sizzle.contains = function( a, b ) {
                return a !== b && (a.contains ? a.contains(b) : true);
            };

        } else if ( document.documentElement.compareDocumentPosition ) {
            Sizzle.contains = function( a, b ) {
                return !!(a.compareDocumentPosition(b) & 16);
            };

        } else {
            Sizzle.contains = function() {
                return false;
            };
        }

        Sizzle.isXML = function( elem ) {
            // documentElement is verified for cases where it doesn't yet exist
            // (such as loading iframes in IE - #4833)
            var documentElement = (elem ? elem.ownerDocument || elem : 0).documentElement;

            return documentElement ? documentElement.nodeName !== "HTML" : false;
        };

        var posProcess = function( selector, context, seed ) {
            var match,
                tmpSet = [],
                later = "",
                root = context.nodeType ? [context] : context;

            // Position selectors must be done after the filter
            // And so must :not(positional) so we move all PSEUDOs to the end
            while ( (match = Expr.match.PSEUDO.exec( selector )) ) {
                later += match[0];
                selector = selector.replace( Expr.match.PSEUDO, "" );
            }

            selector = Expr.relative[selector] ? selector + "*" : selector;

            for ( var i = 0, l = root.length; i < l; i++ ) {
                Sizzle( selector, root[i], tmpSet, seed );
            }

            return Sizzle.filter( later, tmpSet );
        };

// EXPOSE
// Override sizzle attribute retrieval
        Sizzle.attr = jQuery.attr;
        Sizzle.selectors.attrMap = {};
        jQuery.find = Sizzle;
        jQuery.expr = Sizzle.selectors;
        jQuery.expr[":"] = jQuery.expr.filters;
        jQuery.unique = Sizzle.uniqueSort;
        jQuery.text = Sizzle.getText;
        jQuery.isXMLDoc = Sizzle.isXML;
        jQuery.contains = Sizzle.contains;


    })();


    var runtil = /Until$/,
        rparentsprev = /^(?:parents|prevUntil|prevAll)/,
    // Note: This RegExp should be improved, or likely pulled from Sizzle
        rmultiselector = /,/,
        isSimple = /^.[^:#\[\.,]*$/,
        slice = Array.prototype.slice,
        POS = jQuery.expr.match.POS,
    // methods guaranteed to produce a unique set when starting from a unique set
        guaranteedUnique = {
            children: true,
            contents: true,
            next: true,
            prev: true
        };

    jQuery.fn.extend({
        find: function( selector ) {
            var self = this,
                i, l;

            if ( typeof selector !== "string" ) {
                return jQuery( selector ).filter(function() {
                    for ( i = 0, l = self.length; i < l; i++ ) {
                        if ( jQuery.contains( self[ i ], this ) ) {
                            return true;
                        }
                    }
                });
            }

            var ret = this.pushStack( "", "find", selector ),
                length, n, r;

            for ( i = 0, l = this.length; i < l; i++ ) {
                length = ret.length;
                jQuery.find( selector, this[i], ret );

                if ( i > 0 ) {
                    // Make sure that the results are unique
                    for ( n = length; n < ret.length; n++ ) {
                        for ( r = 0; r < length; r++ ) {
                            if ( ret[r] === ret[n] ) {
                                ret.splice(n--, 1);
                                break;
                            }
                        }
                    }
                }
            }

            return ret;
        },

        has: function( target ) {
            var targets = jQuery( target );
            return this.filter(function() {
                for ( var i = 0, l = targets.length; i < l; i++ ) {
                    if ( jQuery.contains( this, targets[i] ) ) {
                        return true;
                    }
                }
            });
        },

        not: function( selector ) {
            return this.pushStack( winnow(this, selector, false), "not", selector);
        },

        filter: function( selector ) {
            return this.pushStack( winnow(this, selector, true), "filter", selector );
        },

        is: function( selector ) {
            return !!selector && (
                    typeof selector === "string" ?
                        // If this is a positional selector, check membership in the returned set
                        // so $("p:first").is("p:last") won't return true for a doc with two "p".
                        POS.test( selector ) ?
                        jQuery( selector, this.context ).index( this[0] ) >= 0 :
                        jQuery.filter( selector, this ).length > 0 :
                    this.filter( selector ).length > 0 );
        },

        closest: function( selectors, context ) {
            var ret = [], i, l, cur = this[0];

            // Array (deprecated as of jQuery 1.7)
            if ( jQuery.isArray( selectors ) ) {
                var level = 1;

                while ( cur && cur.ownerDocument && cur !== context ) {
                    for ( i = 0; i < selectors.length; i++ ) {

                        if ( jQuery( cur ).is( selectors[ i ] ) ) {
                            ret.push({ selector: selectors[ i ], elem: cur, level: level });
                        }
                    }

                    cur = cur.parentNode;
                    level++;
                }

                return ret;
            }

            // String
            var pos = POS.test( selectors ) || typeof selectors !== "string" ?
                jQuery( selectors, context || this.context ) :
                0;

            for ( i = 0, l = this.length; i < l; i++ ) {
                cur = this[i];

                while ( cur ) {
                    if ( pos ? pos.index(cur) > -1 : jQuery.find.matchesSelector(cur, selectors) ) {
                        ret.push( cur );
                        break;

                    } else {
                        cur = cur.parentNode;
                        if ( !cur || !cur.ownerDocument || cur === context || cur.nodeType === 11 ) {
                            break;
                        }
                    }
                }
            }

            ret = ret.length > 1 ? jQuery.unique( ret ) : ret;

            return this.pushStack( ret, "closest", selectors );
        },

        // Determine the position of an element within
        // the matched set of elements
        index: function( elem ) {

            // No argument, return index in parent
            if ( !elem ) {
                return ( this[0] && this[0].parentNode ) ? this.prevAll().length : -1;
            }

            // index in selector
            if ( typeof elem === "string" ) {
                return jQuery.inArray( this[0], jQuery( elem ) );
            }

            // Locate the position of the desired element
            return jQuery.inArray(
                // If it receives a jQuery object, the first element is used
                elem.jquery ? elem[0] : elem, this );
        },

        add: function( selector, context ) {
            var set = typeof selector === "string" ?
                    jQuery( selector, context ) :
                    jQuery.makeArray( selector && selector.nodeType ? [ selector ] : selector ),
                all = jQuery.merge( this.get(), set );

            return this.pushStack( isDisconnected( set[0] ) || isDisconnected( all[0] ) ?
                all :
                jQuery.unique( all ) );
        },

        andSelf: function() {
            return this.add( this.prevObject );
        }
    });

// A painfully simple check to see if an element is disconnected
// from a document (should be improved, where feasible).
    function isDisconnected( node ) {
        return !node || !node.parentNode || node.parentNode.nodeType === 11;
    }

    jQuery.each({
        parent: function( elem ) {
            var parent = elem.parentNode;
            return parent && parent.nodeType !== 11 ? parent : null;
        },
        parents: function( elem ) {
            return jQuery.dir( elem, "parentNode" );
        },
        parentsUntil: function( elem, i, until ) {
            return jQuery.dir( elem, "parentNode", until );
        },
        next: function( elem ) {
            return jQuery.nth( elem, 2, "nextSibling" );
        },
        prev: function( elem ) {
            return jQuery.nth( elem, 2, "previousSibling" );
        },
        nextAll: function( elem ) {
            return jQuery.dir( elem, "nextSibling" );
        },
        prevAll: function( elem ) {
            return jQuery.dir( elem, "previousSibling" );
        },
        nextUntil: function( elem, i, until ) {
            return jQuery.dir( elem, "nextSibling", until );
        },
        prevUntil: function( elem, i, until ) {
            return jQuery.dir( elem, "previousSibling", until );
        },
        siblings: function( elem ) {
            return jQuery.sibling( elem.parentNode.firstChild, elem );
        },
        children: function( elem ) {
            return jQuery.sibling( elem.firstChild );
        },
        contents: function( elem ) {
            return jQuery.nodeName( elem, "iframe" ) ?
            elem.contentDocument || elem.contentWindow.document :
                jQuery.makeArray( elem.childNodes );
        }
    }, function( name, fn ) {
        jQuery.fn[ name ] = function( until, selector ) {
            var ret = jQuery.map( this, fn, until );

            if ( !runtil.test( name ) ) {
                selector = until;
            }

            if ( selector && typeof selector === "string" ) {
                ret = jQuery.filter( selector, ret );
            }

            ret = this.length > 1 && !guaranteedUnique[ name ] ? jQuery.unique( ret ) : ret;

            if ( (this.length > 1 || rmultiselector.test( selector )) && rparentsprev.test( name ) ) {
                ret = ret.reverse();
            }

            return this.pushStack( ret, name, slice.call( arguments ).join(",") );
        };
    });

    jQuery.extend({
        filter: function( expr, elems, not ) {
            if ( not ) {
                expr = ":not(" + expr + ")";
            }

            return elems.length === 1 ?
                jQuery.find.matchesSelector(elems[0], expr) ? [ elems[0] ] : [] :
                jQuery.find.matches(expr, elems);
        },

        dir: function( elem, dir, until ) {
            var matched = [],
                cur = elem[ dir ];

            while ( cur && cur.nodeType !== 9 && (until === undefined || cur.nodeType !== 1 || !jQuery( cur ).is( until )) ) {
                if ( cur.nodeType === 1 ) {
                    matched.push( cur );
                }
                cur = cur[dir];
            }
            return matched;
        },

        nth: function( cur, result, dir, elem ) {
            result = result || 1;
            var num = 0;

            for ( ; cur; cur = cur[dir] ) {
                if ( cur.nodeType === 1 && ++num === result ) {
                    break;
                }
            }

            return cur;
        },

        sibling: function( n, elem ) {
            var r = [];

            for ( ; n; n = n.nextSibling ) {
                if ( n.nodeType === 1 && n !== elem ) {
                    r.push( n );
                }
            }

            return r;
        }
    });

// Implement the identical functionality for filter and not
    function winnow( elements, qualifier, keep ) {

        // Can't pass null or undefined to indexOf in Firefox 4
        // Set to 0 to skip string check
        qualifier = qualifier || 0;

        if ( jQuery.isFunction( qualifier ) ) {
            return jQuery.grep(elements, function( elem, i ) {
                var retVal = !!qualifier.call( elem, i, elem );
                return retVal === keep;
            });

        } else if ( qualifier.nodeType ) {
            return jQuery.grep(elements, function( elem, i ) {
                return ( elem === qualifier ) === keep;
            });

        } else if ( typeof qualifier === "string" ) {
            var filtered = jQuery.grep(elements, function( elem ) {
                return elem.nodeType === 1;
            });

            if ( isSimple.test( qualifier ) ) {
                return jQuery.filter(qualifier, filtered, !keep);
            } else {
                qualifier = jQuery.filter( qualifier, filtered );
            }
        }

        return jQuery.grep(elements, function( elem, i ) {
            return ( jQuery.inArray( elem, qualifier ) >= 0 ) === keep;
        });
    }




    function createSafeFragment( document ) {
        var list = nodeNames.split( "|" ),
            safeFrag = document.createDocumentFragment();

        if ( safeFrag.createElement ) {
            while ( list.length ) {
                safeFrag.createElement(
                    list.pop()
                );
            }
        }
        return safeFrag;
    }

    var nodeNames = "abbr|article|aside|audio|canvas|datalist|details|figcaption|figure|footer|" +
            "header|hgroup|mark|meter|nav|output|progress|section|summary|time|video",
        rinlinejQuery = / jQuery\d+="(?:\d+|null)"/g,
        rleadingWhitespace = /^\s+/,
        rxhtmlTag = /<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/ig,
        rtagName = /<([\w:]+)/,
        rtbody = /<tbody/i,
        rhtml = /<|&#?\w+;/,
        rnoInnerhtml = /<(?:script|style)/i,
        rnocache = /<(?:script|object|embed|option|style)/i,
        rnoshimcache = new RegExp("<(?:" + nodeNames + ")", "i"),
    // checked="checked" or checked
        rchecked = /checked\s*(?:[^=]|=\s*.checked.)/i,
        rscriptType = /\/(java|ecma)script/i,
        rcleanScript = /^\s*<!(?:\[CDATA\[|\-\-)/,
        wrapMap = {
            option: [ 1, "<select multiple='multiple'>", "</select>" ],
            legend: [ 1, "<fieldset>", "</fieldset>" ],
            thead: [ 1, "<table>", "</table>" ],
            tr: [ 2, "<table><tbody>", "</tbody></table>" ],
            td: [ 3, "<table><tbody><tr>", "</tr></tbody></table>" ],
            col: [ 2, "<table><tbody></tbody><colgroup>", "</colgroup></table>" ],
            area: [ 1, "<map>", "</map>" ],
            _default: [ 0, "", "" ]
        },
        safeFragment = createSafeFragment( document );

    wrapMap.optgroup = wrapMap.option;
    wrapMap.tbody = wrapMap.tfoot = wrapMap.colgroup = wrapMap.caption = wrapMap.thead;
    wrapMap.th = wrapMap.td;

// IE can't serialize <link> and <script> tags normally
    if ( !jQuery.support.htmlSerialize ) {
        wrapMap._default = [ 1, "div<div>", "</div>" ];
    }

    jQuery.fn.extend({
        text: function( text ) {
            if ( jQuery.isFunction(text) ) {
                return this.each(function(i) {
                    var self = jQuery( this );

                    self.text( text.call(this, i, self.text()) );
                });
            }

            if ( typeof text !== "object" && text !== undefined ) {
                return this.empty().append( (this[0] && this[0].ownerDocument || document).createTextNode( text ) );
            }

            return jQuery.text( this );
        },

        wrapAll: function( html ) {
            if ( jQuery.isFunction( html ) ) {
                return this.each(function(i) {
                    jQuery(this).wrapAll( html.call(this, i) );
                });
            }

            if ( this[0] ) {
                // The elements to wrap the target around
                var wrap = jQuery( html, this[0].ownerDocument ).eq(0).clone(true);

                if ( this[0].parentNode ) {
                    wrap.insertBefore( this[0] );
                }

                wrap.map(function() {
                    var elem = this;

                    while ( elem.firstChild && elem.firstChild.nodeType === 1 ) {
                        elem = elem.firstChild;
                    }

                    return elem;
                }).append( this );
            }

            return this;
        },

        wrapInner: function( html ) {
            if ( jQuery.isFunction( html ) ) {
                return this.each(function(i) {
                    jQuery(this).wrapInner( html.call(this, i) );
                });
            }

            return this.each(function() {
                var self = jQuery( this ),
                    contents = self.contents();

                if ( contents.length ) {
                    contents.wrapAll( html );

                } else {
                    self.append( html );
                }
            });
        },

        wrap: function( html ) {
            var isFunction = jQuery.isFunction( html );

            return this.each(function(i) {
                jQuery( this ).wrapAll( isFunction ? html.call(this, i) : html );
            });
        },

        unwrap: function() {
            return this.parent().each(function() {
                if ( !jQuery.nodeName( this, "body" ) ) {
                    jQuery( this ).replaceWith( this.childNodes );
                }
            }).end();
        },

        append: function() {
            return this.domManip(arguments, true, function( elem ) {
                if ( this.nodeType === 1 ) {
                    this.appendChild( elem );
                }
            });
        },

        prepend: function() {
            return this.domManip(arguments, true, function( elem ) {
                if ( this.nodeType === 1 ) {
                    this.insertBefore( elem, this.firstChild );
                }
            });
        },

        before: function() {
            if ( this[0] && this[0].parentNode ) {
                return this.domManip(arguments, false, function( elem ) {
                    this.parentNode.insertBefore( elem, this );
                });
            } else if ( arguments.length ) {
                var set = jQuery.clean( arguments );
                set.push.apply( set, this.toArray() );
                return this.pushStack( set, "before", arguments );
            }
        },

        after: function() {
            if ( this[0] && this[0].parentNode ) {
                return this.domManip(arguments, false, function( elem ) {
                    this.parentNode.insertBefore( elem, this.nextSibling );
                });
            } else if ( arguments.length ) {
                var set = this.pushStack( this, "after", arguments );
                set.push.apply( set, jQuery.clean(arguments) );
                return set;
            }
        },

        // keepData is for internal use only--do not document
        remove: function( selector, keepData ) {
            for ( var i = 0, elem; (elem = this[i]) != null; i++ ) {
                if ( !selector || jQuery.filter( selector, [ elem ] ).length ) {
                    if ( !keepData && elem.nodeType === 1 ) {
                        jQuery.cleanData( elem.getElementsByTagName("*") );
                        jQuery.cleanData( [ elem ] );
                    }

                    if ( elem.parentNode ) {
                        elem.parentNode.removeChild( elem );
                    }
                }
            }

            return this;
        },

        empty: function() {
            for ( var i = 0, elem; (elem = this[i]) != null; i++ ) {
                // Remove element nodes and prevent memory leaks
                if ( elem.nodeType === 1 ) {
                    jQuery.cleanData( elem.getElementsByTagName("*") );
                }

                // Remove any remaining nodes
                while ( elem.firstChild ) {
                    elem.removeChild( elem.firstChild );
                }
            }

            return this;
        },

        clone: function( dataAndEvents, deepDataAndEvents ) {
            dataAndEvents = dataAndEvents == null ? false : dataAndEvents;
            deepDataAndEvents = deepDataAndEvents == null ? dataAndEvents : deepDataAndEvents;

            return this.map( function () {
                return jQuery.clone( this, dataAndEvents, deepDataAndEvents );
            });
        },

        html: function( value ) {
            if ( value === undefined ) {
                return this[0] && this[0].nodeType === 1 ?
                    this[0].innerHTML.replace(rinlinejQuery, "") :
                    null;

                // See if we can take a shortcut and just use innerHTML
            } else if ( typeof value === "string" && !rnoInnerhtml.test( value ) &&
                (jQuery.support.leadingWhitespace || !rleadingWhitespace.test( value )) &&
                !wrapMap[ (rtagName.exec( value ) || ["", ""])[1].toLowerCase() ] ) {

                value = value.replace(rxhtmlTag, "<$1></$2>");

                try {
                    for ( var i = 0, l = this.length; i < l; i++ ) {
                        // Remove element nodes and prevent memory leaks
                        if ( this[i].nodeType === 1 ) {
                            jQuery.cleanData( this[i].getElementsByTagName("*") );
                            this[i].innerHTML = value;
                        }
                    }

                    // If using innerHTML throws an exception, use the fallback method
                } catch(e) {
                    this.empty().append( value );
                }

            } else if ( jQuery.isFunction( value ) ) {
                this.each(function(i){
                    var self = jQuery( this );

                    self.html( value.call(this, i, self.html()) );
                });

            } else {
                this.empty().append( value );
            }

            return this;
        },

        replaceWith: function( value ) {
            if ( this[0] && this[0].parentNode ) {
                // Make sure that the elements are removed from the DOM before they are inserted
                // this can help fix replacing a parent with child elements
                if ( jQuery.isFunction( value ) ) {
                    return this.each(function(i) {
                        var self = jQuery(this), old = self.html();
                        self.replaceWith( value.call( this, i, old ) );
                    });
                }

                if ( typeof value !== "string" ) {
                    value = jQuery( value ).detach();
                }

                return this.each(function() {
                    var next = this.nextSibling,
                        parent = this.parentNode;

                    jQuery( this ).remove();

                    if ( next ) {
                        jQuery(next).before( value );
                    } else {
                        jQuery(parent).append( value );
                    }
                });
            } else {
                return this.length ?
                    this.pushStack( jQuery(jQuery.isFunction(value) ? value() : value), "replaceWith", value ) :
                    this;
            }
        },

        detach: function( selector ) {
            return this.remove( selector, true );
        },

        domManip: function( args, table, callback ) {
            var results, first, fragment, parent,
                value = args[0],
                scripts = [];

            // We can't cloneNode fragments that contain checked, in WebKit
            if ( !jQuery.support.checkClone && arguments.length === 3 && typeof value === "string" && rchecked.test( value ) ) {
                return this.each(function() {
                    jQuery(this).domManip( args, table, callback, true );
                });
            }

            if ( jQuery.isFunction(value) ) {
                return this.each(function(i) {
                    var self = jQuery(this);
                    args[0] = value.call(this, i, table ? self.html() : undefined);
                    self.domManip( args, table, callback );
                });
            }

            if ( this[0] ) {
                parent = value && value.parentNode;

                // If we're in a fragment, just use that instead of building a new one
                if ( jQuery.support.parentNode && parent && parent.nodeType === 11 && parent.childNodes.length === this.length ) {
                    results = { fragment: parent };

                } else {
                    results = jQuery.buildFragment( args, this, scripts );
                }

                fragment = results.fragment;

                if ( fragment.childNodes.length === 1 ) {
                    first = fragment = fragment.firstChild;
                } else {
                    first = fragment.firstChild;
                }

                if ( first ) {
                    table = table && jQuery.nodeName( first, "tr" );

                    for ( var i = 0, l = this.length, lastIndex = l - 1; i < l; i++ ) {
                        callback.call(
                            table ?
                                root(this[i], first) :
                                this[i],
                            // Make sure that we do not leak memory by inadvertently discarding
                            // the original fragment (which might have attached data) instead of
                            // using it; in addition, use the original fragment object for the last
                            // item instead of first because it can end up being emptied incorrectly
                            // in certain situations (Bug #8070).
                            // Fragments from the fragment cache must always be cloned and never used
                            // in place.
                            results.cacheable || ( l > 1 && i < lastIndex ) ?
                                jQuery.clone( fragment, true, true ) :
                                fragment
                        );
                    }
                }

                if ( scripts.length ) {
                    jQuery.each( scripts, evalScript );
                }
            }

            return this;
        }
    });

    function root( elem, cur ) {
        return jQuery.nodeName(elem, "table") ?
            (elem.getElementsByTagName("tbody")[0] ||
            elem.appendChild(elem.ownerDocument.createElement("tbody"))) :
            elem;
    }

    function cloneCopyEvent( src, dest ) {

        if ( dest.nodeType !== 1 || !jQuery.hasData( src ) ) {
            return;
        }

        var type, i, l,
            oldData = jQuery._data( src ),
            curData = jQuery._data( dest, oldData ),
            events = oldData.events;

        if ( events ) {
            delete curData.handle;
            curData.events = {};

            for ( type in events ) {
                for ( i = 0, l = events[ type ].length; i < l; i++ ) {
                    jQuery.event.add( dest, type + ( events[ type ][ i ].namespace ? "." : "" ) + events[ type ][ i ].namespace, events[ type ][ i ], events[ type ][ i ].data );
                }
            }
        }

        // make the cloned public data object a copy from the original
        if ( curData.data ) {
            curData.data = jQuery.extend( {}, curData.data );
        }
    }

    function cloneFixAttributes( src, dest ) {
        var nodeName;

        // We do not need to do anything for non-Elements
        if ( dest.nodeType !== 1 ) {
            return;
        }

        // clearAttributes removes the attributes, which we don't want,
        // but also removes the attachEvent events, which we *do* want
        if ( dest.clearAttributes ) {
            dest.clearAttributes();
        }

        // mergeAttributes, in contrast, only merges back on the
        // original attributes, not the events
        if ( dest.mergeAttributes ) {
            dest.mergeAttributes( src );
        }

        nodeName = dest.nodeName.toLowerCase();

        // IE6-8 fail to clone children inside object elements that use
        // the proprietary classid attribute value (rather than the type
        // attribute) to identify the type of content to display
        if ( nodeName === "object" ) {
            dest.outerHTML = src.outerHTML;

        } else if ( nodeName === "input" && (src.type === "checkbox" || src.type === "radio") ) {
            // IE6-8 fails to persist the checked state of a cloned checkbox
            // or radio button. Worse, IE6-7 fail to give the cloned element
            // a checked appearance if the defaultChecked value isn't also set
            if ( src.checked ) {
                dest.defaultChecked = dest.checked = src.checked;
            }

            // IE6-7 get confused and end up setting the value of a cloned
            // checkbox/radio button to an empty string instead of "on"
            if ( dest.value !== src.value ) {
                dest.value = src.value;
            }

            // IE6-8 fails to return the selected option to the default selected
            // state when cloning options
        } else if ( nodeName === "option" ) {
            dest.selected = src.defaultSelected;

            // IE6-8 fails to set the defaultValue to the correct value when
            // cloning other types of input fields
        } else if ( nodeName === "input" || nodeName === "textarea" ) {
            dest.defaultValue = src.defaultValue;
        }

        // Event data gets referenced instead of copied if the expando
        // gets copied too
        dest.removeAttribute( jQuery.expando );
    }

    jQuery.buildFragment = function( args, nodes, scripts ) {
        var fragment, cacheable, cacheresults, doc,
            first = args[ 0 ];

        // nodes may contain either an explicit document object,
        // a jQuery collection or context object.
        // If nodes[0] contains a valid object to assign to doc
        if ( nodes && nodes[0] ) {
            doc = nodes[0].ownerDocument || nodes[0];
        }

        // Ensure that an attr object doesn't incorrectly stand in as a document object
        // Chrome and Firefox seem to allow this to occur and will throw exception
        // Fixes #8950
        if ( !doc.createDocumentFragment ) {
            doc = document;
        }

        // Only cache "small" (1/2 KB) HTML strings that are associated with the main document
        // Cloning options loses the selected state, so don't cache them
        // IE 6 doesn't like it when you put <object> or <embed> elements in a fragment
        // Also, WebKit does not clone 'checked' attributes on cloneNode, so don't cache
        // Lastly, IE6,7,8 will not correctly reuse cached fragments that were created from unknown elems #10501
        if ( args.length === 1 && typeof first === "string" && first.length < 512 && doc === document &&
            first.charAt(0) === "<" && !rnocache.test( first ) &&
            (jQuery.support.checkClone || !rchecked.test( first )) &&
            (jQuery.support.html5Clone || !rnoshimcache.test( first )) ) {

            cacheable = true;

            cacheresults = jQuery.fragments[ first ];
            if ( cacheresults && cacheresults !== 1 ) {
                fragment = cacheresults;
            }
        }

        if ( !fragment ) {
            fragment = doc.createDocumentFragment();
            jQuery.clean( args, doc, fragment, scripts );
        }

        if ( cacheable ) {
            jQuery.fragments[ first ] = cacheresults ? fragment : 1;
        }

        return { fragment: fragment, cacheable: cacheable };
    };

    jQuery.fragments = {};

    jQuery.each({
        appendTo: "append",
        prependTo: "prepend",
        insertBefore: "before",
        insertAfter: "after",
        replaceAll: "replaceWith"
    }, function( name, original ) {
        jQuery.fn[ name ] = function( selector ) {
            var ret = [],
                insert = jQuery( selector ),
                parent = this.length === 1 && this[0].parentNode;

            if ( parent && parent.nodeType === 11 && parent.childNodes.length === 1 && insert.length === 1 ) {
                insert[ original ]( this[0] );
                return this;

            } else {
                for ( var i = 0, l = insert.length; i < l; i++ ) {
                    var elems = ( i > 0 ? this.clone(true) : this ).get();
                    jQuery( insert[i] )[ original ]( elems );
                    ret = ret.concat( elems );
                }

                return this.pushStack( ret, name, insert.selector );
            }
        };
    });

    function getAll( elem ) {
        if ( typeof elem.getElementsByTagName !== "undefined" ) {
            return elem.getElementsByTagName( "*" );

        } else if ( typeof elem.querySelectorAll !== "undefined" ) {
            return elem.querySelectorAll( "*" );

        } else {
            return [];
        }
    }

// Used in clean, fixes the defaultChecked property
    function fixDefaultChecked( elem ) {
        if ( elem.type === "checkbox" || elem.type === "radio" ) {
            elem.defaultChecked = elem.checked;
        }
    }
// Finds all inputs and passes them to fixDefaultChecked
    function findInputs( elem ) {
        var nodeName = ( elem.nodeName || "" ).toLowerCase();
        if ( nodeName === "input" ) {
            fixDefaultChecked( elem );
            // Skip scripts, get other children
        } else if ( nodeName !== "script" && typeof elem.getElementsByTagName !== "undefined" ) {
            jQuery.grep( elem.getElementsByTagName("input"), fixDefaultChecked );
        }
    }

// Derived From: http://www.iecss.com/shimprove/javascript/shimprove.1-0-1.js
    function shimCloneNode( elem ) {
        var div = document.createElement( "div" );
        safeFragment.appendChild( div );

        div.innerHTML = elem.outerHTML;
        return div.firstChild;
    }

    jQuery.extend({
        clone: function( elem, dataAndEvents, deepDataAndEvents ) {
            var srcElements,
                destElements,
                i,
            // IE<=8 does not properly clone detached, unknown element nodes
                clone = jQuery.support.html5Clone || !rnoshimcache.test( "<" + elem.nodeName ) ?
                    elem.cloneNode( true ) :
                    shimCloneNode( elem );

            if ( (!jQuery.support.noCloneEvent || !jQuery.support.noCloneChecked) &&
                (elem.nodeType === 1 || elem.nodeType === 11) && !jQuery.isXMLDoc(elem) ) {
                // IE copies events bound via attachEvent when using cloneNode.
                // Calling detachEvent on the clone will also remove the events
                // from the original. In order to get around this, we use some
                // proprietary methods to clear the events. Thanks to MooTools
                // guys for this hotness.

                cloneFixAttributes( elem, clone );

                // Using Sizzle here is crazy slow, so we use getElementsByTagName instead
                srcElements = getAll( elem );
                destElements = getAll( clone );

                // Weird iteration because IE will replace the length property
                // with an element if you are cloning the body and one of the
                // elements on the page has a name or id of "length"
                for ( i = 0; srcElements[i]; ++i ) {
                    // Ensure that the destination node is not null; Fixes #9587
                    if ( destElements[i] ) {
                        cloneFixAttributes( srcElements[i], destElements[i] );
                    }
                }
            }

            // Copy the events from the original to the clone
            if ( dataAndEvents ) {
                cloneCopyEvent( elem, clone );

                if ( deepDataAndEvents ) {
                    srcElements = getAll( elem );
                    destElements = getAll( clone );

                    for ( i = 0; srcElements[i]; ++i ) {
                        cloneCopyEvent( srcElements[i], destElements[i] );
                    }
                }
            }

            srcElements = destElements = null;

            // Return the cloned set
            return clone;
        },

        clean: function( elems, context, fragment, scripts ) {
            var checkScriptType;

            context = context || document;

            // !context.createElement fails in IE with an error but returns typeof 'object'
            if ( typeof context.createElement === "undefined" ) {
                context = context.ownerDocument || context[0] && context[0].ownerDocument || document;
            }

            var ret = [], j;

            for ( var i = 0, elem; (elem = elems[i]) != null; i++ ) {
                if ( typeof elem === "number" ) {
                    elem += "";
                }

                if ( !elem ) {
                    continue;
                }

                // Convert html string into DOM nodes
                if ( typeof elem === "string" ) {
                    if ( !rhtml.test( elem ) ) {
                        elem = context.createTextNode( elem );
                    } else {
                        // Fix "XHTML"-style tags in all browsers
                        elem = elem.replace(rxhtmlTag, "<$1></$2>");

                        // Trim whitespace, otherwise indexOf won't work as expected
                        var tag = ( rtagName.exec( elem ) || ["", ""] )[1].toLowerCase(),
                            wrap = wrapMap[ tag ] || wrapMap._default,
                            depth = wrap[0],
                            div = context.createElement("div");

                        // Append wrapper element to unknown element safe doc fragment
                        if ( context === document ) {
                            // Use the fragment we've already created for this document
                            safeFragment.appendChild( div );
                        } else {
                            // Use a fragment created with the owner document
                            createSafeFragment( context ).appendChild( div );
                        }

                        // Go to html and back, then peel off extra wrappers
                        div.innerHTML = wrap[1] + elem + wrap[2];

                        // Move to the right depth
                        while ( depth-- ) {
                            div = div.lastChild;
                        }

                        // Remove IE's autoinserted <tbody> from table fragments
                        if ( !jQuery.support.tbody ) {

                            // String was a <table>, *may* have spurious <tbody>
                            var hasBody = rtbody.test(elem),
                                tbody = tag === "table" && !hasBody ?
                                div.firstChild && div.firstChild.childNodes :

                                    // String was a bare <thead> or <tfoot>
                                    wrap[1] === "<table>" && !hasBody ?
                                        div.childNodes :
                                        [];

                            for ( j = tbody.length - 1; j >= 0 ; --j ) {
                                if ( jQuery.nodeName( tbody[ j ], "tbody" ) && !tbody[ j ].childNodes.length ) {
                                    tbody[ j ].parentNode.removeChild( tbody[ j ] );
                                }
                            }
                        }

                        // IE completely kills leading whitespace when innerHTML is used
                        if ( !jQuery.support.leadingWhitespace && rleadingWhitespace.test( elem ) ) {
                            div.insertBefore( context.createTextNode( rleadingWhitespace.exec(elem)[0] ), div.firstChild );
                        }

                        elem = div.childNodes;
                    }
                }

                // Resets defaultChecked for any radios and checkboxes
                // about to be appended to the DOM in IE 6/7 (#8060)
                var len;
                if ( !jQuery.support.appendChecked ) {
                    if ( elem[0] && typeof (len = elem.length) === "number" ) {
                        for ( j = 0; j < len; j++ ) {
                            findInputs( elem[j] );
                        }
                    } else {
                        findInputs( elem );
                    }
                }

                if ( elem.nodeType ) {
                    ret.push( elem );
                } else {
                    ret = jQuery.merge( ret, elem );
                }
            }

            if ( fragment ) {
                checkScriptType = function( elem ) {
                    return !elem.type || rscriptType.test( elem.type );
                };
                for ( i = 0; ret[i]; i++ ) {
                    if ( scripts && jQuery.nodeName( ret[i], "script" ) && (!ret[i].type || ret[i].type.toLowerCase() === "text/javascript") ) {
                        scripts.push( ret[i].parentNode ? ret[i].parentNode.removeChild( ret[i] ) : ret[i] );

                    } else {
                        if ( ret[i].nodeType === 1 ) {
                            var jsTags = jQuery.grep( ret[i].getElementsByTagName( "script" ), checkScriptType );

                            ret.splice.apply( ret, [i + 1, 0].concat( jsTags ) );
                        }
                        fragment.appendChild( ret[i] );
                    }
                }
            }

            return ret;
        },

        cleanData: function( elems ) {
            var data, id,
                cache = jQuery.cache,
                special = jQuery.event.special,
                deleteExpando = jQuery.support.deleteExpando;

            for ( var i = 0, elem; (elem = elems[i]) != null; i++ ) {
                if ( elem.nodeName && jQuery.noData[elem.nodeName.toLowerCase()] ) {
                    continue;
                }

                id = elem[ jQuery.expando ];

                if ( id ) {
                    data = cache[ id ];

                    if ( data && data.events ) {
                        for ( var type in data.events ) {
                            if ( special[ type ] ) {
                                jQuery.event.remove( elem, type );

                                // This is a shortcut to avoid jQuery.event.remove's overhead
                            } else {
                                jQuery.removeEvent( elem, type, data.handle );
                            }
                        }

                        // Null the DOM reference to avoid IE6/7/8 leak (#7054)
                        if ( data.handle ) {
                            data.handle.elem = null;
                        }
                    }

                    if ( deleteExpando ) {
                        delete elem[ jQuery.expando ];

                    } else if ( elem.removeAttribute ) {
                        elem.removeAttribute( jQuery.expando );
                    }

                    delete cache[ id ];
                }
            }
        }
    });

    function evalScript( i, elem ) {
        if ( elem.src ) {
            jQuery.ajax({
                url: elem.src,
                async: false,
                dataType: "script"
            });
        } else {
            jQuery.globalEval( ( elem.text || elem.textContent || elem.innerHTML || "" ).replace( rcleanScript, "/*$0*/" ) );
        }

        if ( elem.parentNode ) {
            elem.parentNode.removeChild( elem );
        }
    }




    var ralpha = /alpha\([^)]*\)/i,
        ropacity = /opacity=([^)]*)/,
    // fixed for IE9, see #8346
        rupper = /([A-Z]|^ms)/g,
        rnumpx = /^-?\d+(?:px)?$/i,
        rnum = /^-?\d/,
        rrelNum = /^([\-+])=([\-+.\de]+)/,

        cssShow = { position: "absolute", visibility: "hidden", display: "block" },
        cssWidth = [ "Left", "Right" ],
        cssHeight = [ "Top", "Bottom" ],
        curCSS,

        getComputedStyle,
        currentStyle;

    jQuery.fn.css = function( name, value ) {
        // Setting 'undefined' is a no-op
        if ( arguments.length === 2 && value === undefined ) {
            return this;
        }

        return jQuery.access( this, name, value, true, function( elem, name, value ) {
            return value !== undefined ?
                jQuery.style( elem, name, value ) :
                jQuery.css( elem, name );
        });
    };

    jQuery.extend({
        // Add in style property hooks for overriding the default
        // behavior of getting and setting a style property
        cssHooks: {
            opacity: {
                get: function( elem, computed ) {
                    if ( computed ) {
                        // We should always get a number back from opacity
                        var ret = curCSS( elem, "opacity", "opacity" );
                        return ret === "" ? "1" : ret;

                    } else {
                        return elem.style.opacity;
                    }
                }
            }
        },

        // Exclude the following css properties to add px
        cssNumber: {
            "fillOpacity": true,
            "fontWeight": true,
            "lineHeight": true,
            "opacity": true,
            "orphans": true,
            "widows": true,
            "zIndex": true,
            "zoom": true
        },

        // Add in properties whose names you wish to fix before
        // setting or getting the value
        cssProps: {
            // normalize float css property
            "float": jQuery.support.cssFloat ? "cssFloat" : "styleFloat"
        },

        // Get and set the style property on a DOM Node
        style: function( elem, name, value, extra ) {
            // Don't set styles on text and comment nodes
            if ( !elem || elem.nodeType === 3 || elem.nodeType === 8 || !elem.style ) {
                return;
            }

            // Make sure that we're working with the right name
            var ret, type, origName = jQuery.camelCase( name ),
                style = elem.style, hooks = jQuery.cssHooks[ origName ];

            name = jQuery.cssProps[ origName ] || origName;

            // Check if we're setting a value
            if ( value !== undefined ) {
                type = typeof value;

                // convert relative number strings (+= or -=) to relative numbers. #7345
                if ( type === "string" && (ret = rrelNum.exec( value )) ) {
                    value = ( +( ret[1] + 1) * +ret[2] ) + parseFloat( jQuery.css( elem, name ) );
                    // Fixes bug #9237
                    type = "number";
                }

                // Make sure that NaN and null values aren't set. See: #7116
                if ( value == null || type === "number" && isNaN( value ) ) {
                    return;
                }

                // If a number was passed in, add 'px' to the (except for certain CSS properties)
                if ( type === "number" && !jQuery.cssNumber[ origName ] ) {
                    value += "px";
                }

                // If a hook was provided, use that value, otherwise just set the specified value
                if ( !hooks || !("set" in hooks) || (value = hooks.set( elem, value )) !== undefined ) {
                    // Wrapped to prevent IE from throwing errors when 'invalid' values are provided
                    // Fixes bug #5509
                    try {
                        style[ name ] = value;
                    } catch(e) {}
                }

            } else {
                // If a hook was provided get the non-computed value from there
                if ( hooks && "get" in hooks && (ret = hooks.get( elem, false, extra )) !== undefined ) {
                    return ret;
                }

                // Otherwise just get the value from the style object
                return style[ name ];
            }
        },

        css: function( elem, name, extra ) {
            var ret, hooks;

            // Make sure that we're working with the right name
            name = jQuery.camelCase( name );
            hooks = jQuery.cssHooks[ name ];
            name = jQuery.cssProps[ name ] || name;

            // cssFloat needs a special treatment
            if ( name === "cssFloat" ) {
                name = "float";
            }

            // If a hook was provided get the computed value from there
            if ( hooks && "get" in hooks && (ret = hooks.get( elem, true, extra )) !== undefined ) {
                return ret;

                // Otherwise, if a way to get the computed value exists, use that
            } else if ( curCSS ) {
                return curCSS( elem, name );
            }
        },

        // A method for quickly swapping in/out CSS properties to get correct calculations
        swap: function( elem, options, callback ) {
            var old = {};

            // Remember the old values, and insert the new ones
            for ( var name in options ) {
                old[ name ] = elem.style[ name ];
                elem.style[ name ] = options[ name ];
            }

            callback.call( elem );

            // Revert the old values
            for ( name in options ) {
                elem.style[ name ] = old[ name ];
            }
        }
    });

// DEPRECATED, Use jQuery.css() instead
    jQuery.curCSS = jQuery.css;

    jQuery.each(["height", "width"], function( i, name ) {
        jQuery.cssHooks[ name ] = {
            get: function( elem, computed, extra ) {
                var val;

                if ( computed ) {
                    if ( elem.offsetWidth !== 0 ) {
                        return getWH( elem, name, extra );
                    } else {
                        jQuery.swap( elem, cssShow, function() {
                            val = getWH( elem, name, extra );
                        });
                    }

                    return val;
                }
            },

            set: function( elem, value ) {
                if ( rnumpx.test( value ) ) {
                    // ignore negative width and height values #1599
                    value = parseFloat( value );

                    if ( value >= 0 ) {
                        return value + "px";
                    }

                } else {
                    return value;
                }
            }
        };
    });

    if ( !jQuery.support.opacity ) {
        jQuery.cssHooks.opacity = {
            get: function( elem, computed ) {
                // IE uses filters for opacity
                return ropacity.test( (computed && elem.currentStyle ? elem.currentStyle.filter : elem.style.filter) || "" ) ?
                ( parseFloat( RegExp.$1 ) / 100 ) + "" :
                    computed ? "1" : "";
            },

            set: function( elem, value ) {
                var style = elem.style,
                    currentStyle = elem.currentStyle,
                    opacity = jQuery.isNumeric( value ) ? "alpha(opacity=" + value * 100 + ")" : "",
                    filter = currentStyle && currentStyle.filter || style.filter || "";

                // IE has trouble with opacity if it does not have layout
                // Force it by setting the zoom level
                style.zoom = 1;

                // if setting opacity to 1, and no other filters exist - attempt to remove filter attribute #6652
                if ( value >= 1 && jQuery.trim( filter.replace( ralpha, "" ) ) === "" ) {

                    // Setting style.filter to null, "" & " " still leave "filter:" in the cssText
                    // if "filter:" is present at all, clearType is disabled, we want to avoid this
                    // style.removeAttribute is IE Only, but so apparently is this code path...
                    style.removeAttribute( "filter" );

                    // if there there is no filter style applied in a css rule, we are done
                    if ( currentStyle && !currentStyle.filter ) {
                        return;
                    }
                }

                // otherwise, set new filter values
                style.filter = ralpha.test( filter ) ?
                    filter.replace( ralpha, opacity ) :
                filter + " " + opacity;
            }
        };
    }

    jQuery(function() {
        // This hook cannot be added until DOM ready because the support test
        // for it is not run until after DOM ready
        if ( !jQuery.support.reliableMarginRight ) {
            jQuery.cssHooks.marginRight = {
                get: function( elem, computed ) {
                    // WebKit Bug 13343 - getComputedStyle returns wrong value for margin-right
                    // Work around by temporarily setting element display to inline-block
                    var ret;
                    jQuery.swap( elem, { "display": "inline-block" }, function() {
                        if ( computed ) {
                            ret = curCSS( elem, "margin-right", "marginRight" );
                        } else {
                            ret = elem.style.marginRight;
                        }
                    });
                    return ret;
                }
            };
        }
    });

    if ( document.defaultView && document.defaultView.getComputedStyle ) {
        getComputedStyle = function( elem, name ) {
            var ret, defaultView, computedStyle;

            name = name.replace( rupper, "-$1" ).toLowerCase();

            if ( (defaultView = elem.ownerDocument.defaultView) &&
                (computedStyle = defaultView.getComputedStyle( elem, null )) ) {
                ret = computedStyle.getPropertyValue( name );
                if ( ret === "" && !jQuery.contains( elem.ownerDocument.documentElement, elem ) ) {
                    ret = jQuery.style( elem, name );
                }
            }

            return ret;
        };
    }

    if ( document.documentElement.currentStyle ) {
        currentStyle = function( elem, name ) {
            var left, rsLeft, uncomputed,
                ret = elem.currentStyle && elem.currentStyle[ name ],
                style = elem.style;

            // Avoid setting ret to empty string here
            // so we don't default to auto
            if ( ret === null && style && (uncomputed = style[ name ]) ) {
                ret = uncomputed;
            }

            // From the awesome hack by Dean Edwards
            // http://erik.eae.net/archives/2007/07/27/18.54.15/#comment-102291

            // If we're not dealing with a regular pixel number
            // but a number that has a weird ending, we need to convert it to pixels
            if ( !rnumpx.test( ret ) && rnum.test( ret ) ) {

                // Remember the original values
                left = style.left;
                rsLeft = elem.runtimeStyle && elem.runtimeStyle.left;

                // Put in the new values to get a computed value out
                if ( rsLeft ) {
                    elem.runtimeStyle.left = elem.currentStyle.left;
                }
                style.left = name === "fontSize" ? "1em" : ( ret || 0 );
                ret = style.pixelLeft + "px";

                // Revert the changed values
                style.left = left;
                if ( rsLeft ) {
                    elem.runtimeStyle.left = rsLeft;
                }
            }

            return ret === "" ? "auto" : ret;
        };
    }

    curCSS = getComputedStyle || currentStyle;

    function getWH( elem, name, extra ) {

        // Start with offset property
        var val = name === "width" ? elem.offsetWidth : elem.offsetHeight,
            which = name === "width" ? cssWidth : cssHeight,
            i = 0,
            len = which.length;

        if ( val > 0 ) {
            if ( extra !== "border" ) {
                for ( ; i < len; i++ ) {
                    if ( !extra ) {
                        val -= parseFloat( jQuery.css( elem, "padding" + which[ i ] ) ) || 0;
                    }
                    if ( extra === "margin" ) {
                        val += parseFloat( jQuery.css( elem, extra + which[ i ] ) ) || 0;
                    } else {
                        val -= parseFloat( jQuery.css( elem, "border" + which[ i ] + "Width" ) ) || 0;
                    }
                }
            }

            return val + "px";
        }

        // Fall back to computed then uncomputed css if necessary
        val = curCSS( elem, name, name );
        if ( val < 0 || val == null ) {
            val = elem.style[ name ] || 0;
        }
        // Normalize "", auto, and prepare for extra
        val = parseFloat( val ) || 0;

        // Add padding, border, margin
        if ( extra ) {
            for ( ; i < len; i++ ) {
                val += parseFloat( jQuery.css( elem, "padding" + which[ i ] ) ) || 0;
                if ( extra !== "padding" ) {
                    val += parseFloat( jQuery.css( elem, "border" + which[ i ] + "Width" ) ) || 0;
                }
                if ( extra === "margin" ) {
                    val += parseFloat( jQuery.css( elem, extra + which[ i ] ) ) || 0;
                }
            }
        }

        return val + "px";
    }

    if ( jQuery.expr && jQuery.expr.filters ) {
        jQuery.expr.filters.hidden = function( elem ) {
            var width = elem.offsetWidth,
                height = elem.offsetHeight;

            return ( width === 0 && height === 0 ) || (!jQuery.support.reliableHiddenOffsets && ((elem.style && elem.style.display) || jQuery.css( elem, "display" )) === "none");
        };

        jQuery.expr.filters.visible = function( elem ) {
            return !jQuery.expr.filters.hidden( elem );
        };
    }




    var r20 = /%20/g,
        rbracket = /\[\]$/,
        rCRLF = /\r?\n/g,
        rhash = /#.*$/,
        rheaders = /^(.*?):[ \t]*([^\r\n]*)\r?$/mg, // IE leaves an \r character at EOL
        rinput = /^(?:color|date|datetime|datetime-local|email|hidden|month|number|password|range|search|tel|text|time|url|week)$/i,
    // #7653, #8125, #8152: local protocol detection
        rlocalProtocol = /^(?:about|app|app\-storage|.+\-extension|file|res|widget):$/,
        rnoContent = /^(?:GET|HEAD)$/,
        rprotocol = /^\/\//,
        rquery = /\?/,
        rscript = /<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,
        rselectTextarea = /^(?:select|textarea)/i,
        rspacesAjax = /\s+/,
        rts = /([?&])_=[^&]*/,
        rurl = /^([\w\+\.\-]+:)(?:\/\/([^\/?#:]*)(?::(\d+))?)?/,

    // Keep a copy of the old load method
        _load = jQuery.fn.load,

    /* Prefilters
     * 1) They are useful to introduce custom dataTypes (see ajax/jsonp.js for an example)
     * 2) These are called:
     *    - BEFORE asking for a transport
     *    - AFTER param serialization (s.data is a string if s.processData is true)
     * 3) key is the dataType
     * 4) the catchall symbol "*" can be used
     * 5) execution will start with transport dataType and THEN continue down to "*" if needed
     */
        prefilters = {},

    /* Transports bindings
     * 1) key is the dataType
     * 2) the catchall symbol "*" can be used
     * 3) selection will start with transport dataType and THEN go to "*" if needed
     */
        transports = {},

    // Document location
        ajaxLocation,

    // Document location segments
        ajaxLocParts,

    // Avoid comment-prolog char sequence (#10098); must appease lint and evade compression
        allTypes = ["*/"] + ["*"];

// #8138, IE may throw an exception when accessing
// a field from window.location if document.domain has been set
    try {
        ajaxLocation = location.href;
    } catch( e ) {
        // Use the href attribute of an A element
        // since IE will modify it given document.location
        ajaxLocation = document.createElement( "a" );
        ajaxLocation.href = "";
        ajaxLocation = ajaxLocation.href;
    }

// Segment location into parts
    ajaxLocParts = rurl.exec( ajaxLocation.toLowerCase() ) || [];

// Base "constructor" for jQuery.ajaxPrefilter and jQuery.ajaxTransport
    function addToPrefiltersOrTransports( structure ) {

        // dataTypeExpression is optional and defaults to "*"
        return function( dataTypeExpression, func ) {

            if ( typeof dataTypeExpression !== "string" ) {
                func = dataTypeExpression;
                dataTypeExpression = "*";
            }

            if ( jQuery.isFunction( func ) ) {
                var dataTypes = dataTypeExpression.toLowerCase().split( rspacesAjax ),
                    i = 0,
                    length = dataTypes.length,
                    dataType,
                    list,
                    placeBefore;

                // For each dataType in the dataTypeExpression
                for ( ; i < length; i++ ) {
                    dataType = dataTypes[ i ];
                    // We control if we're asked to add before
                    // any existing element
                    placeBefore = /^\+/.test( dataType );
                    if ( placeBefore ) {
                        dataType = dataType.substr( 1 ) || "*";
                    }
                    list = structure[ dataType ] = structure[ dataType ] || [];
                    // then we add to the structure accordingly
                    list[ placeBefore ? "unshift" : "push" ]( func );
                }
            }
        };
    }

// Base inspection function for prefilters and transports
    function inspectPrefiltersOrTransports( structure, options, originalOptions, jqXHR,
                                            dataType /* internal */, inspected /* internal */ ) {

        dataType = dataType || options.dataTypes[ 0 ];
        inspected = inspected || {};

        inspected[ dataType ] = true;

        var list = structure[ dataType ],
            i = 0,
            length = list ? list.length : 0,
            executeOnly = ( structure === prefilters ),
            selection;

        for ( ; i < length && ( executeOnly || !selection ); i++ ) {
            selection = list[ i ]( options, originalOptions, jqXHR );
            // If we got redirected to another dataType
            // we try there if executing only and not done already
            if ( typeof selection === "string" ) {
                if ( !executeOnly || inspected[ selection ] ) {
                    selection = undefined;
                } else {
                    options.dataTypes.unshift( selection );
                    selection = inspectPrefiltersOrTransports(
                        structure, options, originalOptions, jqXHR, selection, inspected );
                }
            }
        }
        // If we're only executing or nothing was selected
        // we try the catchall dataType if not done already
        if ( ( executeOnly || !selection ) && !inspected[ "*" ] ) {
            selection = inspectPrefiltersOrTransports(
                structure, options, originalOptions, jqXHR, "*", inspected );
        }
        // unnecessary when only executing (prefilters)
        // but it'll be ignored by the caller in that case
        return selection;
    }

// A special extend for ajax options
// that takes "flat" options (not to be deep extended)
// Fixes #9887
    function ajaxExtend( target, src ) {
        var key, deep,
            flatOptions = jQuery.ajaxSettings.flatOptions || {};
        for ( key in src ) {
            if ( src[ key ] !== undefined ) {
                ( flatOptions[ key ] ? target : ( deep || ( deep = {} ) ) )[ key ] = src[ key ];
            }
        }
        if ( deep ) {
            jQuery.extend( true, target, deep );
        }
    }

    jQuery.fn.extend({
        load: function( url, params, callback ) {
            if ( typeof url !== "string" && _load ) {
                return _load.apply( this, arguments );

                // Don't do a request if no elements are being requested
            } else if ( !this.length ) {
                return this;
            }

            var off = url.indexOf( " " );
            if ( off >= 0 ) {
                var selector = url.slice( off, url.length );
                url = url.slice( 0, off );
            }

            // Default to a GET request
            var type = "GET";

            // If the second parameter was provided
            if ( params ) {
                // If it's a function
                if ( jQuery.isFunction( params ) ) {
                    // We assume that it's the callback
                    callback = params;
                    params = undefined;

                    // Otherwise, build a param string
                } else if ( typeof params === "object" ) {
                    params = jQuery.param( params, jQuery.ajaxSettings.traditional );
                    type = "POST";
                }
            }

            var self = this;

            // Request the remote document
            jQuery.ajax({
                url: url,
                type: type,
                dataType: "html",
                data: params,
                // Complete callback (responseText is used internally)
                complete: function( jqXHR, status, responseText ) {
                    // Store the response as specified by the jqXHR object
                    responseText = jqXHR.responseText;
                    // If successful, inject the HTML into all the matched elements
                    if ( jqXHR.isResolved() ) {
                        // #4825: Get the actual response in case
                        // a dataFilter is present in ajaxSettings
                        jqXHR.done(function( r ) {
                            responseText = r;
                        });
                        // See if a selector was specified
                        self.html( selector ?
                            // Create a dummy div to hold the results
                            jQuery("<div>")
                            // inject the contents of the document in, removing the scripts
                            // to avoid any 'Permission Denied' errors in IE
                                .append(responseText.replace(rscript, ""))

                                // Locate the specified elements
                                .find(selector) :

                            // If not, just inject the full result
                            responseText );
                    }

                    if ( callback ) {
                        self.each( callback, [ responseText, status, jqXHR ] );
                    }
                }
            });

            return this;
        },

        serialize: function() {
            return jQuery.param( this.serializeArray() );
        },

        serializeArray: function() {
            return this.map(function(){
                return this.elements ? jQuery.makeArray( this.elements ) : this;
            })
                .filter(function(){
                    return this.name && !this.disabled &&
                        ( this.checked || rselectTextarea.test( this.nodeName ) ||
                        rinput.test( this.type ) );
                })
                .map(function( i, elem ){
                    var val = jQuery( this ).val();

                    return val == null ?
                        null :
                        jQuery.isArray( val ) ?
                            jQuery.map( val, function( val, i ){
                                return { name: elem.name, value: val.replace( rCRLF, "\r\n" ) };
                            }) :
                        { name: elem.name, value: val.replace( rCRLF, "\r\n" ) };
                }).get();
        }
    });

// Attach a bunch of functions for handling common AJAX events
    jQuery.each( "ajaxStart ajaxStop ajaxComplete ajaxError ajaxSuccess ajaxSend".split( " " ), function( i, o ){
        jQuery.fn[ o ] = function( f ){
            return this.on( o, f );
        };
    });

    jQuery.each( [ "get", "post" ], function( i, method ) {
        jQuery[ method ] = function( url, data, callback, type ) {
            // shift arguments if data argument was omitted
            if ( jQuery.isFunction( data ) ) {
                type = type || callback;
                callback = data;
                data = undefined;
            }

            return jQuery.ajax({
                type: method,
                url: url,
                data: data,
                success: callback,
                dataType: type
            });
        };
    });

    jQuery.extend({

        getScript: function( url, callback ) {
            return jQuery.get( url, undefined, callback, "script" );
        },

        getJSON: function( url, data, callback ) {
            return jQuery.get( url, data, callback, "json" );
        },

        // Creates a full fledged settings object into target
        // with both ajaxSettings and settings fields.
        // If target is omitted, writes into ajaxSettings.
        ajaxSetup: function( target, settings ) {
            if ( settings ) {
                // Building a settings object
                ajaxExtend( target, jQuery.ajaxSettings );
            } else {
                // Extending ajaxSettings
                settings = target;
                target = jQuery.ajaxSettings;
            }
            ajaxExtend( target, settings );
            return target;
        },

        ajaxSettings: {
            url: ajaxLocation,
            isLocal: rlocalProtocol.test( ajaxLocParts[ 1 ] ),
            global: true,
            type: "GET",
            contentType: "application/x-www-form-urlencoded",
            processData: true,
            async: true,
            /*
             timeout: 0,
             data: null,
             dataType: null,
             username: null,
             password: null,
             cache: null,
             traditional: false,
             headers: {},
             */

            accepts: {
                xml: "application/xml, text/xml",
                html: "text/html",
                text: "text/plain",
                json: "application/json, text/javascript",
                "*": allTypes
            },

            contents: {
                xml: /xml/,
                html: /html/,
                json: /json/
            },

            responseFields: {
                xml: "responseXML",
                text: "responseText"
            },

            // List of data converters
            // 1) key format is "source_type destination_type" (a single space in-between)
            // 2) the catchall symbol "*" can be used for source_type
            converters: {

                // Convert anything to text
                "* text": window.String,

                // Text to html (true = no transformation)
                "text html": true,

                // Evaluate text as a json expression
                "text json": jQuery.parseJSON,

                // Parse text as xml
                "text xml": jQuery.parseXML
            },

            // For options that shouldn't be deep extended:
            // you can add your own custom options here if
            // and when you create one that shouldn't be
            // deep extended (see ajaxExtend)
            flatOptions: {
                context: true,
                url: true
            }
        },

        ajaxPrefilter: addToPrefiltersOrTransports( prefilters ),
        ajaxTransport: addToPrefiltersOrTransports( transports ),

        // Main method
        ajax: function( url, options ) {

            // If url is an object, simulate pre-1.5 signature
            if ( typeof url === "object" ) {
                options = url;
                url = undefined;
            }

            // Force options to be an object
            options = options || {};

            var // Create the final options object
                s = jQuery.ajaxSetup( {}, options ),
            // Callbacks context
                callbackContext = s.context || s,
            // Context for global events
            // It's the callbackContext if one was provided in the options
            // and if it's a DOM node or a jQuery collection
                globalEventContext = callbackContext !== s &&
                ( callbackContext.nodeType || callbackContext instanceof jQuery ) ?
                    jQuery( callbackContext ) : jQuery.event,
            // Deferreds
                deferred = jQuery.Deferred(),
                completeDeferred = jQuery.Callbacks( "once memory" ),
            // Status-dependent callbacks
                statusCode = s.statusCode || {},
            // ifModified key
                ifModifiedKey,
            // Headers (they are sent all at once)
                requestHeaders = {},
                requestHeadersNames = {},
            // Response headers
                responseHeadersString,
                responseHeaders,
            // transport
                transport,
            // timeout handle
                timeoutTimer,
            // Cross-domain detection vars
                parts,
            // The jqXHR state
                state = 0,
            // To know if global events are to be dispatched
                fireGlobals,
            // Loop variable
                i,
            // Fake xhr
                jqXHR = {

                    readyState: 0,

                    // Caches the header
                    setRequestHeader: function( name, value ) {
                        if ( !state ) {
                            var lname = name.toLowerCase();
                            name = requestHeadersNames[ lname ] = requestHeadersNames[ lname ] || name;
                            requestHeaders[ name ] = value;
                        }
                        return this;
                    },

                    // Raw string
                    getAllResponseHeaders: function() {
                        return state === 2 ? responseHeadersString : null;
                    },

                    // Builds headers hashtable if needed
                    getResponseHeader: function( key ) {
                        var match;
                        if ( state === 2 ) {
                            if ( !responseHeaders ) {
                                responseHeaders = {};
                                while( ( match = rheaders.exec( responseHeadersString ) ) ) {
                                    responseHeaders[ match[1].toLowerCase() ] = match[ 2 ];
                                }
                            }
                            match = responseHeaders[ key.toLowerCase() ];
                        }
                        return match === undefined ? null : match;
                    },

                    // Overrides response content-type header
                    overrideMimeType: function( type ) {
                        if ( !state ) {
                            s.mimeType = type;
                        }
                        return this;
                    },

                    // Cancel the request
                    abort: function( statusText ) {
                        statusText = statusText || "abort";
                        if ( transport ) {
                            transport.abort( statusText );
                        }
                        done( 0, statusText );
                        return this;
                    }
                };

            // Callback for when everything is done
            // It is defined here because jslint complains if it is declared
            // at the end of the function (which would be more logical and readable)
            function done( status, nativeStatusText, responses, headers ) {

                // Called once
                if ( state === 2 ) {
                    return;
                }

                // State is "done" now
                state = 2;

                // Clear timeout if it exists
                if ( timeoutTimer ) {
                    clearTimeout( timeoutTimer );
                }

                // Dereference transport for early garbage collection
                // (no matter how long the jqXHR object will be used)
                transport = undefined;

                // Cache response headers
                responseHeadersString = headers || "";

                // Set readyState
                jqXHR.readyState = status > 0 ? 4 : 0;

                var isSuccess,
                    success,
                    error,
                    statusText = nativeStatusText,
                    response = responses ? ajaxHandleResponses( s, jqXHR, responses ) : undefined,
                    lastModified,
                    etag;

                // If successful, handle type chaining
                if ( status >= 200 && status < 300 || status === 304 ) {

                    // Set the If-Modified-Since and/or If-None-Match header, if in ifModified mode.
                    if ( s.ifModified ) {

                        if ( ( lastModified = jqXHR.getResponseHeader( "Last-Modified" ) ) ) {
                            jQuery.lastModified[ ifModifiedKey ] = lastModified;
                        }
                        if ( ( etag = jqXHR.getResponseHeader( "Etag" ) ) ) {
                            jQuery.etag[ ifModifiedKey ] = etag;
                        }
                    }

                    // If not modified
                    if ( status === 304 ) {

                        statusText = "notmodified";
                        isSuccess = true;

                        // If we have data
                    } else {

                        try {
                            success = ajaxConvert( s, response );
                            statusText = "success";
                            isSuccess = true;
                        } catch(e) {
                            // We have a parsererror
                            statusText = "parsererror";
                            error = e;
                        }
                    }
                } else {
                    // We extract error from statusText
                    // then normalize statusText and status for non-aborts
                    error = statusText;
                    if ( !statusText || status ) {
                        statusText = "error";
                        if ( status < 0 ) {
                            status = 0;
                        }
                    }
                }

                // Set data for the fake xhr object
                jqXHR.status = status;
                jqXHR.statusText = "" + ( nativeStatusText || statusText );

                // Success/Error
                if ( isSuccess ) {
                    deferred.resolveWith( callbackContext, [ success, statusText, jqXHR ] );
                } else {
                    deferred.rejectWith( callbackContext, [ jqXHR, statusText, error ] );
                }

                // Status-dependent callbacks
                jqXHR.statusCode( statusCode );
                statusCode = undefined;

                if ( fireGlobals ) {
                    globalEventContext.trigger( "ajax" + ( isSuccess ? "Success" : "Error" ),
                        [ jqXHR, s, isSuccess ? success : error ] );
                }

                // Complete
                completeDeferred.fireWith( callbackContext, [ jqXHR, statusText ] );

                if ( fireGlobals ) {
                    globalEventContext.trigger( "ajaxComplete", [ jqXHR, s ] );
                    // Handle the global AJAX counter
                    if ( !( --jQuery.active ) ) {
                        jQuery.event.trigger( "ajaxStop" );
                    }
                }
            }

            // Attach deferreds
            deferred.promise( jqXHR );
            jqXHR.success = jqXHR.done;
            jqXHR.error = jqXHR.fail;
            jqXHR.complete = completeDeferred.add;

            // Status-dependent callbacks
            jqXHR.statusCode = function( map ) {
                if ( map ) {
                    var tmp;
                    if ( state < 2 ) {
                        for ( tmp in map ) {
                            statusCode[ tmp ] = [ statusCode[tmp], map[tmp] ];
                        }
                    } else {
                        tmp = map[ jqXHR.status ];
                        jqXHR.then( tmp, tmp );
                    }
                }
                return this;
            };

            // Remove hash character (#7531: and string promotion)
            // Add protocol if not provided (#5866: IE7 issue with protocol-less urls)
            // We also use the url parameter if available
            s.url = ( ( url || s.url ) + "" ).replace( rhash, "" ).replace( rprotocol, ajaxLocParts[ 1 ] + "//" );

            // Extract dataTypes list
            s.dataTypes = jQuery.trim( s.dataType || "*" ).toLowerCase().split( rspacesAjax );

            // Determine if a cross-domain request is in order
            if ( s.crossDomain == null ) {
                parts = rurl.exec( s.url.toLowerCase() );
                s.crossDomain = !!( parts &&
                    ( parts[ 1 ] != ajaxLocParts[ 1 ] || parts[ 2 ] != ajaxLocParts[ 2 ] ||
                    ( parts[ 3 ] || ( parts[ 1 ] === "http:" ? 80 : 443 ) ) !=
                    ( ajaxLocParts[ 3 ] || ( ajaxLocParts[ 1 ] === "http:" ? 80 : 443 ) ) )
                );
            }

            // Convert data if not already a string
            if ( s.data && s.processData && typeof s.data !== "string" ) {
                s.data = jQuery.param( s.data, s.traditional );
            }

            // Apply prefilters
            inspectPrefiltersOrTransports( prefilters, s, options, jqXHR );

            // If request was aborted inside a prefiler, stop there
            if ( state === 2 ) {
                return false;
            }

            // We can fire global events as of now if asked to
            fireGlobals = s.global;

            // Uppercase the type
            s.type = s.type.toUpperCase();

            // Determine if request has content
            s.hasContent = !rnoContent.test( s.type );

            // Watch for a new set of requests
            if ( fireGlobals && jQuery.active++ === 0 ) {
                jQuery.event.trigger( "ajaxStart" );
            }

            // More options handling for requests with no content
            if ( !s.hasContent ) {

                // If data is available, append data to url
                if ( s.data ) {
                    s.url += ( rquery.test( s.url ) ? "&" : "?" ) + s.data;
                    // #9682: remove data so that it's not used in an eventual retry
                    delete s.data;
                }

                // Get ifModifiedKey before adding the anti-cache parameter
                ifModifiedKey = s.url;

                // Add anti-cache in url if needed
                if ( s.cache === false ) {

                    var ts = jQuery.now(),
                    // try replacing _= if it is there
                        ret = s.url.replace( rts, "$1_=" + ts );

                    // if nothing was replaced, add timestamp to the end
                    s.url = ret + ( ( ret === s.url ) ? ( rquery.test( s.url ) ? "&" : "?" ) + "_=" + ts : "" );
                }
            }

            // Set the correct header, if data is being sent
            if ( s.data && s.hasContent && s.contentType !== false || options.contentType ) {
                jqXHR.setRequestHeader( "Content-Type", s.contentType );
            }

            // Set the If-Modified-Since and/or If-None-Match header, if in ifModified mode.
            if ( s.ifModified ) {
                ifModifiedKey = ifModifiedKey || s.url;
                if ( jQuery.lastModified[ ifModifiedKey ] ) {
                    jqXHR.setRequestHeader( "If-Modified-Since", jQuery.lastModified[ ifModifiedKey ] );
                }
                if ( jQuery.etag[ ifModifiedKey ] ) {
                    jqXHR.setRequestHeader( "If-None-Match", jQuery.etag[ ifModifiedKey ] );
                }
            }

            // Set the Accepts header for the server, depending on the dataType
            jqXHR.setRequestHeader(
                "Accept",
                s.dataTypes[ 0 ] && s.accepts[ s.dataTypes[0] ] ?
                s.accepts[ s.dataTypes[0] ] + ( s.dataTypes[ 0 ] !== "*" ? ", " + allTypes + "; q=0.01" : "" ) :
                    s.accepts[ "*" ]
            );

            // Check for headers option
            for ( i in s.headers ) {
                jqXHR.setRequestHeader( i, s.headers[ i ] );
            }

            // Allow custom headers/mimetypes and early abort
            if ( s.beforeSend && ( s.beforeSend.call( callbackContext, jqXHR, s ) === false || state === 2 ) ) {
                // Abort if not done already
                jqXHR.abort();
                return false;

            }

            // Install callbacks on deferreds
            for ( i in { success: 1, error: 1, complete: 1 } ) {
                jqXHR[ i ]( s[ i ] );
            }

            // Get transport
            transport = inspectPrefiltersOrTransports( transports, s, options, jqXHR );

            // If no transport, we auto-abort
            if ( !transport ) {
                done( -1, "No Transport" );
            } else {
                jqXHR.readyState = 1;
                // Send global event
                if ( fireGlobals ) {
                    globalEventContext.trigger( "ajaxSend", [ jqXHR, s ] );
                }
                // Timeout
                if ( s.async && s.timeout > 0 ) {
                    timeoutTimer = setTimeout( function(){
                        jqXHR.abort( "timeout" );
                    }, s.timeout );
                }

                try {
                    state = 1;
                    transport.send( requestHeaders, done );
                } catch (e) {
                    // Propagate exception as error if not done
                    if ( state < 2 ) {
                        done( -1, e );
                        // Simply rethrow otherwise
                    } else {
                        throw e;
                    }
                }
            }

            return jqXHR;
        },

        // Serialize an array of form elements or a set of
        // key/values into a query string
        param: function( a, traditional ) {
            var s = [],
                add = function( key, value ) {
                    // If value is a function, invoke it and return its value
                    value = jQuery.isFunction( value ) ? value() : value;
                    s[ s.length ] = encodeURIComponent( key ) + "=" + encodeURIComponent( value );
                };

            // Set traditional to true for jQuery <= 1.3.2 behavior.
            if ( traditional === undefined ) {
                traditional = jQuery.ajaxSettings.traditional;
            }

            // If an array was passed in, assume that it is an array of form elements.
            if ( jQuery.isArray( a ) || ( a.jquery && !jQuery.isPlainObject( a ) ) ) {
                // Serialize the form elements
                jQuery.each( a, function() {
                    add( this.name, this.value );
                });

            } else {
                // If traditional, encode the "old" way (the way 1.3.2 or older
                // did it), otherwise encode params recursively.
                for ( var prefix in a ) {
                    buildParams( prefix, a[ prefix ], traditional, add );
                }
            }

            // Return the resulting serialization
            return s.join( "&" ).replace( r20, "+" );
        }
    });

    function buildParams( prefix, obj, traditional, add ) {
        if ( jQuery.isArray( obj ) ) {
            // Serialize array item.
            jQuery.each( obj, function( i, v ) {
                if ( traditional || rbracket.test( prefix ) ) {
                    // Treat each array item as a scalar.
                    add( prefix, v );

                } else {
                    // If array item is non-scalar (array or object), encode its
                    // numeric index to resolve deserialization ambiguity issues.
                    // Note that rack (as of 1.0.0) can't currently deserialize
                    // nested arrays properly, and attempting to do so may cause
                    // a server error. Possible fixes are to modify rack's
                    // deserialization algorithm or to provide an option or flag
                    // to force array serialization to be shallow.
                    buildParams( prefix + "[" + ( typeof v === "object" || jQuery.isArray(v) ? i : "" ) + "]", v, traditional, add );
                }
            });

        } else if ( !traditional && obj != null && typeof obj === "object" ) {
            // Serialize object item.
            for ( var name in obj ) {
                buildParams( prefix + "[" + name + "]", obj[ name ], traditional, add );
            }

        } else {
            // Serialize scalar item.
            add( prefix, obj );
        }
    }

// This is still on the jQuery object... for now
// Want to move this to jQuery.ajax some day
    jQuery.extend({

        // Counter for holding the number of active queries
        active: 0,

        // Last-Modified header cache for next request
        lastModified: {},
        etag: {}

    });

    /* Handles responses to an ajax request:
     * - sets all responseXXX fields accordingly
     * - finds the right dataType (mediates between content-type and expected dataType)
     * - returns the corresponding response
     */
    function ajaxHandleResponses( s, jqXHR, responses ) {

        var contents = s.contents,
            dataTypes = s.dataTypes,
            responseFields = s.responseFields,
            ct,
            type,
            finalDataType,
            firstDataType;

        // Fill responseXXX fields
        for ( type in responseFields ) {
            if ( type in responses ) {
                jqXHR[ responseFields[type] ] = responses[ type ];
            }
        }

        // Remove auto dataType and get content-type in the process
        while( dataTypes[ 0 ] === "*" ) {
            dataTypes.shift();
            if ( ct === undefined ) {
                ct = s.mimeType || jqXHR.getResponseHeader( "content-type" );
            }
        }

        // Check if we're dealing with a known content-type
        if ( ct ) {
            for ( type in contents ) {
                if ( contents[ type ] && contents[ type ].test( ct ) ) {
                    dataTypes.unshift( type );
                    break;
                }
            }
        }

        // Check to see if we have a response for the expected dataType
        if ( dataTypes[ 0 ] in responses ) {
            finalDataType = dataTypes[ 0 ];
        } else {
            // Try convertible dataTypes
            for ( type in responses ) {
                if ( !dataTypes[ 0 ] || s.converters[ type + " " + dataTypes[0] ] ) {
                    finalDataType = type;
                    break;
                }
                if ( !firstDataType ) {
                    firstDataType = type;
                }
            }
            // Or just use first one
            finalDataType = finalDataType || firstDataType;
        }

        // If we found a dataType
        // We add the dataType to the list if needed
        // and return the corresponding response
        if ( finalDataType ) {
            if ( finalDataType !== dataTypes[ 0 ] ) {
                dataTypes.unshift( finalDataType );
            }
            return responses[ finalDataType ];
        }
    }

// Chain conversions given the request and the original response
    function ajaxConvert( s, response ) {

        // Apply the dataFilter if provided
        if ( s.dataFilter ) {
            response = s.dataFilter( response, s.dataType );
        }

        var dataTypes = s.dataTypes,
            converters = {},
            i,
            key,
            length = dataTypes.length,
            tmp,
        // Current and previous dataTypes
            current = dataTypes[ 0 ],
            prev,
        // Conversion expression
            conversion,
        // Conversion function
            conv,
        // Conversion functions (transitive conversion)
            conv1,
            conv2;

        // For each dataType in the chain
        for ( i = 1; i < length; i++ ) {

            // Create converters map
            // with lowercased keys
            if ( i === 1 ) {
                for ( key in s.converters ) {
                    if ( typeof key === "string" ) {
                        converters[ key.toLowerCase() ] = s.converters[ key ];
                    }
                }
            }

            // Get the dataTypes
            prev = current;
            current = dataTypes[ i ];

            // If current is auto dataType, update it to prev
            if ( current === "*" ) {
                current = prev;
                // If no auto and dataTypes are actually different
            } else if ( prev !== "*" && prev !== current ) {

                // Get the converter
                conversion = prev + " " + current;
                conv = converters[ conversion ] || converters[ "* " + current ];

                // If there is no direct converter, search transitively
                if ( !conv ) {
                    conv2 = undefined;
                    for ( conv1 in converters ) {
                        tmp = conv1.split( " " );
                        if ( tmp[ 0 ] === prev || tmp[ 0 ] === "*" ) {
                            conv2 = converters[ tmp[1] + " " + current ];
                            if ( conv2 ) {
                                conv1 = converters[ conv1 ];
                                if ( conv1 === true ) {
                                    conv = conv2;
                                } else if ( conv2 === true ) {
                                    conv = conv1;
                                }
                                break;
                            }
                        }
                    }
                }
                // If we found no converter, dispatch an error
                if ( !( conv || conv2 ) ) {
                    jQuery.error( "No conversion from " + conversion.replace(" "," to ") );
                }
                // If found converter is not an equivalence
                if ( conv !== true ) {
                    // Convert with 1 or 2 converters accordingly
                    response = conv ? conv( response ) : conv2( conv1(response) );
                }
            }
        }
        return response;
    }




    var jsc = jQuery.now(),
        jsre = /(\=)\?(&|$)|\?\?/i;

// Default jsonp settings
    jQuery.ajaxSetup({
        jsonp: "callback",
        jsonpCallback: function() {
            return jQuery.expando + "_" + ( jsc++ );
        }
    });

// Detect, normalize options and install callbacks for jsonp requests
    jQuery.ajaxPrefilter( "json jsonp", function( s, originalSettings, jqXHR ) {

        var inspectData = s.contentType === "application/x-www-form-urlencoded" &&
            ( typeof s.data === "string" );

        if ( s.dataTypes[ 0 ] === "jsonp" ||
            s.jsonp !== false && ( jsre.test( s.url ) ||
            inspectData && jsre.test( s.data ) ) ) {

            var responseContainer,
                jsonpCallback = s.jsonpCallback =
                    jQuery.isFunction( s.jsonpCallback ) ? s.jsonpCallback() : s.jsonpCallback,
                previous = window[ jsonpCallback ],
                url = s.url,
                data = s.data,
                replace = "$1" + jsonpCallback + "$2";

            if ( s.jsonp !== false ) {
                url = url.replace( jsre, replace );
                if ( s.url === url ) {
                    if ( inspectData ) {
                        data = data.replace( jsre, replace );
                    }
                    if ( s.data === data ) {
                        // Add callback manually
                        url += (/\?/.test( url ) ? "&" : "?") + s.jsonp + "=" + jsonpCallback;
                    }
                }
            }

            s.url = url;
            s.data = data;

            // Install callback
            window[ jsonpCallback ] = function( response ) {
                responseContainer = [ response ];
            };

            // Clean-up function
            jqXHR.always(function() {
                // Set callback back to previous value
                window[ jsonpCallback ] = previous;
                // Call if it was a function and we have a response
                if ( responseContainer && jQuery.isFunction( previous ) ) {
                    window[ jsonpCallback ]( responseContainer[ 0 ] );
                }
            });

            // Use data converter to retrieve json after script execution
            s.converters["script json"] = function() {
                if ( !responseContainer ) {
                    jQuery.error( jsonpCallback + " was not called" );
                }
                return responseContainer[ 0 ];
            };

            // force json dataType
            s.dataTypes[ 0 ] = "json";

            // Delegate to script
            return "script";
        }
    });




// Install script dataType
    jQuery.ajaxSetup({
        accepts: {
            script: "text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"
        },
        contents: {
            script: /javascript|ecmascript/
        },
        converters: {
            "text script": function( text ) {
                jQuery.globalEval( text );
                return text;
            }
        }
    });

// Handle cache's special case and global
    jQuery.ajaxPrefilter( "script", function( s ) {
        if ( s.cache === undefined ) {
            s.cache = false;
        }
        if ( s.crossDomain ) {
            s.type = "GET";
            s.global = false;
        }
    });

// Bind script tag hack transport
    jQuery.ajaxTransport( "script", function(s) {

        // This transport only deals with cross domain requests
        if ( s.crossDomain ) {

            var script,
                head = document.head || document.getElementsByTagName( "head" )[0] || document.documentElement;

            return {

                send: function( _, callback ) {

                    script = document.createElement( "script" );

                    script.async = "async";

                    if ( s.scriptCharset ) {
                        script.charset = s.scriptCharset;
                    }

                    script.src = s.url;

                    // Attach handlers for all browsers
                    script.onload = script.onreadystatechange = function( _, isAbort ) {

                        if ( isAbort || !script.readyState || /loaded|complete/.test( script.readyState ) ) {

                            // Handle memory leak in IE
                            script.onload = script.onreadystatechange = null;

                            // Remove the script
                            if ( head && script.parentNode ) {
                                head.removeChild( script );
                            }

                            // Dereference the script
                            script = undefined;

                            // Callback if not abort
                            if ( !isAbort ) {
                                callback( 200, "success" );
                            }
                        }
                    };
                    // Use insertBefore instead of appendChild  to circumvent an IE6 bug.
                    // This arises when a base node is used (#2709 and #4378).
                    head.insertBefore( script, head.firstChild );
                },

                abort: function() {
                    if ( script ) {
                        script.onload( 0, 1 );
                    }
                }
            };
        }
    });




    var // #5280: Internet Explorer will keep connections alive if we don't abort on unload
        xhrOnUnloadAbort = window.ActiveXObject ? function() {
            // Abort all pending requests
            for ( var key in xhrCallbacks ) {
                xhrCallbacks[ key ]( 0, 1 );
            }
        } : false,
        xhrId = 0,
        xhrCallbacks;

// Functions to create xhrs
    function createStandardXHR() {
        try {
            return new window.XMLHttpRequest();
        } catch( e ) {}
    }

    function createActiveXHR() {
        try {
            return new window.ActiveXObject( "Microsoft.XMLHTTP" );
        } catch( e ) {}
    }

// Create the request object
// (This is still attached to ajaxSettings for backward compatibility)
    jQuery.ajaxSettings.xhr = window.ActiveXObject ?
        /* Microsoft failed to properly
         * implement the XMLHttpRequest in IE7 (can't request local files),
         * so we use the ActiveXObject when it is available
         * Additionally XMLHttpRequest can be disabled in IE7/IE8 so
         * we need a fallback.
         */
        function() {
            return !this.isLocal && createStandardXHR() || createActiveXHR();
        } :
        // For all other browsers, use the standard XMLHttpRequest object
        createStandardXHR;

// Determine support properties
    (function( xhr ) {
        jQuery.extend( jQuery.support, {
            ajax: !!xhr,
            cors: !!xhr && ( "withCredentials" in xhr )
        });
    })( jQuery.ajaxSettings.xhr() );

// Create transport if the browser can provide an xhr
    if ( jQuery.support.ajax ) {

        jQuery.ajaxTransport(function( s ) {
            // Cross domain only allowed if supported through XMLHttpRequest
            if ( !s.crossDomain || jQuery.support.cors ) {

                var callback;

                return {
                    send: function( headers, complete ) {

                        // Get a new xhr
                        var xhr = s.xhr(),
                            handle,
                            i;

                        // Open the socket
                        // Passing null username, generates a login popup on Opera (#2865)
                        if ( s.username ) {
                            xhr.open( s.type, s.url, s.async, s.username, s.password );
                        } else {
                            xhr.open( s.type, s.url, s.async );
                        }

                        // Apply custom fields if provided
                        if ( s.xhrFields ) {
                            for ( i in s.xhrFields ) {
                                xhr[ i ] = s.xhrFields[ i ];
                            }
                        }

                        // Override mime type if needed
                        if ( s.mimeType && xhr.overrideMimeType ) {
                            xhr.overrideMimeType( s.mimeType );
                        }

                        // X-Requested-With header
                        // For cross-domain requests, seeing as conditions for a preflight are
                        // akin to a jigsaw puzzle, we simply never set it to be sure.
                        // (it can always be set on a per-request basis or even using ajaxSetup)
                        // For same-domain requests, won't change header if already provided.
                        if ( !s.crossDomain && !headers["X-Requested-With"] ) {
                            headers[ "X-Requested-With" ] = "XMLHttpRequest";
                        }

                        // Need an extra try/catch for cross domain requests in Firefox 3
                        try {
                            for ( i in headers ) {
                                xhr.setRequestHeader( i, headers[ i ] );
                            }
                        } catch( _ ) {}

                        // Do send the request
                        // This may raise an exception which is actually
                        // handled in jQuery.ajax (so no try/catch here)
                        xhr.send( ( s.hasContent && s.data ) || null );

                        // Listener
                        callback = function( _, isAbort ) {

                            var status,
                                statusText,
                                responseHeaders,
                                responses,
                                xml;

                            // Firefox throws exceptions when accessing properties
                            // of an xhr when a network error occured
                            // http://helpful.knobs-dials.com/index.php/Component_returned_failure_code:_0x80040111_(NS_ERROR_NOT_AVAILABLE)
                            try {

                                // Was never called and is aborted or complete
                                if ( callback && ( isAbort || xhr.readyState === 4 ) ) {

                                    // Only called once
                                    callback = undefined;

                                    // Do not keep as active anymore
                                    if ( handle ) {
                                        xhr.onreadystatechange = jQuery.noop;
                                        if ( xhrOnUnloadAbort ) {
                                            delete xhrCallbacks[ handle ];
                                        }
                                    }

                                    // If it's an abort
                                    if ( isAbort ) {
                                        // Abort it manually if needed
                                        if ( xhr.readyState !== 4 ) {
                                            xhr.abort();
                                        }
                                    } else {
                                        status = xhr.status;
                                        responseHeaders = xhr.getAllResponseHeaders();
                                        responses = {};
                                        xml = xhr.responseXML;

                                        // Construct response list
                                        if ( xml && xml.documentElement /* #4958 */ ) {
                                            responses.xml = xml;
                                        }
                                        responses.text = xhr.responseText;

                                        // Firefox throws an exception when accessing
                                        // statusText for faulty cross-domain requests
                                        try {
                                            statusText = xhr.statusText;
                                        } catch( e ) {
                                            // We normalize with Webkit giving an empty statusText
                                            statusText = "";
                                        }

                                        // Filter status for non standard behaviors

                                        // If the request is local and we have data: assume a success
                                        // (success with no data won't get notified, that's the best we
                                        // can do given current implementations)
                                        if ( !status && s.isLocal && !s.crossDomain ) {
                                            status = responses.text ? 200 : 404;
                                            // IE - #1450: sometimes returns 1223 when it should be 204
                                        } else if ( status === 1223 ) {
                                            status = 204;
                                        }
                                    }
                                }
                            } catch( firefoxAccessException ) {
                                if ( !isAbort ) {
                                    complete( -1, firefoxAccessException );
                                }
                            }

                            // Call complete if needed
                            if ( responses ) {
                                complete( status, statusText, responses, responseHeaders );
                            }
                        };

                        // if we're in sync mode or it's in cache
                        // and has been retrieved directly (IE6 & IE7)
                        // we need to manually fire the callback
                        if ( !s.async || xhr.readyState === 4 ) {
                            callback();
                        } else {
                            handle = ++xhrId;
                            if ( xhrOnUnloadAbort ) {
                                // Create the active xhrs callbacks list if needed
                                // and attach the unload handler
                                if ( !xhrCallbacks ) {
                                    xhrCallbacks = {};
                                    jQuery( window ).unload( xhrOnUnloadAbort );
                                }
                                // Add to list of active xhrs callbacks
                                xhrCallbacks[ handle ] = callback;
                            }
                            xhr.onreadystatechange = callback;
                        }
                    },

                    abort: function() {
                        if ( callback ) {
                            callback(0,1);
                        }
                    }
                };
            }
        });
    }




    var elemdisplay = {},
        iframe, iframeDoc,
        rfxtypes = /^(?:toggle|show|hide)$/,
        rfxnum = /^([+\-]=)?([\d+.\-]+)([a-z%]*)$/i,
        timerId,
        fxAttrs = [
            // height animations
            [ "height", "marginTop", "marginBottom", "paddingTop", "paddingBottom" ],
            // width animations
            [ "width", "marginLeft", "marginRight", "paddingLeft", "paddingRight" ],
            // opacity animations
            [ "opacity" ]
        ],
        fxNow;

    jQuery.fn.extend({
        show: function( speed, easing, callback ) {
            var elem, display;

            if ( speed || speed === 0 ) {
                return this.animate( genFx("show", 3), speed, easing, callback );

            } else {
                for ( var i = 0, j = this.length; i < j; i++ ) {
                    elem = this[ i ];

                    if ( elem.style ) {
                        display = elem.style.display;

                        // Reset the inline display of this element to learn if it is
                        // being hidden by cascaded rules or not
                        if ( !jQuery._data(elem, "olddisplay") && display === "none" ) {
                            display = elem.style.display = "";
                        }

                        // Set elements which have been overridden with display: none
                        // in a stylesheet to whatever the default browser style is
                        // for such an element
                        if ( display === "" && jQuery.css(elem, "display") === "none" ) {
                            jQuery._data( elem, "olddisplay", defaultDisplay(elem.nodeName) );
                        }
                    }
                }

                // Set the display of most of the elements in a second loop
                // to avoid the constant reflow
                for ( i = 0; i < j; i++ ) {
                    elem = this[ i ];

                    if ( elem.style ) {
                        display = elem.style.display;

                        if ( display === "" || display === "none" ) {
                            elem.style.display = jQuery._data( elem, "olddisplay" ) || "";
                        }
                    }
                }

                return this;
            }
        },

        hide: function( speed, easing, callback ) {
            if ( speed || speed === 0 ) {
                return this.animate( genFx("hide", 3), speed, easing, callback);

            } else {
                var elem, display,
                    i = 0,
                    j = this.length;

                for ( ; i < j; i++ ) {
                    elem = this[i];
                    if ( elem.style ) {
                        display = jQuery.css( elem, "display" );

                        if ( display !== "none" && !jQuery._data( elem, "olddisplay" ) ) {
                            jQuery._data( elem, "olddisplay", display );
                        }
                    }
                }

                // Set the display of the elements in a second loop
                // to avoid the constant reflow
                for ( i = 0; i < j; i++ ) {
                    if ( this[i].style ) {
                        this[i].style.display = "none";
                    }
                }

                return this;
            }
        },

        // Save the old toggle function
        _toggle: jQuery.fn.toggle,

        toggle: function( fn, fn2, callback ) {
            var bool = typeof fn === "boolean";

            if ( jQuery.isFunction(fn) && jQuery.isFunction(fn2) ) {
                this._toggle.apply( this, arguments );

            } else if ( fn == null || bool ) {
                this.each(function() {
                    var state = bool ? fn : jQuery(this).is(":hidden");
                    jQuery(this)[ state ? "show" : "hide" ]();
                });

            } else {
                this.animate(genFx("toggle", 3), fn, fn2, callback);
            }

            return this;
        },

        fadeTo: function( speed, to, easing, callback ) {
            return this.filter(":hidden").css("opacity", 0).show().end()
                .animate({opacity: to}, speed, easing, callback);
        },

        animate: function( prop, speed, easing, callback ) {
            var optall = jQuery.speed( speed, easing, callback );

            if ( jQuery.isEmptyObject( prop ) ) {
                return this.each( optall.complete, [ false ] );
            }

            // Do not change referenced properties as per-property easing will be lost
            prop = jQuery.extend( {}, prop );

            function doAnimation() {
                // XXX 'this' does not always have a nodeName when running the
                // test suite

                if ( optall.queue === false ) {
                    jQuery._mark( this );
                }

                var opt = jQuery.extend( {}, optall ),
                    isElement = this.nodeType === 1,
                    hidden = isElement && jQuery(this).is(":hidden"),
                    name, val, p, e,
                    parts, start, end, unit,
                    method;

                // will store per property easing and be used to determine when an animation is complete
                opt.animatedProperties = {};

                for ( p in prop ) {

                    // property name normalization
                    name = jQuery.camelCase( p );
                    if ( p !== name ) {
                        prop[ name ] = prop[ p ];
                        delete prop[ p ];
                    }

                    val = prop[ name ];

                    // easing resolution: per property > opt.specialEasing > opt.easing > 'swing' (default)
                    if ( jQuery.isArray( val ) ) {
                        opt.animatedProperties[ name ] = val[ 1 ];
                        val = prop[ name ] = val[ 0 ];
                    } else {
                        opt.animatedProperties[ name ] = opt.specialEasing && opt.specialEasing[ name ] || opt.easing || 'swing';
                    }

                    if ( val === "hide" && hidden || val === "show" && !hidden ) {
                        return opt.complete.call( this );
                    }

                    if ( isElement && ( name === "height" || name === "width" ) ) {
                        // Make sure that nothing sneaks out
                        // Record all 3 overflow attributes because IE does not
                        // change the overflow attribute when overflowX and
                        // overflowY are set to the same value
                        opt.overflow = [ this.style.overflow, this.style.overflowX, this.style.overflowY ];

                        // Set display property to inline-block for height/width
                        // animations on inline elements that are having width/height animated
                        if ( jQuery.css( this, "display" ) === "inline" &&
                            jQuery.css( this, "float" ) === "none" ) {

                            // inline-level elements accept inline-block;
                            // block-level elements need to be inline with layout
                            if ( !jQuery.support.inlineBlockNeedsLayout || defaultDisplay( this.nodeName ) === "inline" ) {
                                this.style.display = "inline-block";

                            } else {
                                this.style.zoom = 1;
                            }
                        }
                    }
                }

                if ( opt.overflow != null ) {
                    this.style.overflow = "hidden";
                }

                for ( p in prop ) {
                    e = new jQuery.fx( this, opt, p );
                    val = prop[ p ];

                    if ( rfxtypes.test( val ) ) {

                        // Tracks whether to show or hide based on private
                        // data attached to the element
                        method = jQuery._data( this, "toggle" + p ) || ( val === "toggle" ? hidden ? "show" : "hide" : 0 );
                        if ( method ) {
                            jQuery._data( this, "toggle" + p, method === "show" ? "hide" : "show" );
                            e[ method ]();
                        } else {
                            e[ val ]();
                        }

                    } else {
                        parts = rfxnum.exec( val );
                        start = e.cur();

                        if ( parts ) {
                            end = parseFloat( parts[2] );
                            unit = parts[3] || ( jQuery.cssNumber[ p ] ? "" : "px" );

                            // We need to compute starting value
                            if ( unit !== "px" ) {
                                jQuery.style( this, p, (end || 1) + unit);
                                start = ( (end || 1) / e.cur() ) * start;
                                jQuery.style( this, p, start + unit);
                            }

                            // If a +=/-= token was provided, we're doing a relative animation
                            if ( parts[1] ) {
                                end = ( (parts[ 1 ] === "-=" ? -1 : 1) * end ) + start;
                            }

                            e.custom( start, end, unit );

                        } else {
                            e.custom( start, val, "" );
                        }
                    }
                }

                // For JS strict compliance
                return true;
            }

            return optall.queue === false ?
                this.each( doAnimation ) :
                this.queue( optall.queue, doAnimation );
        },

        stop: function( type, clearQueue, gotoEnd ) {
            if ( typeof type !== "string" ) {
                gotoEnd = clearQueue;
                clearQueue = type;
                type = undefined;
            }
            if ( clearQueue && type !== false ) {
                this.queue( type || "fx", [] );
            }

            return this.each(function() {
                var index,
                    hadTimers = false,
                    timers = jQuery.timers,
                    data = jQuery._data( this );

                // clear marker counters if we know they won't be
                if ( !gotoEnd ) {
                    jQuery._unmark( true, this );
                }

                function stopQueue( elem, data, index ) {
                    var hooks = data[ index ];
                    jQuery.removeData( elem, index, true );
                    hooks.stop( gotoEnd );
                }

                if ( type == null ) {
                    for ( index in data ) {
                        if ( data[ index ] && data[ index ].stop && index.indexOf(".run") === index.length - 4 ) {
                            stopQueue( this, data, index );
                        }
                    }
                } else if ( data[ index = type + ".run" ] && data[ index ].stop ){
                    stopQueue( this, data, index );
                }

                for ( index = timers.length; index--; ) {
                    if ( timers[ index ].elem === this && (type == null || timers[ index ].queue === type) ) {
                        if ( gotoEnd ) {

                            // force the next step to be the last
                            timers[ index ]( true );
                        } else {
                            timers[ index ].saveState();
                        }
                        hadTimers = true;
                        timers.splice( index, 1 );
                    }
                }

                // start the next in the queue if the last step wasn't forced
                // timers currently will call their complete callbacks, which will dequeue
                // but only if they were gotoEnd
                if ( !( gotoEnd && hadTimers ) ) {
                    jQuery.dequeue( this, type );
                }
            });
        }

    });

// Animations created synchronously will run synchronously
    function createFxNow() {
        setTimeout( clearFxNow, 0 );
        return ( fxNow = jQuery.now() );
    }

    function clearFxNow() {
        fxNow = undefined;
    }

// Generate parameters to create a standard animation
    function genFx( type, num ) {
        var obj = {};

        jQuery.each( fxAttrs.concat.apply([], fxAttrs.slice( 0, num )), function() {
            obj[ this ] = type;
        });

        return obj;
    }

// Generate shortcuts for custom animations
    jQuery.each({
        slideDown: genFx( "show", 1 ),
        slideUp: genFx( "hide", 1 ),
        slideToggle: genFx( "toggle", 1 ),
        fadeIn: { opacity: "show" },
        fadeOut: { opacity: "hide" },
        fadeToggle: { opacity: "toggle" }
    }, function( name, props ) {
        jQuery.fn[ name ] = function( speed, easing, callback ) {
            return this.animate( props, speed, easing, callback );
        };
    });

    jQuery.extend({
        speed: function( speed, easing, fn ) {
            var opt = speed && typeof speed === "object" ? jQuery.extend( {}, speed ) : {
                complete: fn || !fn && easing ||
                jQuery.isFunction( speed ) && speed,
                duration: speed,
                easing: fn && easing || easing && !jQuery.isFunction( easing ) && easing
            };

            opt.duration = jQuery.fx.off ? 0 : typeof opt.duration === "number" ? opt.duration :
                opt.duration in jQuery.fx.speeds ? jQuery.fx.speeds[ opt.duration ] : jQuery.fx.speeds._default;

            // normalize opt.queue - true/undefined/null -> "fx"
            if ( opt.queue == null || opt.queue === true ) {
                opt.queue = "fx";
            }

            // Queueing
            opt.old = opt.complete;

            opt.complete = function( noUnmark ) {
                if ( jQuery.isFunction( opt.old ) ) {
                    opt.old.call( this );
                }

                if ( opt.queue ) {
                    jQuery.dequeue( this, opt.queue );
                } else if ( noUnmark !== false ) {
                    jQuery._unmark( this );
                }
            };

            return opt;
        },

        easing: {
            linear: function( p, n, firstNum, diff ) {
                return firstNum + diff * p;
            },
            swing: function( p, n, firstNum, diff ) {
                return ( ( -Math.cos( p*Math.PI ) / 2 ) + 0.5 ) * diff + firstNum;
            }
        },

        timers: [],

        fx: function( elem, options, prop ) {
            this.options = options;
            this.elem = elem;
            this.prop = prop;

            options.orig = options.orig || {};
        }

    });

    jQuery.fx.prototype = {
        // Simple function for setting a style value
        update: function() {
            if ( this.options.step ) {
                this.options.step.call( this.elem, this.now, this );
            }

            ( jQuery.fx.step[ this.prop ] || jQuery.fx.step._default )( this );
        },

        // Get the current size
        cur: function() {
            if ( this.elem[ this.prop ] != null && (!this.elem.style || this.elem.style[ this.prop ] == null) ) {
                return this.elem[ this.prop ];
            }

            var parsed,
                r = jQuery.css( this.elem, this.prop );
            // Empty strings, null, undefined and "auto" are converted to 0,
            // complex values such as "rotate(1rad)" are returned as is,
            // simple values such as "10px" are parsed to Float.
            return isNaN( parsed = parseFloat( r ) ) ? !r || r === "auto" ? 0 : r : parsed;
        },

        // Start an animation from one number to another
        custom: function( from, to, unit ) {
            var self = this,
                fx = jQuery.fx;

            this.startTime = fxNow || createFxNow();
            this.end = to;
            this.now = this.start = from;
            this.pos = this.state = 0;
            this.unit = unit || this.unit || ( jQuery.cssNumber[ this.prop ] ? "" : "px" );

            function t( gotoEnd ) {
                return self.step( gotoEnd );
            }

            t.queue = this.options.queue;
            t.elem = this.elem;
            t.saveState = function() {
                if ( self.options.hide && jQuery._data( self.elem, "fxshow" + self.prop ) === undefined ) {
                    jQuery._data( self.elem, "fxshow" + self.prop, self.start );
                }
            };

            if ( t() && jQuery.timers.push(t) && !timerId ) {
                timerId = setInterval( fx.tick, fx.interval );
            }
        },

        // Simple 'show' function
        show: function() {
            var dataShow = jQuery._data( this.elem, "fxshow" + this.prop );

            // Remember where we started, so that we can go back to it later
            this.options.orig[ this.prop ] = dataShow || jQuery.style( this.elem, this.prop );
            this.options.show = true;

            // Begin the animation
            // Make sure that we start at a small width/height to avoid any flash of content
            if ( dataShow !== undefined ) {
                // This show is picking up where a previous hide or show left off
                this.custom( this.cur(), dataShow );
            } else {
                this.custom( this.prop === "width" || this.prop === "height" ? 1 : 0, this.cur() );
            }

            // Start by showing the element
            jQuery( this.elem ).show();
        },

        // Simple 'hide' function
        hide: function() {
            // Remember where we started, so that we can go back to it later
            this.options.orig[ this.prop ] = jQuery._data( this.elem, "fxshow" + this.prop ) || jQuery.style( this.elem, this.prop );
            this.options.hide = true;

            // Begin the animation
            this.custom( this.cur(), 0 );
        },

        // Each step of an animation
        step: function( gotoEnd ) {
            var p, n, complete,
                t = fxNow || createFxNow(),
                done = true,
                elem = this.elem,
                options = this.options;

            if ( gotoEnd || t >= options.duration + this.startTime ) {
                this.now = this.end;
                this.pos = this.state = 1;
                this.update();

                options.animatedProperties[ this.prop ] = true;

                for ( p in options.animatedProperties ) {
                    if ( options.animatedProperties[ p ] !== true ) {
                        done = false;
                    }
                }

                if ( done ) {
                    // Reset the overflow
                    if ( options.overflow != null && !jQuery.support.shrinkWrapBlocks ) {

                        jQuery.each( [ "", "X", "Y" ], function( index, value ) {
                            elem.style[ "overflow" + value ] = options.overflow[ index ];
                        });
                    }

                    // Hide the element if the "hide" operation was done
                    if ( options.hide ) {
                        jQuery( elem ).hide();
                    }

                    // Reset the properties, if the item has been hidden or shown
                    if ( options.hide || options.show ) {
                        for ( p in options.animatedProperties ) {
                            jQuery.style( elem, p, options.orig[ p ] );
                            jQuery.removeData( elem, "fxshow" + p, true );
                            // Toggle data is no longer needed
                            jQuery.removeData( elem, "toggle" + p, true );
                        }
                    }

                    // Execute the complete function
                    // in the event that the complete function throws an exception
                    // we must ensure it won't be called twice. #5684

                    complete = options.complete;
                    if ( complete ) {

                        options.complete = false;
                        complete.call( elem );
                    }
                }

                return false;

            } else {
                // classical easing cannot be used with an Infinity duration
                if ( options.duration == Infinity ) {
                    this.now = t;
                } else {
                    n = t - this.startTime;
                    this.state = n / options.duration;

                    // Perform the easing function, defaults to swing
                    this.pos = jQuery.easing[ options.animatedProperties[this.prop] ]( this.state, n, 0, 1, options.duration );
                    this.now = this.start + ( (this.end - this.start) * this.pos );
                }
                // Perform the next step of the animation
                this.update();
            }

            return true;
        }
    };

    jQuery.extend( jQuery.fx, {
        tick: function() {
            var timer,
                timers = jQuery.timers,
                i = 0;

            for ( ; i < timers.length; i++ ) {
                timer = timers[ i ];
                // Checks the timer has not already been removed
                if ( !timer() && timers[ i ] === timer ) {
                    timers.splice( i--, 1 );
                }
            }

            if ( !timers.length ) {
                jQuery.fx.stop();
            }
        },

        interval: 13,

        stop: function() {
            clearInterval( timerId );
            timerId = null;
        },

        speeds: {
            slow: 600,
            fast: 200,
            // Default speed
            _default: 400
        },

        step: {
            opacity: function( fx ) {
                jQuery.style( fx.elem, "opacity", fx.now );
            },

            _default: function( fx ) {
                if ( fx.elem.style && fx.elem.style[ fx.prop ] != null ) {
                    fx.elem.style[ fx.prop ] = fx.now + fx.unit;
                } else {
                    fx.elem[ fx.prop ] = fx.now;
                }
            }
        }
    });

// Adds width/height step functions
// Do not set anything below 0
    jQuery.each([ "width", "height" ], function( i, prop ) {
        jQuery.fx.step[ prop ] = function( fx ) {
            jQuery.style( fx.elem, prop, Math.max(0, fx.now) + fx.unit );
        };
    });

    if ( jQuery.expr && jQuery.expr.filters ) {
        jQuery.expr.filters.animated = function( elem ) {
            return jQuery.grep(jQuery.timers, function( fn ) {
                return elem === fn.elem;
            }).length;
        };
    }

// Try to restore the default display value of an element
    function defaultDisplay( nodeName ) {

        if ( !elemdisplay[ nodeName ] ) {

            var body = document.body,
                elem = jQuery( "<" + nodeName + ">" ).appendTo( body ),
                display = elem.css( "display" );
            elem.remove();

            // If the simple way fails,
            // get element's real default display by attaching it to a temp iframe
            if ( display === "none" || display === "" ) {
                // No iframe to use yet, so create it
                if ( !iframe ) {
                    iframe = document.createElement( "iframe" );
                    iframe.frameBorder = iframe.width = iframe.height = 0;
                }

                body.appendChild( iframe );

                // Create a cacheable copy of the iframe document on first call.
                // IE and Opera will allow us to reuse the iframeDoc without re-writing the fake HTML
                // document to it; WebKit & Firefox won't allow reusing the iframe document.
                if ( !iframeDoc || !iframe.createElement ) {
                    iframeDoc = ( iframe.contentWindow || iframe.contentDocument ).document;
                    iframeDoc.write( ( document.compatMode === "CSS1Compat" ? "<!doctype html>" : "" ) + "<html><body>" );
                    iframeDoc.close();
                }

                elem = iframeDoc.createElement( nodeName );

                iframeDoc.body.appendChild( elem );

                display = jQuery.css( elem, "display" );
                body.removeChild( iframe );
            }

            // Store the correct default display
            elemdisplay[ nodeName ] = display;
        }

        return elemdisplay[ nodeName ];
    }




    var rtable = /^t(?:able|d|h)$/i,
        rroot = /^(?:body|html)$/i;

    if ( "getBoundingClientRect" in document.documentElement ) {
        jQuery.fn.offset = function( options ) {
            var elem = this[0], box;

            if ( options ) {
                return this.each(function( i ) {
                    jQuery.offset.setOffset( this, options, i );
                });
            }

            if ( !elem || !elem.ownerDocument ) {
                return null;
            }

            if ( elem === elem.ownerDocument.body ) {
                return jQuery.offset.bodyOffset( elem );
            }

            try {
                box = elem.getBoundingClientRect();
            } catch(e) {}

            var doc = elem.ownerDocument,
                docElem = doc.documentElement;

            // Make sure we're not dealing with a disconnected DOM node
            if ( !box || !jQuery.contains( docElem, elem ) ) {
                return box ? { top: box.top, left: box.left } : { top: 0, left: 0 };
            }

            var body = doc.body,
                win = getWindow(doc),
                clientTop  = docElem.clientTop  || body.clientTop  || 0,
                clientLeft = docElem.clientLeft || body.clientLeft || 0,
                scrollTop  = win.pageYOffset || jQuery.support.boxModel && docElem.scrollTop  || body.scrollTop,
                scrollLeft = win.pageXOffset || jQuery.support.boxModel && docElem.scrollLeft || body.scrollLeft,
                top  = box.top  + scrollTop  - clientTop,
                left = box.left + scrollLeft - clientLeft;

            return { top: top, left: left };
        };

    } else {
        jQuery.fn.offset = function( options ) {
            var elem = this[0];

            if ( options ) {
                return this.each(function( i ) {
                    jQuery.offset.setOffset( this, options, i );
                });
            }

            if ( !elem || !elem.ownerDocument ) {
                return null;
            }

            if ( elem === elem.ownerDocument.body ) {
                return jQuery.offset.bodyOffset( elem );
            }

            var computedStyle,
                offsetParent = elem.offsetParent,
                prevOffsetParent = elem,
                doc = elem.ownerDocument,
                docElem = doc.documentElement,
                body = doc.body,
                defaultView = doc.defaultView,
                prevComputedStyle = defaultView ? defaultView.getComputedStyle( elem, null ) : elem.currentStyle,
                top = elem.offsetTop,
                left = elem.offsetLeft;

            while ( (elem = elem.parentNode) && elem !== body && elem !== docElem ) {
                if ( jQuery.support.fixedPosition && prevComputedStyle.position === "fixed" ) {
                    break;
                }

                computedStyle = defaultView ? defaultView.getComputedStyle(elem, null) : elem.currentStyle;
                top  -= elem.scrollTop;
                left -= elem.scrollLeft;

                if ( elem === offsetParent ) {
                    top  += elem.offsetTop;
                    left += elem.offsetLeft;

                    if ( jQuery.support.doesNotAddBorder && !(jQuery.support.doesAddBorderForTableAndCells && rtable.test(elem.nodeName)) ) {
                        top  += parseFloat( computedStyle.borderTopWidth  ) || 0;
                        left += parseFloat( computedStyle.borderLeftWidth ) || 0;
                    }

                    prevOffsetParent = offsetParent;
                    offsetParent = elem.offsetParent;
                }

                if ( jQuery.support.subtractsBorderForOverflowNotVisible && computedStyle.overflow !== "visible" ) {
                    top  += parseFloat( computedStyle.borderTopWidth  ) || 0;
                    left += parseFloat( computedStyle.borderLeftWidth ) || 0;
                }

                prevComputedStyle = computedStyle;
            }

            if ( prevComputedStyle.position === "relative" || prevComputedStyle.position === "static" ) {
                top  += body.offsetTop;
                left += body.offsetLeft;
            }

            if ( jQuery.support.fixedPosition && prevComputedStyle.position === "fixed" ) {
                top  += Math.max( docElem.scrollTop, body.scrollTop );
                left += Math.max( docElem.scrollLeft, body.scrollLeft );
            }

            return { top: top, left: left };
        };
    }

    jQuery.offset = {

        bodyOffset: function( body ) {
            var top = body.offsetTop,
                left = body.offsetLeft;

            if ( jQuery.support.doesNotIncludeMarginInBodyOffset ) {
                top  += parseFloat( jQuery.css(body, "marginTop") ) || 0;
                left += parseFloat( jQuery.css(body, "marginLeft") ) || 0;
            }

            return { top: top, left: left };
        },

        setOffset: function( elem, options, i ) {
            var position = jQuery.css( elem, "position" );

            // set position first, in-case top/left are set even on static elem
            if ( position === "static" ) {
                elem.style.position = "relative";
            }

            var curElem = jQuery( elem ),
                curOffset = curElem.offset(),
                curCSSTop = jQuery.css( elem, "top" ),
                curCSSLeft = jQuery.css( elem, "left" ),
                calculatePosition = ( position === "absolute" || position === "fixed" ) && jQuery.inArray("auto", [curCSSTop, curCSSLeft]) > -1,
                props = {}, curPosition = {}, curTop, curLeft;

            // need to be able to calculate position if either top or left is auto and position is either absolute or fixed
            if ( calculatePosition ) {
                curPosition = curElem.position();
                curTop = curPosition.top;
                curLeft = curPosition.left;
            } else {
                curTop = parseFloat( curCSSTop ) || 0;
                curLeft = parseFloat( curCSSLeft ) || 0;
            }

            if ( jQuery.isFunction( options ) ) {
                options = options.call( elem, i, curOffset );
            }

            if ( options.top != null ) {
                props.top = ( options.top - curOffset.top ) + curTop;
            }
            if ( options.left != null ) {
                props.left = ( options.left - curOffset.left ) + curLeft;
            }

            if ( "using" in options ) {
                options.using.call( elem, props );
            } else {
                curElem.css( props );
            }
        }
    };


    jQuery.fn.extend({

        position: function() {
            if ( !this[0] ) {
                return null;
            }

            var elem = this[0],

            // Get *real* offsetParent
                offsetParent = this.offsetParent(),

            // Get correct offsets
                offset       = this.offset(),
                parentOffset = rroot.test(offsetParent[0].nodeName) ? { top: 0, left: 0 } : offsetParent.offset();

            // Subtract element margins
            // note: when an element has margin: auto the offsetLeft and marginLeft
            // are the same in Safari causing offset.left to incorrectly be 0
            offset.top  -= parseFloat( jQuery.css(elem, "marginTop") ) || 0;
            offset.left -= parseFloat( jQuery.css(elem, "marginLeft") ) || 0;

            // Add offsetParent borders
            parentOffset.top  += parseFloat( jQuery.css(offsetParent[0], "borderTopWidth") ) || 0;
            parentOffset.left += parseFloat( jQuery.css(offsetParent[0], "borderLeftWidth") ) || 0;

            // Subtract the two offsets
            return {
                top:  offset.top  - parentOffset.top,
                left: offset.left - parentOffset.left
            };
        },

        offsetParent: function() {
            return this.map(function() {
                var offsetParent = this.offsetParent || document.body;
                while ( offsetParent && (!rroot.test(offsetParent.nodeName) && jQuery.css(offsetParent, "position") === "static") ) {
                    offsetParent = offsetParent.offsetParent;
                }
                return offsetParent;
            });
        }
    });


// Create scrollLeft and scrollTop methods
    jQuery.each( ["Left", "Top"], function( i, name ) {
        var method = "scroll" + name;

        jQuery.fn[ method ] = function( val ) {
            var elem, win;

            if ( val === undefined ) {
                elem = this[ 0 ];

                if ( !elem ) {
                    return null;
                }

                win = getWindow( elem );

                // Return the scroll offset
                return win ? ("pageXOffset" in win) ? win[ i ? "pageYOffset" : "pageXOffset" ] :
                jQuery.support.boxModel && win.document.documentElement[ method ] ||
                win.document.body[ method ] :
                    elem[ method ];
            }

            // Set the scroll offset
            return this.each(function() {
                win = getWindow( this );

                if ( win ) {
                    win.scrollTo(
                        !i ? val : jQuery( win ).scrollLeft(),
                        i ? val : jQuery( win ).scrollTop()
                    );

                } else {
                    this[ method ] = val;
                }
            });
        };
    });

    function getWindow( elem ) {
        return jQuery.isWindow( elem ) ?
            elem :
            elem.nodeType === 9 ?
            elem.defaultView || elem.parentWindow :
                false;
    }




// Create width, height, innerHeight, innerWidth, outerHeight and outerWidth methods
    jQuery.each([ "Height", "Width" ], function( i, name ) {

        var type = name.toLowerCase();

        // innerHeight and innerWidth
        jQuery.fn[ "inner" + name ] = function() {
            var elem = this[0];
            return elem ?
                elem.style ?
                    parseFloat( jQuery.css( elem, type, "padding" ) ) :
                    this[ type ]() :
                null;
        };

        // outerHeight and outerWidth
        jQuery.fn[ "outer" + name ] = function( margin ) {
            var elem = this[0];
            return elem ?
                elem.style ?
                    parseFloat( jQuery.css( elem, type, margin ? "margin" : "border" ) ) :
                    this[ type ]() :
                null;
        };

        jQuery.fn[ type ] = function( size ) {
            // Get window width or height
            var elem = this[0];
            if ( !elem ) {
                return size == null ? null : this;
            }

            if ( jQuery.isFunction( size ) ) {
                return this.each(function( i ) {
                    var self = jQuery( this );
                    self[ type ]( size.call( this, i, self[ type ]() ) );
                });
            }

            if ( jQuery.isWindow( elem ) ) {
                // Everyone else use document.documentElement or document.body depending on Quirks vs Standards mode
                // 3rd condition allows Nokia support, as it supports the docElem prop but not CSS1Compat
                var docElemProp = elem.document.documentElement[ "client" + name ],
                    body = elem.document.body;
                return elem.document.compatMode === "CSS1Compat" && docElemProp ||
                    body && body[ "client" + name ] || docElemProp;

                // Get document width or height
            } else if ( elem.nodeType === 9 ) {
                // Either scroll[Width/Height] or offset[Width/Height], whichever is greater
                return Math.max(
                    elem.documentElement["client" + name],
                    elem.body["scroll" + name], elem.documentElement["scroll" + name],
                    elem.body["offset" + name], elem.documentElement["offset" + name]
                );

                // Get or set width or height on the element
            } else if ( size === undefined ) {
                var orig = jQuery.css( elem, type ),
                    ret = parseFloat( orig );

                return jQuery.isNumeric( ret ) ? ret : orig;

                // Set the width or height on the element (default to pixels if value is unitless)
            } else {
                return this.css( type, typeof size === "string" ? size : size + "px" );
            }
        };

    });




// Expose jQuery to the global object
    window.jQuery = window.$ = jQuery;

// Expose jQuery as an AMD module, but only for AMD loaders that
// understand the issues with loading multiple versions of jQuery
// in a page that all might call define(). The loader will indicate
// they have special allowances for multiple jQuery versions by
// specifying define.amd.jQuery = true. Register as a named module,
// since jQuery can be concatenated with other files that may use define,
// but not use a proper concatenation script that understands anonymous
// AMD modules. A named AMD is safest and most robust way to register.
// Lowercase jquery is used because AMD module names are derived from
// file names, and jQuery is normally delivered in a lowercase file name.
// Do this after creating the global so that if an AMD module wants to call
// noConflict to hide this version of jQuery, it will work.
    if ( typeof define === "function" && define.amd && define.amd.jQuery ) {
        define( "jquery", [], function () { return jQuery; } );
    }



})( window );

window.jQuery.noConflict();
return window.jQuery;
}
module.exports = create('undefined' === typeof window ? undefined : window);
module.exports.create = create;
}());

},{}],8:[function(require,module,exports){
/*
 * Copyright 2012 Small Batch, Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License"); you may not
 * use this file except in compliance with the License. You may obtain a copy of
 * the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS, WITHOUT
 * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the
 * License for the specific language governing permissions and limitations under
 * the License.
 */
;(function(window,document,undefined){
function i(a){return function(){return this[a]}}var j;function n(a,b){var c=arguments.length>2?Array.prototype.slice.call(arguments,2):[];return function(){c.push.apply(c,arguments);return b.apply(a,c)}};function o(a,b){this.K=a;this.c=b}o.prototype.createElement=function(a,b,c){a=this.K.createElement(a);if(b)for(var d in b)if(b.hasOwnProperty(d))d=="style"?q(this,a,b[d]):a.setAttribute(d,b[d]);c&&a.appendChild(this.K.createTextNode(c));return a};function r(a,b,c){a=a.K.getElementsByTagName(b)[0];if(!a)a=document.documentElement;if(a&&a.lastChild){a.insertBefore(c,a.lastChild);return true}return false}function aa(a,b){function c(){document.body?b():setTimeout(c,0)}c()}
function s(a,b){if(b.parentNode){b.parentNode.removeChild(b);return true}return false}function t(a,b){return a.createElement("link",{rel:"stylesheet",href:b})}function u(a,b){return a.createElement("script",{src:b})}function v(a,b,c){a=b.className.split(/\s+/);for(var d=0,e=a.length;d<e;d++)if(a[d]==c)return;a.push(c);b.className=a.join(" ").replace(/^\s+/,"")}
function w(a,b,c){a=b.className.split(/\s+/);for(var d=[],e=0,f=a.length;e<f;e++)a[e]!=c&&d.push(a[e]);b.className=d.join(" ").replace(/^\s+/,"").replace(/\s+$/,"")}function x(a,b,c){a=b.className.split(/\s+/);b=0;for(var d=a.length;b<d;b++)if(a[b]==c)return true;return false}function q(a,b,c){if(a.c.getName()=="MSIE")b.style.cssText=c;else b.setAttribute("style",c)};function y(a,b,c,d,e,f,g,h){this.Ba=a;this.Ha=b;this.oa=c;this.na=d;this.Ea=e;this.Da=f;this.ma=g;this.Ia=h}j=y.prototype;j.getName=i("Ba");j.xa=i("Ha");j.Y=i("oa");j.ua=i("na");j.va=i("Ea");j.wa=i("Da");j.ta=i("ma");j.w=i("Ia");function z(a,b){this.c=a;this.k=b}var ba=new y("Unknown","Unknown","Unknown","Unknown","Unknown","Unknown",undefined,false);z.prototype.parse=function(){return this.c.indexOf("MSIE")!=-1?ca(this):this.c.indexOf("Opera")!=-1?da(this):this.c.indexOf("AppleWebKit")!=-1?ea(this):this.c.indexOf("Gecko")!=-1?fa(this):ba};
function A(a){var b=C(a,a.c,/(iPod|iPad|iPhone|Android)/,1);if(b!="")return b;a=C(a,a.c,/(Linux|Mac_PowerPC|Macintosh|Windows)/,1);if(a!=""){if(a=="Mac_PowerPC")a="Macintosh";return a}return"Unknown"}function D(a){var b=C(a,a.c,/(OS X|Windows NT|Android) ([^;)]+)/,2);if(b)return b;if(b=C(a,a.c,/(iPhone )?OS ([\d_]+)/,2))return b;if(a=C(a,a.c,/Linux ([i\d]+)/,1))return a;return"Unknown"}
function ca(a){var b=C(a,a.c,/(MSIE [\d\w\.]+)/,1);if(b!=""){var c=b.split(" ");b=c[0];c=c[1];return new y(b,c,b,c,A(a),D(a),E(a,a.k),F(a,c)>=6)}return new y("MSIE","Unknown","MSIE","Unknown",A(a),D(a),E(a,a.k),false)}
function da(a){var b="Unknown",c="Unknown",d=C(a,a.c,/(Presto\/[\d\w\.]+)/,1);if(d!=""){c=d.split("/");b=c[0];c=c[1]}else{if(a.c.indexOf("Gecko")!=-1)b="Gecko";d=C(a,a.c,/rv:([^\)]+)/,1);if(d!="")c=d}if(a.c.indexOf("Version/")!=-1){d=C(a,a.c,/Version\/([\d\.]+)/,1);if(d!="")return new y("Opera",d,b,c,A(a),D(a),E(a,a.k),F(a,d)>=10)}d=C(a,a.c,/Opera[\/ ]([\d\.]+)/,1);if(d!="")return new y("Opera",d,b,c,A(a),D(a),E(a,a.k),F(a,d)>=10);return new y("Opera","Unknown",b,c,A(a),D(a),E(a,a.k),false)}
function ea(a){var b=A(a),c=D(a),d=C(a,a.c,/AppleWebKit\/([\d\.\+]+)/,1);if(d=="")d="Unknown";var e="Unknown";if(a.c.indexOf("Chrome")!=-1)e="Chrome";else if(a.c.indexOf("Safari")!=-1)e="Safari";else if(a.c.indexOf("AdobeAIR")!=-1)e="AdobeAIR";var f="Unknown";if(a.c.indexOf("Version/")!=-1)f=C(a,a.c,/Version\/([\d\.\w]+)/,1);else if(e=="Chrome")f=C(a,a.c,/Chrome\/([\d\.]+)/,1);else if(e=="AdobeAIR")f=C(a,a.c,/AdobeAIR\/([\d\.]+)/,1);var g=false;if(e=="AdobeAIR"){g=C(a,f,/\d+\.(\d+)/,1);g=F(a,f)>2||
F(a,f)==2&&parseInt(g,10)>=5}else{g=C(a,d,/\d+\.(\d+)/,1);g=F(a,d)>=526||F(a,d)>=525&&parseInt(g,10)>=13}return new y(e,f,"AppleWebKit",d,b,c,E(a,a.k),g)}
function fa(a){var b="Unknown",c="Unknown",d=false;if(a.c.indexOf("Firefox")!=-1){b="Firefox";var e=C(a,a.c,/Firefox\/([\d\w\.]+)/,1);if(e!=""){d=C(a,e,/\d+\.(\d+)/,1);c=e;d=e!=""&&F(a,e)>=3&&parseInt(d,10)>=5}}else if(a.c.indexOf("Mozilla")!=-1)b="Mozilla";e=C(a,a.c,/rv:([^\)]+)/,1);if(e=="")e="Unknown";else if(!d){d=F(a,e);var f=parseInt(C(a,e,/\d+\.(\d+)/,1),10),g=parseInt(C(a,e,/\d+\.\d+\.(\d+)/,1),10);d=d>1||d==1&&f>9||d==1&&f==9&&g>=2||e.match(/1\.9\.1b[123]/)!=null||e.match(/1\.9\.1\.[\d\.]+/)!=
null}return new y(b,c,"Gecko",e,A(a),D(a),E(a,a.k),d)}function F(a,b){a=C(a,b,/(\d+)/,1);if(a!="")return parseInt(a,10);return-1}function C(a,b,c,d){if((a=b.match(c))&&a[d])return a[d];return""}function E(a,b){if(b.documentMode)return b.documentMode};function ga(a,b,c,d){this.a=a;this.g=b;this.U=c;this.j=d||ha;this.h=new G("-")}var ha="wf";function H(a){v(a.a,a.g,a.h.e(a.j,"loading"));I(a,"loading")}function J(a){w(a.a,a.g,a.h.e(a.j,"loading"));x(a.a,a.g,a.h.e(a.j,"active"))||v(a.a,a.g,a.h.e(a.j,"inactive"));I(a,"inactive")}function ia(a){w(a.a,a.g,a.h.e(a.j,"loading"));w(a.a,a.g,a.h.e(a.j,"inactive"));v(a.a,a.g,a.h.e(a.j,"active"));I(a,"active")}function I(a,b,c,d){a.U[b]&&a.U[b](c,d)};function ja(){this.fa={}}function ka(a,b){var c=[];for(var d in b)if(b.hasOwnProperty(d)){var e=a.fa[d];e&&c.push(e(b[d]))}return c};function L(a,b,c,d,e){this.a=a;this.A=b;this.n=c;this.u=d;this.D=e;this.V=0;this.ja=this.ea=false}L.prototype.watch=function(a,b,c,d,e){for(var f=a.length,g=0;g<f;g++){var h=a[g];b[h]||(b[h]=["n4"]);this.V+=b[h].length}if(e)this.ea=e;for(g=0;g<f;g++){h=a[g];e=b[h];for(var l=c[h],k=0,m=e.length;k<m;k++){var B=e[k],p=this.A,K=h;v(p.a,p.g,p.h.e(p.j,K,B,"loading"));I(p,"fontloading",K,B);p=n(this,this.qa);K=n(this,this.ra);(new d(p,K,this.a,this.n,this.u,this.D,h,B,l)).start()}}};
L.prototype.qa=function(a,b){var c=this.A;w(c.a,c.g,c.h.e(c.j,a,b,"loading"));w(c.a,c.g,c.h.e(c.j,a,b,"inactive"));v(c.a,c.g,c.h.e(c.j,a,b,"active"));I(c,"fontactive",a,b);this.ja=true;M(this)};L.prototype.ra=function(a,b){var c=this.A;w(c.a,c.g,c.h.e(c.j,a,b,"loading"));x(c.a,c.g,c.h.e(c.j,a,b,"active"))||v(c.a,c.g,c.h.e(c.j,a,b,"inactive"));I(c,"fontinactive",a,b);M(this)};function M(a){if(--a.V==0&&a.ea)a.ja?ia(a.A):J(a.A)};function N(a,b,c,d,e,f,g,h,l){this.H=a;this.$=b;this.a=c;this.n=d;this.u=e;this.D=f;this.Aa=new la;this.v=new O;this.L=g;this.B=h;this.sa=l||ma;this.O=na(this,oa);this.P=na(this,pa);this.ca=this.O;this.da=this.P;this.Q=P(this,oa);this.R=P(this,pa)}var oa="arial,'URW Gothic L',sans-serif",pa="Georgia,'Century Schoolbook L',serif",ma="BESbswy";N.prototype.start=function(){this.ia=this.D();this.J()};
N.prototype.J=function(){var a=this.n.p(this.Q),b=this.n.p(this.R);if((this.O!=a||this.P!=b)&&this.ca==a&&this.da==b)Q(this,this.H);else if(this.D()-this.ia>=5E3)Q(this,this.$);else{this.ca=a;this.da=b;qa(this)}};function qa(a){a.u(function(b,c){return function(){c.call(b)}}(a,a.J),25)}function Q(a,b){s(a.a,a.Q);s(a.a,a.R);b(a.L,a.B)}function na(a,b){b=P(a,b,true);var c=a.n.p(b);s(a.a,b);return c}function P(a,b,c){b=a.a.createElement("span",{style:R(a,b,a.B,c)},a.sa);r(a.a,"body",b);return b}
function R(a,b,c,d){c=a.v.expand(c);return"position:absolute;top:-999px;left:-999px;font-size:300px;width:auto;height:auto;line-height:normal;margin:0;padding:0;font-variant:normal;font-family:"+(d?"":a.Aa.quote(a.L)+",")+b+";"+c};function S(a,b,c,d,e){this.a=a;this.X=b;this.g=c;this.u=d;this.c=e;this.M=this.N=0}S.prototype.q=function(a,b){this.X.fa[a]=b};S.prototype.load=function(a){var b=new ga(this.a,this.g,a);this.c.w()?ra(this,b,a):J(b)};S.prototype.ya=function(a,b,c,d){var e=a.Z?a.Z():N;if(d)a.load(n(this,this.Ca,b,c,e));else{a=--this.N==0;this.M--;if(a)this.M==0?J(b):H(b);c.watch([],{},{},e,a)}};
S.prototype.Ca=function(a,b,c,d,e,f){var g=--this.N==0;g&&H(a);this.u(n(this,function(h,l,k,m,B,p){h.watch(l,k||{},m||{},B,p)},b,d,e,f,c,g))};function ra(a,b,c){c=ka(a.X,c);a.M=a.N=c.length;for(var d=new L(a.a,b,{p:function(h){return h.offsetWidth}},a.u,function(){return(new Date).getTime()}),e=0,f=c.length;e<f;e++){var g=c[e];g.z(a.c,n(a,a.ya,g,b,d))}};function G(a){this.za=a||sa}var sa="-";G.prototype.e=function(){for(var a=[],b=0;b<arguments.length;b++)a.push(arguments[b].replace(/[\W_]+/g,"").toLowerCase());return a.join(this.za)};function la(){this.ha="'"}la.prototype.quote=function(a){var b=[];a=a.split(/,\s*/);for(var c=0;c<a.length;c++){var d=a[c].replace(/['"]/g,"");d.indexOf(" ")==-1?b.push(d):b.push(this.ha+d+this.ha)}return b.join(",")};function O(){this.G=ta;this.o=ua}var ta=["font-style","font-weight"],ua={"font-style":[["n","normal"],["i","italic"],["o","oblique"]],"font-weight":[["1","100"],["2","200"],["3","300"],["4","400"],["5","500"],["6","600"],["7","700"],["8","800"],["9","900"],["4","normal"],["7","bold"]]};function T(a,b,c){this.aa=a;this.Fa=b;this.o=c}T.prototype.compact=function(a,b){for(var c=0;c<this.o.length;c++)if(b==this.o[c][1]){a[this.aa]=this.o[c][0];return}};
T.prototype.expand=function(a,b){for(var c=0;c<this.o.length;c++)if(b==this.o[c][0]){a[this.aa]=this.Fa+":"+this.o[c][1];return}};O.prototype.compact=function(a){var b=["n","4"];a=a.split(";");for(var c=0,d=a.length;c<d;c++){var e=a[c].replace(/\s+/g,"").split(":");if(e.length==2){var f=e[1];a:{e=e[0];for(var g=0;g<this.G.length;g++)if(e==this.G[g]){e=new T(g,e,this.o[e]);break a}e=null}e&&e.compact(b,f)}}return b.join("")};
O.prototype.expand=function(a){if(a.length!=2)return null;for(var b=[null,null],c=0,d=this.G.length;c<d;c++){var e=this.G[c],f=a.substr(c,1);(new T(c,e,this.o[e])).expand(b,f)}return b[0]&&b[1]?b.join(";")+";":null};window.WebFont=function(){var a=(new z(navigator.userAgent,document)).parse();return new S(new o(document,a),new ja,document.documentElement,function(b,c){setTimeout(b,c)},a)}();window.WebFont.load=window.WebFont.load;window.WebFont.addModule=window.WebFont.q;y.prototype.getName=y.prototype.getName;y.prototype.getVersion=y.prototype.xa;y.prototype.getEngine=y.prototype.Y;y.prototype.getEngineVersion=y.prototype.ua;y.prototype.getPlatform=y.prototype.va;y.prototype.getPlatformVersion=y.prototype.wa;
y.prototype.getDocumentMode=y.prototype.ta;y.prototype.isSupportingWebFont=y.prototype.w;function U(a,b){this.a=a;this.d=b}var va={regular:"n4",bold:"n7",italic:"i4",bolditalic:"i7",r:"n4",b:"n7",i:"i4",bi:"i7"};U.prototype.z=function(a,b){return b(a.w())};
U.prototype.load=function(a){r(this.a,"head",t(this.a,("https:"==document.location.protocol?"https:":"http:")+"//webfonts.fontslive.com/css/"+this.d.key+".css"));var b;b=this.d.families;var c,d,e;c=[];d={};for(var f=0,g=b.length;f<g;f++){e=void 0;var h=void 0;h=void 0;h=b[f].split(":");e=h[0];h=h[1]?wa(this,h[1]):["n4"];e={W:e,T:h};c.push(e.W);d[e.W]=e.T}b={pa:c,T:d};a(b.pa,b.T)};
function wa(a,b){a=b.split(",");b=[];for(var c=0,d=a.length;c<d;c++){var e=a[c];if(e){var f=va[e];b.push(f?f:e)}}return b}window.WebFont.q("ascender",function(a){var b=(new z(navigator.userAgent,document)).parse();return new U(new o(document,b),a)});function V(a,b,c,d,e,f,g,h,l){V.Ga.call(this,a,b,c,d,e,f,g,h,l);a=["Times New Roman","Lucida Sans Unicode","Courier New","Tahoma","Arial","Microsoft Sans Serif","Times","Lucida Console","Sans","Serif","Monospace"];b=a.length;c={};d=P(this,a[0],true);c[this.n.p(d)]=true;for(e=1;e<b;e++){f=a[e];q(this.a,d,R(this,f,this.B,true));c[this.n.p(d)]=true;if(this.B[1]!="4"){q(this.a,d,R(this,f,this.B[0]+"4",true));c[this.n.p(d)]=true}}s(this.a,d);this.t=c;this.la=false}
(function(a,b){function c(){}c.prototype=a.prototype;b.prototype=new c;b.Ga=a;b.Ja=a.prototype})(N,V);var xa={Arimo:true,Cousine:true,Tinos:true};V.prototype.J=function(){var a=this.n.p(this.Q),b=this.n.p(this.R);if(!this.la&&a==b&&this.t[a]){this.t={};this.la=this.t[a]=true}if((this.O!=a||this.P!=b)&&!this.t[a]&&!this.t[b])Q(this,this.H);else if(this.D()-this.ia>=5E3)this.t[a]&&this.t[b]&&xa[this.L]?Q(this,this.H):Q(this,this.$);else qa(this)};function ya(a){this.I=a?a:("https:"==window.location.protocol?"https:":"http:")+za;this.f=[];this.S=[]}var za="//fonts.googleapis.com/css";ya.prototype.e=function(){if(this.f.length==0)throw new Error("No fonts to load !");if(this.I.indexOf("kit=")!=-1)return this.I;for(var a=this.f.length,b=[],c=0;c<a;c++)b.push(this.f[c].replace(/ /g,"+"));a=this.I+"?family="+b.join("%7C");if(this.S.length>0)a+="&subset="+this.S.join(",");return a};function Aa(a){this.f=a;this.ga=[];this.ka={};this.F={};this.v=new O}var Ba={ultralight:"n2",light:"n3",regular:"n4",bold:"n7",italic:"i4",bolditalic:"i7",ul:"n2",l:"n3",r:"n4",b:"n7",i:"i4",bi:"i7"},Ca={latin:ma,cyrillic:"&#1081;&#1103;&#1046;",greek:"&#945;&#946;&#931;",khmer:"&#x1780;&#x1781;&#x1782;",Hanuman:"&#x1780;&#x1781;&#x1782;"};
Aa.prototype.parse=function(){for(var a=this.f.length,b=0;b<a;b++){var c=this.f[b].split(":"),d=c[0],e=["n4"];if(c.length>=2){var f=c[1],g=[];if(f){f=f.split(",");for(var h=f.length,l=0;l<h;l++){var k;k=f[l];if(k.match(/^[\w ]+$/)){var m=Ba[k];if(m)k=m;else{m=k.match(/^(\d*)(\w*)$/);k=m[1];m=m[2];k=(k=this.v.expand([m?m:"n",k?k.substr(0,1):"4"].join("")))?this.v.compact(k):null}}else k="";k&&g.push(k)}}if(g.length>0)e=g;if(c.length==3){c=c[2];g=[];c=c?c.split(","):g;if(c.length>0)if(c=Ca[c[0]])this.F[d]=
c}}if(!this.F[d])if(c=Ca[d])this.F[d]=c;this.ga.push(d);this.ka[d]=e}};function W(a,b,c){this.c=a;this.a=b;this.d=c}W.prototype.z=function(a,b){b(a.w())};W.prototype.Z=function(){if(this.c.Y()=="AppleWebKit")return V;return N};W.prototype.load=function(a){var b=this.a;this.c.getName()=="MSIE"&&this.d.blocking!=true?aa(b,n(this,this.ba,a)):this.ba(a)};
W.prototype.ba=function(a){for(var b=this.a,c=new ya(this.d.api),d=this.d.families,e=d.length,f=0;f<e;f++){var g=d[f].split(":");g.length==3&&c.S.push(g.pop());c.f.push(g.join(":"))}d=new Aa(d);d.parse();r(b,"head",t(b,c.e()));a(d.ga,d.ka,d.F)};window.WebFont.q("google",function(a){var b=(new z(navigator.userAgent,document)).parse();return new W(b,new o(document,b),a)});function X(a,b){this.a=a;this.d=b}X.prototype.load=function(a){for(var b=this.d.urls||[],c=this.d.families||[],d=0,e=b.length;d<e;d++)r(this.a,"head",t(this.a,b[d]));a(c)};X.prototype.z=function(a,b){return b(a.w())};window.WebFont.q("custom",function(a){var b=(new z(navigator.userAgent,document)).parse();return new X(new o(document,b),a)});function Y(a,b,c){this.m=a;this.a=b;this.d=c;this.f=[];this.s={};this.v=new O}Y.prototype.C=function(a){return("https:"==this.m.location.protocol?"https:":"http:")+(this.d.api||"//f.fontdeck.com/s/css/js/")+this.m.document.location.hostname+"/"+a+".js"};
Y.prototype.z=function(a,b){a=this.d.id;var c=this;if(a){this.m.__webfontfontdeckmodule__||(this.m.__webfontfontdeckmodule__={});this.m.__webfontfontdeckmodule__[a]=function(d,e){for(var f=0,g=e.fonts.length;f<g;++f){var h=e.fonts[f];c.f.push(h.name);c.s[h.name]=[c.v.compact("font-weight:"+h.weight+";font-style:"+h.style)]}b(d)};r(this.a,"head",u(this.a,this.C(a)))}else b(true)};Y.prototype.load=function(a){a(this.f,this.s)};
window.WebFont.q("fontdeck",function(a){var b=(new z(navigator.userAgent,document)).parse();return new Y(window,new o(document,b),a)});function Z(a,b,c,d,e){this.m=a;this.c=b;this.a=c;this.k=d;this.d=e;this.f=[];this.s={}}
Z.prototype.z=function(a,b){var c=this,d=c.d.projectId;if(d){var e=u(c.a,c.C(d));e.id="__MonotypeAPIScript__"+d;e.onreadystatechange=function(f){if(e.readyState==="loaded"||e.readyState==="complete"){e.onreadystatechange=null;e.onload(f)}};e.onload=function(){if(c.m["__mti_fntLst"+d]){var f=c.m["__mti_fntLst"+d]();if(f&&f.length){var g;for(g=0;g<f.length;g++)c.f.push(f[g].fontfamily)}}b(a.w())};r(this.a,"head",e)}else b(true)};
Z.prototype.C=function(a){var b=this.protocol(),c=(this.d.api||"fast.fonts.com/jsapi").replace(/^.*http(s?):(\/\/)?/,"");return b+"//"+c+"/"+a+".js"};Z.prototype.load=function(a){a(this.f,this.s)};Z.prototype.protocol=function(){var a=["http:","https:"],b=a[0];if(this.k&&this.k.location&&this.k.location.protocol){var c=0;for(c=0;c<a.length;c++)if(this.k.location.protocol===a[c])return this.k.location.protocol}return b};
window.WebFont.q("monotype",function(a){var b=(new z(navigator.userAgent,document)).parse();return new Z(window,b,new o(document,b),document,a)});function $(a,b,c){this.m=a;this.a=b;this.d=c;this.f=[];this.s={}}$.prototype.C=function(a){var b="https:"==window.location.protocol?"https:":"http:";return(this.d.api||b+"//use.typekit.com")+"/"+a+".js"};$.prototype.z=function(a,b){var c=this.d.id,d=this.d,e=this;if(c){this.m.__webfonttypekitmodule__||(this.m.__webfonttypekitmodule__={});this.m.__webfonttypekitmodule__[c]=function(f){f(a,d,function(g,h,l){e.f=h;e.s=l;b(g)})};r(this.a,"head",u(this.a,this.C(c)))}else b(true)};
$.prototype.load=function(a){a(this.f,this.s)};window.WebFont.q("typekit",function(a){var b=(new z(navigator.userAgent,document)).parse();return new $(window,new o(document,b),a)});window.WebFontConfig&&window.WebFont.load(window.WebFontConfig);
})(this,document);

},{}],9:[function(require,module,exports){
// -*- Mode: JavaScript; tab-width: 2; indent-tabs-mode: nil; -*-
// vim:set ft=javascript ts=2 sw=2 sts=2 cindent:
var Ajax = (function($, window, undefined) {
    var Ajax = function(dispatcher) {
      var that = this;
      var pending = 0;
      var count = 0;
      var pendingList = {};

      // merge data will get merged into the response data
      // before calling the callback
      var ajaxCall = function(data, callback, merge) {
        merge = merge || {};
        dispatcher.post('spin');
        pending++;
        var id = count++;

        // special value: `merge.keep = true` prevents obsolescence
        pendingList[id] = merge.keep || false;
        delete merge.keep;

        // If no protocol version is explicitly set, set it to current
        if (data['protocol'] === undefined) {
          // TODO: Extract the protocol version somewhere global
          data['protocol'] = 1;
        }

        //var url = "test-json/";
        var url = "test-json-simple/";
        var method = "GET";
        switch(data.action){
          case "whoami":
            url += "user.json";
            break;
          case "getDocument":
            url += "document.json";
            break;
          case "loadConf":
            url += "config.json";
            break;
          case "getCollectionInformation":
            url += "collection.json";
            break;
          case "login":
            url += "login.json";
            break;
          case "createArc":
            url += "addRelation.json";
            //TODO method = "POST";
            break;
          case "arcOpenDialog":
            url += "addRelation2.json";
            break;
          case "createSpan":
            url += "createToken.json";
            //TODO method = "POST";
            break;
          default:
            url += "empty.json";
        }
        $.ajax({
          //Removed by Renaud on 2016-03-10
          /*url: 'ajax.cgi',
           data: data,
           type: 'POST',*/
          //
          data: data,
          url: url,
          type: method,
          success: function(response) {
            pending--;
            // If no exception is set, verify the server results
            if (response.exception == undefined && response.action !== data.action) {
              console.error('Action ' + data.action +
                ' returned the results of action ' + response.action);
              response.exception = true;
              dispatcher.post('messages', [[['Protocol error: Action' + data.action + ' returned the results of action ' + response.action + ' maybe the server is unable to run, please run tools/troubleshooting.sh from your installation to diagnose it', 'error', -1]]]);
            }

            // If the request is obsolete, do nothing; if not...
            if (pendingList.hasOwnProperty(id)) {
              dispatcher.post('messages', [response.messages]);
              if (response.exception == 'configurationError'
                  || response.exception == 'protocolVersionMismatch') {
                // this is a no-rescue critical failure.
                // Stop *everything*.
                pendingList = {};
                dispatcher.post('screamingHalt');
                // If we had a protocol mismatch, prompt the user for a reload
                if (response.exception == 'protocolVersionMismatch') {
                  if(confirm('The server is running a different version ' +
                      'from brat than your client, possibly due to a ' +
                      'server upgrade. Would you like to reload the ' +
                      'current page to update your client to the latest ' +
                      'version?')) {
                    window.location.reload(true);
                  } else {
                    dispatcher.post('messages', [[['Fatal Error: Protocol ' +
                        'version mismatch, please contact the administrator',
                        'error', -1]]]);
                  }
                }
                return;
              }

              delete pendingList[id];

              // if .exception is just Boolean true, do not process
              // the callback; if it is anything else, the
              // callback is responsible for handling it
              if (response.exception == true) {
                $('#waiter').dialog('close');
              } else if (callback) {
                $.extend(response, merge);
                dispatcher.post(0, callback, [response]);
              }
            }
            dispatcher.post('unspin');
          },
          error: function(response, textStatus, errorThrown) {
            pending--;
            dispatcher.post('unspin');
            $('#waiter').dialog('close');
            dispatcher.post('messages', [[['Error: Action' + data.action + ' failed on error ' + response.statusText, 'error']]]);
            console.error(textStatus + ':', errorThrown, response);
          }
        });
        return id;
      };

      var isReloadOkay = function() {
        // do not reload while data is pending
        return pending == 0;
      };

      var makeObsolete = function(all) {
        if (all) {
          pendingList = {};
        } else {
          $.each(pendingList, function(id, keep) {
            if (!keep) delete pendingList[id];
          });
        }
      }

      dispatcher.
          on('isReloadOkay', isReloadOkay).
          on('makeAjaxObsolete', makeObsolete).
          on('ajax', ajaxCall);
    };

    return Ajax;
})(jQuery, window);

module.exports = Ajax;

},{}],10:[function(require,module,exports){
// -*- Mode: JavaScript; tab-width: 2; indent-tabs-mode: nil; -*-
// vim:set ft=javascript ts=2 sw=2 sts=2 cindent:
var AnnotatorUI = (function($, window, undefined) {
    var AnnotatorUI = function(dispatcher, svg) {
      var that = this;
      var arcDragOrigin = null;
      var arcDragOriginBox = null;
      var arcDragOriginGroup = null;
      var arcDragArc = null;
      var arcDragJustStarted = false;
      var sourceData = null;
      var data = null;
      var searchConfig = null;
      var spanOptions = null;
      var rapidSpanOptions = null;
      var arcOptions = null;
      var spanKeymap = null;
      var keymap = null;
      var coll = null;
      var doc = null;
      var reselectedSpan = null;
      var selectedFragment = null;
      var editedSpan = null;
      var editedFragment = null;
      var repeatingArcTypes = [];
      var spanTypes = null;
      var entityAttributeTypes = null;
      var eventAttributeTypes = null;
      var allAttributeTypes = null; // TODO: temp workaround, remove
      var relationTypesHash = null;
      var showValidAttributes; // callback function
      var showValidNormalizations; // callback function
      var dragStartedAt = null;
      var selRect = null;
      var lastStartRec = null;
      var lastEndRec = null;

      var draggedArcHeight = 30;
      var spanTypesToShowBeforeCollapse = 30;
      var maxNormSearchHistory = 10;

      // TODO: this is an ugly hack, remove (see comment with assignment)
      var lastRapidAnnotationEvent = null;
      // TODO: another avoidable global; try to work without
      var rapidAnnotationDialogVisible = false;

      // amount by which to lighten (adjust "L" in HSL space) span
      // colors for type selection box BG display. 0=no lightening,
      // 1=white BG (no color)
      var spanBoxTextBgColorLighten = 0.4;

      // for double-click selection simulation hack
      var lastDoubleClickedChunkId = null;

      // for normalization: URLs bases by norm DB name
      var normDbUrlByDbName = {};
      var normDbUrlBaseByDbName = {};
      // for normalization: appropriate DBs per type
      var normDbsByType = {};
      // for normalization
      var oldSpanNormIdValue = '';
      var lastNormSearches = [];

      that.user = null;
      var svgElement = $(svg._svg);
      var svgId = svgElement.parent().attr('id');

      var stripNumericSuffix = function(s) {
        // utility function, originally for stripping numerix suffixes
        // from arc types (e.g. "Theme2" -> "Theme"). For values
        // without suffixes (including non-strings), returns given value.
        if (typeof(s) != "string") {          
          return s; // can't strip
        }
        var m = s.match(/^(.*?)(\d*)$/);
        return m[1]; // always matches
      }

      var hideForm = function() {
        keymap = null;
        rapidAnnotationDialogVisible = false;
      };

      var clearSelection = function() {
        window.getSelection().removeAllRanges();
        if (selRect != null) {
          for(var s=0; s != selRect.length; s++) {
            selRect[s].parentNode.removeChild(selRect[s]);
          }
          selRect = null;
          lastStartRec = null;
          lastEndRec = null;
        }
      };

      var makeSelRect = function(rx, ry, rw, rh, col) {
        var selRect = document.createElementNS("http://www.w3.org/2000/svg", "rect");
        selRect.setAttributeNS(null, "width", rw);
        selRect.setAttributeNS(null, "height", rh);
        selRect.setAttributeNS(null, "x", rx);
        selRect.setAttributeNS(null, "y", ry);
        selRect.setAttributeNS(null, "fill", col == undefined ? "lightblue" : col);
        return selRect;
      };

      var onKeyDown = function(evt) {
        var code = evt.which;

        if (code === $.ui.keyCode.ESCAPE) {
          stopArcDrag();
          if (reselectedSpan) {
            $(reselectedSpan.rect).removeClass('reselect');
            reselectedSpan = null;
            svgElement.removeClass('reselect');
          }
          return;
        }

        // in rapid annotation mode, prioritize the keys 0..9 for the
        // ordered choices in the quick annotation dialog.
        if (Configuration.rapidModeOn && rapidAnnotationDialogVisible && 
            "0".charCodeAt() <= code && code <= "9".charCodeAt()) {
          var idx = String.fromCharCode(code);
          var $input = $('#rapid_span_'+idx);
          if ($input.length) {
            $input.click();
          }
        }

        if (!keymap) return;

        // disable shortcuts when working with elements that you could
        // conceivably type in
        var target = evt.target;
        var nodeName = target.nodeName.toLowerCase();
        var nodeType = target.type && target.type.toLowerCase();
        if (nodeName == 'input' && (nodeType == 'text' || nodeType == 'password')) return;
        if (nodeName == 'textarea' || nodeName == 'select') return;

        var prefix = '';
        if (evt.altKey) {
          prefix = "A-";
        }
        if (evt.ctrlKey) {
          prefix = "C-";
        }
        if (evt.shiftKey) {
          prefix = "S-";
        }
        var binding = keymap[prefix + code];
        if (!binding) binding = keymap[prefix + String.fromCharCode(code)];
        if (binding) {
          var boundInput = $('#' + binding)[0];
          if (boundInput && !boundInput.disabled) {
            boundInput.click();
            evt.preventDefault();
            return false;
          }
        }
      };

      var onDblClick = function(evt) {
        // must be logged in
        //Removed by Renaud on 2016-03-10
        //if (that.user === null) return;
        // must not be reselecting a span or an arc
        if (reselectedSpan || arcDragOrigin) return;

        var target = $(evt.target);
        var id;

        // do we edit an arc?
        if (id = target.attr('data-arc-role')) {
          // TODO
          clearSelection();
          var originSpanId = target.attr('data-arc-origin');
          var targetSpanId = target.attr('data-arc-target');
          var type = target.attr('data-arc-role');
          var originSpan = data.spans[originSpanId];
          var targetSpan = data.spans[targetSpanId];
          arcOptions = {
            action: 'createArc',
            origin: originSpanId,
            target: targetSpanId,
            old_target: targetSpanId,
            type: type,
            old_type: type,
            collection: coll,
            'document': doc
          };
          var eventDescId = target.attr('data-arc-ed');
          if (eventDescId) {
            var eventDesc = data.eventDescs[eventDescId];
            if (eventDesc.equiv) {
              arcOptions['left'] = eventDesc.leftSpans.join(',');
              arcOptions['right'] = eventDesc.rightSpans.join(',');
            }
          }
          $('#arc_origin').text(Util.spanDisplayForm(spanTypes, originSpan.type) + ' ("' + originSpan.text + '")');
          $('#arc_target').text(Util.spanDisplayForm(spanTypes, targetSpan.type) + ' ("' + targetSpan.text + '")');
          var arcId = eventDescId || [originSpanId, type, targetSpanId];
          fillArcTypesAndDisplayForm(evt, originSpan.type, targetSpan.type, type, arcId);
          // for precise timing, log dialog display to user.
          dispatcher.post('logAction', ['arcEditSelected']);

        // if not an arc, then do we edit a span?
        } else if (id = target.attr('data-span-id')) {
          clearSelection();
          editedSpan = data.spans[id];
          editedFragment = target.attr('data-fragment-id');
          var offsets = [];
          $.each(editedSpan.fragments, function(fragmentNo, fragment) {
            offsets.push([fragment.from, fragment.to]);
          });
          spanOptions = {
            action: 'createSpan',
            offsets: offsets,
            type: editedSpan.type,
            id: id,
          };
          fillSpanTypesAndDisplayForm(evt, editedSpan.text, editedSpan);
          // for precise timing, log annotation display to user.
          dispatcher.post('logAction', ['spanEditSelected']);
        }

        // if not an arc or a span, is this a double-click on text?
        else if (id = target.attr('data-chunk-id')) {
          // remember what was clicked (this is in preparation for
          // simulating double-click selection on browsers that do
          // not support it.
          lastDoubleClickedChunkId = id;
        }
      };

      var startArcDrag = function(originId) {
        clearSelection();
        svgElement.addClass('unselectable');
        svgPosition = svgElement.offset();
        arcDragOrigin = originId;
        arcDragArc = svg.path(svg.createPath(), {
          markerEnd: 'url(#drag_arrow)',
          'class': 'drag_stroke',
          fill: 'none',
        });
        arcDragOriginGroup = $(data.spans[arcDragOrigin].group);
        arcDragOriginGroup.addClass('highlight');
        arcDragOriginBox = Util.realBBox(data.spans[arcDragOrigin].headFragment);
        arcDragOriginBox.center = arcDragOriginBox.x + arcDragOriginBox.width / 2;

        arcDragJustStarted = true;
      };

      var getValidArcTypesForDrag = function(targetId, targetType) {
        var arcType = stripNumericSuffix(arcOptions && arcOptions.type);
        if (!arcDragOrigin || targetId == arcDragOrigin) return null;

        var originType = data.spans[arcDragOrigin].type;
        var spanType = spanTypes[originType];
        var result = [];
        if (spanType && spanType.arcs) {
          $.each(spanType.arcs, function(arcNo, arc) {
            if (arcType && arcType != arc.type) return;

            if ($.inArray(targetType, arc.targets) != -1) {
              result.push(arc.type);
            }
          });
        }
        return result;
      };

      var onMouseDown = function(evt) {
        dragStartedAt = evt; // XXX do we really need the whole evt?
        //Removed by Renaud on 2016-03-10
        //if (!that.user || arcDragOrigin) return;
        if (arcDragOrigin) return;
        var target = $(evt.target);
        var id;
        // is it arc drag start?
        if (id = target.attr('data-span-id')) {
          arcOptions = null;
          startArcDrag(id);
          return false;
        }
      };

      var onMouseMove = function(evt) {
        if (arcDragOrigin) {
          if (arcDragJustStarted) {
            // show the possible targets
            var span = data.spans[arcDragOrigin] || {};
            var spanDesc = spanTypes[span.type] || {};

            // separate out possible numeric suffix from type for highight
            // (instead of e.g. "Theme3", need to look for "Theme")
            var noNumArcType = stripNumericSuffix(arcOptions && arcOptions.type);
            // var targetClasses = [];
            var $targets = $();
            $.each(spanDesc.arcs || [], function(possibleArcNo, possibleArc) {
              if ((arcOptions && possibleArc.type == noNumArcType) || !(arcOptions && arcOptions.old_target)) {
                $.each(possibleArc.targets || [], function(possibleTargetNo, possibleTarget) {
                  // speedup for #642: relevant browsers should support
                  // this function: http://www.quirksmode.org/dom/w3c_core.html#t11
                  // so we get off jQuery and get down to the metal:
                  // targetClasses.push('.span_' + possibleTarget);
                  $targets = $targets.add(svgElement[0].getElementsByClassName('span_' + possibleTarget));
                });
              }
            });
            //$(targetClasses.join(',')).not('[data-span-id="' + arcDragOrigin + '"]').addClass('reselectTarget');
            //TODO next one should be working but doesn't. Renaud on 2016-03-10
            $targets.not('[data-span-id="' + arcDragOrigin + '"]').addClass('reselectTarget');
          }
          clearSelection();
          var mx = evt.pageX - svgPosition.left;
          var my = evt.pageY - svgPosition.top + 5; // TODO FIXME why +5?!?
          var y = Math.min(arcDragOriginBox.y, my) - draggedArcHeight;
          var dx = (arcDragOriginBox.center - mx) / 4;
          var path = svg.createPath().
            move(arcDragOriginBox.center, arcDragOriginBox.y).
            curveC(arcDragOriginBox.center - dx, y,
                mx + dx, y,
                mx, my);
          arcDragArc.setAttribute('d', path.path());
        } else {
          // A. Scerri FireFox chunk

          // if not, then is it span selection? (ctrl key cancels)
          var sel = window.getSelection();
          var chunkIndexFrom = sel.anchorNode && $(sel.anchorNode.parentNode).attr('data-chunk-id');
          var chunkIndexTo = sel.focusNode && $(sel.focusNode.parentNode).attr('data-chunk-id');
          // fallback for firefox (at least):
          // it's unclear why, but for firefox the anchor and focus
          // node parents are always undefined, the the anchor and
          // focus nodes themselves do (often) have the necessary
          // chunk ID. However, anchor offsets are almost always
          // wrong, so we'll just make a guess at what the user might
          // be interested in tagging instead of using what's given.
          var anchorOffset = null;
          var focusOffset = null;
          if (chunkIndexFrom === undefined && chunkIndexTo === undefined &&
              $(sel.anchorNode).attr('data-chunk-id') &&
              $(sel.focusNode).attr('data-chunk-id')) {
            // Lets take the actual selection range and work with that
            // Note for visual line up and more accurate positions a vertical offset of 8 and horizontal of 2 has been used!
            var range = sel.getRangeAt(0);
            var svgOffset = $(svg._svg).offset();
            var flip = false;
            var tries = 0;
            // First try and match the start offset with a position, if not try it against the other end
            while (tries < 2) {
              var sp = svg._svg.createSVGPoint();
              sp.x = (flip ? evt.pageX : dragStartedAt.pageX) - svgOffset.left;
              sp.y = (flip ? evt.pageY : dragStartedAt.pageY) - (svgOffset.top + 8);
              var startsAt = range.startContainer;
              anchorOffset = startsAt.getCharNumAtPosition(sp);
              chunkIndexFrom = startsAt && $(startsAt).attr('data-chunk-id');
              if (anchorOffset != -1) {
                break;
              }
              flip = true;
              tries++;
            }

            // Now grab the end offset
            sp.x = (flip ? dragStartedAt.pageX : evt.pageX) - svgOffset.left;
            sp.y = (flip ? dragStartedAt.pageY : evt.pageY) - (svgOffset.top + 8);
            var endsAt = range.endContainer;
            focusOffset = endsAt.getCharNumAtPosition(sp);

            // If we cannot get a start and end offset stop here
            if (anchorOffset == -1 || focusOffset == -1) {
              return;
            }
            // If we are in the same container it does the selection back to front when dragged right to left, across different containers the start is the start and the end if the end!
            if(range.startContainer == range.endContainer && anchorOffset > focusOffset) {
              var t = anchorOffset;
              anchorOffset = focusOffset;
              focusOffset = t;
              flip = false;
            }
            chunkIndexTo = endsAt && $(endsAt).attr('data-chunk-id');

            // Now take the start and end character rectangles
            startRec = startsAt.getExtentOfChar(anchorOffset);
            startRec.y += 2;
            endRec = endsAt.getExtentOfChar(focusOffset);
            endRec.y += 2;

            // If nothing has changed then stop here
            if (lastStartRec != null && lastStartRec.x == startRec.x && lastStartRec.y == startRec.y && lastEndRec != null && lastEndRec.x == endRec.x && lastEndRec.y == endRec.y) {
              return;
            }

            if (selRect == null) {
              var rx = startRec.x;
              var ry = startRec.y;
              var rw = (endRec.x + endRec.width) - startRec.x;
              if (rw < 0) {
                rx += rw;
                rw = -rw;
              }
              var rh = Math.max(startRec.height, endRec.height);

              selRect = new Array();
              var activeSelRect = makeSelRect(rx, ry, rw, rh);
              selRect.push(activeSelRect);
              startsAt.parentNode.parentNode.parentNode.insertBefore(activeSelRect, startsAt.parentNode.parentNode);
            } else {
              if (startRec.x != lastStartRec.x && endRec.x != lastEndRec.x && (startRec.y != lastStartRec.y || endRec.y != lastEndRec.y)) {
                if (startRec.y < lastStartRec.y) {
                  selRect[0].setAttributeNS(null, "width", lastStartRec.width);
                  lastEndRec = lastStartRec;
                } else if (endRec.y > lastEndRec.y) {
                  selRect[selRect.length - 1].setAttributeNS(null, "x",
                      parseFloat(selRect[selRect.length - 1].getAttributeNS(null, "x"))
                      + parseFloat(selRect[selRect.length - 1].getAttributeNS(null, "width"))
                      - lastEndRec.width);
                  selRect[selRect.length - 1].setAttributeNS(null, "width", 0);
                  lastStartRec=lastEndRec;
                }
              }

              // Start has moved
              var flip = !(startRec.x == lastStartRec.x && startRec.y == lastStartRec.y);
              // If the height of the start or end changed we need to check whether
              // to remove multi line highlights no longer needed if the user went back towards their start line
              // and whether to create new ones if we moved to a newline
              if (((endRec.y != lastEndRec.y)) || ((startRec.y != lastStartRec.y))) {
                // First check if we have to remove the first highlights because we are moving towards the end on a different line
                var ss = 0;
                for (; ss != selRect.length; ss++) {
                  if (startRec.y <= parseFloat(selRect[ss].getAttributeNS(null, "y"))) {
                    break;
                  }
                }
                // Next check for any end highlights if we are moving towards the start on a different line
                var es = selRect.length - 1;
                for (; es != -1; es--) {
                  if (endRec.y >= parseFloat(selRect[es].getAttributeNS(null, "y"))) {
                    break;
                  }
                }
                // TODO put this in loops above, for efficiency the array slicing could be done separate still in single call
                var trunc = false;
                if (ss < selRect.length) {
                  for (var s2 = 0; s2 != ss; s2++) {
                    selRect[s2].parentNode.removeChild(selRect[s2]);
                    es--;
                    trunc = true;
                  }
                  selRect = selRect.slice(ss);
                }
                if (es > -1) {
                  for (var s2 = selRect.length - 1; s2 != es; s2--) {
                    selRect[s2].parentNode.removeChild(selRect[s2]);
                    trunc = true;
                  }
                  selRect = selRect.slice(0, es + 1);
                }

                // If we have truncated the highlights we need to readjust the last one
                if (trunc) {
                  var activeSelRect = flip ? selRect[0] : selRect[selRect.length - 1];
                  if (flip) {
                    var rw = 0;
                    if (startRec.y == endRec.y) {
                      rw = (endRec.x + endRec.width) - startRec.x;
                    } else {
                      rw = (parseFloat(activeSelRect.getAttributeNS(null, "x"))
                          + parseFloat(activeSelRect.getAttributeNS(null, "width")))
                          - startRec.x;
                    }
                    activeSelRect.setAttributeNS(null, "x", startRec.x);
                    activeSelRect.setAttributeNS(null, "y", startRec.y);
                    activeSelRect.setAttributeNS(null, "width", rw);
                  } else {
                    var rw = (endRec.x + endRec.width) - parseFloat(activeSelRect.getAttributeNS(null, "x"));
                    activeSelRect.setAttributeNS(null, "width", rw);
                  }
                } else {
                  // We didnt truncate anything but we have moved to a new line so we need to create a new highlight
                  var lastSel = flip ? selRect[0] : selRect[selRect.length - 1];
                  var startBox = startsAt.parentNode.getBBox();
                  var endBox = endsAt.parentNode.getBBox();

                  if (flip) {
                    lastSel.setAttributeNS(null, "width",
                        (parseFloat(lastSel.getAttributeNS(null, "x"))
                        + parseFloat(lastSel.getAttributeNS(null, "width")))
                        - endBox.x);
                    lastSel.setAttributeNS(null, "x", endBox.x);
                  } else {
                    lastSel.setAttributeNS(null, "width",
                        (startBox.x + startBox.width)
                        - parseFloat(lastSel.getAttributeNS(null, "x")));
                  }
                  var rx = 0;
                  var ry = 0;
                  var rw = 0;
                  var rh = 0;
                  if (flip) {
                    rx = startRec.x;
                    ry = startRec.y;
                    rw = $(svg._svg).width() - startRec.x;
                    rh = startRec.height;
                  } else {
                    rx = endBox.x;
                    ry = endRec.y;
                    rw = (endRec.x + endRec.width) - endBox.x;
                    rh = endRec.height;
                  }
                  var newRect = makeSelRect(rx, ry, rw, rh);
                  if (flip) {
                    selRect.unshift(newRect);
                  } else {
                    selRect.push(newRect);
                  }

                  // Place new highlight in appropriate slot in SVG graph
                  startsAt.parentNode.parentNode.parentNode.insertBefore(newRect, startsAt.parentNode.parentNode);
                }
              } else {
                // The user simply moved left or right along the same line so just adjust the current highlight
                var activeSelRect = flip ? selRect[0] : selRect[selRect.length - 1];
                // If the start moved shift the highlight and adjust width
                if (flip) {
                  var rw = (parseFloat(activeSelRect.getAttributeNS(null, "x"))
                      + parseFloat(activeSelRect.getAttributeNS(null, "width")))
                      - startRec.x;
                  activeSelRect.setAttributeNS(null, "x", startRec.x);
                  activeSelRect.setAttributeNS(null, "y", startRec.y);
                  activeSelRect.setAttributeNS(null, "width", rw);
                } else {
                  // If the end moved then simple change the width
                  var rw = (endRec.x + endRec.width)
                      - parseFloat(activeSelRect.getAttributeNS(null, "x"));
                  activeSelRect.setAttributeNS(null, "width", rw);
                }
              }
            }
            lastStartRec = startRec;
            lastEndRec = endRec;
          }
        }
        arcDragJustStarted = false;
      };

      var adjustToCursor = function(evt, element, centerX, centerY) {
        var screenHeight = $(window).height() - 8; // TODO HACK - no idea why -8 is needed
        var screenWidth = $(window).width() - 8;
        var elementHeight = element.height();
        var elementWidth = element.width();
        var cssSettings = {};
        var eLeft;
        var eTop;
        if (centerX) {
            eLeft = evt.clientX - elementWidth/2;
        } else {
            eLeft = evt.clientX;
        }
        if (centerY) {
            eTop = evt.clientY - elementHeight/2;
        } else {
            eTop = evt.clientY;
        }
        // Try to make sure the element doesn't go off-screen.
        // If this isn't possible (the element is larger than the screen),
        // alight top-left corner of screen and dialog as a compromise.
        if (screenWidth > elementWidth) {
            eLeft = Math.min(Math.max(eLeft,0), screenWidth - elementWidth);
        } else {
            eLeft = 0;
        } 
        if (screenHeight > elementHeight) {
            eTop  = Math.min(Math.max(eTop,0), screenHeight - elementHeight);
        } else {
            eTop  = 0;
        }
        element.css({ top: eTop, left: eLeft });
      };

      var updateCheckbox = function($input) {
        var $widget = $input.button('widget');
        var $textspan = $widget.find('.ui-button-text');
        $textspan.html(($input[0].checked ? '&#x2611; ' : '&#x2610; ') + $widget.attr('data-bare'));
      };

      var fillSpanTypesAndDisplayForm = function(evt, spanText, span) {
        keymap = spanKeymap;

        // Figure out whether we should show or hide one of the two
        // main halves of the selection frame (entities / events).
        // This depends on the type of the current span, if any, and
        // the availability of types to select.
        var hideFrame;
        if (span) {
          // existing span; only show relevant half
          if (span.generalType == 'entity') {
            hideFrame = 'event';
          } else {
            hideFrame = 'entity';
          }
          spanForm.dialog('option', { title: 'Edit Annotation' });
        } else {
          // new span; show everything that's available
          if ($('#event_types').find('input').length == 0) {
            hideFrame = 'event';
          } else if ($('#entity_types').find('input').length == 0) {
            hideFrame = 'entity';
          } else {
            hideFrame = 'none';
          }
          spanForm.dialog('option', { title: 'New Annotation' });
        }
        if (hideFrame == 'event') {
          $('#span_event_section').hide()
          $('#span_entity_section').show().
            removeClass('wrapper_half_left').
            addClass('wrapper_full_width');
        } else if (hideFrame == 'entity') {
          $('#span_entity_section').hide()
          $('#span_event_section').show().
            removeClass('wrapper_half_right').
            addClass('wrapper_full_width');
        } else {
          // show both entity and event halves
          $('#span_entity_section').show().
            removeClass('wrapper_full_width').
            addClass('wrapper_half_left');
          $('#span_event_section').show().
            removeClass('wrapper_full_width').
            addClass('wrapper_half_right');
        }

        // only show "delete" button if there's an existing annotation to delete
        if (span) {
          $('#del_span_button').show();
        } else {
          $('#del_span_button').hide();
        }

        $('#span_selected').text(spanText);
        var encodedText = encodeURIComponent(spanText);       
        $.each(searchConfig, function(searchNo, search) {
          $('#span_'+search[0]).attr('href', search[1].replace('%s', encodedText));
        });

        // enable all inputs by default (see setSpanTypeSelectability)
        $('#span_form input:not([unused])').removeAttr('disabled');

        // close span types if there's over spanTypesToShowBeforeCollapse
        if ($('#entity_types .item').length > spanTypesToShowBeforeCollapse) {
          $('#entity_types .open').removeClass('open');
        }
        if ($('#event_types .item').length > spanTypesToShowBeforeCollapse) {
          $('#event_types .open').removeClass('open');
        }

        var showAllAttributes = false;
        if (span) {
          var hash = new URLHash(coll, doc, { focus: [[span.id]] }).getHash();
          $('#span_highlight_link').attr('href', hash).show();
          var el = $('#span_' + span.type);
          if (el.length) {
            el[0].checked = true;
          } else {
            $('#span_form input:radio:checked').each(function (radioNo, radio) {
              radio.checked = false;
            });
          }

          // open the span type
          $('#span_' + span.type).parents('.collapsible').each(function() {
            toggleCollapsible($(this).parent().prev(), true);
          });

          // count the repeating arc types
          var arcTypeCount = {};
          repeatingArcTypes = [];
          $.each(span.outgoing, function(arcNo, arc) {
            // parse out possible number suffixes to allow e.g. splitting
            // on "Theme" for args ("Theme1", "Theme2").
            var splitArcType = arc.type.match(/^(.*?)(\d*)$/);
            var noNumArcType = splitArcType[1];
            if ((arcTypeCount[noNumArcType] = (arcTypeCount[noNumArcType] || 0) + 1) == 2) {
              repeatingArcTypes.push(noNumArcType);
            }
          });
          if (repeatingArcTypes.length) {
            $('#span_form_split').show();
          } else {
            $('#span_form_split').hide();
          }
        } else {
          $('#span_highlight_link').hide();
          var firstRadio = $('#span_form input:radio:not([unused]):first')[0];
          if (firstRadio) {
            firstRadio.checked = true;
          } else {
            dispatcher.post('hideForm');
            dispatcher.post('messages', [[['No valid span types defined', 'error']]]);
            return;
          }
          $('#span_form_split').hide();
          $('#span_notes').val('');
          showAllAttributes = true;
        }
        if (span && !reselectedSpan) {
          $('#span_form_reselect, #span_form_delete, #span_form_add_fragment').show();
          keymap[$.ui.keyCode.DELETE] = 'span_form_delete';
          keymap[$.ui.keyCode.INSERT] = 'span_form_reselect';
          keymap['S-' + $.ui.keyCode.ENTER] = 'span_form_add_fragment';
          $('#span_notes').val(span.annotatorNotes || '');
        } else {
          $('#span_form_reselect, #span_form_delete, #span_form_add_fragment').hide();
          keymap[$.ui.keyCode.DELETE] = null;
          keymap[$.ui.keyCode.INSERT] = null;
          keymap['S-' + $.ui.keyCode.ENTER] = null;
        }
        if (span && !reselectedSpan && span.offsets.length > 1) {
          $('#span_form_reselect_fragment, #span_form_delete_fragment').show();
          keymap['S-' + $.ui.keyCode.DELETE] = 'span_form_delete_fragment';
          keymap['S-' + $.ui.keyCode.INSERT] = 'span_form_reselect_fragment';
        } else {
          $('#span_form_reselect_fragment, #span_form_delete_fragment').hide();
          keymap['S-' + $.ui.keyCode.DELETE] = null;
          keymap['S-' + $.ui.keyCode.INSERT] = null;
        }
        // TODO: lots of redundancy in the next two blocks, clean up
        if (!span) {
          // no existing annotation, reset attributes
          var attrCategoryAndTypes = [['entity', entityAttributeTypes],
                                      ['event', eventAttributeTypes]];
          $.each(attrCategoryAndTypes, function(ctNo, ct) {
            var category = ct[0];
            var attributeTypes = ct[1];
            $.each(attributeTypes, function(attrNo, attr) {
              $input = $('#'+category+'_attr_'+Util.escapeQuotes(attr.type));
              if (attr.unused) {
                $input.val('');
              } else if (attr.bool) {
                $input[0].checked = false;
                updateCheckbox($input);
                $input.button('refresh');
              } else {
                $input.val('').change();
              }
            });
          });
        } else if (!reselectedSpan) {
          // existing annotation, fill attribute values from span
          var attributeTypes;
          var category;
          if (span.generalType == 'entity') {
            attributeTypes = entityAttributeTypes;
            category = 'entity';
          } else if (span.generalType == 'trigger') {
            attributeTypes = eventAttributeTypes;
            // TODO: unify category/generalType values ('trigger' vs. 'event')
            category = 'event';
          } else {
            console.error('Unrecognized generalType:', span.generalType);
          }
          $.each(attributeTypes, function(attrNo, attr) {
            $input = $('#'+category+'_attr_'+Util.escapeQuotes(attr.type));
            var val = span.attributes[attr.type];
            if (attr.unused) {
              $input.val(val || '');
            } else if (attr.bool) {
              $input[0].checked = val;
              updateCheckbox($input);
              $input.button('refresh');
            } else {
              $input.val(val || '').change();
            }
          });
        }

        var showValidNormalizationsFor = function(type) {
          // set DB selector to the first appropriate for the type.
          // TODO: actually disable inappropriate ones.
          // TODO: support specific IDs, not just DB specifiers
          var firstDb = type && normDbsByType[type] ? normDbsByType[type][0] : null;
          if (firstDb) {
            $('#span_norm_db').val(firstDb);
          }
        }

        showValidNormalizations = function() {
          // set norm DB selector according to the first selected type
          var firstSelected = $('#entity_and_event_wrapper input:radio:checked')[0];
          var selectedType = firstSelected ? firstSelected.value : null;
          showValidNormalizationsFor(selectedType);
        }

        // fill normalizations (if any)
        if (!reselectedSpan) {
          // clear first
          clearNormalizationUI();

          var $normDb = $('#span_norm_db');
          var $normId = $('#span_norm_id');
          var $normText = $('#span_norm_txt');

          // fill if found (NOTE: only shows last on multiple)
          var normFilled = false;
          $.each(span ? span.normalizations : [], function(normNo, norm) {
            var refDb = norm[0], refId = norm[1], refText = norm[2];
            $normDb.val(refDb);
            // could the DB selector be set? (i.e. is refDb configured?)
            if ($normDb.val() == refDb) {
              // DB is OK, set the rest also
              $normId.val(refId);
              oldSpanNormIdValue = refId;
              $normText.val(refText);
              // TODO: check if ID is valid
              $normId.addClass('valid_value')
              normFilled = true;
            } else {
              // can't set the DB selector; assume DB is not configured,
              // warn and leave blank (will remove norm when dialog is OK'd)
              dispatcher.post('messages', [[['Warning: '+refDb+' not configured, removing normalization.', 'warning']]]);
            }
          });

          // if there is no existing normalization, show valid ones
          if (!normFilled) {
            showValidNormalizations();
          }

          // update links
          updateNormalizationRefLink();
          updateNormalizationDbLink();
        }

        var showAttributesFor = function(attrTypes, category, type) {
          var validAttrs = type ? spanTypes[type].attributes : [];
          var shownCount = 0;
          $.each(attrTypes, function(attrNo, attr) {
            var $input = $('#'+category+'_attr_'+Util.escapeQuotes(attr.type));
            var showAttr = showAllAttributes || $.inArray(attr.type, validAttrs) != -1;
            if (showAttr) {
              $input.button('widget').show();
              shownCount++;
            } else {
              $input.button('widget').hide();
            }
          });
          return shownCount;
        }

        showValidAttributes = function() {
          var type = $('#span_form input:radio:checked').val();
          var entityAttrCount = showAttributesFor(entityAttributeTypes, 'entity', type);
          var eventAttrCount = showAttributesFor(eventAttributeTypes, 'event', type);
          
          showAllAttributes = false;
          // show attribute frames only if at least one attribute is
          // shown, and set size classes appropriately
          if (eventAttrCount > 0) {
            $('#event_attributes').show();
            $('#event_attribute_label').show();
            $('#event_types').
              removeClass('scroll_wrapper_full').
              addClass('scroll_wrapper_upper');
          } else {
            $('#event_attributes').hide();
            $('#event_attribute_label').hide();
            $('#event_types').
              removeClass('scroll_wrapper_upper').
              addClass('scroll_wrapper_full');
          }
          if (entityAttrCount > 0) {
            $('#entity_attributes').show();
            $('#entity_attribute_label').show();
            $('#entity_types').
              removeClass('scroll_wrapper_full').
              addClass('scroll_wrapper_upper');
          } else {
            $('#entity_attributes').hide();
            $('#entity_attribute_label').hide();
            $('#entity_types').
              removeClass('scroll_wrapper_upper').
              addClass('scroll_wrapper_full');
          }
        }
        showValidAttributes();

        // TODO XXX: if seemed quite unexpected/unintuitive that the
        // form was re-displayed while the document still shows the
        // annotation in its old location in the background (check it).
        // The fix of skipping confirm is not really good either, though.
        if (reselectedSpan) { // && !Configuration.confirmModeOn) {
          submitReselect();
        } else {
          dispatcher.post('showForm', [spanForm, spanOptions]);
          $('#span_form-ok').focus();
          adjustToCursor(evt, spanForm.parent());
        }
      };

      var submitReselect = function() {
        $(reselectedSpan.rect).removeClass('reselect');
        reselectedSpan = null;
        spanForm.submit();
      };

      var rapidFillSpanTypesAndDisplayForm = function(start, end, text, types) {
        // variant of fillSpanTypesAndDisplayForm for rapid annotation mode
        keymap = spanKeymap;
        $('#rapid_span_selected').text(text);

        // fill types
        var $spanTypeDiv = $('#rapid_span_types_div');
        // remove previously filled, if any
        $spanTypeDiv.empty();
        $.each(types, function(typeNo, typeAndProb) {
          // TODO: this duplicates a part of addSpanTypesToDivInner, unify
          var type = typeAndProb[0];
          var prob = typeAndProb[1];
          var $numlabel = $('<span class="accesskey">'+(typeNo+1)+'</span><span>:</span>');
          var $input = $('<input type="radio" name="rapid_span_type"/>').
              attr('id', 'rapid_span_' + (typeNo+1)).
              attr('value', type);
          var spanBgColor = spanTypes[type] && spanTypes[type].bgColor || '#ffffff';
          spanBgColor = Util.adjustColorLightness(spanBgColor, spanBoxTextBgColorLighten);
          // use preferred label instead of type name if available
          var name = spanTypes[type] && spanTypes[type].name || type;
          var $label = $('<label class="span_type_label"/>').
            attr('for', 'rapid_span_' + (typeNo+1)).
            text(name+' (' + (100.0 * prob).toFixed(1) + '%)');
          $label.css('background-color', spanBgColor);          
          // TODO: check for unnecessary extra wrapping here
          var $content = $('<div class="item_content"/>').
            append($numlabel).
            append($input).
            append($label);
          $spanTypeDiv.append($content);
          // highlight configured hotkey (if any) in text.
          // NOTE: this bit doesn't actually set up the hotkey.
          var hotkeyType = 'span_' + type;
          // TODO: this is clumsy; there should be a better way
          var typeHotkey = null;
          $.each(keymap, function(key, keyType) {
            if (keyType == hotkeyType) {
              typeHotkey = key;
              return false;
            }
          });
          if (typeHotkey) {
            var name = $label.html();
            var replace = true;
            name = name.replace(new RegExp("(&[^;]*?)?(" + typeHotkey + ")", 'gi'),
              function(all, entity, letter) {
                if (replace && !entity) {
                  replace = false;
                  var hotkey = typeHotkey.toLowerCase() == letter
                      ? typeHotkey.toLowerCase()
                      : typeHotkey.toUpperCase();
                  return '<span class="accesskey">' + Util.escapeHTML(hotkey) + '</span>';
                }
                return all;
              });
            $label.html(name);
          }
          // Limit the number of suggestions to the number of numeric keys
          if (typeNo >= 8) {
            return false;
          }
        });
        // fill in some space and the special "Other" option, with key "0" (zero)
        $spanTypeDiv.append($('<div class="item_content">&#160;</div>')); // non-breaking space
        var $numlabel = $('<span class="accesskey">0</span><span>:</span>');        
        var $input = $('<input type="radio" name="rapid_span_type" id="rapid_span_0" value=""/>');
        var $label = $('<label class="span_type_label" for="rapid_span_0" style="background-color:lightgray">Other...</label>');
        var $content = $('<div class="item_content"/>').
          append($numlabel).
          append($input).
          append($label);
        $spanTypeDiv.append($content);

        // set up click event handlers
        rapidSpanForm.find('#rapid_span_types input:radio').click(rapidSpanFormSubmitRadio);

        var firstRadio = $('#rapid_span_form input:radio:first')[0];
        if (firstRadio) {
          firstRadio.checked = true;
        } else {
          dispatcher.post('hideForm');
          dispatcher.post('messages', [[['No valid span types defined', 'error']]]);
          return;
        }
        dispatcher.post('showForm', [rapidSpanForm]);
        rapidAnnotationDialogVisible = true;
        $('#rapid_span_form-ok').focus();
        // TODO: avoid using global for stored click event
//         adjustToCursor(lastRapidAnnotationEvent, rapidSpanForm.parent(),
//                        true, true);
        // TODO: avoid coordinate hack to position roughly at first
        // available selection
        lastRapidAnnotationEvent.clientX -= 55;
        lastRapidAnnotationEvent.clientY -= 115;
        adjustToCursor(lastRapidAnnotationEvent, rapidSpanForm.parent(),
                       false, false);
      };

      var clearSpanNotes = function(evt) {
        $('#span_notes').val('');
      }
      $('#clear_notes_button').button();
      $('#clear_notes_button').click(clearSpanNotes);

      var clearSpanNorm = function(evt) {
        clearNormalizationUI();
      }
      $('#clear_norm_button').button();
      $('#clear_norm_button').click(clearSpanNorm);

      // invoked on response to ajax request for id lookup
      var setSpanNormText = function(response) {
        if (response.exception) {
          // TODO: better response to failure
          dispatcher.post('messages', [[['Lookup error', 'warning', -1]]]);
          return false;
        }        
        // set input style according to whether we have a valid value
        var $idinput = $('#span_norm_id');
        // TODO: make sure the key echo in the response matches the
        // current value of the $idinput
        $idinput.removeClass('valid_value').removeClass('invalid_value');
        if (response.value === null) {
          $idinput.addClass('invalid_value');
          hideNormalizationRefLink();
        } else {
          $idinput.addClass('valid_value');
          updateNormalizationRefLink();
        }
        $('#span_norm_txt').val(response.value);
      }

      // on any change to the normalization DB, clear everything and
      // update link
      var spanNormDbUpdate = function(evt) {
        clearNormalizationUI();
        updateNormalizationDbLink();
      }
      $('#span_norm_db').change(spanNormDbUpdate);

      // on any change to the normalization ID, update the text of the
      // reference
      var spanNormIdUpdate = function(evt) {
        var key = $(this).val();
        var db = $('#span_norm_db').val();
        if (key != oldSpanNormIdValue) {
          if (key.match(/^\s*$/)) {
            // don't query empties, just clear instead
            clearNormalizationUI();
          } else {
            dispatcher.post('ajax', [ {
                            action: 'normGetName',
                            database: db,
                            key: key,
                            collection: coll}, 'normGetNameResult']);
          }
          oldSpanNormIdValue = key;
        }
      }
      // see http://stackoverflow.com/questions/1948332/detect-all-changes-to-a-input-type-text-immediately-using-jquery
      $('#span_norm_id').bind('propertychange keyup input paste', spanNormIdUpdate);
      // nice-looking select for normalization
      $('#span_norm_db').addClass('ui-widget ui-state-default ui-button-text');

      var normSearchDialog = $('#norm_search_dialog');
      initForm(normSearchDialog, {
          width: 800,
          width: 600,
          resizable: true,
          alsoResize: '#norm_search_result_select',
          open: function(evt) {
            keymap = {};
          },
          close: function(evt) {
            // assume that we always want to return to the span dialog
            // on normalization dialog close
            dispatcher.post('showForm', [spanForm]);
          },
      });

// BRAT STAND ALONE LIBRARY BEGIN
/*
      $('#norm_search_query').autocomplete({
        source: function(request, callback) {
          var query = $.ui.autocomplete.escapeRegex(request.term);
          var pattern = new RegExp('\\b' + query, 'i');
          callback($.grep(lastNormSearches, function(search) {
            return pattern.test(search.value) || pattern.test(search.id);
          }));
        },
        minLength: 0,
        select: function(evt, ui) {
          evt.stopPropagation();
          normSubmit(ui.item.id, ui.item.value);
        },
        focus: function(evt, ui) {
          // do nothing
        },
      }).data('autocomplete')._renderItem = function($ul, item) {
        return $('<li></li>').
          data('item.autocomplete', item).
          append('<a>' + Util.escapeHTML(item.value) + '<div class="autocomplete-id">' + Util.escapeHTML(item.id) + "</div></a>").
          appendTo($ul);
      };
*/
// BRAT STAND ALONE LIBRARY END

      var normSubmit = function(selectedId, selectedTxt) {
        // we got a value; act if it was a submit
        $('#span_norm_id').val(selectedId);
        // don't forget to update this reference value
        oldSpanNormIdValue = selectedId;
        $('#span_norm_txt').val(selectedTxt);
        updateNormalizationRefLink();
        // update history
        var nextLastNormSearches = [
          {
            value: selectedTxt,
            id: selectedId,
          },
        ];
        $.each(lastNormSearches, function(searchNo, search) {
          if (search.id != selectedId || search.value != selectedTxt) {
            nextLastNormSearches.push(search);
          }
        });
        lastNormSearches = nextLastNormSearches;
        lastNormSearches.slice(0, maxNormSearchHistory);
        // Switch dialogs. NOTE: assuming we closed the spanForm when
        // bringing up the normSearchDialog.
        normSearchDialog.dialog('close');
      };
      var normSearchSubmit = function(evt) {
        if (normSearchSubmittable) {
          var selectedId = $('#norm_search_id').val(); 
          var selectedTxt = $('#norm_search_query').val();

          normSubmit(selectedId, selectedTxt);
        } else {
          performNormSearch();
        }
        return false;
      }
      var normSearchSubmittable = false;
      var setNormSearchSubmit = function(enable) {
        $('#norm_search_dialog-ok').button(enable ? 'enable' : 'disable');
        normSearchSubmittable = enable;
      };
      normSearchDialog.submit(normSearchSubmit);
      var chooseNormId = function(evt) {
        var $element = $(evt.target).closest('tr');
        $('#norm_search_result_select tr').removeClass('selected');
        $element.addClass('selected');
        $('#norm_search_query').val($element.attr('data-txt'));
        $('#norm_search_id').val($element.attr('data-id'));
        setNormSearchSubmit(true);
      }
      var chooseNormIdAndSubmit = function(evt) {
        chooseNormId(evt);
        normSearchSubmit(evt);
      }
      var setSpanNormSearchResults = function(response) {
        if (response.exception) {
          // TODO: better response to failure
          dispatcher.post('messages', [[['Lookup error', 'warning', -1]]]);
          return false;
        }

        if (response.items.length == 0) {
          // no results
          $('#norm_search_result_select thead').empty();
          $('#norm_search_result_select tbody').empty();
          dispatcher.post('messages', [[['No matches to search.', 'comment']]]);
          return false;
        }

        // TODO: avoid code duplication with showFileBrowser()

        var html = ['<tr>'];
        $.each(response.header, function(headNo, head) {
          html.push('<th>' + Util.escapeHTML(head[0]) + '</th>');
        });
        html.push('</tr>');
        $('#norm_search_result_select thead').html(html.join(''));

        html = [];
        var len = response.header.length;
        $.each(response.items, function(itemNo, item) {
          // NOTE: assuming ID is always the first datum in the item
          // and that the preferred text is always the second
          // TODO: Util.escapeQuotes would be expected to be
          // sufficient here, but that appears to give "DOM Exception
          // 11" in cases (try e.g. $x.html('<p a="A&B"/>'). Why? Is
          // this workaround OK?
          html.push('<tr'+
                    ' data-id="'+Util.escapeHTMLandQuotes(item[0])+'"'+
                    ' data-txt="'+Util.escapeHTMLandQuotes(item[1])+'"'+
                    '>');
          for (var i=0; i<len; i++) {
            html.push('<td>' + Util.escapeHTML(item[i]) + '</td>');
          }
          html.push('</tr>');
        });
        $('#norm_search_result_select tbody').html(html.join(''));

        $('#norm_search_result_select tbody').find('tr').
            click(chooseNormId).
            dblclick(chooseNormIdAndSubmit);

        // TODO: sorting on click on header (see showFileBrowser())
      }
      var performNormSearch = function() {
        var val = $('#norm_search_query').val();
        var db = $('#span_norm_db').val();
        dispatcher.post('ajax', [ {
                        action: 'normSearch',
                        database: db,
                        name: val,
                        collection: coll}, 'normSearchResult']);
      }
      $('#norm_search_button').click(performNormSearch);
      $('#norm_search_query').focus(function() {
        setNormSearchSubmit(false);
      });
      var showNormSearchDialog = function() {
        // if we already have non-empty ID and normalized string,
        // use these as default; otherwise take default search string
        // from annotated span and clear ID entry
        if (!$('#span_norm_id').val().match(/^\s*$/) &&
            !$('#span_norm_txt').val().match(/^\s*$/)) {
          $('#norm_search_id').val($('#span_norm_id').val());
          $('#norm_search_query').val($('#span_norm_txt').val());
        } else {
          $('#norm_search_id').val('');
          $('#norm_search_query').val($('#span_selected').text());
        }
        // blank the table
        $('#norm_search_result_select thead').empty();
        $('#norm_search_result_select tbody').empty();        
        // TODO: support for two (or more) dialogs open at the same time
        // so we don't need to hide this before showing normSearchDialog
        dispatcher.post('hideForm');
        $('#norm_search_button').val('Search ' + $('#span_norm_db').val());
        setNormSearchSubmit(false);
        dispatcher.post('showForm', [normSearchDialog]);
        $('#norm_search_query').focus().select();
      }
      $('#span_norm_txt').click(showNormSearchDialog);
      $('#norm_search_button').button();

      var arcFormSubmitRadio = function(evt) {
        // TODO: check for confirm_mode?
        arcFormSubmit(evt, $(evt.target));
      }

      var arcFormSubmit = function(evt, typeRadio) {
        typeRadio = typeRadio || $('#arc_form input:radio:checked');
        var type = typeRadio.val();
        dispatcher.post('hideForm', [arcForm]);

        arcOptions.type = type;
        arcOptions.comment = $('#arc_notes').val();
        dispatcher.post('ajax', [arcOptions, 'edited']);
        return false;
      };

      var fillArcTypesAndDisplayForm = function(evt, originType, targetType, arcType, arcId) {
        var noArcs = true;
        keymap = {};

        // separate out possible numeric suffix from type
        var noNumArcType;
        if (arcType) {
            var splitType = arcType.match(/^(.*?)(\d*)$/);
            noNumArcType = splitType[1];
        }

        var isEquiv =
          relationTypesHash &&
          relationTypesHash[noNumArcType] &&
          relationTypesHash[noNumArcType].properties &&
          relationTypesHash[noNumArcType].properties.symmetric &&
          relationTypesHash[noNumArcType].properties.transitive;

        var $scroller = $();
        if (spanTypes[originType]) {
          var arcTypes = spanTypes[originType].arcs;
          $scroller = $('#arc_roles .scroller').empty();

          // lay them out into the form
          $.each(arcTypes || [], function(arcTypeNo, arcDesc) {
            if (arcDesc.targets && arcDesc.targets.indexOf(targetType) != -1) {
              var arcTypeName = arcDesc.type;

              var isThisEquiv =
                relationTypesHash &&
                relationTypesHash[arcTypeName] &&
                relationTypesHash[arcTypeName].properties &&
                relationTypesHash[arcTypeName].properties.symmetric &&
                relationTypesHash[arcTypeName].properties.transitive;

              // do not allow equiv<->non-equiv change options
              if (arcType && isEquiv != isThisEquiv) return;

              var displayName = ((arcDesc.labels && arcDesc.labels[0]) || 
                                 arcTypeName);
              var $checkbox = $('<input id="arc_' + arcTypeName + '" type="radio" name="arc_type" value="' + arcTypeName + '"/>');
              var $label = $('<label class="arc_type_label" for="arc_' + arcTypeName + '"/>').text(displayName);
              var $div = $('<div/>').append($checkbox).append($label);
              $scroller.append($div);
              if (arcDesc.hotkey) {
                keymap[arcDesc.hotkey] = '#arc_' + arcTypeName;
                var name = $label.html();
                var replace = true;
                name = name.replace(new RegExp("(&[^;]*?)?(" + arcDesc.hotkey + ")", 'gi'),
                  function(all, entity, letter) {
                    if (replace && !entity) {
                      replace = false;
                      var hotkey = arcDesc.hotkey.toLowerCase() == letter
                          ? arcDesc.hotkey.toLowerCase()
                          : arcDesc.hotkey.toUpperCase();
                      return '<span class="accesskey">' + Util.escapeHTML(hotkey) + '</span>';
                    }
                    return all;
                  });
                $label.html(name);
              }

              noArcs = false;
            }
          });
        }

        if (noArcs) {
          if (arcId) {
            // let the user delete or whatever, even on bad config
            // (note that what's shown to the user is w/o possible num suffix)
            var $checkbox = $('<input id="arc_' + arcType + '" type="hidden" name="arc_type" value="' + noNumArcType + '"/>');
            $scroller.append($checkbox);
          } else {
            // can't make a new arc
            dispatcher.post('messages',
              [[["No choices for " +
                 Util.spanDisplayForm(spanTypes, originType) +
                 " -> " +
                 Util.spanDisplayForm(spanTypes, targetType),
                 'warning']]]);
            return;
          }
        }

        var reversalPossible = false;
        if (arcId) {
          // something was selected
          var focus = arcId instanceof Array ? arcId : [arcId];
          var hash = new URLHash(coll, doc, { focus: [focus] }).getHash();
          $('#arc_highlight_link').attr('href', hash).show(); // TODO incorrect
          var el = $('#arc_' + arcType)[0];
          if (el) {
            el.checked = true;
          } else {
              // try w/o numeric suffix
              el = $('#arc_' + noNumArcType)[0];
              if (el) {
                  el.checked = true;
              }
          }

          $('#arc_form_reselect, #arc_form_delete').show();
          keymap[$.ui.keyCode.DELETE] = 'arc_form_delete';
          keymap[$.ui.keyCode.INSERT] = 'arc_form_reselect';

          var backTargetType = spanTypes[targetType];
          if (backTargetType) {
            $.each(backTargetType.arcs || [], function(backArcTypeNo, backArcDesc) {
              if ($.inArray(originType, backArcDesc.targets || []) != -1) {
                reversalPossible = true;
                return false; // terminate the loop
              }
            });
          }

          arcForm.dialog('option', { title: 'Edit Annotation' });
        } else {
          // new arc
          $('#arc_highlight_link').hide();
          el = $('#arc_form input:radio:first')[0];
          if (el) {
            el.checked = true;
          }

          $('#arc_form_reselect, #arc_form_delete, #arc_form_reverse').hide();

          arcForm.dialog('option', { title: 'New Annotation' });
        }
        if (reversalPossible) {
          $('#arc_form_reverse').show();
          keymap['S-' + $.ui.keyCode.INSERT] = 'arc_form_reverse';
        } else {
          $('#arc_form_reverse').hide();
        }

        if (!Configuration.confirmModeOn) {
          arcForm.find('#arc_roles input:radio').click(arcFormSubmitRadio);
        }

        var arcAnnotatorNotes;
        var isBinaryRelation = arcId && !(arcId instanceof Array);
        if (isBinaryRelation) {
          // only for relation arcs
          var ed = data.eventDescs[arcId];
          arcAnnotatorNotes = ed && ed.annotatorNotes;
        }
        if (arcAnnotatorNotes) {
          $('#arc_notes').val(arcAnnotatorNotes);
        } else {
          $('#arc_notes').val('');
        }

        // disable notes for arc types that don't support storage (#945)
        if(!isBinaryRelation || isEquiv) {
          // disable the actual input
          $('#arc_notes').attr('disabled', 'disabled');
          // add to fieldset for style
          $('#arc_notes_fieldset').attr('disabled', 'disabled');
        } else {
          $('#arc_notes').removeAttr('disabled')
          $('#arc_notes_fieldset').removeAttr('disabled')
        }

        dispatcher.post('showForm', [arcForm]);
        $('#arc_form-ok').focus();
        adjustToCursor(evt, arcForm.parent());
      };

      var reverseArc = function(evt) {
        var eventDataId = $(evt.target).attr('data-arc-ed');
        dispatcher.post('hideForm');
        arcOptions.action = 'reverseArc';
        delete arcOptions.old_target;
        delete arcOptions.old_type;
        dispatcher.post('ajax', [arcOptions, 'edited']);
      };

      var deleteArc = function(evt) {
        if (Configuration.confirmModeOn && !confirm("Are you sure you want to delete this annotation?")) {
          return;
        }
        var eventDataId = $(evt.target).attr('data-arc-ed');
        dispatcher.post('hideForm');
        arcOptions.action = 'deleteArc';
        dispatcher.post('ajax', [arcOptions, 'edited']);
      };

      var reselectArc = function(evt) {
        dispatcher.post('hideForm');
        svgElement.addClass('reselect');
        $('g[data-from="' + arcOptions.origin + '"][data-to="' + arcOptions.target + '"]').addClass('reselect');
        startArcDrag(arcOptions.origin);
      };

      var arcForm = $('#arc_form');
      dispatcher.post('initForm', [arcForm, {
          width: 500,
          buttons: [{
              id: 'arc_form_reverse',
              text: "Reverse",
              click: reverseArc
            }, {
              id: 'arc_form_delete',
              text: "Delete",
              click: deleteArc
            }, {
              id: 'arc_form_reselect',
              text: 'Reselect',
              click: reselectArc
            }],
          alsoResize: '#arc_roles',
          close: function(evt) {
            keymap = null;
          }
        }]);
      arcForm.submit(arcFormSubmit);
      // set button tooltips (@amadanmath: can this be done in init?)
      $('#arc_form_reselect').attr('title', 'Re-select the annotation this connects into.');
      $('#arc_form_delete').attr('title', 'Delete this annotation.');

      var stopArcDrag = function(target) {
        if (arcDragOrigin) {
          if (!target) {
            target = $('.badTarget');
          }
          target.removeClass('badTarget');
          arcDragOriginGroup.removeClass('highlight');
          if (target) {
            target.parent().removeClass('highlight');
          }
          if (arcDragArc) {
            svg.remove(arcDragArc);
            arcDrag = null;
          }
          arcDragOrigin = null;
          if (arcOptions) {
              $('g[data-from="' + arcOptions.origin + '"][data-to="' + arcOptions.target + '"]').removeClass('reselect');
          }
          svgElement.removeClass('reselect');
        }
        svgElement.removeClass('unselectable');
        $('.reselectTarget').removeClass('reselectTarget');
      };

      var onMouseUp = function(evt) {
        //Removed by Renaud on 2016-03-10
        //if (that.user === null) return;

        var target = $(evt.target);

        // three things that are clickable in SVG
        var targetSpanId = target.data('span-id');
        var targetChunkId = target.data('chunk-id');
        var targetArcRole = target.data('arc-role');
        if (!(targetSpanId !== undefined || targetChunkId !== undefined || targetArcRole !== undefined)) {
          // misclick
          clearSelection();
          stopArcDrag(target);
          return;
        }

        // is it arc drag end?
        if (arcDragOrigin) {
          var origin = arcDragOrigin;
          var targetValid = target.hasClass('reselectTarget');
          stopArcDrag(target);
          if ((id = target.attr('data-span-id')) && origin != id && targetValid) {
            var originSpan = data.spans[origin];
            var targetSpan = data.spans[id];
            if (arcOptions && arcOptions.old_target) {
              arcOptions.target = targetSpan.id;
              dispatcher.post('ajax', [arcOptions, 'edited']);
            } else {
              arcOptions = {
                action: 'createArc',
                origin: originSpan.id,
                target: targetSpan.id,
                collection: coll,
                'document': doc
              };
              $('#arc_origin').text(Util.spanDisplayForm(spanTypes, originSpan.type)+' ("'+originSpan.text+'")');
              $('#arc_target').text(Util.spanDisplayForm(spanTypes, targetSpan.type)+' ("'+targetSpan.text+'")');
              fillArcTypesAndDisplayForm(evt, originSpan.type, targetSpan.type);
              // for precise timing, log dialog display to user.
              dispatcher.post('logAction', ['arcSelected']);
            }
          }
        } else if (!evt.ctrlKey) {
          // if not, then is it span selection? (ctrl key cancels)
          var sel = window.getSelection();
          var chunkIndexFrom = sel.anchorNode && $(sel.anchorNode.parentNode).attr('data-chunk-id');
          var chunkIndexTo = sel.focusNode && $(sel.focusNode.parentNode).attr('data-chunk-id');

          // fallback for firefox (at least):
          // it's unclear why, but for firefox the anchor and focus
          // node parents are always undefined, the the anchor and
          // focus nodes themselves do (often) have the necessary
          // chunk ID. However, anchor offsets are almost always
          // wrong, so we'll just make a guess at what the user might
          // be interested in tagging instead of using what's given.
          var anchorOffset = null;
          var focusOffset = null;
          if (chunkIndexFrom === undefined && chunkIndexTo === undefined &&
              $(sel.anchorNode).attr('data-chunk-id') &&
              $(sel.focusNode).attr('data-chunk-id')) {
            // A. Scerri FireFox chunk

            var range = sel.getRangeAt(0);
            var svgOffset = $(svg._svg).offset();
            var flip = false;
            var tries = 0;
            while (tries < 2) {
              var sp = svg._svg.createSVGPoint();
              sp.x = (flip ? evt.pageX : dragStartedAt.pageX) - svgOffset.left;
              sp.y = (flip ? evt.pageY : dragStartedAt.pageY) - (svgOffset.top + 8);
              var startsAt = range.startContainer;
              anchorOffset = startsAt.getCharNumAtPosition(sp);
              chunkIndexFrom = startsAt && $(startsAt).attr('data-chunk-id');
              if (anchorOffset != -1) {
                break;
              }
              flip = true;
              tries++;
            }
            sp.x = (flip ? dragStartedAt.pageX : evt.pageX) - svgOffset.left;
            sp.y = (flip ? dragStartedAt.pageY : evt.pageY) - (svgOffset.top + 8);
            var endsAt = range.endContainer;
            focusOffset = endsAt.getCharNumAtPosition(sp);

            if (range.startContainer == range.endContainer && anchorOffset > focusOffset) {
              var t = anchorOffset;
              anchorOffset = focusOffset;
              focusOffset = t;
              flip = false;
            }
            if (focusOffset != -1) {
              focusOffset++;
            }
            chunkIndexTo = endsAt && $(endsAt).attr('data-chunk-id');

            //console.log('fallback from', data.chunks[chunkIndexFrom], anchorOffset);
            //console.log('fallback to', data.chunks[chunkIndexTo], focusOffset);
          } else {
            // normal case, assume the exact offsets are usable
            anchorOffset = sel.anchorOffset;
            focusOffset = sel.focusOffset;
          }

          if (chunkIndexFrom !== undefined && chunkIndexTo !== undefined) {
            var chunkFrom = data.chunks[chunkIndexFrom];
            var chunkTo = data.chunks[chunkIndexTo];
            var selectedFrom = chunkFrom.from + anchorOffset;
            var selectedTo = chunkTo.from + focusOffset;
            sel.removeAllRanges();

            if (selectedFrom > selectedTo) {
              var tmp = selectedFrom; selectedFrom = selectedTo; selectedTo = tmp;
            }
            // trim
            while (selectedFrom < selectedTo && " \n\t".indexOf(data.text.substr(selectedFrom, 1)) !== -1) selectedFrom++;
            while (selectedFrom < selectedTo && " \n\t".indexOf(data.text.substr(selectedTo - 1, 1)) !== -1) selectedTo--;

            // shift+click allows zero-width spans
            if (selectedFrom === selectedTo && !evt.shiftKey) {
              // simple click (zero-width span)
              return;
            }

            var newOffset = [selectedFrom, selectedTo];
            if (reselectedSpan) {
              var newOffsets = reselectedSpan.offsets.slice(0); // clone
              spanOptions.old_offsets = JSON.stringify(reselectedSpan.offsets);
              if (selectedFragment !== null) {
                if (selectedFragment !== false) {
                  newOffsets.splice(selectedFragment, 1);
                }
                newOffsets.push(newOffset);
                newOffsets.sort(Util.cmpArrayOnFirstElement);
                spanOptions.offsets = newOffsets;
              } else {
                spanOptions.offsets = [newOffset];
              }
            } else {
              spanOptions = {
                action: 'createSpan',
                offsets: [newOffset]
              }
            }

/* In relation to #786, removed the cross-sentence checking code
            var crossSentence = true;
            $.each(sourceData.sentence_offsets, function(sentNo, startEnd) {
              if (selectedTo <= startEnd[1]) {
                // this is the sentence

                if (selectedFrom >= startEnd[0]) {
                  crossSentence = false;
                }
                return false;
              }
            });

            if (crossSentence) {
              // attempt to annotate across sentence boundaries; not supported
              dispatcher.post('messages', [[['Error: cannot annotate across a sentence break', 'error']]]);
              if (reselectedSpan) {
                $(reselectedSpan.rect).removeClass('reselect');
              }
              reselectedSpan = null;
              svgElement.removeClass('reselect');
            } else
*/
            if (!Configuration.rapidModeOn || reselectedSpan != null) {
              // normal span select in standard annotation mode
              // or reselect: show selector
              var spanText = data.text.substring(selectedFrom, selectedTo);
              fillSpanTypesAndDisplayForm(evt, spanText, reselectedSpan);
              // for precise timing, log annotation display to user.
              dispatcher.post('logAction', ['spanSelected']);
            } else {
              // normal span select in rapid annotation mode: call
              // server for span type candidates
              var spanText = data.text.substring(selectedFrom, selectedTo);
              // TODO: we're currently storing the event to position the
              // span form using adjustToCursor() (which takes an event),
              // but this is clumsy and suboptimal (user may have scrolled
              // during the ajax invocation); think of a better way.
              lastRapidAnnotationEvent = evt;
              dispatcher.post('ajax', [ { 
                              action: 'suggestSpanTypes',
                              collection: coll,
                              'document': doc,
                              start: selectedFrom,
                              end: selectedTo,
                              text: spanText,
                              model: $('#rapid_model').val(),
                              }, 'suggestedSpanTypes']);
            }
          }
        }
      };

      var receivedSuggestedSpanTypes = function(sugg) {
        if (sugg.exception) {
          // failed in one way or another; assume rapid mode cannot be
          // used.
          dispatcher.post('messages', [[['Rapid annotation mode error; returning to normal mode.', 'warning', -1]]]);
          setAnnotationSpeed(2);
          dispatcher.post('configurationUpdated');
          return false;
        }

        // make sure the suggestions are for the current collection and document
        if (sugg.collection != coll || sugg.document != doc) {
          dispatcher.post('messages', [[['Error: collection/document mismatch for span suggestions', 'error']]]);
          return false;
        }
        // initialize for submission
        // TODO: is this a reasonable place to do this?
        rapidSpanOptions = {
          offsets: [[sugg.start, sugg.end]],
        };
        rapidFillSpanTypesAndDisplayForm(sugg.start, sugg.end, sugg.text, sugg.types);
      };

      var toggleCollapsible = function($el, state) {
        var opening = state !== undefined ? state : !$el.hasClass('open');
        var $collapsible = $el.parent().find('.collapsible:first');
        if (opening) {
          $collapsible.addClass('open');
          $el.addClass('open');
        } else {
          $collapsible.removeClass('open');
          $el.removeClass('open');
        }
      };

      var collapseHandler = function(evt) {
        toggleCollapsible($(evt.target));
      }

      var spanFormSubmitRadio = function(evt) {
        if (Configuration.confirmModeOn) {
          showValidAttributes();
          showValidNormalizations();
          $('#span_form-ok').focus();
        } else {
          spanFormSubmit(evt, $(evt.target));
        }
      }

      var rapidSpanFormSubmitRadio = function(evt) {
        rapidSpanFormSubmit(evt, $(evt.target));
      }

      var rememberData = function(_data) {
        if (_data && !_data.exception) {
          data = _data;
        }
      };

      var addSpanTypesToDivInner = function($parent, types, category) {
        if (!types) return;

        $.each(types, function(typeNo, type) {
          if (type === null) {
            $parent.append('<hr/>');
          } else {
            var name = type.name;
            var $input = $('<input type="radio" name="span_type"/>').
              attr('id', 'span_' + type.type).
              attr('value', type.type);
            if (category) {
              $input.attr('category', category);
            }
            // use a light version of the span color as BG
            var spanBgColor = spanTypes[type.type] && spanTypes[type.type].bgColor || '#ffffff';
            spanBgColor = Util.adjustColorLightness(spanBgColor, spanBoxTextBgColorLighten);
            var $label = $('<label class="span_type_label"/>').
              attr('for', 'span_' + type.type).
              text(name);
            if (type.unused) {
              $input.attr({
                disabled: 'disabled',
                unused: 'unused'
              });
              $label.css('font-weight', 'bold');
            } else {
              $label.css('background-color', spanBgColor);
            }
            var $collapsible = $('<div class="collapsible open"/>');
            var $content = $('<div class="item_content"/>').
              append($input).
              append($label).
              append($collapsible);
            var $collapser = $('<div class="collapser open"/>');
            var $div = $('<div class="item"/>');
            if (type.children.length) {
              $div.append($collapser)
            }
            $div.append($content);
            addSpanTypesToDivInner($collapsible, type.children, category);
            $parent.append($div);
            if (type.hotkey) {
              spanKeymap[type.hotkey] = 'span_' + type.type;
              var name = $label.html();
              var replace = true;
              name = name.replace(new RegExp("(&[^;]*?)?(" + type.hotkey + ")", 'gi'),
                function(all, entity, letter) {
                  if (replace && !entity) {
                    replace = false;
                    var hotkey = type.hotkey.toLowerCase() == letter
                        ? type.hotkey.toLowerCase()
                        : type.hotkey.toUpperCase();
                    return '<span class="accesskey">' + Util.escapeHTML(hotkey) + '</span>';
                  }
                  return all;
                });
              $label.html(name);
            }
          }
        });
      };
      var addSpanTypesToDiv = function($top, types, heading) {
        $scroller = $('<div class="scroller"/>');
        $legend = $('<legend/>').text(heading);
        $fieldset = $('<fieldset/>').append($legend).append($scroller);
        $top.append($fieldset);
        addSpanTypesToDivInner($scroller, types);
      };
      var addAttributeTypesToDiv = function($top, types, category) {
        $.each(types, function(attrNo, attr) {
          var escapedType = Util.escapeQuotes(attr.type);
          var attrId = category+'_attr_'+escapedType;
          if (attr.unused) {
            var $input = $('<input type="hidden" id="'+attrId+'" value=""/>');
            $top.append($input);
          } else if (attr.bool) {
            var escapedName = Util.escapeQuotes(attr.name);
            var $input = $('<input type="checkbox" id="'+attrId+
                           '" value="' + escapedType + 
                           '" category="' + category + '"/>');
            var $label = $('<label class="attribute_type_label" for="'+attrId+
                           '" data-bare="' + escapedName + '">&#x2610; ' + 
                           escapedName + '</label>');
            $top.append($input).append($label);
            $input.button();
            $input.change(onBooleanAttrChange);
          } else {
            var $div = $('<div class="ui-button ui-button-text-only attribute_type_label"/>');
            var $select = $('<select id="'+attrId+'" class="ui-widget ui-state-default ui-button-text" category="' + category + '"/>');
            var $option = $('<option class="ui-state-default" value=""/>').text(attr.name + ': ?');
            $select.append($option);
            $.each(attr.values, function(valType, value) {
              $option = $('<option class="ui-state-active" value="' + Util.escapeQuotes(valType) + '"/>').text(attr.name + ': ' + (value.name || valType));
              $select.append($option);
            });
            $div.append($select);
            $top.append($div);
            $select.change(onMultiAttrChange);
          }
        });
      }

      var setSpanTypeSelectability = function(category) {
        // TODO: this implementation is incomplete: we should ideally
        // disable not only categories of types (events or entities),
        // but the specific set of types that are incompatible with
        // the current attribute settings.
        
        // just assume all attributes are event attributes
        // TODO: support for entity attributes
        // TODO2: the above comment is almost certainly false, check and remove
        $('#span_form input:not([unused])').removeAttr('disabled');
        var $toDisable;
        if (category == "event") {
          $toDisable = $('#span_form input[category="entity"]');
        } else if (category == "entity") {
          $toDisable = $('#span_form input[category="event"]');
        } else {
          console.error('Unrecognized attribute category:', category);
          $toDisable = $();
        }
        var $checkedToDisable = $toDisable.filter(':checked');
        $toDisable.attr('disabled', true);
        // the disable may leave the dialog in a state where nothing
        // is checked, which would cause error on "OK". In this case,
        // check the first valid choice.
        if ($checkedToDisable.length) {
          var $toCheck = $('#span_form input[category="' + category + '"]:first');
          // so weird, attr('checked', 'checked') fails sometimes, so
          // replaced with more "metal" version
          $toCheck[0].checked = true
        }
      }

      var onMultiAttrChange = function(evt) {
        if ($(this).val() == '') {
          $('#span_form input:not([unused])').removeAttr('disabled');
        } else {
          var attrCategory = evt.target.getAttribute('category');
          setSpanTypeSelectability(attrCategory);
          if (evt.target.selectedIndex) {
            $(evt.target).addClass('ui-state-active');
          } else {
            $(evt.target).removeClass('ui-state-active');
          }
        }
      }

      var onBooleanAttrChange = function(evt) {
        var attrCategory = evt.target.getAttribute('category');
        setSpanTypeSelectability(attrCategory);
        updateCheckbox($(evt.target));
      };

      var rememberSpanSettings = function(response) {
        spanKeymap = {};

        // TODO: check for exceptions in response

        // fill in entity and event types
        var $entityScroller = $('#entity_types div.scroller').empty();
        addSpanTypesToDivInner($entityScroller, response.entity_types, 'entity');
        var $eventScroller = $('#event_types div.scroller').empty();
        addSpanTypesToDivInner($eventScroller, response.event_types, 'event');

        // fill in attributes
        var $entattrs = $('#entity_attributes div.scroller').empty();
        addAttributeTypesToDiv($entattrs, entityAttributeTypes, 'entity');

        var $eveattrs = $('#event_attributes div.scroller').empty();
        addAttributeTypesToDiv($eveattrs, eventAttributeTypes, 'event');

        // fill search options in span dialog
        searchConfig = response.search_config;
        var $searchlinks  = $('#span_search_links').empty();
        var $searchlinks2 = $('#viewspan_search_links').empty();
        var firstLink=true;
        var linkFilled=false;
        if (searchConfig) {
          $.each(searchConfig, function(searchNo, search) {
            if (!firstLink) {
              $searchlinks.append(',\n')
              $searchlinks2.append(',\n')
            }
            firstLink=false;
            $searchlinks.append('<a target="_blank" id="span_'+search[0]+'" href="#">'+search[0]+'</a>');
            $searchlinks2.append('<a target="_blank" id="viewspan_'+search[0]+'" href="#">'+search[0]+'</a>');
            linkFilled=true;
          });
        }
        if (linkFilled) {
          $('#span_search_fieldset').show();
          $('#viewspan_search_fieldset').show();
        } else {
          $('#span_search_fieldset').hide();
          $('#viewspan_search_fieldset').hide();
        }

        spanForm.find('#entity_types input:radio').click(spanFormSubmitRadio);
        spanForm.find('#event_types input:radio').click(spanFormSubmitRadio);
        spanForm.find('.collapser').click(collapseHandler);
      };

      var tagCurrentDocument = function(taggerId) {
        var tagOptions = {
          action: 'tag',
          collection: coll,
          'document': doc,
          tagger: taggerId,
        };
        dispatcher.post('ajax', [tagOptions, 'edited']);
      }

      var setupTaggerUI = function(response) {
        var taggers = response.ner_taggers || [];
        $taggerButtons = $('#tagger_buttons').empty();
        $.each(taggers, function(taggerNo, tagger) {
          // expect a tuple with ID, name, model, and URL
          var taggerId = tagger[0];
          var taggerName = tagger[1];
          var taggerModel = tagger[2];
          if (!taggerId || !taggerName || !taggerModel) {
            dispatcher.post('messages', [[['Invalid tagger specification received from server', 'error']]]);
            return true; // continue
          }
          var $row = $('<div class="optionRow"/>');
          var $label = $('<span class="optionLabel">'+Util.escapeHTML(taggerName)+'</span>');
          var $button = $('<input id="tag_'+Util.escapeHTML(taggerId)+'_button" type="button" value="'+Util.escapeHTML(taggerModel)+'" tabindex="-1" title="Automatically tag the current document."/>');
          $row.append($label).append($button);
          $taggerButtons.append($row);
          $button.click(function(evt) {
            tagCurrentDocument(taggerId);
          });
        });
        $taggerButtons.find('input').button();
        // if nothing was set up, hide the whole fieldset and show
        // a message to this effect, else the other way around
        if ($taggerButtons.find('input').length == 0) {
          $('#auto_tagging_fieldset').hide();
          $('#no_tagger_message').show();
        } else {
          $('#auto_tagging_fieldset').show();
          $('#no_tagger_message').hide();
        }
      }

      // recursively traverses type hierarchy (entity_types or
      // event_types) and stores normalizations in normDbsByType.
      var rememberNormDbsForType = function(types) {
        if (!types) return;

        $.each(types, function(typeNo, type) {
          if (type === null) {
            // spacer, no-op
          } else {
            normDbsByType[type.type] = type.normalizations || [];
            if (type.children.length) {
              rememberNormDbsForType(type.children);
            }
          }
        });
      };

      var setupNormalizationUI = function(response) {
        var norm_resources = response.normalization_config || [];
        var $norm_select = $('#span_norm_db');
        // clear possible existing
        $norm_select.empty();
        // fill in new
        html = [];
        $.each(norm_resources, function(normNo, norm) {
          var normName = norm[0], normUrl = norm[1], normUrlBase = norm[2];
          var serverDb = norm[3];
          html.push('<option value="'+Util.escapeHTML(normName)+'">'+
                    Util.escapeHTML(normName)+'</option>');
          // remember the urls for updates
          normDbUrlByDbName[normName] = normUrl;
          normDbUrlBaseByDbName[normName] = normUrlBase;
        });
        // remember per-type appropriate DBs
        normDbsByType = {};
        rememberNormDbsForType(response.entity_types);
        rememberNormDbsForType(response.event_types);
        // set up HTML
        $norm_select.html(html.join(''));
        // if we have nothing, just hide the whole thing
        if (!norm_resources.length) {
          $('#norm_fieldset').hide();
        } else {
          $('#norm_fieldset').show();
        }
      }

      // hides the reference link in the normalization UI
      var hideNormalizationRefLink = function() {
        $('#span_norm_ref_link').hide();
      }

      // updates the reference link in the normalization UI according
      // to the current value of the normalization DB and ID.
      var updateNormalizationRefLink = function() {
        var $normId = $('#span_norm_id');
        var $normLink = $('#span_norm_ref_link');
        var normId = $normId.val();
        var $normDb = $('#span_norm_db');
        var normDb = $normDb.val();
        if (!normId || !normDb || normId.match(/^\s*$/)) {
          $normLink.hide();
        } else {
          var base = normDbUrlBaseByDbName[normDb];
          // assume hidden unless everything goes through
          $normLink.hide();
          if (!base) {
            // base URL is now optional, just skip link generation if not set
            ;
          } else if (base.indexOf('%s') == -1) {
            dispatcher.post('messages', [[['Base URL "'+base+'" for '+normDb+' does not contain "%s"', 'error']]]);
          } else {
            // TODO: protect against strange chars in ID
            link = base.replace('%s', normId);
            $normLink.attr('href', link);
            $normLink.show();
          }
        }
      }

      // updates the DB search link in the normalization UI according
      // to the current value of the normalization DB.
      var updateNormalizationDbLink = function() {
        var $dbLink = $('#span_norm_db_link');
        var $normDb = $('#span_norm_db');
        var normDb = $normDb.val();
        if (!normDb) return; // no normalisation configured
        var link = normDbUrlByDbName[normDb];
        if (!link || link.match(/^\s*$/)) {
          dispatcher.post('messages', [[['No URL for '+normDb, 'error']]]);
          $dbLink.hide();
        } else {
          // TODO: protect against weirdness in DB link
          $dbLink.attr('href', link);
          $dbLink.show();
        }
      }

      // resets user-settable normalization-related UI elements to a
      // blank state (does not blank #span_norm_db <select>).
      var clearNormalizationUI = function() {
        var $normId = $('#span_norm_id');
        var $normText = $('#span_norm_txt');
        $normId.val('');
        oldSpanNormIdValue = '';
        $normId.removeClass('valid_value').removeClass('invalid_value');
        $normText.val('');
        updateNormalizationRefLink();
      }

      // returns the normalizations currently filled in the span
      // dialog, or empty list if there are none
      var spanNormalizations = function() {
        // Note that only no or one normalization is supported in the
        // UI at the moment.
        var normalizations = [];
        var normDb = $('#span_norm_db').val();
        var normId = $('#span_norm_id').val();
        var normText = $('#span_norm_txt').val();
        // empty ID -> no normalization
        if (!normId.match(/^\s*$/)) {
          normalizations.push([normDb, normId, normText]);
        }
        return normalizations;
      }

      // returns attributes that are valid for the selected type in
      // the span dialog
      var spanAttributes = function(typeRadio) {
        typeRadio = typeRadio || $('#span_form input:radio:checked');
        var attributes = {};
        var attributeTypes;
        var category = typeRadio.attr('category');
        if (category == 'entity') {
          attributeTypes = entityAttributeTypes;
        } else if (category == 'event') {
          attributeTypes = eventAttributeTypes;
        } else {
          console.error('Unrecognized type category:', category);
        }
        $.each(attributeTypes, function(attrNo, attr) {
          var $input = $('#'+category+'_attr_'+Util.escapeQuotes(attr.type));
          if (attr.bool) {
            attributes[attr.type] = $input[0].checked;
          } else if ($input[0].selectedIndex) {
            attributes[attr.type] = $input.val();
          }
        });
        return attributes;
      }

      var spanAndAttributeTypesLoaded = function(_spanTypes, 
                                                 _entityAttributeTypes,
                                                 _eventAttributeTypes,
                                                 _relationTypesHash) {
        spanTypes = _spanTypes;
        entityAttributeTypes = _entityAttributeTypes;
        eventAttributeTypes = _eventAttributeTypes;
        relationTypesHash = _relationTypesHash;
        // for easier access
        allAttributeTypes = $.extend({}, 
                                     entityAttributeTypes, 
                                     eventAttributeTypes);
      };

      var gotCurrent = function(_coll, _doc, _args) {
        coll = _coll;
        doc = _doc;
        args = _args;
      };

      var undoStack = [];
      var edited = function(response) {
        var x = response.exception;
        if (x) {
          if (x == 'annotationIsReadOnly') {
            dispatcher.post('messages', [[["This document is read-only and can't be edited.", 'error']]]);
          } else if (x == 'spanOffsetOverlapError') {
            // createSpan with overlapping frag offsets; reset offsets
            // @amadanmath: who holds the list of offsets for a span?
            // how to reset this?
          } else {
            dispatcher.post('messages', [[['Unknown error '+x, 'error']]]);
          }
          if (reselectedSpan) {
            $(reselectedSpan.rect).removeClass('reselect');
            reselectedSpan = null;
          }
          svgElement.removeClass('reselect');
          $('#waiter').dialog('close');
        } else {
          if (response.edited == undefined) {
            console.warn('Warning: server response to edit has', response.edited, 'value for "edited"');
          } else {
            args.edited = response.edited;
          }
          var sourceData = response.annotations;
          sourceData.document = doc;
          sourceData.collection = coll;
          // this "prevent" is to protect against reloading (from the
          // server) the very data that we just received as part of the
          // response to the edit.
          if (response.undo != undefined) {
            undoStack.push([coll, sourceData.document, response.undo]);
          }
          dispatcher.post('preventReloadByURL');
          dispatcher.post('setArguments', [args]);
          dispatcher.post('renderData', [sourceData]);
        }
      };


      // TODO: why are these globals defined here instead of at the top?
      var spanForm = $('#span_form');
      var rapidSpanForm = $('#rapid_span_form');
    
      var deleteSpan = function() {
        if (Configuration.confirmModeOn && !confirm("Are you sure you want to delete this annotation?")) {
          return;
        }
        $.extend(spanOptions, {
          action: 'deleteSpan',
          collection: coll,
          'document': doc,
        });
        spanOptions.offsets = JSON.stringify(spanOptions.offsets);
        dispatcher.post('ajax', [spanOptions, 'edited']);
        dispatcher.post('hideForm');
        $('#waiter').dialog('open');
      };

      var reselectSpan = function() {
        dispatcher.post('hideForm');
        svgElement.addClass('reselect');
        $(editedSpan.rect).addClass('reselect');
        reselectedSpan = editedSpan;
        selectedFragment = null;
      };

      var splitForm = $('#split_form');
      splitForm.submit(function(evt) {
        var splitRoles = [];
        $('#split_roles input:checked').each(function() {
          splitRoles.push($(this).val());
        });
        $.extend(spanOptions, {
            action: 'splitSpan',
            'args': $.toJSON(splitRoles),
            collection: coll,
            'document': doc,
          });
        spanOptions.offsets = JSON.stringify(spanOptions.offsets);
        dispatcher.post('hideForm');
        dispatcher.post('ajax', [spanOptions, 'edited']);
        return false;
      });
      dispatcher.post('initForm', [splitForm, {
          alsoResize: '.scroll_fset',
          width: 400
        }]);
      var splitSpan = function() {
        dispatcher.post('hideForm');
        var $roles = $('#split_roles').empty();
        var numRoles = repeatingArcTypes.length;
        var roles = $.each(repeatingArcTypes, function() {
          var $role = $('<input id="split_on_' + Util.escapeQuotes(this) +
            '" type="checkbox" name="' + Util.escapeQuotes(this) +
            '" value="' + Util.escapeQuotes(this) + '"/>');
          if (numRoles == 1) {
            // a single role will be selected automatically
            $role.click();
          }
          var $label = $('<label for="split_on_' + Util.escapeQuotes(this) +
            '">' + Util.escapeQuotes(this) + '</label>');
          $roles.append($role).append($label);
        });
        var $roleButtons = $roles.find('input').button();
        
        dispatcher.post('showForm', [splitForm]);
      };

      var addFragment = function() {
        dispatcher.post('hideForm');
        svgElement.addClass('reselect');
        $(editedSpan.rect).addClass('reselect');
        reselectedSpan = editedSpan;
        selectedFragment = false;
      };

      var reselectFragment = function() {
        addFragment();
        selectedFragment = editedFragment;
      };

      var deleteFragment = function() {
        if (Configuration.confirmModeOn && !confirm("Are you sure you want to delete this fragment?")) {
          return;
        }
        var offsets = editedSpan.offsets;
        spanOptions.old_offsets = JSON.stringify(offsets);
        offsets.splice(editedFragment, 1);

        $.extend(spanOptions, {
          collection: coll,
          'document': doc,
          offsets: JSON.stringify(offsets),
        });

        spanOptions.attributes = $.toJSON(spanAttributes());

        spanOptions.normalizations = $.toJSON(spanNormalizations());

        dispatcher.post('ajax', [spanOptions, 'edited']);
        dispatcher.post('hideForm');
        $('#waiter').dialog('open');
      };

      dispatcher.post('initForm', [spanForm, {
          alsoResize: '#entity_and_event_wrapper',
          width: 760,
          buttons: [{
              id: 'span_form_add_fragment',
              text: "Add Frag.",
              click: addFragment
            }, {
              id: 'span_form_delete',
              text: "Delete",
              click: deleteSpan
            }, {
              id: 'span_form_delete_fragment',
              text: "Delete Frag.",
              click: deleteFragment
            }, {
              id: 'span_form_reselect',
              text: 'Move',
              click: reselectSpan
            }, {
              id: 'span_form_reselect_fragment',
              text: 'Move Frag.',
              click: reselectFragment
            }, {
              id: 'span_form_split',
              text: 'Split',
              click: splitSpan
            }
          ],
          close: function(evt) {
            keymap = null;
            if (reselectedSpan) {
              $(reselectedSpan.rect).removeClass('reselect');
              reselectedSpan = null;
              svgElement.removeClass('reselect');
            }
          }
        }]);
      // set button tooltips (@amadanmath: can this be done in init?)
      $('#span_form_reselect').attr('title', 'Re-select the text span that this annotation marks.');
      $('#span_form_delete').attr('title', 'Delete this annotation.');
      $('#span_form_split').attr('title', 'Split this annotation into multiple similar annotations, distributing its arguments.');

      dispatcher.post('initForm', [rapidSpanForm, {
          alsoResize: '#rapid_span_types',
          width: 400,             
          close: function(evt) {
            keymap = null;
          }
        }]);

      var spanFormSubmit = function(evt, typeRadio) {
        typeRadio = typeRadio || $('#span_form input:radio:checked');
        var type = typeRadio.val();
        $('#span_form-ok').blur();
        dispatcher.post('hideForm');
        $.extend(spanOptions, {
          action: 'createSpan',
          collection: coll,
          'document': doc,
          type: type,
          comment: $('#span_notes').val()
        });

        spanOptions.attributes = $.toJSON(spanAttributes());

        spanOptions.normalizations = $.toJSON(spanNormalizations());

        if (spanOptions.offsets) {
          spanOptions.offsets = $.toJSON(spanOptions.offsets);
        }

        // unfocus all elements to prevent focus being kept after
        // hiding them
        spanForm.parent().find('*').blur();

        $('#waiter').dialog('open');
        dispatcher.post('ajax', [spanOptions, 'edited']);
        return false;
      };
      $('#span_notes').focus(function () {
          keymap = null;
        }).blur(function () {
          keymap = spanKeymap;
        });
      spanForm.submit(spanFormSubmit);

      var rapidSpanFormSubmit = function(evt, typeRadio) {
        typeRadio = typeRadio || $('#rapid_span_form input:radio:checked');
        var type = typeRadio.val();

        // unfocus all elements to prevent focus being kept after
        // hiding them
        rapidSpanForm.parent().find('*').blur();
        dispatcher.post('hideForm');

        if (type == "") {
          // empty type value signals the special case where the user
          // selected "none of the above" of the proposed types and
          // the normal dialog should be brought up for the same span.
          spanOptions = {
            action: 'createSpan',
            offsets: rapidSpanOptions.offsets,
          };
          // TODO: avoid using the stored mouse event
          fillSpanTypesAndDisplayForm(lastRapidAnnotationEvent,
                                      $('#rapid_span_selected').text());
          dispatcher.post('logAction', ['normalSpanSelected']);
        } else {
          // normal type selection; submit createSpan with the selected type.
          $.extend(rapidSpanOptions, {
            action: 'createSpan',
            collection: coll,
            'document': doc,
            type: type,
          });
          $('#waiter').dialog('open');
          rapidSpanOptions.offsets = JSON.stringify(rapidSpanOptions.offsets);
          dispatcher.post('ajax', [rapidSpanOptions, 'edited']);
        }
        return false;
      };
      rapidSpanForm.submit(rapidSpanFormSubmit);

      var importForm = $('#import_form');
      var importFormSubmit = function(evt) {
        var _docid = $('#import_docid').val();
        var _doctitle = $('#import_title').val();
        var _doctext = $('#import_text').val();
        var opts = {
          action : 'importDocument',
          collection : coll,
          docid  : _docid,
          title : _doctitle,
          text  : _doctext,
        };
        dispatcher.post('ajax', [opts, function(response) {
          var x = response.exception;
          if (x) {
            if (x == 'fileExistsError') {
              dispatcher.post('messages', [[["A file with the given name exists. Please give a different name to the file to import.", 'error']]]);
            } else {
              dispatcher.post('messages', [[['Unknown error: ' + response.exception, 'error']]]);
            }
          } else {
            dispatcher.post('hideForm');
            dispatcher.post('setDocument', [response.document]);
          }
        }]);
        return false;
      };
      importForm.submit(importFormSubmit);
      dispatcher.post('initForm', [importForm, {
          width: 500,
          alsoResize: '#import_text',
          open: function(evt) {
            keymap = {};
          },
        }]);
      $('#import_button').click(function() {
        dispatcher.post('hideForm');
        dispatcher.post('showForm', [importForm]);
        importForm.find('input, textarea').val('');
      });

      /* BEGIN delete button - related */

      $('#delete_document_button').click(function() {
        if (!doc) {
          dispatcher.post('messages', [[['No document selected', 'error']]]);
          return false;
        }
        if (!confirm('Are you sure you want to permanently remove this document and its annotations from the collection? This action cannot be undone.')) {
          return;
        }
        var delOptions = {
          action: 'deleteDocument',
          collection: coll,
          'document': doc
        }
        dispatcher.post('ajax', [delOptions, 'docDeleted']);
      });

      $('#delete_collection_button').click(function() {
        if (!coll) {
          dispatcher.post('messages', [[['No collection selected', 'error']]]);
          return false;
        }
        if (!confirm('Are you sure you want to permanently REMOVE the ENTIRE COLLECTION '+coll+', including all its documents and their annotations?  This action CANNOT BE UNDONE.')) {
          return;
        }
        var delOptions = {
          action: 'deleteCollection',
          collection: coll,
        }
        dispatcher.post('ajax', [delOptions, 'collDeleted']);
      });

      /* END delete button - related */

      $('#undo_button').click(function() {
        if (coll && doc) {
          if (undoStack.length > 0) {
            var storedUndo = undoStack.pop();
            var collection = storedUndo[0];
            var dok = storedUndo[1];
            var token = storedUndo[2];
            var options = {
              'action': 'undo',
              'collection': collection,
              'document': dok,
              'token': token
            }
            dispatcher.post('ajax', [options, 'edited']);
          } else {
            dispatcher.post('messages', [[['No action to be undone', 'error']]]);
          }
        } else {
          dispatcher.post('messages', [[['No document loaded, can not undo changes', 'error']]]);
        }
      });


      var preventDefault = function(evt) {
        evt.preventDefault();
      }

      var $waiter = $('#waiter');
      $waiter.dialog({
        closeOnEscape: false,
        buttons: {},
        modal: true,
        open: function(evt, ui) {
          $(evt.target).parent().find(".ui-dialog-titlebar-close").hide();
        }
      });
      // hide the waiter (Sampo said it's annoying)
      // we don't elliminate it altogether because it still provides the
      // overlay to prevent interaction
      // $waiter.parent().css('opacity', '0');

      var isReloadOkay = function() {
        // do not reload while the user is in the middle of editing
        return arcDragOrigin == null && reselectedSpan == null;
      };

      var userReceived = function(_user) {
        that.user = _user;
      }

      var setAnnotationSpeed = function(speed) {
        if (speed == 1) {
          Configuration.confirmModeOn = true;
        } else {
          Configuration.confirmModeOn = false;
        }
        if (speed == 3) {
          Configuration.rapidModeOn = true;
        } else {
          Configuration.rapidModeOn = false;
        }
        dispatcher.post('configurationChanged');
      };

      var onNewSourceData = function(_sourceData) {
        sourceData = _sourceData;
      }

      var init = function() {
        dispatcher.post('annotationIsAvailable');
      };

      var collectionLoaded = function(collData){
        coll = collData;
      };

      var requestRenderData = function(docData) {
        doc = docData;
      };

      dispatcher.
          on('init', init).
          on('getValidArcTypesForDrag', getValidArcTypesForDrag).
          on('dataReady', rememberData).
          on('requestRenderData', requestRenderData).
          on('collectionLoaded', collectionLoaded).
          on('collectionLoaded', rememberSpanSettings).
          on('collectionLoaded', setupTaggerUI).
          on('collectionLoaded', setupNormalizationUI).
          on('spanAndAttributeTypesLoaded', spanAndAttributeTypesLoaded).
          on('newSourceData', onNewSourceData).
          on('hideForm', hideForm).
          on('user', userReceived).
          on('edited', edited).
          on('current', gotCurrent).
          on('isReloadOkay', isReloadOkay).
          on('keydown', onKeyDown).
          on('dblclick', onDblClick).
          on('dragstart', preventDefault).
          on('mousedown', onMouseDown).
          on('mouseup', onMouseUp).
          on('mousemove', onMouseMove).
          on('annotationSpeed', setAnnotationSpeed).
          on('suggestedSpanTypes', receivedSuggestedSpanTypes).
          on('normGetNameResult', setSpanNormText).
          on('normSearchResult', setSpanNormSearchResults);
    };

    return AnnotatorUI;
})(jQuery, window);

// BRAT STANDALONE LIBRARY BEGIN
// Browserify export
module.exports = AnnotatorUI;
// BRAT STANDALONE LIBRARY END

},{}],11:[function(require,module,exports){
// -*- Mode: JavaScript; tab-width: 2; indent-tabs-mode: nil; -*-
// vim:set ft=javascript ts=2 sw=2 sts=2 cindent:
var Configuration = (function(window, undefined) {
    var Configuration = function() {
        var that = this;
        that.abbrevsOn = true;
        that.textBackgrounds = "striped";
        that.svgWidth = '100%';
        that.rapidModeOn = false;
        that.confirmModeOn = true;
        that.autorefreshOn = false;
        that.visual = {
            margin: { x: 2, y: 1 },
            arcTextMargin: 1,
            boxSpacing: 1,
            curlyHeight: 4,
            arcSpacing: 9, //10;
            arcStartHeight: 19, //23; //25;
        };
    };

    return Configuration;
})(window);

// BRAT STANDALONE LIBRARY BEGIN
// Browserify export
module.exports = Configuration;
// BRAT STANDALONE LIBRARY END
},{}],12:[function(require,module,exports){
// -*- Mode: JavaScript; tab-width: 2; indent-tabs-mode: nil; -*-
// vim:set ft=javascript ts=2 sw=2 sts=2 cindent:
// TODO: does 'arguments.callee.caller' work?

var Dispatcher = (function($, window, undefined) {
    var Dispatcher = function() {
      var that = this;

      var table = {};

      var on = function(message, host, handler) {
        if (handler === undefined) {
          handler = host;
          host = arguments.callee.caller;
        }
        if (table[message] === undefined) {
          table[message] = [];
        }
        table[message].push([host, handler]);
        return this;
      };

      // Notify listeners that we encountered an error in an asynch call
      var inAsynchError = false; // To avoid error avalanches
      var handleAsynchError = function(e) {
        if (!inAsynchError) {
          inAsynchError = true;
          // TODO: Hook printout into dispatch elsewhere?
          console.warn('Handled async error:', e);
          that.post('dispatchAsynchError', [e]);
          inAsynchError = false;
        } else {
          console.warn('Dropped asynch error:', e);
        }
      };

      var post = function(asynch, message, args, returnType) {
        if (typeof(asynch) !== 'number') {
          // no asynch parameter
          returnType = args;
          args = message;
          message = asynch;
          asynch = null;
        }
        if (args === undefined) {
          args = [];
        }
        var results = [];
        // DEBUG: if (typeof(message) != "string" || !(message.match(/mouse/) || message == "hideComment")) console.log(message, args);

        if (typeof(message) === 'function') {
          // someone was lazy and sent a simple function
          var host = arguments.callee.caller;
          if (asynch !== null) {
            result = setTimeout(function() {
              /*try {*/
                message.apply(host, args);
              /*} catch(e) {
                that.handleAsynchError(e);
              }*/
            }, asynch);
          } else {
            result = message.apply(host, args);
          }
          results.push(result);
        } else {
          // a proper message, propagate to all interested parties
          var todo = table[message];
          if (todo !== undefined) {
            $.each(todo, function(itemNo, item) {
              var result;
              if (asynch !== null) {
                result = setTimeout(function() {
                  /*try {*/
                    item[1].apply(item[0], args);
                  /*} catch (e) {
                    that.handleAsynchError(e);
                  }*/
                }, asynch);
              } else {
                result = item[1].apply(item[0], args);
              }
              results.push(result);
            });
/* DEBUG
          } else {
            console.warn('Message ' + message + ' has no subscribers.'); // DEBUG
*/
          }
        }
        if (returnType == 'any') {
          var i = results.length;
          while (i--) {
            if (results[i] !== false) return results[i];
          }
          return false;
        }
        if (returnType == 'all') {
          var i = results.length;
          while (i--) {
            if (results[i] === false) return results[i];
          }
        }
        return results;
      };

      var proxy = function(destination, message) {
        this.on(message, function() {
          destination.post(message, Array.prototype.slice.call(arguments));
        });
      };

      var dispatcher = {
        on: on,
        post: post,
        proxy: proxy,
      };
      Dispatcher.dispatchers.push(dispatcher);
      return dispatcher;
    };

    Dispatcher.dispatchers = [];
    Dispatcher.post = function(asynch, message, args, returnType) {
      $.each(Dispatcher.dispatchers, function(dispatcherNo, dispatcher) {
        dispatcher.post(asynch, message, args, returnType);
      });
    };

    return Dispatcher;
})(jQuery, window);

// BRAT STANDALONE LIBRARY BEGIN
// Browserify export
module.exports = Dispatcher;
// BRAT STANDALONE LIBRARY END

},{}],13:[function(require,module,exports){
var LocalAjax = (function($, window, undefined) {
    var LocalAjax = function(dispatcher, maxFragmentLength) {
        var that = this;

        var findType = function (entityTypes, type) {
            for (var i = 0; i < entityTypes.length; i++) {
                var entityType = entityTypes[i];
                if (entityType.type === type) {
                    return entityType;
                } else {
                    if (entityType.children && entityType.children.length) {
                        var result = findType(entityType.children, type);
                        if (result !== null){
                            return result;
                        }
                    }
                }
            }
            return null;
        };

        var createAnnotation = function(data){
            var attrs = JSON.parse(data.attributes),
                offsets = JSON.parse(data.offsets),
                e_type = findType(data.collection.entity_types, data.type);
                e_id = "";//Entity or Trigger
            if(!e_type){
                //Trigger
                e_type = data.collection.event_types.find( x => x.type === data.type );
                if(e_type){
                    var trigger_id = "T" + (that.document.triggers.length + 1); //TODO: must absolutely be unique
                    e_id = "E" + (that.document.triggers.length + 1); //TODO: must absolutely be unique
                    data.document.triggers.push([
                        trigger_id,
                        data.type,
                        offsets
                    ]);
                    data.document.events.push([
                        e_id,
                        trigger_id,
                        []
                    ]);
                }
            }else{
                var e_id = "N" + (that.document.entities.length + 1), //TODO: must absolutely be unique
                    new_offsets = splitTooLongFragment(offsets, data, e_id);

                //Entity
                data.document.entities.push([
                    e_id,
                    data.type,
                    new_offsets
                ]);
            }

            for (var key in attrs) {
                if(attrs.hasOwnProperty(key) && attrs[key]){
                    data.document.attributes.push([
                        "A" + (that.document.attributes.length + 1), //TODO: must absolutely be unique,
                        key,
                        e_id,
                        attrs[key]
                    ]);
                }
            }
            if(data.comment.length){
                data.document.comments.push([
                    e_id,
                    "AnnotatorNotes",
                    data.comment
                ]);
            }
            return {
                data: data,
                action: data.action,
                annotations: {
                    "source_files": data.document.source_files,
                    "modifications": data.document.modifications,
                    "normalizations": data.document.normalizations,
                    "text": data.document.text,
                    "entities" : data.document.entities,
                    "attributes": data.document.attributes,
                    "relations": data.document.relations,
                    "triggers": data.document.triggers,
                    "events": data.document.events,
                    "comments": data.document.comments
                },
                edited: [[e_id]],
                messages: [],
                protocol: 1
            };
        };

        // Validate max fragment length based on options.maxFragmentLength
        // Use discontinguity to fix long annotations glitches before calling BRAT rendering engine.
        var splitTooLongFragment = function(offsets, data, e_id){
            var new_offsets = [];

            if(maxFragmentLength > 0 && offsets.find( x => (x[1] - x[0]) > maxFragmentLength)){
                offsets.forEach(function(fragment){
                    var from = fragment[0],
                        to = fragment[1],
                        subtext = data.document.text.substring(from, to);

                    if(to - from > maxFragmentLength) {
                        var from_end = from + (subtext.indexOf(' ')),
                            to_start = to - (subtext.length - (subtext.lastIndexOf(' ') + 1));
                        new_offsets.push([from, from_end ]);
                        new_offsets.push([to_start, to]);

                        // Add special attribute for symbolic representation
                        data.document.attributes.push([
                            "A" + (that.document.attributes.length + 1), //TODO: must absolutely be unique,
                            LONG_ANNOTATION_CONST,
                            e_id,
                            [from,to]
                        ]);
                    }else{
                        new_offsets.push([from, to ]);
                    }
                });
            }else{
                new_offsets = offsets;
            }
            return new_offsets;
        };

        var editAnnotation = function(data){
            var e_type = {}, //Entity or Trigger
                attrs = JSON.parse(data.attributes),
                offsets = JSON.parse(data.offsets);

            //Edit annotation TODO: Validation is based on id, fix this
            if(data.id.substring(0, 1) == "E"){
                //Event annotation
                //data.normalisations ??
                var annotation = data.document.events.find( x => x[0] === data.id );
                var trigger_id = annotation[1];
                var trigger = data.document.triggers.find( x => x[0] === trigger_id );
                trigger[1] = data.type;
                trigger[2] = offsets;
                e_type = data.collection.event_types.find( x => x.type === data.type );
            }else if(data.id.substring(0, 1) == "N"){
                //Entity annotation
                var entity = data.document.entities.find( x => x[0] === data.id );
                entity[1] = data.type;
                entity[2] = splitTooLongFragment(offsets, data, data.id);
                e_type = findType(data.collection.entity_types, data.type);

            }else{
                //TODO: Error
            }
            if(e_type){
                //Removed all attributes for this particular annotation id
                var existing_attrs = data.document.attributes.filter( x => x[2] === data.id);
                existing_attrs.forEach(function(attr){
                    var index = data.document.attributes.indexOf( x => x[0] === attr[0]); //TODO: this always returns -1
                    data.document.attributes.splice(index, 1);
                });

                //Re-add all attributes
                for (var key in attrs) {
                    if(attrs.hasOwnProperty(key) && attrs[key]) {
                        existing_attrs.find(x => x[1] === key);

                        data.document.attributes.push([
                            "A" + (that.document.attributes.length + 1), //TODO: must absolutely be unique,
                            key,
                            data.id,
                            attrs[key]
                        ]);
                    }
                }

                //Add/Edit comment content
                if(data.comment.length){
                    var comment = data.document.comments.find( x => x[0] === data.id);
                    if(comment){
                        //Edit
                        comment[2] = data.comment;
                    }else{
                        //Add
                        data.document.comments.push([
                            data.id,
                            "AnnotatorNotes",
                            data.comment
                        ]);
                    }
                }
                //Comments && Attributes are deactivated for relations at this point

                return {
                    data: data,
                    action: data.action,
                    annotations: {
                        "source_files": data.document.source_files,
                        "modifications": data.document.modifications,
                        "normalizations": data.document.normalizations,
                        "text": data.document.text,
                        "entities" : data.document.entities,
                        "attributes": data.document.attributes,
                        "relations": data.document.relations,
                        "triggers": data.document.triggers,
                        "events": data.document.events,
                        "comments": data.document.comments
                    },
                    edited: [[data.id]],
                    messages: [],
                    protocol: 1
                };
            }else{
                return {}; //TODO: Error handling
            }

        };

        var deleteAnnotation = function (data) {
            // delete the entity. TODO: also delete events etc
            var entities = data.document.entities;
            for (var i = 0; i < entities.length; i++){
                if (entities[i][0] === data.id){  // entity format [id, type, offsets], e.g. ["N1", "Person", Array[2]]
                    entities.splice(i, 1);
                    break;
                }
            }
            // delete relations containing the entity TODO: attributes etc?
            var relations = data.document.relations;
            for (var i = relations.length - 1; i >= 0; i--){
                // relation format: ["R1", "Friend", Array[2]]
                var relation = relations[i][2];  // e.g. [['From', "N1"], ['To', 'N2']]
                if (relation[0][1] === data.id || relation[1][1] === data.id){
                    relations.splice(i, 1);
                }
            }

            return {
                    action: data.action,
                    annotations: data.document,
                    edited: [],
                    messages: [],
                    protocol: 1
                };
        };

        var createRelation = function(data){
            var e_type = data.collection.relation_types.find( x => x.type === data.type ); //Entity or Event

            if(!e_type){
                //Event relation
                /*data.collection.event_types.forEach(function(event){
                    event.arcs.forEach(function(eRelation){
                        if(eRelation.type === data.type){
                            e_type = event;
                            //TODO: Exit loop
                        }
                    })
                });*/
                e_type = data.document.events.find( x => x[0] === data.origin );
                if(e_type){
                    e_type[2].push([
                        data.type,
                        data.target
                    ]);
                }
            }else{
                //Entity relation
                var obj =
                [
                    "R" + (that.document.relations.length + 1), //TODO: must absolutely me unique
                    data.type,
                    [
                        [e_type.args[0].role, data.origin],
                        [e_type.args[1].role, data.target]]
                ];
                data.document.relations.push(obj);
            }
            return {
                action: data.action,
                annotations: {
                    "source_files": data.document.source_files,
                    "modifications": data.document.modifications,
                    "normalizations": data.document.normalizations,
                    "text": data.document.text,
                    "entities" : data.document.entities,
                    "attributes": data.document.attributes,
                    "relations": data.document.relations,
                    "triggers": data.document.triggers,
                    "events": data.document.events
                    //"ctime": 1.0,
                    //"collection": "",
                    //"document": "",
                    //"equivs": [],
                    //"mtime": 1.0,
                    //"sentences_offsets": [],
                    //"token_offsets": [],
                },
                edited: [[data.origin], [data.target]],
                messages: [],
                protocol: 1
            };
        };

        var editRelation = function(data){
            var e_type = data.collection.relation_types.find( x => x.type === data.type ); //Entity or Event

            if(!e_type){
                //Event relation
                e_type = data.document.events.find( x => x[0] === data.origin );
                if(e_type){

                }
            }else{
                //Entity relation
                var relation = data.document.relations.find( x => x[1] === data.old_type && x[2][0][1] === data.origin && x[2][1][1] === data.old_target );
                relation[1] = data.type;
                relation[2] = [
                    [e_type.args[0].role, data.origin],
                    [e_type.args[1].role, data.target]
                ];
            }

            return {
                action: data.action,
                annotations: {
                    "source_files": data.document.source_files,
                    "modifications": data.document.modifications,
                    "normalizations": data.document.normalizations,
                    "text": data.document.text,
                    "entities" : data.document.entities,
                    "attributes": data.document.attributes,
                    "relations": data.document.relations,
                    "triggers": data.document.triggers,
                    "events": data.document.events,
                    "comments": data.document.comments
                },
                edited: [[data.origin], [data.target]],
                messages: [],
                protocol: 1
            };

        };

        var localExecution = function(data, callback, merge) {
            dispatcher.post('spin');
            dispatcher.post('local-ajax-begin', [data]);
            that.collection = data.collection;
            that.document = data.document;
            var response = {};

            switch(data.action){
                case "getDocument":
                    //TODO
                    break;
                case "loadConf":
                    //TODO
                    break;
                case "getCollectionInformation":
                    //TODO
                    break;
                case "createArc":
                    //TODO: Validate model with inputs
                    if(data.old_target || data.old_type){
                        response = editRelation(data);
                    }else{
                        response = createRelation(data);
                    }
                    break;
                case "deleteArc":
                    //TODO
                case "reverseArc":
                    //TODO
                    break;
                case "createSpan":
                    //Edit and Created actions on Entities as well as Triggers(Events)
                    //TODO: Validate model with inputs
                    if(data.id){
                        response = editAnnotation(data);
                    }else{
                        response = createAnnotation(data);
                    }
                    break;
                case "deleteSpan":
                    response = deleteAnnotation(data);
                    break;
                case "deleteFragmentxyz?":
                    //TODO
                    break;
                case "splitSpan":
                    //TODO
                    break;
                case "tag":
                    //TODO ??
                    var obj = {
                        collection: data.collection,
                        document: data.document,
                        tagger: data.tagger
                    };
                case "login":
                case "logout":
                case "whoami":
                case "normGetName":
                case "normSearch":
                case "suggestSpanTypes":
                case "importDocument":
                case "deleteDocument":
                case "deleteCollection":
                case "undo":
                case "normData":
                case "InDocument":
                case "InCollection":
                case "storeSVG":
                case "getDocumentTimestamp":
                case "saveConf":
                    break;
                default:
                    //TODO
                    break;
            }

            dispatcher.post(0, callback, [response]);
            dispatcher.post('local-ajax-done', [response]);
            dispatcher.post('unspin');
        };

        dispatcher.
        on('ajax', localExecution);
    };

    return LocalAjax;
})(jQuery, window);

// BRAT STANDALONE LIBRARY BEGIN
// Browserify export
module.exports = LocalAjax;
// BRAT STANDALONE LIBRARY END

},{}],14:[function(require,module,exports){
// -*- Mode: JavaScript; tab-width: 2; indent-tabs-mode: nil; -*-
// vim:set ft=javascript ts=2 sw=2 sts=2 cindent:
var Spinner = (function($, window, undefined) {
    var Spinner = function(dispatcher, spinElement) {
      var that = this;
      var spinElement = $(spinElement);

      var count = 0;
      var spin = function() {
        if (count === 0) {
          spinElement.css('display', 'block');
        }
        count++;
      };
      var unspin = function() {
        count--;
        if (count === 0) {
          spinElement.css('display', 'none');
        }
      };

      dispatcher.
          on('spin', spin).
          on('unspin', unspin);
    };

    return Spinner;
})(jQuery, window);

// BRAT STANDALONE LIBRARY BEGIN
// Browserify export
module.exports = Spinner;
// BRAT STANDALONE LIBRARY END

},{}],15:[function(require,module,exports){
var URLHash = (function($, window, undefined) {
    var URLHash = function(collection, _document, _arguments) {
        var that = this;
        that.collection = collection;
        that.document = _document || '';
        that.arguments = _arguments || {};
        that.calcArgs();
    }

    URLHash.prototype = {
        calcArgs: function() {
            var args = URLHash.splitArgs(this.arguments);
            this.intArguments = args[0];
            this.extArguments = args[1];
        },

        setArgument: function(argument, value) {
            if (!this.arguments) {
                this.arguments = {};
            }
            this.arguments[argument] = value;
            this.calcArgs();
            return this;
        },

        setArguments: function(_arguments) {
            // the $.extend here basically takes a copy; raw assignment
            // would allow changes of the args to alter original, which
            // could be e.g. the "args" of search results
            this.arguments = $.extend({}, _arguments || {});
            this.calcArgs();
            return this;
        },

        setDocument: function(_document) {
            this.document = _document;
            return this;
        },

        setCollection: function(collection) {
            this.collection = collection;
            return this;
        },

        getHash: function() {
            var url_hash = this.collection + this.document;

            var url_args = Util.param(this.extArguments);

            if (url_args.length) {
                url_hash += '?' + url_args;
            }

            if (url_hash.length) {
                url_hash = '#' + url_hash;
            }

            return url_hash;
        },
    };

    // arguments that do not appear in the URL
    var INT_ARGS = ['match', 'matchfocus', 'edited'];

    URLHash.splitArgs = function(args) {
        var intArgs = {};
        var extArgs = $.extend({}, args);
        var intArgNameLen = INT_ARGS.length;
        for (var i = 0; i < intArgNameLen; i++) {
            intArgs[INT_ARGS[i]] = extArgs[INT_ARGS[i]];
            delete extArgs[INT_ARGS[i]];
        }
        return [intArgs, extArgs];
    };

    // TODO: Document and conform variables to the rest of the object
    URLHash.parse = function(hash) {
        if (hash.length) {
            // Remove the leading hash (#)
            hash = hash.substr(1);
        }

        var pathAndArgs = hash.split('?');
        var path = pathAndArgs[0] || '';
        var argsStr = pathAndArgs[1] || '';
        var coll;
        var slashPos = path.lastIndexOf('/');
        if (slashPos === -1) {
            coll = '/';
        } else {
            coll = path.substr(0, slashPos + 1);
            if (coll[coll.length - 1] !== '/') {
                coll += '/';
            }
            if (coll[0] !== '/') {
                coll = '/' + coll;
            }
        }
        var doc = path.substr(slashPos + 1);
        var args = Util.deparam(argsStr);
        return new URLHash(coll, doc, args);
    };

    return URLHash;
})(jQuery, window);

// BRAT STANDALONE LIBRARY BEGIN
// Browserify export
module.exports = URLHash;
// BRAT STANDALONE LIBRARY END

},{}],16:[function(require,module,exports){
// -*- Mode: JavaScript; tab-width: 2; indent-tabs-mode: nil; -*-
// vim:set ft=javascript ts=2 sw=2 sts=2 cindent:
var Util = (function(window, undefined) {

    var monthNames = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];

    var cmp = function(a,b) {
      return a < b ? -1 : a > b ? 1 : 0;
    }

    var cmpArrayOnFirstElement = function(a,b) {
      a = a[0];
      b = b[0];
      return a < b ? -1 : a > b ? 1 : 0;
    }

    var unitAgo = function(n, unit) {
      if (n == 1) return "" + n + " " + unit + " ago";
      return "" + n + " " + unit + "s ago";
    };

    var formatTimeAgo = function(time) {
      if (time == -1000) {
        return "never"; // FIXME make the server return the server time!
      }

      var nowDate = new Date();
      var now = nowDate.getTime();
      var diff = Math.floor((now - time) / 1000);
      if (!diff) return "just now";
      if (diff < 60) return unitAgo(diff, "second");
      diff = Math.floor(diff / 60);
      if (diff < 60) return unitAgo(diff, "minute");
      diff = Math.floor(diff / 60);
      if (diff < 24) return unitAgo(diff, "hour");
      diff = Math.floor(diff / 24);
      if (diff < 7) return unitAgo(diff, "day");
      if (diff < 28) return unitAgo(Math.floor(diff / 7), "week");
      var thenDate = new Date(time);
      var result = thenDate.getDate() + ' ' + monthNames[thenDate.getMonth()];
      if (thenDate.getYear() != nowDate.getYear()) {
        result += ' ' + thenDate.getFullYear();
      }
      return result;
    }

    var realBBox = function(span) {
      var box = span.rect.getBBox();
      var chunkTranslation = span.chunk.translation;
      var rowTranslation = span.chunk.row.translation;
      box.x += chunkTranslation.x + rowTranslation.x;
      box.y += chunkTranslation.y + rowTranslation.y;
      return box;
    }

    var escapeHTML = function(str) {
      return str.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;');
    }

    var escapeHTMLandQuotes = function(str) {
      return str.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/\"/g,'&quot;');
    }

    var escapeHTMLwithNewlines = function(str) {
      return str.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/\n/g,'<br/>');
    }

    var escapeQuotes = function(str) {
      // we only use double quotes for HTML attributes
      return str.replace(/\"/g,'&quot;');
    }

    var getSpanLabels = function(spanTypes, spanType) {
      var type = spanTypes[spanType];
      return type && type.labels || [];
    }

    var spanDisplayForm = function(spanTypes, spanType) {
      var labels = getSpanLabels(spanTypes, spanType);
      return labels[0] || spanType;
    }

    var getArcLabels = function(spanTypes, spanType, arcType, relationTypesHash) {
      var type = spanTypes[spanType];
      var arcTypes = type && type.arcs || [];
      var arcDesc = null;
      // also consider matches without suffix number, if any
      var noNumArcType;
      if (arcType) {
          var splitType = arcType.match(/^(.*?)(\d*)$/);
          noNumArcType = splitType[1];
      }
      $.each(arcTypes, function(arcno, arcDescI) {
        if (arcDescI.type == arcType || arcDescI.type == noNumArcType) {
          arcDesc = arcDescI;
          return false;
        }
      });
      // fall back to relation types for unconfigured or missing def
      if (!arcDesc) {
        arcDesc = $.extend({}, relationTypesHash[arcType] || relationTypesHash[noNumArcType]);
      }
      return arcDesc && arcDesc.labels || [];
    }

    var arcDisplayForm = function(spanTypes, spanType, arcType, relationTypesHash) {
      var labels = getArcLabels(spanTypes, spanType, arcType, relationTypesHash);
      return labels[0] || arcType;
    }

    // TODO: switching to use of $.param(), this function should
    // be deprecated and removed.
    var objectToUrlStr = function(o) {
      a = [];
      $.each(o, function(key,value) {
        a.push(key+"="+encodeURIComponent(value));
      });
      return a.join("&");
    }

    // color name RGB list, converted from
    // http://www.w3schools.com/html/html_colornames.asp
    // with perl as
    //     perl -e 'print "var colors = {\n"; while(<>) { /(\S+)\s+\#([0-9a-z]{2})([0-9a-z]{2})([0-9a-z]{2})\s*/i or die "Failed to parse $_"; ($r,$g,$b)=(hex($2),hex($3),hex($4)); print "    '\''",lc($1),"'\'':\[$r,$g,$b\],\n" } print "};\n" '
    var colors = {
        'aliceblue':[240,248,255],
        'antiquewhite':[250,235,215],
        'aqua':[0,255,255],
        'aquamarine':[127,255,212],
        'azure':[240,255,255],
        'beige':[245,245,220],
        'bisque':[255,228,196],
        'black':[0,0,0],
        'blanchedalmond':[255,235,205],
        'blue':[0,0,255],
        'blueviolet':[138,43,226],
        'brown':[165,42,42],
        'burlywood':[222,184,135],
        'cadetblue':[95,158,160],
        'chartreuse':[127,255,0],
        'chocolate':[210,105,30],
        'coral':[255,127,80],
        'cornflowerblue':[100,149,237],
        'cornsilk':[255,248,220],
        'crimson':[220,20,60],
        'cyan':[0,255,255],
        'darkblue':[0,0,139],
        'darkcyan':[0,139,139],
        'darkgoldenrod':[184,134,11],
        'darkgray':[169,169,169],
        'darkgrey':[169,169,169],
        'darkgreen':[0,100,0],
        'darkkhaki':[189,183,107],
        'darkmagenta':[139,0,139],
        'darkolivegreen':[85,107,47],
        'darkorange':[255,140,0],
        'darkorchid':[153,50,204],
        'darkred':[139,0,0],
        'darksalmon':[233,150,122],
        'darkseagreen':[143,188,143],
        'darkslateblue':[72,61,139],
        'darkslategray':[47,79,79],
        'darkslategrey':[47,79,79],
        'darkturquoise':[0,206,209],
        'darkviolet':[148,0,211],
        'deeppink':[255,20,147],
        'deepskyblue':[0,191,255],
        'dimgray':[105,105,105],
        'dimgrey':[105,105,105],
        'dodgerblue':[30,144,255],
        'firebrick':[178,34,34],
        'floralwhite':[255,250,240],
        'forestgreen':[34,139,34],
        'fuchsia':[255,0,255],
        'gainsboro':[220,220,220],
        'ghostwhite':[248,248,255],
        'gold':[255,215,0],
        'goldenrod':[218,165,32],
        'gray':[128,128,128],
        'grey':[128,128,128],
        'green':[0,128,0],
        'greenyellow':[173,255,47],
        'honeydew':[240,255,240],
        'hotpink':[255,105,180],
        'indianred':[205,92,92],
        'indigo':[75,0,130],
        'ivory':[255,255,240],
        'khaki':[240,230,140],
        'lavender':[230,230,250],
        'lavenderblush':[255,240,245],
        'lawngreen':[124,252,0],
        'lemonchiffon':[255,250,205],
        'lightblue':[173,216,230],
        'lightcoral':[240,128,128],
        'lightcyan':[224,255,255],
        'lightgoldenrodyellow':[250,250,210],
        'lightgray':[211,211,211],
        'lightgrey':[211,211,211],
        'lightgreen':[144,238,144],
        'lightpink':[255,182,193],
        'lightsalmon':[255,160,122],
        'lightseagreen':[32,178,170],
        'lightskyblue':[135,206,250],
        'lightslategray':[119,136,153],
        'lightslategrey':[119,136,153],
        'lightsteelblue':[176,196,222],
        'lightyellow':[255,255,224],
        'lime':[0,255,0],
        'limegreen':[50,205,50],
        'linen':[250,240,230],
        'magenta':[255,0,255],
        'maroon':[128,0,0],
        'mediumaquamarine':[102,205,170],
        'mediumblue':[0,0,205],
        'mediumorchid':[186,85,211],
        'mediumpurple':[147,112,216],
        'mediumseagreen':[60,179,113],
        'mediumslateblue':[123,104,238],
        'mediumspringgreen':[0,250,154],
        'mediumturquoise':[72,209,204],
        'mediumvioletred':[199,21,133],
        'midnightblue':[25,25,112],
        'mintcream':[245,255,250],
        'mistyrose':[255,228,225],
        'moccasin':[255,228,181],
        'navajowhite':[255,222,173],
        'navy':[0,0,128],
        'oldlace':[253,245,230],
        'olive':[128,128,0],
        'olivedrab':[107,142,35],
        'orange':[255,165,0],
        'orangered':[255,69,0],
        'orchid':[218,112,214],
        'palegoldenrod':[238,232,170],
        'palegreen':[152,251,152],
        'paleturquoise':[175,238,238],
        'palevioletred':[216,112,147],
        'papayawhip':[255,239,213],
        'peachpuff':[255,218,185],
        'peru':[205,133,63],
        'pink':[255,192,203],
        'plum':[221,160,221],
        'powderblue':[176,224,230],
        'purple':[128,0,128],
        'red':[255,0,0],
        'rosybrown':[188,143,143],
        'royalblue':[65,105,225],
        'saddlebrown':[139,69,19],
        'salmon':[250,128,114],
        'sandybrown':[244,164,96],
        'seagreen':[46,139,87],
        'seashell':[255,245,238],
        'sienna':[160,82,45],
        'silver':[192,192,192],
        'skyblue':[135,206,235],
        'slateblue':[106,90,205],
        'slategray':[112,128,144],
        'slategrey':[112,128,144],
        'snow':[255,250,250],
        'springgreen':[0,255,127],
        'steelblue':[70,130,180],
        'tan':[210,180,140],
        'teal':[0,128,128],
        'thistle':[216,191,216],
        'tomato':[255,99,71],
        'turquoise':[64,224,208],
        'violet':[238,130,238],
        'wheat':[245,222,179],
        'white':[255,255,255],
        'whitesmoke':[245,245,245],
        'yellow':[255,255,0],
        'yellowgreen':[154,205,50],
    };

    // color parsing function originally from
    // http://plugins.jquery.com/files/jquery.color.js.txt
    // (with slight modifications)

    // Parse strings looking for color tuples [255,255,255]
    var rgbNumRE = /rgb\(\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*\)/;
    var rgbPercRE = /rgb\(\s*([0-9]+(?:\.[0-9]+)?)\%\s*,\s*([0-9]+(?:\.[0-9]+)?)\%\s*,\s*([0-9]+(?:\.[0-9]+)?)\%\s*\)/;
    var rgbHash6RE = /#([a-fA-F0-9]{2})([a-fA-F0-9]{2})([a-fA-F0-9]{2})/;
    var rgbHash3RE = /#([a-fA-F0-9])([a-fA-F0-9])([a-fA-F0-9])/;

    var strToRgb = function(color) {
      var result;

      // Check if we're already dealing with an array of colors
//         if ( color && color.constructor == Array && color.length == 3 )
//             return color;
      
      // Look for rgb(num,num,num)
      if (result = rgbNumRE.exec(color))
        return [parseInt(result[1]), parseInt(result[2]), parseInt(result[3])];
      
      // Look for rgb(num%,num%,num%)
      if (result = rgbPercRE.exec(color))
        return [parseFloat(result[1])*2.55, parseFloat(result[2])*2.55, parseFloat(result[3])*2.55];
      
      // Look for #a0b1c2
      if (result = rgbHash6RE.exec(color))
        return [parseInt(result[1],16), parseInt(result[2],16), parseInt(result[3],16)];
      
      // Look for #fff
      if (result = rgbHash3RE.exec(color))
        return [parseInt(result[1]+result[1],16), parseInt(result[2]+result[2],16), parseInt(result[3]+result[3],16)];
      
      // Otherwise, we're most likely dealing with a named color
      return colors[$.trim(color).toLowerCase()];
    }

    var rgbToStr = function(rgb) {
      // TODO: there has to be a better way, even in JS
      var r = Math.floor(rgb[0]).toString(16);
      var g = Math.floor(rgb[1]).toString(16);
      var b = Math.floor(rgb[2]).toString(16);
      // pad
      r = r.length < 2 ? '0' + r : r;
      g = g.length < 2 ? '0' + g : g;
      b = b.length < 2 ? '0' + b : b;        
      return ('#'+r+g+b);
    }
    
    // Functions rgbToHsl and hslToRgb originally from 
    // http://mjijackson.com/2008/02/rgb-to-hsl-and-rgb-to-hsv-color-model-conversion-algorithms-in-javascript
    // implementation of functions in Wikipedia
    // (with slight modifications)

    // RGB to HSL color conversion
    var rgbToHsl = function(rgb) {
      var r = rgb[0]/255, g = rgb[1]/255, b = rgb[2]/255;
      var max = Math.max(r, g, b), min = Math.min(r, g, b);
      var h, s, l = (max + min) / 2;

      if (max == min) {
        h = s = 0; // achromatic
      } else {
        var d = max - min;
        s = l > 0.5 ? d / (2 - max - min) : d / (max + min);
        switch (max) {
          case r: h = (g - b) / d + (g < b ? 6 : 0); break;
          case g: h = (b - r) / d + 2; break;
          case b: h = (r - g) / d + 4; break;
        }
        h /= 6;
      }
      
      return [h, s, l];
    }

    var hue2rgb = function(p, q, t) {
      if (t < 0) t += 1;
      if (t > 1) t -= 1;
      if (t < 1/6) return p + (q - p) * 6 * t;
      if (t < 1/2) return q;
      if (t < 2/3) return p + (q - p) * (2/3 - t) * 6;
      return p;
    }

    var hslToRgb = function(hsl) {
      var h = hsl[0], s = hsl[1], l = hsl[2];

      var r, g, b;

      if (s == 0) {
        r = g = b = l; // achromatic
      } else {
        var q = l < 0.5 ? l * (1 + s) : l + s - l * s;
        var p = 2 * l - q;
        r = hue2rgb(p, q, h + 1/3);
        g = hue2rgb(p, q, h);
        b = hue2rgb(p, q, h - 1/3);
      }
      
      return [r * 255, g * 255, b * 255];
    }

    var adjustLightnessCache = {};

    // given color string and -1<=adjust<=1, returns color string
    // where lightness (in the HSL sense) is adjusted by the given
    // amount, the larger the lighter: -1 gives black, 1 white, and 0
    // the given color.
    var adjustColorLightness = function(colorstr, adjust) {
      if (!(colorstr in adjustLightnessCache)) {
        adjustLightnessCache[colorstr] = {}
      }
      if (!(adjust in adjustLightnessCache[colorstr])) {
        var rgb = strToRgb(colorstr);
        if (rgb === undefined) {
          // failed color string conversion; just return the input
          adjustLightnessCache[colorstr][adjust] = colorstr;
        } else {
          var hsl = rgbToHsl(rgb);
          if (adjust > 0.0) {
            hsl[2] = 1.0 - ((1.0-hsl[2])*(1.0-adjust));
          } else {
            hsl[2] = (1.0+adjust)*hsl[2];
          }
          var lightRgb = hslToRgb(hsl);
          adjustLightnessCache[colorstr][adjust] = rgbToStr(lightRgb);
        }
      }
      return adjustLightnessCache[colorstr][adjust];
    }

    // Partially stolen from: http://documentcloud.github.com/underscore/
    // MIT-License
    // TODO: Mention in LICENSE.md
    var isEqual = function(a, b) {
      // Check object identity.
      if (a === b) return true;
      // Different types?
      var atype = typeof(a), btype = typeof(b);
      if (atype != btype) return false;
      // Basic equality test (watch out for coercions).
      if (a == b) return true;
      // One is falsy and the other truthy.
      if ((!a && b) || (a && !b)) return false;
      // If a is not an object by this point, we can't handle it.
      if (atype !== 'object') return false;
      // Check for different array lengths before comparing contents.
      if (a.length && (a.length !== b.length)) return false;
      // Nothing else worked, deep compare the contents.
      for (var key in b) if (!(key in a)) return false;
      // Recursive comparison of contents.
      for (var key in a) if (!(key in b) || !isEqual(a[key], b[key])) return false;
      return true;
    };

    var keyValRE = /^([^=]+)=(.*)$/; // key=value
    var isDigitsRE = /^[0-9]+$/;

    var deparam = function(str) {
      var args = str.split('&');
      var len = args.length;
      if (!len) return null;
      var result = {};
      for (var i = 0; i < len; i++) {
        var parts = args[i].match(keyValRE);
        if (!parts || parts.length != 3) break;
        var val = [];
        var arr = parts[2].split(',');
        var sublen = arr.length;
        for (var j = 0; j < sublen; j++) {
          var innermost = [];
          // map empty arguments ("" in URL) to empty arrays
          // (innermost remains [])
          if (arr[j].length) {
            var arrsplit = arr[j].split('~');
            var subsublen = arrsplit.length;
            for (var k = 0; k < subsublen; k++) {
              if(arrsplit[k].match(isDigitsRE)) {
                // convert digits into ints ...
                innermost.push(parseInt(arrsplit[k], 10));
              }
              else {
                // ... anything else remains a string.
                innermost.push(arrsplit[k]);
              }
            }
          }
          val.push(innermost);
        }
        result[parts[1]] = val;
      }
      return result;
    };

    var paramArray = function(val) {
      val = val || [];
      var len = val.length;
      var arr = [];
      for (var i = 0; i < len; i++) {
        if ($.isArray(val[i])) {
          arr.push(val[i].join('~'));
        } else {
          // non-array argument; this is an error from the caller
          console.error('param: Error: received non-array-in-array argument [', i, ']', ':', val[i], '(fix caller)');
        }
      }
      return arr;
    };

    var param = function(args) {
      if (!args) return '';
      var vals = [];
      for (var key in args) {
        if (args.hasOwnProperty(key)) {
          var val = args[key];
          if (val == undefined) {
            console.error('Error: received argument', key, 'with value', val);
            continue;
          }
          // values normally expected to be arrays, but some callers screw
          // up, so check
          if ($.isArray(val)) {
            var arr = paramArray(val);
            vals.push(key + '=' + arr.join(','));
          } else {
            // non-array argument; this is an error from the caller
            console.error('param: Error: received non-array argument', key, ':', val, '(fix caller)');
          }
        }
      }
      return vals.join('&');
    };

    var profiles = {};
    var profileStarts = {};
    var profileOn = false;
    var profileEnable = function(on) {
      if (on === undefined) on = true;
      profileOn = on;
    }; // profileEnable
    var profileClear = function() {
      if (!profileOn) return;
      profiles = {};
      profileStarts = {};
    }; // profileClear
    var profileStart = function(label) {
      if (!profileOn) return;
      profileStarts[label] = new Date();
    }; // profileStart
    var profileEnd = function(label) {
      if (!profileOn) return;
      var profileElapsed = new Date() - profileStarts[label]
      if (!profiles[label]) profiles[label] = 0;
      profiles[label] += profileElapsed;
    }; // profileEnd
    var profileReport = function() {
      if (!profileOn) return;
      if (window.console) {
        $.each(profiles, function(label, time) {
          console.log("profile " + label, time);
        });
        console.log("-------");
      }
    }; // profileReport

    // container: ID or jQuery element
    // collData: the collection data (in the format of the result of
    //   http://.../brat/ajax.cgi?action=getCollectionInformation&collection=...
    // docData: the document data (in the format of the result of
    //   http://.../brat/ajax.cgi?action=getDocument&collection=...&document=...
    // returns the embedded visualizer's dispatcher object
    var embed = function(container, collData, docData, webFontURLs) {
      var dispatcher = new Dispatcher();
      var visualizer = new Visualizer(dispatcher, container, webFontURLs);
      docData.collection = null;
      dispatcher.post('collectionLoaded', [collData]);
      dispatcher.post('requestRenderData', [docData]);
      return dispatcher;
    };

    // container: ID or jQuery element
    // collDataURL: the URL of the collection data, or collection data
    //   object (if pre-fetched)
    // docDataURL: the url of the document data (if pre-fetched, use
    //   simple `embed` instead)
    // callback: optional; the callback to call afterwards; it will be
    //   passed the embedded visualizer's dispatcher object
    var embedByURL = function(container, collDataURL, docDataURL, callback) {
      var collData, docData;
      var handler = function() {
        if (collData && docData) {
          var dispatcher = embed(container, collData, docData);
          if (callback) callback(dispatcher);
        }
      };
      if (typeof(container) == 'string') {
        $.getJSON(collDataURL, function(data) { collData = data; handler(); });
      } else {
        collData = collDataURL;
      }
      $.getJSON(docDataURL, function(data) { docData = data; handler(); });
    };


    return {
      profileEnable: profileEnable,
      profileClear: profileClear,
      profileStart: profileStart,
      profileEnd: profileEnd,
      profileReport: profileReport,
      formatTimeAgo: formatTimeAgo,
      realBBox: realBBox,
      getSpanLabels: getSpanLabels,
      spanDisplayForm: spanDisplayForm,
      getArcLabels: getArcLabels,
      arcDisplayForm: arcDisplayForm,
      escapeQuotes: escapeQuotes,
      escapeHTML: escapeHTML,
      escapeHTMLandQuotes: escapeHTMLandQuotes,
      escapeHTMLwithNewlines: escapeHTMLwithNewlines,
      cmp: cmp,
      rgbToHsl: rgbToHsl,
      hslToRgb: hslToRgb,
      adjustColorLightness: adjustColorLightness,
      objectToUrlStr: objectToUrlStr,
      isEqual: isEqual,
      paramArray: paramArray,
      param: param,
      deparam: deparam,
      embed: embed,
      embedByURL: embedByURL,
    };

})(window);

// BRAT STANDALONE LIBRARY BEGIN
// Browserify export
module.exports = Util;
// BRAT STANDALONE LIBRARY END

},{}],17:[function(require,module,exports){
// -*- Mode: JavaScript; tab-width: 2; indent-tabs-mode: nil; -*-
// vim:set ft=javascript ts=2 sw=2 sts=2 cindent:

var Visualizer = (function($, window, undefined) {
    var fontLoadTimeout = 5000; // 5 seconds
  
    var DocumentData = function(text) {
      this.text = text;
      this.chunks = [];
      this.spans = {};
      this.eventDescs = {};
      this.sentComment = {};
      this.arcs = [];
      this.arcById = {};
      this.markedSent = {};
      this.spanAnnTexts = {};
      this.towers = {};
      // this.sizes = {};
    };

    var Fragment = function(id, span, from, to) {
      this.id = id;
      this.span = span;
      this.from = from;
      this.to = to;
      // this.towerId = undefined;
      // this.drawOrder = undefined;
    };

    var Span = function(id, type, offsets, generalType) {
      this.id = id;
      this.type = type;
      this.totalDist = 0;
      this.numArcs = 0;
      this.generalType = generalType;
      this.offsets = offsets;
      this.headFragment = null;
      // this.from = undefined;
      // this.to = undefined;
      // this.wholeFrom = undefined;
      // this.wholeTo = undefined;
      // this.headFragment = undefined;
      // this.chunk = undefined;
      // this.marked = undefined;
      // this.avgDist = undefined;
      // this.curly = undefined;
      // this.comment = undefined; // { type: undefined, text: undefined };
      // this.annotatorNotes = undefined;
      // this.drawCurly = undefined;
      // this.glyphedLabelText = undefined;
      // this.group = undefined;
      // this.height = undefined;
      // this.highlightPos = undefined;
      // this.indexNumber = undefined;
      // this.labelText = undefined;
      // this.nestingDepth = undefined;
      // this.nestingDepthLR = undefined;
      // this.nestingDepthRL = undefined;
      // this.nestingHeight = undefined;
      // this.nestingHeightLR = undefined;
      // this.nestingHeightRL = undefined;
      // this.rect = undefined;
      // this.rectBox = undefined;
      // this.refedIndexSum = undefined;
      // this.right = undefined;
      // this.totaldist = undefined;
      // this.width = undefined;
      this.initContainers(offsets);
    };

    Span.prototype.initContainers = function() {
      this.incoming = [];
      this.outgoing = [];
      this.attributes = {};
      this.attributeText = [];
      this.attributeCues = {};
      this.attributeCueFor = {};
      this.attributeMerge = {}; // for box, cross, etc. that are span-global
      this.fragments = [];
      this.normalizations = [];
    };

    Span.prototype.copy = function(id) {
      var span = $.extend(new Span(), this); // clone
      span.id = id;
      span.initContainers(); // protect from shallow copy
      return span;
    };

    var EventDesc = function(id, triggerId, roles, klass) {
      this.id = id;
      this.triggerId = triggerId;
      var roleList = this.roles = [];
      $.each(roles, function(roleNo, role) {
        roleList.push({ type: role[0], targetId: role[1] });
      });
      if (klass == "equiv") {
        this.equiv = true;
      } else if (klass == "relation") {
        this.relation = true;
      }
      // this.leftSpans = undefined;
      // this.rightSpans = undefined;
      // this.annotatorNotes = undefined;
    };

    var Chunk = function(index, text, from, to, space, spans) {
      this.index = index;
      this.text = text;
      this.from = from;
      this.to = to;
      this.space = space;
      this.fragments = [];
      // this.sentence = undefined;
      // this.group = undefined;
      // this.highlightGroup = undefined;
      // this.markedTextStart = undefined;
      // this.markedTextEnd = undefined;
      // this.nextSpace = undefined;
      // this.right = undefined;
      // this.row = undefined;
      // this.textX = undefined;
      // this.translation = undefined;
    }

    var Arc = function(eventDesc, role, dist, eventNo) {
      this.origin = eventDesc.id;
      this.target = role.targetId;
      this.dist = dist;
      this.type = role.type;
      this.shadowClass = eventDesc.shadowClass;
      this.jumpHeight = 0;
      if (eventDesc.equiv) {
        this.equiv = true;
        this.eventDescId = eventNo;
        eventDesc.equivArc = this;
      } else if (eventDesc.relation) {
        this.relation = true;
        this.eventDescId = eventNo;
      }
      // this.marked = undefined;
    };

    var Row = function(svg) {
      this.group = svg.group();
      this.background = svg.group(this.group);
      this.chunks = [];
      this.hasAnnotations = false;
      this.maxArcHeight = 0;
      this.maxSpanHeight = 0;
    };

    var Measurements = function(widths, height, y) {
      this.widths = widths;
      this.height = height;
      this.y = y;
    };

    // A naive whitespace tokeniser
    var tokenise = function(text) {
      var tokenOffsets = [];
      var tokenStart = null;
      var lastCharPos = null;

      for (var i = 0; i < text.length; i++) {
        var c = text[i];
        // Have we found the start of a token?
        if (tokenStart == null && !/\s/.test(c)) {
          tokenStart = i;
          lastCharPos = i;
        // Have we found the end of a token?
        } else if (/\s/.test(c) && tokenStart != null) {
          tokenOffsets.push([tokenStart, i]);
          tokenStart = null;
        // Is it a non-whitespace character?
        } else if (!/\s/.test(c)) {
          lastCharPos = i;
        }
      }
      // Do we have a trailing token?
      if (tokenStart != null) {
        tokenOffsets.push([tokenStart, lastCharPos + 1]);
      }

      return tokenOffsets;
    };

    // A naive newline sentence splitter
    var sentenceSplit = function(text) {
      var sentenceOffsets = [];
      var sentStart = null;
      var lastCharPos = null;

      for (var i = 0; i < text.length; i++) {
        var c = text[i];
        // Have we found the start of a sentence?
        if (sentStart == null && !/\s/.test(c)) {
          sentStart = i;
          lastCharPos = i;
        // Have we found the end of a sentence?
        } else if (c == '\n' && sentStart != null) {
          sentenceOffsets.push([sentStart, i]);
          sentStart = null;
        // Is it a non-whitespace character?
        } else if (!/\s/.test(c)) {
          lastCharPos = i;
        }
      }
      // Do we have a trailing sentence without a closing newline?
      if (sentStart != null) {
        sentenceOffsets.push([sentStart, lastCharPos + 1]);
      }

      return sentenceOffsets;
    };

    // Sets default values for a wide range of optional attributes
    var setSourceDataDefaults = function(sourceData) {
      // The following are empty lists if not set
      $.each([
          'attributes',
          'comments',
          'entities',
          'equivs',
          'events',
          'modifications',
          'normalizations',
          'relations',
          'triggers',
          ], function(attrNo, attr) {
        if (sourceData[attr] === undefined) {
          sourceData[attr] = [];
        }
      });

      // If we lack sentence offsets we fall back on naive sentence splitting
      if (sourceData.sentence_offsets === undefined) {
        sourceData.sentence_offsets = sentenceSplit(sourceData.text);
      }
      // Similarily we fall back on whitespace tokenisation
      if (sourceData.token_offsets === undefined) {
        sourceData.token_offsets = tokenise(sourceData.text);
      }
    };

    // Set default values for a variety of collection attributes
    var setCollectionDefaults = function(collectionData) {
      // The following are empty lists if not set
      $.each([
          'entity_attribute_types',
          'entity_types',
          'event_attribute_types',
          'event_types',
          'relation_attribute_types',
          'relation_types',
          'unconfigured_types',
          ], function(attrNo, attr) {
        if (collectionData[attr] === undefined) {
          collectionData[attr] = [];
        }
      });
    };

    var Visualizer = function(dispatcher, svgId, webFontURLs) {
      var $svgDiv = $('#' + svgId);
      if (!$svgDiv.length) {
        throw Error('Could not find container with id="' + svgId + '"');
      }
      var that = this;

      // OPTIONS
      var roundCoordinates = true; // try to have exact pixel offsets
      var boxTextMargin = { x: 0, y: 1.5 }; // effect is inverse of "margin" for some reason
      var highlightRounding = { x: 3, y:3 }; // rx, ry for highlight boxes
      var spaceWidths = {
        ' ': 4,
        '\u00a0': 4,
        '\u200b': 0,
        '\u3000': 8,
        '\u0009': 12, //Unicode tabulation
        '\n': 4
      };
      var coloredCurlies = true; // color curlies by box BG
      var arcSlant = 15; //10;
      var minArcSlant = 8;
      var arcHorizontalSpacing = 10; // min space boxes with connecting arc
      var rowSpacing = -5;          // for some funny reason approx. -10 gives "tight" packing.
      var sentNumMargin = 50;
      var smoothArcCurves = true;   // whether to use curves (vs lines) in arcs
      var smoothArcSteepness = 0.5; // steepness of smooth curves (control point)
      var reverseArcControlx = 5;   // control point distance for "UFO catchers"

      // "shadow" effect settings (note, error, incompelete)
      var rectShadowSize = 3;
      var rectShadowRounding = 2.5;
      var arcLabelShadowSize = 1;
      var arcLabelShadowRounding = 5;
      var shadowStroke = 2.5; // TODO XXX: this doesn't affect anything..?

      // "marked" effect settings (edited, focus, match)
      var markedSpanSize = 6;
      var markedArcSize = 2;
      var markedArcStroke = 7; // TODO XXX: this doesn't seem to do anything..?

      var rowPadding = 2;
      var nestingAdjustYStepSize = 2; // size of height adjust for nested/nesting spans
      var nestingAdjustXStepSize = 1; // size of height adjust for nested/nesting spans

      var highlightSequence = '#FF9632;#FFCC00;#FF9632'; // yellow - deep orange
      //var highlightSequence = '#FFFC69;#FFCC00;#FFFC69'; // a bit toned town
      var highlightSpanSequence = highlightSequence;
      var highlightArcSequence =  highlightSequence;
      var highlightTextSequence = highlightSequence;
      var highlightDuration = '2s';
      // different sequence for "mere" matches (as opposed to "focus" and
      // "edited" highlights)
      var highlightMatchSequence = '#FFFF00'; // plain yellow

      var fragmentConnectorDashArray = '1,3,3,3';
      var fragmentConnectorColor = '#000000';

      // END OPTIONS


      var svg;
      var $svg;
      var data = null;
      var sourceData = null;
      var requestedData = null;
      var coll, doc, args;
      var relationTypesHash;
      var isRenderRequested;
      var isCollectionLoaded = false;
      var entityAttributeTypes = null;
      var eventAttributeTypes = null;
      var spanTypes = null;
      var highlightGroup;

      // var commentPrioLevels = ['Unconfirmed', 'Incomplete', 'Warning', 'Error', 'AnnotatorNotes'];
      // XXX Might need to be tweaked - inserted diff levels
      var commentPrioLevels = [
        'Unconfirmed', 'Incomplete', 'Warning', 'Error', 'AnnotatorNotes',
        'AddedAnnotation', 'MissingAnnotation', 'ChangedAnnotation'];

      this.arcDragOrigin = null; // TODO

      // due to silly Chrome bug, I have to make it pay attention
      var forceRedraw = function() {
        if (!$.browser.chrome) return; // not needed
        $svg.css('margin-bottom', 1);
        setTimeout(function() { $svg.css('margin-bottom', 0); }, 0);
      }

      var rowBBox = function(span) {
        var box = $.extend({}, span.rectBox); // clone
        var chunkTranslation = span.chunk.translation;
        box.x += chunkTranslation.x;
        box.y += chunkTranslation.y;
        return box;
      };

      var commentPriority = function(commentClass) {
        if (commentClass === undefined) return -1;
        var len = commentPrioLevels.length;
        for (var i = 0; i < len; i++) {
          if (commentClass.indexOf(commentPrioLevels[i]) != -1) return i;
        }
        return 0;
      };

      var clearSVG = function() {
        data = null;
        sourceData = null;
        svg.clear();
        $svgDiv.hide();
      };

      var setMarked = function(markedType) {
        $.each(args[markedType] || [], function(markedNo, marked) {
          if (marked[0] == 'sent') {
            data.markedSent[marked[1]] = true;
          } else if (marked[0] == 'equiv') { // [equiv, Equiv, T1]
            $.each(sourceData.equivs, function(equivNo, equiv) {
              if (equiv[1] == marked[1]) {
                var len = equiv.length;
                for (var i = 2; i < len; i++) {
                  if (equiv[i] == marked[2]) {
                    // found it
                    len -= 3;
                    for (var i = 1; i <= len; i++) {
                      var arc = data.eventDescs[equiv[0] + "*" + i].equivArc;
                      arc.marked = markedType;
                    }
                    return; // next equiv
                  }
                }
              }
            });
          } else if (marked.length == 2) {
            markedText.push([parseInt(marked[0], 10), parseInt(marked[1], 10), markedType]);
          } else {
            var span = data.spans[marked[0]];
            if (span) {
              if (marked.length == 3) { // arc
                $.each(span.outgoing, function(arcNo, arc) {
                  if (arc.target == marked[2] && arc.type == marked[1]) {
                    arc.marked = markedType;
                  }
                });
              } else { // span
                span.marked = markedType;
              }
            } else {
              var eventDesc = data.eventDescs[marked[0]];
              if (eventDesc) { // relation
                var relArc = eventDesc.roles[0];
                $.each(data.spans[eventDesc.triggerId].outgoing, function(arcNo, arc) {
                  if (arc.target == relArc.targetId && arc.type == relArc.type) {
                    arc.marked = markedType;
                  }
                });
              } else { // try for trigger
                $.each(data.eventDescs, function(eventDescNo, eventDesc) {
                  if (eventDesc.triggerId == marked[0]) {
                    data.spans[eventDesc.id].marked = markedType;
                  }
                });
              }
            }
          }
        });
      };

      var fragmentComparator = function(a, b) {
        var tmp;
        var aSpan = a.span;
        var bSpan = b.span;

        // spans with more fragments go first
        tmp = aSpan.fragments.length - bSpan.fragments.length;
        if (tmp) {
          return tmp < 0 ? 1 : -1;
        }

        // longer arc distances go last
        tmp = aSpan.avgDist - bSpan.avgDist;
        if (tmp) {
          return tmp < 0 ? -1 : 1;
        }
        // spans with more arcs go last
        tmp = aSpan.numArcs - bSpan.numArcs;
        if (tmp) {
          return tmp < 0 ? -1 : 1;
        }
        // compare the span widths,
        // put wider on bottom so they don't mess with arcs, or shorter
        // on bottom if there are no arcs.
        var ad = a.to - a.from;
        var bd = b.to - b.from;
        tmp = ad - bd;
        if (aSpan.numArcs == 0 && bSpan.numArcs == 0) {
          tmp = -tmp;
        }
        if (tmp) {
          return tmp < 0 ? 1 : -1;
        }
        tmp = aSpan.refedIndexSum - bSpan.refedIndexSum;
        if (tmp) {
          return tmp < 0 ? -1 : 1;
        }
        // if no other criterion is found, sort by type to maintain
        // consistency
        // TODO: isn't there a cmp() in JS?
        if (aSpan.type < bSpan.type) {
          return -1;
        } else if (aSpan.type > bSpan.type) {
          return 1;
        }

        return 0;
      };


      var setData = function(_sourceData) {
        if (!args) args = {};
        sourceData = _sourceData;
        dispatcher.post('newSourceData', [sourceData]);
        data = new DocumentData(sourceData.text);

        // collect annotation data
        $.each(sourceData.entities, function(entityNo, entity) {
          // offsets given as array of (start, end) pairs
          var span =
              //      (id,        type,      offsets,   generalType)
              new Span(entity[0], entity[1], entity[2], 'entity');
          data.spans[entity[0]] = span;
        });
        var triggerHash = {};
        $.each(sourceData.triggers, function(triggerNo, trigger) {
          triggerHash[trigger[0]] =
              //       (id,         type,       offsets,    generalType), eventList
              [new Span(trigger[0], trigger[1], trigger[2], 'trigger'), []];
        });
        $.each(sourceData.events, function(eventNo, eventRow) {
          var eventDesc = data.eventDescs[eventRow[0]] =
              //           (id,          triggerId,   roles,        klass)
              new EventDesc(eventRow[0], eventRow[1], eventRow[2]);
          var trigger = triggerHash[eventDesc.triggerId];
          var span = trigger[0].copy(eventDesc.id);
          trigger[1].push(span);
          data.spans[eventDesc.id] = span;
        });

        // XXX modifications: delete later
        $.each(sourceData.modifications, function(modNo, mod) {
          // mod: [id, spanId, modification]
          if (!data.spans[mod[2]]) {
            dispatcher.post('messages', [[['<strong>ERROR</strong><br/>Event ' + mod[2] + ' (referenced from modification ' + mod[0] + ') does not occur in document ' + data.document + '<br/>(please correct the source data)', 'error', 5]]]);
            return;
          }
          data.spans[mod[2]][mod[1]] = true;
        });

        var midpointComparator = function(a, b) {
          var tmp = a.from + a.to - b.from - b.to;
          if (!tmp) return 0;
          return tmp < 0 ? -1 : 1;
        };
        // split spans into span fragments (for discontinuous spans)
        $.each(data.spans, function(spanNo, span) {
          $.each(span.offsets, function(offsetsNo, offsets) {
            var from = parseInt(offsets[0], 10);
            var to = parseInt(offsets[1], 10);
            var fragment = new Fragment(offsetsNo, span, from, to);
            span.fragments.push(fragment);
          });
          // ensure ascending order
          span.fragments.sort(midpointComparator);
          span.wholeFrom = span.fragments[0].from;
          span.wholeTo = span.fragments[span.fragments.length - 1].to;
          span.headFragment = span.fragments[(true) ? span.fragments.length - 1 : 0]; // TODO configurable!
        });

        var spanComparator = function(a, b) {
          var aSpan = data.spans[a];
          var bSpan = data.spans[b];
          var tmp = aSpan.headFragment.from + aSpan.headFragment.to - bSpan.headFragment.from - bSpan.headFragment.to;
          if (tmp) {
            return tmp < 0 ? -1 : 1;
          }
          return 0;
        };
        $.each(sourceData.equivs, function(equivNo, equiv) {
          // equiv: ['*', 'Equiv', spanId...]
          equiv[0] = "*" + equivNo;
          var equivSpans = equiv.slice(2);
          var okEquivSpans = [];
          // collect the equiv spans in an array
          $.each(equivSpans, function(equivSpanNo, equivSpan) {
            if (data.spans[equivSpan]) okEquivSpans.push(equivSpan);
            // TODO: #404, inform the user with a message?
          });
          // sort spans in the equiv by their midpoint
          okEquivSpans.sort(spanComparator);
          // generate the arcs
          var len = okEquivSpans.length;
          for (var i = 1; i < len; i++) {
            var eventDesc = data.eventDescs[equiv[0] + '*' + i] =
                //           (id,                  triggerId,           roles,                         klass)
                new EventDesc(okEquivSpans[i - 1], okEquivSpans[i - 1], [[equiv[1], okEquivSpans[i]]], 'equiv');
            eventDesc.leftSpans = okEquivSpans.slice(0, i);
            eventDesc.rightSpans = okEquivSpans.slice(i);
          }
        });
        $.each(sourceData.relations, function(relNo, rel) {
          // rel[2] is args, rel[2][a][0] is role and rel[2][a][1] is value for a in (0,1)
          var argsDesc = relationTypesHash[rel[1]];
          argsDesc = argsDesc && argsDesc.args;
          var t1, t2;
          if (argsDesc) {
            // sort the arguments according to the config
            var args = {}
            args[rel[2][0][0]] = rel[2][0][1];
            args[rel[2][1][0]] = rel[2][1][1];
            t1 = args[argsDesc[0].role];
            t2 = args[argsDesc[1].role];
          } else {
            // (or leave as-is in its absence)
            t1 = rel[2][0][1];
            t2 = rel[2][1][1];
          }
          data.eventDescs[rel[0]] =
              //           (id, triggerId, roles,          klass)
              new EventDesc(t1, t1,        [[rel[1], t2]], 'relation');
        });

        // attributes
        $.each(sourceData.attributes, function(attrNo, attr) {
          // attr: [id, name, spanId, value, cueSpanId

          // TODO: might wish to check what's appropriate for the type
          // instead of using the first attribute def found
          var attrType = (eventAttributeTypes[attr[1]] ||
                          entityAttributeTypes[attr[1]]);
          var attrValue = attrType && attrType.values[attrType.bool || attr[3]];
          var span = data.spans[attr[2]];
          if (!span) {
            dispatcher.post('messages', [[['Annotation ' + attr[2] + ', referenced from attribute ' + attr[0] + ', does not exist.', 'error']]]);
            return;
          }
          var valText = (attrValue && attrValue.name) || attr[3];
          var attrText = attrType
            ? (attrType.bool ? attrType.name : (attrType.name + ': ' + valText))
            : (attr[3] == true ? attr[1] : attr[1] + ': ' + attr[3]);
          span.attributeText.push(attrText);
          span.attributes[attr[1]] = attr[3];
          if (attr[4]) { // cue
            span.attributeCues[attr[1]] = attr[4];
            var cueSpan = data.spans[attr[4]];
            cueSpan.attributeCueFor[data.spans[1]] = attr[2];
            cueSpan.cue = 'CUE'; // special css type
          }
          $.extend(span.attributeMerge, attrValue);
        });

        // comments
        $.each(sourceData.comments, function(commentNo, comment) {
          // comment: [entityId, type, text]

          // TODO error handling

          // sentence id: ['sent', sentId]
          if (comment[0] instanceof Array && comment[0][0] == 'sent') {
            // sentence comment
            var sent = comment[0][1];
            var text = comment[2];
            if (data.sentComment[sent]) {
              text = data.sentComment[sent].text + '<br/>' + text;
            }
            data.sentComment[sent] = { type: comment[1], text: text };
          } else {
            var id = comment[0];
            var trigger = triggerHash[id];
            var eventDesc = data.eventDescs[id];
            var commentEntities =
                trigger
                ? trigger[1] // trigger: [span, ...]
                : id in data.spans
                  ? [data.spans[id]] // span: [span]
                  : id in data.eventDescs
                    ? [data.eventDescs[id]] // arc: [eventDesc]
                    : [];
            $.each(commentEntities, function(entityId, entity) {
              // if duplicate comment for entity:
              // overwrite type, concatenate comment with a newline
              if (!entity.comment) {
                entity.comment = { type: comment[1], text: comment[2] };
              } else {
                entity.comment.type = comment[1];
                entity.comment.text += "\n" + comment[2];
              }
              // partially duplicate marking of annotator note comments
              if (comment[1] == "AnnotatorNotes") {
                entity.annotatorNotes = comment[2];
              }
              // prioritize type setting when multiple comments are present
              if (commentPriority(comment[1]) > commentPriority(entity.shadowClass)) {
                entity.shadowClass = comment[1];
              }
            });
          }
        });

        // normalizations
        $.each(sourceData.normalizations, function(normNo, norm) {
          var id = norm[0];
          var normType = norm[1];
          var target = norm[2];
          var refdb = norm[3];
          var refid = norm[4];
          var reftext = norm[5];

          // grab entity / event the normalization applies to
          var span = data.spans[target];
          if (!span) {
            dispatcher.post('messages', [[['Annotation ' + target + ', referenced from normalization ' + id + ', does not exist.', 'error']]]);
            return;
          }

          // TODO: do we have any possible use for the normType?
          span.normalizations.push([refdb, refid, reftext]);

          // quick hack for span box visual style
          span.normalized = 'Normalized';
        });

        // prepare span boundaries for token containment testing
        var sortedFragments = [];
        $.each(data.spans, function(spanNo, span) {
          $.each(span.fragments, function(fragmentNo, fragment) {
            sortedFragments.push(fragment);
          });
        });
        // sort fragments by beginning, then by end
        sortedFragments.sort(function(a, b) {
          var x = a.from;
          var y = b.from;
          if (x == y) {
            x = a.to;
            y = b.to;
          }
          return ((x < y) ? -1 : ((x > y) ? 1 : 0));
        });
        var currentFragmentId = 0;
        var startFragmentId = 0;
        var numFragments = sortedFragments.length;
        var lastTo = 0;
        var firstFrom = null;
        var chunkNo = 0;
        var space;
        var chunk = null;
        // token containment testing (chunk recognition)
        $.each(sourceData.token_offsets, function() {
          var from = this[0];
          var to = this[1];
          if (firstFrom === null) firstFrom = from;

          // Replaced for speedup; TODO check correctness
          // inSpan = false;
          // $.each(data.spans, function(spanNo, span) {
          //   if (span.from < to && to < span.to) {
          //     // it does; no word break
          //     inSpan = true;
          //     return false;
          //   }
          // });

          // Is the token end inside a span?
          if (startFragmentId && to > sortedFragments[startFragmentId - 1].to) {
            while (startFragmentId < numFragments && to > sortedFragments[startFragmentId].from) {
              startFragmentId++;
            }
          }
          currentFragmentId = startFragmentId;
          while (currentFragmentId < numFragments && to >= sortedFragments[currentFragmentId].to) {
            currentFragmentId++;
          }
          // if yes, the next token is in the same chunk
          if (currentFragmentId < numFragments && to > sortedFragments[currentFragmentId].from) {
            return;
          }

          //Renaud test chunk must not be longer than n
          /*var n = 80;
          var loop = 3;
          if(to - firstFrom > n){ //103
            //create 3 chunks
            for(var i = 0; i < loop; ++i){
              var length = Math.floor((to - firstFrom)/loop);
              var to2 = firstFrom + (length * (i + 1));
              var firstFrom2 = (firstFrom + (length * i)) + 1;

              // otherwise, create the chunk found so far
              space = data.text.substring(to2, firstFrom2);
              var text = data.text.substring(firstFrom2, to2);
              if (chunk) chunk.nextSpace = space;
              chunk = new Chunk(chunkNo++, text, firstFrom2, to2, space);
              data.chunks.push(chunk);
            }

          }else{*/
            // otherwise, create the chunk found so far
            space = data.text.substring(lastTo, firstFrom);
            var text = data.text.substring(firstFrom, to);
            if (chunk) chunk.nextSpace = space;
            //               (index,     text, from,      to, space) {
            chunk = new Chunk(chunkNo++, text, firstFrom, to, space);
            data.chunks.push(chunk);
          /*}*/
          lastTo = to;
          firstFrom = null;
        });
        var numChunks = chunkNo;

        // find sentence boundaries in relation to chunks
        chunkNo = 0;
        var sentenceNo = 0;
        var pastFirst = false;
        $.each(sourceData.sentence_offsets, function() {
          var from = this[0];
          if (chunkNo >= numChunks) return false;
          if (data.chunks[chunkNo].from > from) return;
          var chunk;
          while (chunkNo < numChunks && (chunk = data.chunks[chunkNo]).from < from) {
            chunkNo++;
          }
          chunkNo++;
          if (pastFirst && from <= chunk.from) {
            var numNL = chunk.space.split("\n").length - 1;
            if (!numNL) numNL = 1;
            sentenceNo += numNL;
            chunk.sentence = sentenceNo;
          } else {
            pastFirst = true;
          }
        });

        // assign fragments to appropriate chunks
        var currentChunkId = 0;
        var chunk;
        $.each(sortedFragments, function(fragmentId, fragment) {
          while (fragment.to > (chunk = data.chunks[currentChunkId]).to) currentChunkId++;
          chunk.fragments.push(fragment);
          fragment.text = chunk.text.substring(fragment.from - chunk.from, fragment.to - chunk.from);
          fragment.chunk = chunk;
        });

        // assign arcs to spans; calculate arc distances
        $.each(data.eventDescs, function(eventNo, eventDesc) {
          var dist = 0;
          var origin = data.spans[eventDesc.id];
          if (!origin) {
            // TODO: include missing trigger ID in error message
            dispatcher.post('messages', [[['<strong>ERROR</strong><br/>Trigger for event "' + eventDesc.id + '" not found in ' + data.document + '<br/>(please correct the source data)', 'error', 5]]]);
            return;
          }
          var here = origin.headFragment.from + origin.headFragment.to;
          $.each(eventDesc.roles, function(roleNo, role) {
            var target = data.spans[role.targetId];
            if (!target) {
              dispatcher.post('messages', [[['<strong>ERROR</strong><br/>"' + role.targetId + '" (referenced from "' + eventDesc.id + '") not found in ' + data.document + '<br/>(please correct the source data)', 'error', 5]]]);
              return;
            }
            var there = target.headFragment.from + target.headFragment.to;
            var dist = Math.abs(here - there);
            var arc = new Arc(eventDesc, role, dist, eventNo);
            origin.totalDist += dist;
            origin.numArcs++;
            target.totalDist += dist;
            target.numArcs++;
            data.arcs.push(arc);
            target.incoming.push(arc);
            origin.outgoing.push(arc);
            // ID dict for easy access. TODO: have a function defining the
            // (origin,type,target)->id mapping (see also annotator_ui.js)
            var arcId = origin.id + '--' + role.type + '--' + target.id;
            data.arcById[arcId] = arc;
          }); // roles
        }); // eventDescs

        // highlighting
        markedText = [];
        setMarked('edited'); // set by editing process
        setMarked('focus'); // set by URL
        setMarked('matchfocus'); // set by search process, focused match
        setMarked('match'); // set by search process, other (non-focused) match

        $.each(data.spans, function(spanId, span) {
          // calculate average arc distances
          // average distance of arcs (0 for no arcs)
          span.avgDist = span.numArcs ? span.totalDist / span.numArcs : 0;
          lastSpan = span;

          // collect fragment texts into span texts
          var fragmentTexts = [];
          $.each(span.fragments, function(fragmentNo, fragment) {
            // TODO heuristics
            fragmentTexts.push(fragment.text);
          });
          span.text = fragmentTexts.join('');
        }); // data.spans

        for (var i = 0; i < 2; i++) {
          // preliminary sort to assign heights for basic cases
          // (first round) and cases resolved in the previous
          // round(s).
          $.each(data.chunks, function(chunkNo, chunk) {
            // sort
            chunk.fragments.sort(fragmentComparator);
            // renumber
            $.each(chunk.fragments, function(fragmentNo, fragment) {
              fragment.indexNumber = fragmentNo;
            });
          });
          // nix the sums, so we can sum again
          $.each(data.spans, function(spanNo, span) {
            span.refedIndexSum = 0;
          });
          // resolved cases will now have indexNumber set
          // to indicate their relative order. Sum those for referencing cases
          // for use in iterative resorting
          $.each(data.arcs, function(arcNo, arc) {
            data.spans[arc.origin].refedIndexSum += data.spans[arc.target].headFragment.indexNumber;
          });
        }

        // Final sort of fragments in chunks for drawing purposes
        // Also identify the marked text boundaries regarding chunks
        $.each(data.chunks, function(chunkNo, chunk) {
          // and make the next sort take this into account. Note that this will
          // now resolve first-order dependencies between sort orders but not
          // second-order or higher.
          chunk.fragments.sort(fragmentComparator);
          $.each(chunk.fragments, function(fragmentNo, fragment) {
            fragment.drawOrder = fragmentNo;
          });
        });

        data.spanDrawOrderPermutation = Object.keys(data.spans);
        data.spanDrawOrderPermutation.sort(function(a, b) {
          var spanA = data.spans[a];
          var spanB = data.spans[b];

          // We're jumping all over the chunks, but it's enough that
          // we're doing everything inside each chunk in the right
          // order. should it become necessary to actually do these in
          // linear order, put in a similar condition for
          // spanX.headFragment.chunk.index; but it should not be
          // needed.

          var tmp = spanA.headFragment.drawOrder - spanB.headFragment.drawOrder;
          if (tmp) return tmp < 0 ? -1 : 1;

          return 0;
        });

        // resort the spans for linear order by center
        sortedFragments.sort(midpointComparator);

        // sort fragments into towers, calculate average arc distances
        var lastFragment = null;
        var towerId = -1;
        $.each(sortedFragments, function(i, fragment) {
          if (!lastFragment || (lastFragment.from != fragment.from || lastFragment.to != fragment.to)) {
            towerId++;
          }
          fragment.towerId = towerId;
          lastFragment = fragment;
        }); // sortedFragments

        // find curlies (only the first fragment drawn in a tower)
        $.each(data.spanDrawOrderPermutation, function(spanIdNo, spanId) {
          var span = data.spans[spanId];

          $.each(span.fragments, function(fragmentNo, fragment) {
            if (!data.towers[fragment.towerId]) {
              data.towers[fragment.towerId] = [];
              fragment.drawCurly = true;
              fragment.span.drawCurly = true;
            }
            data.towers[fragment.towerId].push(fragment);
          });
        });

        var spanAnnTexts = {};
        $.each(data.chunks, function(chunkNo, chunk) {
          chunk.markedTextStart = [];
          chunk.markedTextEnd = [];

          $.each(chunk.fragments, function(fragmentNo, fragment) {
            if (chunk.firstFragmentIndex == undefined) {
              chunk.firstFragmentIndex = fragment.towerId;
            }
            chunk.lastFragmentIndex = fragment.towerId;

            var spanLabels = Util.getSpanLabels(spanTypes, fragment.span.type);
            fragment.labelText = Util.spanDisplayForm(spanTypes, fragment.span.type);
            // Find the most appropriate label according to text width
            if (Configuration.abbrevsOn && spanLabels) {
              var labelIdx = 1; // first abbrev
              var maxLength = (fragment.to - fragment.from) / 0.8;
              while (fragment.labelText.length > maxLength &&
                  spanLabels[labelIdx]) {
                fragment.labelText = spanLabels[labelIdx];
                labelIdx++;
              }
            }

            var svgtext = svg.createText(); // one "text" element per row
            var postfixArray = [];
            var prefix = '';
            var postfix = '';
            var warning = false;
            $.each(fragment.span.attributes, function(attrType, valType) {
              // TODO: might wish to check what's appropriate for the type
              // instead of using the first attribute def found
              var attr = (eventAttributeTypes[attrType] ||
                          entityAttributeTypes[attrType]);
              if (!attr) {
                // non-existent type
                warning = true;
                return;
              }
              var val = attr.values[attr.bool || valType];
              if (!val) {
                // non-existent value
                warning = true;
                return;
              }
              if ($.isEmptyObject(val)) {
                // defined, but lacks any visual presentation
                warning = true;
                return;
              }
              if (val.glyph) {
                if (val.position == "left") {
                  prefix = val.glyph + prefix;
                  var css = 'glyph';
                  if (attr.css) css += ' glyph_' + Util.escapeQuotes(attr.css);
                  svgtext.span(val.glyph, { 'class': css });
                } else { // XXX right is implied - maybe change
                  postfixArray.push([attr, val]);
                  postfix += val.glyph;
                }
              }
            });
            var text = fragment.labelText;
            if (prefix !== '') {
              text = prefix + ' ' + text;
              svgtext.string(' ');
            }
            svgtext.string(fragment.labelText);
            if (postfixArray.length) {
              text += ' ' + postfix;
              svgtext.string(' ');
              $.each(postfixArray, function(elNo, el) {
                var css = 'glyph';
                if (el[0].css) css += ' glyph_' + Util.escapeQuotes(el[0].css);
                svgtext.span(el[1].glyph, { 'class': css });
              });
            }
            if (warning) {
              svgtext.span("#", { 'class': 'glyph attribute_warning' });
              text += ' #';
            }
            fragment.glyphedLabelText = text;

            if (!spanAnnTexts[text]) {
              spanAnnTexts[text] = true;
              data.spanAnnTexts[text] = svgtext;
            }
          }); // chunk.fragments
        }); // chunks

        var numChunks = data.chunks.length;
        // note the location of marked text with respect to chunks
        var startChunk = 0;
        var currentChunk;
        // sort by "from"; we don't need to sort by "to" as well,
        // because unlike spans, chunks are disjunct
        markedText.sort(function(a, b) {
          return Util.cmp(a[0], b[0]);
        });
        $.each(markedText, function(textNo, textPos) {
          var from = textPos[0];
          var to = textPos[1];
          var markedType = textPos[2];
          if (from < 0) from = 0;
          if (to < 0) to = 0;
          if (to >= data.text.length) to = data.text.length - 1;
          if (from > to) from = to;
          while (startChunk < numChunks) {
            var chunk = data.chunks[startChunk];
            if (from <= chunk.to) {
              chunk.markedTextStart.push([textNo, true, from - chunk.from, null, markedType]);
              break;
            }
            startChunk++;
          }
          if (startChunk == numChunks) {
            dispatcher.post('messages', [[['Wrong text offset', 'error']]]);
            return;
          }
          currentChunk = startChunk;
          while (currentChunk < numChunks) {
            var chunk = data.chunks[currentChunk];
            if (to <= chunk.to) {
              chunk.markedTextEnd.push([textNo, false, to - chunk.from]);
              break
            }
            currentChunk++;
          }
          if (currentChunk == numChunks) {
            dispatcher.post('messages', [[['Wrong text offset', 'error']]]);
            var chunk = data.chunks[data.chunks.length - 1];
            chunk.markedTextEnd.push([textNo, false, chunk.text.length]);
            return;
          }
        }); // markedText

        dispatcher.post('dataReady', [data]);
      };

      var resetData = function() {
        setData(sourceData);
        renderData();
      }

      var translate = function(element, x, y) {
        $(element.group).attr('transform', 'translate(' + x + ', ' + y + ')');
        element.translation = { x: x, y: y };
      };

      var showMtime = function() {
        if (data.mtime) {
            // we're getting seconds and need milliseconds
            //$('#document_ctime').text("Created: " + Annotator.formatTime(1000 * data.ctime)).css("display", "inline");
            $('#document_mtime').text("Last modified: " + Util.formatTimeAgo(1000 * data.mtime)).css("display", "inline");
        } else {
            //$('#document_ctime').css("display", "none");
            $('#document_mtime').css("display", "none");
        }
      };

      var addHeaderAndDefs = function() {
        var commentName = (coll + '/' + doc).replace('--', '-\\-');
        $svg.append('<!-- document: ' + commentName + ' -->');
        var defs = svg.defs();
        var $blurFilter = $('<filter id="Gaussian_Blur"><feGaussianBlur in="SourceGraphic" stdDeviation="2" /></filter>');
        svg.add(defs, $blurFilter);
        return defs;
      }

      var getTextMeasurements = function(textsHash, options, callback) {
        // make some text elements, find out the dimensions
        var textMeasureGroup = svg.group(options);

        // changed from $.each because of #264 ('length' can appear)
        for (var text in textsHash) {
          if (textsHash.hasOwnProperty(text)) {
            svg.text(textMeasureGroup, 0, 0, text);
          }
        }

        // measuring goes on here
        var widths = {};
        $(textMeasureGroup).find('text').each(function(svgTextNo, svgText) {
          var text = $(svgText).text();
          widths[text] = this.getComputedTextLength();

          if (callback) {
            $.each(textsHash[text], function(text, object) {
              callback(object, svgText);
            });
          }
        });
        var bbox = textMeasureGroup.getBBox();
        svg.remove(textMeasureGroup);

        return new Measurements(widths, bbox.height, bbox.y);
      };

      var getTextAndSpanTextMeasurements = function() {
        // get the span text sizes
        var chunkTexts = {}; // set of span texts
        $.each(data.chunks, function(chunkNo, chunk) {
          chunk.row = undefined; // reset
          if (!(chunk.text in chunkTexts)) chunkTexts[chunk.text] = []
          var chunkText = chunkTexts[chunk.text];

          // here we also need all the spans that are contained in
          // chunks with this text, because we need to know the position
          // of the span text within the respective chunk text
          chunkText.push.apply(chunkText, chunk.fragments);
          // and also the markedText boundaries
          chunkText.push.apply(chunkText, chunk.markedTextStart);
          chunkText.push.apply(chunkText, chunk.markedTextEnd);
        });
        var textSizes = getTextMeasurements(
          chunkTexts,
          undefined,
          function(fragment, text) {
            if (fragment instanceof Fragment) { // it's a fragment!
              // measure the fragment text position in pixels
              var firstChar = fragment.from - fragment.chunk.from;
              if (firstChar < 0) {
                firstChar = 0;
                dispatcher.post('messages', [[['<strong>WARNING</strong>' +
                  '<br/> ' +
                  'The fragment [' + fragment.from + ', ' + fragment.to + '] (' + fragment.text + ') is not ' +
                  'contained in its designated chunk [' +
                  fragment.chunk.from + ', ' + fragment.chunk.to + '] most likely ' +
                  'due to the fragment starting or ending with a space, please ' +
                  'verify the sanity of your data since we are unable to ' +
                  'visualise this fragment correctly and will drop leading ' +
                  'space characters'
                  , 'warning', 15]]]);
              }
              var startPos = text.getStartPositionOfChar(firstChar).x;
              var lastChar = fragment.to - fragment.chunk.from - 1;
              var endPos = (lastChar < 0)
                ? startPos
                : text.getEndPositionOfChar(lastChar).x;
              fragment.curly = {
                from: startPos,
                to: endPos
              };
            } else { // it's markedText [id, start?, char#, offset]
              if (fragment[2] < 0) fragment[2] = 0;
              if (!fragment[2]) { // start
                fragment[3] = text.getStartPositionOfChar(fragment[2]).x;
              } else {
                fragment[3] = text.getEndPositionOfChar(fragment[2] - 1).x + 1;
              }
            }
          });

        // get the fragment annotation text sizes
        var fragmentTexts = {};
        var noSpans = true;
        $.each(data.spans, function(spanNo, span) {
          $.each(span.fragments, function(fragmentNo, fragment) {
            fragmentTexts[fragment.glyphedLabelText] = true;
            noSpans = false;
          });
        });
        if (noSpans) fragmentTexts.$ = true; // dummy so we can at least get the height
        var fragmentSizes = getTextMeasurements(fragmentTexts, {'class': 'span'});

        return {
          texts: textSizes,
          fragments: fragmentSizes
        };
      };

      var addArcTextMeasurements = function(sizes) {
        // get the arc annotation text sizes (for all labels)
        var arcTexts = {};
        $.each(data.arcs, function(arcNo, arc) {
          var labels = Util.getArcLabels(spanTypes, data.spans[arc.origin].type, arc.type, relationTypesHash);
          if (!labels.length) labels = [arc.type];
          $.each(labels, function(labelNo, label) {
            arcTexts[label] = true;
          });
        });
        var arcSizes = getTextMeasurements(arcTexts, {'class': 'arcs'});
        sizes.arcs = arcSizes;
      };

      var adjustTowerAnnotationSizes = function() {
        // find biggest annotation in each tower
        $.each(data.towers, function(towerNo, tower) {
          var maxWidth = 0;
          $.each(tower, function(fragmentNo, fragment) {
            var width = data.sizes.fragments.widths[fragment.glyphedLabelText];
            if (width > maxWidth) maxWidth = width;
          }); // tower
          $.each(tower, function(fragmentNo, fragment) {
            fragment.width = maxWidth;
          }); // tower
        }); // data.towers
      };

      var makeArrow = function(defs, spec) {
        var parsedSpec = spec.split(',');
        var type = parsedSpec[0];
        if (type == 'none') return;

        var width = 5;
        var height = 5;
        var color = "black";
        if ($.isNumeric(parsedSpec[1]) && parsedSpec[2]) {
          if ($.isNumeric(parsedSpec[2]) && parsedSpec[3]) {
            // 3 args, 2 numeric: assume width, height, color
            width = parsedSpec[1];
            height = parsedSpec[2];
            color = parsedSpec[3] || 'black';
          } else {
            // 2 args, 1 numeric: assume width/height, color
            width = height = parsedSpec[1];
            color = parsedSpec[2] || 'black';
          }
        } else {
          // other: assume color only
          width = height = 5;
          color = parsedSpec[1] || 'black';
        }
        // hash needs to be replaced as IDs don't permit it.
        var arrowId = 'arrow_' + spec.replace(/#/g, '').replace(/,/g, '_');

        var arrow;
        if (type == 'triangle') {
          arrow = svg.marker(defs, arrowId,
            width, height / 2, width, height, 'auto',
            {
              markerUnits: 'strokeWidth',
              'fill': color,
            });
          svg.polyline(arrow, [[0, 0], [width, height / 2], [0, height], [width / 12, height / 2]]);
        }
        return arrowId;
      }


      var drawing = false;
      var redraw = false;

      var renderDataReal = function(sourceData) {


Util.profileEnd('before render');
Util.profileStart('render');
Util.profileStart('init');

        if (!sourceData && !data) {
          dispatcher.post('doneRendering', [coll, doc, args]);
          return;
        }
        $svgDiv.show();
        if ((sourceData && sourceData.collection && (sourceData.document !== doc || sourceData.collection !== coll)) || drawing) {
          redraw = true;
          dispatcher.post('doneRendering', [coll, doc, args]);
          return;
        }
        redraw = false;
        drawing = true;

        if (sourceData) setData(sourceData);
        showMtime();

        // clear the SVG
        svg.clear(true);
        if (!data || data.length == 0) return;

        // establish the width according to the enclosing element
        canvasWidth = that.forceWidth || $svgDiv.width();

        var defs = addHeaderAndDefs();

        var backgroundGroup = svg.group({ 'class': 'background' });
        var glowGroup = svg.group({ 'class': 'glow' });
        highlightGroup = svg.group({ 'class': 'highlight' });
        var textGroup = svg.group({ 'class': 'text' });

Util.profileEnd('init');
Util.profileStart('measures');

        var sizes = getTextAndSpanTextMeasurements();
        data.sizes = sizes;

        adjustTowerAnnotationSizes();
        var maxTextWidth = 0;
        for (var text in sizes.texts.widths) {
          if (sizes.texts.widths.hasOwnProperty(text)) {
            var width = sizes.texts.widths[text]
            if (width > maxTextWidth) maxTextWidth = width;
          }
        }

Util.profileEnd('measures');
Util.profileStart('chunks');

        var currentX = Configuration.visual.margin.x + sentNumMargin + rowPadding;
        var rows = [];
        var fragmentHeights = [];
        var sentenceToggle = 0;
        var sentenceNumber = 0;
        var row = new Row(svg);
        row.sentence = ++sentenceNumber;
        row.backgroundIndex = sentenceToggle;
        row.index = 0;
        var rowIndex = 0;
        var twoBarWidths; // HACK to avoid measuring space's width
        var openTextHighlights = {};
        var textMarkedRows = [];

        addArcTextMeasurements(sizes);

        // reserve places for spans
        var floors = [];
        var reservations = []; // reservations[chunk][floor] = [[from, to, headroom]...]
        for (var i = 0; i <= data.lastFragmentIndex; i++) {
          reservation[i] = {};
        }
        var inf = 1.0/0.0;

        $.each(data.spanDrawOrderPermutation, function(spanIdNo, spanId) {
          var span = data.spans[spanId];

          var f1 = span.fragments[0];
          var f2 = span.fragments[span.fragments.length - 1];

          var x1 = (f1.curly.from + f1.curly.to - f1.width) / 2 -
              Configuration.visual.margin.x;
          var i1 = f1.chunk.index;

          var x2 = (f2.curly.from + f2.curly.to + f2.width) / 2 +
              Configuration.visual.margin.x;
          var i2 = f2.chunk.index;

          // Start from the ground level, going up floor by floor.
          // If no more floors, make a new available one.
          // If a floor is available and there is no carpet, mark it as carpet.
          // If a floor is available and there is carpet and height
          //   difference is at least fragment height + curly, OK.
          // If a floor is not available, forget about carpet.
          // --
          // When OK, calculate exact ceiling.
          // If there isn't one, make a new floor, copy reservations
          //   from floor below (with decreased ceiling)
          // Make the reservation from the carpet to just below the
          //   current floor.
          //
          // TODO drawCurly and height could be prettified to only check
          // actual positions of curlies
          var carpet = 0;
          var outside = true;
          var thisCurlyHeight = span.drawCurly ? Configuration.visual.curlyHeight : 0;
          var height = sizes.fragments.height + thisCurlyHeight + Configuration.visual.boxSpacing +
              2 * Configuration.visual.margin.y - 3;
          $.each(floors, function(floorNo, floor) {
            var floorAvailable = true;
            for (var i = i1; i <= i2; i++) {
              if (!(reservations[i] && reservations[i][floor])) continue;
              var from = (i == i1) ? x1 : -inf;
              var to = (i == i2) ? x2 : inf;
              $.each(reservations[i][floor], function(resNo, res) {
                if (res[0] < to && from < res[1]) {
                  floorAvailable = false;
                  return false;
                }
              });
            }
            if (floorAvailable) {
              if (carpet === null) {
                carpet = floor;
              } else if (height + carpet <= floor) {
                // found our floor!
                outside = false;
                return false;
              }
            } else {
              carpet = null;
            }
          });
          var reslen = reservations.length;
          var makeNewFloorIfNeeded = function(floor) {
            var floorNo = $.inArray(floor, floors);
            if (floorNo == -1) {
              floors.push(floor);
              floors.sort(Util.cmp);
              floorNo = $.inArray(floor, floors);
              if (floorNo != 0) {
                // copy reservations from the floor below
                var parquet = floors[floorNo - 1];
                for (var i = 0; i <= reslen; i++) {
                  if (reservations[i]) {
                    if (!reservations[i][parquet]) {
                      reservations[i][parquet] = [];
                    }
                    var footroom = floor - parquet;
                    $.each(reservations[i][parquet], function(resNo, res) {
                      if (res[2] > footroom) {
                        if (!reservations[i][floor]) {
                          reservations[i][floor] = [];
                        }
                        reservations[i][floor].push([res[0], res[1], res[2] - footroom]);
                      }
                    });
                  }
                }
              }
            }
            return floorNo;
          }
          var ceiling = carpet + height;
          var ceilingNo = makeNewFloorIfNeeded(ceiling);
          var carpetNo = makeNewFloorIfNeeded(carpet);
          // make the reservation
          var floor, floorNo;
          for (floorNo = carpetNo;
              (floor = floors[floorNo]) !== undefined && floor < ceiling;
              floorNo++) {
            var headroom = ceiling - floor;
            for (var i = i1; i <= i2; i++) {
              var from = (i == i1) ? x1 : 0;
              var to = (i == i2) ? x2 : inf;
              if (!reservations[i]) reservations[i] = {};
              if (!reservations[i][floor]) reservations[i][floor] = [];
              reservations[i][floor].push([from, to, headroom]); // XXX maybe add fragment; probably unnecessary
            }
          }
          span.floor = carpet + thisCurlyHeight;
        });

        $.each(data.chunks, function(chunkNo, chunk) {
          reservations = new Array();
          chunk.group = svg.group(row.group);
          chunk.highlightGroup = svg.group(chunk.group);

          var y = 0;
          var minArcDist;
          var hasLeftArcs, hasRightArcs, hasInternalArcs;
          var hasAnnotations;
          var chunkFrom = Infinity;
          var chunkTo = 0;
          var chunkHeight = 0;
          var spacing = 0;
          var spacingChunkId = null;
          var spacingRowBreak = 0;

          $.each(chunk.fragments, function(fragmentNo, fragment) {
            var span = fragment.span;
            var spanDesc = spanTypes[span.type];
            var bgColor = ((spanDesc && spanDesc.bgColor) ||
                           (spanTypes.SPAN_DEFAULT &&
                            spanTypes.SPAN_DEFAULT.bgColor) || '#ffffff');
            var fgColor = ((spanDesc && spanDesc.fgColor) ||
                           (spanTypes.SPAN_DEFAULT &&
                            spanTypes.SPAN_DEFAULT.fgColor) || '#000000');
            var borderColor = ((spanDesc && spanDesc.borderColor) ||
                               (spanTypes.SPAN_DEFAULT &&
                                spanTypes.SPAN_DEFAULT.borderColor) || '#000000');

            // special case: if the border 'color' value is 'darken',
            // then just darken the BG color a bit for the border.
            if (borderColor == 'darken') {
                borderColor = Util.adjustColorLightness(bgColor, -0.6);
            }

            fragment.group = svg.group(chunk.group, {
              'class': 'span',
            });

            var fragmentHeight = 0;

            if (!y) y = -sizes.texts.height;
            var x = (fragment.curly.from + fragment.curly.to) / 2;

            // XXX is it maybe sizes.texts?
            var yy = y + sizes.fragments.y;
            var hh = sizes.fragments.height;
            var ww = fragment.width;
            var xx = x - ww / 2;

            // text margin fine-tuning
            yy += boxTextMargin.y;
            hh -= 2*boxTextMargin.y;
            xx += boxTextMargin.x;
            ww -= 2*boxTextMargin.x;
            var rectClass = 'span_' + (span.cue || span.type) + ' span_default'; // TODO XXX first part unneeded I think; remove

            // attach e.g. "False_positive" into the type
            if (span.comment && span.comment.type) { rectClass += ' '+span.comment.type; }
            var bx = xx - Configuration.visual.margin.x - boxTextMargin.x;
            var by = yy - Configuration.visual.margin.y;
            var bw = ww + 2 * Configuration.visual.margin.x;
            var bh = hh + 2 * Configuration.visual.margin.y;

            if (roundCoordinates) {
              x  = (x|0)+0.5;
              bx = (bx|0)+0.5;
            }

            var shadowRect;
            var markedRect;
            if (span.marked) {
              markedRect = svg.rect(chunk.highlightGroup,
                  bx - markedSpanSize, by - markedSpanSize,
                  bw + 2 * markedSpanSize, bh + 2 * markedSpanSize, {

                  // filter: 'url(#Gaussian_Blur)',
                  'class': "shadow_EditHighlight",
                  rx: markedSpanSize,
                  ry: markedSpanSize,
              });
              svg.other(markedRect, 'animate', {
                'data-type': span.marked,
                attributeName: 'fill',
                values: (span.marked == 'match'? highlightMatchSequence
                         : highlightSpanSequence),
                dur: highlightDuration,
                repeatCount: 'indefinite',
                begin: 'indefinite'
              });
              chunkFrom = Math.min(bx - markedSpanSize, chunkFrom);
              chunkTo = Math.max(bx + bw + markedSpanSize, chunkTo);
              fragmentHeight = Math.max(bh + 2 * markedSpanSize, fragmentHeight);
            }
            // .match() removes unconfigured shadows, which were
            // always showing up as black.
            // TODO: don't hard-code configured shadowclasses.
            if (span.shadowClass &&
                span.shadowClass.match('True_positive|False_positive|False_negative|AnnotationError|AnnotationWarning|AnnotatorNotes|Normalized|AnnotationIncomplete|AnnotationUnconfirmed|rectEditHighlight|EditHighlight_arc|MissingAnnotation|ChangedAnnotation ')) {
              shadowRect = svg.rect(fragment.group,
                  bx - rectShadowSize, by - rectShadowSize,
                  bw + 2 * rectShadowSize, bh + 2 * rectShadowSize, {
                  'class': 'shadow_' + span.shadowClass,
                  filter: 'url(#Gaussian_Blur)',
                  rx: rectShadowRounding,
                  ry: rectShadowRounding,
              });
              chunkFrom = Math.min(bx - rectShadowSize, chunkFrom);
              chunkTo = Math.max(bx + bw + rectShadowSize, chunkTo);
              fragmentHeight = Math.max(bh + 2 * rectShadowSize, fragmentHeight);
            }
            fragment.rect = svg.rect(fragment.group,
                bx, by, bw, bh, {

                'class': rectClass,
                fill: bgColor,
                stroke: borderColor,
                rx: Configuration.visual.margin.x,
                ry: Configuration.visual.margin.y,
                'data-span-id': span.id,
                'data-fragment-id': fragment.id,
                'strokeDashArray': span.attributeMerge.dashArray,
              });

            // TODO XXX: quick nasty hack to allow normalizations
            // to be marked visually; do something cleaner!
            if (span.normalized) {
              $(fragment.rect).addClass(span.normalized);
            }

            fragment.right = bx + bw; // TODO put it somewhere nicer?
            if (!(span.shadowClass || span.marked)) {
              chunkFrom = Math.min(bx, chunkFrom);
              chunkTo = Math.max(bx + bw, chunkTo);
              fragmentHeight = Math.max(bh, fragmentHeight);
            }

            fragment.rectBox = { x: bx, y: by - span.floor, width: bw, height: bh };
            fragment.height = span.floor + hh + 3 * Configuration.visual.margin.y + Configuration.visual.curlyHeight + Configuration.visual.arcSpacing;
            var spacedTowerId = fragment.towerId * 2;
            if (!fragmentHeights[spacedTowerId] || fragmentHeights[spacedTowerId] < fragment.height) {
              fragmentHeights[spacedTowerId] = fragment.height;
            }
            $(fragment.rect).attr('y', yy - Configuration.visual.margin.y - span.floor);
            if (shadowRect) {
              $(shadowRect).attr('y', yy - rectShadowSize - Configuration.visual.margin.y - span.floor);
            }
            if (markedRect) {
              $(markedRect).attr('y', yy - markedSpanSize - Configuration.visual.margin.y - span.floor);
            }
            if (span.attributeMerge.box === "crossed") {
              svg.path(fragment.group, svg.createPath().
                  move(xx, yy - Configuration.visual.margin.y - span.floor).
                  line(xx + fragment.width,
                    yy + hh + Configuration.visual.margin.y - span.floor),
                  { 'class': 'boxcross' });
              svg.path(fragment.group, svg.createPath().
                  move(xx + fragment.width, yy - Configuration.visual.margin.y - span.floor).
                  line(xx, yy + hh + Configuration.visual.margin.y - span.floor),
                  { 'class': 'boxcross' });
            }
            var fragmentText = svg.text(fragment.group, x, y - span.floor, data.spanAnnTexts[fragment.glyphedLabelText], { fill: fgColor });

            // Make curlies to show the fragment
            if (fragment.drawCurly) {
              var curlyColor = 'grey';
              if (coloredCurlies) {
                var spanDesc = spanTypes[span.type];
                var bgColor = ((spanDesc && spanDesc.bgColor) ||
                               (spanTypes.SPAN_DEFAULT &&
                                spanTypes.SPAN_DEFAULT.fgColor) ||
                               '#000000');
                curlyColor = Util.adjustColorLightness(bgColor, -0.6);
              }

              var bottom = yy + hh + Configuration.visual.margin.y - span.floor + 1;
              svg.path(fragment.group, svg.createPath()
                  .move(fragment.curly.from, bottom + Configuration.visual.curlyHeight)
                  .curveC(fragment.curly.from, bottom,
                    x, bottom + Configuration.visual.curlyHeight,
                    x, bottom)
                  .curveC(x, bottom + Configuration.visual.curlyHeight,
                    fragment.curly.to, bottom,
                    fragment.curly.to, bottom + Configuration.visual.curlyHeight),
                {
                  'class': 'curly',
                  'stroke': curlyColor,
                });
              chunkFrom = Math.min(fragment.curly.from, chunkFrom);
              chunkTo = Math.max(fragment.curly.to, chunkTo);
              fragmentHeight = Math.max(Configuration.visual.curlyHeight, fragmentHeight);
            }

            if (fragment == span.headFragment) {
              // find the gap to fit the backwards arcs, but only on
              // head fragment - other fragments don't have arcs
              $.each(span.incoming, function(arcId, arc) {
                var leftSpan = data.spans[arc.origin];
                var origin = leftSpan.headFragment.chunk;
                var border;
                if (chunk.index == origin.index) {
                  hasInternalArcs = true;
                }
                if (origin.row) {
                  var labels = Util.getArcLabels(spanTypes, leftSpan.type, arc.type, relationTypesHash);
                  if (!labels.length) labels = [arc.type];
                  if (origin.row.index == rowIndex) {
                    // same row, but before this
                    border = origin.translation.x + leftSpan.fragments[leftSpan.fragments.length - 1].right;
                  } else {
                    border = Configuration.visual.margin.x + sentNumMargin + rowPadding;
                  }
                  var labelNo = Configuration.abbrevsOn ? labels.length - 1 : 0;
                  var smallestLabelWidth = sizes.arcs.widths[labels[labelNo]] + 2 * minArcSlant;
                  var gap = currentX + bx - border;
                  var arcSpacing = smallestLabelWidth - gap;
                  if (!hasLeftArcs || spacing < arcSpacing) {
                    spacing = arcSpacing;
                    spacingChunkId = origin.index + 1;
                  }
                  arcSpacing = smallestLabelWidth - bx;
                  if (!hasLeftArcs || spacingRowBreak < arcSpacing) {
                    spacingRowBreak = arcSpacing;
                  }
                  hasLeftArcs = true;
                } else {
                  hasRightArcs = true;
                }
              });
              $.each(span.outgoing, function(arcId, arc) {
                var leftSpan = data.spans[arc.target];
                var target = leftSpan.headFragment.chunk;
                var border;
                if (target.row) {
                  var labels = Util.getArcLabels(spanTypes, span.type, arc.type, relationTypesHash);
                  if (!labels.length) labels = [arc.type];
                  if (target.row.index == rowIndex) {
                    // same row, but before this
                    border = target.translation.x + leftSpan.fragments[leftSpan.fragments.length - 1].right;
                  } else {
                    border = Configuration.visual.margin.x + sentNumMargin + rowPadding;
                  }
                  var labelNo = Configuration.abbrevsOn ? labels.length - 1 : 0;
                  var smallestLabelWidth = sizes.arcs.widths[labels[labelNo]] + 2 * minArcSlant;
                  var gap = currentX + bx - border;
                  var arcSpacing = smallestLabelWidth - gap;
                  if (!hasLeftArcs || spacing < arcSpacing) {
                    spacing = arcSpacing;
                    spacingChunkId = target.index + 1;
                  }
                  arcSpacing = smallestLabelWidth - bx;
                  if (!hasLeftArcs || spacingRowBreak < arcSpacing) {
                    spacingRowBreak = arcSpacing;
                  }
                  hasLeftArcs = true;
                } else {
                  hasRightArcs = true;
                }
              });
            }
            fragmentHeight += span.floor || Configuration.visual.curlyHeight;
            if (fragmentHeight > chunkHeight) chunkHeight = fragmentHeight;
            hasAnnotations = true;
          }); // fragments

          // positioning of the chunk
          chunk.right = chunkTo;
          var textWidth = sizes.texts.widths[chunk.text];
          chunkHeight += sizes.texts.height;
          var boxX = -Math.min(chunkFrom, 0);
          var boxWidth =
              Math.max(textWidth, chunkTo) -
              Math.min(0, chunkFrom);
          // if (hasLeftArcs) {
            // TODO change this with smallestLeftArc
            // var spacing = arcHorizontalSpacing - (currentX - lastArcBorder);
            // arc too small?
          if (spacing > 0) currentX += spacing;
          // }
          var rightBorderForArcs = hasRightArcs ? arcHorizontalSpacing : (hasInternalArcs ? arcSlant : 0);

          var lastX = currentX;
          var lastRow = row;

          if (chunk.sentence) {
            while (sentenceNumber < chunk.sentence) {
              sentenceNumber++;
              row.arcs = svg.group(row.group, { 'class': 'arcs' });
              rows.push(row);
              row = new Row(svg);
              sentenceToggle = 1 - sentenceToggle;
              row.backgroundIndex = sentenceToggle;
              row.index = ++rowIndex;
            }
            sentenceToggle = 1 - sentenceToggle;
          }

          if (chunk.sentence ||
              currentX + boxWidth + rightBorderForArcs >= canvasWidth - 2 * Configuration.visual.margin.x) {
            // the chunk does not fit
            row.arcs = svg.group(row.group, { 'class': 'arcs' });
            // TODO: related to issue #571
            // replace arcHorizontalSpacing with a calculated value
            currentX = Configuration.visual.margin.x + sentNumMargin + rowPadding +
                (hasLeftArcs ? arcHorizontalSpacing : (hasInternalArcs ? arcSlant : 0));
            if (hasLeftArcs) {
              var adjustedCurTextWidth = sizes.texts.widths[chunk.text] + arcHorizontalSpacing;
              if (adjustedCurTextWidth > maxTextWidth) {
                maxTextWidth = adjustedCurTextWidth;
              }
            }
            if (spacingRowBreak > 0) {
              currentX += spacingRowBreak;
              spacing = 0; // do not center intervening elements
            }

            // new row
            rows.push(row);

            svg.remove(chunk.group);
            row = new Row(svg);
            row.backgroundIndex = sentenceToggle;
            row.index = ++rowIndex;
            svg.add(row.group, chunk.group);
            chunk.group = row.group.lastElementChild;
            $(chunk.group).children("g[class='span']").
              each(function(index, element) {
                  chunk.fragments[index].group = element;
              });
            $(chunk.group).find("rect[data-span-id]").
              each(function(index, element) {
                  chunk.fragments[index].rect = element;
              });
          }

          // break the text highlights when the row breaks
          if (row.index !== lastRow.index) {
            $.each(openTextHighlights, function(textId, textDesc) {
              if (textDesc[3] != lastX) {
                var newDesc = [lastRow, textDesc[3], lastX + boxX, textDesc[4]];
                textMarkedRows.push(newDesc);
              }
              textDesc[3] = currentX;
            });
          }

          // open text highlights
          $.each(chunk.markedTextStart, function(textNo, textDesc) {
            textDesc[3] += currentX + boxX;
            openTextHighlights[textDesc[0]] = textDesc;
          });

          // close text highlights
          $.each(chunk.markedTextEnd, function(textNo, textDesc) {
            textDesc[3] += currentX + boxX;
            var startDesc = openTextHighlights[textDesc[0]];
            delete openTextHighlights[textDesc[0]];
            markedRow = [row, startDesc[3], textDesc[3], startDesc[4]];
            textMarkedRows.push(markedRow);
          });

          // XXX check this - is it used? should it be lastRow?
          if (hasAnnotations) row.hasAnnotations = true;

          if (chunk.sentence) {
            row.sentence = ++sentenceNumber;
          }

          if (spacing > 0) {
            // if we added a gap, center the intervening elements
            spacing /= 2;
            var firstChunkInRow = row.chunks[row.chunks.length - 1];
            if (spacingChunkId < firstChunkInRow.index) {
              spacingChunkId = firstChunkInRow.index + 1;
            }
            for (var chunkIndex = spacingChunkId; chunkIndex < chunk.index; chunkIndex++) {
              var movedChunk = data.chunks[chunkIndex];
              translate(movedChunk, movedChunk.translation.x + spacing, 0);
              movedChunk.textX += spacing;
            }
          }

          row.chunks.push(chunk);
          chunk.row = row;

          translate(chunk, currentX + boxX, 0);
          chunk.textX = currentX + boxX;

          var spaceWidth = 0;
          var spaceLen = chunk.nextSpace && chunk.nextSpace.length || 0;
          for (var i = 0; i < spaceLen; i++) spaceWidth += spaceWidths[chunk.nextSpace[i]] || 0;
          currentX += spaceWidth + boxWidth;
        }); // chunks

        // finish the last row
        row.arcs = svg.group(row.group, { 'class': 'arcs' });
        rows.push(row);

Util.profileEnd('chunks');
Util.profileStart('arcsPrep');

        var arrows = {};
        var arrow = makeArrow(defs, 'none');
        if (arrow) arrows['none'] = arrow;

        var len = fragmentHeights.length;
        for (var i = 0; i < len; i++) {
          if (!fragmentHeights[i] || fragmentHeights[i] < Configuration.visual.arcStartHeight) {
            fragmentHeights[i] = Configuration.visual.arcStartHeight;
          }
        }

        // find out how high the arcs have to go
        $.each(data.arcs, function(arcNo, arc) {
          arc.jumpHeight = 0;
          var fromFragment = data.spans[arc.origin].headFragment;
          var toFragment = data.spans[arc.target].headFragment;
          if (fromFragment.towerId > toFragment.towerId) {
            var tmp = fromFragment; fromFragment = toFragment; toFragment = tmp;
          }
          var from, to;
          if (fromFragment.chunk.index == toFragment.chunk.index) {
            from = fromFragment.towerId;
            to = toFragment.towerId;
          } else {
            from = fromFragment.towerId + 1;
            to = toFragment.towerId - 1;
          }
          for (var i = from; i <= to; i++) {
            if (arc.jumpHeight < fragmentHeights[i * 2]) arc.jumpHeight = fragmentHeights[i * 2];
          }
        });

        // sort the arcs
        data.arcs.sort(function(a, b) {
          // first write those that have less to jump over
          var tmp = a.jumpHeight - b.jumpHeight;
          if (tmp) return tmp < 0 ? -1 : 1;
          // if equal, then those that span less distance
          tmp = a.dist - b.dist;
          if (tmp) return tmp < 0 ? -1 : 1;
          // if equal, then those where heights of the targets are smaller
          tmp = data.spans[a.origin].headFragment.height + data.spans[a.target].headFragment.height -
            data.spans[b.origin].headFragment.height - data.spans[b.target].headFragment.height;
          if (tmp) return tmp < 0 ? -1 : 1;
          // if equal, then those with the lower origin
          tmp = data.spans[a.origin].headFragment.height - data.spans[b.origin].headFragment.height;
          if (tmp) return tmp < 0 ? -1 : 1;
          // if equal, they're just equal.
          return 0;
        });

        // draw the drag arc marker
        var arrowhead = svg.marker(defs, 'drag_arrow',
          5, 2.5, 5, 5, 'auto',
          {
            markerUnits: 'strokeWidth',
            'class': 'drag_fill',
          });
        svg.polyline(arrowhead, [[0, 0], [5, 2.5], [0, 5], [0.2, 2.5]]);

Util.profileEnd('arcsPrep');
Util.profileStart('arcs');

        // add the arcs
        $.each(data.arcs, function(arcNo, arc) {
          // separate out possible numeric suffix from type
          var noNumArcType;
          var splitArcType;
          if (arc.type) {
            splitArcType = arc.type.match(/^(.*?)(\d*)$/);
            noNumArcType = splitArcType[1];
          }

          var originSpan = data.spans[arc.origin];
          var targetSpan = data.spans[arc.target];

          var leftToRight = originSpan.headFragment.towerId < targetSpan.headFragment.towerId;
          var left, right;
          if (leftToRight) {
            left = originSpan.headFragment;
            right = targetSpan.headFragment;
          } else {
            left = targetSpan.headFragment;
            right = originSpan.headFragment;
          }

          var spanDesc = spanTypes[originSpan.type];
          // TODO: might make more sense to reformat this as dict instead
          // of searching through the list every type
          var arcDesc;
          if (spanDesc && spanDesc.arcs) {
            $.each(spanDesc.arcs, function(arcDescNo, arcDescIter) {
                if (arcDescIter.type == arc.type) {
                  arcDesc = arcDescIter;
                }
              });
          }
          // fall back on unnumbered type if not found in full
          if (!arcDesc && noNumArcType && noNumArcType != arc.type &&
            spanDesc && spanDesc.arcs) {
            $.each(spanDesc.arcs, function(arcDescNo, arcDescIter) {
                if (arcDescIter.type == noNumArcType) {
                  arcDesc = arcDescIter;
                }
              });
          }
          // fall back on relation types in case we still don't have
          // an arc description, with final fallback to unnumbered relation
          if (!arcDesc) {
            arcDesc = $.extend({}, relationTypesHash[arc.type] || relationTypesHash[noNumArcType]);
          }
          var color = ((arcDesc && arcDesc.color) ||
                       (spanTypes.ARC_DEFAULT && spanTypes.ARC_DEFAULT.color) ||
                       '#000000');
          var symmetric = arcDesc && arcDesc.properties && arcDesc.properties.symmetric;
          var dashArray = arcDesc && arcDesc.dashArray;
          var arrowHead = ((arcDesc && arcDesc.arrowHead) ||
                           (spanTypes.ARC_DEFAULT && spanTypes.ARC_DEFAULT.arrowHead) ||
                           'triangle,5') + ',' + color;
          var labelArrowHead = ((arcDesc && arcDesc.labelArrow) ||
                                (spanTypes.ARC_DEFAULT && spanTypes.ARC_DEFAULT.labelArrow) ||
                                'triangle,5') + ',' + color;

          var leftBox = rowBBox(left);
          var rightBox = rowBBox(right);
          var leftRow = left.chunk.row.index;
          var rightRow = right.chunk.row.index;

          if (!arrows[arrowHead]) {
            var arrow = makeArrow(defs, arrowHead);
            if (arrow) arrows[arrowHead] = arrow;
          }
          if (!arrows[labelArrowHead]) {
            var arrow = makeArrow(defs, labelArrowHead);
            if (arrow) arrows[labelArrowHead] = arrow;
          }

          // find the next height
          var height = 0;

          var fromIndex2, toIndex2;
          if (left.chunk.index == right.chunk.index) {
            fromIndex2 = left.towerId * 2;
            toIndex2 = right.towerId * 2;
          } else {
            fromIndex2 = left.towerId * 2 + 1;
            toIndex2 = right.towerId * 2 - 1;
          }
          for (var i = fromIndex2; i <= toIndex2; i++) {
            if (fragmentHeights[i] > height) height = fragmentHeights[i];
          }
          height += Configuration.visual.arcSpacing;
          var leftSlantBound, rightSlantBound;
          for (var i = fromIndex2; i <= toIndex2; i++) {
            if (fragmentHeights[i] < height) fragmentHeights[i] = height;
          }

          // Adjust the height to align with pixels when rendered

          // TODO: on at least Chrome, this doesn't make a difference:
          // the lines come out pixel-width even without it. Check.
          height += 0.5

          var chunkReverse = false;
          var ufoCatcher = originSpan.headFragment.chunk.index == targetSpan.headFragment.chunk.index;
          if (ufoCatcher) {
            chunkReverse =
              leftBox.x + leftBox.width / 2 < rightBox.x + rightBox.width / 2;
          }
          var ufoCatcherMod = ufoCatcher ? chunkReverse ? -0.5 : 0.5 : 1;

          for (var rowIndex = leftRow; rowIndex <= rightRow; rowIndex++) {
            var row = rows[rowIndex];
            row.hasAnnotations = true;
            var arcGroup = svg.group(row.arcs, {
                'data-from': arc.origin,
                'data-to': arc.target
            });
            var from, to;

            if (rowIndex == leftRow) {
              from = leftBox.x + (chunkReverse ? 0 : leftBox.width);
            } else {
              from = sentNumMargin;
            }

            if (rowIndex == rightRow) {
              to = rightBox.x + (chunkReverse ? rightBox.width : 0);
            } else {
              to = canvasWidth - 2 * Configuration.visual.margin.y;
            }

            var originType = data.spans[arc.origin].type;
            var arcLabels = Util.getArcLabels(spanTypes, originType, arc.type, relationTypesHash);
            var labelText = Util.arcDisplayForm(spanTypes, originType, arc.type, relationTypesHash);
            // if (Configuration.abbrevsOn && !ufoCatcher && arcLabels) {
            if (Configuration.abbrevsOn && arcLabels) {
              var labelIdx = 1; // first abbreviation
              // strictly speaking 2*arcSlant would be needed to allow for
              // the full-width arcs to fit, but judged unabbreviated text
              // to be more important than the space for arcs.
              var maxLength = (to - from) - (arcSlant);
              while (sizes.arcs.widths[labelText] > maxLength &&
                     arcLabels[labelIdx]) {
                labelText = arcLabels[labelIdx];
                labelIdx++;
              }
            }

            var shadowGroup;
            if (arc.shadowClass || arc.marked) {
              shadowGroup = svg.group(arcGroup);
            }
            var options = {
              'fill': color,
              'data-arc-role': arc.type,
              'data-arc-origin': arc.origin,
              'data-arc-target': arc.target,
              // TODO: confirm this is unused and remove.
              //'data-arc-id': arc.id,
              'data-arc-ed': arc.eventDescId,
            };

            // construct SVG text, showing possible trailing index
            // numbers (as in e.g. "Theme2") as subscripts
            var svgText;
            if (!splitArcType[2]) {
                // no subscript, simple string suffices
                svgText = labelText;
            } else {
                // Need to parse out possible numeric suffixes to avoid
                // duplicating number in label and its subscript
                var splitLabelText = labelText.match(/^(.*?)(\d*)$/);
                var noNumLabelText = splitLabelText[1];

                svgText = svg.createText();
                // TODO: to address issue #453, attaching options also
                // to spans, not only primary text. Make sure there
                // are no problems with this.
                svgText.span(noNumLabelText, options);
                var subscriptSettings = {
                  'dy': '0.3em',
                  'font-size': '80%'
                };
                // alternate possibility
//                 var subscriptSettings = {
//                   'baseline-shift': 'sub',
//                   'font-size': '80%'
//                 };
                $.extend(subscriptSettings, options);
                svgText.span(splitArcType[2], subscriptSettings);
            }

            // guess at the correct baseline shift to get vertical centering.
            // (CSS dominant-baseline can't be used as not all SVG rendereds support it.)
            var baseline_shift = sizes.arcs.height / 4;
            var text = svg.text(arcGroup, (from + to) / 2, -height + baseline_shift,
                                svgText, options);

            var width = sizes.arcs.widths[labelText];
            var textBox = {
              x: (from + to - width) / 2,
              width: width,
              y: -height - sizes.arcs.height / 2,
              height: sizes.arcs.height,
            }
            if (arc.marked) {
              var markedRect = svg.rect(shadowGroup,
                  textBox.x - markedArcSize, textBox.y - markedArcSize,
                  textBox.width + 2 * markedArcSize, textBox.height + 2 * markedArcSize, {
                    // filter: 'url(#Gaussian_Blur)',
                    'class': "shadow_EditHighlight",
                    rx: markedArcSize,
                    ry: markedArcSize,
              });
              svg.other(markedRect, 'animate', {
                'data-type': arc.marked,
                attributeName: 'fill',
                values: (arc.marked == 'match' ? highlightMatchSequence
                         : highlightArcSequence),
                dur: highlightDuration,
                repeatCount: 'indefinite',
                begin: 'indefinite'
              });
            }
            if (arc.shadowClass) {
              svg.rect(shadowGroup,
                  textBox.x - arcLabelShadowSize,
                  textBox.y - arcLabelShadowSize,
                  textBox.width  + 2 * arcLabelShadowSize,
                  textBox.height + 2 * arcLabelShadowSize, {
                    'class': 'shadow_' + arc.shadowClass,
                    filter: 'url(#Gaussian_Blur)',
                    rx: arcLabelShadowRounding,
                    ry: arcLabelShadowRounding,
              });
            }
            var textStart = textBox.x;
            var textEnd = textBox.x + textBox.width;

            // adjust by margin for arc drawing
            textStart -= Configuration.visual.arcTextMargin;
            textEnd += Configuration.visual.arcTextMargin;

            if (from > to) {
              var tmp = textStart; textStart = textEnd; textEnd = tmp;
            }

            var path;

            if (roundCoordinates) {
              // don't ask
              height = (height|0)+0.5;
            }
            if (height > row.maxArcHeight) row.maxArcHeight = height;

            var myArrowHead   = ((arcDesc && arcDesc.arrowHead) ||
                                 (spanTypes.ARC_DEFAULT && spanTypes.ARC_DEFAULT.arrowHead));
            var arrowName = (leftToRight ?
                symmetric && myArrowHead || 'none' :
                myArrowHead || 'triangle,5') + ',' + color;
            var arrowType = arrows[arrowName];
            var arrowDecl = arrowType && ('url(#' + arrowType + ')');

            var arrowAtLabelAdjust = 0;
            var labelArrowDecl = null;
            var myLabelArrowHead = ((arcDesc && arcDesc.labelArrow) ||
                                    (spanTypes.ARC_DEFAULT && spanTypes.ARC_DEFAULT.labelArrow));
            if (myLabelArrowHead) {
              var labelArrowName = (leftToRight ?
                  symmetric && myLabelArrowHead || 'none' :
                  myLabelArrowHead || 'triangle,5') + ',' + color;
              var labelArrowSplit = labelArrowName.split(',');
              arrowAtLabelAdjust = labelArrowSplit[0] != 'none' && parseInt(labelArrowSplit[1], 10) || 0;
              var labelArrowType = arrows[labelArrowName];
              var labelArrowDecl = labelArrowType && ('url(#' + labelArrowType + ')');
              if (ufoCatcher) arrowAtLabelAdjust = -arrowAtLabelAdjust;
            }
            var arrowStart = textStart - arrowAtLabelAdjust;
            path = svg.createPath().move(arrowStart, -height);
            if (rowIndex == leftRow) {
              var cornerx = from + ufoCatcherMod * arcSlant;
              // for normal cases, should not be past textStart even if narrow
              if (!ufoCatcher && cornerx > arrowStart - 1) { cornerx = arrowStart - 1; }
              if (smoothArcCurves) {
                var controlx = ufoCatcher ? cornerx + 2*ufoCatcherMod*reverseArcControlx : smoothArcSteepness*from+(1-smoothArcSteepness)*cornerx;
                var endy = leftBox.y + (leftToRight || arc.equiv ? leftBox.height / 2 : Configuration.visual.margin.y);
                // no curving for short lines covering short vertical
                // distances, the arrowheads can go off (#925)
                if (Math.abs(-height-endy) < 2 &&
                    Math.abs(cornerx-from) < 5) {
                  endy = -height;
                }
                line = path.line(cornerx, -height).
                    curveQ(controlx, -height, from, endy);
              } else {
                path.line(cornerx, -height).
                    line(from, leftBox.y + (leftToRight || arc.equiv ? leftBox.height / 2 : Configuration.visual.margin.y));
              }
            } else {
              path.line(from, -height);
            }
            svg.path(arcGroup, path, {
                markerEnd: arrowDecl,
                markerStart: labelArrowDecl,
                style: 'stroke: ' + color,
                'strokeDashArray': dashArray,
            });
            if (arc.marked) {
              svg.path(shadowGroup, path, {
                  'class': 'shadow_EditHighlight_arc',
                  strokeWidth: markedArcStroke,
                  'strokeDashArray': dashArray,
              });
              svg.other(markedRect, 'animate', {
                'data-type': arc.marked,
                attributeName: 'fill',
                values: (arc.marked == 'match' ? highlightMatchSequence
                         : highlightArcSequence),
                dur: highlightDuration,
                repeatCount: 'indefinite',
                begin: 'indefinite'
              });
            }
            if (arc.shadowClass) {
              svg.path(shadowGroup, path, {
                  'class': 'shadow_' + arc.shadowClass,
                  strokeWidth: shadowStroke,
                  'strokeDashArray': dashArray,
              });
            }
            var myArrowHead = ((arcDesc && arcDesc.arrowHead) ||
                               (spanTypes.ARC_DEFAULT && spanTypes.ARC_DEFAULT.arrowHead));
            var arrowName = (leftToRight ?
                myArrowHead || 'triangle,5' :
                symmetric && myArrowHead || 'none') + ',' + color;
            var arrowType = arrows[arrowName];
            var arrowDecl = arrowType && ('url(#' + arrowType + ')');

            var arrowAtLabelAdjust = 0;
            var labelArrowDecl = null;
            var myLabelArrowHead = ((arcDesc && arcDesc.labelArrow) ||
                                    (spanTypes.ARC_DEFAULT && spanTypes.ARC_DEFAULT.labelArrow));
            if (myLabelArrowHead) {
              var labelArrowName = (leftToRight ?
                  myLabelArrowHead || 'triangle,5' :
                  symmetric && myLabelArrowHead || 'none') + ',' + color;
              var labelArrowSplit = labelArrowName.split(',');
              arrowAtLabelAdjust = labelArrowSplit[0] != 'none' && parseInt(labelArrowSplit[1], 10) || 0;
              var labelArrowType = arrows[labelArrowName];
              var labelArrowDecl = labelArrowType && ('url(#' + labelArrowType + ')');
              if (ufoCatcher) arrowAtLabelAdjust = -arrowAtLabelAdjust;
            }
            var arrowEnd = textEnd + arrowAtLabelAdjust;
            path = svg.createPath().move(arrowEnd, -height);
            if (rowIndex == rightRow) {
              var cornerx  = to - ufoCatcherMod * arcSlant;
              // TODO: duplicates above in part, make funcs
              // for normal cases, should not be past textEnd even if narrow
              if (!ufoCatcher && cornerx < arrowEnd + 1) { cornerx = arrowEnd + 1; }
              if (smoothArcCurves) {
                var controlx = ufoCatcher ? cornerx - 2*ufoCatcherMod*reverseArcControlx : smoothArcSteepness*to+(1-smoothArcSteepness)*cornerx;
                var endy = rightBox.y + (leftToRight && !arc.equiv ? Configuration.visual.margin.y : rightBox.height / 2);
                // no curving for short lines covering short vertical
                // distances, the arrowheads can go off (#925)
                if (Math.abs(-height-endy) < 2 &&
                    Math.abs(cornerx-to) < 5) {
                  endy = -height;
                }
                path.line(cornerx, -height).
                    curveQ(controlx, -height, to, endy);
              } else {
                path.line(cornerx, -height).
                    line(to, rightBox.y + (leftToRight && !arc.equiv ? Configuration.visual.margin.y : rightBox.height / 2));
              }
            } else {
              path.line(to, -height);
            }
            svg.path(arcGroup, path, {
                markerEnd: arrowDecl,
                markerStart: labelArrowDecl,
                style: 'stroke: ' + color,
                'strokeDashArray': dashArray,
            });
            if (arc.marked) {
              svg.path(shadowGroup, path, {
                  'class': 'shadow_EditHighlight_arc',
                  strokeWidth: markedArcStroke,
                  'strokeDashArray': dashArray,
              });
            }
            if (shadowGroup) {
              svg.path(shadowGroup, path, {
                  'class': 'shadow_' + arc.shadowClass,
                  strokeWidth: shadowStroke,
                  'strokeDashArray': dashArray,
              });
            }
          } // arc rows
        }); // arcs

Util.profileEnd('arcs');
Util.profileStart('fragmentConnectors');

        $.each(data.spans, function(spanNo, span) {
          var numConnectors = span.fragments.length - 1;
          for (var connectorNo = 0; connectorNo < numConnectors; connectorNo++) {
            var left = span.fragments[connectorNo];
            var right = span.fragments[connectorNo + 1];

            var leftBox = rowBBox(left);
            var rightBox = rowBBox(right);
            var leftRow = left.chunk.row.index;
            var rightRow = right.chunk.row.index;

            for (var rowIndex = leftRow; rowIndex <= rightRow; rowIndex++) {
              var row = rows[rowIndex];
              row.hasAnnotations = true;

              if (rowIndex == leftRow) {
                from = leftBox.x + leftBox.width;
              } else {
                from = sentNumMargin;
              }

              if (rowIndex == rightRow) {
                to = rightBox.x;
              } else {
                to = canvasWidth - 2 * Configuration.visual.margin.y;
              }

              var height = leftBox.y + leftBox.height - Configuration.visual.margin.y;
              if (roundCoordinates) {
                // don't ask
                height = (height|0)+0.5;
              }

              var path = svg.createPath().move(from, height).line(to, height);
              svg.path(row.arcs, path, {
                style: 'stroke: ' + fragmentConnectorColor,
                'strokeDashArray': fragmentConnectorDashArray
              });
            } // rowIndex
          } // connectorNo
        }); // spans

Util.profileEnd('fragmentConnectors');
Util.profileStart('rows');

        // position the rows
        var y = Configuration.visual.margin.y;
        var sentNumGroup = svg.group({'class': 'sentnum'});
        var currentSent;
        $.each(rows, function(rowId, row) {
          $.each(row.chunks, function(chunkId, chunk) {
            $.each(chunk.fragments, function(fragmentId, fragment) {
              if (row.maxSpanHeight < fragment.height) row.maxSpanHeight = fragment.height;
            });
          });
          if (row.sentence) {
            currentSent = row.sentence;
          }
          // SLOW (#724) and replaced with calculations:
          //
          // var rowBox = row.group.getBBox();
          // // Make it work on IE
          // rowBox = { x: rowBox.x, y: rowBox.y, height: rowBox.height, width: rowBox.width };
          // // Make it work on Firefox and Opera
          // if (rowBox.height == -Infinity) {
          //   rowBox = { x: 0, y: 0, height: 0, width: 0 };
          // }

          // XXX TODO HACK: find out where 5 and 1.5 come from!
          // This is the fix for #724, but the numbers are guessed.
          var rowBoxHeight = Math.max(row.maxArcHeight + 5, row.maxSpanHeight + 1.5); // XXX TODO HACK: why 5, 1.5?
          if (row.hasAnnotations) {
            // rowBox.height = -rowBox.y + rowSpacing;
            rowBoxHeight += rowSpacing + 1.5; // XXX TODO HACK: why 1.5?
          } else {
            rowBoxHeight -= 5; // XXX TODO HACK: why -5?
          }

          rowBoxHeight += rowPadding;
          var bgClass;
          if (data.markedSent[currentSent]) {
            // specifically highlighted
            bgClass = 'backgroundHighlight';
          } else if (Configuration.textBackgrounds == "striped") {
            // give every other sentence a different bg class
            bgClass = 'background'+ row.backgroundIndex;
          } else {
            // plain "standard" bg
            bgClass = 'background0';
          }
          svg.rect(backgroundGroup,
            0, y + sizes.texts.y + sizes.texts.height,
            canvasWidth, rowBoxHeight + sizes.texts.height + 1, {
            'class': bgClass,
          });
          y += rowBoxHeight;
          y += sizes.texts.height;
          row.textY = y - rowPadding;
          if (row.sentence) {
            var sentence_hash = new URLHash(coll, doc, { focus: [[ 'sent', row.sentence ]] } );
            var link = svg.link(sentNumGroup, sentence_hash.getHash());
            var text = svg.text(link, sentNumMargin - Configuration.visual.margin.x, y - rowPadding,
                '' + row.sentence, { 'data-sent': row.sentence });
            var sentComment = data.sentComment[row.sentence];
            if (sentComment) {
              var box = text.getBBox();
              svg.remove(text);
              // TODO: using rectShadowSize, but this shadow should
              // probably have its own setting for shadow size
              shadowRect = svg.rect(sentNumGroup,
                  box.x - rectShadowSize, box.y - rectShadowSize,
                  box.width + 2 * rectShadowSize, box.height + 2 * rectShadowSize, {

                  'class': 'shadow_' + sentComment.type,
                  filter: 'url(#Gaussian_Blur)',
                  rx: rectShadowRounding,
                  ry: rectShadowRounding,
                  'data-sent': row.sentence,
              });
              var text = svg.text(sentNumGroup, sentNumMargin - Configuration.visual.margin.x, y - rowPadding,
                  '' + row.sentence, { 'data-sent': row.sentence });
            }
          }

          var rowY = y - rowPadding;
          if (roundCoordinates) {
            rowY = rowY|0;
          }
          translate(row, 0, rowY);
          y += Configuration.visual.margin.y;
        });
        y += Configuration.visual.margin.y;

Util.profileEnd('rows');
Util.profileStart('chunkFinish');

        // chunk index sort functions for overlapping fragment drawing
        // algorithm; first for left-to-right pass, sorting primarily
        // by start offset, second for right-to-left pass by end
        // offset. Secondary sort by fragment length in both cases.
        var currentChunk;
        var lrChunkComp = function(a,b) {
          var ac = currentChunk.fragments[a];
          var bc = currentChunk.fragments[b]
          var startDiff = Util.cmp(ac.from, bc.from);
          return startDiff != 0 ? startDiff : Util.cmp(bc.to-bc.from, ac.to-ac.from);
        }
        var rlChunkComp = function(a,b) {
          var ac = currentChunk.fragments[a];
          var bc = currentChunk.fragments[b]
          var endDiff = Util.cmp(bc.to, ac.to);
          return endDiff != 0 ? endDiff : Util.cmp(bc.to-bc.from, ac.to-ac.from);
        }

        var sentenceText = null;
        $.each(data.chunks, function(chunkNo, chunk) {
          // context for sort
          currentChunk = chunk;

          // text rendering
          if (chunk.sentence) {
            if (sentenceText) {
              // svg.text(textGroup, sentenceText); // avoids jQuerySVG bug
              svg.text(textGroup, 0, 0, sentenceText);
            }
            sentenceText = null;
          }
          if (!sentenceText) {
            sentenceText = svg.createText();
          }
          var nextChunk = data.chunks[chunkNo + 1];
          var nextSpace = nextChunk ? nextChunk.space : '';
          sentenceText.span(/*chunk.space +*/ chunk.text + nextSpace, {
            x: chunk.textX,
            y: chunk.row.textY,
            'data-chunk-id': chunk.index
          });

          // chunk backgrounds
          if (chunk.fragments.length) {
            var orderedIdx = [];
            for (var i=chunk.fragments.length-1; i>=0; i--) {
              orderedIdx.push(i);
            }

            // Mark entity nesting height/depth (number of
            // nested/nesting entities). To account for crossing
            // brackets in a (mostly) reasonable way, determine
            // depth/height separately in a left-to-right traversal
            // and a right-to-left traversal.
            orderedIdx.sort(lrChunkComp);

            var openFragments = [];
            for(var i=0; i<orderedIdx.length; i++) {
              var current = chunk.fragments[orderedIdx[i]];
              current.nestingHeightLR = 0;
              current.nestingDepthLR = 0;
              var stillOpen = [];
              for(var o=0; o<openFragments.length; o++) {
                if(openFragments[o].to > current.from) {
                  stillOpen.push(openFragments[o]);
                  openFragments[o].nestingHeightLR++;
                }
              }
              openFragments = stillOpen;
              current.nestingDepthLR=openFragments.length;
              openFragments.push(current);
            }

            // re-sort for right-to-left traversal by end position
            orderedIdx.sort(rlChunkComp);

            openFragments = [];
            for(var i=0; i<orderedIdx.length; i++) {
              var current = chunk.fragments[orderedIdx[i]];
              current.nestingHeightRL = 0;
              current.nestingDepthRL = 0;
              var stillOpen = [];
              for(var o=0; o<openFragments.length; o++) {
                if(openFragments[o].from < current.to) {
                  stillOpen.push(openFragments[o]);
                  openFragments[o].nestingHeightRL++;
                }
              }
              openFragments = stillOpen;
              current.nestingDepthRL=openFragments.length;
              openFragments.push(current);
            }

            // the effective depth and height are the max of those
            // for the left-to-right and right-to-left traversals.
            for(var i=0; i<orderedIdx.length; i++) {
              var c = chunk.fragments[orderedIdx[i]];
              c.nestingHeight = c.nestingHeightLR > c.nestingHeightRL ? c.nestingHeightLR : c.nestingHeightRL;
              c.nestingDepth = c.nestingDepthLR > c.nestingDepthRL ? c.nestingDepthLR : c.nestingDepthRL;
            }

            // Re-order by nesting height and draw in order
            orderedIdx.sort(function(a,b) { return Util.cmp(chunk.fragments[b].nestingHeight, chunk.fragments[a].nestingHeight) });

            for(var i=0; i<chunk.fragments.length; i++) {
              var fragment=chunk.fragments[orderedIdx[i]];
              var spanDesc = spanTypes[fragment.span.type];
              var bgColor = ((spanDesc && spanDesc.bgColor) ||
                             (spanTypes.SPAN_DEFAULT && spanTypes.SPAN_DEFAULT.bgColor) ||
                             '#ffffff');

              // Tweak for nesting depth/height. Recognize just three
              // levels for now: normal, nested, and nesting, where
              // nested+nesting yields normal. (Currently testing
              // minor tweak: don't shrink for depth 1 as the nesting
              // highlight will grow anyway [check nestingDepth > 1])
              var shrink = 0;
              if(fragment.nestingDepth > 1 && fragment.nestingHeight == 0) {
                  shrink = 1;
              } else if(fragment.nestingDepth == 0 && fragment.nestingHeight > 0) {
                  shrink = -1;
              }
              var yShrink = shrink * nestingAdjustYStepSize;
              var xShrink = shrink * nestingAdjustXStepSize;
              // bit lighter
              var lightBgColor = Util.adjustColorLightness(bgColor, 0.8);
              // tweak for Y start offset (and corresponding height
              // reduction): text rarely hits font max height, so this
              // tends to look better
              var yStartTweak = 1;
              // store to have same mouseover highlight without recalc
              fragment.highlightPos = {
                  x: chunk.textX + fragment.curly.from + xShrink,
                  y: chunk.row.textY + sizes.texts.y + yShrink + yStartTweak,
                  w: fragment.curly.to - fragment.curly.from - 2*xShrink,
                  h: sizes.texts.height - 2*yShrink - yStartTweak,
              };
              svg.rect(highlightGroup,
                  fragment.highlightPos.x, fragment.highlightPos.y,
                  fragment.highlightPos.w, fragment.highlightPos.h,
                  { fill: lightBgColor, //opacity:1,
                    rx: highlightRounding.x,
                    ry: highlightRounding.y,
                  });
            }
          }
        });
        if (sentenceText) {
          // svg.text(textGroup, sentenceText); // avoids jQuerySVG bug
          svg.text(textGroup, 0, 0, sentenceText);
        }

        // draw the markedText
        $.each(textMarkedRows, function(textRowNo, textRowDesc) { // row, from, to
          var textHighlight = svg.rect(highlightGroup,
              textRowDesc[1] - 2, textRowDesc[0].textY - sizes.fragments.height,
              textRowDesc[2] - textRowDesc[1] + 4, sizes.fragments.height + 4,
              { fill: 'yellow' } // TODO: put into css file, as default - turn into class
          );
          // NOTE: changing highlightTextSequence here will give
          // different-colored highlights
          // TODO: entirely different settings for non-animations?
          var markedType = textRowDesc[3];
          svg.other(textHighlight, 'animate', {
            'data-type': markedType,
            attributeName: 'fill',
            values: (markedType == 'match' ? highlightMatchSequence
                     : highlightTextSequence),
            dur: highlightDuration,
            repeatCount: 'indefinite',
            begin: 'indefinite'
          });
        });


Util.profileEnd('chunkFinish');
Util.profileStart('finish');

        svg.path(sentNumGroup, svg.createPath().
          move(sentNumMargin, 0).
          line(sentNumMargin, y));

        // resize the SVG
        var width = maxTextWidth + sentNumMargin + 2 * Configuration.visual.margin.x + 1;
        if (width > canvasWidth) canvasWidth = width;

        $svg.width(canvasWidth);
        $svg.height(y);
        $svgDiv.height(y);

Util.profileEnd('finish');
Util.profileEnd('render');
Util.profileReport();


        drawing = false;
        if (redraw) {
          redraw = false;
          renderDataReal();
        }
        $svg.find('animate').each(function() {
          if (this.beginElement) { // protect against non-SMIL browsers
            this.beginElement();
          }
        });
        dispatcher.post('doneRendering', [coll, doc, args]);
      };

      var renderErrors = {
        unableToReadTextFile: true,
        annotationFileNotFound: true,
        isDirectoryError: true
      };
      var renderData = function(sourceData) {
        Util.profileEnd('invoke getDocument');
        if (sourceData && sourceData.exception) {
          if (renderErrors[sourceData.exception]) {
            dispatcher.post('renderError:' + sourceData.exception, [sourceData]);
          } else {
            dispatcher.post('unknownError', [sourceData.exception]);
          }
        } else {
          // Fill in default values that don't necessarily go over the protocol
          if (sourceData) {
            setSourceDataDefaults(sourceData);
          }

          dispatcher.post('startedRendering', [coll, doc, args]);
          dispatcher.post('spin');
          setTimeout(function() {
              try {
                renderDataReal(sourceData);
              } catch (e) {
                // We are sure not to be drawing anymore, reset the state
                drawing = false;
                // TODO: Hook printout into dispatch elsewhere?
                console.warn('Rendering terminated due to:', e);
                dispatcher.post('renderError: Fatal', [sourceData, e]);
              }
              dispatcher.post('unspin');
          }, 0);
        }
      };

      var renderDocument = function() {
        Util.profileStart('invoke getDocument');
        dispatcher.post('ajax', [{
            action: 'getDocument',
            collection: coll,
            'document': doc,
          }, 'renderData', {
            collection: coll,
            'document': doc
          }]);
      };

      var triggerRender = function() {
        if (svg && ((isRenderRequested && isCollectionLoaded) || requestedData) && Visualizer.areFontsLoaded) {
          isRenderRequested = false;
          if (requestedData) {

Util.profileClear();
Util.profileStart('before render');

            renderData(requestedData);
          } else if (doc.length) {

Util.profileClear();
Util.profileStart('before render');

            renderDocument();
          } else {
            dispatcher.post(0, 'renderError:noFileSpecified');
          }
        }
      };

      var requestRenderData = function(sourceData) {
        requestedData = sourceData;
        triggerRender();
      };

      var collectionChanged = function() {
        isCollectionLoaded = false;
      };

      var gotCurrent = function(_coll, _doc, _args, reloadData) {
        coll = _coll;
        doc  = _doc;
        args = _args;
        if (reloadData) {
          isRenderRequested = true;
          triggerRender();
        }
      };


      // event handlers

      var highlight, highlightArcs, highlightSpans, commentId;

      var onMouseOver = function(evt) {
        var target = $(evt.target);
        var id;
        if (id = target.attr('data-span-id')) {
          commentId = id;
          var span = data.spans[id];
          dispatcher.post('displaySpanComment', [
              evt, target, id, span.type, span.attributeText,
              span.text,
              span.comment && span.comment.text,
              span.comment && span.comment.type,
              span.normalizations]);

          var spanDesc = spanTypes[span.type];
          var bgColor = ((spanDesc && spanDesc.bgColor) ||
                         (spanTypes.SPAN_DEFAULT && spanTypes.SPAN_DEFAULT.bgColor) ||
                         '#ffffff');
          highlight = [];
          $.each(span.fragments, function(fragmentNo, fragment) {
            highlight.push(svg.rect(highlightGroup,
                                 fragment.highlightPos.x, fragment.highlightPos.y,
                                 fragment.highlightPos.w, fragment.highlightPos.h,
                                 { 'fill': bgColor, opacity:0.75,
                                   rx: highlightRounding.x,
                                   ry: highlightRounding.y,
                                 }));
          });

          if (that.arcDragOrigin) {
            target.parent().addClass('highlight');
          } else {
            highlightArcs = $svg.
                find('g[data-from="' + id + '"], g[data-to="' + id + '"]').
                addClass('highlight');
            var spans = {};
            spans[id] = true;
            var spanIds = [];
            $.each(span.incoming, function(arcNo, arc) {
                spans[arc.origin] = true;
            });
            $.each(span.outgoing, function(arcNo, arc) {
                spans[arc.target] = true;
            });
            $.each(spans, function(spanId, dummy) {
                spanIds.push('rect[data-span-id="' + spanId + '"]');
            });
            highlightSpans = $svg.
                find(spanIds.join(', ')).
                parent().
                addClass('highlight');
          }
          forceRedraw();
        } else if (!that.arcDragOrigin && (id = target.attr('data-arc-role'))) {
          var originSpanId = target.attr('data-arc-origin');
          var targetSpanId = target.attr('data-arc-target');
          var role = target.attr('data-arc-role');
          var symmetric = (relationTypesHash &&
                           relationTypesHash[role] &&
                           relationTypesHash[role].properties &&
                           relationTypesHash[role].properties.symmetric);
          // NOTE: no commentText, commentType for now
          var arcEventDescId = target.attr('data-arc-ed');
          var commentText = '';
          var commentType = '';
          var arcId;
          if (arcEventDescId) {
            var eventDesc = data.eventDescs[arcEventDescId];
            var comment = eventDesc.comment;
            if (comment) {
              commentText = comment.text;
              commentType = comment.type;
              if (commentText == '' && commentType) {
                  // default to type if missing text
                  commentText = commentType;
              }
            }
            if (eventDesc.relation) {
              // among arcs, only ones corresponding to relations have
              // "independent" IDs
              arcId = arcEventDescId;
            }
          }
          var originSpanType = data.spans[originSpanId].type || '';
          var targetSpanType = data.spans[targetSpanId].type || '';
          dispatcher.post('displayArcComment', [
              evt, target, symmetric, arcId,
              originSpanId, originSpanType, role,
              targetSpanId, targetSpanType,
              commentText, commentType]);
          highlightArcs = $svg.
              find('g[data-from="' + originSpanId + '"][data-to="' + targetSpanId + '"]').
              addClass('highlight');
          highlightSpans = $($svg).
              find('rect[data-span-id="' + originSpanId + '"], rect[data-span-id="' + targetSpanId + '"]').
              parent().
              addClass('highlight');
        } else if (id = target.attr('data-sent')) {
          var comment = data.sentComment[id];
          if (comment) {
            dispatcher.post('displaySentComment', [evt, target, comment.text, comment.type]);
          }
        }
      };

      var onMouseOut = function(evt) {
        var target = $(evt.target);
        target.removeClass('badTarget');
        dispatcher.post('hideComment');
        if (highlight) {
          $.each(highlight, function() {
            svg.remove(this);
          });
          highlight = undefined;
        }
        if (highlightSpans) {
          highlightArcs.removeClass('highlight');
          highlightSpans.removeClass('highlight');
          highlightSpans = undefined;
        }
        forceRedraw();
      };

      var setAbbrevs = function(_abbrevsOn) {
        // TODO: this is a slightly weird place to tweak the configuration
        Configuration.abbrevsOn = _abbrevsOn;
        dispatcher.post('configurationChanged');
      }

      var setTextBackgrounds = function(_textBackgrounds) {
        Configuration.textBackgrounds = _textBackgrounds;
        dispatcher.post('configurationChanged');
      }

      var setLayoutDensity = function(_density) {
        //dispatcher.post('messages', [[['Setting layout density ' + _density, 'comment']]]);
        // TODO: store standard settings instead of hard-coding
        // them here (again)
        if (_density < 2) {
          // dense
          Configuration.visual.margin = { x: 1, y: 0 };
          Configuration.visual.boxSpacing = 1;
          Configuration.visual.curlyHeight = 1;
          Configuration.visual.arcSpacing = 7;
          Configuration.visual.arcStartHeight = 18
        } else if(_density > 2) {
          // spacious
          Configuration.visual.margin = { x: 2, y: 1 };
          Configuration.visual.boxSpacing = 3;
          Configuration.visual.curlyHeight = 6;
          Configuration.visual.arcSpacing = 12;
          Configuration.visual.arcStartHeight = 23;
        } else {
          // standard
          Configuration.visual.margin = { x: 2, y: 1 };
          Configuration.visual.boxSpacing = 1;
          Configuration.visual.curlyHeight = 4;
          Configuration.visual.arcSpacing = 9;
          Configuration.visual.arcStartHeight = 19;
        }
        dispatcher.post('configurationChanged');
      }

      var setSvgWidth = function(_width) {
        $svgDiv.width(_width);
        if (Configuration.svgWidth != _width) {
          Configuration.svgWidth = _width;
          dispatcher.post('configurationChanged');
        }
      }

      $svgDiv = $($svgDiv).hide();

      // register event listeners
      var registerHandlers = function(element, events) {
        $.each(events, function(eventNo, eventName) {
            element.bind(eventName,
              function(evt) {
                dispatcher.post(eventName, [evt], 'all');
              }
            );
        });
      };
      registerHandlers($svgDiv, [
          'mouseover', 'mouseout', 'mousemove',
          'mouseup', 'mousedown',
          'dragstart',
          'dblclick', 'click'
      ]);
      registerHandlers($(document), [
          'keydown', 'keypress',
          'touchstart', 'touchend'
      ]);
      registerHandlers($(window), [
          'resize'
      ]);

      // create the svg wrapper
      $svgDiv.svg({
          onLoad: function(_svg) {
              that.svg = svg = _svg;
              $svg = $(svg._svg);

              /* XXX HACK REMOVED - not efficient?

              // XXX HACK to allow off-DOM SVG element creation
              // we need to replace the jQuery SVG's _makeNode function
              // with a modified one.
              // Be aware of potential breakage upon jQuery SVG upgrade.
              svg._makeNode = function(parent, name, settings) {
                  // COMMENTED OUT: parent = parent || this._svg;
                  var node = this._svg.ownerDocument.createElementNS($.svg.svgNS, name);
                  for (var name in settings) {
                    var value = settings[name];
                    if (value != null && value != null &&
                        (typeof value != 'string' || value != '')) {
                      node.setAttribute($.svg._attrNames[name] || name, value);
                    }
                  }
                  // ADDED IN:
                  if (parent)
                    parent.appendChild(node);
                  return node;
                };
              */

              triggerRender();
          }
      });

      var loadSpanTypes = function(types) {
        $.each(types, function(typeNo, type) {
          if (type) {
            spanTypes[type.type] = type;
            var children = type.children;
            if (children && children.length) {
              loadSpanTypes(children);
            }
          }
        });
      }

      var loadAttributeTypes = function(response_types) {
        var processed = {};
        $.each(response_types, function(aTypeNo, aType) {
          processed[aType.type] = aType;
          // count the values; if only one, it's a boolean attribute
          var values = [];
          for (var i in aType.values) {
            if (aType.values.hasOwnProperty(i)) {
              values.push(i);
            }
          }
          if (values.length == 1) {
            aType.bool = values[0];
          }
        });
        return processed;
      }

      var loadRelationTypes = function(relation_types) {
        $.each(relation_types, function(relTypeNo, relType) {
          if (relType) {
            relationTypesHash[relType.type] = relType;
            var children = relType.children;
            if (children && children.length) {
              loadRelationTypes(children);
            }
          }
        });
      }

      var collectionLoaded = function(response) {
        if (!response.exception) {
          setCollectionDefaults(response);
          eventAttributeTypes = loadAttributeTypes(response.event_attribute_types);
          entityAttributeTypes = loadAttributeTypes(response.entity_attribute_types);
          spanTypes = {};
          loadSpanTypes(response.entity_types);
          loadSpanTypes(response.event_types);
          loadSpanTypes(response.unconfigured_types);
          relationTypesHash = {};
          loadRelationTypes(response.relation_types);
          loadRelationTypes(response.unconfigured_types);
          // TODO XXX: isn't the following completely redundant with
          // loadRelationTypes?
          $.each(response.relation_types, function(relTypeNo, relType) {
            relationTypesHash[relType.type] = relType;
          });

          dispatcher.post('spanAndAttributeTypesLoaded', [spanTypes, entityAttributeTypes, eventAttributeTypes, relationTypesHash]);

          isCollectionLoaded = true;
          triggerRender();
        } else {
          // exception on collection load; allow visualizer_ui
          // collectionLoaded to handle this
        }
      };

      var isReloadOkay = function() {
        // do not reload while the user is in the dialog
        return !drawing;
      };

      // If we are yet to load our fonts, dispatch them
      if (!Visualizer.areFontsLoaded) {
        var webFontConfig = {
          custom: {
            families: [
              'Astloch',
              'PT Sans Caption',
              //        'Ubuntu',
              'Liberation Sans'
            ],
            /* For some cases, in particular for embedding, we need to
              allow for fonts being hosted elsewhere */
            urls: webFontURLs !== undefined ? webFontURLs : [
              'static/fonts/Astloch-Bold.ttf',
              'static/fonts/PT_Sans-Caption-Web-Regular.ttf',
              //
              'static/fonts/Liberation_Sans-Regular.ttf'
            ],
          },
          active: proceedWithFonts,
          inactive: proceedWithFonts,
          fontactive: function(fontFamily, fontDescription) {
            // Note: Enable for font debugging
            //console.log("font active: ", fontFamily, fontDescription);
          },
          fontloading: function(fontFamily, fontDescription) {
            // Note: Enable for font debugging
            //console.log("font loading:", fontFamily, fontDescription);
          },
        };
        WebFont.load(webFontConfig);
        setTimeout(function() {
          if (!Visualizer.areFontsLoaded) {
            console.error('Timeout in loading fonts');
            proceedWithFonts();
          }
        }, fontLoadTimeout);
      }

      dispatcher.
          on('collectionChanged', collectionChanged).
          on('collectionLoaded', collectionLoaded).
          on('renderData', renderData).
          on('triggerRender', triggerRender).
          on('requestRenderData', requestRenderData).
          on('isReloadOkay', isReloadOkay).
          on('resetData', resetData).
          on('abbrevs', setAbbrevs).
          on('textBackgrounds', setTextBackgrounds).
          on('layoutDensity', setLayoutDensity).
          on('svgWidth', setSvgWidth).
          on('current', gotCurrent).
          on('clearSVG', clearSVG).
          on('mouseover', onMouseOver).
          on('mouseout', onMouseOut);
    };

    Visualizer.areFontsLoaded = false;

    var proceedWithFonts = function() {
      Visualizer.areFontsLoaded = true;
      // Note: Enable for font debugging
      //console.log("fonts done");
      Dispatcher.post('triggerRender');
    };

    return Visualizer;
})(jQuery, window);

// BRAT STANDALONE LIBRARY BEGIN
// Browserify export
module.exports = Visualizer;
// BRAT STANDALONE LIBRARY END

},{}],18:[function(require,module,exports){
// -*- Mode: JavaScript; tab-width: 2; indent-tabs-mode: nil; -*-
// vim:set ft=javascript ts=2 sw=2 sts=2 cindent:
var VisualizerUI = (function($, window, undefined) {
    var VisualizerUI = function(dispatcher, svg, showTooltip, overWriteModals) {
      var that = this;

      var messagePostOutFadeDelay = 1000;
      var messageDefaultFadeDelay = 3000;
      var defaultFloatFormat = '%.1f/right';

      var documentListing = null; // always documents of current collection
      var selectorData = null;    // can be search results when available
      var searchActive = false;   // whether search results received and in use
      var loadedSearchData = null;

      var currentForm;
      var spanTypes = null;
      var relationTypesHash = null;
      // TODO: confirm unnecessary and remove
//       var attributeTypes = null;
      var data = null;
      var mtime = null;
      var searchConfig = null;
      var coll, doc, args;
      var collScroll;
      var docScroll;
      var user = null;
      var annotationAvailable = false;

      var svgElement = $(svg._svg);
      var svgId = svgElement.parent().attr('id');

      var maxMessages = 100;

      var currentDocumentSVGsaved = false;
      var fileBrowserClosedWithSubmit = false;

      // normalization: server-side DB by norm DB name
      var normServerDbByNormDbName = {};

      var matchFocus = '';
      var matches = '';

      /* START "no svg" message - related */

      var noSvgTimer = null;

      // this is necessary for centering
      $('#no_svg_wrapper').css('display', 'table');
      // on initial load, hide the "no SVG" message
      $('#no_svg_wrapper').hide();

      var hideNoDocMessage = function() {
        clearTimeout(noSvgTimer);
        $('#no_svg_wrapper').hide(0);
        $('#source_files').show();
      }

      var showNoDocMessage = function() {
        clearTimeout(noSvgTimer);
        noSvgTimer = setTimeout(function() {
          $('#no_svg_wrapper').fadeIn(500);
        }, 2000);
        $('#source_files').hide();
      }
      
      /* END "no svg" message - related */

      /* START collection browser sorting - related */

      var lastGoodCollection = '/';
      var sortOrder = [2, 1]; // column (0..), sort order (1, -1)
      var collectionSortOrder; // holds previous sort while search is active
      var docSortFunction = function(a, b) {
          // parent at the top
          if (a[2] === '..') return -1;
          if (b[2] === '..') return 1;

          // then other collections
          var aIsColl = a[0] == "c";
          var bIsColl = b[0] == "c";
          if (aIsColl !== bIsColl) return aIsColl ? -1 : 1;

          // desired column in the desired order
          var col = sortOrder[0];
          var aa = a[col];
          var bb = b[col];
          if (selectorData.header[col - 2][1] === 'string-reverse') {
            aa = aa.split('').reverse().join('');
            bb = bb.split('').reverse().join('');
          }
          if (aa != bb) return (aa < bb) ? -sortOrder[1] : sortOrder[1];

          // prevent random shuffles on columns with duplicate values
          // (alphabetical order of documents)
          aa = a[2];
          bb = b[2];
          if (aa != bb) return (aa < bb) ? -1 : 1;
          return 0;
      };

      var makeSortChangeFunction = function(sort, th, thNo) {
          $(th).click(function() {
              // TODO: avoid magic numbers in access to the selector
              // data (column 0 is type, 1 is args, rest is data)
              if (sort[0] === thNo + 1) sort[1] = -sort[1];
              else {
                var type = selectorData.header[thNo - 1][1];
                var ascending = type === "string";
                sort[0] = thNo + 1;
                sort[1] = ascending ? 1 : -1;
              }
              selectorData.items.sort(docSortFunction);
              docScroll = 0;
              showFileBrowser(); // resort
          });
      }

      /* END collection browser sorting - related */


      /* START message display - related */

      var showPullupTrigger = function() {
        $('#pulluptrigger').show('puff');
      }

      var $messageContainer = $('#messages');
      var $messagepullup = $('#messagepullup');
      var pullupTimer = null;
      var displayMessages = function(msgs) {
        var initialMessageNum = $messagepullup.children().length;

        if (msgs === false) {
          $messageContainer.children().each(function(msgElNo, msgEl) {
              $(msgEl).remove();
          });
        } else {
          $.each(msgs, function(msgNo, msg) {
            var element;
            var timer = null;
            try {
              element = $('<div class="' + msg[1] + '">' + msg[0] + '</div>');
            }
            catch(x) {
              escaped = msg[0].replace(/&/g, "&amp;").replace(/</g, "&lt;").replace(/>/g, "&gt;");
              element = $('<div class="error"><b>[ERROR: could not display the following message normally due to malformed XML:]</b><br/>' + escaped + '</div>');
            }
            var pullupElement = element.clone();
            $messageContainer.append(element);
            $messagepullup.append(pullupElement.css('display', 'none'));
            slideToggle(pullupElement, true, true);

            var fader = function() {
              if ($messagepullup.is(':visible')) {
                element.remove();
              } else {
                element.hide('slow', function() {
                  element.remove();
                });
              }
            };
            var delay = (msg[2] === undefined)
                          ? messageDefaultFadeDelay
                          : (msg[2] === -1)
                              ? null
                              : (msg[2] * 1000);
            if (delay === null) {
              var button = $('<input type="button" value="OK"/>');
              element.prepend(button);
              button.click(function(evt) {
                timer = setTimeout(fader, 0);
              });
            } else {
              timer = setTimeout(fader, delay);
              element.mouseover(function() {
                  clearTimeout(timer);
                  element.show();
              }).mouseout(function() {
                  timer = setTimeout(fader, messagePostOutFadeDelay);
              });
            }
            // setTimeout(fader, messageDefaultFadeDelay);
          });

          // limited history - delete oldest
          var $messages = $messagepullup.children();
          for (var i = 0; i < $messages.length - maxMessages; i++) {
            $($messages[i]).remove();
          }
        }

        // if there is change in the number of messages, may need to
        // tweak trigger visibility
        var messageNum = $messagepullup.children().length;
        if (messageNum != initialMessageNum) {
          if (messageNum == 0) {
            // all gone; nothing to trigger
            $('#pulluptrigger').hide('slow');
          } else if (initialMessageNum == 0) {
            // first messages, show trigger at fade
            setTimeout(showPullupTrigger, messageDefaultFadeDelay+250);
          }
        }
      };

      // hide pullup trigger by default, show on first message
      $('#pulluptrigger').hide();
      $('#pulluptrigger').
        mouseenter(function(evt) {
          $('#pulluptrigger').hide('puff');
          clearTimeout(pullupTimer);
          slideToggle($messagepullup.stop(), true, true, true);
        });
      $('#messagepullup').
        mouseleave(function(evt) {
          setTimeout(showPullupTrigger, 500);
          clearTimeout(pullupTimer);
          pullupTimer = setTimeout(function() {
            slideToggle($messagepullup.stop(), false, true, true);
          }, 500);
        });


      /* END message display - related */


      /* START comment popup - related */

      var adjustToCursor = function(evt, element, offset, top, right) {
        // get the real width, without wrapping
        element.css({ left: 0, top: 0 });
        var screenHeight = $(window).height();
        var screenWidth = $(window).width();
        // FIXME why the hell is this 22 necessary?!?
        var elementHeight = element.height() + 22;
        var elementWidth = element.width() + 22;
        var x, y;
        offset = offset || 0;
        if (top) {
          y = evt.clientY - elementHeight - offset;
          if (y < 0) top = false;
        }
        if (!top) {
          y = evt.clientY + offset;
        }
        if (right) {
          x = evt.clientX + offset;
          if (x >= screenWidth - elementWidth) right = false;
        }
        if (!right) {
          x = evt.clientX - elementWidth - offset;
        }
        if (y < 0) y = 0;
        if (x < 0) x = 0;
        element.css({ top: y, left: x });
      };

      var commentPopup = $('#commentpopup');
      var commentDisplayed = false;

      var displayCommentTimer = null;
      var displayComment = function(evt, target, comment, commentText, commentType, immediately) {
        var idtype;
        if (commentType) {
          // label comment by type, with special case for default note type
          var commentLabel;
          if (commentType == 'AnnotatorNotes') {
            commentLabel = '<b>Note:</b> ';
          } else {
            commentLabel = '<b>'+Util.escapeHTML(commentType)+':</b> ';
          }
          comment += commentLabel + Util.escapeHTMLwithNewlines(commentText);
          idtype = 'comment_' + commentType;
        }
        commentPopup[0].className = idtype;
        commentPopup.html(comment);
        if(showTooltip) {
          adjustToCursor(evt, commentPopup, 10, true, true);
          clearTimeout(displayCommentTimer);
          /* slight "tooltip" delay to allow highlights to be seen
           before the popup obstructs them. */
          displayCommentTimer = setTimeout(function() {
            commentPopup.stop(true, true).fadeIn();
            commentDisplayed = true;
          }, immediately ? 0 : 500);
        }
      };

      // to avoid clobbering on delayed response
      var commentPopupNormInfoSeqId = 0;

      var normInfoSortFunction = function(a, b) {
        // images at the top
        if (a[0].toLowerCase() == '<img>') return -1;
        if (b[0].toLowerCase() == '<img>') return 1;
        // otherwise stable
        return Util.cmp(a[2],b[2]);
      }

      var displaySpanComment = function(
          evt, target, spanId, spanType, mods, spanText, commentText, 
          commentType, normalizations) {

        var immediately = false;
        var comment = ( '<div><span class="comment_type_id_wrapper">' +
                        '<span class="comment_type">' +
                        Util.escapeHTML(Util.spanDisplayForm(spanTypes,
                                                             spanType)) +
                        '</span>' +
                        ' ' +
                        '<span class="comment_id">' +
                        'ID:'+Util.escapeHTML(spanId) +
                        '</span></span>' );
        if (mods.length) {
          comment += '<div>' + Util.escapeHTML(mods.join(', ')) + '</div>';
        }

        comment += '</div>';
        comment += ('<div class="comment_text">"' + 
                    Util.escapeHTML(spanText) + 
                    '"</div>');
        var validArcTypesForDrag = dispatcher.post('getValidArcTypesForDrag', [spanId, spanType]);
        if (validArcTypesForDrag && validArcTypesForDrag[0]) {
          if (validArcTypesForDrag[0].length) {
            comment += '<div>' + validArcTypesForDrag[0].join(', ') + '</div>';
          } else {
            $('rect[data-span-id="' + spanId + '"]').addClass('badTarget');
          }
          immediately = true;
        }
        // process normalizations
        var normsToQuery = [];
        $.each(normalizations, function(normNo, norm) {
          var dbName = norm[0], dbKey = norm[1];
          comment += ( '<hr/>' +
                       '<span class="comment_id">' +
                       Util.escapeHTML(dbName) + ':' +
                       Util.escapeHTML(dbKey) + '</span>');
          if (dbName in normServerDbByNormDbName &&
              normServerDbByNormDbName[dbName] != '<NONE>') {
            // DB available, add drop-off point to HTML and store
            // query parameters
            commentPopupNormInfoSeqId++;
            comment += ('<br/><div id="norm_info_drop_point_'+
                        commentPopupNormInfoSeqId+'"/>');
            normsToQuery.push([dbName, dbKey, commentPopupNormInfoSeqId]);
          } else {
            // no DB, just attach "human-readable" text provided
            // with the annotation, if any
            if (norm[2]) {
                comment += ('<br/><span class="norm_info_value">'+
                            Util.escapeHTML(norm[2])+'</span>');
            }
          }
        });

        // display initial comment HTML
        if (showTooltip) {
          displayComment(evt, target, comment, commentText, commentType,
              immediately);
        }

        // initiate AJAX calls for the normalization data to query
        $.each(normsToQuery, function(normqNo, normq) {
          // TODO: cache some number of most recent norm_get_data results
          var dbName = normq[0], dbKey = normq[1], infoSeqId = normq[2];
          dispatcher.post('ajax', [{
            action: 'normData',
            database: dbName,
            key: dbKey,
            collection: coll,
          },
          function(response) {
            if (response.exception) {
              ; // TODO: response to error
            } else if (!response.value) {
              ; // TODO: response to missing key
            } else {
              // extend comment popup with normalization data
              norminfo = '';
              // flatten outer (name, attr, info) array (idx for sort)
              infos = [];
              var idx = 0;
              for (var i = 0; i < response.value.length; i++) {
                for (var j = 0; j < response.value[i].length; j++) {
                  var label = response.value[i][j][0];
                  var value = response.value[i][j][1];
                  infos.push([label, value, idx++]);
                }
              }
              // sort, prioritizing images (to get floats right)
              infos = infos.sort(normInfoSortFunction);
              // generate HTML
              for (var i = 0; i < infos.length; i++) {
                var label = infos[i][0];
                var value = infos[i][1];
                if (label && value) {
                  // special treatment for some label values
                  if (label.toLowerCase() == '<img>') {
                    // image
                    norminfo += ('<img class="norm_info_img" src="'+
                                 value+
                                 '"/>');
                  } else {
                    // normal, as text

                    // max length restriction
                    if (value.length > 300) {
                      value = value.substr(0, 300) + ' ...';
                    }                          

                    norminfo += ('<span class="norm_info_label">'+
                                 Util.escapeHTML(label)+
                                 '</span>'+
                                 '<span class="norm_info_value">'+':'+
                                 Util.escapeHTML(value)+
                                 '</span>'+
                                 '<br/>');
                  }
                }
              }
              var drop=$('#norm_info_drop_point_'+infoSeqId);
              if (drop) {
                drop.html(norminfo);
              } else {
                console.log('norm info drop point not found!'); //TODO XXX
              }
            }
          }]);
        });
      };

      var onDocChanged = function() {
        commentPopup.hide();
        commentDisplayed = false;
      };

      var displayArcComment = function(
          evt, target, symmetric, arcId,
          originSpanId, originSpanType, role, 
          targetSpanId, targetSpanType,
          commentText, commentType) {
        var arcRole = target.attr('data-arc-role');
        // in arrowStr, &#8212 == mdash, &#8594 == Unicode right arrow
        var arrowStr = symmetric ? '&#8212;' : '&#8594;';
        var arcDisplayForm = Util.arcDisplayForm(spanTypes, 
                                                 data.spans[originSpanId].type, 
                                                 arcRole,
                                                 relationTypesHash);
        var comment = "";
        comment += ('<span class="comment_type_id_wrapper">' +
                    '<span class="comment_type">' +
                    Util.escapeHTML(Util.spanDisplayForm(spanTypes,
                                                         originSpanType)) +
                    ' ' + arrowStr + ' ' +
                    Util.escapeHTML(arcDisplayForm) +
                    ' ' + arrowStr + ' ' +
                    Util.escapeHTML(Util.spanDisplayForm(spanTypes,
                                                         targetSpanType)) +
                    '</span>' +
                    '<span class="comment_id">' +
                    (arcId ? 'ID:'+arcId : 
                     Util.escapeHTML(originSpanId) +
                     arrowStr + 
                     Util.escapeHTML(targetSpanId)) +
                    '</span>' +
                    '</span>');
        comment += ('<div class="comment_text">' + 
                    Util.escapeHTML('"'+data.spans[originSpanId].text+'"') +
                    arrowStr +
                    Util.escapeHTML('"'+data.spans[targetSpanId].text + '"') +
                    '</div>');
        displayComment(evt, target, comment, commentText, commentType);
      };

      var displaySentComment = function(
          evt, target, commentText, commentType) {
        displayComment(evt, target, '', commentText, commentType);
      };

      var hideComment = function() {
        clearTimeout(displayCommentTimer);
        if (commentDisplayed) {
          commentPopup.stop(true, true).fadeOut(function() { commentDisplayed = false; });
        }
      };

      var onMouseMove = function(evt) {
        if (commentDisplayed && showTooltip) {
          adjustToCursor(evt, commentPopup, 10, true, true);
        }
      };

      /* END comment popup - related */


      /* START form management - related */
      initForm = function(form, opts) {
        opts = opts || {};
        var formId = form.attr('id');

        // alsoResize is special
        var alsoResize = opts.alsoResize;
        delete opts.alsoResize;

        // Always add OK and Cancel
        var buttons = (opts.buttons || []);
        if (opts.no_ok) {
          delete opts.no_ok;
        } else {
          buttons.push({
              id: formId + "-ok",
              text: "OK",
              click: function() { form.submit(); }
            });
        }
        if (opts.no_cancel) {
          delete opts.no_cancel;
        } else {
          buttons.push({
              id: formId + "-cancel",
              text: "Cancel",
              click: function() { form.dialog('close'); }
            });
        }
        delete opts.buttons;

        opts = $.extend({
            autoOpen: false,
            closeOnEscape: true,
            buttons: buttons,
            modal: true
          }, opts);

        form.dialog(opts);
        form.bind('dialogclose', function() {
          if (form == currentForm) {
            currentForm = null;
          }
        });

        // HACK: jQuery UI's dialog does not support alsoResize
        // nor does resizable support a jQuery object of several
        // elements
        // See: http://bugs.jqueryui.com/ticket/4666
        if (alsoResize) {
          form.parent().resizable('option', 'alsoResize',
              '#' + form.attr('id') + ', ' + alsoResize);
        }
      };

      var showForm = function(form) {
        currentForm = form;
        if(!overWriteModals){
          // as suggested in http://stackoverflow.com/questions/2657076/jquery-ui-dialog-fixed-positioning
          form.parent().css({position:"fixed"});
          form.dialog('open');
          slideToggle($('#pulldown').stop(), false);
        }
        return form;
      };

      var hideForm = function() {
        if (!currentForm) return;
        // currentForm.fadeOut(function() { currentForm = null; });
        currentForm.dialog('close');
        currentForm = null;
      };

      /* END form management - related */


      /* START collection browser - related */

      var selectElementInTable = function(table, docname, mf) {
        table = $(table);
        table.find('tr').removeClass('selected');
        var sel = 'tr';
        var $element;
        if (docname) {
          sel += '[data-doc="' + docname + '"]';
          if (mf) {
            sel += '[data-mf="' + Util.paramArray(mf) + '"]';
          }
          var $element = table.find(sel).first();
          $element.addClass('selected');
        }
        matchFocus = $element && $element.attr('data-mf');
        matches = $element && $element.attr('data-match');
      }

      var chooseDocument = function(evt) {
        var $element = $(evt.target).closest('tr');
        $('#document_select tr').removeClass('selected');
        $('#document_input').val($element.attr('data-doc'));

        $element.addClass('selected');
        matchFocus = $element.attr('data-mf');
        matches = $element.attr('data-match');
      }

      var chooseDocumentAndSubmit = function(evt) {
        chooseDocument(evt);
        fileBrowserSubmit(evt);
      }

      var fileBrowser = $('#collection_browser');
      initForm(fileBrowser, {
          alsoResize: '#document_select',
          close: function(evt) {
            if (!doc) {
              // no document; set and show the relevant message, and
              // clear the "blind" unless waiting for a collection
              if (fileBrowserClosedWithSubmit) {
                $('#no_document_message').hide();
                $('#loading_message').show();
              } else {
                $('#loading_message').hide();
                $('#no_document_message').show();
                $('#waiter').dialog('close');
              }
              showNoDocMessage();
            } else if (!fileBrowserClosedWithSubmit && !searchActive) {
              dispatcher.post('setArguments', [{}, true]);
            }
          },
          width: 500
      });

      /* XXX removed per #900
      // insert the Save link
      var $fileBrowserButtonset = fileBrowser.
          parent().find('.ui-dialog-buttonpane .ui-dialog-buttonset').prepend(' ');
      $('<a href="ajax.cgi?action=downloadSearchFile" id="save_search">Save</a>').
          prependTo($fileBrowserButtonset).button().css('display', 'none');
      */

      var docInputHandler = function(evt) {
        selectElementInTable('#document_select', $(this).val());
      };
      $('#document_input').keyup(docInputHandler);

      var fileBrowserSubmit = function(evt) {
        var _coll, _doc, _args, found;
        var input = $('#document_input').
            val().
            replace(/\/?\s+$/, '').
            replace(/^\s+/, '');
        if (!input.length) return false;
        if (input.substr(0, 2) === '..') {
          // ..
          var pos = coll.substr(0, coll.length - 1).lastIndexOf('/');
          if (pos === -1) {
            dispatcher.post('messages', [[['At the root', 'error', 2]]]);
            $('#document_input').focus().select();
            return false;
          } else {
            _coll = coll.substr(0, pos + 1);
            _doc = '';
          }
        } else if (found = input.match(/^(\/?)((?:[^\/]*\/)*)([^\/?]*)$/)) {
          var abs = found[1];
          var collname = found[2].substr(0, found[2].length - 1);
          var docname = found[3];
          if (abs) {
            _coll = abs + collname;
            if (_coll.length < 2) coll += '/';
            _doc = docname;
          } else {
            if (collname) collname += '/';
            _coll = coll + collname;
            _doc = docname;
          }
        } else {
          dispatcher.post('messages', [[['Invalid document name format', 'error', 2]]]);
          $('#document_input').focus().select();
        }
        docScroll = $('#document_select')[0].scrollTop;
        fileBrowser.find('#document_select tbody').empty();

        if (coll != _coll || doc != _doc ||
            Util.paramArray(args.matchfocus) != matchFocus) {
          // something changed

          // set to allow keeping "blind" down during reload
          fileBrowserClosedWithSubmit = true;
          // ... and change BG message to a more appropriate one

          // trigger clear and changes if something other than the
          // current thing is chosen, but only blank screen before
          // render if the document changed (prevent "flicker" on
          // e.g. picking search results)
          if (coll != _coll || doc != _doc) {
            dispatcher.post('clearSVG');
          }
          dispatcher.post('allowReloadByURL');
          var newArgs = [];
          if (matchFocus) newArgs.push('matchfocus=' + matchFocus);
          if (matches) newArgs.push('match=' + matches);
          dispatcher.post('setCollection', [_coll, _doc, Util.deparam(newArgs.join('&'))]);
        } else {
          // hide even on select current thing
          hideForm();
        }
        return false;
      };
      fileBrowser.
          submit(fileBrowserSubmit).
          bind('reset', hideForm);

      var fileBrowserWaiting = false;
      var showFileBrowser = function() {
        // keep tabs on how the browser is closed; we need to keep the
        // "blind" up when retrieving a collection, but not when canceling
        // without selection (would hang the UI)

// BRAT STANDALONE LIBRARY BEGIN
/*
        fileBrowserClosedWithSubmit = false;

        // no point in showing this while the browser is shown
        hideNoDocMessage();

        if (currentForm == tutorialForm) {
          fileBrowserWaiting = true;
          return;
        }
        fileBrowserWaiting = false;

        // hide "no document" message when file browser shown
        // TODO: can't make this work; I can't detect when it gets hidden.
        // hideNoDocMessage();

        if (!(selectorData && showForm(fileBrowser))) return false;

        var html = ['<tr><th/>'];
        var tbody;
        $.each(selectorData.header, function(headNo, head) {
          html.push('<th>' + head[0] + '</th>');
        });
        html.push('</tr>');
        $('#document_select thead').html(html.join(''));

        html = [];
        // NOTE: we seem to have some excessive sorting going on;
        // disabling this as a test. If everything works, just remove
        // the following commented-out line (and this comment):
        //selectorData.items.sort(docSortFunction);
        $.each(selectorData.items, function(docNo, doc) {
          var isColl = doc[0] == "c"; // "collection"
          // second column is optional annotation-specific pointer,
          // used (at least) for search results
          var annp = doc[1] ? ('?' + Util.escapeHTML(Util.param(doc[1]))) : '';
          var name = Util.escapeHTML(doc[2]);
          var collFile = isColl ? 'collection' : 'file';
          //var collFileImg = isColl ? 'ic_list_folder.png' : 'ic_list_drafts.png';
          //var collFileImg = isColl ? 'Fugue-folder-horizontal-open.png' : 'Fugue-document.png';
          var collFileImg = isColl ? 'Fugue-shadowless-folder-horizontal-open.png' : 'Fugue-shadowless-document.png';
          var collSuffix = isColl ? '/' : '';
          if (doc[1]) {
            var matchfocus = doc[1].matchfocus || [];
            var mfstr = ' data-mf="' + Util.paramArray(matchfocus) + '"';
            var match = doc[1].match || [];
            var matchstr = ' data-match="' + Util.paramArray(match) + '"';
          } else {
            var matchstr = '';
            var mfstr = '';
          }
          html.push('<tr class="' + collFile + '" data-doc="'
            + name + collSuffix + '"' + matchstr + mfstr + '>');
          html.push('<th><img src="static/img/' + collFileImg + '" alt="' + collFile + '"/></th>');
          html.push('<th>' + name + collSuffix + '</th>');
          var len = selectorData.header.length - 1;
          for (var i = 0; i < len; i++) {
            var type = selectorData.header[i + 1][1];
            var datum = doc[i + 3];
            // format rest according to "data type" specified in header
            var formatted = null;
            var cssClass = null;
            if (!type) {
              console.error('Missing document list data type');
              formatted = datum;
            } else if (datum === undefined) {
              formatted = '';
            } else if (type === 'string') {
              formatted = Util.escapeHTML(datum);
            } else if (type === 'string-right' || type === 'string-reverse') {
              formatted = Util.escapeHTML(datum);
              cssClass = 'rightalign';
            } else if (type === 'string-center') {
              formatted = Util.escapeHTML(datum);
              cssClass = 'centeralign';
            } else if (type === 'time') {
              formatted = Util.formatTimeAgo(datum * 1000);
            } else if (type === 'float') {
              type = defaultFloatFormat;
              cssClass = 'rightalign';
            } else if (type === 'int') {
              formatted = '' + datum;
              cssClass = 'rightalign';
            }
            if (formatted === null) {
              var m = type.match(/^(.*?)(?:\/(right))?$/);
              cssClass = m[2] ? 'rightalign' : null;
              formatted = $.sprintf(m[1], datum);
            }
            html.push('<td' + (cssClass ? ' class="' + cssClass + '"' : '') + '>' +
                formatted + '</td>');
          }
          html.push('</tr>');
        });
        html = html.join('');
        tbody = $('#document_select tbody').html(html);
        $('#document_select')[0].scrollTop = docScroll;
        tbody.find('tr').
            click(chooseDocument).
            dblclick(chooseDocumentAndSubmit);

        $('#document_select thead tr *').each(function(thNo, th) {
            makeSortChangeFunction(sortOrder, th, thNo);
        });

        $('#collection_input').val(selectorData.collection);
        $('#document_input').val(doc);

        $('#readme').val(selectorData.description || '');
        if (selectorData.description && 
            (selectorData.description.match(/\n/) ||
             selectorData.description.length > 50)) {
          // multi-line or long description; show "more" button and fill
          // dialog text
          $('#more_readme_button').button(); // TODO: more reasonable place
          $('#more_readme_button').show();
          // only display text up to the first newline in the short info*/
          //var split_readme_text = selectorData.description.match(/^[^\n]*/);
          /*$('#readme').val(split_readme_text[0]);
          $('#more_info_readme').text(selectorData.description);
        } else {
          // empty or short, single-line description; no need for more
          $('#more_readme_button').hide();
          $('#more_info_readme').text('');
        }

        selectElementInTable($('#document_select'), doc, args.matchfocus);
        setTimeout(function() {
          $('#document_input').focus().select();
        }, 0);

*/
// BRAT STANDALONE LIBRARY END
      }; // end showFileBrowser()


      $('#collection_browser_button').click(function(evt) {
        dispatcher.post('clearSearch');
      });

      var currentSelectorPosition = function() {
        var pos;
        $.each(selectorData.items, function(docNo, docRow) {
          if (docRow[2] == doc) {
            // args may have changed, so lacking a perfect match return
            // last matching document as best guess
            pos = docNo;
            // check whether 'focus' agrees; the rest of the args are
            // irrelevant for determining position.
            var collectionArgs = docRow[1] || {};
            if (Util.isEqual(collectionArgs.matchfocus, args.matchfocus)) {
              pos = docNo;
              return false;
            }
          }
        });
        return pos;
      }

      /* END collection browser - related */


      /* START search - related */

      var addSpanTypesToSelect = function($select, types, included) {
        if (!included) included = {};
        if (!included['']) {
          included[''] = true;
          $select.html('<option value="">- Any -</option>');
        }
        $.each(types, function(typeNo, type) {
          if (type !== null) {
            if (!included[type.name]) {
              included[type.name] = true;
              var $option = $('<option value="' + Util.escapeQuotes(type.type) + '"/>').text(type.name);
              $select.append($option);
              if (type.children) {
                addSpanTypesToSelect($select, type.children, included);
              }
            }
          }
        });
      };

      var rememberNormDb = function(response) {
        // the visualizer needs to remember aspects of the norm setup
        // so that it can avoid making queries for unconfigured or
        // missing normalization DBs.
        var norm_resources = response.normalization_config || [];
        $.each(norm_resources, function(normNo, norm) {
          var normName = norm[0];
          var serverDb = norm[3];
          normServerDbByNormDbName[normName] = serverDb;
        });
      }

      var setupSearchTypes = function(response) {
        addSpanTypesToSelect($('#search_form_entity_type'), response.entity_types);
        addSpanTypesToSelect($('#search_form_event_type'), response.event_types);
        addSpanTypesToSelect($('#search_form_relation_type'), response.relation_types);
        // nice-looking selects and upload fields
        $('#search_form select').addClass('ui-widget ui-state-default ui-button-text');
        $('#search_form_load_file').addClass('ui-widget ui-state-default ui-button-text');
      }

      // when event role changes, event types do as well
      var searchEventRoles = [];
      var searchEventRoleChanged = function(evt) {
        var $type = $(this).parent().next().children('select');
        var type = $type.val();
        var role = $(this).val();
        var origin = $('#search_form_event_type').val();
        var eventType = spanTypes[origin];
        var arcTypes = eventType && eventType.arcs || [];
        var arcType = null;
        $type.html('<option value="">- Any -</option>');
        $.each(arcTypes, function(arcNo, arcDesc) {
          if (arcDesc.type == role) {
            arcType = arcDesc;
            return false;
          }
        });
        var targets = arcType && arcType.targets || [];
        $.each(targets, function(targetNo, target) {
          var spanType = spanTypes[target];
          var spanName = spanType.name || spanType.labels[0] || target;
          var option = '<option value="' + Util.escapeQuotes(target) + '">' + Util.escapeHTML(spanName) + '</option>'
          $type.append(option);
        });
        // return the type to the same value, if possible
        if (type) {
          $type.val(type);
        };
      };

      $('#search_form_event_roles .search_event_role select').live('change', searchEventRoleChanged);

      // adding new role rows
      var addEmptySearchEventRole = function() {
        var $roles = $('#search_form_event_roles');
        var rowNo = $roles.children().length;
        var $role = $('<select class="fullwidth"/>');
        $role.append('<option value="">- Any -</option>');
        $.each(searchEventRoles, function(arcTypePairNo, arcTypePair) {
          var option = '<option value="' + Util.escapeQuotes(arcTypePair[0]) + '">' + Util.escapeHTML(arcTypePair[1]) + '</option>'
          $role.append(option);
        });
        var $type = $('<select class="fullwidth"/>');
        var $text = $('<input class="fullwidth"/>');
        var button = $('<input type="button"/>');
        var rowButton = $('<td/>').append(button);
        if (rowNo) {
          rowButton.addClass('search_event_role_del');
          button.val('\u2013'); // n-dash
        } else {
          rowButton.addClass('search_event_role_add');
          button.val('+');
        }
        var $tr = $('<tr/>').
          append($('<td class="search_event_role"/>').append($role)).
          append($('<td class="search_event_type"/>').append($type)).
          append($('<td class="search_event_text"/>').append($text)).
          append(rowButton);
        $roles.append($tr);
        $role.trigger('change');
        // style selector
        $role.addClass('ui-widget ui-state-default ui-button-text');
        $type.addClass('ui-widget ui-state-default ui-button-text');
        // style button
        button.button();
        button.addClass('small-buttons ui-button-text').removeClass('ui-button');
      };

      // deleting role rows
      var delSearchEventRole = function(evt) {
        $row = $(this).closest('tr');
        $row.remove();
      }

      $('#search_form_event_roles .search_event_role_add input').live('click', addEmptySearchEventRole);
      $('#search_form_event_roles .search_event_role_del input').live('click', delSearchEventRole);

      // When event type changes, the event roles do as well
      // Also, put in one empty role row
      $('#search_form_event_type').change(function(evt) {
        var $roles = $('#search_form_event_roles').empty();
        searchEventRoles = [];
        var eventType = spanTypes[$(this).val()];
        var arcTypes = eventType && eventType.arcs || [];
        $.each(arcTypes, function(arcTypeNo, arcType) {
          var arcTypeName = arcType.labels && arcType.labels[0] || arcType.type;
          searchEventRoles.push([arcType.type, arcTypeName]);
        });
        addEmptySearchEventRole();
      });

      // when relation changes, change choices of arg1 type
      $('#search_form_relation_type').change(function(evt) {
        var relTypeType = $(this).val();
        var $arg1 = $('#search_form_relation_arg1_type').
            html('<option value="">- Any -</option>');
        var $arg2 = $('#search_form_relation_arg2_type').empty();
        $.each(spanTypes,
          function(spanTypeType, spanType) {
          if (spanType.arcs) {
            $.each(spanType.arcs, function(arcTypeNo, arcType) {
              if (arcType.type === relTypeType) {
                var spanName = spanType.name;
                var option = '<option value="' + Util.escapeQuotes(spanTypeType) + '">' + Util.escapeHTML(spanName) + '</option>'
                $arg1.append(option);
              }
            });
          }
        });
        $('#search_form_relation_arg1_type').change();
        // style the selects
        $arg1.addClass('ui-widget ui-state-default ui-button-text');
        $arg2.addClass('ui-widget ui-state-default ui-button-text');
      });

      // when arg1 type changes, change choices of arg2 type
      $('#search_form_relation_arg1_type').change(function(evt) {
        var $arg2 = $('#search_form_relation_arg2_type').
            html('<option value="">- Any -</option>');
        var relType = $('#search_form_relation_type').val();
        var arg1Type = spanTypes[$(this).val()];
        var arcTypes = arg1Type && arg1Type.arcs || [];
        var arcType = null;
        $.each(arcTypes, function(arcNo, arcDesc) {
          if (arcDesc.type == relType) {
            arcType = arcDesc;
            return false;
          }
        });
        if (arcType && arcType.targets) {
          $.each(arcType.targets, function(spanTypeNo, spanTypeType) {
            var spanName = Util.spanDisplayForm(spanTypes, spanTypeType);
            var option = '<option value="' + Util.escapeQuotes(spanTypeType) + '">' + Util.escapeHTML(spanName) + '</option>'
            $arg2.append(option);
          });
        }
      });

      $('#search_form_note_category').change(function(evt) {
        var category = $(this).val();
        var $type = $('#search_form_note_type');
        if ($.inArray(category, ['entity', 'event', 'relation']) != -1) {
          $type.html($('#search_form_' + category + '_type').html()).val('');
          $('#search_form_note_type_row:not(:visible)').show('highlight');
        } else {
          $type.html('');
          $('#search_form_note_type_row:visible').hide('highlight');
        }
      });


      // context length setting should only be visible if
      // concordancing is on
      // TODO: @amadanmath: help, my jQuery is horrible
      if ($('#concordancing_on').is(':checked')) {
        $('#context_size_div').show("highlight");
      } else {
        $('#context_size_div').hide("highlight");
      }
      $('#concordancing input[type="radio"]').change(function() {
        if ($('#concordancing_on').is(':checked')) {
          $('#context_size_div').show("highlight");
        } else {
          $('#context_size_div').hide("highlight");
        }
      });
      $('#search_options div.advancedOptions').hide("highlight");
      // set up advanced search options; only visible is clicked
      var advancedSearchOptionsVisible = false;
      $('#advanced_search_option_toggle').click(function(evt) {
        if (advancedSearchOptionsVisible) {
          $('#search_options div.advancedOptions').hide("highlight");
          $('#advanced_search_option_toggle').text("Show advanced");
        } else {
          $('#search_options div.advancedOptions').show("highlight");
          $('#advanced_search_option_toggle').text("Hide advanced");
        }
        advancedSearchOptionsVisible = !advancedSearchOptionsVisible;
        // block default
        return false;
      });

      var activeSearchTab = function() {
        // activeTab: 0 = Text, 1 = Entity, 2 = Event, 3 = Relation, 4 = Notes, 5 = Load
        var activeTab = $('#search_tabs').tabs('option', 'selected');
        return ['searchText', 'searchEntity', 'searchEvent',
            'searchRelation', 'searchNote', 'searchLoad'][activeTab];
      }

      var onSearchTabSelect = function() {
        var action = activeSearchTab();
        switch (action) {
          case 'searchText':
            $('#search_form_text_text').focus().select();
            break;
          case 'searchEntity':
            $('#search_form_entity_text').focus().select();
            break;
          case 'searchEvent':
            $('#search_form_event_trigger').focus().select();
            break;
          case 'searchRelation':
            $('#search_form_relation_type').focus().select();
            break;
          case 'searchNote':
            $('#search_form_note_text').focus().select();
            break;
          case 'searchLoad':
            $('#search_form_load_file').focus().select();
            break;
        }
      };

      // set up jQuery UI elements in search form
      $('#search_tabs').tabs({
        show: onSearchTabSelect
      });
      $('#search_form').find('.radio_group').buttonset();

      var applySearchResults = function(response) {
        if (!searchActive) {
          collectionSortOrder = sortOrder;
        }
        dispatcher.post('searchResultsReceived', [response]);
        searchActive = true;
        updateSearchButtons();
      };

      var searchForm = $('#search_form');

      var searchFormSubmit = function(evt) {
        // hack around empty document; "" would be interpreted as
        // missing argument by server dispatcher (issue #513)
        // TODO: do this properly, avoiding magic strings
        var action = activeSearchTab();
        var docArg = doc ? doc : "/NO-DOCUMENT/";
        var opts = {
          action : action,
          collection : coll,
          document: docArg,
          // TODO the search form got complex :)
        };

        switch (action) {
          case 'searchText':
            opts.text = $('#search_form_text_text').val();
            if (!opts.text.length) {
              dispatcher.post('messages', [[['Please fill in the text to search for!', 'comment']]]);
              return false;
            }
            break;
          case 'searchEntity':
            opts.type = $('#search_form_entity_type').val() || '';
            opts.text = $('#search_form_entity_text').val();
            break;
          case 'searchEvent':
            opts.type = $('#search_form_event_type').val() || '';
            opts.trigger = $('#search_form_event_trigger').val();
            var eargs = [];
            $('#search_form_event_roles tr').each(function() {
              var earg = {};
              earg.role = $(this).find('.search_event_role select').val() || '';
              earg.type = $(this).find('.search_event_type select').val() || '';
              earg.text = $(this).find('.search_event_text input').val();
              eargs.push(earg);
            });
            opts.args = $.toJSON(eargs);
            break;
          case 'searchRelation':
            opts.type = $('#search_form_relation_type').val() || '';
            opts.arg1 = $('#search_form_relation_arg1_text').val();
            opts.arg1type = $('#search_form_relation_arg1_type').val() || '';
            opts.arg2 = $('#search_form_relation_arg2_text').val();
            opts.arg2type = $('#search_form_relation_arg2_type').val() || '';
            break;
          case 'searchNote':
            opts.category = $('#search_form_note_category').val() || '';
            opts.type = $('#search_form_note_type').val() || '';
            opts.text = $('#search_form_note_text').val() || '';
            break;
          case 'searchLoad':
            applySearchResults(loadedSearchData);
            return false;
        }

        // fill in scope of search ("document" / "collection")
        var searchScope = $('#search_scope input:checked').val();
        opts.scope = searchScope;

        // adjust specific action to invoke by scope
        if (searchScope == "document") {
          opts.action = opts.action + "InDocument";
        } else {
          opts.action = opts.action + "InCollection";
        }

        // fill in concordancing options
        opts.concordancing = $('#concordancing_on').is(':checked');
        opts.context_length = $('#context_length').val();

        // fill in text match options
        opts.text_match = $('#text_match input:checked').val()
        opts.match_case = $('#match_case_on').is(':checked');

        dispatcher.post('hideForm');
        dispatcher.post('ajax', [opts, function(response) {
          if(response && response.items && response.items.length == 0) {
            // TODO: might consider having this message come from the
            // server instead
            dispatcher.post('messages', [[['No matches to search.', 'comment']]]);
            dispatcher.post('clearSearch', [true]);
          } else {
            applySearchResults(response);
          }
        }]);
        return false;
      };

      $('#search_form_load_file').change(function(evt) {
        var $file = $('#search_form_load_file');
        var file = $file[0].files[0];
        var reader = new FileReader();
        reader.onerror = function(evt) {
          dispatcher.post('messages', [[['The file could not be read.', 'error']]]);
        };
        reader.onloadend = function(evt) {
          try {
            loadedSearchData = JSON.parse(evt.target.result);
            // TODO XXX check for validity of contents, not just whether
            // it's valid JSON or not; throw something if not
          } catch (x) {
            dispatcher.post('messages', [[['The file contains invalid data.', 'error']]]);
            return;
          }
        };
        reader.readAsText(file);
      });

      searchForm.submit(searchFormSubmit);

      initForm(searchForm, {
          width: 500,
          // alsoResize: '#search_tabs',
          resizable: false,
          open: function(evt) {
            keymap = {};
          },
      });
      $('#search_form_clear').attr('title', 'Clear the search and resume normal collection browsing');

      var showSearchForm = function() {
        // this.checked = searchActive; // TODO: dup? unnecessary? remove if yes.
        updateSearchButtons();
        $('#search_form_event_type').change();
        $('#search_form_relation_type').change();
        dispatcher.post('showForm', [searchForm]);
        onSearchTabSelect();
      }

      $('#search_button').click(showSearchForm);

      var clearSearchResults = function() {
        // clear UI, don't show collection browser
        dispatcher.post('clearSearch', [true]);
        // TODO: this was the only way I found to reset search. It
        // trigger an unnecessary round-trip to the server, though,
        // so there should be a better way ...
        dispatcher.post('setArguments', [{}, true]);
      }

      $('#clear_search_button').click(clearSearchResults);

      var updateSearchButtons = function() {
        $searchButton = $('#search_button');
        $searchButton[0].checked = searchActive;
        $searchButton.button('refresh');
        $clearSearchButton = $('#clear_search_button');
        if (searchActive) {
            // TODO: this is a bit poor form, using jQuery UI classes
            // directly -- are these names guaranteed to be stable?
            $('#search_button_label').removeClass('ui-corner-all');
            $('#search_button_label').addClass('ui-corner-left');
            $clearSearchButton.show();
        } else {
            $('#search_button_label').removeClass('ui-corner-left');
            $('#search_button_label').addClass('ui-corner-all');
            $clearSearchButton.hide();
        }
      }

      /* END search - related */


      /* START data dialog - related */

      var dataForm = $('#data_form');
      var dataFormSubmit = function(evt) {
        dispatcher.post('hideForm');
        return false;
      };
      dataForm.submit(dataFormSubmit);
      initForm(dataForm, {
          width: 500,
          resizable: false,
          no_cancel: true,
          open: function(evt) {
            keymap = {};
            // aspects of the data form relating to the current document should
            // only be shown when a document is selected.
            if (!doc) {
              $('#document_export').hide();
              $('#document_visualization').hide();
            } else {
              $('#document_export').show();
              $('#document_visualization').show();
              // the SVG button can only be accessed through the data form,
              // so we'll spare unnecessary saves by only saving here
              saveSVG();
            }
          }
      });
      $('#data_button').click(function() {
        dispatcher.post('showForm', [dataForm]);
      });
      // make nice-looking buttons for checkboxes and buttons
      $('#data_form').find('input[type="checkbox"]').button();
      $('#data_form').find('input[type="button"]').button();

      // resize invalidates stored visualization (SVG etc.); add a
      // button to regen
      $('#stored_file_regenerate').button().hide();
      $('#stored_file_regenerate').click(function(evt) {
        $('#stored_file_regenerate').hide();
        saveSVG();
      });

      /* END data dialog - related */


      /* START options dialog - related */

      var optionsForm = $('#options_form');
      var optionsFormSubmit = function(evt) {
        dispatcher.post('hideForm');
        return false;
      };
      optionsForm.submit(optionsFormSubmit);
      initForm(optionsForm, {
          width: 550,
          resizable: false,
          no_cancel: true,
          open: function(evt) {
            keymap = {};
          }
      });
      $('#options_button').click(function() {
        dispatcher.post('showForm', [optionsForm]);
      });
      // make nice-looking buttons for checkboxes and radios
      $('#options_form').find('input[type="checkbox"]').button();
      $('#options_form').find('.radio_group').buttonset();
      $('#rapid_model').addClass('ui-widget ui-state-default ui-button-text');

      var fillDisambiguatorOptions = function(disambiguators) {
        $('#annotation_speed3').button(disambiguators.length ? 'enable': 'disable');
        //XXX: We need to disable rapid in the conf too if it is not available
        var $rapid_mode = $('#rapid_model').html('');
        $.each(disambiguators, function(modelNo, model) {
          var $option = $('<option/>').attr('value', model[2]).text(model[2]);
          $rapid_mode.append($option);
        });
      };

      /* END options dialog - related */


      /* START "more collection information" dialog - related */

      var moreInfoDialog = $('#more_information_dialog');
      var moreInfoDialogSubmit = function(evt) {
        dispatcher.post('hideForm');
        return false;
      };
      moreInfoDialog.submit(moreInfoDialogSubmit);
      initForm(moreInfoDialog, {
          width: 500,
          no_cancel: true,
          open: function(evt) {
            keymap = {};
          },
          alsoResize: '#more_info_readme',
      });
      $('#more_readme_button').click(function() {
        dispatcher.post('showForm', [moreInfoDialog]);
      });

      /* END "more collection information" dialog - related */


      var onKeyDown = function(evt) {
        var code = evt.which;

        if (code === $.ui.keyCode.ESCAPE) {
          dispatcher.post('messages', [false]);
          return;
        }

        if (currentForm) {
          if (code === $.ui.keyCode.ENTER) {
            // don't trigger submit in textareas to allow multiline text
            // entry
            // NOTE: spec seems to require this to be upper-case,
            // but at least chrome 8.0.552.215 returns lowercased
            var nodeType = evt.target.type ? evt.target.type.toLowerCase() : '';
            if (evt.target.nodeName && 
                evt.target.nodeName.toLowerCase() == 'input' && 
                (nodeType == 'text' || 
                 nodeType == 'password')) {
              currentForm.trigger('submit');
              return false;
            }
          } else if (evt.ctrlKey &&
                (code == 'F'.charCodeAt(0) || code == 'G'.charCodeAt(0))) {
            // prevent Ctrl-F/Ctrl-G in forms
            evt.preventDefault();
            return false;
          }
          return;
        }

        if (code === $.ui.keyCode.TAB) {
          showFileBrowser();
          return false;
        } else if (code == $.ui.keyCode.LEFT) {
          return moveInFileBrowser(-1);
        } else if (code === $.ui.keyCode.RIGHT) {
          return moveInFileBrowser(+1);
        } else if (evt.shiftKey && code === $.ui.keyCode.UP) {
          autoPaging(true);
        } else if (evt.shiftKey && code === $.ui.keyCode.DOWN) {
          autoPaging(false);
        } else if (evt.ctrlKey && code == 'F'.charCodeAt(0)) {
          evt.preventDefault();
          showSearchForm();
        } else if (searchActive && evt.ctrlKey && code == 'G'.charCodeAt(0)) {
          evt.preventDefault();
          return moveInFileBrowser(+1);
        } else if (searchActive && evt.ctrlKey && code == 'K'.charCodeAt(0)) {
          evt.preventDefault();
          clearSearchResults();
        }
      };

      var moveInFileBrowser = function(dir) {
        var pos = currentSelectorPosition();
        var newPos = pos + dir;
        if (newPos >= 0 && newPos < selectorData.items.length &&
            selectorData.items[newPos][0] != "c") {
          // not at the start, and the previous is not a collection (dir)
          dispatcher.post('allowReloadByURL');
          dispatcher.post('setDocument', [selectorData.items[newPos][2],
                                          selectorData.items[newPos][1]]);
        }
        return false;
      };
     
      /* Automatically proceed from document to document */ 
      var autoPagingTimeout = null;
      var autoPaging = function(on) {
          clearTimeout(autoPagingTimeout);
          if (on) {
            autoPagingTimeout = setInterval(function() {
              moveInFileBrowser(+1);
            }, 2000);
          }
      };

      var resizeFunction = function(evt) {
        dispatcher.post('renderData');
      };

      var resizerTimeout = null;
      var onResize = function(evt) {
        if (evt.target === window) {
          clearTimeout(resizerTimeout);
          resizerTimeout = setTimeout(resizeFunction, 100); // TODO is 100ms okay?
        }
      };

      var collectionLoaded = function(response) {
        if (response.exception) {
          if (response.exception == 'annotationCollectionNotFound' ||
              response.exception == 'collectionNotAccessible') {
              // revert to last good
            dispatcher.post('setCollection', [lastGoodCollection]);
          } else {
              dispatcher.post('messages', [[['Unknown error: ' + response.exception, 'error']]]);
              dispatcher.post('setCollection', ['/']);
          }
        } else {
          lastGoodCollection = response.collection;
          fillDisambiguatorOptions(response.disambiguator_config);
          selectorData = response;
          documentListing = response; // 'backup'
          searchConfig = response.search_config;
          selectorData.items.sort(docSortFunction);
          setupSearchTypes(response);
          // scroller at the top
          docScroll = 0;
        }
      };

      var searchResultsReceived = function(response) {
        if (response.exception) {
            ; // TODO: reasonable reaction
        } else {
          selectorData = response;
          sortOrder = [2, 1]; // reset
          // NOTE: don't sort, allowing order in which
          // responses are given to be used as default
          //selectorData.items.sort(docSortFunction);
          if (response.action.match(/Collection$/)) {
            showFileBrowser();
          } else {
            var item = response.items[0];
            dispatcher.post('setDocument', [item[2], item[1]]);
          }
          $('#save_search').css('display', 'inline-block');
        }
      };

      var clearSearch = function(dontShowFileBrowser) {
        dispatcher.post('hideForm');

        // back off to document collection
        if (searchActive) {
          $('#save_search').css('display', 'none');
          selectorData = documentListing;
          sortOrder = collectionSortOrder;
          selectorData.items.sort(docSortFunction);
          searchActive = false;
          updateSearchButtons();
        }

        if (!dontShowFileBrowser) {
          showFileBrowser();
        }
      }

      var saveSVGTimer = null;
      var saveSVG = function() {
        if (currentDocumentSVGsaved) {
          // no need to store again
          return false;
        }
        clearTimeout(saveSVGTimer);
        $('#stored_file_regenerate').hide();
        $('#stored_file_spinner').show()
        saveSVGTimer = dispatcher.post(1, 'ajax', [{
          action: 'storeSVG',
          svg: $('#svg').html(),
          collection: coll,
          document: doc
        }, 'savedSVG']);
      };

      var onDoneRendering = function(coll, doc, args) {
        if (args && !args.edited) {
          var svgtop = $('svg').offset().top;
          var $inFocus = $('#svg animate[data-type="focus"]:first').parent();
          if ($inFocus.length) {
            $('html,body').
                animate({ scrollTop: $inFocus.offset().top - svgtop - window.innerHeight / 2 }, { duration: 'slow', easing: 'swing'});
          }
        }
        dispatcher.post('allowReloadByURL');
        if (!currentForm) {
          $('#waiter').dialog('close');
        }
      }

      var onStartedRendering = function() {
        hideForm();
        if (!currentForm) {
          $('#waiter').dialog('open');
        }
      }

      var savedSVGreceived = function(response) {
        $('#stored_file_spinner').hide()

        if (response && response.exception == 'corruptSVG') {
          dispatcher.post('messages', [[['Cannot save SVG: corrupt', 'error']]]);
          return;
        }
        var $downloadStored = $('#download_stored').empty().show();
        $.each(response.stored, function(storedNo, stored) {
          var params = {
            'action': 'retrieveStored',
            'document': doc,
            'suffix': stored.suffix,
            // TODO: Extract the protocol version into somewhere global
            'protocol': 1
          };
          var $downloadLink = $('<a id="download_'+stored.name+'"' +
                                ' target="'+stored.name+'"' +
                                '>'+stored.name+'</a>');
          $downloadLink.attr('href', 'ajax.cgi?' + $.param(params));
          $downloadLink.button();
          if (storedNo) $downloadStored.append(' ');
          $downloadStored.append($downloadLink);
        });
        currentDocumentSVGsaved = true;
      };

      var invalidateSavedSVG = function() {
        // assuming that invalidation of the SVG invalidates all stored
        // static visualizations, as others are derived from the SVG
        $('#download_stored').hide();
        // have a way to regenerate if dialog open when data invalidated
        $('#stored_file_regenerate').show();
        currentDocumentSVGsaved = false;
      };

      var onNewSourceData = function(sourceData) {
        if (!sourceData) return;
        var $sourceFiles = $('#source_files').empty();
        /* Add download links for all available extensions */
        $.each(sourceData.source_files, function(extNo, ext) {
          var $link = $('<a target="brat_search"/>').
              text(ext).
              attr('href',
                  'ajax.cgi?action=downloadFile&collection=' + encodeURIComponent(coll) +
                  '&document=' + encodeURIComponent(doc) + '&extension=' + encodeURIComponent(ext) +
                  // TODO: Extract the protocol version into somewhere global
                  '&protocol=' + 1);
          $link.button();
          if (extNo) $sourceFiles.append(' ');
          $sourceFiles.append($link);
        });
        /* Add a download link for the whole collection */
        invalidateSavedSVG();

        mtime = sourceData.mtime;
        if (mtime) {
          // we're getting seconds and need milliseconds
          //$('#document_ctime').text("Created: " + Annotator.formatTime(1000 * sourceData.ctime)).css("display", "inline");
          $('#document_mtime').text("Last modified: " + Util.formatTimeAgo(1000 * mtime)).show();
        } else {
          //$('#document_ctime').css("display", "none");
          $('#document_mtime').hide();
        }
      }

      //BRAT STANDALONE LIBRARY BEGIN
      //We do no use notion of documents
      /**/
      var gotCurrent = function(_coll, _doc, _args) {
        var oldColl = coll;

        coll = _coll;
        doc = _doc;
        args = _args;

        // if we have a specific document, hide the "no document" message
        if (_doc) {
          hideNoDocMessage();
        }

        // if we have a collection change, update "collection download" and
        // "side-by-side comparison" buttons
        if (oldColl != coll) {
          var $sourceCollection = $('#source_collection').empty();
          var $collectionDownloadLink = $('<a target="brat_search"/>')
            .text('Download tar.gz')
            .attr('href', 'ajax.cgi?action=downloadCollection&collection=' + encodeURIComponent(coll)
            // TODO: Extract the protocol version into somewhere global
            + '&protocol=' + 1);
          $sourceCollection.append($collectionDownloadLink);
          $collectionDownloadLink.button();

          $cmpButton = $('#side-by-side_cmp').empty();
          var $cmpLink = $('<a target="_blank"/>')
            .text('Comparison mode')
            .attr('href', 'diff.xhtml?diff=' + encodeURIComponent(coll));
          $cmpButton.append($cmpLink);
          $cmpLink.button();
        }

        //BRAT STANDALONE LIBRARY BEGIN
        /*
        $docName = $('#document_name input').val(coll + doc);
        var docName = $docName[0];
        // TODO do this on resize, as well
        // scroll the document name to the right, so the name is visible
        // (even if the collection name isn't, fully)
        docName.scrollLeft = docName.scrollWidth;

        $('#document_mtime').hide();
        */
        //BRAT STANDALONE LIBRARY END
        invalidateSavedSVG();
      };
      /**/
      //BRAT STANDALONE LIBRARY END

      var slideToggle = function(el, show, autoHeight, bottom) {
        var el = $(el);
        var visible = el.is(":visible");
        var height;

        if (show === undefined) show = !visible;

        // @amadanmath: commenting this out appears to remove the annoying
        // misfeature where it's possible to stop the menu halfway by
        // mousing out and back in during closing. Please check that
        // this doesn't introduce other trouble and remove these lines.
//         if (show === visible) return false;

        if (!autoHeight) {
          height = el.data("cachedHeight");
        } else {
          el.height('auto');
        }
        if (!height) {
          height = el.show().height();
          el.data('cachedHeight', height);
          if (!visible) el.hide().css({ height: 0 });
        }

        if (show) {
          el.show().animate({ height: height }, {
            duration: 150,
            complete: function() {
              if (autoHeight) {
                el.height('auto');
              }
            },
            step: bottom ? function(now, fx) {
              fx.elem.scrollTop = fx.elem.scrollHeight;
            } : undefined
          });
        } else {
          el.animate({ height: 0 }, {
            duration: 300,
            complete: function() {
              el.hide();
            }
          });
        }
      }

      var menuTimer = null;
      $('#header').
        mouseenter(function(evt) {
          clearTimeout(menuTimer);
          slideToggle($('#pulldown').stop(), true);
        }).
        mouseleave(function(evt) {
          clearTimeout(menuTimer);
          menuTimer = setTimeout(function() {
            slideToggle($('#pulldown').stop(), false);
          }, 500);
        });

      $('#label_abbreviations input').click(function(evt) {
        var val = this.value;
        val = val === 'on';
        if (val) {
          dispatcher.post('messages', [[['Abbreviations are now on', 'comment']]]);
        } else {
          dispatcher.post('messages', [[['Abbreviations are now off', 'comment']]]);
        }
        dispatcher.post('abbrevs', [val]);
        // TODO: XXX: for some insane reason, doing the following call
        // synchronously breaks the checkbox (#456). If you ever figure
        // out why, it would make more sense to call
        //    dispatcher.post('resetData');
        // without the asynch.
        dispatcher.post(1, 'resetData');
      });

      $('#text_backgrounds input').click(function(evt) {
        var val = this.value;
        dispatcher.post('textBackgrounds', [val]);
        // TODO: XXX: see comment above for why this is asynchronous
        dispatcher.post(1, 'resetData');
      });

      $('#layout_density input').click(function(evt) {
        var val = this.value;
        dispatcher.post('layoutDensity', [val]);
        // TODO: XXX: see comment above for why this is asynchronous
        dispatcher.post(1, 'resetData');
        return false;
      });

      $('#svg_width_unit input').click(function(evt) {
        var width_unit = this.value;
        var width_value = $('#svg_width_value')[0].value;
        var val = width_value+width_unit;
        dispatcher.post('svgWidth', [val]);
        // TODO: XXX: see comment above for why this is asynchronous
        dispatcher.post(1, 'resetData');
        return false;
      });

      $('#annotation_speed input').click(function(evt) {
        var val = this.value;
        dispatcher.post('annotationSpeed', [val]);
        return false;
      });      
    
      $('#pulldown').find('input').button();
      var headerHeight = $('#mainHeader').height();
      $('#svg').css('margin-top', headerHeight + 10);
      aboutDialog = $('#about');
      aboutDialog.dialog({
            autoOpen: false,
            closeOnEscape: true,
            resizable: false,
            modal: true,
            open: function() {
                aboutDialog.find('*').blur();
              },
            beforeClose: function() {
                currentForm = null;
              }
          });
      $('#mainlogo').click(function() {
        showForm(aboutDialog);
      });

      // TODO: copy from annotator_ui; DRY it up
      var adjustFormToCursor = function(evt, element) {
        var screenHeight = $(window).height() - 8; // TODO HACK - no idea why -8 is needed
        var screenWidth = $(window).width() - 8;
        var elementHeight = element.height();
        var elementWidth = element.width();
        var y = Math.min(evt.clientY, screenHeight - elementHeight);
        var x = Math.min(evt.clientX, screenWidth - elementWidth);
        element.css({ top: y, left: x });
      };
      var viewspanForm = $('#viewspan_form');

      var onSingleClick = function(evt) {
        var target = $(evt.target);
        var id;
        if (id = target.attr('data-span-id')) {
          var span = data.spans[id];
          dispatcher.post('sglclick', [span]);
        }
      };

      var onDblClick = function(evt) {
        if (user && annotationAvailable) return;
        var target = $(evt.target);
        var id;
        if (id = target.attr('data-span-id')) {
          window.getSelection().removeAllRanges();
          var span = data.spans[id];

          var urlHash = URLHash.parse(window.location.hash);
          urlHash.setArgument('focus', [[span.id]]);
          $('#viewspan_highlight_link').show().attr('href', urlHash.getHash());

          $('#viewspan_selected').text(span.text);
          var encodedText = encodeURIComponent(span.text);
          $.each(searchConfig, function(searchNo, search) {
            $('#viewspan_'+search[0]).attr('href', search[1].replace('%s', encodedText));
          });
          // annotator comments
          $('#viewspan_notes').val(span.annotatorNotes || '');
          dispatcher.post('showForm', [viewspanForm]);
          $('#viewspan_form-ok').focus();
          adjustFormToCursor(evt, viewspanForm.parent());
        }
      };
      viewspanForm.submit(function(evt) {
        dispatcher.post('hideForm');
        return false;
      });

      var authForm = $('#auth_form');
      initForm(authForm, { resizable: false });
      var authFormSubmit = function(evt) {
        dispatcher.post('hideForm');
        var _user = $('#auth_user').val();
        var password = $('#auth_pass').val();
        dispatcher.post('ajax', [{
            action: 'login',
            user: _user,
            password: password,
          },
          function(response) {
              if (response.exception) {
                dispatcher.post('showForm', [authForm]);
                $('#auth_user').select().focus();
              } else {
                user = _user;
                $('#auth_button').val('Logout ' + user);
                $('#auth_user').val('');
                $('#auth_pass').val('');
                $('.login').show();
                dispatcher.post('user', [user]);
              }
          }]);
        return false;
      };
      $('#auth_button').click(function(evt) {
        if (user) {
          dispatcher.post('ajax', [{
            action: 'logout'
          }, function(response) {
            user = null;
            $('#auth_button').val('Login');
            $('.login').hide();
            dispatcher.post('user', [null]);
          }]);
        } else {
          dispatcher.post('showForm', [authForm]);
        }
      });
      authForm.submit(authFormSubmit);


      var tutorialForm = $('#tutorial');
      if (!$.browser.webkit) {
        // Inject the browser warning
        $('#browserwarning').css('display', 'block');
      }
      initForm(tutorialForm, {
        width: 800,
        height: 600,
        no_cancel: true,
        no_ok: true,
        buttons: [{
          id: "tutorial-ok",
          text: "OK",
          click: function() { tutorialForm.dialog('close'); }
        }],
        close: function() {
          if (fileBrowserWaiting) {
            showFileBrowser();
          }
        }
      });

      var init = function() {
        dispatcher.post('initForm', [viewspanForm, {
            width: 760,
            no_cancel: true
          }]);
        dispatcher.post('ajax', [{
            action: 'whoami'
          }, function(response) {
            var auth_button = $('#auth_button');
            if (response.user) {
              user = response.user;
              dispatcher.post('messages', [[['Welcome back, user "' + user + '"', 'comment']]]);
              auth_button.val('Logout ' + user);
              dispatcher.post('user', [user]);
              $('.login').show();
            } else {
              user = null;
              auth_button.val('Login');
              dispatcher.post('user', [null]);
              $('.login').hide();
              // don't show tutorial if there's a specific document (annoyance)
              if (!doc) {
                dispatcher.post('showForm', [tutorialForm]);
                $('#tutorial-ok').focus();
              }
            }
          },
          { keep: true }
        ]);
        dispatcher.post('ajax', [{ action: 'loadConf' }, function(response) {
          if (response.config != undefined) {
            // TODO: check for exceptions
            try {
              Configuration = JSON.parse(response.config);
            } catch(x) {
              // XXX Bad config
              Configuration = {};
              dispatcher.post('messages', [[['Corrupted configuration; resetting.', 'error']]]);
              configurationChanged();
            }
            // TODO: make whole-object assignment work
            // @amadanmath: help! This code is horrible
            // Configuration.svgWidth = storedConf.svgWidth;
            dispatcher.post('svgWidth', [Configuration.svgWidth]);
            // Configuration.abbrevsOn = storedConf.abbrevsOn == "true";
            // Configuration.textBackgrounds = storedConf.textBackgrounds;
            // Configuration.rapidModeOn = storedConf.rapidModeOn == "true";
            // Configuration.confirmModeOn = storedConf.confirmModeOn == "true";
            // Configuration.autorefreshOn = storedConf.autorefreshOn == "true";
            if (Configuration.autorefreshOn) {
              checkForDocumentChanges();
            }
            // Configuration.visual.margin.x = parseInt(storedConf.visual.margin.x);
            // Configuration.visual.margin.y = parseInt(storedConf.visual.margin.y);
            // Configuration.visual.boxSpacing = parseInt(storedConf.visual.boxSpacing);
            // Configuration.visual.curlyHeight = parseInt(storedConf.visual.curlyHeight);
            // Configuration.visual.arcSpacing = parseInt(storedConf.visual.arcSpacing);
            // Configuration.visual.arcStartHeight = parseInt(storedConf.visual.arcStartHeight);
          }
          dispatcher.post('configurationUpdated');
        }]);
      };

      var noFileSpecified = function() {
        // not (only) an error, so no messaging
        dispatcher.post('clearSVG');
        showFileBrowser();
      }

      var showUnableToReadTextFile = function() {
        dispatcher.post('messages', [[['Unable to read the text file.', 'error']]]);
        dispatcher.post('clearSVG');
        showFileBrowser();
      };

      var showAnnotationFileNotFound = function() {
        dispatcher.post('messages', [[['Annotation file not found.', 'error']]]);
        dispatcher.post('clearSVG');
        showFileBrowser();
      };

      var showUnknownError = function(exception) {
        dispatcher.post('messages', [[['Unknown error: ' + exception, 'error']]]);
        dispatcher.post('clearSVG');
        showFileBrowser();
      };

      var reloadDirectoryWithSlash = function(sourceData) {
        var collection = sourceData.collection + sourceData.document + '/';
        dispatcher.post('setCollection', [collection, '', sourceData.arguments]);
      };

      // TODO: confirm attributeTypes unnecessary and remove
//       var spanAndAttributeTypesLoaded = function(_spanTypes, _attributeTypes) {
//         spanTypes = _spanTypes;
//         attributeTypes = _attributeTypes;
//       };
      // TODO: spanAndAttributeTypesLoaded is obviously not descriptive of
      // the full function. Rename reasonably.
      var spanAndAttributeTypesLoaded = function(_spanTypes, _entityAttributeTypes, _eventAttributeTypes, _relationTypesHash) {
        spanTypes = _spanTypes;
        relationTypesHash = _relationTypesHash;
      };

      var annotationIsAvailable = function() {
        annotationAvailable = true;
      };

      // hide anything requiring login, just in case
      $('.login').hide();

      // XXX TODO a lot
      var touchStart;
      var onTouchStart = function(evt) {
        // evt.preventDefault();
        evt = evt.originalEvent;
        if (evt.touches.length == 1) {
          // single touch; start tracking to see if we're doing
          // left/right
          touchStart = $.extend({}, evt.touches[0]); // clone
        } else if (evt.touches.length == 4) {
          // 4 finger tap: file browser
          showFileBrowser();
          return false;
        }
      };
      var onTouchEnd = function(evt) {
        // evt.preventDefault();
        evt = evt.originalEvent;
        $.each(evt.changedTouches, function(touchEndNo, touchEnd) {
          if (touchStart.identifier == touchEnd.identifier) {
            var dx = touchEnd.screenX - touchStart.screenX;
            var dy = touchEnd.screenY - touchStart.screenY;
            var adx = Math.abs(dx);
            var ady = Math.abs(dy);
            if (adx > 200 && ady < adx / 2) {
              // it's left/right!
              return moveInFileBrowser(dx < 0 ? -1 : +1);
            }
          }
        });
      };

      var documentChangesTimer = null;
      var maxDocumentChangesTimeout = 32 * 1000;
      var documentChangesTimeout = 1 * 1000;
      var checkForDocumentChanges = function() {
        if (coll && doc && dispatcher.post('isReloadOkay', [], 'all')) {
          opts = {
            'action': 'getDocumentTimestamp',
            'collection': coll,
            'document': doc
          }
          dispatcher.post('ajax', [opts, function(response) {
            if (data) {
              if (mtime != response.mtime) {
                dispatcher.post('current', [coll, doc, args, true]);
                documentChangesTimeout = 1 * 1000;
              } else {
                documentChangesTimeout *= 2;
                if (documentChangesTimeout >= maxDocumentChangesTimeout)
                  documentChangesTimeout = maxDocumentChangesTimeout;
              }
            }
          }]);
        } else {
          documentChangesTimeout = 1 * 1000;
        }
        documentChangesTimer = setTimeout(checkForDocumentChanges, documentChangesTimeout);
      }

      if (Configuration.autorefreshOn) {
        checkForDocumentChanges();
      }

      $('#autorefresh_mode').click(function(evt) {
        var val = this.checked;
        if (val) {
          Configuration.autorefreshOn = true;
          checkForDocumentChanges();
          dispatcher.post('messages', [[['Autorefresh mode is now on', 'comment']]]);
        } else {
          Configuration.autorefreshOn = false;
          clearTimeout(documentChangesTimer);
          dispatcher.post('messages', [[['Autorefresh mode is now off', 'comment']]]);
        }
        dispatcher.post('configurationChanged');
      });

      var isReloadOkay = function() {
        // do not reload while the user is in the dialog
        return currentForm == null;
      };

      var configurationChanged = function() {
        // just assume that any config change makes stored
        // visualizations invalid. This is a bit excessive (not all
        // options affect visualization) but mostly harmless.
        invalidateSavedSVG();

        // save configuration changed by user action
        dispatcher.post('ajax', [{
                    action: 'saveConf',
                    config: JSON.stringify(Configuration),
                }, null]);
      };

      //BRAT STANDALONE LIBRARY BEGIN
      //Config must be managed outside the component
      /*
      var updateConfigurationUI = function() {
        // update UI to reflect non-user config changes (e.g. load)
        
        // Annotation mode
        if (Configuration.confirmModeOn) {
          $('#annotation_speed1')[0].checked = true;
        } else if (Configuration.rapidModeOn) {
          $('#annotation_speed3')[0].checked = true;
        } else {
          $('#annotation_speed2')[0].checked = true;
        }
        $('#annotation_speed input').button('refresh');

        // Label abbrevs
        $('#label_abbreviations_on')[0].checked  = Configuration.abbrevsOn;
        $('#label_abbreviations_off')[0].checked = !Configuration.abbrevsOn; 
        $('#label_abbreviations input').button('refresh');

        // Text backgrounds        
        $('#text_backgrounds input[value="'+Configuration.textBackgrounds+'"]')[0].checked = true;
        $('#text_backgrounds input').button('refresh');

        // SVG width
        var splitSvgWidth = Configuration.svgWidth.match(/^(.*?)(px|\%)$/);
        if (!splitSvgWidth) {
          // TODO: reset to sensible value?
          dispatcher.post('messages', [[['Error parsing SVG width "'+Configuration.svgWidth+'"', 'error', 2]]]);
        } else {
          $('#svg_width_value')[0].value = splitSvgWidth[1];
          $('#svg_width_unit input[value="'+splitSvgWidth[2]+'"]')[0].checked = true;
          $('#svg_width_unit input').button('refresh');
        }

        // Autorefresh
        $('#autorefresh_mode')[0].checked = Configuration.autorefreshOn;
        $('#autorefresh_mode').button('refresh');
      }*/

      $('#prev').button().click(function() {
        return moveInFileBrowser(-1);
      });
      $('#next').button().click(function() {
        return moveInFileBrowser(+1);
      });
      $('#footer').show();

      var rememberData = function(_data) {
        if (_data && !_data.exception) {
          data = _data;
        }
      };

      var onScreamingHalt = function() {
        $('#waiter').dialog('close');
        $('#pulldown, #navbuttons, #spinner').remove();
        dispatcher.post('hideForm');
      };

      dispatcher.
          on('init', init).
          on('dataReady', rememberData).
          on('annotationIsAvailable', annotationIsAvailable).
          on('messages', displayMessages).
          on('displaySpanComment', displaySpanComment).
          on('displayArcComment', displayArcComment).
          on('displaySentComment', displaySentComment).
          on('docChanged', onDocChanged).
          on('hideComment', hideComment).
          on('showForm', showForm).
          on('hideForm', hideForm).
          on('initForm', initForm).
          on('collectionLoaded', rememberNormDb).
          on('collectionLoaded', collectionLoaded).
          on('spanAndAttributeTypesLoaded', spanAndAttributeTypesLoaded).
          on('isReloadOkay', isReloadOkay).
          on('current', gotCurrent).
          on('doneRendering', onDoneRendering).
          on('startedRendering', onStartedRendering).
          on('newSourceData', onNewSourceData).
          on('savedSVG', savedSVGreceived).
          on('renderError:noFileSpecified', noFileSpecified).
          on('renderError:annotationFileNotFound', showAnnotationFileNotFound).
          on('renderError:unableToReadTextFile', showUnableToReadTextFile).
          on('renderError:isDirectoryError', reloadDirectoryWithSlash).
          on('unknownError', showUnknownError).
          on('keydown', onKeyDown).
          on('mousemove', onMouseMove).
          on('dblclick', onDblClick).
          on('click', onSingleClick).
          on('touchstart', onTouchStart).
          on('touchend', onTouchEnd).
          on('resize', onResize).
          on('searchResultsReceived', searchResultsReceived).
          on('clearSearch', clearSearch).
          on('clearSVG', showNoDocMessage).
          on('screamingHalt', onScreamingHalt).
          //on('configurationUpdated', updateConfigurationUI).
          on('configurationChanged', configurationChanged);
    };

    return VisualizerUI;
})(jQuery, window);

// BRAT STANDALONE LIBRARY BEGIN
// Browserify export
module.exports = VisualizerUI;
// BRAT STANDALONE LIBRARY END

},{}],19:[function(require,module,exports){
window.$ = require('./client/lib/node-jquery-1.7.1'); //require('jquery-node-browserify'); // @1.7.2 ++
LONG_ANNOTATION_CONST = "LongAnnotation";

window.BratFrontendEditor = function(element, collData, docData, options) {
    if (!(element instanceof Element)) {
        throw new Error('element should be an instance of Element');
    }

    collData = collData || {};
    docData = docData || {};
    options = options || {};

    //DEFAULT OPTIONS
    newOptions = {
        activateEdition: true,
        overWriteModals: false,
        showTooltip: false,
        assetsPath: "static/",
        maxFragmentLength: 40,
        showTooltip: true,
        overWriteModals: false,
        webFontURLs: [
            'fonts/Astloch-Bold.ttf',
            'fonts/PT_Sans-Caption-Web-Regular.ttf',
            'fonts/Liberation_Sans-Regular.ttf'
        ],
        ajax: 'local' // 'local', 'external' or 'normal'
    };

    // If option defined, over-write newOptions
    for(var opt in options){
        if(options.hasOwnProperty(opt)){
            newOptions[opt] = options[opt];
        }
    }

    this.element = element;
    this.collData = collData;
    this.docData = docData;
    this.options = newOptions;
    this.init();
};

BratFrontendEditor.prototype = {
    constructor: BratFrontendEditor,
    init: function() {
        var self = this;
        var html = require('./brat.html');
        self.element.innerHTML = html;
        self.setHtmlImgSrc();

        window.jQuery = $;
        (function($){
            // require('./index.css'); //TODO: If possible, include css in min.js (browserify-css)
            require('./client/lib/jquery-ui.min');
            require('./client/lib/jquery.svg.min');
            require('./client/lib/jquery.svgdom.min');
            require('jquery-bbq');
            require('./client/lib/jquery.sprintf');
            require('./client/lib/jquery.json.min');
            //TODO Fix this error
            window.WebFont = require('./client/lib/webfont.js').WebFont; //Uncaught TypeError: Cannot set property 'WebFont' of undefined

            //brat global helpers
            var Config= require('./client/src/configuration');
            window.Configuration = new Config();
            window.Util = require('./client/src/util');

            // brat modules
            window.Dispatcher = require('./client/src/dispatcher');
            window.URLHash = require('./client/src/url_hash'); //TODO Figure out
            window.LocalAjax = require('./client/src/local_ajax');
            window.Ajax = require('./client/src/ajax.js');
            window.Visualizer = require('./client/src/visualizer');
            window.VisualizerUI = require('./client/src/visualizer_ui');
            window.AnnotatorUI = require('./client/src/annotator_ui');
            window.Spinner = require('./client/src/spinner');

            $(document).ready(function(){
                self.dispatcher = new Dispatcher();
                switch(self.options.ajax) {
                    case 'local':
                        self.ajax = new LocalAjax(self.dispatcher, self.options.maxFragmentLength);
                        break;
                    case 'normal':
                        self.ajax = new Ajax(self.dispatcher);
                        break;
                    case 'external':
                        break;
                    default:
                        self.ajax = new LocalAjax(self.dispatcher, self.options.maxFragmentLength);
                        break;
                }
                var absoluteWebFontsURLS = [
                    self.options.assetsPath + self.options.webFontURLs[0],
                    self.options.assetsPath + self.options.webFontURLs[1],
                    self.options.assetsPath + self.options.webFontURLs[2],
                ];
                self.visualizer = new Visualizer(self.dispatcher, 'svg', absoluteWebFontsURLS);
                self.svg = self.visualizer.svg;
                if(self.options.activateEdition === true){
                    self.visualizerUI = new VisualizerUI(self.dispatcher, self.svg, self.options.showTooltip, self.options.overWriteModals);
                    self.annotatorUI = new AnnotatorUI(self.dispatcher, self.svg);
                    // self.spinner = new Spinner(self.dispatcher, '#spinner');
                }
                self.dispatcher.post('init');

                if(self.options.maxFragmentLength > 0){
                    self.addLongAnnotationEntityAttribute();
                }

                self.docData.collection = null;
                self.dispatcher.post('collectionLoaded', [self.collData]);
                self.dispatcher.post('requestRenderData', [self.docData]);
                self.dispatcher.post('current', [self.collData, self.docData, {}]);
            });

        })($);
    },
    addLongAnnotationEntityAttribute: function(){
        // Special symbol for splitted long annotations
        this.collData.entity_attribute_types.push( {
            "name": LONG_ANNOTATION_CONST,
            "type"  : LONG_ANNOTATION_CONST,
            "values": { LONG_ANNOTATION_CONST: { "glyph": "" } }
        });
        this.collData.entity_types.forEach(function(type){
            type.attributes.push(LONG_ANNOTATION_CONST);
        });
    },
    setHtmlImgSrc: function(){
        var spinners = this.element.getElementsByClassName("brat-spinner");
        var magnifiers = this.element.getElementsByClassName("brat-fugue-shadowless-magnifier");
        var externals = this.element.getElementsByClassName("brat-fugue-shadowless-external");

        if(spinners && spinners.length){
            spinners[0].src = this.options.assetsPath + 'img/spinner.gif';
        }
        if(magnifiers && magnifiers.length){
            magnifiers[0].src = this.options.assetsPath + 'img/Fugue-shadowless-magnifier.png';
        }
        if(externals && externals.length){
            externals[0].src = this.options.assetsPath + 'img/Fugue-shadowless-external.png';
        }
    }
};

},{"./brat.html":1,"./client/lib/jquery-ui.min":2,"./client/lib/jquery.json.min":3,"./client/lib/jquery.sprintf":4,"./client/lib/jquery.svg.min":5,"./client/lib/jquery.svgdom.min":6,"./client/lib/node-jquery-1.7.1":7,"./client/lib/webfont.js":8,"./client/src/ajax.js":9,"./client/src/annotator_ui":10,"./client/src/configuration":11,"./client/src/dispatcher":12,"./client/src/local_ajax":13,"./client/src/spinner":14,"./client/src/url_hash":15,"./client/src/util":16,"./client/src/visualizer":17,"./client/src/visualizer_ui":18,"jquery-bbq":20}],20:[function(require,module,exports){
/*!
 * jQuery BBQ: Back Button & Query Library - v1.3pre - 8/26/2010
 * http://benalman.com/projects/jquery-bbq-plugin/
 *
 * Copyright (c) 2010 "Cowboy" Ben Alman
 * Dual licensed under the MIT and GPL licenses.
 * http://benalman.com/about/license/
 */

// Script: jQuery BBQ: Back Button & Query Library
//
// *Version: 1.3pre, Last updated: 8/26/2010*
//
// Project Home - http://benalman.com/projects/jquery-bbq-plugin/
// GitHub       - http://github.com/cowboy/jquery-bbq/
// Source       - http://github.com/cowboy/jquery-bbq/raw/master/jquery.ba-bbq.js
// (Minified)   - http://github.com/cowboy/jquery-bbq/raw/master/jquery.ba-bbq.min.js (2.2kb gzipped)
//
// About: License
//
// Copyright (c) 2010 "Cowboy" Ben Alman,
// Dual licensed under the MIT and GPL licenses.
// http://benalman.com/about/license/
//
// About: Examples
//
// These working examples, complete with fully commented code, illustrate a few
// ways in which this plugin can be used.
//
// Basic AJAX     - http://benalman.com/code/projects/jquery-bbq/examples/fragment-basic/
// Advanced AJAX  - http://benalman.com/code/projects/jquery-bbq/examples/fragment-advanced/
// jQuery UI Tabs - http://benalman.com/code/projects/jquery-bbq/examples/fragment-jquery-ui-tabs/
// Deparam        - http://benalman.com/code/projects/jquery-bbq/examples/deparam/
//
// About: Support and Testing
//
// Information about what version or versions of jQuery this plugin has been
// tested with, what browsers it has been tested in, and where the unit tests
// reside (so you can test it yourself).
//
// jQuery Versions - 1.2.6, 1.3.2, 1.4.1, 1.4.2
// Browsers Tested - Internet Explorer 6-8, Firefox 2-4, Chrome 5-6, Safari 3.2-5,
//                   Opera 9.6-10.60, iPhone 3.1, Android 1.6-2.2, BlackBerry 4.6-5.
// Unit Tests      - http://benalman.com/code/projects/jquery-bbq/unit/
//
// About: Release History
//
// 1.3pre - (8/26/2010) Integrated <jQuery hashchange event> v1.3, which adds
//         document.title and document.domain support in IE6/7, BlackBerry
//         support, better Iframe hiding for accessibility reasons, and the new
//         <jQuery.fn.hashchange> "shortcut" method. Added the
//         <jQuery.param.sorted> method which reduces the possibility of
//         extraneous hashchange event triggering. Added the
//         <jQuery.param.fragment.ajaxCrawlable> method which can be used to
//         enable Google "AJAX Crawlable mode."
// 1.2.1 - (2/17/2010) Actually fixed the stale window.location Safari bug from
//         <jQuery hashchange event> in BBQ, which was the main reason for the
//         previous release!
// 1.2   - (2/16/2010) Integrated <jQuery hashchange event> v1.2, which fixes a
//         Safari bug, the event can now be bound before DOM ready, and IE6/7
//         page should no longer scroll when the event is first bound. Also
//         added the <jQuery.param.fragment.noEscape> method, and reworked the
//         <hashchange event (BBQ)> internal "add" method to be compatible with
//         changes made to the jQuery 1.4.2 special events API.
// 1.1.1 - (1/22/2010) Integrated <jQuery hashchange event> v1.1, which fixes an
//         obscure IE8 EmulateIE7 meta tag compatibility mode bug.
// 1.1   - (1/9/2010) Broke out the jQuery BBQ event.special <hashchange event>
//         functionality into a separate plugin for users who want just the
//         basic event & back button support, without all the extra awesomeness
//         that BBQ provides. This plugin will be included as part of jQuery BBQ,
//         but also be available separately. See <jQuery hashchange event>
//         plugin for more information. Also added the <jQuery.bbq.removeState>
//         method and added additional <jQuery.deparam> examples.
// 1.0.3 - (12/2/2009) Fixed an issue in IE 6 where location.search and
//         location.hash would report incorrectly if the hash contained the ?
//         character. Also <jQuery.param.querystring> and <jQuery.param.fragment>
//         will no longer parse params out of a URL that doesn't contain ? or #,
//         respectively.
// 1.0.2 - (10/10/2009) Fixed an issue in IE 6/7 where the hidden IFRAME caused
//         a "This page contains both secure and nonsecure items." warning when
//         used on an https:// page.
// 1.0.1 - (10/7/2009) Fixed an issue in IE 8. Since both "IE7" and "IE8
//         Compatibility View" modes erroneously report that the browser
//         supports the native window.onhashchange event, a slightly more
//         robust test needed to be added.
// 1.0   - (10/2/2009) Initial release

(function($,window){
  console.info('yes!')
  '$:nomunge'; // Used by YUI compressor.

  // Some convenient shortcuts.
  var undefined,
    aps = Array.prototype.slice,
    decode = decodeURIComponent,

    // Method / object references.
    jq_param = $.param,
    jq_param_sorted,
    jq_param_fragment,
    jq_deparam,
    jq_deparam_fragment,
    jq_bbq = $.bbq = $.bbq || {},
    jq_bbq_pushState,
    jq_bbq_getState,
    jq_elemUrlAttr,
    special = $.event.special,

    // Reused strings.
    str_hashchange = 'hashchange',
    str_querystring = 'querystring',
    str_fragment = 'fragment',
    str_elemUrlAttr = 'elemUrlAttr',
    str_href = 'href',
    str_src = 'src',

    // Reused RegExp.
    re_params_querystring = /^.*\?|#.*$/g,
    re_params_fragment,
    re_fragment,
    re_no_escape,

    ajax_crawlable,
    fragment_prefix,

    // Used by jQuery.elemUrlAttr.
    elemUrlAttr_cache = {};

  // A few commonly used bits, broken out to help reduce minified file size.

  function is_string( arg ) {
    return typeof arg === 'string';
  };

  // Why write the same function twice? Let's curry! Mmmm, curry..

  function curry( func ) {
    var args = aps.call( arguments, 1 );

    return function() {
      return func.apply( this, args.concat( aps.call( arguments ) ) );
    };
  };

  // Get location.hash (or what you'd expect location.hash to be) sans any
  // leading #. Thanks for making this necessary, Firefox!
  function get_fragment( url ) {
    return url.replace( re_fragment, '$2' );
  };

  // Get location.search (or what you'd expect location.search to be) sans any
  // leading #. Thanks for making this necessary, IE6!
  function get_querystring( url ) {
    return url.replace( /(?:^[^?#]*\?([^#]*).*$)?.*/, '$1' );
  };

  // Section: Param (to string)
  //
  // Method: jQuery.param.querystring
  //
  // Retrieve the query string from a URL or if no arguments are passed, the
  // current window.location.href.
  //
  // Usage:
  //
  // > jQuery.param.querystring( [ url ] );
  //
  // Arguments:
  //
  //  url - (String) A URL containing query string params to be parsed. If url
  //    is not passed, the current window.location.href is used.
  //
  // Returns:
  //
  //  (String) The parsed query string, with any leading "?" removed.
  //

  // Method: jQuery.param.querystring (build url)
  //
  // Merge a URL, with or without pre-existing query string params, plus any
  // object, params string or URL containing query string params into a new URL.
  //
  // Usage:
  //
  // > jQuery.param.querystring( url, params [, merge_mode ] );
  //
  // Arguments:
  //
  //  url - (String) A valid URL for params to be merged into. This URL may
  //    contain a query string and/or fragment (hash).
  //  params - (String) A params string or URL containing query string params to
  //    be merged into url.
  //  params - (Object) A params object to be merged into url.
  //  merge_mode - (Number) Merge behavior defaults to 0 if merge_mode is not
  //    specified, and is as-follows:
  //
  //    * 0: params in the params argument will override any query string
  //         params in url.
  //    * 1: any query string params in url will override params in the params
  //         argument.
  //    * 2: params argument will completely replace any query string in url.
  //
  // Returns:
  //
  //  (String) A URL with a urlencoded query string in the format '?a=b&c=d&e=f'.

  // Method: jQuery.param.fragment
  //
  // Retrieve the fragment (hash) from a URL or if no arguments are passed, the
  // current window.location.href.
  //
  // Usage:
  //
  // > jQuery.param.fragment( [ url ] );
  //
  // Arguments:
  //
  //  url - (String) A URL containing fragment (hash) params to be parsed. If
  //    url is not passed, the current window.location.href is used.
  //
  // Returns:
  //
  //  (String) The parsed fragment (hash) string, with any leading "#" removed.

  // Method: jQuery.param.fragment (build url)
  //
  // Merge a URL, with or without pre-existing fragment (hash) params, plus any
  // object, params string or URL containing fragment (hash) params into a new
  // URL.
  //
  // Usage:
  //
  // > jQuery.param.fragment( url, params [, merge_mode ] );
  //
  // Arguments:
  //
  //  url - (String) A valid URL for params to be merged into. This URL may
  //    contain a query string and/or fragment (hash).
  //  params - (String) A params string or URL containing fragment (hash) params
  //    to be merged into url.
  //  params - (Object) A params object to be merged into url.
  //  merge_mode - (Number) Merge behavior defaults to 0 if merge_mode is not
  //    specified, and is as-follows:
  //
  //    * 0: params in the params argument will override any fragment (hash)
  //         params in url.
  //    * 1: any fragment (hash) params in url will override params in the
  //         params argument.
  //    * 2: params argument will completely replace any query string in url.
  //
  // Returns:
  //
  //  (String) A URL with a urlencoded fragment (hash) in the format '#a=b&c=d&e=f'.

  function jq_param_sub( is_fragment, get_func, url, params, merge_mode ) {
    var result,
      qs,
      matches,
      url_params,
      hash;

    if ( params !== undefined ) {
      // Build URL by merging params into url string.

      // matches[1] = url part that precedes params, not including trailing ?/#
      // matches[2] = params, not including leading ?/#
      // matches[3] = if in 'querystring' mode, hash including leading #, otherwise ''
      matches = url.match( is_fragment ? re_fragment : /^([^#?]*)\??([^#]*)(#?.*)/ );

      // Get the hash if in 'querystring' mode, and it exists.
      hash = matches[3] || '';

      if ( merge_mode === 2 && is_string( params ) ) {
        // If merge_mode is 2 and params is a string, merge the fragment / query
        // string into the URL wholesale, without converting it into an object.
        qs = params.replace( is_fragment ? re_params_fragment : re_params_querystring, '' );

      } else {
        // Convert relevant params in url to object.
        url_params = jq_deparam( matches[2] );

        params = is_string( params )

          // Convert passed params string into object.
          ? jq_deparam[ is_fragment ? str_fragment : str_querystring ]( params )

          // Passed params object.
          : params;

        qs = merge_mode === 2 ? params                              // passed params replace url params
          : merge_mode === 1  ? $.extend( {}, params, url_params )  // url params override passed params
          : $.extend( {}, url_params, params );                     // passed params override url params

        // Convert params object into a sorted params string.
        qs = jq_param_sorted( qs );

        // Unescape characters specified via $.param.noEscape. Since only hash-
        // history users have requested this feature, it's only enabled for
        // fragment-related params strings.
        if ( is_fragment ) {
          qs = qs.replace( re_no_escape, decode );
        }
      }

      // Build URL from the base url, querystring and hash. In 'querystring'
      // mode, ? is only added if a query string exists. In 'fragment' mode, #
      // is always added.
      result = matches[1] + ( is_fragment ? fragment_prefix : qs || !matches[1] ? '?' : '' ) + qs + hash;

    } else {
      // If URL was passed in, parse params from URL string, otherwise parse
      // params from window.location.href.
      result = get_func( url !== undefined ? url : location.href );
    }

    return result;
  };

  jq_param[ str_querystring ]                  = curry( jq_param_sub, 0, get_querystring );
  jq_param[ str_fragment ] = jq_param_fragment = curry( jq_param_sub, 1, get_fragment );

  // Method: jQuery.param.sorted
  //
  // Returns a params string equivalent to that returned by the internal
  // jQuery.param method, but sorted, which makes it suitable for use as a
  // cache key.
  //
  // For example, in most browsers jQuery.param({z:1,a:2}) returns "z=1&a=2"
  // and jQuery.param({a:2,z:1}) returns "a=2&z=1". Even though both the
  // objects being serialized and the resulting params strings are equivalent,
  // if these params strings were set into the location.hash fragment
  // sequentially, the hashchange event would be triggered unnecessarily, since
  // the strings are different (even though the data described by them is the
  // same). By sorting the params string, unecessary hashchange event triggering
  // can be avoided.
  //
  // Usage:
  //
  // > jQuery.param.sorted( obj [, traditional ] );
  //
  // Arguments:
  //
  //  obj - (Object) An object to be serialized.
  //  traditional - (Boolean) Params deep/shallow serialization mode. See the
  //    documentation at http://api.jquery.com/jQuery.param/ for more detail.
  //
  // Returns:
  //
  //  (String) A sorted params string.

  jq_param.sorted = jq_param_sorted = function( a, traditional ) {
    var arr = [],
      obj = {};

    $.each( jq_param( a, traditional ).split( '&' ), function(i,v){
      var key = v.replace( /(?:%5B|=).*$/, '' ),
        key_obj = obj[ key ];

      if ( !key_obj ) {
        key_obj = obj[ key ] = [];
        arr.push( key );
      }

      key_obj.push( v );
    });

    return $.map( arr.sort(), function(v){
      return obj[ v ];
    }).join( '&' );
  };

  // Method: jQuery.param.fragment.noEscape
  //
  // Specify characters that will be left unescaped when fragments are created
  // or merged using <jQuery.param.fragment>, or when the fragment is modified
  // using <jQuery.bbq.pushState>. This option only applies to serialized data
  // object fragments, and not set-as-string fragments. Does not affect the
  // query string. Defaults to ",/" (comma, forward slash).
  //
  // Note that this is considered a purely aesthetic option, and will help to
  // create URLs that "look pretty" in the address bar or bookmarks, without
  // affecting functionality in any way. That being said, be careful to not
  // unescape characters that are used as delimiters or serve a special
  // purpose, such as the "#?&=+" (octothorpe, question mark, ampersand,
  // equals, plus) characters.
  //
  // Usage:
  //
  // > jQuery.param.fragment.noEscape( [ chars ] );
  //
  // Arguments:
  //
  //  chars - (String) The characters to not escape in the fragment. If
  //    unspecified, defaults to empty string (escape all characters).
  //
  // Returns:
  //
  //  Nothing.

  jq_param_fragment.noEscape = function( chars ) {
    chars = chars || '';
    var arr = $.map( chars.split(''), encodeURIComponent );
    re_no_escape = new RegExp( arr.join('|'), 'g' );
  };

  // A sensible default. These are the characters people seem to complain about
  // "uglifying up the URL" the most.
  jq_param_fragment.noEscape( ',/' );

  // Method: jQuery.param.fragment.ajaxCrawlable
  //
  // TODO: DESCRIBE
  //
  // Usage:
  //
  // > jQuery.param.fragment.ajaxCrawlable( [ state ] );
  //
  // Arguments:
  //
  //  state - (Boolean) TODO: DESCRIBE
  //
  // Returns:
  //
  //  (Boolean) The current ajaxCrawlable state.

  jq_param_fragment.ajaxCrawlable = function( state ) {
    if ( state !== undefined ) {
      if ( state ) {
        re_params_fragment = /^.*(?:#!|#)/;
        re_fragment = /^([^#]*)(?:#!|#)?(.*)$/;
        fragment_prefix = '#!';
      } else {
        re_params_fragment = /^.*#/;
        re_fragment = /^([^#]*)#?(.*)$/;
        fragment_prefix = '#';
      }
      ajax_crawlable = !!state;
    }

    return ajax_crawlable;
  };

  jq_param_fragment.ajaxCrawlable( 0 );

  // Section: Deparam (from string)
  //
  // Method: jQuery.deparam
  //
  // Deserialize a params string into an object, optionally coercing numbers,
  // booleans, null and undefined values; this method is the counterpart to the
  // internal jQuery.param method.
  //
  // Usage:
  //
  // > jQuery.deparam( params [, coerce ] );
  //
  // Arguments:
  //
  //  params - (String) A params string to be parsed.
  //  coerce - (Boolean) If true, coerces any numbers or true, false, null, and
  //    undefined to their actual value. Defaults to false if omitted.
  //
  // Returns:
  //
  //  (Object) An object representing the deserialized params string.

  $.deparam = jq_deparam = function( params, coerce ) {
    var obj = {},
      coerce_types = { 'true': !0, 'false': !1, 'null': null };

    // Iterate over all name=value pairs.
    $.each( params.replace( /\+/g, ' ' ).split( '&' ), function(j,v){
      var param = v.split( '=' ),
        key = decode( param[0] ),
        val,
        cur = obj,
        i = 0,

        // If key is more complex than 'foo', like 'a[]' or 'a[b][c]', split it
        // into its component parts.
        keys = key.split( '][' ),
        keys_last = keys.length - 1;

      // If the first keys part contains [ and the last ends with ], then []
      // are correctly balanced.
      if ( /\[/.test( keys[0] ) && /\]$/.test( keys[ keys_last ] ) ) {
        // Remove the trailing ] from the last keys part.
        keys[ keys_last ] = keys[ keys_last ].replace( /\]$/, '' );

        // Split first keys part into two parts on the [ and add them back onto
        // the beginning of the keys array.
        keys = keys.shift().split('[').concat( keys );

        keys_last = keys.length - 1;
      } else {
        // Basic 'foo' style key.
        keys_last = 0;
      }

      // Are we dealing with a name=value pair, or just a name?
      if ( param.length === 2 ) {
        val = decode( param[1] );

        // Coerce values.
        if ( coerce ) {
          val = val && !isNaN(val)            ? +val              // number
            : val === 'undefined'             ? undefined         // undefined
            : coerce_types[val] !== undefined ? coerce_types[val] // true, false, null
            : val;                                                // string
        }

        if ( keys_last ) {
          // Complex key, build deep object structure based on a few rules:
          // * The 'cur' pointer starts at the object top-level.
          // * [] = array push (n is set to array length), [n] = array if n is
          //   numeric, otherwise object.
          // * If at the last keys part, set the value.
          // * For each keys part, if the current level is undefined create an
          //   object or array based on the type of the next keys part.
          // * Move the 'cur' pointer to the next level.
          // * Rinse & repeat.
          for ( ; i <= keys_last; i++ ) {
            key = keys[i] === '' ? cur.length : keys[i];
            cur = cur[key] = i < keys_last
              ? cur[key] || ( keys[i+1] && isNaN( keys[i+1] ) ? {} : [] )
              : val;
          }

        } else {
          // Simple key, even simpler rules, since only scalars and shallow
          // arrays are allowed.

          if ( $.isArray( obj[key] ) ) {
            // val is already an array, so push on the next value.
            obj[key].push( val );

          } else if ( obj[key] !== undefined ) {
            // val isn't an array, but since a second value has been specified,
            // convert val into an array.
            obj[key] = [ obj[key], val ];

          } else {
            // val is a scalar.
            obj[key] = val;
          }
        }

      } else if ( key ) {
        // No value was defined, so set something meaningful.
        obj[key] = coerce
          ? undefined
          : '';
      }
    });

    return obj;
  };

  // Method: jQuery.deparam.querystring
  //
  // Parse the query string from a URL or the current window.location.href,
  // deserializing it into an object, optionally coercing numbers, booleans,
  // null and undefined values.
  //
  // Usage:
  //
  // > jQuery.deparam.querystring( [ url ] [, coerce ] );
  //
  // Arguments:
  //
  //  url - (String) An optional params string or URL containing query string
  //    params to be parsed. If url is omitted, the current
  //    window.location.href is used.
  //  coerce - (Boolean) If true, coerces any numbers or true, false, null, and
  //    undefined to their actual value. Defaults to false if omitted.
  //
  // Returns:
  //
  //  (Object) An object representing the deserialized params string.

  // Method: jQuery.deparam.fragment
  //
  // Parse the fragment (hash) from a URL or the current window.location.href,
  // deserializing it into an object, optionally coercing numbers, booleans,
  // null and undefined values.
  //
  // Usage:
  //
  // > jQuery.deparam.fragment( [ url ] [, coerce ] );
  //
  // Arguments:
  //
  //  url - (String) An optional params string or URL containing fragment (hash)
  //    params to be parsed. If url is omitted, the current window.location.href
  //    is used.
  //  coerce - (Boolean) If true, coerces any numbers or true, false, null, and
  //    undefined to their actual value. Defaults to false if omitted.
  //
  // Returns:
  //
  //  (Object) An object representing the deserialized params string.

  function jq_deparam_sub( is_fragment, url_or_params, coerce ) {
    if ( url_or_params === undefined || typeof url_or_params === 'boolean' ) {
      // url_or_params not specified.
      coerce = url_or_params;
      url_or_params = jq_param[ is_fragment ? str_fragment : str_querystring ]();
    } else {
      url_or_params = is_string( url_or_params )
        ? url_or_params.replace( is_fragment ? re_params_fragment : re_params_querystring, '' )
        : url_or_params;
    }

    return jq_deparam( url_or_params, coerce );
  };

  jq_deparam[ str_querystring ]                    = curry( jq_deparam_sub, 0 );
  jq_deparam[ str_fragment ] = jq_deparam_fragment = curry( jq_deparam_sub, 1 );

  // Section: Element manipulation
  //
  // Method: jQuery.elemUrlAttr
  //
  // Get the internal "Default URL attribute per tag" list, or augment the list
  // with additional tag-attribute pairs, in case the defaults are insufficient.
  //
  // In the <jQuery.fn.querystring> and <jQuery.fn.fragment> methods, this list
  // is used to determine which attribute contains the URL to be modified, if
  // an "attr" param is not specified.
  //
  // Default Tag-Attribute List:
  //
  //  a      - href
  //  base   - href
  //  iframe - src
  //  img    - src
  //  input  - src
  //  form   - action
  //  link   - href
  //  script - src
  //
  // Usage:
  //
  // > jQuery.elemUrlAttr( [ tag_attr ] );
  //
  // Arguments:
  //
  //  tag_attr - (Object) An object containing a list of tag names and their
  //    associated default attribute names in the format { tag: 'attr', ... } to
  //    be merged into the internal tag-attribute list.
  //
  // Returns:
  //
  //  (Object) An object containing all stored tag-attribute values.

  // Only define function and set defaults if function doesn't already exist, as
  // the urlInternal plugin will provide this method as well.
  $[ str_elemUrlAttr ] || ($[ str_elemUrlAttr ] = function( obj ) {
    return $.extend( elemUrlAttr_cache, obj );
  })({
    a: str_href,
    base: str_href,
    iframe: str_src,
    img: str_src,
    input: str_src,
    form: 'action',
    link: str_href,
    script: str_src
  });

  jq_elemUrlAttr = $[ str_elemUrlAttr ];

  // Method: jQuery.fn.querystring
  //
  // Update URL attribute in one or more elements, merging the current URL (with
  // or without pre-existing query string params) plus any params object or
  // string into a new URL, which is then set into that attribute. Like
  // <jQuery.param.querystring (build url)>, but for all elements in a jQuery
  // collection.
  //
  // Usage:
  //
  // > jQuery('selector').querystring( [ attr, ] params [, merge_mode ] );
  //
  // Arguments:
  //
  //  attr - (String) Optional name of an attribute that will contain a URL to
  //    merge params or url into. See <jQuery.elemUrlAttr> for a list of default
  //    attributes.
  //  params - (Object) A params object to be merged into the URL attribute.
  //  params - (String) A URL containing query string params, or params string
  //    to be merged into the URL attribute.
  //  merge_mode - (Number) Merge behavior defaults to 0 if merge_mode is not
  //    specified, and is as-follows:
  //
  //    * 0: params in the params argument will override any params in attr URL.
  //    * 1: any params in attr URL will override params in the params argument.
  //    * 2: params argument will completely replace any query string in attr
  //         URL.
  //
  // Returns:
  //
  //  (jQuery) The initial jQuery collection of elements, but with modified URL
  //  attribute values.

  // Method: jQuery.fn.fragment
  //
  // Update URL attribute in one or more elements, merging the current URL (with
  // or without pre-existing fragment/hash params) plus any params object or
  // string into a new URL, which is then set into that attribute. Like
  // <jQuery.param.fragment (build url)>, but for all elements in a jQuery
  // collection.
  //
  // Usage:
  //
  // > jQuery('selector').fragment( [ attr, ] params [, merge_mode ] );
  //
  // Arguments:
  //
  //  attr - (String) Optional name of an attribute that will contain a URL to
  //    merge params into. See <jQuery.elemUrlAttr> for a list of default
  //    attributes.
  //  params - (Object) A params object to be merged into the URL attribute.
  //  params - (String) A URL containing fragment (hash) params, or params
  //    string to be merged into the URL attribute.
  //  merge_mode - (Number) Merge behavior defaults to 0 if merge_mode is not
  //    specified, and is as-follows:
  //
  //    * 0: params in the params argument will override any params in attr URL.
  //    * 1: any params in attr URL will override params in the params argument.
  //    * 2: params argument will completely replace any fragment (hash) in attr
  //         URL.
  //
  // Returns:
  //
  //  (jQuery) The initial jQuery collection of elements, but with modified URL
  //  attribute values.

  function jq_fn_sub( mode, force_attr, params, merge_mode ) {
    if ( !is_string( params ) && typeof params !== 'object' ) {
      // force_attr not specified.
      merge_mode = params;
      params = force_attr;
      force_attr = undefined;
    }

    return this.each(function(){
      var that = $(this),

        // Get attribute specified, or default specified via $.elemUrlAttr.
        attr = force_attr || jq_elemUrlAttr()[ ( this.nodeName || '' ).toLowerCase() ] || '',

        // Get URL value.
        url = attr && that.attr( attr ) || '';

      // Update attribute with new URL.
      that.attr( attr, jq_param[ mode ]( url, params, merge_mode ) );
    });

  };

  $.fn[ str_querystring ] = curry( jq_fn_sub, str_querystring );
  $.fn[ str_fragment ]    = curry( jq_fn_sub, str_fragment );

  // Section: History, hashchange event
  //
  // Method: jQuery.bbq.pushState
  //
  // Adds a 'state' into the browser history at the current position, setting
  // location.hash and triggering any bound <hashchange event> callbacks
  // (provided the new state is different than the previous state).
  //
  // If no arguments are passed, an empty state is created, which is just a
  // shortcut for jQuery.bbq.pushState( {}, 2 ).
  //
  // Usage:
  //
  // > jQuery.bbq.pushState( [ params [, merge_mode ] ] );
  //
  // Arguments:
  //
  //  params - (String) A serialized params string or a hash string beginning
  //    with # to merge into location.hash.
  //  params - (Object) A params object to merge into location.hash.
  //  merge_mode - (Number) Merge behavior defaults to 0 if merge_mode is not
  //    specified (unless a hash string beginning with # is specified, in which
  //    case merge behavior defaults to 2), and is as-follows:
  //
  //    * 0: params in the params argument will override any params in the
  //         current state.
  //    * 1: any params in the current state will override params in the params
  //         argument.
  //    * 2: params argument will completely replace current state.
  //
  // Returns:
  //
  //  Nothing.
  //
  // Additional Notes:
  //
  //  * Setting an empty state may cause the browser to scroll.
  //  * Unlike the fragment and querystring methods, if a hash string beginning
  //    with # is specified as the params agrument, merge_mode defaults to 2.

  jq_bbq.pushState = jq_bbq_pushState = function( params, merge_mode ) {
    if ( is_string( params ) && /^#/.test( params ) && merge_mode === undefined ) {
      // Params string begins with # and merge_mode not specified, so completely
      // overwrite window.location.hash.
      merge_mode = 2;
    }

    var has_args = params !== undefined,
      // Merge params into window.location using $.param.fragment.
      url = jq_param_fragment( location.href,
        has_args ? params : {}, has_args ? merge_mode : 2 );

    // Set new window.location.href. Note that Safari 3 & Chrome barf on
    // location.hash = '#' so the entire URL is set.
    location.href = url;
  };

  // Method: jQuery.bbq.getState
  //
  // Retrieves the current 'state' from the browser history, parsing
  // location.hash for a specific key or returning an object containing the
  // entire state, optionally coercing numbers, booleans, null and undefined
  // values.
  //
  // Usage:
  //
  // > jQuery.bbq.getState( [ key ] [, coerce ] );
  //
  // Arguments:
  //
  //  key - (String) An optional state key for which to return a value.
  //  coerce - (Boolean) If true, coerces any numbers or true, false, null, and
  //    undefined to their actual value. Defaults to false.
  //
  // Returns:
  //
  //  (Anything) If key is passed, returns the value corresponding with that key
  //    in the location.hash 'state', or undefined. If not, an object
  //    representing the entire 'state' is returned.

  jq_bbq.getState = jq_bbq_getState = function( key, coerce ) {
    return key === undefined || typeof key === 'boolean'
      ? jq_deparam_fragment( key ) // 'key' really means 'coerce' here
      : jq_deparam_fragment( coerce )[ key ];
  };

  // Method: jQuery.bbq.removeState
  //
  // Remove one or more keys from the current browser history 'state', creating
  // a new state, setting location.hash and triggering any bound
  // <hashchange event> callbacks (provided the new state is different than
  // the previous state).
  //
  // If no arguments are passed, an empty state is created, which is just a
  // shortcut for jQuery.bbq.pushState( {}, 2 ).
  //
  // Usage:
  //
  // > jQuery.bbq.removeState( [ key [, key ... ] ] );
  //
  // Arguments:
  //
  //  key - (String) One or more key values to remove from the current state,
  //    passed as individual arguments.
  //  key - (Array) A single array argument that contains a list of key values
  //    to remove from the current state.
  //
  // Returns:
  //
  //  Nothing.
  //
  // Additional Notes:
  //
  //  * Setting an empty state may cause the browser to scroll.

  jq_bbq.removeState = function( arr ) {
    var state = {};

    // If one or more arguments is passed..
    if ( arr !== undefined ) {

      // Get the current state.
      state = jq_bbq_getState();

      // For each passed key, delete the corresponding property from the current
      // state.
      $.each( $.isArray( arr ) ? arr : arguments, function(i,v){
        delete state[ v ];
      });
    }

    // Set the state, completely overriding any existing state.
    jq_bbq_pushState( state, 2 );
  };

  // Event: hashchange event (BBQ)
  //
  // Usage in jQuery 1.4 and newer:
  //
  // In jQuery 1.4 and newer, the event object passed into any hashchange event
  // callback is augmented with a copy of the location.hash fragment at the time
  // the event was triggered as its event.fragment property. In addition, the
  // event.getState method operates on this property (instead of location.hash)
  // which allows this fragment-as-a-state to be referenced later, even after
  // window.location may have changed.
  //
  // Note that event.fragment and event.getState are not defined according to
  // W3C (or any other) specification, but will still be available whether or
  // not the hashchange event exists natively in the browser, because of the
  // utility they provide.
  //
  // The event.fragment property contains the output of <jQuery.param.fragment>
  // and the event.getState method is equivalent to the <jQuery.bbq.getState>
  // method.
  //
  // > $(window).bind( 'hashchange', function( event ) {
  // >   var hash_str = event.fragment,
  // >     param_obj = event.getState(),
  // >     param_val = event.getState( 'param_name' ),
  // >     param_val_coerced = event.getState( 'param_name', true );
  // >   ...
  // > });
  //
  // Usage in jQuery 1.3.2:
  //
  // In jQuery 1.3.2, the event object cannot to be augmented as in jQuery 1.4+,
  // so the fragment state isn't bound to the event object and must instead be
  // parsed using the <jQuery.param.fragment> and <jQuery.bbq.getState> methods.
  //
  // > $(window).bind( 'hashchange', function( event ) {
  // >   var hash_str = $.param.fragment(),
  // >     param_obj = $.bbq.getState(),
  // >     param_val = $.bbq.getState( 'param_name' ),
  // >     param_val_coerced = $.bbq.getState( 'param_name', true );
  // >   ...
  // > });
  //
  // Additional Notes:
  //
  // * Due to changes in the special events API, jQuery BBQ v1.2 or newer is
  //   required to enable the augmented event object in jQuery 1.4.2 and newer.
  // * See <jQuery hashchange event> for more detailed information.

  special[ str_hashchange ] = $.extend( special[ str_hashchange ], {

    // Augmenting the event object with the .fragment property and .getState
    // method requires jQuery 1.4 or newer. Note: with 1.3.2, everything will
    // work, but the event won't be augmented)
    add: function( handleObj ) {
      var old_handler;

      function new_handler(e) {
        // e.fragment is set to the value of location.hash (with any leading #
        // removed) at the time the event is triggered.
        var hash = e[ str_fragment ] = jq_param_fragment();

        // e.getState() works just like $.bbq.getState(), but uses the
        // e.fragment property stored on the event object.
        e.getState = function( key, coerce ) {
          return key === undefined || typeof key === 'boolean'
            ? jq_deparam( hash, key ) // 'key' really means 'coerce' here
            : jq_deparam( hash, coerce )[ key ];
        };

        old_handler.apply( this, arguments );
      };

      // This may seem a little complicated, but it normalizes the special event
      // .add method between jQuery 1.4/1.4.1 and 1.4.2+
      if ( $.isFunction( handleObj ) ) {
        // 1.4, 1.4.1
        old_handler = handleObj;
        return new_handler;
      } else {
        // 1.4.2+
        old_handler = handleObj.handler;
        handleObj.handler = new_handler;
      }
    }

  });

})(jQuery,this);

/*!
 * jQuery hashchange event - v1.3 - 7/21/2010
 * http://benalman.com/projects/jquery-hashchange-plugin/
 *
 * Copyright (c) 2010 "Cowboy" Ben Alman
 * Dual licensed under the MIT and GPL licenses.
 * http://benalman.com/about/license/
 */

// Script: jQuery hashchange event
//
// *Version: 1.3, Last updated: 7/21/2010*
//
// Project Home - http://benalman.com/projects/jquery-hashchange-plugin/
// GitHub       - http://github.com/cowboy/jquery-hashchange/
// Source       - http://github.com/cowboy/jquery-hashchange/raw/master/jquery.ba-hashchange.js
// (Minified)   - http://github.com/cowboy/jquery-hashchange/raw/master/jquery.ba-hashchange.min.js (0.8kb gzipped)
//
// About: License
//
// Copyright (c) 2010 "Cowboy" Ben Alman,
// Dual licensed under the MIT and GPL licenses.
// http://benalman.com/about/license/
//
// About: Examples
//
// These working examples, complete with fully commented code, illustrate a few
// ways in which this plugin can be used.
//
// hashchange event - http://benalman.com/code/projects/jquery-hashchange/examples/hashchange/
// document.domain - http://benalman.com/code/projects/jquery-hashchange/examples/document_domain/
//
// About: Support and Testing
//
// Information about what version or versions of jQuery this plugin has been
// tested with, what browsers it has been tested in, and where the unit tests
// reside (so you can test it yourself).
//
// jQuery Versions - 1.2.6, 1.3.2, 1.4.1, 1.4.2
// Browsers Tested - Internet Explorer 6-8, Firefox 2-4, Chrome 5-6, Safari 3.2-5,
//                   Opera 9.6-10.60, iPhone 3.1, Android 1.6-2.2, BlackBerry 4.6-5.
// Unit Tests      - http://benalman.com/code/projects/jquery-hashchange/unit/
//
// About: Known issues
//
// While this jQuery hashchange event implementation is quite stable and
// robust, there are a few unfortunate browser bugs surrounding expected
// hashchange event-based behaviors, independent of any JavaScript
// window.onhashchange abstraction. See the following examples for more
// information:
//
// Chrome: Back Button - http://benalman.com/code/projects/jquery-hashchange/examples/bug-chrome-back-button/
// Firefox: Remote XMLHttpRequest - http://benalman.com/code/projects/jquery-hashchange/examples/bug-firefox-remote-xhr/
// WebKit: Back Button in an Iframe - http://benalman.com/code/projects/jquery-hashchange/examples/bug-webkit-hash-iframe/
// Safari: Back Button from a different domain - http://benalman.com/code/projects/jquery-hashchange/examples/bug-safari-back-from-diff-domain/
//
// Also note that should a browser natively support the window.onhashchange
// event, but not report that it does, the fallback polling loop will be used.
//
// About: Release History
//
// 1.3   - (7/21/2010) Reorganized IE6/7 Iframe code to make it more
//         "removable" for mobile-only development. Added IE6/7 document.title
//         support. Attempted to make Iframe as hidden as possible by using
//         techniques from http://www.paciellogroup.com/blog/?p=604. Added
//         support for the "shortcut" format $(window).hashchange( fn ) and
//         $(window).hashchange() like jQuery provides for built-in events.
//         Renamed jQuery.hashchangeDelay to <jQuery.fn.hashchange.delay> and
//         lowered its default value to 50. Added <jQuery.fn.hashchange.domain>
//         and <jQuery.fn.hashchange.src> properties plus document-domain.html
//         file to address access denied issues when setting document.domain in
//         IE6/7.
// 1.2   - (2/11/2010) Fixed a bug where coming back to a page using this plugin
//         from a page on another domain would cause an error in Safari 4. Also,
//         IE6/7 Iframe is now inserted after the body (this actually works),
//         which prevents the page from scrolling when the event is first bound.
//         Event can also now be bound before DOM ready, but it won't be usable
//         before then in IE6/7.
// 1.1   - (1/21/2010) Incorporated document.documentMode test to fix IE8 bug
//         where browser version is incorrectly reported as 8.0, despite
//         inclusion of the X-UA-Compatible IE=EmulateIE7 meta tag.
// 1.0   - (1/9/2010) Initial Release. Broke out the jQuery BBQ event.special
//         window.onhashchange functionality into a separate plugin for users
//         who want just the basic event & back button support, without all the
//         extra awesomeness that BBQ provides. This plugin will be included as
//         part of jQuery BBQ, but also be available separately.

(function($,window,undefined){
  '$:nomunge'; // Used by YUI compressor.

  // Reused string.
  var str_hashchange = 'hashchange',

    // Method / object references.
    doc = document,
    fake_onhashchange,
    special = $.event.special,

    // Does the browser support window.onhashchange? Note that IE8 running in
    // IE7 compatibility mode reports true for 'onhashchange' in window, even
    // though the event isn't supported, so also test document.documentMode.
    doc_mode = doc.documentMode,
    supports_onhashchange = 'on' + str_hashchange in window && ( doc_mode === undefined || doc_mode > 7 );

  // Get location.hash (or what you'd expect location.hash to be) sans any
  // leading #. Thanks for making this necessary, Firefox!
  function get_fragment( url ) {
    url = url || location.href;
    return '#' + url.replace( /^[^#]*#?(.*)$/, '$1' );
  };

  // Method: jQuery.fn.hashchange
  //
  // Bind a handler to the window.onhashchange event or trigger all bound
  // window.onhashchange event handlers. This behavior is consistent with
  // jQuery's built-in event handlers.
  //
  // Usage:
  //
  // > jQuery(window).hashchange( [ handler ] );
  //
  // Arguments:
  //
  //  handler - (Function) Optional handler to be bound to the hashchange
  //    event. This is a "shortcut" for the more verbose form:
  //    jQuery(window).bind( 'hashchange', handler ). If handler is omitted,
  //    all bound window.onhashchange event handlers will be triggered. This
  //    is a shortcut for the more verbose
  //    jQuery(window).trigger( 'hashchange' ). These forms are described in
  //    the <hashchange event> section.
  //
  // Returns:
  //
  //  (jQuery) The initial jQuery collection of elements.

  // Allow the "shortcut" format $(elem).hashchange( fn ) for binding and
  // $(elem).hashchange() for triggering, like jQuery does for built-in events.
  $.fn[ str_hashchange ] = function( fn ) {
    return fn ? this.bind( str_hashchange, fn ) : this.trigger( str_hashchange );
  };

  // Property: jQuery.fn.hashchange.delay
  //
  // The numeric interval (in milliseconds) at which the <hashchange event>
  // polling loop executes. Defaults to 50.

  // Property: jQuery.fn.hashchange.domain
  //
  // If you're setting document.domain in your JavaScript, and you want hash
  // history to work in IE6/7, not only must this property be set, but you must
  // also set document.domain BEFORE jQuery is loaded into the page. This
  // property is only applicable if you are supporting IE6/7 (or IE8 operating
  // in "IE7 compatibility" mode).
  //
  // In addition, the <jQuery.fn.hashchange.src> property must be set to the
  // path of the included "document-domain.html" file, which can be renamed or
  // modified if necessary (note that the document.domain specified must be the
  // same in both your main JavaScript as well as in this file).
  //
  // Usage:
  //
  // jQuery.fn.hashchange.domain = document.domain;

  // Property: jQuery.fn.hashchange.src
  //
  // If, for some reason, you need to specify an Iframe src file (for example,
  // when setting document.domain as in <jQuery.fn.hashchange.domain>), you can
  // do so using this property. Note that when using this property, history
  // won't be recorded in IE6/7 until the Iframe src file loads. This property
  // is only applicable if you are supporting IE6/7 (or IE8 operating in "IE7
  // compatibility" mode).
  //
  // Usage:
  //
  // jQuery.fn.hashchange.src = 'path/to/file.html';

  $.fn[ str_hashchange ].delay = 50;
  /*
  $.fn[ str_hashchange ].domain = null;
  $.fn[ str_hashchange ].src = null;
  */

  // Event: hashchange event
  //
  // Fired when location.hash changes. In browsers that support it, the native
  // HTML5 window.onhashchange event is used, otherwise a polling loop is
  // initialized, running every <jQuery.fn.hashchange.delay> milliseconds to
  // see if the hash has changed. In IE6/7 (and IE8 operating in "IE7
  // compatibility" mode), a hidden Iframe is created to allow the back button
  // and hash-based history to work.
  //
  // Usage as described in <jQuery.fn.hashchange>:
  //
  // > // Bind an event handler.
  // > jQuery(window).hashchange( function(e) {
  // >   var hash = location.hash;
  // >   ...
  // > });
  // >
  // > // Manually trigger the event handler.
  // > jQuery(window).hashchange();
  //
  // A more verbose usage that allows for event namespacing:
  //
  // > // Bind an event handler.
  // > jQuery(window).bind( 'hashchange', function(e) {
  // >   var hash = location.hash;
  // >   ...
  // > });
  // >
  // > // Manually trigger the event handler.
  // > jQuery(window).trigger( 'hashchange' );
  //
  // Additional Notes:
  //
  // * The polling loop and Iframe are not created until at least one handler
  //   is actually bound to the 'hashchange' event.
  // * If you need the bound handler(s) to execute immediately, in cases where
  //   a location.hash exists on page load, via bookmark or page refresh for
  //   example, use jQuery(window).hashchange() or the more verbose
  //   jQuery(window).trigger( 'hashchange' ).
  // * The event can be bound before DOM ready, but since it won't be usable
  //   before then in IE6/7 (due to the necessary Iframe), recommended usage is
  //   to bind it inside a DOM ready handler.

  // Override existing $.event.special.hashchange methods (allowing this plugin
  // to be defined after jQuery BBQ in BBQ's source code).
  special[ str_hashchange ] = $.extend( special[ str_hashchange ], {

    // Called only when the first 'hashchange' event is bound to window.
    setup: function() {
      // If window.onhashchange is supported natively, there's nothing to do..
      if ( supports_onhashchange ) { return false; }

      // Otherwise, we need to create our own. And we don't want to call this
      // until the user binds to the event, just in case they never do, since it
      // will create a polling loop and possibly even a hidden Iframe.
      $( fake_onhashchange.start );
    },

    // Called only when the last 'hashchange' event is unbound from window.
    teardown: function() {
      // If window.onhashchange is supported natively, there's nothing to do..
      if ( supports_onhashchange ) { return false; }

      // Otherwise, we need to stop ours (if possible).
      $( fake_onhashchange.stop );
    }

  });

  // fake_onhashchange does all the work of triggering the window.onhashchange
  // event for browsers that don't natively support it, including creating a
  // polling loop to watch for hash changes and in IE 6/7 creating a hidden
  // Iframe to enable back and forward.
  fake_onhashchange = (function(){
    var self = {},
      timeout_id,

      // Remember the initial hash so it doesn't get triggered immediately.
      last_hash = get_fragment(),

      fn_retval = function(val){ return val; },
      history_set = fn_retval,
      history_get = fn_retval;

    // Start the polling loop.
    self.start = function() {
      timeout_id || poll();
    };

    // Stop the polling loop.
    self.stop = function() {
      timeout_id && clearTimeout( timeout_id );
      timeout_id = undefined;
    };

    // This polling loop checks every $.fn.hashchange.delay milliseconds to see
    // if location.hash has changed, and triggers the 'hashchange' event on
    // window when necessary.
    function poll() {
      var hash = get_fragment(),
        history_hash = history_get( last_hash );

      if ( hash !== last_hash ) {
        history_set( last_hash = hash, history_hash );

        $(window).trigger( str_hashchange );

      } else if ( history_hash !== last_hash ) {
        location.href = location.href.replace( /#.*/, '' ) + history_hash;
      }

      timeout_id = setTimeout( poll, $.fn[ str_hashchange ].delay );
    };

    // vvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvv
    // vvvvvvvvvvvvvvvvvvv REMOVE IF NOT SUPPORTING IE6/7/8 vvvvvvvvvvvvvvvvvvv
    // vvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvv
    (/msie|trident/i).test(navigator.userAgent) && !supports_onhashchange && (function(){
      // Not only do IE6/7 need the "magical" Iframe treatment, but so does IE8
      // when running in "IE7 compatibility" mode.

      var iframe,
        iframe_src;

      // When the event is bound and polling starts in IE 6/7, create a hidden
      // Iframe for history handling.
      self.start = function(){
        if ( !iframe ) {
          iframe_src = $.fn[ str_hashchange ].src;
          iframe_src = iframe_src && iframe_src + get_fragment();

          // Create hidden Iframe. Attempt to make Iframe as hidden as possible
          // by using techniques from http://www.paciellogroup.com/blog/?p=604.
          iframe = $('<iframe tabindex="-1" title="empty"/>').hide()

            // When Iframe has completely loaded, initialize the history and
            // start polling.
            .one( 'load', function(){
              iframe_src || history_set( get_fragment() );
              poll();
            })

            // Load Iframe src if specified, otherwise nothing.
            .attr( 'src', iframe_src || 'javascript:0' )

            // Append Iframe after the end of the body to prevent unnecessary
            // initial page scrolling (yes, this works).
            .insertAfter( 'body' )[0].contentWindow;

          // Whenever `document.title` changes, update the Iframe's title to
          // prettify the back/next history menu entries. Since IE sometimes
          // errors with "Unspecified error" the very first time this is set
          // (yes, very useful) wrap this with a try/catch block.
          doc.onpropertychange = function(){
            try {
              if ( event.propertyName === 'title' ) {
                iframe.document.title = doc.title;
              }
            } catch(e) {}
          };

        }
      };

      // Override the "stop" method since an IE6/7 Iframe was created. Even
      // if there are no longer any bound event handlers, the polling loop
      // is still necessary for back/next to work at all!
      self.stop = fn_retval;

      // Get history by looking at the hidden Iframe's location.hash.
      history_get = function() {
        return get_fragment( iframe.location.href );
      };

      // Set a new history item by opening and then closing the Iframe
      // document, *then* setting its location.hash. If document.domain has
      // been set, update that as well.
      history_set = function( hash, history_hash ) {
        var iframe_doc = iframe.document,
          domain = $.fn[ str_hashchange ].domain;

        if ( hash !== history_hash ) {
          // Update Iframe with any initial `document.title` that might be set.
          iframe_doc.title = doc.title;

          // Opening the Iframe's document after it has been closed is what
          // actually adds a history entry.
          iframe_doc.open();

          // Set document.domain for the Iframe document as well, if necessary.
          domain && iframe_doc.write( '<script>document.domain="' + domain + '"</script>' );

          iframe_doc.close();

          // Update the Iframe's hash, for great justice.
          iframe.location.hash = hash;
        }
      };

    })();
    // ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    // ^^^^^^^^^^^^^^^^^^^ REMOVE IF NOT SUPPORTING IE6/7/8 ^^^^^^^^^^^^^^^^^^^
    // ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

    return self;
  })();

})(jQuery,this);

},{}]},{},[19])
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJicmF0Lmh0bWwiLCJjbGllbnQvbGliL2pxdWVyeS11aS5taW4uanMiLCJjbGllbnQvbGliL2pxdWVyeS5qc29uLm1pbi5qcyIsImNsaWVudC9saWIvanF1ZXJ5LnNwcmludGYuanMiLCJjbGllbnQvbGliL2pxdWVyeS5zdmcubWluLmpzIiwiY2xpZW50L2xpYi9qcXVlcnkuc3ZnZG9tLm1pbi5qcyIsImNsaWVudC9saWIvbm9kZS1qcXVlcnktMS43LjEuanMiLCJjbGllbnQvbGliL3dlYmZvbnQuanMiLCJjbGllbnQvc3JjL2FqYXguanMiLCJjbGllbnQvc3JjL2Fubm90YXRvcl91aS5qcyIsImNsaWVudC9zcmMvY29uZmlndXJhdGlvbi5qcyIsImNsaWVudC9zcmMvZGlzcGF0Y2hlci5qcyIsImNsaWVudC9zcmMvbG9jYWxfYWpheC5qcyIsImNsaWVudC9zcmMvc3Bpbm5lci5qcyIsImNsaWVudC9zcmMvdXJsX2hhc2guanMiLCJjbGllbnQvc3JjL3V0aWwuanMiLCJjbGllbnQvc3JjL3Zpc3VhbGl6ZXIuanMiLCJjbGllbnQvc3JjL3Zpc3VhbGl6ZXJfdWkuanMiLCJpbmRleC5qcyIsIm5vZGVfbW9kdWxlcy9qcXVlcnktYmJxL2pxdWVyeS5iYS1iYnEuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7QUNBQTtBQUNBOztBQ0RBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDdHhCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUM5QkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNuRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDTkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDTkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQzFrU0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUM5Q0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQzNKQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ2htRkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDM0JBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3ZJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNuYkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDakNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUM5R0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3RtQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQzVsR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ2h2RUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ2xKQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBIiwiZmlsZSI6ImdlbmVyYXRlZC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24oKXtmdW5jdGlvbiByKGUsbix0KXtmdW5jdGlvbiBvKGksZil7aWYoIW5baV0pe2lmKCFlW2ldKXt2YXIgYz1cImZ1bmN0aW9uXCI9PXR5cGVvZiByZXF1aXJlJiZyZXF1aXJlO2lmKCFmJiZjKXJldHVybiBjKGksITApO2lmKHUpcmV0dXJuIHUoaSwhMCk7dmFyIGE9bmV3IEVycm9yKFwiQ2Fubm90IGZpbmQgbW9kdWxlICdcIitpK1wiJ1wiKTt0aHJvdyBhLmNvZGU9XCJNT0RVTEVfTk9UX0ZPVU5EXCIsYX12YXIgcD1uW2ldPXtleHBvcnRzOnt9fTtlW2ldWzBdLmNhbGwocC5leHBvcnRzLGZ1bmN0aW9uKHIpe3ZhciBuPWVbaV1bMV1bcl07cmV0dXJuIG8obnx8cil9LHAscC5leHBvcnRzLHIsZSxuLHQpfXJldHVybiBuW2ldLmV4cG9ydHN9Zm9yKHZhciB1PVwiZnVuY3Rpb25cIj09dHlwZW9mIHJlcXVpcmUmJnJlcXVpcmUsaT0wO2k8dC5sZW5ndGg7aSsrKW8odFtpXSk7cmV0dXJuIG99cmV0dXJuIHJ9KSgpIiwibW9kdWxlLmV4cG9ydHMgPSBcIjxkaXYgaWQ9XFxcImJyYXQtZnJvbnRlbmQtZWRpdG9yXFxcIj5cXG4gICAgPGRpdiBpZD1cXFwiY29tbWVudHBvcHVwXFxcIj48L2Rpdj5cXG4gICAgPGRpdiBpZD1cXFwic3ZnXFxcIj48L2Rpdj5cXG5cXG4gICAgPCEtLSBTcGFuIGRpYWxvZyAodmlldytlZGl0KSAtLT5cXG4gICAgPGZvcm0gaWQ9XFxcInNwYW5fZm9ybVxcXCIgY2xhc3M9XFxcImRpYWxvZ1xcXCIgdGl0bGU9XFxcIlNwYW5cXFwiPlxcbiAgICAgICAgPCEtLSBTcGFuIGRpYWxvZyBhbm5vdGF0ZWQgdGV4dCAtLT5cXG4gICAgICAgIDxmaWVsZHNldCBpZD1cXFwic3Bhbl9zZWxlY3RlZF9mc2V0XFxcIj5cXG4gICAgICAgICAgICA8bGVnZW5kPlRleHQ8L2xlZ2VuZD5cXG4gICAgICAgICAgICA8YSB0YXJnZXQ9XFxcImJyYXRfbGlua2VkXFxcIiBpZD1cXFwic3Bhbl9oaWdobGlnaHRfbGlua1xcXCIgaHJlZj1cXFwiI1xcXCI+TGluazwvYT5cXG4gICAgICAgICAgICA8ZGl2IGlkPVxcXCJzcGFuX3NlbGVjdGVkXFxcIi8+XFxuICAgICAgICA8L2ZpZWxkc2V0PlxcbiAgICAgICAgPCEtLSBTcGFuIGRpYWxvZyBzZWFyY2ggbGlua3MgLS0+XFxuICAgICAgICA8ZmllbGRzZXQgaWQ9XFxcInNwYW5fc2VhcmNoX2ZpZWxkc2V0XFxcIj5cXG4gICAgICAgICAgICA8bGVnZW5kPlNlYXJjaDwvbGVnZW5kPlxcbiAgICAgICAgICAgIDxkaXYgaWQ9XFxcInNwYW5fc2VhcmNoX2xpbmtzXFxcIi8+XFxuICAgICAgICA8L2ZpZWxkc2V0PlxcbiAgICAgICAgPCEtLSBTcGFuIGRpYWxvZyB0eXBlIHNlbGVjdG9yIC0tPlxcbiAgICAgICAgPGZpZWxkc2V0PlxcbiAgICAgICAgICAgIDxkaXYgaWQ9XFxcImVudGl0eV9hbmRfZXZlbnRfd3JhcHBlclxcXCIgY2xhc3M9XFxcInNwbGl0X3dyYXBwZXJcXFwiPlxcbiAgICAgICAgICAgICAgICA8ZGl2IGlkPVxcXCJzcGFuX2VudGl0eV9zZWN0aW9uXFxcIiBjbGFzcz1cXFwid3JhcHBlcl9oYWxmX2xlZnRcXFwiPlxcbiAgICAgICAgICAgICAgICAgICAgPGRpdiBpZD1cXFwiZW50aXR5X2xhYmVsXFxcIiBjbGFzcz1cXFwibGFiZWwtbGlrZVxcXCI+XFxuICAgICAgICAgICAgICAgICAgICAgICAgRW50aXR5IHR5cGVcXG4gICAgICAgICAgICAgICAgICAgIDwvZGl2PlxcbiAgICAgICAgICAgICAgICAgICAgPGRpdiBpZD1cXFwiZW50aXR5X3R5cGVzXFxcIiBjbGFzcz1cXFwic2Nyb2xsX3dyYXBwZXJfdXBwZXJcXFwiPlxcbiAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9XFxcInNjcm9sbGVyXFxcIj48L2Rpdj5cXG4gICAgICAgICAgICAgICAgICAgIDwvZGl2PlxcbiAgICAgICAgICAgICAgICAgICAgPCEtLSBOT1RFOiB0aGUgYXR0cmlidXRlIGxhYmVscyBtdXN0IGJlICpvdXRzaWRlKiBvZiB0aGVcXG4gICAgICAgICAgICAgICAgICAgICAgICAgZGl2cyB0aGV5IGxvZ2ljYWxseSBiZWxvbmcgdG8gcHJldmVudCBzY3JvbGxlcnNcXG4gICAgICAgICAgICAgICAgICAgICAgICAgb3ZlcmZsb3dpbmcgdGhlbS4gLS0+XFxuICAgICAgICAgICAgICAgICAgICA8ZGl2IGlkPVxcXCJlbnRpdHlfYXR0cmlidXRlX2xhYmVsXFxcIiBjbGFzcz1cXFwibGFiZWwtbGlrZSB3cmFwcGVyX2xvd2VyX2xhYmVsXFxcIj5cXG4gICAgICAgICAgICAgICAgICAgICAgICBFbnRpdHkgYXR0cmlidXRlc1xcbiAgICAgICAgICAgICAgICAgICAgPC9kaXY+XFxuICAgICAgICAgICAgICAgICAgICA8ZGl2IGlkPVxcXCJlbnRpdHlfYXR0cmlidXRlc1xcXCIgY2xhc3M9XFxcInNjcm9sbF93cmFwcGVyX2xvd2VyXFxcIj5cXG4gICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPVxcXCJzY3JvbGxlciBzbWFsbC1idXR0b25zXFxcIj48L2Rpdj5cXG4gICAgICAgICAgICAgICAgICAgIDwvZGl2PlxcbiAgICAgICAgICAgICAgICA8L2Rpdj5cXG4gICAgICAgICAgICAgICAgPGRpdiBpZD1cXFwic3Bhbl9ldmVudF9zZWN0aW9uXFxcIiBjbGFzcz1cXFwid3JhcHBlcl9oYWxmX3JpZ2h0XFxcIj5cXG4gICAgICAgICAgICAgICAgICAgIDxkaXYgaWQ9XFxcImV2ZW50X2xhYmVsXFxcIiBjbGFzcz1cXFwibGFiZWwtbGlrZVxcXCI+XFxuICAgICAgICAgICAgICAgICAgICAgICAgRXZlbnQgdHlwZVxcbiAgICAgICAgICAgICAgICAgICAgPC9kaXY+XFxuICAgICAgICAgICAgICAgICAgICA8ZGl2IGlkPVxcXCJldmVudF90eXBlc1xcXCIgY2xhc3M9XFxcInNjcm9sbF93cmFwcGVyX3VwcGVyXFxcIj5cXG4gICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPVxcXCJzY3JvbGxlclxcXCI+PC9kaXY+XFxuICAgICAgICAgICAgICAgICAgICA8L2Rpdj5cXG4gICAgICAgICAgICAgICAgICAgIDxkaXYgaWQ9XFxcImV2ZW50X2F0dHJpYnV0ZV9sYWJlbFxcXCIgY2xhc3M9XFxcIndyYXBwZXJfbG93ZXJfbGFiZWwgbGFiZWwtbGlrZVxcXCI+XFxuICAgICAgICAgICAgICAgICAgICAgICAgRXZlbnQgYXR0cmlidXRlc1xcbiAgICAgICAgICAgICAgICAgICAgPC9kaXY+XFxuICAgICAgICAgICAgICAgICAgICA8ZGl2IGlkPVxcXCJldmVudF9hdHRyaWJ1dGVzXFxcIiBjbGFzcz1cXFwic2Nyb2xsX3dyYXBwZXJfbG93ZXJcXFwiPlxcbiAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9XFxcInNjcm9sbGVyIHNtYWxsLWJ1dHRvbnNcXFwiPjwvZGl2PlxcbiAgICAgICAgICAgICAgICAgICAgPC9kaXY+XFxuICAgICAgICAgICAgICAgIDwvZGl2PlxcbiAgICAgICAgICAgIDwvZGl2PlxcbiAgICAgICAgPC9maWVsZHNldD5cXG4gICAgICAgIDwhLS0gU3BhbiBkaWFsb2cgbm9ybWFsaXphdGlvbiAtLT5cXG4gICAgICAgIDxmaWVsZHNldCBpZD1cXFwibm9ybV9maWVsZHNldFxcXCI+XFxuICAgICAgICAgICAgPGxlZ2VuZD5Ob3JtYWxpemF0aW9uPC9sZWdlbmQ+XFxuICAgICAgICAgICAgPGRpdiBpZD1cXFwibm9ybV9jb250YWluZXJcXFwiPlxcbiAgICAgICAgICAgICAgICA8c2VsZWN0IGlkPVxcXCJzcGFuX25vcm1fZGJcXFwiLz5cXG4gICAgICAgICAgICAgICAgPGEgaWQ9XFxcInNwYW5fbm9ybV9kYl9saW5rXFxcIiB0YXJnZXQ9XFxcImJyYXRfbGlua2VkXFxcIiBocmVmPVxcXCIjXFxcIiB0aXRsZT1cXFwiU2VhcmNoIERCXFxcIj48aW1nIGNsYXNzPVxcXCJicmF0LWZ1Z3VlLXNoYWRvd2xlc3MtbWFnbmlmaWVyXFxcIiBzcmM9XFxcInN0YXRpYy9pbWcvRnVndWUtc2hhZG93bGVzcy1tYWduaWZpZXIucG5nXFxcIiBzdHlsZT1cXFwidmVydGljYWwtYWxpZ246IG1pZGRsZVxcXCIvPjwvYT5cXG4gICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9XFxcInNwYW5fbm9ybV9sYWJlbFxcXCI+SUQ6PC9zcGFuPlxcbiAgICAgICAgICAgICAgICA8aW5wdXQgaWQ9XFxcInNwYW5fbm9ybV9pZFxcXCIgY2xhc3M9XFxcInNwYW5fbm9ybV9pZF9pbnB1dFxcXCJcXG4gICAgICAgICAgICAgICAgICAgICAgIHN0eWxlPVxcXCJ3aWR0aDoyMCVcXFwiLz5cXG4gICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9XFxcInNwYW5fbm9ybV9sYWJlbFxcXCI+UmVmOjwvc3Bhbj5cXG4gICAgICAgICAgICAgICAgPGlucHV0IGlkPVxcXCJzcGFuX25vcm1fdHh0XFxcIiBjbGFzcz1cXFwic3Bhbl9ub3JtX3R4dF9pbnB1dFxcXCJcXG4gICAgICAgICAgICAgICAgICAgICAgIHJlYWRvbmx5PVxcXCJyZWFkb25seVxcXCIgc3R5bGU9XFxcIndpZHRoOjQ1JVxcXCJcXG4gICAgICAgICAgICAgICAgICAgICAgIHBsYWNlaG9sZGVyPVxcXCJDbGljayBoZXJlIHRvIHNlYXJjaFxcXCIvPlxcbiAgICAgICAgICAgICAgICA8YSBpZD1cXFwic3Bhbl9ub3JtX3JlZl9saW5rXFxcIiB0YXJnZXQ9XFxcImJyYXRfbGlua2VkXFxcIiBocmVmPVxcXCIjXFxcIiB0aXRsZT1cXFwiU2VlIGluIERCXFxcIj48aW1nIGNsYXNzPVxcXCJicmF0LWZ1Z3VlLXNoYWRvd2xlc3MtZXh0ZXJuYWxcXFwiIHNyYz1cXFwic3RhdGljL2ltZy9GdWd1ZS1zaGFkb3dsZXNzLWV4dGVybmFsLnBuZ1xcXCIgc3R5bGU9XFxcInZlcnRpY2FsLWFsaWduOiBtaWRkbGVcXFwiLz48L2E+XFxuICAgICAgICAgICAgICAgIDxpbnB1dCBpZD1cXFwiY2xlYXJfbm9ybV9idXR0b25cXFwiIHR5cGU9XFxcImJ1dHRvblxcXCJcXG4gICAgICAgICAgICAgICAgICAgICAgIHZhbHVlPVxcXCImI3gyNzE1O1xcXCIgdGl0bGU9XFxcIkNsZWFyIG5vcm1hbGl6YXRpb25cXFwiLz5cXG4gICAgICAgICAgICA8L2Rpdj5cXG4gICAgICAgIDwvZmllbGRzZXQ+XFxuICAgICAgICA8IS0tIFNwYW4gZGlhbG9nIG5vdGVzIC0tPlxcbiAgICAgICAgPGZpZWxkc2V0PlxcbiAgICAgICAgICAgIDxsZWdlbmQ+Tm90ZXM8L2xlZ2VuZD5cXG4gICAgICAgICAgICA8ZGl2IGlkPVxcXCJub3Rlc19jb250YWluZXJcXFwiPlxcbiAgICAgICAgICAgICAgICA8aW5wdXQgaWQ9XFxcInNwYW5fbm90ZXNcXFwiIGNsYXNzPVxcXCJib3JkZXJsZXNzXFxcIi8+XFxuICAgICAgICAgICAgICAgIDxpbnB1dCBpZD1cXFwiY2xlYXJfbm90ZXNfYnV0dG9uXFxcIiB0eXBlPVxcXCJidXR0b25cXFwiXFxuICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZT1cXFwiJiN4MjcxNTtcXFwiIHRpdGxlPVxcXCJDbGVhciBub3Rlc1xcXCIvPlxcbiAgICAgICAgICAgIDwvZGl2PlxcbiAgICAgICAgPC9maWVsZHNldD5cXG4gICAgPC9mb3JtPlxcblxcbiAgICA8IS0tIFJhcGlkIG1vZGUgc3BhbiBkaWFsb2cgLS0+XFxuICAgIDxmb3JtIGlkPVxcXCJyYXBpZF9zcGFuX2Zvcm1cXFwiIGNsYXNzPVxcXCJkaWFsb2dcXFwiIHRpdGxlPVxcXCJTcGFuIHR5cGVcXFwiPlxcbiAgICAgICAgPGZpZWxkc2V0IGlkPVxcXCJyYXBpZF9zcGFuX3NlbGVjdGVkX2ZzZXRcXFwiPlxcbiAgICAgICAgICAgIDxsZWdlbmQ+VGV4dDwvbGVnZW5kPlxcbiAgICAgICAgICAgIDxkaXYgaWQ9XFxcInJhcGlkX3NwYW5fc2VsZWN0ZWRcXFwiLz5cXG4gICAgICAgIDwvZmllbGRzZXQ+XFxuICAgICAgICA8ZGl2IGlkPVxcXCJyYXBpZF9zcGFuX3R5cGVzXFxcIiBjbGFzcz1cXFwic2Nyb2xsX2ZzZXRcXFwiIHN0eWxlPVxcXCJoZWlnaHQ6MjUwcHhcXFwiPlxcbiAgICAgICAgICAgIDxmaWVsZHNldD5cXG4gICAgICAgICAgICAgICAgPGxlZ2VuZD5TZWxlY3QgdHlwZTwvbGVnZW5kPlxcbiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPVxcXCJzY3JvbGxlclxcXCIgaWQ9XFxcInJhcGlkX3NwYW5fdHlwZXNfZGl2XFxcIj5cXG4gICAgICAgICAgICAgICAgICAgIDwhLS0gZmlsbGVkIGR5bmFtaWNhbGx5IC0tPlxcbiAgICAgICAgICAgICAgICA8L2Rpdj5cXG4gICAgICAgICAgICA8L2ZpZWxkc2V0PlxcbiAgICAgICAgPC9kaXY+XFxuICAgIDwvZm9ybT5cXG5cXG4gICAgPCEtLSBBcmMgZGlhbG9nIC0tPlxcbiAgICA8Zm9ybSBpZD1cXFwiYXJjX2Zvcm1cXFwiIGNsYXNzPVxcXCJkaWFsb2dcXFwiIHRpdGxlPVxcXCJBcmNcXFwiPlxcbiAgICAgICAgPGZpZWxkc2V0IGlkPVxcXCJhcmNfb3JpZ2luX2ZzZXRcXFwiPlxcbiAgICAgICAgICAgIDxsZWdlbmQ+RnJvbTwvbGVnZW5kPlxcbiAgICAgICAgICAgIDxhIHRhcmdldD1cXFwiYnJhdF9saW5rZWRcXFwiIGlkPVxcXCJhcmNfaGlnaGxpZ2h0X2xpbmtcXFwiIGhyZWY9XFxcIiNcXFwiPkxpbms8L2E+XFxuICAgICAgICAgICAgPGRpdiBpZD1cXFwiYXJjX29yaWdpblxcXCIvPlxcbiAgICAgICAgPC9maWVsZHNldD5cXG5cXG4gICAgICAgIDxmaWVsZHNldCBpZD1cXFwiYXJjX3RhcmdldF9mc2V0XFxcIj5cXG4gICAgICAgICAgICA8bGVnZW5kPlRvPC9sZWdlbmQ+XFxuICAgICAgICAgICAgPGRpdiBpZD1cXFwiYXJjX3RhcmdldFxcXCIvPlxcbiAgICAgICAgPC9maWVsZHNldD5cXG5cXG4gICAgICAgIDxkaXYgaWQ9XFxcImFyY19yb2xlc1xcXCIgY2xhc3M9XFxcInNjcm9sbF9mc2V0XFxcIj5cXG4gICAgICAgICAgICA8ZmllbGRzZXQ+XFxuICAgICAgICAgICAgICAgIDxsZWdlbmQ+VHlwZTwvbGVnZW5kPlxcbiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPVxcXCJzY3JvbGxlclxcXCIvPlxcbiAgICAgICAgICAgIDwvZmllbGRzZXQ+XFxuICAgICAgICA8L2Rpdj5cXG5cXG4gICAgICAgIDxmaWVsZHNldCBpZD1cXFwiYXJjX25vdGVzX2ZpZWxkc2V0XFxcIj5cXG4gICAgICAgICAgICA8bGVnZW5kPk5vdGVzPC9sZWdlbmQ+XFxuICAgICAgICAgICAgPGlucHV0IGlkPVxcXCJhcmNfbm90ZXNcXFwiIGNsYXNzPVxcXCJib3JkZXJsZXNzXFxcIi8+XFxuICAgICAgICA8L2ZpZWxkc2V0PlxcblxcbiAgICA8L2Zvcm0+XFxuXFxuICAgIDwhLS0gU3BsaXQgc3BhbiBhbm5vdGF0aW9uIGRpYWxvZyAtLT5cXG4gICAgPGZvcm0gaWQ9XFxcInNwbGl0X2Zvcm1cXFwiIGNsYXNzPVxcXCJkaWFsb2dcXFwiIHRpdGxlPVxcXCJTcGxpdCB0aGUgU3BhblxcXCI+XFxuICAgICAgICA8ZmllbGRzZXQ+XFxuICAgICAgICAgICAgPGxlZ2VuZD5TcGxpdCBSb2xlczwvbGVnZW5kPlxcbiAgICAgICAgICAgIDxkaXYgaWQ9XFxcInNwbGl0X3JvbGVzXFxcIiBjbGFzcz1cXFwic2Nyb2xsX2ZzZXRcXFwiLz5cXG4gICAgICAgIDwvZmllbGRzZXQ+XFxuICAgIDwvZm9ybT5cXG5cXG4gICAgPCEtLSBTcGlubmVyIC0tPlxcbiAgICA8IS0tPGRpdiBpZD1cXFwid2FpdGVyXFxcIiBjbGFzcz1cXFwiZGlhbG9nXFxcIiB0aXRsZT1cXFwiUGxlYXNlIHdhaXRcXFwiPlxcbiAgICAgICAgPGltZyBjbGFzcz1cXFwiYnJhdC1zcGlubmVyXFxcIiBzcmM9XFxcInN0YXRpYy9pbWcvc3Bpbm5lci5naWZcXFwiLz5cXG4gICAgPC9kaXY+LS0+XFxuPC9kaXY+XCI7XG4iLCIvKiFcbiAqIGpRdWVyeSBVSSAxLjguMTZcbiAqXG4gKiBDb3B5cmlnaHQgMjAxMSwgQVVUSE9SUy50eHQgKGh0dHA6Ly9qcXVlcnl1aS5jb20vYWJvdXQpXG4gKiBEdWFsIGxpY2Vuc2VkIHVuZGVyIHRoZSBNSVQgb3IgR1BMIFZlcnNpb24gMiBsaWNlbnNlcy5cbiAqIGh0dHA6Ly9qcXVlcnkub3JnL2xpY2Vuc2VcbiAqXG4gKiBodHRwOi8vZG9jcy5qcXVlcnkuY29tL1VJXG4gKi9cbihmdW5jdGlvbihjLGope2Z1bmN0aW9uIGsoYSxiKXt2YXIgZD1hLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCk7aWYoXCJhcmVhXCI9PT1kKXtiPWEucGFyZW50Tm9kZTtkPWIubmFtZTtpZighYS5ocmVmfHwhZHx8Yi5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpIT09XCJtYXBcIilyZXR1cm4gZmFsc2U7YT1jKFwiaW1nW3VzZW1hcD0jXCIrZCtcIl1cIilbMF07cmV0dXJuISFhJiZsKGEpfXJldHVybigvaW5wdXR8c2VsZWN0fHRleHRhcmVhfGJ1dHRvbnxvYmplY3QvLnRlc3QoZCk/IWEuZGlzYWJsZWQ6XCJhXCI9PWQ/YS5ocmVmfHxiOmIpJiZsKGEpfWZ1bmN0aW9uIGwoYSl7cmV0dXJuIWMoYSkucGFyZW50cygpLmFuZFNlbGYoKS5maWx0ZXIoZnVuY3Rpb24oKXtyZXR1cm4gYy5jdXJDU1ModGhpcyxcInZpc2liaWxpdHlcIik9PT1cImhpZGRlblwifHxjLmV4cHIuZmlsdGVycy5oaWRkZW4odGhpcyl9KS5sZW5ndGh9Yy51aT1jLnVpfHx7fTtpZighYy51aS52ZXJzaW9uKXtjLmV4dGVuZChjLnVpLHt2ZXJzaW9uOlwiMS44LjE2XCIsXG5rZXlDb2RlOntBTFQ6MTgsQkFDS1NQQUNFOjgsQ0FQU19MT0NLOjIwLENPTU1BOjE4OCxDT01NQU5EOjkxLENPTU1BTkRfTEVGVDo5MSxDT01NQU5EX1JJR0hUOjkzLENPTlRST0w6MTcsREVMRVRFOjQ2LERPV046NDAsRU5EOjM1LEVOVEVSOjEzLEVTQ0FQRToyNyxIT01FOjM2LElOU0VSVDo0NSxMRUZUOjM3LE1FTlU6OTMsTlVNUEFEX0FERDoxMDcsTlVNUEFEX0RFQ0lNQUw6MTEwLE5VTVBBRF9ESVZJREU6MTExLE5VTVBBRF9FTlRFUjoxMDgsTlVNUEFEX01VTFRJUExZOjEwNixOVU1QQURfU1VCVFJBQ1Q6MTA5LFBBR0VfRE9XTjozNCxQQUdFX1VQOjMzLFBFUklPRDoxOTAsUklHSFQ6MzksU0hJRlQ6MTYsU1BBQ0U6MzIsVEFCOjksVVA6MzgsV0lORE9XUzo5MX19KTtjLmZuLmV4dGVuZCh7cHJvcEF0dHI6Yy5mbi5wcm9wfHxjLmZuLmF0dHIsX2ZvY3VzOmMuZm4uZm9jdXMsZm9jdXM6ZnVuY3Rpb24oYSxiKXtyZXR1cm4gdHlwZW9mIGE9PT1cIm51bWJlclwiP3RoaXMuZWFjaChmdW5jdGlvbigpe3ZhciBkPVxudGhpcztzZXRUaW1lb3V0KGZ1bmN0aW9uKCl7YyhkKS5mb2N1cygpO2ImJmIuY2FsbChkKX0sYSl9KTp0aGlzLl9mb2N1cy5hcHBseSh0aGlzLGFyZ3VtZW50cyl9LHNjcm9sbFBhcmVudDpmdW5jdGlvbigpe3ZhciBhO2E9Yy5icm93c2VyLm1zaWUmJi8oc3RhdGljfHJlbGF0aXZlKS8udGVzdCh0aGlzLmNzcyhcInBvc2l0aW9uXCIpKXx8L2Fic29sdXRlLy50ZXN0KHRoaXMuY3NzKFwicG9zaXRpb25cIikpP3RoaXMucGFyZW50cygpLmZpbHRlcihmdW5jdGlvbigpe3JldHVybi8ocmVsYXRpdmV8YWJzb2x1dGV8Zml4ZWQpLy50ZXN0KGMuY3VyQ1NTKHRoaXMsXCJwb3NpdGlvblwiLDEpKSYmLyhhdXRvfHNjcm9sbCkvLnRlc3QoYy5jdXJDU1ModGhpcyxcIm92ZXJmbG93XCIsMSkrYy5jdXJDU1ModGhpcyxcIm92ZXJmbG93LXlcIiwxKStjLmN1ckNTUyh0aGlzLFwib3ZlcmZsb3cteFwiLDEpKX0pLmVxKDApOnRoaXMucGFyZW50cygpLmZpbHRlcihmdW5jdGlvbigpe3JldHVybi8oYXV0b3xzY3JvbGwpLy50ZXN0KGMuY3VyQ1NTKHRoaXMsXG5cIm92ZXJmbG93XCIsMSkrYy5jdXJDU1ModGhpcyxcIm92ZXJmbG93LXlcIiwxKStjLmN1ckNTUyh0aGlzLFwib3ZlcmZsb3cteFwiLDEpKX0pLmVxKDApO3JldHVybi9maXhlZC8udGVzdCh0aGlzLmNzcyhcInBvc2l0aW9uXCIpKXx8IWEubGVuZ3RoP2MoZG9jdW1lbnQpOmF9LHpJbmRleDpmdW5jdGlvbihhKXtpZihhIT09ailyZXR1cm4gdGhpcy5jc3MoXCJ6SW5kZXhcIixhKTtpZih0aGlzLmxlbmd0aCl7YT1jKHRoaXNbMF0pO2Zvcih2YXIgYjthLmxlbmd0aCYmYVswXSE9PWRvY3VtZW50Oyl7Yj1hLmNzcyhcInBvc2l0aW9uXCIpO2lmKGI9PT1cImFic29sdXRlXCJ8fGI9PT1cInJlbGF0aXZlXCJ8fGI9PT1cImZpeGVkXCIpe2I9cGFyc2VJbnQoYS5jc3MoXCJ6SW5kZXhcIiksMTApO2lmKCFpc05hTihiKSYmYiE9PTApcmV0dXJuIGJ9YT1hLnBhcmVudCgpfX1yZXR1cm4gMH0sZGlzYWJsZVNlbGVjdGlvbjpmdW5jdGlvbigpe3JldHVybiB0aGlzLmJpbmQoKGMuc3VwcG9ydC5zZWxlY3RzdGFydD9cInNlbGVjdHN0YXJ0XCI6XG5cIm1vdXNlZG93blwiKStcIi51aS1kaXNhYmxlU2VsZWN0aW9uXCIsZnVuY3Rpb24oYSl7YS5wcmV2ZW50RGVmYXVsdCgpfSl9LGVuYWJsZVNlbGVjdGlvbjpmdW5jdGlvbigpe3JldHVybiB0aGlzLnVuYmluZChcIi51aS1kaXNhYmxlU2VsZWN0aW9uXCIpfX0pO2MuZWFjaChbXCJXaWR0aFwiLFwiSGVpZ2h0XCJdLGZ1bmN0aW9uKGEsYil7ZnVuY3Rpb24gZChmLGcsbSxuKXtjLmVhY2goZSxmdW5jdGlvbigpe2ctPXBhcnNlRmxvYXQoYy5jdXJDU1MoZixcInBhZGRpbmdcIit0aGlzLHRydWUpKXx8MDtpZihtKWctPXBhcnNlRmxvYXQoYy5jdXJDU1MoZixcImJvcmRlclwiK3RoaXMrXCJXaWR0aFwiLHRydWUpKXx8MDtpZihuKWctPXBhcnNlRmxvYXQoYy5jdXJDU1MoZixcIm1hcmdpblwiK3RoaXMsdHJ1ZSkpfHwwfSk7cmV0dXJuIGd9dmFyIGU9Yj09PVwiV2lkdGhcIj9bXCJMZWZ0XCIsXCJSaWdodFwiXTpbXCJUb3BcIixcIkJvdHRvbVwiXSxoPWIudG9Mb3dlckNhc2UoKSxpPXtpbm5lcldpZHRoOmMuZm4uaW5uZXJXaWR0aCxpbm5lckhlaWdodDpjLmZuLmlubmVySGVpZ2h0LFxub3V0ZXJXaWR0aDpjLmZuLm91dGVyV2lkdGgsb3V0ZXJIZWlnaHQ6Yy5mbi5vdXRlckhlaWdodH07Yy5mbltcImlubmVyXCIrYl09ZnVuY3Rpb24oZil7aWYoZj09PWopcmV0dXJuIGlbXCJpbm5lclwiK2JdLmNhbGwodGhpcyk7cmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbigpe2ModGhpcykuY3NzKGgsZCh0aGlzLGYpK1wicHhcIil9KX07Yy5mbltcIm91dGVyXCIrYl09ZnVuY3Rpb24oZixnKXtpZih0eXBlb2YgZiE9PVwibnVtYmVyXCIpcmV0dXJuIGlbXCJvdXRlclwiK2JdLmNhbGwodGhpcyxmKTtyZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKCl7Yyh0aGlzKS5jc3MoaCxkKHRoaXMsZix0cnVlLGcpK1wicHhcIil9KX19KTtjLmV4dGVuZChjLmV4cHJbXCI6XCJdLHtkYXRhOmZ1bmN0aW9uKGEsYixkKXtyZXR1cm4hIWMuZGF0YShhLGRbM10pfSxmb2N1c2FibGU6ZnVuY3Rpb24oYSl7cmV0dXJuIGsoYSwhaXNOYU4oYy5hdHRyKGEsXCJ0YWJpbmRleFwiKSkpfSx0YWJiYWJsZTpmdW5jdGlvbihhKXt2YXIgYj1jLmF0dHIoYSxcblwidGFiaW5kZXhcIiksZD1pc05hTihiKTtyZXR1cm4oZHx8Yj49MCkmJmsoYSwhZCl9fSk7YyhmdW5jdGlvbigpe3ZhciBhPWRvY3VtZW50LmJvZHksYj1hLmFwcGVuZENoaWxkKGI9ZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKSk7Yy5leHRlbmQoYi5zdHlsZSx7bWluSGVpZ2h0OlwiMTAwcHhcIixoZWlnaHQ6XCJhdXRvXCIscGFkZGluZzowLGJvcmRlcldpZHRoOjB9KTtjLnN1cHBvcnQubWluSGVpZ2h0PWIub2Zmc2V0SGVpZ2h0PT09MTAwO2Muc3VwcG9ydC5zZWxlY3RzdGFydD1cIm9uc2VsZWN0c3RhcnRcImluIGI7YS5yZW1vdmVDaGlsZChiKS5zdHlsZS5kaXNwbGF5PVwibm9uZVwifSk7Yy5leHRlbmQoYy51aSx7cGx1Z2luOnthZGQ6ZnVuY3Rpb24oYSxiLGQpe2E9Yy51aVthXS5wcm90b3R5cGU7Zm9yKHZhciBlIGluIGQpe2EucGx1Z2luc1tlXT1hLnBsdWdpbnNbZV18fFtdO2EucGx1Z2luc1tlXS5wdXNoKFtiLGRbZV1dKX19LGNhbGw6ZnVuY3Rpb24oYSxiLGQpe2lmKChiPWEucGx1Z2luc1tiXSkmJlxuYS5lbGVtZW50WzBdLnBhcmVudE5vZGUpZm9yKHZhciBlPTA7ZTxiLmxlbmd0aDtlKyspYS5vcHRpb25zW2JbZV1bMF1dJiZiW2VdWzFdLmFwcGx5KGEuZWxlbWVudCxkKX19LGNvbnRhaW5zOmZ1bmN0aW9uKGEsYil7cmV0dXJuIGRvY3VtZW50LmNvbXBhcmVEb2N1bWVudFBvc2l0aW9uP2EuY29tcGFyZURvY3VtZW50UG9zaXRpb24oYikmMTY6YSE9PWImJmEuY29udGFpbnMoYil9LGhhc1Njcm9sbDpmdW5jdGlvbihhLGIpe2lmKGMoYSkuY3NzKFwib3ZlcmZsb3dcIik9PT1cImhpZGRlblwiKXJldHVybiBmYWxzZTtiPWImJmI9PT1cImxlZnRcIj9cInNjcm9sbExlZnRcIjpcInNjcm9sbFRvcFwiO3ZhciBkPWZhbHNlO2lmKGFbYl0+MClyZXR1cm4gdHJ1ZTthW2JdPTE7ZD1hW2JdPjA7YVtiXT0wO3JldHVybiBkfSxpc092ZXJBeGlzOmZ1bmN0aW9uKGEsYixkKXtyZXR1cm4gYT5iJiZhPGIrZH0saXNPdmVyOmZ1bmN0aW9uKGEsYixkLGUsaCxpKXtyZXR1cm4gYy51aS5pc092ZXJBeGlzKGEsZCxoKSYmXG5jLnVpLmlzT3ZlckF4aXMoYixlLGkpfX0pfX0pKGpRdWVyeSk7XG47LyohXG4gKiBqUXVlcnkgVUkgV2lkZ2V0IDEuOC4xNlxuICpcbiAqIENvcHlyaWdodCAyMDExLCBBVVRIT1JTLnR4dCAoaHR0cDovL2pxdWVyeXVpLmNvbS9hYm91dClcbiAqIER1YWwgbGljZW5zZWQgdW5kZXIgdGhlIE1JVCBvciBHUEwgVmVyc2lvbiAyIGxpY2Vuc2VzLlxuICogaHR0cDovL2pxdWVyeS5vcmcvbGljZW5zZVxuICpcbiAqIGh0dHA6Ly9kb2NzLmpxdWVyeS5jb20vVUkvV2lkZ2V0XG4gKi9cbihmdW5jdGlvbihiLGope2lmKGIuY2xlYW5EYXRhKXt2YXIgaz1iLmNsZWFuRGF0YTtiLmNsZWFuRGF0YT1mdW5jdGlvbihhKXtmb3IodmFyIGM9MCxkOyhkPWFbY10pIT1udWxsO2MrKyl0cnl7YihkKS50cmlnZ2VySGFuZGxlcihcInJlbW92ZVwiKX1jYXRjaChlKXt9ayhhKX19ZWxzZXt2YXIgbD1iLmZuLnJlbW92ZTtiLmZuLnJlbW92ZT1mdW5jdGlvbihhLGMpe3JldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oKXtpZighYylpZighYXx8Yi5maWx0ZXIoYSxbdGhpc10pLmxlbmd0aCliKFwiKlwiLHRoaXMpLmFkZChbdGhpc10pLmVhY2goZnVuY3Rpb24oKXt0cnl7Yih0aGlzKS50cmlnZ2VySGFuZGxlcihcInJlbW92ZVwiKX1jYXRjaChkKXt9fSk7cmV0dXJuIGwuY2FsbChiKHRoaXMpLGEsYyl9KX19Yi53aWRnZXQ9ZnVuY3Rpb24oYSxjLGQpe3ZhciBlPWEuc3BsaXQoXCIuXCIpWzBdLGY7YT1hLnNwbGl0KFwiLlwiKVsxXTtmPWUrXCItXCIrYTtpZighZCl7ZD1jO2M9Yi5XaWRnZXR9Yi5leHByW1wiOlwiXVtmXT1cbmZ1bmN0aW9uKGgpe3JldHVybiEhYi5kYXRhKGgsYSl9O2JbZV09YltlXXx8e307YltlXVthXT1mdW5jdGlvbihoLGcpe2FyZ3VtZW50cy5sZW5ndGgmJnRoaXMuX2NyZWF0ZVdpZGdldChoLGcpfTtjPW5ldyBjO2Mub3B0aW9ucz1iLmV4dGVuZCh0cnVlLHt9LGMub3B0aW9ucyk7YltlXVthXS5wcm90b3R5cGU9Yi5leHRlbmQodHJ1ZSxjLHtuYW1lc3BhY2U6ZSx3aWRnZXROYW1lOmEsd2lkZ2V0RXZlbnRQcmVmaXg6YltlXVthXS5wcm90b3R5cGUud2lkZ2V0RXZlbnRQcmVmaXh8fGEsd2lkZ2V0QmFzZUNsYXNzOmZ9LGQpO2Iud2lkZ2V0LmJyaWRnZShhLGJbZV1bYV0pfTtiLndpZGdldC5icmlkZ2U9ZnVuY3Rpb24oYSxjKXtiLmZuW2FdPWZ1bmN0aW9uKGQpe3ZhciBlPXR5cGVvZiBkPT09XCJzdHJpbmdcIixmPUFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGFyZ3VtZW50cywxKSxoPXRoaXM7ZD0hZSYmZi5sZW5ndGg/Yi5leHRlbmQuYXBwbHkobnVsbCxbdHJ1ZSxkXS5jb25jYXQoZikpOlxuZDtpZihlJiZkLmNoYXJBdCgwKT09PVwiX1wiKXJldHVybiBoO2U/dGhpcy5lYWNoKGZ1bmN0aW9uKCl7dmFyIGc9Yi5kYXRhKHRoaXMsYSksaT1nJiZiLmlzRnVuY3Rpb24oZ1tkXSk/Z1tkXS5hcHBseShnLGYpOmc7aWYoaSE9PWcmJmkhPT1qKXtoPWk7cmV0dXJuIGZhbHNlfX0pOnRoaXMuZWFjaChmdW5jdGlvbigpe3ZhciBnPWIuZGF0YSh0aGlzLGEpO2c/Zy5vcHRpb24oZHx8e30pLl9pbml0KCk6Yi5kYXRhKHRoaXMsYSxuZXcgYyhkLHRoaXMpKX0pO3JldHVybiBofX07Yi5XaWRnZXQ9ZnVuY3Rpb24oYSxjKXthcmd1bWVudHMubGVuZ3RoJiZ0aGlzLl9jcmVhdGVXaWRnZXQoYSxjKX07Yi5XaWRnZXQucHJvdG90eXBlPXt3aWRnZXROYW1lOlwid2lkZ2V0XCIsd2lkZ2V0RXZlbnRQcmVmaXg6XCJcIixvcHRpb25zOntkaXNhYmxlZDpmYWxzZX0sX2NyZWF0ZVdpZGdldDpmdW5jdGlvbihhLGMpe2IuZGF0YShjLHRoaXMud2lkZ2V0TmFtZSx0aGlzKTt0aGlzLmVsZW1lbnQ9YihjKTt0aGlzLm9wdGlvbnM9XG5iLmV4dGVuZCh0cnVlLHt9LHRoaXMub3B0aW9ucyx0aGlzLl9nZXRDcmVhdGVPcHRpb25zKCksYSk7dmFyIGQ9dGhpczt0aGlzLmVsZW1lbnQuYmluZChcInJlbW92ZS5cIit0aGlzLndpZGdldE5hbWUsZnVuY3Rpb24oKXtkLmRlc3Ryb3koKX0pO3RoaXMuX2NyZWF0ZSgpO3RoaXMuX3RyaWdnZXIoXCJjcmVhdGVcIik7dGhpcy5faW5pdCgpfSxfZ2V0Q3JlYXRlT3B0aW9uczpmdW5jdGlvbigpe3JldHVybiBiLm1ldGFkYXRhJiZiLm1ldGFkYXRhLmdldCh0aGlzLmVsZW1lbnRbMF0pW3RoaXMud2lkZ2V0TmFtZV19LF9jcmVhdGU6ZnVuY3Rpb24oKXt9LF9pbml0OmZ1bmN0aW9uKCl7fSxkZXN0cm95OmZ1bmN0aW9uKCl7dGhpcy5lbGVtZW50LnVuYmluZChcIi5cIit0aGlzLndpZGdldE5hbWUpLnJlbW92ZURhdGEodGhpcy53aWRnZXROYW1lKTt0aGlzLndpZGdldCgpLnVuYmluZChcIi5cIit0aGlzLndpZGdldE5hbWUpLnJlbW92ZUF0dHIoXCJhcmlhLWRpc2FibGVkXCIpLnJlbW92ZUNsYXNzKHRoaXMud2lkZ2V0QmFzZUNsYXNzK1xuXCItZGlzYWJsZWQgdWktc3RhdGUtZGlzYWJsZWRcIil9LHdpZGdldDpmdW5jdGlvbigpe3JldHVybiB0aGlzLmVsZW1lbnR9LG9wdGlvbjpmdW5jdGlvbihhLGMpe3ZhciBkPWE7aWYoYXJndW1lbnRzLmxlbmd0aD09PTApcmV0dXJuIGIuZXh0ZW5kKHt9LHRoaXMub3B0aW9ucyk7aWYodHlwZW9mIGE9PT1cInN0cmluZ1wiKXtpZihjPT09ailyZXR1cm4gdGhpcy5vcHRpb25zW2FdO2Q9e307ZFthXT1jfXRoaXMuX3NldE9wdGlvbnMoZCk7cmV0dXJuIHRoaXN9LF9zZXRPcHRpb25zOmZ1bmN0aW9uKGEpe3ZhciBjPXRoaXM7Yi5lYWNoKGEsZnVuY3Rpb24oZCxlKXtjLl9zZXRPcHRpb24oZCxlKX0pO3JldHVybiB0aGlzfSxfc2V0T3B0aW9uOmZ1bmN0aW9uKGEsYyl7dGhpcy5vcHRpb25zW2FdPWM7aWYoYT09PVwiZGlzYWJsZWRcIil0aGlzLndpZGdldCgpW2M/XCJhZGRDbGFzc1wiOlwicmVtb3ZlQ2xhc3NcIl0odGhpcy53aWRnZXRCYXNlQ2xhc3MrXCItZGlzYWJsZWQgdWktc3RhdGUtZGlzYWJsZWRcIikuYXR0cihcImFyaWEtZGlzYWJsZWRcIixcbmMpO3JldHVybiB0aGlzfSxlbmFibGU6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5fc2V0T3B0aW9uKFwiZGlzYWJsZWRcIixmYWxzZSl9LGRpc2FibGU6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5fc2V0T3B0aW9uKFwiZGlzYWJsZWRcIix0cnVlKX0sX3RyaWdnZXI6ZnVuY3Rpb24oYSxjLGQpe3ZhciBlPXRoaXMub3B0aW9uc1thXTtjPWIuRXZlbnQoYyk7Yy50eXBlPShhPT09dGhpcy53aWRnZXRFdmVudFByZWZpeD9hOnRoaXMud2lkZ2V0RXZlbnRQcmVmaXgrYSkudG9Mb3dlckNhc2UoKTtkPWR8fHt9O2lmKGMub3JpZ2luYWxFdmVudCl7YT1iLmV2ZW50LnByb3BzLmxlbmd0aDtmb3IodmFyIGY7YTspe2Y9Yi5ldmVudC5wcm9wc1stLWFdO2NbZl09Yy5vcmlnaW5hbEV2ZW50W2ZdfX10aGlzLmVsZW1lbnQudHJpZ2dlcihjLGQpO3JldHVybiEoYi5pc0Z1bmN0aW9uKGUpJiZlLmNhbGwodGhpcy5lbGVtZW50WzBdLGMsZCk9PT1mYWxzZXx8Yy5pc0RlZmF1bHRQcmV2ZW50ZWQoKSl9fX0pKGpRdWVyeSk7XG47LyohXG4gKiBqUXVlcnkgVUkgTW91c2UgMS44LjE2XG4gKlxuICogQ29weXJpZ2h0IDIwMTEsIEFVVEhPUlMudHh0IChodHRwOi8vanF1ZXJ5dWkuY29tL2Fib3V0KVxuICogRHVhbCBsaWNlbnNlZCB1bmRlciB0aGUgTUlUIG9yIEdQTCBWZXJzaW9uIDIgbGljZW5zZXMuXG4gKiBodHRwOi8vanF1ZXJ5Lm9yZy9saWNlbnNlXG4gKlxuICogaHR0cDovL2RvY3MuanF1ZXJ5LmNvbS9VSS9Nb3VzZVxuICpcbiAqIERlcGVuZHM6XG4gKlx0anF1ZXJ5LnVpLndpZGdldC5qc1xuICovXG4oZnVuY3Rpb24oYil7dmFyIGQ9ZmFsc2U7Yihkb2N1bWVudCkubW91c2V1cChmdW5jdGlvbigpe2Q9ZmFsc2V9KTtiLndpZGdldChcInVpLm1vdXNlXCIse29wdGlvbnM6e2NhbmNlbDpcIjppbnB1dCxvcHRpb25cIixkaXN0YW5jZToxLGRlbGF5OjB9LF9tb3VzZUluaXQ6ZnVuY3Rpb24oKXt2YXIgYT10aGlzO3RoaXMuZWxlbWVudC5iaW5kKFwibW91c2Vkb3duLlwiK3RoaXMud2lkZ2V0TmFtZSxmdW5jdGlvbihjKXtyZXR1cm4gYS5fbW91c2VEb3duKGMpfSkuYmluZChcImNsaWNrLlwiK3RoaXMud2lkZ2V0TmFtZSxmdW5jdGlvbihjKXtpZih0cnVlPT09Yi5kYXRhKGMudGFyZ2V0LGEud2lkZ2V0TmFtZStcIi5wcmV2ZW50Q2xpY2tFdmVudFwiKSl7Yi5yZW1vdmVEYXRhKGMudGFyZ2V0LGEud2lkZ2V0TmFtZStcIi5wcmV2ZW50Q2xpY2tFdmVudFwiKTtjLnN0b3BJbW1lZGlhdGVQcm9wYWdhdGlvbigpO3JldHVybiBmYWxzZX19KTt0aGlzLnN0YXJ0ZWQ9ZmFsc2V9LF9tb3VzZURlc3Ryb3k6ZnVuY3Rpb24oKXt0aGlzLmVsZW1lbnQudW5iaW5kKFwiLlwiK1xudGhpcy53aWRnZXROYW1lKX0sX21vdXNlRG93bjpmdW5jdGlvbihhKXtpZighZCl7dGhpcy5fbW91c2VTdGFydGVkJiZ0aGlzLl9tb3VzZVVwKGEpO3RoaXMuX21vdXNlRG93bkV2ZW50PWE7dmFyIGM9dGhpcyxmPWEud2hpY2g9PTEsZz10eXBlb2YgdGhpcy5vcHRpb25zLmNhbmNlbD09XCJzdHJpbmdcIiYmYS50YXJnZXQubm9kZU5hbWU/YihhLnRhcmdldCkuY2xvc2VzdCh0aGlzLm9wdGlvbnMuY2FuY2VsKS5sZW5ndGg6ZmFsc2U7aWYoIWZ8fGd8fCF0aGlzLl9tb3VzZUNhcHR1cmUoYSkpcmV0dXJuIHRydWU7dGhpcy5tb3VzZURlbGF5TWV0PSF0aGlzLm9wdGlvbnMuZGVsYXk7aWYoIXRoaXMubW91c2VEZWxheU1ldCl0aGlzLl9tb3VzZURlbGF5VGltZXI9c2V0VGltZW91dChmdW5jdGlvbigpe2MubW91c2VEZWxheU1ldD10cnVlfSx0aGlzLm9wdGlvbnMuZGVsYXkpO2lmKHRoaXMuX21vdXNlRGlzdGFuY2VNZXQoYSkmJnRoaXMuX21vdXNlRGVsYXlNZXQoYSkpe3RoaXMuX21vdXNlU3RhcnRlZD1cbnRoaXMuX21vdXNlU3RhcnQoYSkhPT1mYWxzZTtpZighdGhpcy5fbW91c2VTdGFydGVkKXthLnByZXZlbnREZWZhdWx0KCk7cmV0dXJuIHRydWV9fXRydWU9PT1iLmRhdGEoYS50YXJnZXQsdGhpcy53aWRnZXROYW1lK1wiLnByZXZlbnRDbGlja0V2ZW50XCIpJiZiLnJlbW92ZURhdGEoYS50YXJnZXQsdGhpcy53aWRnZXROYW1lK1wiLnByZXZlbnRDbGlja0V2ZW50XCIpO3RoaXMuX21vdXNlTW92ZURlbGVnYXRlPWZ1bmN0aW9uKGUpe3JldHVybiBjLl9tb3VzZU1vdmUoZSl9O3RoaXMuX21vdXNlVXBEZWxlZ2F0ZT1mdW5jdGlvbihlKXtyZXR1cm4gYy5fbW91c2VVcChlKX07Yihkb2N1bWVudCkuYmluZChcIm1vdXNlbW92ZS5cIit0aGlzLndpZGdldE5hbWUsdGhpcy5fbW91c2VNb3ZlRGVsZWdhdGUpLmJpbmQoXCJtb3VzZXVwLlwiK3RoaXMud2lkZ2V0TmFtZSx0aGlzLl9tb3VzZVVwRGVsZWdhdGUpO2EucHJldmVudERlZmF1bHQoKTtyZXR1cm4gZD10cnVlfX0sX21vdXNlTW92ZTpmdW5jdGlvbihhKXtpZihiLmJyb3dzZXIubXNpZSYmXG4hKGRvY3VtZW50LmRvY3VtZW50TW9kZT49OSkmJiFhLmJ1dHRvbilyZXR1cm4gdGhpcy5fbW91c2VVcChhKTtpZih0aGlzLl9tb3VzZVN0YXJ0ZWQpe3RoaXMuX21vdXNlRHJhZyhhKTtyZXR1cm4gYS5wcmV2ZW50RGVmYXVsdCgpfWlmKHRoaXMuX21vdXNlRGlzdGFuY2VNZXQoYSkmJnRoaXMuX21vdXNlRGVsYXlNZXQoYSkpKHRoaXMuX21vdXNlU3RhcnRlZD10aGlzLl9tb3VzZVN0YXJ0KHRoaXMuX21vdXNlRG93bkV2ZW50LGEpIT09ZmFsc2UpP3RoaXMuX21vdXNlRHJhZyhhKTp0aGlzLl9tb3VzZVVwKGEpO3JldHVybiF0aGlzLl9tb3VzZVN0YXJ0ZWR9LF9tb3VzZVVwOmZ1bmN0aW9uKGEpe2IoZG9jdW1lbnQpLnVuYmluZChcIm1vdXNlbW92ZS5cIit0aGlzLndpZGdldE5hbWUsdGhpcy5fbW91c2VNb3ZlRGVsZWdhdGUpLnVuYmluZChcIm1vdXNldXAuXCIrdGhpcy53aWRnZXROYW1lLHRoaXMuX21vdXNlVXBEZWxlZ2F0ZSk7aWYodGhpcy5fbW91c2VTdGFydGVkKXt0aGlzLl9tb3VzZVN0YXJ0ZWQ9XG5mYWxzZTthLnRhcmdldD09dGhpcy5fbW91c2VEb3duRXZlbnQudGFyZ2V0JiZiLmRhdGEoYS50YXJnZXQsdGhpcy53aWRnZXROYW1lK1wiLnByZXZlbnRDbGlja0V2ZW50XCIsdHJ1ZSk7dGhpcy5fbW91c2VTdG9wKGEpfXJldHVybiBmYWxzZX0sX21vdXNlRGlzdGFuY2VNZXQ6ZnVuY3Rpb24oYSl7cmV0dXJuIE1hdGgubWF4KE1hdGguYWJzKHRoaXMuX21vdXNlRG93bkV2ZW50LnBhZ2VYLWEucGFnZVgpLE1hdGguYWJzKHRoaXMuX21vdXNlRG93bkV2ZW50LnBhZ2VZLWEucGFnZVkpKT49dGhpcy5vcHRpb25zLmRpc3RhbmNlfSxfbW91c2VEZWxheU1ldDpmdW5jdGlvbigpe3JldHVybiB0aGlzLm1vdXNlRGVsYXlNZXR9LF9tb3VzZVN0YXJ0OmZ1bmN0aW9uKCl7fSxfbW91c2VEcmFnOmZ1bmN0aW9uKCl7fSxfbW91c2VTdG9wOmZ1bmN0aW9uKCl7fSxfbW91c2VDYXB0dXJlOmZ1bmN0aW9uKCl7cmV0dXJuIHRydWV9fSl9KShqUXVlcnkpO1xuOy8qXG4gKiBqUXVlcnkgVUkgUG9zaXRpb24gMS44LjE2XG4gKlxuICogQ29weXJpZ2h0IDIwMTEsIEFVVEhPUlMudHh0IChodHRwOi8vanF1ZXJ5dWkuY29tL2Fib3V0KVxuICogRHVhbCBsaWNlbnNlZCB1bmRlciB0aGUgTUlUIG9yIEdQTCBWZXJzaW9uIDIgbGljZW5zZXMuXG4gKiBodHRwOi8vanF1ZXJ5Lm9yZy9saWNlbnNlXG4gKlxuICogaHR0cDovL2RvY3MuanF1ZXJ5LmNvbS9VSS9Qb3NpdGlvblxuICovXG4oZnVuY3Rpb24oYyl7Yy51aT1jLnVpfHx7fTt2YXIgbj0vbGVmdHxjZW50ZXJ8cmlnaHQvLG89L3RvcHxjZW50ZXJ8Ym90dG9tLyx0PWMuZm4ucG9zaXRpb24sdT1jLmZuLm9mZnNldDtjLmZuLnBvc2l0aW9uPWZ1bmN0aW9uKGIpe2lmKCFifHwhYi5vZilyZXR1cm4gdC5hcHBseSh0aGlzLGFyZ3VtZW50cyk7Yj1jLmV4dGVuZCh7fSxiKTt2YXIgYT1jKGIub2YpLGQ9YVswXSxnPShiLmNvbGxpc2lvbnx8XCJmbGlwXCIpLnNwbGl0KFwiIFwiKSxlPWIub2Zmc2V0P2Iub2Zmc2V0LnNwbGl0KFwiIFwiKTpbMCwwXSxoLGssajtpZihkLm5vZGVUeXBlPT09OSl7aD1hLndpZHRoKCk7az1hLmhlaWdodCgpO2o9e3RvcDowLGxlZnQ6MH19ZWxzZSBpZihkLnNldFRpbWVvdXQpe2g9YS53aWR0aCgpO2s9YS5oZWlnaHQoKTtqPXt0b3A6YS5zY3JvbGxUb3AoKSxsZWZ0OmEuc2Nyb2xsTGVmdCgpfX1lbHNlIGlmKGQucHJldmVudERlZmF1bHQpe2IuYXQ9XCJsZWZ0IHRvcFwiO2g9az0wO2o9e3RvcDpiLm9mLnBhZ2VZLFxubGVmdDpiLm9mLnBhZ2VYfX1lbHNle2g9YS5vdXRlcldpZHRoKCk7az1hLm91dGVySGVpZ2h0KCk7aj1hLm9mZnNldCgpfWMuZWFjaChbXCJteVwiLFwiYXRcIl0sZnVuY3Rpb24oKXt2YXIgZj0oYlt0aGlzXXx8XCJcIikuc3BsaXQoXCIgXCIpO2lmKGYubGVuZ3RoPT09MSlmPW4udGVzdChmWzBdKT9mLmNvbmNhdChbXCJjZW50ZXJcIl0pOm8udGVzdChmWzBdKT9bXCJjZW50ZXJcIl0uY29uY2F0KGYpOltcImNlbnRlclwiLFwiY2VudGVyXCJdO2ZbMF09bi50ZXN0KGZbMF0pP2ZbMF06XCJjZW50ZXJcIjtmWzFdPW8udGVzdChmWzFdKT9mWzFdOlwiY2VudGVyXCI7Ylt0aGlzXT1mfSk7aWYoZy5sZW5ndGg9PT0xKWdbMV09Z1swXTtlWzBdPXBhcnNlSW50KGVbMF0sMTApfHwwO2lmKGUubGVuZ3RoPT09MSllWzFdPWVbMF07ZVsxXT1wYXJzZUludChlWzFdLDEwKXx8MDtpZihiLmF0WzBdPT09XCJyaWdodFwiKWoubGVmdCs9aDtlbHNlIGlmKGIuYXRbMF09PT1cImNlbnRlclwiKWoubGVmdCs9aC8yO2lmKGIuYXRbMV09PT1cImJvdHRvbVwiKWoudG9wKz1cbms7ZWxzZSBpZihiLmF0WzFdPT09XCJjZW50ZXJcIilqLnRvcCs9ay8yO2oubGVmdCs9ZVswXTtqLnRvcCs9ZVsxXTtyZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKCl7dmFyIGY9Yyh0aGlzKSxsPWYub3V0ZXJXaWR0aCgpLG09Zi5vdXRlckhlaWdodCgpLHA9cGFyc2VJbnQoYy5jdXJDU1ModGhpcyxcIm1hcmdpbkxlZnRcIix0cnVlKSl8fDAscT1wYXJzZUludChjLmN1ckNTUyh0aGlzLFwibWFyZ2luVG9wXCIsdHJ1ZSkpfHwwLHY9bCtwKyhwYXJzZUludChjLmN1ckNTUyh0aGlzLFwibWFyZ2luUmlnaHRcIix0cnVlKSl8fDApLHc9bStxKyhwYXJzZUludChjLmN1ckNTUyh0aGlzLFwibWFyZ2luQm90dG9tXCIsdHJ1ZSkpfHwwKSxpPWMuZXh0ZW5kKHt9LGopLHI7aWYoYi5teVswXT09PVwicmlnaHRcIilpLmxlZnQtPWw7ZWxzZSBpZihiLm15WzBdPT09XCJjZW50ZXJcIilpLmxlZnQtPWwvMjtpZihiLm15WzFdPT09XCJib3R0b21cIilpLnRvcC09bTtlbHNlIGlmKGIubXlbMV09PT1cImNlbnRlclwiKWkudG9wLT1cbm0vMjtpLmxlZnQ9TWF0aC5yb3VuZChpLmxlZnQpO2kudG9wPU1hdGgucm91bmQoaS50b3ApO3I9e2xlZnQ6aS5sZWZ0LXAsdG9wOmkudG9wLXF9O2MuZWFjaChbXCJsZWZ0XCIsXCJ0b3BcIl0sZnVuY3Rpb24ocyx4KXtjLnVpLnBvc2l0aW9uW2dbc11dJiZjLnVpLnBvc2l0aW9uW2dbc11dW3hdKGkse3RhcmdldFdpZHRoOmgsdGFyZ2V0SGVpZ2h0OmssZWxlbVdpZHRoOmwsZWxlbUhlaWdodDptLGNvbGxpc2lvblBvc2l0aW9uOnIsY29sbGlzaW9uV2lkdGg6dixjb2xsaXNpb25IZWlnaHQ6dyxvZmZzZXQ6ZSxteTpiLm15LGF0OmIuYXR9KX0pO2MuZm4uYmdpZnJhbWUmJmYuYmdpZnJhbWUoKTtmLm9mZnNldChjLmV4dGVuZChpLHt1c2luZzpiLnVzaW5nfSkpfSl9O2MudWkucG9zaXRpb249e2ZpdDp7bGVmdDpmdW5jdGlvbihiLGEpe3ZhciBkPWMod2luZG93KTtkPWEuY29sbGlzaW9uUG9zaXRpb24ubGVmdCthLmNvbGxpc2lvbldpZHRoLWQud2lkdGgoKS1kLnNjcm9sbExlZnQoKTtiLmxlZnQ9XG5kPjA/Yi5sZWZ0LWQ6TWF0aC5tYXgoYi5sZWZ0LWEuY29sbGlzaW9uUG9zaXRpb24ubGVmdCxiLmxlZnQpfSx0b3A6ZnVuY3Rpb24oYixhKXt2YXIgZD1jKHdpbmRvdyk7ZD1hLmNvbGxpc2lvblBvc2l0aW9uLnRvcCthLmNvbGxpc2lvbkhlaWdodC1kLmhlaWdodCgpLWQuc2Nyb2xsVG9wKCk7Yi50b3A9ZD4wP2IudG9wLWQ6TWF0aC5tYXgoYi50b3AtYS5jb2xsaXNpb25Qb3NpdGlvbi50b3AsYi50b3ApfX0sZmxpcDp7bGVmdDpmdW5jdGlvbihiLGEpe2lmKGEuYXRbMF0hPT1cImNlbnRlclwiKXt2YXIgZD1jKHdpbmRvdyk7ZD1hLmNvbGxpc2lvblBvc2l0aW9uLmxlZnQrYS5jb2xsaXNpb25XaWR0aC1kLndpZHRoKCktZC5zY3JvbGxMZWZ0KCk7dmFyIGc9YS5teVswXT09PVwibGVmdFwiPy1hLmVsZW1XaWR0aDphLm15WzBdPT09XCJyaWdodFwiP2EuZWxlbVdpZHRoOjAsZT1hLmF0WzBdPT09XCJsZWZ0XCI/YS50YXJnZXRXaWR0aDotYS50YXJnZXRXaWR0aCxoPS0yKmEub2Zmc2V0WzBdO2IubGVmdCs9XG5hLmNvbGxpc2lvblBvc2l0aW9uLmxlZnQ8MD9nK2UraDpkPjA/ZytlK2g6MH19LHRvcDpmdW5jdGlvbihiLGEpe2lmKGEuYXRbMV0hPT1cImNlbnRlclwiKXt2YXIgZD1jKHdpbmRvdyk7ZD1hLmNvbGxpc2lvblBvc2l0aW9uLnRvcCthLmNvbGxpc2lvbkhlaWdodC1kLmhlaWdodCgpLWQuc2Nyb2xsVG9wKCk7dmFyIGc9YS5teVsxXT09PVwidG9wXCI/LWEuZWxlbUhlaWdodDphLm15WzFdPT09XCJib3R0b21cIj9hLmVsZW1IZWlnaHQ6MCxlPWEuYXRbMV09PT1cInRvcFwiP2EudGFyZ2V0SGVpZ2h0Oi1hLnRhcmdldEhlaWdodCxoPS0yKmEub2Zmc2V0WzFdO2IudG9wKz1hLmNvbGxpc2lvblBvc2l0aW9uLnRvcDwwP2crZStoOmQ+MD9nK2UraDowfX19fTtpZighYy5vZmZzZXQuc2V0T2Zmc2V0KXtjLm9mZnNldC5zZXRPZmZzZXQ9ZnVuY3Rpb24oYixhKXtpZigvc3RhdGljLy50ZXN0KGMuY3VyQ1NTKGIsXCJwb3NpdGlvblwiKSkpYi5zdHlsZS5wb3NpdGlvbj1cInJlbGF0aXZlXCI7dmFyIGQ9YyhiKSxcbmc9ZC5vZmZzZXQoKSxlPXBhcnNlSW50KGMuY3VyQ1NTKGIsXCJ0b3BcIix0cnVlKSwxMCl8fDAsaD1wYXJzZUludChjLmN1ckNTUyhiLFwibGVmdFwiLHRydWUpLDEwKXx8MDtnPXt0b3A6YS50b3AtZy50b3ArZSxsZWZ0OmEubGVmdC1nLmxlZnQraH07XCJ1c2luZ1wiaW4gYT9hLnVzaW5nLmNhbGwoYixnKTpkLmNzcyhnKX07Yy5mbi5vZmZzZXQ9ZnVuY3Rpb24oYil7dmFyIGE9dGhpc1swXTtpZighYXx8IWEub3duZXJEb2N1bWVudClyZXR1cm4gbnVsbDtpZihiKXJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oKXtjLm9mZnNldC5zZXRPZmZzZXQodGhpcyxiKX0pO3JldHVybiB1LmNhbGwodGhpcyl9fX0pKGpRdWVyeSk7XG47LypcbiAqIGpRdWVyeSBVSSBEcmFnZ2FibGUgMS44LjE2XG4gKlxuICogQ29weXJpZ2h0IDIwMTEsIEFVVEhPUlMudHh0IChodHRwOi8vanF1ZXJ5dWkuY29tL2Fib3V0KVxuICogRHVhbCBsaWNlbnNlZCB1bmRlciB0aGUgTUlUIG9yIEdQTCBWZXJzaW9uIDIgbGljZW5zZXMuXG4gKiBodHRwOi8vanF1ZXJ5Lm9yZy9saWNlbnNlXG4gKlxuICogaHR0cDovL2RvY3MuanF1ZXJ5LmNvbS9VSS9EcmFnZ2FibGVzXG4gKlxuICogRGVwZW5kczpcbiAqXHRqcXVlcnkudWkuY29yZS5qc1xuICpcdGpxdWVyeS51aS5tb3VzZS5qc1xuICpcdGpxdWVyeS51aS53aWRnZXQuanNcbiAqL1xuKGZ1bmN0aW9uKGQpe2Qud2lkZ2V0KFwidWkuZHJhZ2dhYmxlXCIsZC51aS5tb3VzZSx7d2lkZ2V0RXZlbnRQcmVmaXg6XCJkcmFnXCIsb3B0aW9uczp7YWRkQ2xhc3Nlczp0cnVlLGFwcGVuZFRvOlwicGFyZW50XCIsYXhpczpmYWxzZSxjb25uZWN0VG9Tb3J0YWJsZTpmYWxzZSxjb250YWlubWVudDpmYWxzZSxjdXJzb3I6XCJhdXRvXCIsY3Vyc29yQXQ6ZmFsc2UsZ3JpZDpmYWxzZSxoYW5kbGU6ZmFsc2UsaGVscGVyOlwib3JpZ2luYWxcIixpZnJhbWVGaXg6ZmFsc2Usb3BhY2l0eTpmYWxzZSxyZWZyZXNoUG9zaXRpb25zOmZhbHNlLHJldmVydDpmYWxzZSxyZXZlcnREdXJhdGlvbjo1MDAsc2NvcGU6XCJkZWZhdWx0XCIsc2Nyb2xsOnRydWUsc2Nyb2xsU2Vuc2l0aXZpdHk6MjAsc2Nyb2xsU3BlZWQ6MjAsc25hcDpmYWxzZSxzbmFwTW9kZTpcImJvdGhcIixzbmFwVG9sZXJhbmNlOjIwLHN0YWNrOmZhbHNlLHpJbmRleDpmYWxzZX0sX2NyZWF0ZTpmdW5jdGlvbigpe2lmKHRoaXMub3B0aW9ucy5oZWxwZXI9PVxuXCJvcmlnaW5hbFwiJiYhL14oPzpyfGF8ZikvLnRlc3QodGhpcy5lbGVtZW50LmNzcyhcInBvc2l0aW9uXCIpKSl0aGlzLmVsZW1lbnRbMF0uc3R5bGUucG9zaXRpb249XCJyZWxhdGl2ZVwiO3RoaXMub3B0aW9ucy5hZGRDbGFzc2VzJiZ0aGlzLmVsZW1lbnQuYWRkQ2xhc3MoXCJ1aS1kcmFnZ2FibGVcIik7dGhpcy5vcHRpb25zLmRpc2FibGVkJiZ0aGlzLmVsZW1lbnQuYWRkQ2xhc3MoXCJ1aS1kcmFnZ2FibGUtZGlzYWJsZWRcIik7dGhpcy5fbW91c2VJbml0KCl9LGRlc3Ryb3k6ZnVuY3Rpb24oKXtpZih0aGlzLmVsZW1lbnQuZGF0YShcImRyYWdnYWJsZVwiKSl7dGhpcy5lbGVtZW50LnJlbW92ZURhdGEoXCJkcmFnZ2FibGVcIikudW5iaW5kKFwiLmRyYWdnYWJsZVwiKS5yZW1vdmVDbGFzcyhcInVpLWRyYWdnYWJsZSB1aS1kcmFnZ2FibGUtZHJhZ2dpbmcgdWktZHJhZ2dhYmxlLWRpc2FibGVkXCIpO3RoaXMuX21vdXNlRGVzdHJveSgpO3JldHVybiB0aGlzfX0sX21vdXNlQ2FwdHVyZTpmdW5jdGlvbihhKXt2YXIgYj1cbnRoaXMub3B0aW9ucztpZih0aGlzLmhlbHBlcnx8Yi5kaXNhYmxlZHx8ZChhLnRhcmdldCkuaXMoXCIudWktcmVzaXphYmxlLWhhbmRsZVwiKSlyZXR1cm4gZmFsc2U7dGhpcy5oYW5kbGU9dGhpcy5fZ2V0SGFuZGxlKGEpO2lmKCF0aGlzLmhhbmRsZSlyZXR1cm4gZmFsc2U7aWYoYi5pZnJhbWVGaXgpZChiLmlmcmFtZUZpeD09PXRydWU/XCJpZnJhbWVcIjpiLmlmcmFtZUZpeCkuZWFjaChmdW5jdGlvbigpe2QoJzxkaXYgY2xhc3M9XCJ1aS1kcmFnZ2FibGUtaWZyYW1lRml4XCIgc3R5bGU9XCJiYWNrZ3JvdW5kOiAjZmZmO1wiPjwvZGl2PicpLmNzcyh7d2lkdGg6dGhpcy5vZmZzZXRXaWR0aCtcInB4XCIsaGVpZ2h0OnRoaXMub2Zmc2V0SGVpZ2h0K1wicHhcIixwb3NpdGlvbjpcImFic29sdXRlXCIsb3BhY2l0eTpcIjAuMDAxXCIsekluZGV4OjFFM30pLmNzcyhkKHRoaXMpLm9mZnNldCgpKS5hcHBlbmRUbyhcImJvZHlcIil9KTtyZXR1cm4gdHJ1ZX0sX21vdXNlU3RhcnQ6ZnVuY3Rpb24oYSl7dmFyIGI9dGhpcy5vcHRpb25zO1xudGhpcy5oZWxwZXI9dGhpcy5fY3JlYXRlSGVscGVyKGEpO3RoaXMuX2NhY2hlSGVscGVyUHJvcG9ydGlvbnMoKTtpZihkLnVpLmRkbWFuYWdlcilkLnVpLmRkbWFuYWdlci5jdXJyZW50PXRoaXM7dGhpcy5fY2FjaGVNYXJnaW5zKCk7dGhpcy5jc3NQb3NpdGlvbj10aGlzLmhlbHBlci5jc3MoXCJwb3NpdGlvblwiKTt0aGlzLnNjcm9sbFBhcmVudD10aGlzLmhlbHBlci5zY3JvbGxQYXJlbnQoKTt0aGlzLm9mZnNldD10aGlzLnBvc2l0aW9uQWJzPXRoaXMuZWxlbWVudC5vZmZzZXQoKTt0aGlzLm9mZnNldD17dG9wOnRoaXMub2Zmc2V0LnRvcC10aGlzLm1hcmdpbnMudG9wLGxlZnQ6dGhpcy5vZmZzZXQubGVmdC10aGlzLm1hcmdpbnMubGVmdH07ZC5leHRlbmQodGhpcy5vZmZzZXQse2NsaWNrOntsZWZ0OmEucGFnZVgtdGhpcy5vZmZzZXQubGVmdCx0b3A6YS5wYWdlWS10aGlzLm9mZnNldC50b3B9LHBhcmVudDp0aGlzLl9nZXRQYXJlbnRPZmZzZXQoKSxyZWxhdGl2ZTp0aGlzLl9nZXRSZWxhdGl2ZU9mZnNldCgpfSk7XG50aGlzLm9yaWdpbmFsUG9zaXRpb249dGhpcy5wb3NpdGlvbj10aGlzLl9nZW5lcmF0ZVBvc2l0aW9uKGEpO3RoaXMub3JpZ2luYWxQYWdlWD1hLnBhZ2VYO3RoaXMub3JpZ2luYWxQYWdlWT1hLnBhZ2VZO2IuY3Vyc29yQXQmJnRoaXMuX2FkanVzdE9mZnNldEZyb21IZWxwZXIoYi5jdXJzb3JBdCk7Yi5jb250YWlubWVudCYmdGhpcy5fc2V0Q29udGFpbm1lbnQoKTtpZih0aGlzLl90cmlnZ2VyKFwic3RhcnRcIixhKT09PWZhbHNlKXt0aGlzLl9jbGVhcigpO3JldHVybiBmYWxzZX10aGlzLl9jYWNoZUhlbHBlclByb3BvcnRpb25zKCk7ZC51aS5kZG1hbmFnZXImJiFiLmRyb3BCZWhhdmlvdXImJmQudWkuZGRtYW5hZ2VyLnByZXBhcmVPZmZzZXRzKHRoaXMsYSk7dGhpcy5oZWxwZXIuYWRkQ2xhc3MoXCJ1aS1kcmFnZ2FibGUtZHJhZ2dpbmdcIik7dGhpcy5fbW91c2VEcmFnKGEsdHJ1ZSk7ZC51aS5kZG1hbmFnZXImJmQudWkuZGRtYW5hZ2VyLmRyYWdTdGFydCh0aGlzLGEpO3JldHVybiB0cnVlfSxcbl9tb3VzZURyYWc6ZnVuY3Rpb24oYSxiKXt0aGlzLnBvc2l0aW9uPXRoaXMuX2dlbmVyYXRlUG9zaXRpb24oYSk7dGhpcy5wb3NpdGlvbkFicz10aGlzLl9jb252ZXJ0UG9zaXRpb25UbyhcImFic29sdXRlXCIpO2lmKCFiKXtiPXRoaXMuX3VpSGFzaCgpO2lmKHRoaXMuX3RyaWdnZXIoXCJkcmFnXCIsYSxiKT09PWZhbHNlKXt0aGlzLl9tb3VzZVVwKHt9KTtyZXR1cm4gZmFsc2V9dGhpcy5wb3NpdGlvbj1iLnBvc2l0aW9ufWlmKCF0aGlzLm9wdGlvbnMuYXhpc3x8dGhpcy5vcHRpb25zLmF4aXMhPVwieVwiKXRoaXMuaGVscGVyWzBdLnN0eWxlLmxlZnQ9dGhpcy5wb3NpdGlvbi5sZWZ0K1wicHhcIjtpZighdGhpcy5vcHRpb25zLmF4aXN8fHRoaXMub3B0aW9ucy5heGlzIT1cInhcIil0aGlzLmhlbHBlclswXS5zdHlsZS50b3A9dGhpcy5wb3NpdGlvbi50b3ArXCJweFwiO2QudWkuZGRtYW5hZ2VyJiZkLnVpLmRkbWFuYWdlci5kcmFnKHRoaXMsYSk7cmV0dXJuIGZhbHNlfSxfbW91c2VTdG9wOmZ1bmN0aW9uKGEpe3ZhciBiPVxuZmFsc2U7aWYoZC51aS5kZG1hbmFnZXImJiF0aGlzLm9wdGlvbnMuZHJvcEJlaGF2aW91ciliPWQudWkuZGRtYW5hZ2VyLmRyb3AodGhpcyxhKTtpZih0aGlzLmRyb3BwZWQpe2I9dGhpcy5kcm9wcGVkO3RoaXMuZHJvcHBlZD1mYWxzZX1pZigoIXRoaXMuZWxlbWVudFswXXx8IXRoaXMuZWxlbWVudFswXS5wYXJlbnROb2RlKSYmdGhpcy5vcHRpb25zLmhlbHBlcj09XCJvcmlnaW5hbFwiKXJldHVybiBmYWxzZTtpZih0aGlzLm9wdGlvbnMucmV2ZXJ0PT1cImludmFsaWRcIiYmIWJ8fHRoaXMub3B0aW9ucy5yZXZlcnQ9PVwidmFsaWRcIiYmYnx8dGhpcy5vcHRpb25zLnJldmVydD09PXRydWV8fGQuaXNGdW5jdGlvbih0aGlzLm9wdGlvbnMucmV2ZXJ0KSYmdGhpcy5vcHRpb25zLnJldmVydC5jYWxsKHRoaXMuZWxlbWVudCxiKSl7dmFyIGM9dGhpcztkKHRoaXMuaGVscGVyKS5hbmltYXRlKHRoaXMub3JpZ2luYWxQb3NpdGlvbixwYXJzZUludCh0aGlzLm9wdGlvbnMucmV2ZXJ0RHVyYXRpb24sXG4xMCksZnVuY3Rpb24oKXtjLl90cmlnZ2VyKFwic3RvcFwiLGEpIT09ZmFsc2UmJmMuX2NsZWFyKCl9KX1lbHNlIHRoaXMuX3RyaWdnZXIoXCJzdG9wXCIsYSkhPT1mYWxzZSYmdGhpcy5fY2xlYXIoKTtyZXR1cm4gZmFsc2V9LF9tb3VzZVVwOmZ1bmN0aW9uKGEpe3RoaXMub3B0aW9ucy5pZnJhbWVGaXg9PT10cnVlJiZkKFwiZGl2LnVpLWRyYWdnYWJsZS1pZnJhbWVGaXhcIikuZWFjaChmdW5jdGlvbigpe3RoaXMucGFyZW50Tm9kZS5yZW1vdmVDaGlsZCh0aGlzKX0pO2QudWkuZGRtYW5hZ2VyJiZkLnVpLmRkbWFuYWdlci5kcmFnU3RvcCh0aGlzLGEpO3JldHVybiBkLnVpLm1vdXNlLnByb3RvdHlwZS5fbW91c2VVcC5jYWxsKHRoaXMsYSl9LGNhbmNlbDpmdW5jdGlvbigpe3RoaXMuaGVscGVyLmlzKFwiLnVpLWRyYWdnYWJsZS1kcmFnZ2luZ1wiKT90aGlzLl9tb3VzZVVwKHt9KTp0aGlzLl9jbGVhcigpO3JldHVybiB0aGlzfSxfZ2V0SGFuZGxlOmZ1bmN0aW9uKGEpe3ZhciBiPSF0aGlzLm9wdGlvbnMuaGFuZGxlfHxcbiFkKHRoaXMub3B0aW9ucy5oYW5kbGUsdGhpcy5lbGVtZW50KS5sZW5ndGg/dHJ1ZTpmYWxzZTtkKHRoaXMub3B0aW9ucy5oYW5kbGUsdGhpcy5lbGVtZW50KS5maW5kKFwiKlwiKS5hbmRTZWxmKCkuZWFjaChmdW5jdGlvbigpe2lmKHRoaXM9PWEudGFyZ2V0KWI9dHJ1ZX0pO3JldHVybiBifSxfY3JlYXRlSGVscGVyOmZ1bmN0aW9uKGEpe3ZhciBiPXRoaXMub3B0aW9uczthPWQuaXNGdW5jdGlvbihiLmhlbHBlcik/ZChiLmhlbHBlci5hcHBseSh0aGlzLmVsZW1lbnRbMF0sW2FdKSk6Yi5oZWxwZXI9PVwiY2xvbmVcIj90aGlzLmVsZW1lbnQuY2xvbmUoKS5yZW1vdmVBdHRyKFwiaWRcIik6dGhpcy5lbGVtZW50O2EucGFyZW50cyhcImJvZHlcIikubGVuZ3RofHxhLmFwcGVuZFRvKGIuYXBwZW5kVG89PVwicGFyZW50XCI/dGhpcy5lbGVtZW50WzBdLnBhcmVudE5vZGU6Yi5hcHBlbmRUbyk7YVswXSE9dGhpcy5lbGVtZW50WzBdJiYhLyhmaXhlZHxhYnNvbHV0ZSkvLnRlc3QoYS5jc3MoXCJwb3NpdGlvblwiKSkmJlxuYS5jc3MoXCJwb3NpdGlvblwiLFwiYWJzb2x1dGVcIik7cmV0dXJuIGF9LF9hZGp1c3RPZmZzZXRGcm9tSGVscGVyOmZ1bmN0aW9uKGEpe2lmKHR5cGVvZiBhPT1cInN0cmluZ1wiKWE9YS5zcGxpdChcIiBcIik7aWYoZC5pc0FycmF5KGEpKWE9e2xlZnQ6K2FbMF0sdG9wOithWzFdfHwwfTtpZihcImxlZnRcImluIGEpdGhpcy5vZmZzZXQuY2xpY2subGVmdD1hLmxlZnQrdGhpcy5tYXJnaW5zLmxlZnQ7aWYoXCJyaWdodFwiaW4gYSl0aGlzLm9mZnNldC5jbGljay5sZWZ0PXRoaXMuaGVscGVyUHJvcG9ydGlvbnMud2lkdGgtYS5yaWdodCt0aGlzLm1hcmdpbnMubGVmdDtpZihcInRvcFwiaW4gYSl0aGlzLm9mZnNldC5jbGljay50b3A9YS50b3ArdGhpcy5tYXJnaW5zLnRvcDtpZihcImJvdHRvbVwiaW4gYSl0aGlzLm9mZnNldC5jbGljay50b3A9dGhpcy5oZWxwZXJQcm9wb3J0aW9ucy5oZWlnaHQtYS5ib3R0b20rdGhpcy5tYXJnaW5zLnRvcH0sX2dldFBhcmVudE9mZnNldDpmdW5jdGlvbigpe3RoaXMub2Zmc2V0UGFyZW50PVxudGhpcy5oZWxwZXIub2Zmc2V0UGFyZW50KCk7dmFyIGE9dGhpcy5vZmZzZXRQYXJlbnQub2Zmc2V0KCk7aWYodGhpcy5jc3NQb3NpdGlvbj09XCJhYnNvbHV0ZVwiJiZ0aGlzLnNjcm9sbFBhcmVudFswXSE9ZG9jdW1lbnQmJmQudWkuY29udGFpbnModGhpcy5zY3JvbGxQYXJlbnRbMF0sdGhpcy5vZmZzZXRQYXJlbnRbMF0pKXthLmxlZnQrPXRoaXMuc2Nyb2xsUGFyZW50LnNjcm9sbExlZnQoKTthLnRvcCs9dGhpcy5zY3JvbGxQYXJlbnQuc2Nyb2xsVG9wKCl9aWYodGhpcy5vZmZzZXRQYXJlbnRbMF09PWRvY3VtZW50LmJvZHl8fHRoaXMub2Zmc2V0UGFyZW50WzBdLnRhZ05hbWUmJnRoaXMub2Zmc2V0UGFyZW50WzBdLnRhZ05hbWUudG9Mb3dlckNhc2UoKT09XCJodG1sXCImJmQuYnJvd3Nlci5tc2llKWE9e3RvcDowLGxlZnQ6MH07cmV0dXJue3RvcDphLnRvcCsocGFyc2VJbnQodGhpcy5vZmZzZXRQYXJlbnQuY3NzKFwiYm9yZGVyVG9wV2lkdGhcIiksMTApfHwwKSxsZWZ0OmEubGVmdCsocGFyc2VJbnQodGhpcy5vZmZzZXRQYXJlbnQuY3NzKFwiYm9yZGVyTGVmdFdpZHRoXCIpLFxuMTApfHwwKX19LF9nZXRSZWxhdGl2ZU9mZnNldDpmdW5jdGlvbigpe2lmKHRoaXMuY3NzUG9zaXRpb249PVwicmVsYXRpdmVcIil7dmFyIGE9dGhpcy5lbGVtZW50LnBvc2l0aW9uKCk7cmV0dXJue3RvcDphLnRvcC0ocGFyc2VJbnQodGhpcy5oZWxwZXIuY3NzKFwidG9wXCIpLDEwKXx8MCkrdGhpcy5zY3JvbGxQYXJlbnQuc2Nyb2xsVG9wKCksbGVmdDphLmxlZnQtKHBhcnNlSW50KHRoaXMuaGVscGVyLmNzcyhcImxlZnRcIiksMTApfHwwKSt0aGlzLnNjcm9sbFBhcmVudC5zY3JvbGxMZWZ0KCl9fWVsc2UgcmV0dXJue3RvcDowLGxlZnQ6MH19LF9jYWNoZU1hcmdpbnM6ZnVuY3Rpb24oKXt0aGlzLm1hcmdpbnM9e2xlZnQ6cGFyc2VJbnQodGhpcy5lbGVtZW50LmNzcyhcIm1hcmdpbkxlZnRcIiksMTApfHwwLHRvcDpwYXJzZUludCh0aGlzLmVsZW1lbnQuY3NzKFwibWFyZ2luVG9wXCIpLDEwKXx8MCxyaWdodDpwYXJzZUludCh0aGlzLmVsZW1lbnQuY3NzKFwibWFyZ2luUmlnaHRcIiksMTApfHwwLGJvdHRvbTpwYXJzZUludCh0aGlzLmVsZW1lbnQuY3NzKFwibWFyZ2luQm90dG9tXCIpLFxuMTApfHwwfX0sX2NhY2hlSGVscGVyUHJvcG9ydGlvbnM6ZnVuY3Rpb24oKXt0aGlzLmhlbHBlclByb3BvcnRpb25zPXt3aWR0aDp0aGlzLmhlbHBlci5vdXRlcldpZHRoKCksaGVpZ2h0OnRoaXMuaGVscGVyLm91dGVySGVpZ2h0KCl9fSxfc2V0Q29udGFpbm1lbnQ6ZnVuY3Rpb24oKXt2YXIgYT10aGlzLm9wdGlvbnM7aWYoYS5jb250YWlubWVudD09XCJwYXJlbnRcIilhLmNvbnRhaW5tZW50PXRoaXMuaGVscGVyWzBdLnBhcmVudE5vZGU7aWYoYS5jb250YWlubWVudD09XCJkb2N1bWVudFwifHxhLmNvbnRhaW5tZW50PT1cIndpbmRvd1wiKXRoaXMuY29udGFpbm1lbnQ9W2EuY29udGFpbm1lbnQ9PVwiZG9jdW1lbnRcIj8wOmQod2luZG93KS5zY3JvbGxMZWZ0KCktdGhpcy5vZmZzZXQucmVsYXRpdmUubGVmdC10aGlzLm9mZnNldC5wYXJlbnQubGVmdCxhLmNvbnRhaW5tZW50PT1cImRvY3VtZW50XCI/MDpkKHdpbmRvdykuc2Nyb2xsVG9wKCktdGhpcy5vZmZzZXQucmVsYXRpdmUudG9wLXRoaXMub2Zmc2V0LnBhcmVudC50b3AsXG4oYS5jb250YWlubWVudD09XCJkb2N1bWVudFwiPzA6ZCh3aW5kb3cpLnNjcm9sbExlZnQoKSkrZChhLmNvbnRhaW5tZW50PT1cImRvY3VtZW50XCI/ZG9jdW1lbnQ6d2luZG93KS53aWR0aCgpLXRoaXMuaGVscGVyUHJvcG9ydGlvbnMud2lkdGgtdGhpcy5tYXJnaW5zLmxlZnQsKGEuY29udGFpbm1lbnQ9PVwiZG9jdW1lbnRcIj8wOmQod2luZG93KS5zY3JvbGxUb3AoKSkrKGQoYS5jb250YWlubWVudD09XCJkb2N1bWVudFwiP2RvY3VtZW50OndpbmRvdykuaGVpZ2h0KCl8fGRvY3VtZW50LmJvZHkucGFyZW50Tm9kZS5zY3JvbGxIZWlnaHQpLXRoaXMuaGVscGVyUHJvcG9ydGlvbnMuaGVpZ2h0LXRoaXMubWFyZ2lucy50b3BdO2lmKCEvXihkb2N1bWVudHx3aW5kb3d8cGFyZW50KSQvLnRlc3QoYS5jb250YWlubWVudCkmJmEuY29udGFpbm1lbnQuY29uc3RydWN0b3IhPUFycmF5KXthPWQoYS5jb250YWlubWVudCk7dmFyIGI9YVswXTtpZihiKXthLm9mZnNldCgpO3ZhciBjPWQoYikuY3NzKFwib3ZlcmZsb3dcIikhPVxuXCJoaWRkZW5cIjt0aGlzLmNvbnRhaW5tZW50PVsocGFyc2VJbnQoZChiKS5jc3MoXCJib3JkZXJMZWZ0V2lkdGhcIiksMTApfHwwKSsocGFyc2VJbnQoZChiKS5jc3MoXCJwYWRkaW5nTGVmdFwiKSwxMCl8fDApLChwYXJzZUludChkKGIpLmNzcyhcImJvcmRlclRvcFdpZHRoXCIpLDEwKXx8MCkrKHBhcnNlSW50KGQoYikuY3NzKFwicGFkZGluZ1RvcFwiKSwxMCl8fDApLChjP01hdGgubWF4KGIuc2Nyb2xsV2lkdGgsYi5vZmZzZXRXaWR0aCk6Yi5vZmZzZXRXaWR0aCktKHBhcnNlSW50KGQoYikuY3NzKFwiYm9yZGVyTGVmdFdpZHRoXCIpLDEwKXx8MCktKHBhcnNlSW50KGQoYikuY3NzKFwicGFkZGluZ1JpZ2h0XCIpLDEwKXx8MCktdGhpcy5oZWxwZXJQcm9wb3J0aW9ucy53aWR0aC10aGlzLm1hcmdpbnMubGVmdC10aGlzLm1hcmdpbnMucmlnaHQsKGM/TWF0aC5tYXgoYi5zY3JvbGxIZWlnaHQsYi5vZmZzZXRIZWlnaHQpOmIub2Zmc2V0SGVpZ2h0KS0ocGFyc2VJbnQoZChiKS5jc3MoXCJib3JkZXJUb3BXaWR0aFwiKSxcbjEwKXx8MCktKHBhcnNlSW50KGQoYikuY3NzKFwicGFkZGluZ0JvdHRvbVwiKSwxMCl8fDApLXRoaXMuaGVscGVyUHJvcG9ydGlvbnMuaGVpZ2h0LXRoaXMubWFyZ2lucy50b3AtdGhpcy5tYXJnaW5zLmJvdHRvbV07dGhpcy5yZWxhdGl2ZV9jb250YWluZXI9YX19ZWxzZSBpZihhLmNvbnRhaW5tZW50LmNvbnN0cnVjdG9yPT1BcnJheSl0aGlzLmNvbnRhaW5tZW50PWEuY29udGFpbm1lbnR9LF9jb252ZXJ0UG9zaXRpb25UbzpmdW5jdGlvbihhLGIpe2lmKCFiKWI9dGhpcy5wb3NpdGlvbjthPWE9PVwiYWJzb2x1dGVcIj8xOi0xO3ZhciBjPXRoaXMuY3NzUG9zaXRpb249PVwiYWJzb2x1dGVcIiYmISh0aGlzLnNjcm9sbFBhcmVudFswXSE9ZG9jdW1lbnQmJmQudWkuY29udGFpbnModGhpcy5zY3JvbGxQYXJlbnRbMF0sdGhpcy5vZmZzZXRQYXJlbnRbMF0pKT90aGlzLm9mZnNldFBhcmVudDp0aGlzLnNjcm9sbFBhcmVudCxmPS8oaHRtbHxib2R5KS9pLnRlc3QoY1swXS50YWdOYW1lKTtyZXR1cm57dG9wOmIudG9wK1xudGhpcy5vZmZzZXQucmVsYXRpdmUudG9wKmErdGhpcy5vZmZzZXQucGFyZW50LnRvcCphLShkLmJyb3dzZXIuc2FmYXJpJiZkLmJyb3dzZXIudmVyc2lvbjw1MjYmJnRoaXMuY3NzUG9zaXRpb249PVwiZml4ZWRcIj8wOih0aGlzLmNzc1Bvc2l0aW9uPT1cImZpeGVkXCI/LXRoaXMuc2Nyb2xsUGFyZW50LnNjcm9sbFRvcCgpOmY/MDpjLnNjcm9sbFRvcCgpKSphKSxsZWZ0OmIubGVmdCt0aGlzLm9mZnNldC5yZWxhdGl2ZS5sZWZ0KmErdGhpcy5vZmZzZXQucGFyZW50LmxlZnQqYS0oZC5icm93c2VyLnNhZmFyaSYmZC5icm93c2VyLnZlcnNpb248NTI2JiZ0aGlzLmNzc1Bvc2l0aW9uPT1cImZpeGVkXCI/MDoodGhpcy5jc3NQb3NpdGlvbj09XCJmaXhlZFwiPy10aGlzLnNjcm9sbFBhcmVudC5zY3JvbGxMZWZ0KCk6Zj8wOmMuc2Nyb2xsTGVmdCgpKSphKX19LF9nZW5lcmF0ZVBvc2l0aW9uOmZ1bmN0aW9uKGEpe3ZhciBiPXRoaXMub3B0aW9ucyxjPXRoaXMuY3NzUG9zaXRpb249PVwiYWJzb2x1dGVcIiYmXG4hKHRoaXMuc2Nyb2xsUGFyZW50WzBdIT1kb2N1bWVudCYmZC51aS5jb250YWlucyh0aGlzLnNjcm9sbFBhcmVudFswXSx0aGlzLm9mZnNldFBhcmVudFswXSkpP3RoaXMub2Zmc2V0UGFyZW50OnRoaXMuc2Nyb2xsUGFyZW50LGY9LyhodG1sfGJvZHkpL2kudGVzdChjWzBdLnRhZ05hbWUpLGU9YS5wYWdlWCxoPWEucGFnZVk7aWYodGhpcy5vcmlnaW5hbFBvc2l0aW9uKXt2YXIgZztpZih0aGlzLmNvbnRhaW5tZW50KXtpZih0aGlzLnJlbGF0aXZlX2NvbnRhaW5lcil7Zz10aGlzLnJlbGF0aXZlX2NvbnRhaW5lci5vZmZzZXQoKTtnPVt0aGlzLmNvbnRhaW5tZW50WzBdK2cubGVmdCx0aGlzLmNvbnRhaW5tZW50WzFdK2cudG9wLHRoaXMuY29udGFpbm1lbnRbMl0rZy5sZWZ0LHRoaXMuY29udGFpbm1lbnRbM10rZy50b3BdfWVsc2UgZz10aGlzLmNvbnRhaW5tZW50O2lmKGEucGFnZVgtdGhpcy5vZmZzZXQuY2xpY2subGVmdDxnWzBdKWU9Z1swXSt0aGlzLm9mZnNldC5jbGljay5sZWZ0O1xuaWYoYS5wYWdlWS10aGlzLm9mZnNldC5jbGljay50b3A8Z1sxXSloPWdbMV0rdGhpcy5vZmZzZXQuY2xpY2sudG9wO2lmKGEucGFnZVgtdGhpcy5vZmZzZXQuY2xpY2subGVmdD5nWzJdKWU9Z1syXSt0aGlzLm9mZnNldC5jbGljay5sZWZ0O2lmKGEucGFnZVktdGhpcy5vZmZzZXQuY2xpY2sudG9wPmdbM10paD1nWzNdK3RoaXMub2Zmc2V0LmNsaWNrLnRvcH1pZihiLmdyaWQpe2g9Yi5ncmlkWzFdP3RoaXMub3JpZ2luYWxQYWdlWStNYXRoLnJvdW5kKChoLXRoaXMub3JpZ2luYWxQYWdlWSkvYi5ncmlkWzFdKSpiLmdyaWRbMV06dGhpcy5vcmlnaW5hbFBhZ2VZO2g9Zz8hKGgtdGhpcy5vZmZzZXQuY2xpY2sudG9wPGdbMV18fGgtdGhpcy5vZmZzZXQuY2xpY2sudG9wPmdbM10pP2g6IShoLXRoaXMub2Zmc2V0LmNsaWNrLnRvcDxnWzFdKT9oLWIuZ3JpZFsxXTpoK2IuZ3JpZFsxXTpoO2U9Yi5ncmlkWzBdP3RoaXMub3JpZ2luYWxQYWdlWCtNYXRoLnJvdW5kKChlLXRoaXMub3JpZ2luYWxQYWdlWCkvXG5iLmdyaWRbMF0pKmIuZ3JpZFswXTp0aGlzLm9yaWdpbmFsUGFnZVg7ZT1nPyEoZS10aGlzLm9mZnNldC5jbGljay5sZWZ0PGdbMF18fGUtdGhpcy5vZmZzZXQuY2xpY2subGVmdD5nWzJdKT9lOiEoZS10aGlzLm9mZnNldC5jbGljay5sZWZ0PGdbMF0pP2UtYi5ncmlkWzBdOmUrYi5ncmlkWzBdOmV9fXJldHVybnt0b3A6aC10aGlzLm9mZnNldC5jbGljay50b3AtdGhpcy5vZmZzZXQucmVsYXRpdmUudG9wLXRoaXMub2Zmc2V0LnBhcmVudC50b3ArKGQuYnJvd3Nlci5zYWZhcmkmJmQuYnJvd3Nlci52ZXJzaW9uPDUyNiYmdGhpcy5jc3NQb3NpdGlvbj09XCJmaXhlZFwiPzA6dGhpcy5jc3NQb3NpdGlvbj09XCJmaXhlZFwiPy10aGlzLnNjcm9sbFBhcmVudC5zY3JvbGxUb3AoKTpmPzA6Yy5zY3JvbGxUb3AoKSksbGVmdDplLXRoaXMub2Zmc2V0LmNsaWNrLmxlZnQtdGhpcy5vZmZzZXQucmVsYXRpdmUubGVmdC10aGlzLm9mZnNldC5wYXJlbnQubGVmdCsoZC5icm93c2VyLnNhZmFyaSYmZC5icm93c2VyLnZlcnNpb248XG41MjYmJnRoaXMuY3NzUG9zaXRpb249PVwiZml4ZWRcIj8wOnRoaXMuY3NzUG9zaXRpb249PVwiZml4ZWRcIj8tdGhpcy5zY3JvbGxQYXJlbnQuc2Nyb2xsTGVmdCgpOmY/MDpjLnNjcm9sbExlZnQoKSl9fSxfY2xlYXI6ZnVuY3Rpb24oKXt0aGlzLmhlbHBlci5yZW1vdmVDbGFzcyhcInVpLWRyYWdnYWJsZS1kcmFnZ2luZ1wiKTt0aGlzLmhlbHBlclswXSE9dGhpcy5lbGVtZW50WzBdJiYhdGhpcy5jYW5jZWxIZWxwZXJSZW1vdmFsJiZ0aGlzLmhlbHBlci5yZW1vdmUoKTt0aGlzLmhlbHBlcj1udWxsO3RoaXMuY2FuY2VsSGVscGVyUmVtb3ZhbD1mYWxzZX0sX3RyaWdnZXI6ZnVuY3Rpb24oYSxiLGMpe2M9Y3x8dGhpcy5fdWlIYXNoKCk7ZC51aS5wbHVnaW4uY2FsbCh0aGlzLGEsW2IsY10pO2lmKGE9PVwiZHJhZ1wiKXRoaXMucG9zaXRpb25BYnM9dGhpcy5fY29udmVydFBvc2l0aW9uVG8oXCJhYnNvbHV0ZVwiKTtyZXR1cm4gZC5XaWRnZXQucHJvdG90eXBlLl90cmlnZ2VyLmNhbGwodGhpcyxhLGIsXG5jKX0scGx1Z2luczp7fSxfdWlIYXNoOmZ1bmN0aW9uKCl7cmV0dXJue2hlbHBlcjp0aGlzLmhlbHBlcixwb3NpdGlvbjp0aGlzLnBvc2l0aW9uLG9yaWdpbmFsUG9zaXRpb246dGhpcy5vcmlnaW5hbFBvc2l0aW9uLG9mZnNldDp0aGlzLnBvc2l0aW9uQWJzfX19KTtkLmV4dGVuZChkLnVpLmRyYWdnYWJsZSx7dmVyc2lvbjpcIjEuOC4xNlwifSk7ZC51aS5wbHVnaW4uYWRkKFwiZHJhZ2dhYmxlXCIsXCJjb25uZWN0VG9Tb3J0YWJsZVwiLHtzdGFydDpmdW5jdGlvbihhLGIpe3ZhciBjPWQodGhpcykuZGF0YShcImRyYWdnYWJsZVwiKSxmPWMub3B0aW9ucyxlPWQuZXh0ZW5kKHt9LGIse2l0ZW06Yy5lbGVtZW50fSk7Yy5zb3J0YWJsZXM9W107ZChmLmNvbm5lY3RUb1NvcnRhYmxlKS5lYWNoKGZ1bmN0aW9uKCl7dmFyIGg9ZC5kYXRhKHRoaXMsXCJzb3J0YWJsZVwiKTtpZihoJiYhaC5vcHRpb25zLmRpc2FibGVkKXtjLnNvcnRhYmxlcy5wdXNoKHtpbnN0YW5jZTpoLHNob3VsZFJldmVydDpoLm9wdGlvbnMucmV2ZXJ0fSk7XG5oLnJlZnJlc2hQb3NpdGlvbnMoKTtoLl90cmlnZ2VyKFwiYWN0aXZhdGVcIixhLGUpfX0pfSxzdG9wOmZ1bmN0aW9uKGEsYil7dmFyIGM9ZCh0aGlzKS5kYXRhKFwiZHJhZ2dhYmxlXCIpLGY9ZC5leHRlbmQoe30sYix7aXRlbTpjLmVsZW1lbnR9KTtkLmVhY2goYy5zb3J0YWJsZXMsZnVuY3Rpb24oKXtpZih0aGlzLmluc3RhbmNlLmlzT3Zlcil7dGhpcy5pbnN0YW5jZS5pc092ZXI9MDtjLmNhbmNlbEhlbHBlclJlbW92YWw9dHJ1ZTt0aGlzLmluc3RhbmNlLmNhbmNlbEhlbHBlclJlbW92YWw9ZmFsc2U7aWYodGhpcy5zaG91bGRSZXZlcnQpdGhpcy5pbnN0YW5jZS5vcHRpb25zLnJldmVydD10cnVlO3RoaXMuaW5zdGFuY2UuX21vdXNlU3RvcChhKTt0aGlzLmluc3RhbmNlLm9wdGlvbnMuaGVscGVyPXRoaXMuaW5zdGFuY2Uub3B0aW9ucy5faGVscGVyO2Mub3B0aW9ucy5oZWxwZXI9PVwib3JpZ2luYWxcIiYmdGhpcy5pbnN0YW5jZS5jdXJyZW50SXRlbS5jc3Moe3RvcDpcImF1dG9cIixsZWZ0OlwiYXV0b1wifSl9ZWxzZXt0aGlzLmluc3RhbmNlLmNhbmNlbEhlbHBlclJlbW92YWw9XG5mYWxzZTt0aGlzLmluc3RhbmNlLl90cmlnZ2VyKFwiZGVhY3RpdmF0ZVwiLGEsZil9fSl9LGRyYWc6ZnVuY3Rpb24oYSxiKXt2YXIgYz1kKHRoaXMpLmRhdGEoXCJkcmFnZ2FibGVcIiksZj10aGlzO2QuZWFjaChjLnNvcnRhYmxlcyxmdW5jdGlvbigpe3RoaXMuaW5zdGFuY2UucG9zaXRpb25BYnM9Yy5wb3NpdGlvbkFiczt0aGlzLmluc3RhbmNlLmhlbHBlclByb3BvcnRpb25zPWMuaGVscGVyUHJvcG9ydGlvbnM7dGhpcy5pbnN0YW5jZS5vZmZzZXQuY2xpY2s9Yy5vZmZzZXQuY2xpY2s7aWYodGhpcy5pbnN0YW5jZS5faW50ZXJzZWN0c1dpdGgodGhpcy5pbnN0YW5jZS5jb250YWluZXJDYWNoZSkpe2lmKCF0aGlzLmluc3RhbmNlLmlzT3Zlcil7dGhpcy5pbnN0YW5jZS5pc092ZXI9MTt0aGlzLmluc3RhbmNlLmN1cnJlbnRJdGVtPWQoZikuY2xvbmUoKS5yZW1vdmVBdHRyKFwiaWRcIikuYXBwZW5kVG8odGhpcy5pbnN0YW5jZS5lbGVtZW50KS5kYXRhKFwic29ydGFibGUtaXRlbVwiLHRydWUpO1xudGhpcy5pbnN0YW5jZS5vcHRpb25zLl9oZWxwZXI9dGhpcy5pbnN0YW5jZS5vcHRpb25zLmhlbHBlcjt0aGlzLmluc3RhbmNlLm9wdGlvbnMuaGVscGVyPWZ1bmN0aW9uKCl7cmV0dXJuIGIuaGVscGVyWzBdfTthLnRhcmdldD10aGlzLmluc3RhbmNlLmN1cnJlbnRJdGVtWzBdO3RoaXMuaW5zdGFuY2UuX21vdXNlQ2FwdHVyZShhLHRydWUpO3RoaXMuaW5zdGFuY2UuX21vdXNlU3RhcnQoYSx0cnVlLHRydWUpO3RoaXMuaW5zdGFuY2Uub2Zmc2V0LmNsaWNrLnRvcD1jLm9mZnNldC5jbGljay50b3A7dGhpcy5pbnN0YW5jZS5vZmZzZXQuY2xpY2subGVmdD1jLm9mZnNldC5jbGljay5sZWZ0O3RoaXMuaW5zdGFuY2Uub2Zmc2V0LnBhcmVudC5sZWZ0LT1jLm9mZnNldC5wYXJlbnQubGVmdC10aGlzLmluc3RhbmNlLm9mZnNldC5wYXJlbnQubGVmdDt0aGlzLmluc3RhbmNlLm9mZnNldC5wYXJlbnQudG9wLT1jLm9mZnNldC5wYXJlbnQudG9wLXRoaXMuaW5zdGFuY2Uub2Zmc2V0LnBhcmVudC50b3A7XG5jLl90cmlnZ2VyKFwidG9Tb3J0YWJsZVwiLGEpO2MuZHJvcHBlZD10aGlzLmluc3RhbmNlLmVsZW1lbnQ7Yy5jdXJyZW50SXRlbT1jLmVsZW1lbnQ7dGhpcy5pbnN0YW5jZS5mcm9tT3V0c2lkZT1jfXRoaXMuaW5zdGFuY2UuY3VycmVudEl0ZW0mJnRoaXMuaW5zdGFuY2UuX21vdXNlRHJhZyhhKX1lbHNlIGlmKHRoaXMuaW5zdGFuY2UuaXNPdmVyKXt0aGlzLmluc3RhbmNlLmlzT3Zlcj0wO3RoaXMuaW5zdGFuY2UuY2FuY2VsSGVscGVyUmVtb3ZhbD10cnVlO3RoaXMuaW5zdGFuY2Uub3B0aW9ucy5yZXZlcnQ9ZmFsc2U7dGhpcy5pbnN0YW5jZS5fdHJpZ2dlcihcIm91dFwiLGEsdGhpcy5pbnN0YW5jZS5fdWlIYXNoKHRoaXMuaW5zdGFuY2UpKTt0aGlzLmluc3RhbmNlLl9tb3VzZVN0b3AoYSx0cnVlKTt0aGlzLmluc3RhbmNlLm9wdGlvbnMuaGVscGVyPXRoaXMuaW5zdGFuY2Uub3B0aW9ucy5faGVscGVyO3RoaXMuaW5zdGFuY2UuY3VycmVudEl0ZW0ucmVtb3ZlKCk7dGhpcy5pbnN0YW5jZS5wbGFjZWhvbGRlciYmXG50aGlzLmluc3RhbmNlLnBsYWNlaG9sZGVyLnJlbW92ZSgpO2MuX3RyaWdnZXIoXCJmcm9tU29ydGFibGVcIixhKTtjLmRyb3BwZWQ9ZmFsc2V9fSl9fSk7ZC51aS5wbHVnaW4uYWRkKFwiZHJhZ2dhYmxlXCIsXCJjdXJzb3JcIix7c3RhcnQ6ZnVuY3Rpb24oKXt2YXIgYT1kKFwiYm9keVwiKSxiPWQodGhpcykuZGF0YShcImRyYWdnYWJsZVwiKS5vcHRpb25zO2lmKGEuY3NzKFwiY3Vyc29yXCIpKWIuX2N1cnNvcj1hLmNzcyhcImN1cnNvclwiKTthLmNzcyhcImN1cnNvclwiLGIuY3Vyc29yKX0sc3RvcDpmdW5jdGlvbigpe3ZhciBhPWQodGhpcykuZGF0YShcImRyYWdnYWJsZVwiKS5vcHRpb25zO2EuX2N1cnNvciYmZChcImJvZHlcIikuY3NzKFwiY3Vyc29yXCIsYS5fY3Vyc29yKX19KTtkLnVpLnBsdWdpbi5hZGQoXCJkcmFnZ2FibGVcIixcIm9wYWNpdHlcIix7c3RhcnQ6ZnVuY3Rpb24oYSxiKXthPWQoYi5oZWxwZXIpO2I9ZCh0aGlzKS5kYXRhKFwiZHJhZ2dhYmxlXCIpLm9wdGlvbnM7aWYoYS5jc3MoXCJvcGFjaXR5XCIpKWIuX29wYWNpdHk9XG5hLmNzcyhcIm9wYWNpdHlcIik7YS5jc3MoXCJvcGFjaXR5XCIsYi5vcGFjaXR5KX0sc3RvcDpmdW5jdGlvbihhLGIpe2E9ZCh0aGlzKS5kYXRhKFwiZHJhZ2dhYmxlXCIpLm9wdGlvbnM7YS5fb3BhY2l0eSYmZChiLmhlbHBlcikuY3NzKFwib3BhY2l0eVwiLGEuX29wYWNpdHkpfX0pO2QudWkucGx1Z2luLmFkZChcImRyYWdnYWJsZVwiLFwic2Nyb2xsXCIse3N0YXJ0OmZ1bmN0aW9uKCl7dmFyIGE9ZCh0aGlzKS5kYXRhKFwiZHJhZ2dhYmxlXCIpO2lmKGEuc2Nyb2xsUGFyZW50WzBdIT1kb2N1bWVudCYmYS5zY3JvbGxQYXJlbnRbMF0udGFnTmFtZSE9XCJIVE1MXCIpYS5vdmVyZmxvd09mZnNldD1hLnNjcm9sbFBhcmVudC5vZmZzZXQoKX0sZHJhZzpmdW5jdGlvbihhKXt2YXIgYj1kKHRoaXMpLmRhdGEoXCJkcmFnZ2FibGVcIiksYz1iLm9wdGlvbnMsZj1mYWxzZTtpZihiLnNjcm9sbFBhcmVudFswXSE9ZG9jdW1lbnQmJmIuc2Nyb2xsUGFyZW50WzBdLnRhZ05hbWUhPVwiSFRNTFwiKXtpZighYy5heGlzfHxjLmF4aXMhPVxuXCJ4XCIpaWYoYi5vdmVyZmxvd09mZnNldC50b3ArYi5zY3JvbGxQYXJlbnRbMF0ub2Zmc2V0SGVpZ2h0LWEucGFnZVk8Yy5zY3JvbGxTZW5zaXRpdml0eSliLnNjcm9sbFBhcmVudFswXS5zY3JvbGxUb3A9Zj1iLnNjcm9sbFBhcmVudFswXS5zY3JvbGxUb3ArYy5zY3JvbGxTcGVlZDtlbHNlIGlmKGEucGFnZVktYi5vdmVyZmxvd09mZnNldC50b3A8Yy5zY3JvbGxTZW5zaXRpdml0eSliLnNjcm9sbFBhcmVudFswXS5zY3JvbGxUb3A9Zj1iLnNjcm9sbFBhcmVudFswXS5zY3JvbGxUb3AtYy5zY3JvbGxTcGVlZDtpZighYy5heGlzfHxjLmF4aXMhPVwieVwiKWlmKGIub3ZlcmZsb3dPZmZzZXQubGVmdCtiLnNjcm9sbFBhcmVudFswXS5vZmZzZXRXaWR0aC1hLnBhZ2VYPGMuc2Nyb2xsU2Vuc2l0aXZpdHkpYi5zY3JvbGxQYXJlbnRbMF0uc2Nyb2xsTGVmdD1mPWIuc2Nyb2xsUGFyZW50WzBdLnNjcm9sbExlZnQrYy5zY3JvbGxTcGVlZDtlbHNlIGlmKGEucGFnZVgtYi5vdmVyZmxvd09mZnNldC5sZWZ0PFxuYy5zY3JvbGxTZW5zaXRpdml0eSliLnNjcm9sbFBhcmVudFswXS5zY3JvbGxMZWZ0PWY9Yi5zY3JvbGxQYXJlbnRbMF0uc2Nyb2xsTGVmdC1jLnNjcm9sbFNwZWVkfWVsc2V7aWYoIWMuYXhpc3x8Yy5heGlzIT1cInhcIilpZihhLnBhZ2VZLWQoZG9jdW1lbnQpLnNjcm9sbFRvcCgpPGMuc2Nyb2xsU2Vuc2l0aXZpdHkpZj1kKGRvY3VtZW50KS5zY3JvbGxUb3AoZChkb2N1bWVudCkuc2Nyb2xsVG9wKCktYy5zY3JvbGxTcGVlZCk7ZWxzZSBpZihkKHdpbmRvdykuaGVpZ2h0KCktKGEucGFnZVktZChkb2N1bWVudCkuc2Nyb2xsVG9wKCkpPGMuc2Nyb2xsU2Vuc2l0aXZpdHkpZj1kKGRvY3VtZW50KS5zY3JvbGxUb3AoZChkb2N1bWVudCkuc2Nyb2xsVG9wKCkrYy5zY3JvbGxTcGVlZCk7aWYoIWMuYXhpc3x8Yy5heGlzIT1cInlcIilpZihhLnBhZ2VYLWQoZG9jdW1lbnQpLnNjcm9sbExlZnQoKTxjLnNjcm9sbFNlbnNpdGl2aXR5KWY9ZChkb2N1bWVudCkuc2Nyb2xsTGVmdChkKGRvY3VtZW50KS5zY3JvbGxMZWZ0KCktXG5jLnNjcm9sbFNwZWVkKTtlbHNlIGlmKGQod2luZG93KS53aWR0aCgpLShhLnBhZ2VYLWQoZG9jdW1lbnQpLnNjcm9sbExlZnQoKSk8Yy5zY3JvbGxTZW5zaXRpdml0eSlmPWQoZG9jdW1lbnQpLnNjcm9sbExlZnQoZChkb2N1bWVudCkuc2Nyb2xsTGVmdCgpK2Muc2Nyb2xsU3BlZWQpfWYhPT1mYWxzZSYmZC51aS5kZG1hbmFnZXImJiFjLmRyb3BCZWhhdmlvdXImJmQudWkuZGRtYW5hZ2VyLnByZXBhcmVPZmZzZXRzKGIsYSl9fSk7ZC51aS5wbHVnaW4uYWRkKFwiZHJhZ2dhYmxlXCIsXCJzbmFwXCIse3N0YXJ0OmZ1bmN0aW9uKCl7dmFyIGE9ZCh0aGlzKS5kYXRhKFwiZHJhZ2dhYmxlXCIpLGI9YS5vcHRpb25zO2Euc25hcEVsZW1lbnRzPVtdO2QoYi5zbmFwLmNvbnN0cnVjdG9yIT1TdHJpbmc/Yi5zbmFwLml0ZW1zfHxcIjpkYXRhKGRyYWdnYWJsZSlcIjpiLnNuYXApLmVhY2goZnVuY3Rpb24oKXt2YXIgYz1kKHRoaXMpLGY9Yy5vZmZzZXQoKTt0aGlzIT1hLmVsZW1lbnRbMF0mJmEuc25hcEVsZW1lbnRzLnB1c2goe2l0ZW06dGhpcyxcbndpZHRoOmMub3V0ZXJXaWR0aCgpLGhlaWdodDpjLm91dGVySGVpZ2h0KCksdG9wOmYudG9wLGxlZnQ6Zi5sZWZ0fSl9KX0sZHJhZzpmdW5jdGlvbihhLGIpe2Zvcih2YXIgYz1kKHRoaXMpLmRhdGEoXCJkcmFnZ2FibGVcIiksZj1jLm9wdGlvbnMsZT1mLnNuYXBUb2xlcmFuY2UsaD1iLm9mZnNldC5sZWZ0LGc9aCtjLmhlbHBlclByb3BvcnRpb25zLndpZHRoLG49Yi5vZmZzZXQudG9wLG89bitjLmhlbHBlclByb3BvcnRpb25zLmhlaWdodCxpPWMuc25hcEVsZW1lbnRzLmxlbmd0aC0xO2k+PTA7aS0tKXt2YXIgaj1jLnNuYXBFbGVtZW50c1tpXS5sZWZ0LGw9aitjLnNuYXBFbGVtZW50c1tpXS53aWR0aCxrPWMuc25hcEVsZW1lbnRzW2ldLnRvcCxtPWsrYy5zbmFwRWxlbWVudHNbaV0uaGVpZ2h0O2lmKGotZTxoJiZoPGwrZSYmay1lPG4mJm48bStlfHxqLWU8aCYmaDxsK2UmJmstZTxvJiZvPG0rZXx8ai1lPGcmJmc8bCtlJiZrLWU8biYmbjxtK2V8fGotZTxnJiZnPGwrZSYmay1lPG8mJlxubzxtK2Upe2lmKGYuc25hcE1vZGUhPVwiaW5uZXJcIil7dmFyIHA9TWF0aC5hYnMoay1vKTw9ZSxxPU1hdGguYWJzKG0tbik8PWUscj1NYXRoLmFicyhqLWcpPD1lLHM9TWF0aC5hYnMobC1oKTw9ZTtpZihwKWIucG9zaXRpb24udG9wPWMuX2NvbnZlcnRQb3NpdGlvblRvKFwicmVsYXRpdmVcIix7dG9wOmstYy5oZWxwZXJQcm9wb3J0aW9ucy5oZWlnaHQsbGVmdDowfSkudG9wLWMubWFyZ2lucy50b3A7aWYocSliLnBvc2l0aW9uLnRvcD1jLl9jb252ZXJ0UG9zaXRpb25UbyhcInJlbGF0aXZlXCIse3RvcDptLGxlZnQ6MH0pLnRvcC1jLm1hcmdpbnMudG9wO2lmKHIpYi5wb3NpdGlvbi5sZWZ0PWMuX2NvbnZlcnRQb3NpdGlvblRvKFwicmVsYXRpdmVcIix7dG9wOjAsbGVmdDpqLWMuaGVscGVyUHJvcG9ydGlvbnMud2lkdGh9KS5sZWZ0LWMubWFyZ2lucy5sZWZ0O2lmKHMpYi5wb3NpdGlvbi5sZWZ0PWMuX2NvbnZlcnRQb3NpdGlvblRvKFwicmVsYXRpdmVcIix7dG9wOjAsbGVmdDpsfSkubGVmdC1jLm1hcmdpbnMubGVmdH12YXIgdD1cbnB8fHF8fHJ8fHM7aWYoZi5zbmFwTW9kZSE9XCJvdXRlclwiKXtwPU1hdGguYWJzKGstbik8PWU7cT1NYXRoLmFicyhtLW8pPD1lO3I9TWF0aC5hYnMoai1oKTw9ZTtzPU1hdGguYWJzKGwtZyk8PWU7aWYocCliLnBvc2l0aW9uLnRvcD1jLl9jb252ZXJ0UG9zaXRpb25UbyhcInJlbGF0aXZlXCIse3RvcDprLGxlZnQ6MH0pLnRvcC1jLm1hcmdpbnMudG9wO2lmKHEpYi5wb3NpdGlvbi50b3A9Yy5fY29udmVydFBvc2l0aW9uVG8oXCJyZWxhdGl2ZVwiLHt0b3A6bS1jLmhlbHBlclByb3BvcnRpb25zLmhlaWdodCxsZWZ0OjB9KS50b3AtYy5tYXJnaW5zLnRvcDtpZihyKWIucG9zaXRpb24ubGVmdD1jLl9jb252ZXJ0UG9zaXRpb25UbyhcInJlbGF0aXZlXCIse3RvcDowLGxlZnQ6an0pLmxlZnQtYy5tYXJnaW5zLmxlZnQ7aWYocyliLnBvc2l0aW9uLmxlZnQ9Yy5fY29udmVydFBvc2l0aW9uVG8oXCJyZWxhdGl2ZVwiLHt0b3A6MCxsZWZ0OmwtYy5oZWxwZXJQcm9wb3J0aW9ucy53aWR0aH0pLmxlZnQtYy5tYXJnaW5zLmxlZnR9aWYoIWMuc25hcEVsZW1lbnRzW2ldLnNuYXBwaW5nJiZcbihwfHxxfHxyfHxzfHx0KSljLm9wdGlvbnMuc25hcC5zbmFwJiZjLm9wdGlvbnMuc25hcC5zbmFwLmNhbGwoYy5lbGVtZW50LGEsZC5leHRlbmQoYy5fdWlIYXNoKCkse3NuYXBJdGVtOmMuc25hcEVsZW1lbnRzW2ldLml0ZW19KSk7Yy5zbmFwRWxlbWVudHNbaV0uc25hcHBpbmc9cHx8cXx8cnx8c3x8dH1lbHNle2Muc25hcEVsZW1lbnRzW2ldLnNuYXBwaW5nJiZjLm9wdGlvbnMuc25hcC5yZWxlYXNlJiZjLm9wdGlvbnMuc25hcC5yZWxlYXNlLmNhbGwoYy5lbGVtZW50LGEsZC5leHRlbmQoYy5fdWlIYXNoKCkse3NuYXBJdGVtOmMuc25hcEVsZW1lbnRzW2ldLml0ZW19KSk7Yy5zbmFwRWxlbWVudHNbaV0uc25hcHBpbmc9ZmFsc2V9fX19KTtkLnVpLnBsdWdpbi5hZGQoXCJkcmFnZ2FibGVcIixcInN0YWNrXCIse3N0YXJ0OmZ1bmN0aW9uKCl7dmFyIGE9ZCh0aGlzKS5kYXRhKFwiZHJhZ2dhYmxlXCIpLm9wdGlvbnM7YT1kLm1ha2VBcnJheShkKGEuc3RhY2spKS5zb3J0KGZ1bmN0aW9uKGMsZil7cmV0dXJuKHBhcnNlSW50KGQoYykuY3NzKFwiekluZGV4XCIpLFxuMTApfHwwKS0ocGFyc2VJbnQoZChmKS5jc3MoXCJ6SW5kZXhcIiksMTApfHwwKX0pO2lmKGEubGVuZ3RoKXt2YXIgYj1wYXJzZUludChhWzBdLnN0eWxlLnpJbmRleCl8fDA7ZChhKS5lYWNoKGZ1bmN0aW9uKGMpe3RoaXMuc3R5bGUuekluZGV4PWIrY30pO3RoaXNbMF0uc3R5bGUuekluZGV4PWIrYS5sZW5ndGh9fX0pO2QudWkucGx1Z2luLmFkZChcImRyYWdnYWJsZVwiLFwiekluZGV4XCIse3N0YXJ0OmZ1bmN0aW9uKGEsYil7YT1kKGIuaGVscGVyKTtiPWQodGhpcykuZGF0YShcImRyYWdnYWJsZVwiKS5vcHRpb25zO2lmKGEuY3NzKFwiekluZGV4XCIpKWIuX3pJbmRleD1hLmNzcyhcInpJbmRleFwiKTthLmNzcyhcInpJbmRleFwiLGIuekluZGV4KX0sc3RvcDpmdW5jdGlvbihhLGIpe2E9ZCh0aGlzKS5kYXRhKFwiZHJhZ2dhYmxlXCIpLm9wdGlvbnM7YS5fekluZGV4JiZkKGIuaGVscGVyKS5jc3MoXCJ6SW5kZXhcIixhLl96SW5kZXgpfX0pfSkoalF1ZXJ5KTtcbjsvKlxuICogalF1ZXJ5IFVJIERyb3BwYWJsZSAxLjguMTZcbiAqXG4gKiBDb3B5cmlnaHQgMjAxMSwgQVVUSE9SUy50eHQgKGh0dHA6Ly9qcXVlcnl1aS5jb20vYWJvdXQpXG4gKiBEdWFsIGxpY2Vuc2VkIHVuZGVyIHRoZSBNSVQgb3IgR1BMIFZlcnNpb24gMiBsaWNlbnNlcy5cbiAqIGh0dHA6Ly9qcXVlcnkub3JnL2xpY2Vuc2VcbiAqXG4gKiBodHRwOi8vZG9jcy5qcXVlcnkuY29tL1VJL0Ryb3BwYWJsZXNcbiAqXG4gKiBEZXBlbmRzOlxuICpcdGpxdWVyeS51aS5jb3JlLmpzXG4gKlx0anF1ZXJ5LnVpLndpZGdldC5qc1xuICpcdGpxdWVyeS51aS5tb3VzZS5qc1xuICpcdGpxdWVyeS51aS5kcmFnZ2FibGUuanNcbiAqL1xuKGZ1bmN0aW9uKGQpe2Qud2lkZ2V0KFwidWkuZHJvcHBhYmxlXCIse3dpZGdldEV2ZW50UHJlZml4OlwiZHJvcFwiLG9wdGlvbnM6e2FjY2VwdDpcIipcIixhY3RpdmVDbGFzczpmYWxzZSxhZGRDbGFzc2VzOnRydWUsZ3JlZWR5OmZhbHNlLGhvdmVyQ2xhc3M6ZmFsc2Usc2NvcGU6XCJkZWZhdWx0XCIsdG9sZXJhbmNlOlwiaW50ZXJzZWN0XCJ9LF9jcmVhdGU6ZnVuY3Rpb24oKXt2YXIgYT10aGlzLm9wdGlvbnMsYj1hLmFjY2VwdDt0aGlzLmlzb3Zlcj0wO3RoaXMuaXNvdXQ9MTt0aGlzLmFjY2VwdD1kLmlzRnVuY3Rpb24oYik/YjpmdW5jdGlvbihjKXtyZXR1cm4gYy5pcyhiKX07dGhpcy5wcm9wb3J0aW9ucz17d2lkdGg6dGhpcy5lbGVtZW50WzBdLm9mZnNldFdpZHRoLGhlaWdodDp0aGlzLmVsZW1lbnRbMF0ub2Zmc2V0SGVpZ2h0fTtkLnVpLmRkbWFuYWdlci5kcm9wcGFibGVzW2Euc2NvcGVdPWQudWkuZGRtYW5hZ2VyLmRyb3BwYWJsZXNbYS5zY29wZV18fFtdO2QudWkuZGRtYW5hZ2VyLmRyb3BwYWJsZXNbYS5zY29wZV0ucHVzaCh0aGlzKTtcbmEuYWRkQ2xhc3NlcyYmdGhpcy5lbGVtZW50LmFkZENsYXNzKFwidWktZHJvcHBhYmxlXCIpfSxkZXN0cm95OmZ1bmN0aW9uKCl7Zm9yKHZhciBhPWQudWkuZGRtYW5hZ2VyLmRyb3BwYWJsZXNbdGhpcy5vcHRpb25zLnNjb3BlXSxiPTA7YjxhLmxlbmd0aDtiKyspYVtiXT09dGhpcyYmYS5zcGxpY2UoYiwxKTt0aGlzLmVsZW1lbnQucmVtb3ZlQ2xhc3MoXCJ1aS1kcm9wcGFibGUgdWktZHJvcHBhYmxlLWRpc2FibGVkXCIpLnJlbW92ZURhdGEoXCJkcm9wcGFibGVcIikudW5iaW5kKFwiLmRyb3BwYWJsZVwiKTtyZXR1cm4gdGhpc30sX3NldE9wdGlvbjpmdW5jdGlvbihhLGIpe2lmKGE9PVwiYWNjZXB0XCIpdGhpcy5hY2NlcHQ9ZC5pc0Z1bmN0aW9uKGIpP2I6ZnVuY3Rpb24oYyl7cmV0dXJuIGMuaXMoYil9O2QuV2lkZ2V0LnByb3RvdHlwZS5fc2V0T3B0aW9uLmFwcGx5KHRoaXMsYXJndW1lbnRzKX0sX2FjdGl2YXRlOmZ1bmN0aW9uKGEpe3ZhciBiPWQudWkuZGRtYW5hZ2VyLmN1cnJlbnQ7dGhpcy5vcHRpb25zLmFjdGl2ZUNsYXNzJiZcbnRoaXMuZWxlbWVudC5hZGRDbGFzcyh0aGlzLm9wdGlvbnMuYWN0aXZlQ2xhc3MpO2ImJnRoaXMuX3RyaWdnZXIoXCJhY3RpdmF0ZVwiLGEsdGhpcy51aShiKSl9LF9kZWFjdGl2YXRlOmZ1bmN0aW9uKGEpe3ZhciBiPWQudWkuZGRtYW5hZ2VyLmN1cnJlbnQ7dGhpcy5vcHRpb25zLmFjdGl2ZUNsYXNzJiZ0aGlzLmVsZW1lbnQucmVtb3ZlQ2xhc3ModGhpcy5vcHRpb25zLmFjdGl2ZUNsYXNzKTtiJiZ0aGlzLl90cmlnZ2VyKFwiZGVhY3RpdmF0ZVwiLGEsdGhpcy51aShiKSl9LF9vdmVyOmZ1bmN0aW9uKGEpe3ZhciBiPWQudWkuZGRtYW5hZ2VyLmN1cnJlbnQ7aWYoISghYnx8KGIuY3VycmVudEl0ZW18fGIuZWxlbWVudClbMF09PXRoaXMuZWxlbWVudFswXSkpaWYodGhpcy5hY2NlcHQuY2FsbCh0aGlzLmVsZW1lbnRbMF0sYi5jdXJyZW50SXRlbXx8Yi5lbGVtZW50KSl7dGhpcy5vcHRpb25zLmhvdmVyQ2xhc3MmJnRoaXMuZWxlbWVudC5hZGRDbGFzcyh0aGlzLm9wdGlvbnMuaG92ZXJDbGFzcyk7XG50aGlzLl90cmlnZ2VyKFwib3ZlclwiLGEsdGhpcy51aShiKSl9fSxfb3V0OmZ1bmN0aW9uKGEpe3ZhciBiPWQudWkuZGRtYW5hZ2VyLmN1cnJlbnQ7aWYoISghYnx8KGIuY3VycmVudEl0ZW18fGIuZWxlbWVudClbMF09PXRoaXMuZWxlbWVudFswXSkpaWYodGhpcy5hY2NlcHQuY2FsbCh0aGlzLmVsZW1lbnRbMF0sYi5jdXJyZW50SXRlbXx8Yi5lbGVtZW50KSl7dGhpcy5vcHRpb25zLmhvdmVyQ2xhc3MmJnRoaXMuZWxlbWVudC5yZW1vdmVDbGFzcyh0aGlzLm9wdGlvbnMuaG92ZXJDbGFzcyk7dGhpcy5fdHJpZ2dlcihcIm91dFwiLGEsdGhpcy51aShiKSl9fSxfZHJvcDpmdW5jdGlvbihhLGIpe3ZhciBjPWJ8fGQudWkuZGRtYW5hZ2VyLmN1cnJlbnQ7aWYoIWN8fChjLmN1cnJlbnRJdGVtfHxjLmVsZW1lbnQpWzBdPT10aGlzLmVsZW1lbnRbMF0pcmV0dXJuIGZhbHNlO3ZhciBlPWZhbHNlO3RoaXMuZWxlbWVudC5maW5kKFwiOmRhdGEoZHJvcHBhYmxlKVwiKS5ub3QoXCIudWktZHJhZ2dhYmxlLWRyYWdnaW5nXCIpLmVhY2goZnVuY3Rpb24oKXt2YXIgZz1cbmQuZGF0YSh0aGlzLFwiZHJvcHBhYmxlXCIpO2lmKGcub3B0aW9ucy5ncmVlZHkmJiFnLm9wdGlvbnMuZGlzYWJsZWQmJmcub3B0aW9ucy5zY29wZT09Yy5vcHRpb25zLnNjb3BlJiZnLmFjY2VwdC5jYWxsKGcuZWxlbWVudFswXSxjLmN1cnJlbnRJdGVtfHxjLmVsZW1lbnQpJiZkLnVpLmludGVyc2VjdChjLGQuZXh0ZW5kKGcse29mZnNldDpnLmVsZW1lbnQub2Zmc2V0KCl9KSxnLm9wdGlvbnMudG9sZXJhbmNlKSl7ZT10cnVlO3JldHVybiBmYWxzZX19KTtpZihlKXJldHVybiBmYWxzZTtpZih0aGlzLmFjY2VwdC5jYWxsKHRoaXMuZWxlbWVudFswXSxjLmN1cnJlbnRJdGVtfHxjLmVsZW1lbnQpKXt0aGlzLm9wdGlvbnMuYWN0aXZlQ2xhc3MmJnRoaXMuZWxlbWVudC5yZW1vdmVDbGFzcyh0aGlzLm9wdGlvbnMuYWN0aXZlQ2xhc3MpO3RoaXMub3B0aW9ucy5ob3ZlckNsYXNzJiZ0aGlzLmVsZW1lbnQucmVtb3ZlQ2xhc3ModGhpcy5vcHRpb25zLmhvdmVyQ2xhc3MpO3RoaXMuX3RyaWdnZXIoXCJkcm9wXCIsXG5hLHRoaXMudWkoYykpO3JldHVybiB0aGlzLmVsZW1lbnR9cmV0dXJuIGZhbHNlfSx1aTpmdW5jdGlvbihhKXtyZXR1cm57ZHJhZ2dhYmxlOmEuY3VycmVudEl0ZW18fGEuZWxlbWVudCxoZWxwZXI6YS5oZWxwZXIscG9zaXRpb246YS5wb3NpdGlvbixvZmZzZXQ6YS5wb3NpdGlvbkFic319fSk7ZC5leHRlbmQoZC51aS5kcm9wcGFibGUse3ZlcnNpb246XCIxLjguMTZcIn0pO2QudWkuaW50ZXJzZWN0PWZ1bmN0aW9uKGEsYixjKXtpZighYi5vZmZzZXQpcmV0dXJuIGZhbHNlO3ZhciBlPShhLnBvc2l0aW9uQWJzfHxhLnBvc2l0aW9uLmFic29sdXRlKS5sZWZ0LGc9ZSthLmhlbHBlclByb3BvcnRpb25zLndpZHRoLGY9KGEucG9zaXRpb25BYnN8fGEucG9zaXRpb24uYWJzb2x1dGUpLnRvcCxoPWYrYS5oZWxwZXJQcm9wb3J0aW9ucy5oZWlnaHQsaT1iLm9mZnNldC5sZWZ0LGs9aStiLnByb3BvcnRpb25zLndpZHRoLGo9Yi5vZmZzZXQudG9wLGw9aitiLnByb3BvcnRpb25zLmhlaWdodDtcbnN3aXRjaChjKXtjYXNlIFwiZml0XCI6cmV0dXJuIGk8PWUmJmc8PWsmJmo8PWYmJmg8PWw7Y2FzZSBcImludGVyc2VjdFwiOnJldHVybiBpPGUrYS5oZWxwZXJQcm9wb3J0aW9ucy53aWR0aC8yJiZnLWEuaGVscGVyUHJvcG9ydGlvbnMud2lkdGgvMjxrJiZqPGYrYS5oZWxwZXJQcm9wb3J0aW9ucy5oZWlnaHQvMiYmaC1hLmhlbHBlclByb3BvcnRpb25zLmhlaWdodC8yPGw7Y2FzZSBcInBvaW50ZXJcIjpyZXR1cm4gZC51aS5pc092ZXIoKGEucG9zaXRpb25BYnN8fGEucG9zaXRpb24uYWJzb2x1dGUpLnRvcCsoYS5jbGlja09mZnNldHx8YS5vZmZzZXQuY2xpY2spLnRvcCwoYS5wb3NpdGlvbkFic3x8YS5wb3NpdGlvbi5hYnNvbHV0ZSkubGVmdCsoYS5jbGlja09mZnNldHx8YS5vZmZzZXQuY2xpY2spLmxlZnQsaixpLGIucHJvcG9ydGlvbnMuaGVpZ2h0LGIucHJvcG9ydGlvbnMud2lkdGgpO2Nhc2UgXCJ0b3VjaFwiOnJldHVybihmPj1qJiZmPD1sfHxoPj1qJiZoPD1sfHxmPGomJmg+bCkmJihlPj1cbmkmJmU8PWt8fGc+PWkmJmc8PWt8fGU8aSYmZz5rKTtkZWZhdWx0OnJldHVybiBmYWxzZX19O2QudWkuZGRtYW5hZ2VyPXtjdXJyZW50Om51bGwsZHJvcHBhYmxlczp7XCJkZWZhdWx0XCI6W119LHByZXBhcmVPZmZzZXRzOmZ1bmN0aW9uKGEsYil7dmFyIGM9ZC51aS5kZG1hbmFnZXIuZHJvcHBhYmxlc1thLm9wdGlvbnMuc2NvcGVdfHxbXSxlPWI/Yi50eXBlOm51bGwsZz0oYS5jdXJyZW50SXRlbXx8YS5lbGVtZW50KS5maW5kKFwiOmRhdGEoZHJvcHBhYmxlKVwiKS5hbmRTZWxmKCksZj0wO2E6Zm9yKDtmPGMubGVuZ3RoO2YrKylpZighKGNbZl0ub3B0aW9ucy5kaXNhYmxlZHx8YSYmIWNbZl0uYWNjZXB0LmNhbGwoY1tmXS5lbGVtZW50WzBdLGEuY3VycmVudEl0ZW18fGEuZWxlbWVudCkpKXtmb3IodmFyIGg9MDtoPGcubGVuZ3RoO2grKylpZihnW2hdPT1jW2ZdLmVsZW1lbnRbMF0pe2NbZl0ucHJvcG9ydGlvbnMuaGVpZ2h0PTA7Y29udGludWUgYX1jW2ZdLnZpc2libGU9Y1tmXS5lbGVtZW50LmNzcyhcImRpc3BsYXlcIikhPVxuXCJub25lXCI7aWYoY1tmXS52aXNpYmxlKXtlPT1cIm1vdXNlZG93blwiJiZjW2ZdLl9hY3RpdmF0ZS5jYWxsKGNbZl0sYik7Y1tmXS5vZmZzZXQ9Y1tmXS5lbGVtZW50Lm9mZnNldCgpO2NbZl0ucHJvcG9ydGlvbnM9e3dpZHRoOmNbZl0uZWxlbWVudFswXS5vZmZzZXRXaWR0aCxoZWlnaHQ6Y1tmXS5lbGVtZW50WzBdLm9mZnNldEhlaWdodH19fX0sZHJvcDpmdW5jdGlvbihhLGIpe3ZhciBjPWZhbHNlO2QuZWFjaChkLnVpLmRkbWFuYWdlci5kcm9wcGFibGVzW2Eub3B0aW9ucy5zY29wZV18fFtdLGZ1bmN0aW9uKCl7aWYodGhpcy5vcHRpb25zKXtpZighdGhpcy5vcHRpb25zLmRpc2FibGVkJiZ0aGlzLnZpc2libGUmJmQudWkuaW50ZXJzZWN0KGEsdGhpcyx0aGlzLm9wdGlvbnMudG9sZXJhbmNlKSljPWN8fHRoaXMuX2Ryb3AuY2FsbCh0aGlzLGIpO2lmKCF0aGlzLm9wdGlvbnMuZGlzYWJsZWQmJnRoaXMudmlzaWJsZSYmdGhpcy5hY2NlcHQuY2FsbCh0aGlzLmVsZW1lbnRbMF0sYS5jdXJyZW50SXRlbXx8XG5hLmVsZW1lbnQpKXt0aGlzLmlzb3V0PTE7dGhpcy5pc292ZXI9MDt0aGlzLl9kZWFjdGl2YXRlLmNhbGwodGhpcyxiKX19fSk7cmV0dXJuIGN9LGRyYWdTdGFydDpmdW5jdGlvbihhLGIpe2EuZWxlbWVudC5wYXJlbnRzKFwiOm5vdChib2R5LGh0bWwpXCIpLmJpbmQoXCJzY3JvbGwuZHJvcHBhYmxlXCIsZnVuY3Rpb24oKXthLm9wdGlvbnMucmVmcmVzaFBvc2l0aW9uc3x8ZC51aS5kZG1hbmFnZXIucHJlcGFyZU9mZnNldHMoYSxiKX0pfSxkcmFnOmZ1bmN0aW9uKGEsYil7YS5vcHRpb25zLnJlZnJlc2hQb3NpdGlvbnMmJmQudWkuZGRtYW5hZ2VyLnByZXBhcmVPZmZzZXRzKGEsYik7ZC5lYWNoKGQudWkuZGRtYW5hZ2VyLmRyb3BwYWJsZXNbYS5vcHRpb25zLnNjb3BlXXx8W10sZnVuY3Rpb24oKXtpZighKHRoaXMub3B0aW9ucy5kaXNhYmxlZHx8dGhpcy5ncmVlZHlDaGlsZHx8IXRoaXMudmlzaWJsZSkpe3ZhciBjPWQudWkuaW50ZXJzZWN0KGEsdGhpcyx0aGlzLm9wdGlvbnMudG9sZXJhbmNlKTtcbmlmKGM9IWMmJnRoaXMuaXNvdmVyPT0xP1wiaXNvdXRcIjpjJiZ0aGlzLmlzb3Zlcj09MD9cImlzb3ZlclwiOm51bGwpe3ZhciBlO2lmKHRoaXMub3B0aW9ucy5ncmVlZHkpe3ZhciBnPXRoaXMuZWxlbWVudC5wYXJlbnRzKFwiOmRhdGEoZHJvcHBhYmxlKTplcSgwKVwiKTtpZihnLmxlbmd0aCl7ZT1kLmRhdGEoZ1swXSxcImRyb3BwYWJsZVwiKTtlLmdyZWVkeUNoaWxkPWM9PVwiaXNvdmVyXCI/MTowfX1pZihlJiZjPT1cImlzb3ZlclwiKXtlLmlzb3Zlcj0wO2UuaXNvdXQ9MTtlLl9vdXQuY2FsbChlLGIpfXRoaXNbY109MTt0aGlzW2M9PVwiaXNvdXRcIj9cImlzb3ZlclwiOlwiaXNvdXRcIl09MDt0aGlzW2M9PVwiaXNvdmVyXCI/XCJfb3ZlclwiOlwiX291dFwiXS5jYWxsKHRoaXMsYik7aWYoZSYmYz09XCJpc291dFwiKXtlLmlzb3V0PTA7ZS5pc292ZXI9MTtlLl9vdmVyLmNhbGwoZSxiKX19fX0pfSxkcmFnU3RvcDpmdW5jdGlvbihhLGIpe2EuZWxlbWVudC5wYXJlbnRzKFwiOm5vdChib2R5LGh0bWwpXCIpLnVuYmluZChcInNjcm9sbC5kcm9wcGFibGVcIik7XG5hLm9wdGlvbnMucmVmcmVzaFBvc2l0aW9uc3x8ZC51aS5kZG1hbmFnZXIucHJlcGFyZU9mZnNldHMoYSxiKX19fSkoalF1ZXJ5KTtcbjsvKlxuICogalF1ZXJ5IFVJIFJlc2l6YWJsZSAxLjguMTZcbiAqXG4gKiBDb3B5cmlnaHQgMjAxMSwgQVVUSE9SUy50eHQgKGh0dHA6Ly9qcXVlcnl1aS5jb20vYWJvdXQpXG4gKiBEdWFsIGxpY2Vuc2VkIHVuZGVyIHRoZSBNSVQgb3IgR1BMIFZlcnNpb24gMiBsaWNlbnNlcy5cbiAqIGh0dHA6Ly9qcXVlcnkub3JnL2xpY2Vuc2VcbiAqXG4gKiBodHRwOi8vZG9jcy5qcXVlcnkuY29tL1VJL1Jlc2l6YWJsZXNcbiAqXG4gKiBEZXBlbmRzOlxuICpcdGpxdWVyeS51aS5jb3JlLmpzXG4gKlx0anF1ZXJ5LnVpLm1vdXNlLmpzXG4gKlx0anF1ZXJ5LnVpLndpZGdldC5qc1xuICovXG4oZnVuY3Rpb24oZSl7ZS53aWRnZXQoXCJ1aS5yZXNpemFibGVcIixlLnVpLm1vdXNlLHt3aWRnZXRFdmVudFByZWZpeDpcInJlc2l6ZVwiLG9wdGlvbnM6e2Fsc29SZXNpemU6ZmFsc2UsYW5pbWF0ZTpmYWxzZSxhbmltYXRlRHVyYXRpb246XCJzbG93XCIsYW5pbWF0ZUVhc2luZzpcInN3aW5nXCIsYXNwZWN0UmF0aW86ZmFsc2UsYXV0b0hpZGU6ZmFsc2UsY29udGFpbm1lbnQ6ZmFsc2UsZ2hvc3Q6ZmFsc2UsZ3JpZDpmYWxzZSxoYW5kbGVzOlwiZSxzLHNlXCIsaGVscGVyOmZhbHNlLG1heEhlaWdodDpudWxsLG1heFdpZHRoOm51bGwsbWluSGVpZ2h0OjEwLG1pbldpZHRoOjEwLHpJbmRleDoxRTN9LF9jcmVhdGU6ZnVuY3Rpb24oKXt2YXIgYj10aGlzLGE9dGhpcy5vcHRpb25zO3RoaXMuZWxlbWVudC5hZGRDbGFzcyhcInVpLXJlc2l6YWJsZVwiKTtlLmV4dGVuZCh0aGlzLHtfYXNwZWN0UmF0aW86ISFhLmFzcGVjdFJhdGlvLGFzcGVjdFJhdGlvOmEuYXNwZWN0UmF0aW8sb3JpZ2luYWxFbGVtZW50OnRoaXMuZWxlbWVudCxcbl9wcm9wb3J0aW9uYWxseVJlc2l6ZUVsZW1lbnRzOltdLF9oZWxwZXI6YS5oZWxwZXJ8fGEuZ2hvc3R8fGEuYW5pbWF0ZT9hLmhlbHBlcnx8XCJ1aS1yZXNpemFibGUtaGVscGVyXCI6bnVsbH0pO2lmKHRoaXMuZWxlbWVudFswXS5ub2RlTmFtZS5tYXRjaCgvY2FudmFzfHRleHRhcmVhfGlucHV0fHNlbGVjdHxidXR0b258aW1nL2kpKXsvcmVsYXRpdmUvLnRlc3QodGhpcy5lbGVtZW50LmNzcyhcInBvc2l0aW9uXCIpKSYmZS5icm93c2VyLm9wZXJhJiZ0aGlzLmVsZW1lbnQuY3NzKHtwb3NpdGlvbjpcInJlbGF0aXZlXCIsdG9wOlwiYXV0b1wiLGxlZnQ6XCJhdXRvXCJ9KTt0aGlzLmVsZW1lbnQud3JhcChlKCc8ZGl2IGNsYXNzPVwidWktd3JhcHBlclwiIHN0eWxlPVwib3ZlcmZsb3c6IGhpZGRlbjtcIj48L2Rpdj4nKS5jc3Moe3Bvc2l0aW9uOnRoaXMuZWxlbWVudC5jc3MoXCJwb3NpdGlvblwiKSx3aWR0aDp0aGlzLmVsZW1lbnQub3V0ZXJXaWR0aCgpLGhlaWdodDp0aGlzLmVsZW1lbnQub3V0ZXJIZWlnaHQoKSxcbnRvcDp0aGlzLmVsZW1lbnQuY3NzKFwidG9wXCIpLGxlZnQ6dGhpcy5lbGVtZW50LmNzcyhcImxlZnRcIil9KSk7dGhpcy5lbGVtZW50PXRoaXMuZWxlbWVudC5wYXJlbnQoKS5kYXRhKFwicmVzaXphYmxlXCIsdGhpcy5lbGVtZW50LmRhdGEoXCJyZXNpemFibGVcIikpO3RoaXMuZWxlbWVudElzV3JhcHBlcj10cnVlO3RoaXMuZWxlbWVudC5jc3Moe21hcmdpbkxlZnQ6dGhpcy5vcmlnaW5hbEVsZW1lbnQuY3NzKFwibWFyZ2luTGVmdFwiKSxtYXJnaW5Ub3A6dGhpcy5vcmlnaW5hbEVsZW1lbnQuY3NzKFwibWFyZ2luVG9wXCIpLG1hcmdpblJpZ2h0OnRoaXMub3JpZ2luYWxFbGVtZW50LmNzcyhcIm1hcmdpblJpZ2h0XCIpLG1hcmdpbkJvdHRvbTp0aGlzLm9yaWdpbmFsRWxlbWVudC5jc3MoXCJtYXJnaW5Cb3R0b21cIil9KTt0aGlzLm9yaWdpbmFsRWxlbWVudC5jc3Moe21hcmdpbkxlZnQ6MCxtYXJnaW5Ub3A6MCxtYXJnaW5SaWdodDowLG1hcmdpbkJvdHRvbTowfSk7dGhpcy5vcmlnaW5hbFJlc2l6ZVN0eWxlPVxudGhpcy5vcmlnaW5hbEVsZW1lbnQuY3NzKFwicmVzaXplXCIpO3RoaXMub3JpZ2luYWxFbGVtZW50LmNzcyhcInJlc2l6ZVwiLFwibm9uZVwiKTt0aGlzLl9wcm9wb3J0aW9uYWxseVJlc2l6ZUVsZW1lbnRzLnB1c2godGhpcy5vcmlnaW5hbEVsZW1lbnQuY3NzKHtwb3NpdGlvbjpcInN0YXRpY1wiLHpvb206MSxkaXNwbGF5OlwiYmxvY2tcIn0pKTt0aGlzLm9yaWdpbmFsRWxlbWVudC5jc3Moe21hcmdpbjp0aGlzLm9yaWdpbmFsRWxlbWVudC5jc3MoXCJtYXJnaW5cIil9KTt0aGlzLl9wcm9wb3J0aW9uYWxseVJlc2l6ZSgpfXRoaXMuaGFuZGxlcz1hLmhhbmRsZXN8fCghZShcIi51aS1yZXNpemFibGUtaGFuZGxlXCIsdGhpcy5lbGVtZW50KS5sZW5ndGg/XCJlLHMsc2VcIjp7bjpcIi51aS1yZXNpemFibGUtblwiLGU6XCIudWktcmVzaXphYmxlLWVcIixzOlwiLnVpLXJlc2l6YWJsZS1zXCIsdzpcIi51aS1yZXNpemFibGUtd1wiLHNlOlwiLnVpLXJlc2l6YWJsZS1zZVwiLHN3OlwiLnVpLXJlc2l6YWJsZS1zd1wiLG5lOlwiLnVpLXJlc2l6YWJsZS1uZVwiLFxubnc6XCIudWktcmVzaXphYmxlLW53XCJ9KTtpZih0aGlzLmhhbmRsZXMuY29uc3RydWN0b3I9PVN0cmluZyl7aWYodGhpcy5oYW5kbGVzPT1cImFsbFwiKXRoaXMuaGFuZGxlcz1cIm4sZSxzLHcsc2Usc3csbmUsbndcIjt2YXIgYz10aGlzLmhhbmRsZXMuc3BsaXQoXCIsXCIpO3RoaXMuaGFuZGxlcz17fTtmb3IodmFyIGQ9MDtkPGMubGVuZ3RoO2QrKyl7dmFyIGY9ZS50cmltKGNbZF0pLGc9ZSgnPGRpdiBjbGFzcz1cInVpLXJlc2l6YWJsZS1oYW5kbGUgJysoXCJ1aS1yZXNpemFibGUtXCIrZikrJ1wiPjwvZGl2PicpOy9zd3xzZXxuZXxudy8udGVzdChmKSYmZy5jc3Moe3pJbmRleDorK2EuekluZGV4fSk7XCJzZVwiPT1mJiZnLmFkZENsYXNzKFwidWktaWNvbiB1aS1pY29uLWdyaXBzbWFsbC1kaWFnb25hbC1zZVwiKTt0aGlzLmhhbmRsZXNbZl09XCIudWktcmVzaXphYmxlLVwiK2Y7dGhpcy5lbGVtZW50LmFwcGVuZChnKX19dGhpcy5fcmVuZGVyQXhpcz1mdW5jdGlvbihoKXtoPWh8fHRoaXMuZWxlbWVudDtmb3IodmFyIGkgaW4gdGhpcy5oYW5kbGVzKXtpZih0aGlzLmhhbmRsZXNbaV0uY29uc3RydWN0b3I9PVxuU3RyaW5nKXRoaXMuaGFuZGxlc1tpXT1lKHRoaXMuaGFuZGxlc1tpXSx0aGlzLmVsZW1lbnQpLnNob3coKTtpZih0aGlzLmVsZW1lbnRJc1dyYXBwZXImJnRoaXMub3JpZ2luYWxFbGVtZW50WzBdLm5vZGVOYW1lLm1hdGNoKC90ZXh0YXJlYXxpbnB1dHxzZWxlY3R8YnV0dG9uL2kpKXt2YXIgaj1lKHRoaXMuaGFuZGxlc1tpXSx0aGlzLmVsZW1lbnQpLGw9MDtsPS9zd3xuZXxud3xzZXxufHMvLnRlc3QoaSk/ai5vdXRlckhlaWdodCgpOmoub3V0ZXJXaWR0aCgpO2o9W1wicGFkZGluZ1wiLC9uZXxud3xuLy50ZXN0KGkpP1wiVG9wXCI6L3NlfHN3fHMvLnRlc3QoaSk/XCJCb3R0b21cIjovXmUkLy50ZXN0KGkpP1wiUmlnaHRcIjpcIkxlZnRcIl0uam9pbihcIlwiKTtoLmNzcyhqLGwpO3RoaXMuX3Byb3BvcnRpb25hbGx5UmVzaXplKCl9ZSh0aGlzLmhhbmRsZXNbaV0pfX07dGhpcy5fcmVuZGVyQXhpcyh0aGlzLmVsZW1lbnQpO3RoaXMuX2hhbmRsZXM9ZShcIi51aS1yZXNpemFibGUtaGFuZGxlXCIsdGhpcy5lbGVtZW50KS5kaXNhYmxlU2VsZWN0aW9uKCk7XG50aGlzLl9oYW5kbGVzLm1vdXNlb3ZlcihmdW5jdGlvbigpe2lmKCFiLnJlc2l6aW5nKXtpZih0aGlzLmNsYXNzTmFtZSl2YXIgaD10aGlzLmNsYXNzTmFtZS5tYXRjaCgvdWktcmVzaXphYmxlLShzZXxzd3xuZXxud3xufGV8c3x3KS9pKTtiLmF4aXM9aCYmaFsxXT9oWzFdOlwic2VcIn19KTtpZihhLmF1dG9IaWRlKXt0aGlzLl9oYW5kbGVzLmhpZGUoKTtlKHRoaXMuZWxlbWVudCkuYWRkQ2xhc3MoXCJ1aS1yZXNpemFibGUtYXV0b2hpZGVcIikuaG92ZXIoZnVuY3Rpb24oKXtpZighYS5kaXNhYmxlZCl7ZSh0aGlzKS5yZW1vdmVDbGFzcyhcInVpLXJlc2l6YWJsZS1hdXRvaGlkZVwiKTtiLl9oYW5kbGVzLnNob3coKX19LGZ1bmN0aW9uKCl7aWYoIWEuZGlzYWJsZWQpaWYoIWIucmVzaXppbmcpe2UodGhpcykuYWRkQ2xhc3MoXCJ1aS1yZXNpemFibGUtYXV0b2hpZGVcIik7Yi5faGFuZGxlcy5oaWRlKCl9fSl9dGhpcy5fbW91c2VJbml0KCl9LGRlc3Ryb3k6ZnVuY3Rpb24oKXt0aGlzLl9tb3VzZURlc3Ryb3koKTtcbnZhciBiPWZ1bmN0aW9uKGMpe2UoYykucmVtb3ZlQ2xhc3MoXCJ1aS1yZXNpemFibGUgdWktcmVzaXphYmxlLWRpc2FibGVkIHVpLXJlc2l6YWJsZS1yZXNpemluZ1wiKS5yZW1vdmVEYXRhKFwicmVzaXphYmxlXCIpLnVuYmluZChcIi5yZXNpemFibGVcIikuZmluZChcIi51aS1yZXNpemFibGUtaGFuZGxlXCIpLnJlbW92ZSgpfTtpZih0aGlzLmVsZW1lbnRJc1dyYXBwZXIpe2IodGhpcy5lbGVtZW50KTt2YXIgYT10aGlzLmVsZW1lbnQ7YS5hZnRlcih0aGlzLm9yaWdpbmFsRWxlbWVudC5jc3Moe3Bvc2l0aW9uOmEuY3NzKFwicG9zaXRpb25cIiksd2lkdGg6YS5vdXRlcldpZHRoKCksaGVpZ2h0OmEub3V0ZXJIZWlnaHQoKSx0b3A6YS5jc3MoXCJ0b3BcIiksbGVmdDphLmNzcyhcImxlZnRcIil9KSkucmVtb3ZlKCl9dGhpcy5vcmlnaW5hbEVsZW1lbnQuY3NzKFwicmVzaXplXCIsdGhpcy5vcmlnaW5hbFJlc2l6ZVN0eWxlKTtiKHRoaXMub3JpZ2luYWxFbGVtZW50KTtyZXR1cm4gdGhpc30sX21vdXNlQ2FwdHVyZTpmdW5jdGlvbihiKXt2YXIgYT1cbmZhbHNlO2Zvcih2YXIgYyBpbiB0aGlzLmhhbmRsZXMpaWYoZSh0aGlzLmhhbmRsZXNbY10pWzBdPT1iLnRhcmdldClhPXRydWU7cmV0dXJuIXRoaXMub3B0aW9ucy5kaXNhYmxlZCYmYX0sX21vdXNlU3RhcnQ6ZnVuY3Rpb24oYil7dmFyIGE9dGhpcy5vcHRpb25zLGM9dGhpcy5lbGVtZW50LnBvc2l0aW9uKCksZD10aGlzLmVsZW1lbnQ7dGhpcy5yZXNpemluZz10cnVlO3RoaXMuZG9jdW1lbnRTY3JvbGw9e3RvcDplKGRvY3VtZW50KS5zY3JvbGxUb3AoKSxsZWZ0OmUoZG9jdW1lbnQpLnNjcm9sbExlZnQoKX07aWYoZC5pcyhcIi51aS1kcmFnZ2FibGVcIil8fC9hYnNvbHV0ZS8udGVzdChkLmNzcyhcInBvc2l0aW9uXCIpKSlkLmNzcyh7cG9zaXRpb246XCJhYnNvbHV0ZVwiLHRvcDpjLnRvcCxsZWZ0OmMubGVmdH0pO2UuYnJvd3Nlci5vcGVyYSYmL3JlbGF0aXZlLy50ZXN0KGQuY3NzKFwicG9zaXRpb25cIikpJiZkLmNzcyh7cG9zaXRpb246XCJyZWxhdGl2ZVwiLHRvcDpcImF1dG9cIixsZWZ0OlwiYXV0b1wifSk7XG50aGlzLl9yZW5kZXJQcm94eSgpO2M9bSh0aGlzLmhlbHBlci5jc3MoXCJsZWZ0XCIpKTt2YXIgZj1tKHRoaXMuaGVscGVyLmNzcyhcInRvcFwiKSk7aWYoYS5jb250YWlubWVudCl7Yys9ZShhLmNvbnRhaW5tZW50KS5zY3JvbGxMZWZ0KCl8fDA7Zis9ZShhLmNvbnRhaW5tZW50KS5zY3JvbGxUb3AoKXx8MH10aGlzLm9mZnNldD10aGlzLmhlbHBlci5vZmZzZXQoKTt0aGlzLnBvc2l0aW9uPXtsZWZ0OmMsdG9wOmZ9O3RoaXMuc2l6ZT10aGlzLl9oZWxwZXI/e3dpZHRoOmQub3V0ZXJXaWR0aCgpLGhlaWdodDpkLm91dGVySGVpZ2h0KCl9Ont3aWR0aDpkLndpZHRoKCksaGVpZ2h0OmQuaGVpZ2h0KCl9O3RoaXMub3JpZ2luYWxTaXplPXRoaXMuX2hlbHBlcj97d2lkdGg6ZC5vdXRlcldpZHRoKCksaGVpZ2h0OmQub3V0ZXJIZWlnaHQoKX06e3dpZHRoOmQud2lkdGgoKSxoZWlnaHQ6ZC5oZWlnaHQoKX07dGhpcy5vcmlnaW5hbFBvc2l0aW9uPXtsZWZ0OmMsdG9wOmZ9O3RoaXMuc2l6ZURpZmY9XG57d2lkdGg6ZC5vdXRlcldpZHRoKCktZC53aWR0aCgpLGhlaWdodDpkLm91dGVySGVpZ2h0KCktZC5oZWlnaHQoKX07dGhpcy5vcmlnaW5hbE1vdXNlUG9zaXRpb249e2xlZnQ6Yi5wYWdlWCx0b3A6Yi5wYWdlWX07dGhpcy5hc3BlY3RSYXRpbz10eXBlb2YgYS5hc3BlY3RSYXRpbz09XCJudW1iZXJcIj9hLmFzcGVjdFJhdGlvOnRoaXMub3JpZ2luYWxTaXplLndpZHRoL3RoaXMub3JpZ2luYWxTaXplLmhlaWdodHx8MTthPWUoXCIudWktcmVzaXphYmxlLVwiK3RoaXMuYXhpcykuY3NzKFwiY3Vyc29yXCIpO2UoXCJib2R5XCIpLmNzcyhcImN1cnNvclwiLGE9PVwiYXV0b1wiP3RoaXMuYXhpcytcIi1yZXNpemVcIjphKTtkLmFkZENsYXNzKFwidWktcmVzaXphYmxlLXJlc2l6aW5nXCIpO3RoaXMuX3Byb3BhZ2F0ZShcInN0YXJ0XCIsYik7cmV0dXJuIHRydWV9LF9tb3VzZURyYWc6ZnVuY3Rpb24oYil7dmFyIGE9dGhpcy5oZWxwZXIsYz10aGlzLm9yaWdpbmFsTW91c2VQb3NpdGlvbixkPXRoaXMuX2NoYW5nZVt0aGlzLmF4aXNdO1xuaWYoIWQpcmV0dXJuIGZhbHNlO2M9ZC5hcHBseSh0aGlzLFtiLGIucGFnZVgtYy5sZWZ0fHwwLGIucGFnZVktYy50b3B8fDBdKTt0aGlzLl91cGRhdGVWaXJ0dWFsQm91bmRhcmllcyhiLnNoaWZ0S2V5KTtpZih0aGlzLl9hc3BlY3RSYXRpb3x8Yi5zaGlmdEtleSljPXRoaXMuX3VwZGF0ZVJhdGlvKGMsYik7Yz10aGlzLl9yZXNwZWN0U2l6ZShjLGIpO3RoaXMuX3Byb3BhZ2F0ZShcInJlc2l6ZVwiLGIpO2EuY3NzKHt0b3A6dGhpcy5wb3NpdGlvbi50b3ArXCJweFwiLGxlZnQ6dGhpcy5wb3NpdGlvbi5sZWZ0K1wicHhcIix3aWR0aDp0aGlzLnNpemUud2lkdGgrXCJweFwiLGhlaWdodDp0aGlzLnNpemUuaGVpZ2h0K1wicHhcIn0pOyF0aGlzLl9oZWxwZXImJnRoaXMuX3Byb3BvcnRpb25hbGx5UmVzaXplRWxlbWVudHMubGVuZ3RoJiZ0aGlzLl9wcm9wb3J0aW9uYWxseVJlc2l6ZSgpO3RoaXMuX3VwZGF0ZUNhY2hlKGMpO3RoaXMuX3RyaWdnZXIoXCJyZXNpemVcIixiLHRoaXMudWkoKSk7cmV0dXJuIGZhbHNlfSxcbl9tb3VzZVN0b3A6ZnVuY3Rpb24oYil7dGhpcy5yZXNpemluZz1mYWxzZTt2YXIgYT10aGlzLm9wdGlvbnMsYz10aGlzO2lmKHRoaXMuX2hlbHBlcil7dmFyIGQ9dGhpcy5fcHJvcG9ydGlvbmFsbHlSZXNpemVFbGVtZW50cyxmPWQubGVuZ3RoJiYvdGV4dGFyZWEvaS50ZXN0KGRbMF0ubm9kZU5hbWUpO2Q9ZiYmZS51aS5oYXNTY3JvbGwoZFswXSxcImxlZnRcIik/MDpjLnNpemVEaWZmLmhlaWdodDtmPWY/MDpjLnNpemVEaWZmLndpZHRoO2Y9e3dpZHRoOmMuaGVscGVyLndpZHRoKCktZixoZWlnaHQ6Yy5oZWxwZXIuaGVpZ2h0KCktZH07ZD1wYXJzZUludChjLmVsZW1lbnQuY3NzKFwibGVmdFwiKSwxMCkrKGMucG9zaXRpb24ubGVmdC1jLm9yaWdpbmFsUG9zaXRpb24ubGVmdCl8fG51bGw7dmFyIGc9cGFyc2VJbnQoYy5lbGVtZW50LmNzcyhcInRvcFwiKSwxMCkrKGMucG9zaXRpb24udG9wLWMub3JpZ2luYWxQb3NpdGlvbi50b3ApfHxudWxsO2EuYW5pbWF0ZXx8dGhpcy5lbGVtZW50LmNzcyhlLmV4dGVuZChmLFxue3RvcDpnLGxlZnQ6ZH0pKTtjLmhlbHBlci5oZWlnaHQoYy5zaXplLmhlaWdodCk7Yy5oZWxwZXIud2lkdGgoYy5zaXplLndpZHRoKTt0aGlzLl9oZWxwZXImJiFhLmFuaW1hdGUmJnRoaXMuX3Byb3BvcnRpb25hbGx5UmVzaXplKCl9ZShcImJvZHlcIikuY3NzKFwiY3Vyc29yXCIsXCJhdXRvXCIpO3RoaXMuZWxlbWVudC5yZW1vdmVDbGFzcyhcInVpLXJlc2l6YWJsZS1yZXNpemluZ1wiKTt0aGlzLl9wcm9wYWdhdGUoXCJzdG9wXCIsYik7dGhpcy5faGVscGVyJiZ0aGlzLmhlbHBlci5yZW1vdmUoKTtyZXR1cm4gZmFsc2V9LF91cGRhdGVWaXJ0dWFsQm91bmRhcmllczpmdW5jdGlvbihiKXt2YXIgYT10aGlzLm9wdGlvbnMsYyxkLGY7YT17bWluV2lkdGg6ayhhLm1pbldpZHRoKT9hLm1pbldpZHRoOjAsbWF4V2lkdGg6ayhhLm1heFdpZHRoKT9hLm1heFdpZHRoOkluZmluaXR5LG1pbkhlaWdodDprKGEubWluSGVpZ2h0KT9hLm1pbkhlaWdodDowLG1heEhlaWdodDprKGEubWF4SGVpZ2h0KT9hLm1heEhlaWdodDpcbkluZmluaXR5fTtpZih0aGlzLl9hc3BlY3RSYXRpb3x8Yil7Yj1hLm1pbkhlaWdodCp0aGlzLmFzcGVjdFJhdGlvO2Q9YS5taW5XaWR0aC90aGlzLmFzcGVjdFJhdGlvO2M9YS5tYXhIZWlnaHQqdGhpcy5hc3BlY3RSYXRpbztmPWEubWF4V2lkdGgvdGhpcy5hc3BlY3RSYXRpbztpZihiPmEubWluV2lkdGgpYS5taW5XaWR0aD1iO2lmKGQ+YS5taW5IZWlnaHQpYS5taW5IZWlnaHQ9ZDtpZihjPGEubWF4V2lkdGgpYS5tYXhXaWR0aD1jO2lmKGY8YS5tYXhIZWlnaHQpYS5tYXhIZWlnaHQ9Zn10aGlzLl92Qm91bmRhcmllcz1hfSxfdXBkYXRlQ2FjaGU6ZnVuY3Rpb24oYil7dGhpcy5vZmZzZXQ9dGhpcy5oZWxwZXIub2Zmc2V0KCk7aWYoayhiLmxlZnQpKXRoaXMucG9zaXRpb24ubGVmdD1iLmxlZnQ7aWYoayhiLnRvcCkpdGhpcy5wb3NpdGlvbi50b3A9Yi50b3A7aWYoayhiLmhlaWdodCkpdGhpcy5zaXplLmhlaWdodD1iLmhlaWdodDtpZihrKGIud2lkdGgpKXRoaXMuc2l6ZS53aWR0aD1cbmIud2lkdGh9LF91cGRhdGVSYXRpbzpmdW5jdGlvbihiKXt2YXIgYT10aGlzLnBvc2l0aW9uLGM9dGhpcy5zaXplLGQ9dGhpcy5heGlzO2lmKGsoYi5oZWlnaHQpKWIud2lkdGg9Yi5oZWlnaHQqdGhpcy5hc3BlY3RSYXRpbztlbHNlIGlmKGsoYi53aWR0aCkpYi5oZWlnaHQ9Yi53aWR0aC90aGlzLmFzcGVjdFJhdGlvO2lmKGQ9PVwic3dcIil7Yi5sZWZ0PWEubGVmdCsoYy53aWR0aC1iLndpZHRoKTtiLnRvcD1udWxsfWlmKGQ9PVwibndcIil7Yi50b3A9YS50b3ArKGMuaGVpZ2h0LWIuaGVpZ2h0KTtiLmxlZnQ9YS5sZWZ0KyhjLndpZHRoLWIud2lkdGgpfXJldHVybiBifSxfcmVzcGVjdFNpemU6ZnVuY3Rpb24oYil7dmFyIGE9dGhpcy5fdkJvdW5kYXJpZXMsYz10aGlzLmF4aXMsZD1rKGIud2lkdGgpJiZhLm1heFdpZHRoJiZhLm1heFdpZHRoPGIud2lkdGgsZj1rKGIuaGVpZ2h0KSYmYS5tYXhIZWlnaHQmJmEubWF4SGVpZ2h0PGIuaGVpZ2h0LGc9ayhiLndpZHRoKSYmYS5taW5XaWR0aCYmXG5hLm1pbldpZHRoPmIud2lkdGgsaD1rKGIuaGVpZ2h0KSYmYS5taW5IZWlnaHQmJmEubWluSGVpZ2h0PmIuaGVpZ2h0O2lmKGcpYi53aWR0aD1hLm1pbldpZHRoO2lmKGgpYi5oZWlnaHQ9YS5taW5IZWlnaHQ7aWYoZCliLndpZHRoPWEubWF4V2lkdGg7aWYoZiliLmhlaWdodD1hLm1heEhlaWdodDt2YXIgaT10aGlzLm9yaWdpbmFsUG9zaXRpb24ubGVmdCt0aGlzLm9yaWdpbmFsU2l6ZS53aWR0aCxqPXRoaXMucG9zaXRpb24udG9wK3RoaXMuc2l6ZS5oZWlnaHQsbD0vc3d8bnd8dy8udGVzdChjKTtjPS9ud3xuZXxuLy50ZXN0KGMpO2lmKGcmJmwpYi5sZWZ0PWktYS5taW5XaWR0aDtpZihkJiZsKWIubGVmdD1pLWEubWF4V2lkdGg7aWYoaCYmYyliLnRvcD1qLWEubWluSGVpZ2h0O2lmKGYmJmMpYi50b3A9ai1hLm1heEhlaWdodDtpZigoYT0hYi53aWR0aCYmIWIuaGVpZ2h0KSYmIWIubGVmdCYmYi50b3ApYi50b3A9bnVsbDtlbHNlIGlmKGEmJiFiLnRvcCYmYi5sZWZ0KWIubGVmdD1cbm51bGw7cmV0dXJuIGJ9LF9wcm9wb3J0aW9uYWxseVJlc2l6ZTpmdW5jdGlvbigpe2lmKHRoaXMuX3Byb3BvcnRpb25hbGx5UmVzaXplRWxlbWVudHMubGVuZ3RoKWZvcih2YXIgYj10aGlzLmhlbHBlcnx8dGhpcy5lbGVtZW50LGE9MDthPHRoaXMuX3Byb3BvcnRpb25hbGx5UmVzaXplRWxlbWVudHMubGVuZ3RoO2ErKyl7dmFyIGM9dGhpcy5fcHJvcG9ydGlvbmFsbHlSZXNpemVFbGVtZW50c1thXTtpZighdGhpcy5ib3JkZXJEaWYpe3ZhciBkPVtjLmNzcyhcImJvcmRlclRvcFdpZHRoXCIpLGMuY3NzKFwiYm9yZGVyUmlnaHRXaWR0aFwiKSxjLmNzcyhcImJvcmRlckJvdHRvbVdpZHRoXCIpLGMuY3NzKFwiYm9yZGVyTGVmdFdpZHRoXCIpXSxmPVtjLmNzcyhcInBhZGRpbmdUb3BcIiksYy5jc3MoXCJwYWRkaW5nUmlnaHRcIiksYy5jc3MoXCJwYWRkaW5nQm90dG9tXCIpLGMuY3NzKFwicGFkZGluZ0xlZnRcIildO3RoaXMuYm9yZGVyRGlmPWUubWFwKGQsZnVuY3Rpb24oZyxoKXtnPXBhcnNlSW50KGcsMTApfHxcbjA7aD1wYXJzZUludChmW2hdLDEwKXx8MDtyZXR1cm4gZytofSl9ZS5icm93c2VyLm1zaWUmJihlKGIpLmlzKFwiOmhpZGRlblwiKXx8ZShiKS5wYXJlbnRzKFwiOmhpZGRlblwiKS5sZW5ndGgpfHxjLmNzcyh7aGVpZ2h0OmIuaGVpZ2h0KCktdGhpcy5ib3JkZXJEaWZbMF0tdGhpcy5ib3JkZXJEaWZbMl18fDAsd2lkdGg6Yi53aWR0aCgpLXRoaXMuYm9yZGVyRGlmWzFdLXRoaXMuYm9yZGVyRGlmWzNdfHwwfSl9fSxfcmVuZGVyUHJveHk6ZnVuY3Rpb24oKXt2YXIgYj10aGlzLm9wdGlvbnM7dGhpcy5lbGVtZW50T2Zmc2V0PXRoaXMuZWxlbWVudC5vZmZzZXQoKTtpZih0aGlzLl9oZWxwZXIpe3RoaXMuaGVscGVyPXRoaXMuaGVscGVyfHxlKCc8ZGl2IHN0eWxlPVwib3ZlcmZsb3c6aGlkZGVuO1wiPjwvZGl2PicpO3ZhciBhPWUuYnJvd3Nlci5tc2llJiZlLmJyb3dzZXIudmVyc2lvbjw3LGM9YT8xOjA7YT1hPzI6LTE7dGhpcy5oZWxwZXIuYWRkQ2xhc3ModGhpcy5faGVscGVyKS5jc3Moe3dpZHRoOnRoaXMuZWxlbWVudC5vdXRlcldpZHRoKCkrXG5hLGhlaWdodDp0aGlzLmVsZW1lbnQub3V0ZXJIZWlnaHQoKSthLHBvc2l0aW9uOlwiYWJzb2x1dGVcIixsZWZ0OnRoaXMuZWxlbWVudE9mZnNldC5sZWZ0LWMrXCJweFwiLHRvcDp0aGlzLmVsZW1lbnRPZmZzZXQudG9wLWMrXCJweFwiLHpJbmRleDorK2IuekluZGV4fSk7dGhpcy5oZWxwZXIuYXBwZW5kVG8oXCJib2R5XCIpLmRpc2FibGVTZWxlY3Rpb24oKX1lbHNlIHRoaXMuaGVscGVyPXRoaXMuZWxlbWVudH0sX2NoYW5nZTp7ZTpmdW5jdGlvbihiLGEpe3JldHVybnt3aWR0aDp0aGlzLm9yaWdpbmFsU2l6ZS53aWR0aCthfX0sdzpmdW5jdGlvbihiLGEpe3JldHVybntsZWZ0OnRoaXMub3JpZ2luYWxQb3NpdGlvbi5sZWZ0K2Esd2lkdGg6dGhpcy5vcmlnaW5hbFNpemUud2lkdGgtYX19LG46ZnVuY3Rpb24oYixhLGMpe3JldHVybnt0b3A6dGhpcy5vcmlnaW5hbFBvc2l0aW9uLnRvcCtjLGhlaWdodDp0aGlzLm9yaWdpbmFsU2l6ZS5oZWlnaHQtY319LHM6ZnVuY3Rpb24oYixhLGMpe3JldHVybntoZWlnaHQ6dGhpcy5vcmlnaW5hbFNpemUuaGVpZ2h0K1xuY319LHNlOmZ1bmN0aW9uKGIsYSxjKXtyZXR1cm4gZS5leHRlbmQodGhpcy5fY2hhbmdlLnMuYXBwbHkodGhpcyxhcmd1bWVudHMpLHRoaXMuX2NoYW5nZS5lLmFwcGx5KHRoaXMsW2IsYSxjXSkpfSxzdzpmdW5jdGlvbihiLGEsYyl7cmV0dXJuIGUuZXh0ZW5kKHRoaXMuX2NoYW5nZS5zLmFwcGx5KHRoaXMsYXJndW1lbnRzKSx0aGlzLl9jaGFuZ2Uudy5hcHBseSh0aGlzLFtiLGEsY10pKX0sbmU6ZnVuY3Rpb24oYixhLGMpe3JldHVybiBlLmV4dGVuZCh0aGlzLl9jaGFuZ2Uubi5hcHBseSh0aGlzLGFyZ3VtZW50cyksdGhpcy5fY2hhbmdlLmUuYXBwbHkodGhpcyxbYixhLGNdKSl9LG53OmZ1bmN0aW9uKGIsYSxjKXtyZXR1cm4gZS5leHRlbmQodGhpcy5fY2hhbmdlLm4uYXBwbHkodGhpcyxhcmd1bWVudHMpLHRoaXMuX2NoYW5nZS53LmFwcGx5KHRoaXMsW2IsYSxjXSkpfX0sX3Byb3BhZ2F0ZTpmdW5jdGlvbihiLGEpe2UudWkucGx1Z2luLmNhbGwodGhpcyxiLFthLHRoaXMudWkoKV0pO1xuYiE9XCJyZXNpemVcIiYmdGhpcy5fdHJpZ2dlcihiLGEsdGhpcy51aSgpKX0scGx1Z2luczp7fSx1aTpmdW5jdGlvbigpe3JldHVybntvcmlnaW5hbEVsZW1lbnQ6dGhpcy5vcmlnaW5hbEVsZW1lbnQsZWxlbWVudDp0aGlzLmVsZW1lbnQsaGVscGVyOnRoaXMuaGVscGVyLHBvc2l0aW9uOnRoaXMucG9zaXRpb24sc2l6ZTp0aGlzLnNpemUsb3JpZ2luYWxTaXplOnRoaXMub3JpZ2luYWxTaXplLG9yaWdpbmFsUG9zaXRpb246dGhpcy5vcmlnaW5hbFBvc2l0aW9ufX19KTtlLmV4dGVuZChlLnVpLnJlc2l6YWJsZSx7dmVyc2lvbjpcIjEuOC4xNlwifSk7ZS51aS5wbHVnaW4uYWRkKFwicmVzaXphYmxlXCIsXCJhbHNvUmVzaXplXCIse3N0YXJ0OmZ1bmN0aW9uKCl7dmFyIGI9ZSh0aGlzKS5kYXRhKFwicmVzaXphYmxlXCIpLm9wdGlvbnMsYT1mdW5jdGlvbihjKXtlKGMpLmVhY2goZnVuY3Rpb24oKXt2YXIgZD1lKHRoaXMpO2QuZGF0YShcInJlc2l6YWJsZS1hbHNvcmVzaXplXCIse3dpZHRoOnBhcnNlSW50KGQud2lkdGgoKSxcbjEwKSxoZWlnaHQ6cGFyc2VJbnQoZC5oZWlnaHQoKSwxMCksbGVmdDpwYXJzZUludChkLmNzcyhcImxlZnRcIiksMTApLHRvcDpwYXJzZUludChkLmNzcyhcInRvcFwiKSwxMCkscG9zaXRpb246ZC5jc3MoXCJwb3NpdGlvblwiKX0pfSl9O2lmKHR5cGVvZiBiLmFsc29SZXNpemU9PVwib2JqZWN0XCImJiFiLmFsc29SZXNpemUucGFyZW50Tm9kZSlpZihiLmFsc29SZXNpemUubGVuZ3RoKXtiLmFsc29SZXNpemU9Yi5hbHNvUmVzaXplWzBdO2EoYi5hbHNvUmVzaXplKX1lbHNlIGUuZWFjaChiLmFsc29SZXNpemUsZnVuY3Rpb24oYyl7YShjKX0pO2Vsc2UgYShiLmFsc29SZXNpemUpfSxyZXNpemU6ZnVuY3Rpb24oYixhKXt2YXIgYz1lKHRoaXMpLmRhdGEoXCJyZXNpemFibGVcIik7Yj1jLm9wdGlvbnM7dmFyIGQ9Yy5vcmlnaW5hbFNpemUsZj1jLm9yaWdpbmFsUG9zaXRpb24sZz17aGVpZ2h0OmMuc2l6ZS5oZWlnaHQtZC5oZWlnaHR8fDAsd2lkdGg6Yy5zaXplLndpZHRoLWQud2lkdGh8fDAsdG9wOmMucG9zaXRpb24udG9wLVxuZi50b3B8fDAsbGVmdDpjLnBvc2l0aW9uLmxlZnQtZi5sZWZ0fHwwfSxoPWZ1bmN0aW9uKGksail7ZShpKS5lYWNoKGZ1bmN0aW9uKCl7dmFyIGw9ZSh0aGlzKSxxPWUodGhpcykuZGF0YShcInJlc2l6YWJsZS1hbHNvcmVzaXplXCIpLHA9e30scj1qJiZqLmxlbmd0aD9qOmwucGFyZW50cyhhLm9yaWdpbmFsRWxlbWVudFswXSkubGVuZ3RoP1tcIndpZHRoXCIsXCJoZWlnaHRcIl06W1wid2lkdGhcIixcImhlaWdodFwiLFwidG9wXCIsXCJsZWZ0XCJdO2UuZWFjaChyLGZ1bmN0aW9uKG4sbyl7aWYoKG49KHFbb118fDApKyhnW29dfHwwKSkmJm4+PTApcFtvXT1ufHxudWxsfSk7aWYoZS5icm93c2VyLm9wZXJhJiYvcmVsYXRpdmUvLnRlc3QobC5jc3MoXCJwb3NpdGlvblwiKSkpe2MuX3JldmVydFRvUmVsYXRpdmVQb3NpdGlvbj10cnVlO2wuY3NzKHtwb3NpdGlvbjpcImFic29sdXRlXCIsdG9wOlwiYXV0b1wiLGxlZnQ6XCJhdXRvXCJ9KX1sLmNzcyhwKX0pfTt0eXBlb2YgYi5hbHNvUmVzaXplPT1cIm9iamVjdFwiJiYhYi5hbHNvUmVzaXplLm5vZGVUeXBlP1xuZS5lYWNoKGIuYWxzb1Jlc2l6ZSxmdW5jdGlvbihpLGope2goaSxqKX0pOmgoYi5hbHNvUmVzaXplKX0sc3RvcDpmdW5jdGlvbigpe3ZhciBiPWUodGhpcykuZGF0YShcInJlc2l6YWJsZVwiKSxhPWIub3B0aW9ucyxjPWZ1bmN0aW9uKGQpe2UoZCkuZWFjaChmdW5jdGlvbigpe3ZhciBmPWUodGhpcyk7Zi5jc3Moe3Bvc2l0aW9uOmYuZGF0YShcInJlc2l6YWJsZS1hbHNvcmVzaXplXCIpLnBvc2l0aW9ufSl9KX07aWYoYi5fcmV2ZXJ0VG9SZWxhdGl2ZVBvc2l0aW9uKXtiLl9yZXZlcnRUb1JlbGF0aXZlUG9zaXRpb249ZmFsc2U7dHlwZW9mIGEuYWxzb1Jlc2l6ZT09XCJvYmplY3RcIiYmIWEuYWxzb1Jlc2l6ZS5ub2RlVHlwZT9lLmVhY2goYS5hbHNvUmVzaXplLGZ1bmN0aW9uKGQpe2MoZCl9KTpjKGEuYWxzb1Jlc2l6ZSl9ZSh0aGlzKS5yZW1vdmVEYXRhKFwicmVzaXphYmxlLWFsc29yZXNpemVcIil9fSk7ZS51aS5wbHVnaW4uYWRkKFwicmVzaXphYmxlXCIsXCJhbmltYXRlXCIse3N0b3A6ZnVuY3Rpb24oYil7dmFyIGE9XG5lKHRoaXMpLmRhdGEoXCJyZXNpemFibGVcIiksYz1hLm9wdGlvbnMsZD1hLl9wcm9wb3J0aW9uYWxseVJlc2l6ZUVsZW1lbnRzLGY9ZC5sZW5ndGgmJi90ZXh0YXJlYS9pLnRlc3QoZFswXS5ub2RlTmFtZSksZz1mJiZlLnVpLmhhc1Njcm9sbChkWzBdLFwibGVmdFwiKT8wOmEuc2l6ZURpZmYuaGVpZ2h0O2Y9e3dpZHRoOmEuc2l6ZS53aWR0aC0oZj8wOmEuc2l6ZURpZmYud2lkdGgpLGhlaWdodDphLnNpemUuaGVpZ2h0LWd9O2c9cGFyc2VJbnQoYS5lbGVtZW50LmNzcyhcImxlZnRcIiksMTApKyhhLnBvc2l0aW9uLmxlZnQtYS5vcmlnaW5hbFBvc2l0aW9uLmxlZnQpfHxudWxsO3ZhciBoPXBhcnNlSW50KGEuZWxlbWVudC5jc3MoXCJ0b3BcIiksMTApKyhhLnBvc2l0aW9uLnRvcC1hLm9yaWdpbmFsUG9zaXRpb24udG9wKXx8bnVsbDthLmVsZW1lbnQuYW5pbWF0ZShlLmV4dGVuZChmLGgmJmc/e3RvcDpoLGxlZnQ6Z306e30pLHtkdXJhdGlvbjpjLmFuaW1hdGVEdXJhdGlvbixlYXNpbmc6Yy5hbmltYXRlRWFzaW5nLFxuc3RlcDpmdW5jdGlvbigpe3ZhciBpPXt3aWR0aDpwYXJzZUludChhLmVsZW1lbnQuY3NzKFwid2lkdGhcIiksMTApLGhlaWdodDpwYXJzZUludChhLmVsZW1lbnQuY3NzKFwiaGVpZ2h0XCIpLDEwKSx0b3A6cGFyc2VJbnQoYS5lbGVtZW50LmNzcyhcInRvcFwiKSwxMCksbGVmdDpwYXJzZUludChhLmVsZW1lbnQuY3NzKFwibGVmdFwiKSwxMCl9O2QmJmQubGVuZ3RoJiZlKGRbMF0pLmNzcyh7d2lkdGg6aS53aWR0aCxoZWlnaHQ6aS5oZWlnaHR9KTthLl91cGRhdGVDYWNoZShpKTthLl9wcm9wYWdhdGUoXCJyZXNpemVcIixiKX19KX19KTtlLnVpLnBsdWdpbi5hZGQoXCJyZXNpemFibGVcIixcImNvbnRhaW5tZW50XCIse3N0YXJ0OmZ1bmN0aW9uKCl7dmFyIGI9ZSh0aGlzKS5kYXRhKFwicmVzaXphYmxlXCIpLGE9Yi5lbGVtZW50LGM9Yi5vcHRpb25zLmNvbnRhaW5tZW50O2lmKGE9YyBpbnN0YW5jZW9mIGU/Yy5nZXQoMCk6L3BhcmVudC8udGVzdChjKT9hLnBhcmVudCgpLmdldCgwKTpjKXtiLmNvbnRhaW5lckVsZW1lbnQ9XG5lKGEpO2lmKC9kb2N1bWVudC8udGVzdChjKXx8Yz09ZG9jdW1lbnQpe2IuY29udGFpbmVyT2Zmc2V0PXtsZWZ0OjAsdG9wOjB9O2IuY29udGFpbmVyUG9zaXRpb249e2xlZnQ6MCx0b3A6MH07Yi5wYXJlbnREYXRhPXtlbGVtZW50OmUoZG9jdW1lbnQpLGxlZnQ6MCx0b3A6MCx3aWR0aDplKGRvY3VtZW50KS53aWR0aCgpLGhlaWdodDplKGRvY3VtZW50KS5oZWlnaHQoKXx8ZG9jdW1lbnQuYm9keS5wYXJlbnROb2RlLnNjcm9sbEhlaWdodH19ZWxzZXt2YXIgZD1lKGEpLGY9W107ZShbXCJUb3BcIixcIlJpZ2h0XCIsXCJMZWZ0XCIsXCJCb3R0b21cIl0pLmVhY2goZnVuY3Rpb24oaSxqKXtmW2ldPW0oZC5jc3MoXCJwYWRkaW5nXCIraikpfSk7Yi5jb250YWluZXJPZmZzZXQ9ZC5vZmZzZXQoKTtiLmNvbnRhaW5lclBvc2l0aW9uPWQucG9zaXRpb24oKTtiLmNvbnRhaW5lclNpemU9e2hlaWdodDpkLmlubmVySGVpZ2h0KCktZlszXSx3aWR0aDpkLmlubmVyV2lkdGgoKS1mWzFdfTtjPWIuY29udGFpbmVyT2Zmc2V0O1xudmFyIGc9Yi5jb250YWluZXJTaXplLmhlaWdodCxoPWIuY29udGFpbmVyU2l6ZS53aWR0aDtoPWUudWkuaGFzU2Nyb2xsKGEsXCJsZWZ0XCIpP2Euc2Nyb2xsV2lkdGg6aDtnPWUudWkuaGFzU2Nyb2xsKGEpP2Euc2Nyb2xsSGVpZ2h0Omc7Yi5wYXJlbnREYXRhPXtlbGVtZW50OmEsbGVmdDpjLmxlZnQsdG9wOmMudG9wLHdpZHRoOmgsaGVpZ2h0Omd9fX19LHJlc2l6ZTpmdW5jdGlvbihiKXt2YXIgYT1lKHRoaXMpLmRhdGEoXCJyZXNpemFibGVcIiksYz1hLm9wdGlvbnMsZD1hLmNvbnRhaW5lck9mZnNldCxmPWEucG9zaXRpb247Yj1hLl9hc3BlY3RSYXRpb3x8Yi5zaGlmdEtleTt2YXIgZz17dG9wOjAsbGVmdDowfSxoPWEuY29udGFpbmVyRWxlbWVudDtpZihoWzBdIT1kb2N1bWVudCYmL3N0YXRpYy8udGVzdChoLmNzcyhcInBvc2l0aW9uXCIpKSlnPWQ7aWYoZi5sZWZ0PChhLl9oZWxwZXI/ZC5sZWZ0OjApKXthLnNpemUud2lkdGgrPWEuX2hlbHBlcj9hLnBvc2l0aW9uLmxlZnQtZC5sZWZ0OlxuYS5wb3NpdGlvbi5sZWZ0LWcubGVmdDtpZihiKWEuc2l6ZS5oZWlnaHQ9YS5zaXplLndpZHRoL2MuYXNwZWN0UmF0aW87YS5wb3NpdGlvbi5sZWZ0PWMuaGVscGVyP2QubGVmdDowfWlmKGYudG9wPChhLl9oZWxwZXI/ZC50b3A6MCkpe2Euc2l6ZS5oZWlnaHQrPWEuX2hlbHBlcj9hLnBvc2l0aW9uLnRvcC1kLnRvcDphLnBvc2l0aW9uLnRvcDtpZihiKWEuc2l6ZS53aWR0aD1hLnNpemUuaGVpZ2h0KmMuYXNwZWN0UmF0aW87YS5wb3NpdGlvbi50b3A9YS5faGVscGVyP2QudG9wOjB9YS5vZmZzZXQubGVmdD1hLnBhcmVudERhdGEubGVmdCthLnBvc2l0aW9uLmxlZnQ7YS5vZmZzZXQudG9wPWEucGFyZW50RGF0YS50b3ArYS5wb3NpdGlvbi50b3A7Yz1NYXRoLmFicygoYS5faGVscGVyP2Eub2Zmc2V0LmxlZnQtZy5sZWZ0OmEub2Zmc2V0LmxlZnQtZy5sZWZ0KSthLnNpemVEaWZmLndpZHRoKTtkPU1hdGguYWJzKChhLl9oZWxwZXI/YS5vZmZzZXQudG9wLWcudG9wOmEub2Zmc2V0LnRvcC1cbmQudG9wKSthLnNpemVEaWZmLmhlaWdodCk7Zj1hLmNvbnRhaW5lckVsZW1lbnQuZ2V0KDApPT1hLmVsZW1lbnQucGFyZW50KCkuZ2V0KDApO2c9L3JlbGF0aXZlfGFic29sdXRlLy50ZXN0KGEuY29udGFpbmVyRWxlbWVudC5jc3MoXCJwb3NpdGlvblwiKSk7aWYoZiYmZyljLT1hLnBhcmVudERhdGEubGVmdDtpZihjK2Euc2l6ZS53aWR0aD49YS5wYXJlbnREYXRhLndpZHRoKXthLnNpemUud2lkdGg9YS5wYXJlbnREYXRhLndpZHRoLWM7aWYoYilhLnNpemUuaGVpZ2h0PWEuc2l6ZS53aWR0aC9hLmFzcGVjdFJhdGlvfWlmKGQrYS5zaXplLmhlaWdodD49YS5wYXJlbnREYXRhLmhlaWdodCl7YS5zaXplLmhlaWdodD1hLnBhcmVudERhdGEuaGVpZ2h0LWQ7aWYoYilhLnNpemUud2lkdGg9YS5zaXplLmhlaWdodCphLmFzcGVjdFJhdGlvfX0sc3RvcDpmdW5jdGlvbigpe3ZhciBiPWUodGhpcykuZGF0YShcInJlc2l6YWJsZVwiKSxhPWIub3B0aW9ucyxjPWIuY29udGFpbmVyT2Zmc2V0LGQ9Yi5jb250YWluZXJQb3NpdGlvbixcbmY9Yi5jb250YWluZXJFbGVtZW50LGc9ZShiLmhlbHBlciksaD1nLm9mZnNldCgpLGk9Zy5vdXRlcldpZHRoKCktYi5zaXplRGlmZi53aWR0aDtnPWcub3V0ZXJIZWlnaHQoKS1iLnNpemVEaWZmLmhlaWdodDtiLl9oZWxwZXImJiFhLmFuaW1hdGUmJi9yZWxhdGl2ZS8udGVzdChmLmNzcyhcInBvc2l0aW9uXCIpKSYmZSh0aGlzKS5jc3Moe2xlZnQ6aC5sZWZ0LWQubGVmdC1jLmxlZnQsd2lkdGg6aSxoZWlnaHQ6Z30pO2IuX2hlbHBlciYmIWEuYW5pbWF0ZSYmL3N0YXRpYy8udGVzdChmLmNzcyhcInBvc2l0aW9uXCIpKSYmZSh0aGlzKS5jc3Moe2xlZnQ6aC5sZWZ0LWQubGVmdC1jLmxlZnQsd2lkdGg6aSxoZWlnaHQ6Z30pfX0pO2UudWkucGx1Z2luLmFkZChcInJlc2l6YWJsZVwiLFwiZ2hvc3RcIix7c3RhcnQ6ZnVuY3Rpb24oKXt2YXIgYj1lKHRoaXMpLmRhdGEoXCJyZXNpemFibGVcIiksYT1iLm9wdGlvbnMsYz1iLnNpemU7Yi5naG9zdD1iLm9yaWdpbmFsRWxlbWVudC5jbG9uZSgpO2IuZ2hvc3QuY3NzKHtvcGFjaXR5OjAuMjUsXG5kaXNwbGF5OlwiYmxvY2tcIixwb3NpdGlvbjpcInJlbGF0aXZlXCIsaGVpZ2h0OmMuaGVpZ2h0LHdpZHRoOmMud2lkdGgsbWFyZ2luOjAsbGVmdDowLHRvcDowfSkuYWRkQ2xhc3MoXCJ1aS1yZXNpemFibGUtZ2hvc3RcIikuYWRkQ2xhc3ModHlwZW9mIGEuZ2hvc3Q9PVwic3RyaW5nXCI/YS5naG9zdDpcIlwiKTtiLmdob3N0LmFwcGVuZFRvKGIuaGVscGVyKX0scmVzaXplOmZ1bmN0aW9uKCl7dmFyIGI9ZSh0aGlzKS5kYXRhKFwicmVzaXphYmxlXCIpO2IuZ2hvc3QmJmIuZ2hvc3QuY3NzKHtwb3NpdGlvbjpcInJlbGF0aXZlXCIsaGVpZ2h0OmIuc2l6ZS5oZWlnaHQsd2lkdGg6Yi5zaXplLndpZHRofSl9LHN0b3A6ZnVuY3Rpb24oKXt2YXIgYj1lKHRoaXMpLmRhdGEoXCJyZXNpemFibGVcIik7Yi5naG9zdCYmYi5oZWxwZXImJmIuaGVscGVyLmdldCgwKS5yZW1vdmVDaGlsZChiLmdob3N0LmdldCgwKSl9fSk7ZS51aS5wbHVnaW4uYWRkKFwicmVzaXphYmxlXCIsXCJncmlkXCIse3Jlc2l6ZTpmdW5jdGlvbigpe3ZhciBiPVxuZSh0aGlzKS5kYXRhKFwicmVzaXphYmxlXCIpLGE9Yi5vcHRpb25zLGM9Yi5zaXplLGQ9Yi5vcmlnaW5hbFNpemUsZj1iLm9yaWdpbmFsUG9zaXRpb24sZz1iLmF4aXM7YS5ncmlkPXR5cGVvZiBhLmdyaWQ9PVwibnVtYmVyXCI/W2EuZ3JpZCxhLmdyaWRdOmEuZ3JpZDt2YXIgaD1NYXRoLnJvdW5kKChjLndpZHRoLWQud2lkdGgpLyhhLmdyaWRbMF18fDEpKSooYS5ncmlkWzBdfHwxKTthPU1hdGgucm91bmQoKGMuaGVpZ2h0LWQuaGVpZ2h0KS8oYS5ncmlkWzFdfHwxKSkqKGEuZ3JpZFsxXXx8MSk7aWYoL14oc2V8c3xlKSQvLnRlc3QoZykpe2Iuc2l6ZS53aWR0aD1kLndpZHRoK2g7Yi5zaXplLmhlaWdodD1kLmhlaWdodCthfWVsc2UgaWYoL14obmUpJC8udGVzdChnKSl7Yi5zaXplLndpZHRoPWQud2lkdGgraDtiLnNpemUuaGVpZ2h0PWQuaGVpZ2h0K2E7Yi5wb3NpdGlvbi50b3A9Zi50b3AtYX1lbHNle2lmKC9eKHN3KSQvLnRlc3QoZykpe2Iuc2l6ZS53aWR0aD1kLndpZHRoK2g7Yi5zaXplLmhlaWdodD1cbmQuaGVpZ2h0K2F9ZWxzZXtiLnNpemUud2lkdGg9ZC53aWR0aCtoO2Iuc2l6ZS5oZWlnaHQ9ZC5oZWlnaHQrYTtiLnBvc2l0aW9uLnRvcD1mLnRvcC1hfWIucG9zaXRpb24ubGVmdD1mLmxlZnQtaH19fSk7dmFyIG09ZnVuY3Rpb24oYil7cmV0dXJuIHBhcnNlSW50KGIsMTApfHwwfSxrPWZ1bmN0aW9uKGIpe3JldHVybiFpc05hTihwYXJzZUludChiLDEwKSl9fSkoalF1ZXJ5KTtcbjsvKlxuICogalF1ZXJ5IFVJIFNlbGVjdGFibGUgMS44LjE2XG4gKlxuICogQ29weXJpZ2h0IDIwMTEsIEFVVEhPUlMudHh0IChodHRwOi8vanF1ZXJ5dWkuY29tL2Fib3V0KVxuICogRHVhbCBsaWNlbnNlZCB1bmRlciB0aGUgTUlUIG9yIEdQTCBWZXJzaW9uIDIgbGljZW5zZXMuXG4gKiBodHRwOi8vanF1ZXJ5Lm9yZy9saWNlbnNlXG4gKlxuICogaHR0cDovL2RvY3MuanF1ZXJ5LmNvbS9VSS9TZWxlY3RhYmxlc1xuICpcbiAqIERlcGVuZHM6XG4gKlx0anF1ZXJ5LnVpLmNvcmUuanNcbiAqXHRqcXVlcnkudWkubW91c2UuanNcbiAqXHRqcXVlcnkudWkud2lkZ2V0LmpzXG4gKi9cbihmdW5jdGlvbihlKXtlLndpZGdldChcInVpLnNlbGVjdGFibGVcIixlLnVpLm1vdXNlLHtvcHRpb25zOnthcHBlbmRUbzpcImJvZHlcIixhdXRvUmVmcmVzaDp0cnVlLGRpc3RhbmNlOjAsZmlsdGVyOlwiKlwiLHRvbGVyYW5jZTpcInRvdWNoXCJ9LF9jcmVhdGU6ZnVuY3Rpb24oKXt2YXIgYz10aGlzO3RoaXMuZWxlbWVudC5hZGRDbGFzcyhcInVpLXNlbGVjdGFibGVcIik7dGhpcy5kcmFnZ2VkPWZhbHNlO3ZhciBmO3RoaXMucmVmcmVzaD1mdW5jdGlvbigpe2Y9ZShjLm9wdGlvbnMuZmlsdGVyLGMuZWxlbWVudFswXSk7Zi5lYWNoKGZ1bmN0aW9uKCl7dmFyIGQ9ZSh0aGlzKSxiPWQub2Zmc2V0KCk7ZS5kYXRhKHRoaXMsXCJzZWxlY3RhYmxlLWl0ZW1cIix7ZWxlbWVudDp0aGlzLCRlbGVtZW50OmQsbGVmdDpiLmxlZnQsdG9wOmIudG9wLHJpZ2h0OmIubGVmdCtkLm91dGVyV2lkdGgoKSxib3R0b206Yi50b3ArZC5vdXRlckhlaWdodCgpLHN0YXJ0c2VsZWN0ZWQ6ZmFsc2Usc2VsZWN0ZWQ6ZC5oYXNDbGFzcyhcInVpLXNlbGVjdGVkXCIpLFxuc2VsZWN0aW5nOmQuaGFzQ2xhc3MoXCJ1aS1zZWxlY3RpbmdcIiksdW5zZWxlY3Rpbmc6ZC5oYXNDbGFzcyhcInVpLXVuc2VsZWN0aW5nXCIpfSl9KX07dGhpcy5yZWZyZXNoKCk7dGhpcy5zZWxlY3RlZXM9Zi5hZGRDbGFzcyhcInVpLXNlbGVjdGVlXCIpO3RoaXMuX21vdXNlSW5pdCgpO3RoaXMuaGVscGVyPWUoXCI8ZGl2IGNsYXNzPSd1aS1zZWxlY3RhYmxlLWhlbHBlcic+PC9kaXY+XCIpfSxkZXN0cm95OmZ1bmN0aW9uKCl7dGhpcy5zZWxlY3RlZXMucmVtb3ZlQ2xhc3MoXCJ1aS1zZWxlY3RlZVwiKS5yZW1vdmVEYXRhKFwic2VsZWN0YWJsZS1pdGVtXCIpO3RoaXMuZWxlbWVudC5yZW1vdmVDbGFzcyhcInVpLXNlbGVjdGFibGUgdWktc2VsZWN0YWJsZS1kaXNhYmxlZFwiKS5yZW1vdmVEYXRhKFwic2VsZWN0YWJsZVwiKS51bmJpbmQoXCIuc2VsZWN0YWJsZVwiKTt0aGlzLl9tb3VzZURlc3Ryb3koKTtyZXR1cm4gdGhpc30sX21vdXNlU3RhcnQ6ZnVuY3Rpb24oYyl7dmFyIGY9dGhpczt0aGlzLm9wb3M9W2MucGFnZVgsXG5jLnBhZ2VZXTtpZighdGhpcy5vcHRpb25zLmRpc2FibGVkKXt2YXIgZD10aGlzLm9wdGlvbnM7dGhpcy5zZWxlY3RlZXM9ZShkLmZpbHRlcix0aGlzLmVsZW1lbnRbMF0pO3RoaXMuX3RyaWdnZXIoXCJzdGFydFwiLGMpO2UoZC5hcHBlbmRUbykuYXBwZW5kKHRoaXMuaGVscGVyKTt0aGlzLmhlbHBlci5jc3Moe2xlZnQ6Yy5jbGllbnRYLHRvcDpjLmNsaWVudFksd2lkdGg6MCxoZWlnaHQ6MH0pO2QuYXV0b1JlZnJlc2gmJnRoaXMucmVmcmVzaCgpO3RoaXMuc2VsZWN0ZWVzLmZpbHRlcihcIi51aS1zZWxlY3RlZFwiKS5lYWNoKGZ1bmN0aW9uKCl7dmFyIGI9ZS5kYXRhKHRoaXMsXCJzZWxlY3RhYmxlLWl0ZW1cIik7Yi5zdGFydHNlbGVjdGVkPXRydWU7aWYoIWMubWV0YUtleSl7Yi4kZWxlbWVudC5yZW1vdmVDbGFzcyhcInVpLXNlbGVjdGVkXCIpO2Iuc2VsZWN0ZWQ9ZmFsc2U7Yi4kZWxlbWVudC5hZGRDbGFzcyhcInVpLXVuc2VsZWN0aW5nXCIpO2IudW5zZWxlY3Rpbmc9dHJ1ZTtmLl90cmlnZ2VyKFwidW5zZWxlY3RpbmdcIixcbmMse3Vuc2VsZWN0aW5nOmIuZWxlbWVudH0pfX0pO2UoYy50YXJnZXQpLnBhcmVudHMoKS5hbmRTZWxmKCkuZWFjaChmdW5jdGlvbigpe3ZhciBiPWUuZGF0YSh0aGlzLFwic2VsZWN0YWJsZS1pdGVtXCIpO2lmKGIpe3ZhciBnPSFjLm1ldGFLZXl8fCFiLiRlbGVtZW50Lmhhc0NsYXNzKFwidWktc2VsZWN0ZWRcIik7Yi4kZWxlbWVudC5yZW1vdmVDbGFzcyhnP1widWktdW5zZWxlY3RpbmdcIjpcInVpLXNlbGVjdGVkXCIpLmFkZENsYXNzKGc/XCJ1aS1zZWxlY3RpbmdcIjpcInVpLXVuc2VsZWN0aW5nXCIpO2IudW5zZWxlY3Rpbmc9IWc7Yi5zZWxlY3Rpbmc9ZzsoYi5zZWxlY3RlZD1nKT9mLl90cmlnZ2VyKFwic2VsZWN0aW5nXCIsYyx7c2VsZWN0aW5nOmIuZWxlbWVudH0pOmYuX3RyaWdnZXIoXCJ1bnNlbGVjdGluZ1wiLGMse3Vuc2VsZWN0aW5nOmIuZWxlbWVudH0pO3JldHVybiBmYWxzZX19KX19LF9tb3VzZURyYWc6ZnVuY3Rpb24oYyl7dmFyIGY9dGhpczt0aGlzLmRyYWdnZWQ9dHJ1ZTtpZighdGhpcy5vcHRpb25zLmRpc2FibGVkKXt2YXIgZD1cbnRoaXMub3B0aW9ucyxiPXRoaXMub3Bvc1swXSxnPXRoaXMub3Bvc1sxXSxoPWMucGFnZVgsaT1jLnBhZ2VZO2lmKGI+aCl7dmFyIGo9aDtoPWI7Yj1qfWlmKGc+aSl7aj1pO2k9ZztnPWp9dGhpcy5oZWxwZXIuY3NzKHtsZWZ0OmIsdG9wOmcsd2lkdGg6aC1iLGhlaWdodDppLWd9KTt0aGlzLnNlbGVjdGVlcy5lYWNoKGZ1bmN0aW9uKCl7dmFyIGE9ZS5kYXRhKHRoaXMsXCJzZWxlY3RhYmxlLWl0ZW1cIik7aWYoISghYXx8YS5lbGVtZW50PT1mLmVsZW1lbnRbMF0pKXt2YXIgaz1mYWxzZTtpZihkLnRvbGVyYW5jZT09XCJ0b3VjaFwiKWs9IShhLmxlZnQ+aHx8YS5yaWdodDxifHxhLnRvcD5pfHxhLmJvdHRvbTxnKTtlbHNlIGlmKGQudG9sZXJhbmNlPT1cImZpdFwiKWs9YS5sZWZ0PmImJmEucmlnaHQ8aCYmYS50b3A+ZyYmYS5ib3R0b208aTtpZihrKXtpZihhLnNlbGVjdGVkKXthLiRlbGVtZW50LnJlbW92ZUNsYXNzKFwidWktc2VsZWN0ZWRcIik7YS5zZWxlY3RlZD1mYWxzZX1pZihhLnVuc2VsZWN0aW5nKXthLiRlbGVtZW50LnJlbW92ZUNsYXNzKFwidWktdW5zZWxlY3RpbmdcIik7XG5hLnVuc2VsZWN0aW5nPWZhbHNlfWlmKCFhLnNlbGVjdGluZyl7YS4kZWxlbWVudC5hZGRDbGFzcyhcInVpLXNlbGVjdGluZ1wiKTthLnNlbGVjdGluZz10cnVlO2YuX3RyaWdnZXIoXCJzZWxlY3RpbmdcIixjLHtzZWxlY3Rpbmc6YS5lbGVtZW50fSl9fWVsc2V7aWYoYS5zZWxlY3RpbmcpaWYoYy5tZXRhS2V5JiZhLnN0YXJ0c2VsZWN0ZWQpe2EuJGVsZW1lbnQucmVtb3ZlQ2xhc3MoXCJ1aS1zZWxlY3RpbmdcIik7YS5zZWxlY3Rpbmc9ZmFsc2U7YS4kZWxlbWVudC5hZGRDbGFzcyhcInVpLXNlbGVjdGVkXCIpO2Euc2VsZWN0ZWQ9dHJ1ZX1lbHNle2EuJGVsZW1lbnQucmVtb3ZlQ2xhc3MoXCJ1aS1zZWxlY3RpbmdcIik7YS5zZWxlY3Rpbmc9ZmFsc2U7aWYoYS5zdGFydHNlbGVjdGVkKXthLiRlbGVtZW50LmFkZENsYXNzKFwidWktdW5zZWxlY3RpbmdcIik7YS51bnNlbGVjdGluZz10cnVlfWYuX3RyaWdnZXIoXCJ1bnNlbGVjdGluZ1wiLGMse3Vuc2VsZWN0aW5nOmEuZWxlbWVudH0pfWlmKGEuc2VsZWN0ZWQpaWYoIWMubWV0YUtleSYmXG4hYS5zdGFydHNlbGVjdGVkKXthLiRlbGVtZW50LnJlbW92ZUNsYXNzKFwidWktc2VsZWN0ZWRcIik7YS5zZWxlY3RlZD1mYWxzZTthLiRlbGVtZW50LmFkZENsYXNzKFwidWktdW5zZWxlY3RpbmdcIik7YS51bnNlbGVjdGluZz10cnVlO2YuX3RyaWdnZXIoXCJ1bnNlbGVjdGluZ1wiLGMse3Vuc2VsZWN0aW5nOmEuZWxlbWVudH0pfX19fSk7cmV0dXJuIGZhbHNlfX0sX21vdXNlU3RvcDpmdW5jdGlvbihjKXt2YXIgZj10aGlzO3RoaXMuZHJhZ2dlZD1mYWxzZTtlKFwiLnVpLXVuc2VsZWN0aW5nXCIsdGhpcy5lbGVtZW50WzBdKS5lYWNoKGZ1bmN0aW9uKCl7dmFyIGQ9ZS5kYXRhKHRoaXMsXCJzZWxlY3RhYmxlLWl0ZW1cIik7ZC4kZWxlbWVudC5yZW1vdmVDbGFzcyhcInVpLXVuc2VsZWN0aW5nXCIpO2QudW5zZWxlY3Rpbmc9ZmFsc2U7ZC5zdGFydHNlbGVjdGVkPWZhbHNlO2YuX3RyaWdnZXIoXCJ1bnNlbGVjdGVkXCIsYyx7dW5zZWxlY3RlZDpkLmVsZW1lbnR9KX0pO2UoXCIudWktc2VsZWN0aW5nXCIsdGhpcy5lbGVtZW50WzBdKS5lYWNoKGZ1bmN0aW9uKCl7dmFyIGQ9XG5lLmRhdGEodGhpcyxcInNlbGVjdGFibGUtaXRlbVwiKTtkLiRlbGVtZW50LnJlbW92ZUNsYXNzKFwidWktc2VsZWN0aW5nXCIpLmFkZENsYXNzKFwidWktc2VsZWN0ZWRcIik7ZC5zZWxlY3Rpbmc9ZmFsc2U7ZC5zZWxlY3RlZD10cnVlO2Quc3RhcnRzZWxlY3RlZD10cnVlO2YuX3RyaWdnZXIoXCJzZWxlY3RlZFwiLGMse3NlbGVjdGVkOmQuZWxlbWVudH0pfSk7dGhpcy5fdHJpZ2dlcihcInN0b3BcIixjKTt0aGlzLmhlbHBlci5yZW1vdmUoKTtyZXR1cm4gZmFsc2V9fSk7ZS5leHRlbmQoZS51aS5zZWxlY3RhYmxlLHt2ZXJzaW9uOlwiMS44LjE2XCJ9KX0pKGpRdWVyeSk7XG47LypcbiAqIGpRdWVyeSBVSSBTb3J0YWJsZSAxLjguMTZcbiAqXG4gKiBDb3B5cmlnaHQgMjAxMSwgQVVUSE9SUy50eHQgKGh0dHA6Ly9qcXVlcnl1aS5jb20vYWJvdXQpXG4gKiBEdWFsIGxpY2Vuc2VkIHVuZGVyIHRoZSBNSVQgb3IgR1BMIFZlcnNpb24gMiBsaWNlbnNlcy5cbiAqIGh0dHA6Ly9qcXVlcnkub3JnL2xpY2Vuc2VcbiAqXG4gKiBodHRwOi8vZG9jcy5qcXVlcnkuY29tL1VJL1NvcnRhYmxlc1xuICpcbiAqIERlcGVuZHM6XG4gKlx0anF1ZXJ5LnVpLmNvcmUuanNcbiAqXHRqcXVlcnkudWkubW91c2UuanNcbiAqXHRqcXVlcnkudWkud2lkZ2V0LmpzXG4gKi9cbihmdW5jdGlvbihkKXtkLndpZGdldChcInVpLnNvcnRhYmxlXCIsZC51aS5tb3VzZSx7d2lkZ2V0RXZlbnRQcmVmaXg6XCJzb3J0XCIsb3B0aW9uczp7YXBwZW5kVG86XCJwYXJlbnRcIixheGlzOmZhbHNlLGNvbm5lY3RXaXRoOmZhbHNlLGNvbnRhaW5tZW50OmZhbHNlLGN1cnNvcjpcImF1dG9cIixjdXJzb3JBdDpmYWxzZSxkcm9wT25FbXB0eTp0cnVlLGZvcmNlUGxhY2Vob2xkZXJTaXplOmZhbHNlLGZvcmNlSGVscGVyU2l6ZTpmYWxzZSxncmlkOmZhbHNlLGhhbmRsZTpmYWxzZSxoZWxwZXI6XCJvcmlnaW5hbFwiLGl0ZW1zOlwiPiAqXCIsb3BhY2l0eTpmYWxzZSxwbGFjZWhvbGRlcjpmYWxzZSxyZXZlcnQ6ZmFsc2Usc2Nyb2xsOnRydWUsc2Nyb2xsU2Vuc2l0aXZpdHk6MjAsc2Nyb2xsU3BlZWQ6MjAsc2NvcGU6XCJkZWZhdWx0XCIsdG9sZXJhbmNlOlwiaW50ZXJzZWN0XCIsekluZGV4OjFFM30sX2NyZWF0ZTpmdW5jdGlvbigpe3ZhciBhPXRoaXMub3B0aW9uczt0aGlzLmNvbnRhaW5lckNhY2hlPXt9O3RoaXMuZWxlbWVudC5hZGRDbGFzcyhcInVpLXNvcnRhYmxlXCIpO1xudGhpcy5yZWZyZXNoKCk7dGhpcy5mbG9hdGluZz10aGlzLml0ZW1zLmxlbmd0aD9hLmF4aXM9PT1cInhcInx8L2xlZnR8cmlnaHQvLnRlc3QodGhpcy5pdGVtc1swXS5pdGVtLmNzcyhcImZsb2F0XCIpKXx8L2lubGluZXx0YWJsZS1jZWxsLy50ZXN0KHRoaXMuaXRlbXNbMF0uaXRlbS5jc3MoXCJkaXNwbGF5XCIpKTpmYWxzZTt0aGlzLm9mZnNldD10aGlzLmVsZW1lbnQub2Zmc2V0KCk7dGhpcy5fbW91c2VJbml0KCl9LGRlc3Ryb3k6ZnVuY3Rpb24oKXt0aGlzLmVsZW1lbnQucmVtb3ZlQ2xhc3MoXCJ1aS1zb3J0YWJsZSB1aS1zb3J0YWJsZS1kaXNhYmxlZFwiKS5yZW1vdmVEYXRhKFwic29ydGFibGVcIikudW5iaW5kKFwiLnNvcnRhYmxlXCIpO3RoaXMuX21vdXNlRGVzdHJveSgpO2Zvcih2YXIgYT10aGlzLml0ZW1zLmxlbmd0aC0xO2E+PTA7YS0tKXRoaXMuaXRlbXNbYV0uaXRlbS5yZW1vdmVEYXRhKFwic29ydGFibGUtaXRlbVwiKTtyZXR1cm4gdGhpc30sX3NldE9wdGlvbjpmdW5jdGlvbihhLGIpe2lmKGE9PT1cblwiZGlzYWJsZWRcIil7dGhpcy5vcHRpb25zW2FdPWI7dGhpcy53aWRnZXQoKVtiP1wiYWRkQ2xhc3NcIjpcInJlbW92ZUNsYXNzXCJdKFwidWktc29ydGFibGUtZGlzYWJsZWRcIil9ZWxzZSBkLldpZGdldC5wcm90b3R5cGUuX3NldE9wdGlvbi5hcHBseSh0aGlzLGFyZ3VtZW50cyl9LF9tb3VzZUNhcHR1cmU6ZnVuY3Rpb24oYSxiKXtpZih0aGlzLnJldmVydGluZylyZXR1cm4gZmFsc2U7aWYodGhpcy5vcHRpb25zLmRpc2FibGVkfHx0aGlzLm9wdGlvbnMudHlwZT09XCJzdGF0aWNcIilyZXR1cm4gZmFsc2U7dGhpcy5fcmVmcmVzaEl0ZW1zKGEpO3ZhciBjPW51bGwsZT10aGlzO2QoYS50YXJnZXQpLnBhcmVudHMoKS5lYWNoKGZ1bmN0aW9uKCl7aWYoZC5kYXRhKHRoaXMsXCJzb3J0YWJsZS1pdGVtXCIpPT1lKXtjPWQodGhpcyk7cmV0dXJuIGZhbHNlfX0pO2lmKGQuZGF0YShhLnRhcmdldCxcInNvcnRhYmxlLWl0ZW1cIik9PWUpYz1kKGEudGFyZ2V0KTtpZighYylyZXR1cm4gZmFsc2U7aWYodGhpcy5vcHRpb25zLmhhbmRsZSYmXG4hYil7dmFyIGY9ZmFsc2U7ZCh0aGlzLm9wdGlvbnMuaGFuZGxlLGMpLmZpbmQoXCIqXCIpLmFuZFNlbGYoKS5lYWNoKGZ1bmN0aW9uKCl7aWYodGhpcz09YS50YXJnZXQpZj10cnVlfSk7aWYoIWYpcmV0dXJuIGZhbHNlfXRoaXMuY3VycmVudEl0ZW09Yzt0aGlzLl9yZW1vdmVDdXJyZW50c0Zyb21JdGVtcygpO3JldHVybiB0cnVlfSxfbW91c2VTdGFydDpmdW5jdGlvbihhLGIsYyl7Yj10aGlzLm9wdGlvbnM7dmFyIGU9dGhpczt0aGlzLmN1cnJlbnRDb250YWluZXI9dGhpczt0aGlzLnJlZnJlc2hQb3NpdGlvbnMoKTt0aGlzLmhlbHBlcj10aGlzLl9jcmVhdGVIZWxwZXIoYSk7dGhpcy5fY2FjaGVIZWxwZXJQcm9wb3J0aW9ucygpO3RoaXMuX2NhY2hlTWFyZ2lucygpO3RoaXMuc2Nyb2xsUGFyZW50PXRoaXMuaGVscGVyLnNjcm9sbFBhcmVudCgpO3RoaXMub2Zmc2V0PXRoaXMuY3VycmVudEl0ZW0ub2Zmc2V0KCk7dGhpcy5vZmZzZXQ9e3RvcDp0aGlzLm9mZnNldC50b3AtdGhpcy5tYXJnaW5zLnRvcCxcbmxlZnQ6dGhpcy5vZmZzZXQubGVmdC10aGlzLm1hcmdpbnMubGVmdH07dGhpcy5oZWxwZXIuY3NzKFwicG9zaXRpb25cIixcImFic29sdXRlXCIpO3RoaXMuY3NzUG9zaXRpb249dGhpcy5oZWxwZXIuY3NzKFwicG9zaXRpb25cIik7ZC5leHRlbmQodGhpcy5vZmZzZXQse2NsaWNrOntsZWZ0OmEucGFnZVgtdGhpcy5vZmZzZXQubGVmdCx0b3A6YS5wYWdlWS10aGlzLm9mZnNldC50b3B9LHBhcmVudDp0aGlzLl9nZXRQYXJlbnRPZmZzZXQoKSxyZWxhdGl2ZTp0aGlzLl9nZXRSZWxhdGl2ZU9mZnNldCgpfSk7dGhpcy5vcmlnaW5hbFBvc2l0aW9uPXRoaXMuX2dlbmVyYXRlUG9zaXRpb24oYSk7dGhpcy5vcmlnaW5hbFBhZ2VYPWEucGFnZVg7dGhpcy5vcmlnaW5hbFBhZ2VZPWEucGFnZVk7Yi5jdXJzb3JBdCYmdGhpcy5fYWRqdXN0T2Zmc2V0RnJvbUhlbHBlcihiLmN1cnNvckF0KTt0aGlzLmRvbVBvc2l0aW9uPXtwcmV2OnRoaXMuY3VycmVudEl0ZW0ucHJldigpWzBdLHBhcmVudDp0aGlzLmN1cnJlbnRJdGVtLnBhcmVudCgpWzBdfTtcbnRoaXMuaGVscGVyWzBdIT10aGlzLmN1cnJlbnRJdGVtWzBdJiZ0aGlzLmN1cnJlbnRJdGVtLmhpZGUoKTt0aGlzLl9jcmVhdGVQbGFjZWhvbGRlcigpO2IuY29udGFpbm1lbnQmJnRoaXMuX3NldENvbnRhaW5tZW50KCk7aWYoYi5jdXJzb3Ipe2lmKGQoXCJib2R5XCIpLmNzcyhcImN1cnNvclwiKSl0aGlzLl9zdG9yZWRDdXJzb3I9ZChcImJvZHlcIikuY3NzKFwiY3Vyc29yXCIpO2QoXCJib2R5XCIpLmNzcyhcImN1cnNvclwiLGIuY3Vyc29yKX1pZihiLm9wYWNpdHkpe2lmKHRoaXMuaGVscGVyLmNzcyhcIm9wYWNpdHlcIikpdGhpcy5fc3RvcmVkT3BhY2l0eT10aGlzLmhlbHBlci5jc3MoXCJvcGFjaXR5XCIpO3RoaXMuaGVscGVyLmNzcyhcIm9wYWNpdHlcIixiLm9wYWNpdHkpfWlmKGIuekluZGV4KXtpZih0aGlzLmhlbHBlci5jc3MoXCJ6SW5kZXhcIikpdGhpcy5fc3RvcmVkWkluZGV4PXRoaXMuaGVscGVyLmNzcyhcInpJbmRleFwiKTt0aGlzLmhlbHBlci5jc3MoXCJ6SW5kZXhcIixiLnpJbmRleCl9aWYodGhpcy5zY3JvbGxQYXJlbnRbMF0hPVxuZG9jdW1lbnQmJnRoaXMuc2Nyb2xsUGFyZW50WzBdLnRhZ05hbWUhPVwiSFRNTFwiKXRoaXMub3ZlcmZsb3dPZmZzZXQ9dGhpcy5zY3JvbGxQYXJlbnQub2Zmc2V0KCk7dGhpcy5fdHJpZ2dlcihcInN0YXJ0XCIsYSx0aGlzLl91aUhhc2goKSk7dGhpcy5fcHJlc2VydmVIZWxwZXJQcm9wb3J0aW9uc3x8dGhpcy5fY2FjaGVIZWxwZXJQcm9wb3J0aW9ucygpO2lmKCFjKWZvcihjPXRoaXMuY29udGFpbmVycy5sZW5ndGgtMTtjPj0wO2MtLSl0aGlzLmNvbnRhaW5lcnNbY10uX3RyaWdnZXIoXCJhY3RpdmF0ZVwiLGEsZS5fdWlIYXNoKHRoaXMpKTtpZihkLnVpLmRkbWFuYWdlcilkLnVpLmRkbWFuYWdlci5jdXJyZW50PXRoaXM7ZC51aS5kZG1hbmFnZXImJiFiLmRyb3BCZWhhdmlvdXImJmQudWkuZGRtYW5hZ2VyLnByZXBhcmVPZmZzZXRzKHRoaXMsYSk7dGhpcy5kcmFnZ2luZz10cnVlO3RoaXMuaGVscGVyLmFkZENsYXNzKFwidWktc29ydGFibGUtaGVscGVyXCIpO3RoaXMuX21vdXNlRHJhZyhhKTtcbnJldHVybiB0cnVlfSxfbW91c2VEcmFnOmZ1bmN0aW9uKGEpe3RoaXMucG9zaXRpb249dGhpcy5fZ2VuZXJhdGVQb3NpdGlvbihhKTt0aGlzLnBvc2l0aW9uQWJzPXRoaXMuX2NvbnZlcnRQb3NpdGlvblRvKFwiYWJzb2x1dGVcIik7aWYoIXRoaXMubGFzdFBvc2l0aW9uQWJzKXRoaXMubGFzdFBvc2l0aW9uQWJzPXRoaXMucG9zaXRpb25BYnM7aWYodGhpcy5vcHRpb25zLnNjcm9sbCl7dmFyIGI9dGhpcy5vcHRpb25zLGM9ZmFsc2U7aWYodGhpcy5zY3JvbGxQYXJlbnRbMF0hPWRvY3VtZW50JiZ0aGlzLnNjcm9sbFBhcmVudFswXS50YWdOYW1lIT1cIkhUTUxcIil7aWYodGhpcy5vdmVyZmxvd09mZnNldC50b3ArdGhpcy5zY3JvbGxQYXJlbnRbMF0ub2Zmc2V0SGVpZ2h0LWEucGFnZVk8Yi5zY3JvbGxTZW5zaXRpdml0eSl0aGlzLnNjcm9sbFBhcmVudFswXS5zY3JvbGxUb3A9Yz10aGlzLnNjcm9sbFBhcmVudFswXS5zY3JvbGxUb3ArYi5zY3JvbGxTcGVlZDtlbHNlIGlmKGEucGFnZVktdGhpcy5vdmVyZmxvd09mZnNldC50b3A8XG5iLnNjcm9sbFNlbnNpdGl2aXR5KXRoaXMuc2Nyb2xsUGFyZW50WzBdLnNjcm9sbFRvcD1jPXRoaXMuc2Nyb2xsUGFyZW50WzBdLnNjcm9sbFRvcC1iLnNjcm9sbFNwZWVkO2lmKHRoaXMub3ZlcmZsb3dPZmZzZXQubGVmdCt0aGlzLnNjcm9sbFBhcmVudFswXS5vZmZzZXRXaWR0aC1hLnBhZ2VYPGIuc2Nyb2xsU2Vuc2l0aXZpdHkpdGhpcy5zY3JvbGxQYXJlbnRbMF0uc2Nyb2xsTGVmdD1jPXRoaXMuc2Nyb2xsUGFyZW50WzBdLnNjcm9sbExlZnQrYi5zY3JvbGxTcGVlZDtlbHNlIGlmKGEucGFnZVgtdGhpcy5vdmVyZmxvd09mZnNldC5sZWZ0PGIuc2Nyb2xsU2Vuc2l0aXZpdHkpdGhpcy5zY3JvbGxQYXJlbnRbMF0uc2Nyb2xsTGVmdD1jPXRoaXMuc2Nyb2xsUGFyZW50WzBdLnNjcm9sbExlZnQtYi5zY3JvbGxTcGVlZH1lbHNle2lmKGEucGFnZVktZChkb2N1bWVudCkuc2Nyb2xsVG9wKCk8Yi5zY3JvbGxTZW5zaXRpdml0eSljPWQoZG9jdW1lbnQpLnNjcm9sbFRvcChkKGRvY3VtZW50KS5zY3JvbGxUb3AoKS1cbmIuc2Nyb2xsU3BlZWQpO2Vsc2UgaWYoZCh3aW5kb3cpLmhlaWdodCgpLShhLnBhZ2VZLWQoZG9jdW1lbnQpLnNjcm9sbFRvcCgpKTxiLnNjcm9sbFNlbnNpdGl2aXR5KWM9ZChkb2N1bWVudCkuc2Nyb2xsVG9wKGQoZG9jdW1lbnQpLnNjcm9sbFRvcCgpK2Iuc2Nyb2xsU3BlZWQpO2lmKGEucGFnZVgtZChkb2N1bWVudCkuc2Nyb2xsTGVmdCgpPGIuc2Nyb2xsU2Vuc2l0aXZpdHkpYz1kKGRvY3VtZW50KS5zY3JvbGxMZWZ0KGQoZG9jdW1lbnQpLnNjcm9sbExlZnQoKS1iLnNjcm9sbFNwZWVkKTtlbHNlIGlmKGQod2luZG93KS53aWR0aCgpLShhLnBhZ2VYLWQoZG9jdW1lbnQpLnNjcm9sbExlZnQoKSk8Yi5zY3JvbGxTZW5zaXRpdml0eSljPWQoZG9jdW1lbnQpLnNjcm9sbExlZnQoZChkb2N1bWVudCkuc2Nyb2xsTGVmdCgpK2Iuc2Nyb2xsU3BlZWQpfWMhPT1mYWxzZSYmZC51aS5kZG1hbmFnZXImJiFiLmRyb3BCZWhhdmlvdXImJmQudWkuZGRtYW5hZ2VyLnByZXBhcmVPZmZzZXRzKHRoaXMsXG5hKX10aGlzLnBvc2l0aW9uQWJzPXRoaXMuX2NvbnZlcnRQb3NpdGlvblRvKFwiYWJzb2x1dGVcIik7aWYoIXRoaXMub3B0aW9ucy5heGlzfHx0aGlzLm9wdGlvbnMuYXhpcyE9XCJ5XCIpdGhpcy5oZWxwZXJbMF0uc3R5bGUubGVmdD10aGlzLnBvc2l0aW9uLmxlZnQrXCJweFwiO2lmKCF0aGlzLm9wdGlvbnMuYXhpc3x8dGhpcy5vcHRpb25zLmF4aXMhPVwieFwiKXRoaXMuaGVscGVyWzBdLnN0eWxlLnRvcD10aGlzLnBvc2l0aW9uLnRvcCtcInB4XCI7Zm9yKGI9dGhpcy5pdGVtcy5sZW5ndGgtMTtiPj0wO2ItLSl7Yz10aGlzLml0ZW1zW2JdO3ZhciBlPWMuaXRlbVswXSxmPXRoaXMuX2ludGVyc2VjdHNXaXRoUG9pbnRlcihjKTtpZihmKWlmKGUhPXRoaXMuY3VycmVudEl0ZW1bMF0mJnRoaXMucGxhY2Vob2xkZXJbZj09MT9cIm5leHRcIjpcInByZXZcIl0oKVswXSE9ZSYmIWQudWkuY29udGFpbnModGhpcy5wbGFjZWhvbGRlclswXSxlKSYmKHRoaXMub3B0aW9ucy50eXBlPT1cInNlbWktZHluYW1pY1wiPyFkLnVpLmNvbnRhaW5zKHRoaXMuZWxlbWVudFswXSxcbmUpOnRydWUpKXt0aGlzLmRpcmVjdGlvbj1mPT0xP1wiZG93blwiOlwidXBcIjtpZih0aGlzLm9wdGlvbnMudG9sZXJhbmNlPT1cInBvaW50ZXJcInx8dGhpcy5faW50ZXJzZWN0c1dpdGhTaWRlcyhjKSl0aGlzLl9yZWFycmFuZ2UoYSxjKTtlbHNlIGJyZWFrO3RoaXMuX3RyaWdnZXIoXCJjaGFuZ2VcIixhLHRoaXMuX3VpSGFzaCgpKTticmVha319dGhpcy5fY29udGFjdENvbnRhaW5lcnMoYSk7ZC51aS5kZG1hbmFnZXImJmQudWkuZGRtYW5hZ2VyLmRyYWcodGhpcyxhKTt0aGlzLl90cmlnZ2VyKFwic29ydFwiLGEsdGhpcy5fdWlIYXNoKCkpO3RoaXMubGFzdFBvc2l0aW9uQWJzPXRoaXMucG9zaXRpb25BYnM7cmV0dXJuIGZhbHNlfSxfbW91c2VTdG9wOmZ1bmN0aW9uKGEsYil7aWYoYSl7ZC51aS5kZG1hbmFnZXImJiF0aGlzLm9wdGlvbnMuZHJvcEJlaGF2aW91ciYmZC51aS5kZG1hbmFnZXIuZHJvcCh0aGlzLGEpO2lmKHRoaXMub3B0aW9ucy5yZXZlcnQpe3ZhciBjPXRoaXM7Yj1jLnBsYWNlaG9sZGVyLm9mZnNldCgpO1xuYy5yZXZlcnRpbmc9dHJ1ZTtkKHRoaXMuaGVscGVyKS5hbmltYXRlKHtsZWZ0OmIubGVmdC10aGlzLm9mZnNldC5wYXJlbnQubGVmdC1jLm1hcmdpbnMubGVmdCsodGhpcy5vZmZzZXRQYXJlbnRbMF09PWRvY3VtZW50LmJvZHk/MDp0aGlzLm9mZnNldFBhcmVudFswXS5zY3JvbGxMZWZ0KSx0b3A6Yi50b3AtdGhpcy5vZmZzZXQucGFyZW50LnRvcC1jLm1hcmdpbnMudG9wKyh0aGlzLm9mZnNldFBhcmVudFswXT09ZG9jdW1lbnQuYm9keT8wOnRoaXMub2Zmc2V0UGFyZW50WzBdLnNjcm9sbFRvcCl9LHBhcnNlSW50KHRoaXMub3B0aW9ucy5yZXZlcnQsMTApfHw1MDAsZnVuY3Rpb24oKXtjLl9jbGVhcihhKX0pfWVsc2UgdGhpcy5fY2xlYXIoYSxiKTtyZXR1cm4gZmFsc2V9fSxjYW5jZWw6ZnVuY3Rpb24oKXt2YXIgYT10aGlzO2lmKHRoaXMuZHJhZ2dpbmcpe3RoaXMuX21vdXNlVXAoe3RhcmdldDpudWxsfSk7dGhpcy5vcHRpb25zLmhlbHBlcj09XCJvcmlnaW5hbFwiP3RoaXMuY3VycmVudEl0ZW0uY3NzKHRoaXMuX3N0b3JlZENTUykucmVtb3ZlQ2xhc3MoXCJ1aS1zb3J0YWJsZS1oZWxwZXJcIik6XG50aGlzLmN1cnJlbnRJdGVtLnNob3coKTtmb3IodmFyIGI9dGhpcy5jb250YWluZXJzLmxlbmd0aC0xO2I+PTA7Yi0tKXt0aGlzLmNvbnRhaW5lcnNbYl0uX3RyaWdnZXIoXCJkZWFjdGl2YXRlXCIsbnVsbCxhLl91aUhhc2godGhpcykpO2lmKHRoaXMuY29udGFpbmVyc1tiXS5jb250YWluZXJDYWNoZS5vdmVyKXt0aGlzLmNvbnRhaW5lcnNbYl0uX3RyaWdnZXIoXCJvdXRcIixudWxsLGEuX3VpSGFzaCh0aGlzKSk7dGhpcy5jb250YWluZXJzW2JdLmNvbnRhaW5lckNhY2hlLm92ZXI9MH19fWlmKHRoaXMucGxhY2Vob2xkZXIpe3RoaXMucGxhY2Vob2xkZXJbMF0ucGFyZW50Tm9kZSYmdGhpcy5wbGFjZWhvbGRlclswXS5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKHRoaXMucGxhY2Vob2xkZXJbMF0pO3RoaXMub3B0aW9ucy5oZWxwZXIhPVwib3JpZ2luYWxcIiYmdGhpcy5oZWxwZXImJnRoaXMuaGVscGVyWzBdLnBhcmVudE5vZGUmJnRoaXMuaGVscGVyLnJlbW92ZSgpO2QuZXh0ZW5kKHRoaXMse2hlbHBlcjpudWxsLFxuZHJhZ2dpbmc6ZmFsc2UscmV2ZXJ0aW5nOmZhbHNlLF9ub0ZpbmFsU29ydDpudWxsfSk7dGhpcy5kb21Qb3NpdGlvbi5wcmV2P2QodGhpcy5kb21Qb3NpdGlvbi5wcmV2KS5hZnRlcih0aGlzLmN1cnJlbnRJdGVtKTpkKHRoaXMuZG9tUG9zaXRpb24ucGFyZW50KS5wcmVwZW5kKHRoaXMuY3VycmVudEl0ZW0pfXJldHVybiB0aGlzfSxzZXJpYWxpemU6ZnVuY3Rpb24oYSl7dmFyIGI9dGhpcy5fZ2V0SXRlbXNBc2pRdWVyeShhJiZhLmNvbm5lY3RlZCksYz1bXTthPWF8fHt9O2QoYikuZWFjaChmdW5jdGlvbigpe3ZhciBlPShkKGEuaXRlbXx8dGhpcykuYXR0cihhLmF0dHJpYnV0ZXx8XCJpZFwiKXx8XCJcIikubWF0Y2goYS5leHByZXNzaW9ufHwvKC4rKVstPV9dKC4rKS8pO2lmKGUpYy5wdXNoKChhLmtleXx8ZVsxXStcIltdXCIpK1wiPVwiKyhhLmtleSYmYS5leHByZXNzaW9uP2VbMV06ZVsyXSkpfSk7IWMubGVuZ3RoJiZhLmtleSYmYy5wdXNoKGEua2V5K1wiPVwiKTtyZXR1cm4gYy5qb2luKFwiJlwiKX0sXG50b0FycmF5OmZ1bmN0aW9uKGEpe3ZhciBiPXRoaXMuX2dldEl0ZW1zQXNqUXVlcnkoYSYmYS5jb25uZWN0ZWQpLGM9W107YT1hfHx7fTtiLmVhY2goZnVuY3Rpb24oKXtjLnB1c2goZChhLml0ZW18fHRoaXMpLmF0dHIoYS5hdHRyaWJ1dGV8fFwiaWRcIil8fFwiXCIpfSk7cmV0dXJuIGN9LF9pbnRlcnNlY3RzV2l0aDpmdW5jdGlvbihhKXt2YXIgYj10aGlzLnBvc2l0aW9uQWJzLmxlZnQsYz1iK3RoaXMuaGVscGVyUHJvcG9ydGlvbnMud2lkdGgsZT10aGlzLnBvc2l0aW9uQWJzLnRvcCxmPWUrdGhpcy5oZWxwZXJQcm9wb3J0aW9ucy5oZWlnaHQsZz1hLmxlZnQsaD1nK2Eud2lkdGgsaT1hLnRvcCxrPWkrYS5oZWlnaHQsaj10aGlzLm9mZnNldC5jbGljay50b3AsbD10aGlzLm9mZnNldC5jbGljay5sZWZ0O2o9ZStqPmkmJmUrajxrJiZiK2w+ZyYmYitsPGg7cmV0dXJuIHRoaXMub3B0aW9ucy50b2xlcmFuY2U9PVwicG9pbnRlclwifHx0aGlzLm9wdGlvbnMuZm9yY2VQb2ludGVyRm9yQ29udGFpbmVyc3x8XG50aGlzLm9wdGlvbnMudG9sZXJhbmNlIT1cInBvaW50ZXJcIiYmdGhpcy5oZWxwZXJQcm9wb3J0aW9uc1t0aGlzLmZsb2F0aW5nP1wid2lkdGhcIjpcImhlaWdodFwiXT5hW3RoaXMuZmxvYXRpbmc/XCJ3aWR0aFwiOlwiaGVpZ2h0XCJdP2o6ZzxiK3RoaXMuaGVscGVyUHJvcG9ydGlvbnMud2lkdGgvMiYmYy10aGlzLmhlbHBlclByb3BvcnRpb25zLndpZHRoLzI8aCYmaTxlK3RoaXMuaGVscGVyUHJvcG9ydGlvbnMuaGVpZ2h0LzImJmYtdGhpcy5oZWxwZXJQcm9wb3J0aW9ucy5oZWlnaHQvMjxrfSxfaW50ZXJzZWN0c1dpdGhQb2ludGVyOmZ1bmN0aW9uKGEpe3ZhciBiPWQudWkuaXNPdmVyQXhpcyh0aGlzLnBvc2l0aW9uQWJzLnRvcCt0aGlzLm9mZnNldC5jbGljay50b3AsYS50b3AsYS5oZWlnaHQpO2E9ZC51aS5pc092ZXJBeGlzKHRoaXMucG9zaXRpb25BYnMubGVmdCt0aGlzLm9mZnNldC5jbGljay5sZWZ0LGEubGVmdCxhLndpZHRoKTtiPWImJmE7YT10aGlzLl9nZXREcmFnVmVydGljYWxEaXJlY3Rpb24oKTtcbnZhciBjPXRoaXMuX2dldERyYWdIb3Jpem9udGFsRGlyZWN0aW9uKCk7aWYoIWIpcmV0dXJuIGZhbHNlO3JldHVybiB0aGlzLmZsb2F0aW5nP2MmJmM9PVwicmlnaHRcInx8YT09XCJkb3duXCI/MjoxOmEmJihhPT1cImRvd25cIj8yOjEpfSxfaW50ZXJzZWN0c1dpdGhTaWRlczpmdW5jdGlvbihhKXt2YXIgYj1kLnVpLmlzT3ZlckF4aXModGhpcy5wb3NpdGlvbkFicy50b3ArdGhpcy5vZmZzZXQuY2xpY2sudG9wLGEudG9wK2EuaGVpZ2h0LzIsYS5oZWlnaHQpO2E9ZC51aS5pc092ZXJBeGlzKHRoaXMucG9zaXRpb25BYnMubGVmdCt0aGlzLm9mZnNldC5jbGljay5sZWZ0LGEubGVmdCthLndpZHRoLzIsYS53aWR0aCk7dmFyIGM9dGhpcy5fZ2V0RHJhZ1ZlcnRpY2FsRGlyZWN0aW9uKCksZT10aGlzLl9nZXREcmFnSG9yaXpvbnRhbERpcmVjdGlvbigpO3JldHVybiB0aGlzLmZsb2F0aW5nJiZlP2U9PVwicmlnaHRcIiYmYXx8ZT09XCJsZWZ0XCImJiFhOmMmJihjPT1cImRvd25cIiYmYnx8Yz09XCJ1cFwiJiYhYil9LFxuX2dldERyYWdWZXJ0aWNhbERpcmVjdGlvbjpmdW5jdGlvbigpe3ZhciBhPXRoaXMucG9zaXRpb25BYnMudG9wLXRoaXMubGFzdFBvc2l0aW9uQWJzLnRvcDtyZXR1cm4gYSE9MCYmKGE+MD9cImRvd25cIjpcInVwXCIpfSxfZ2V0RHJhZ0hvcml6b250YWxEaXJlY3Rpb246ZnVuY3Rpb24oKXt2YXIgYT10aGlzLnBvc2l0aW9uQWJzLmxlZnQtdGhpcy5sYXN0UG9zaXRpb25BYnMubGVmdDtyZXR1cm4gYSE9MCYmKGE+MD9cInJpZ2h0XCI6XCJsZWZ0XCIpfSxyZWZyZXNoOmZ1bmN0aW9uKGEpe3RoaXMuX3JlZnJlc2hJdGVtcyhhKTt0aGlzLnJlZnJlc2hQb3NpdGlvbnMoKTtyZXR1cm4gdGhpc30sX2Nvbm5lY3RXaXRoOmZ1bmN0aW9uKCl7dmFyIGE9dGhpcy5vcHRpb25zO3JldHVybiBhLmNvbm5lY3RXaXRoLmNvbnN0cnVjdG9yPT1TdHJpbmc/W2EuY29ubmVjdFdpdGhdOmEuY29ubmVjdFdpdGh9LF9nZXRJdGVtc0FzalF1ZXJ5OmZ1bmN0aW9uKGEpe3ZhciBiPVtdLGM9W10sZT10aGlzLl9jb25uZWN0V2l0aCgpO1xuaWYoZSYmYSlmb3IoYT1lLmxlbmd0aC0xO2E+PTA7YS0tKWZvcih2YXIgZj1kKGVbYV0pLGc9Zi5sZW5ndGgtMTtnPj0wO2ctLSl7dmFyIGg9ZC5kYXRhKGZbZ10sXCJzb3J0YWJsZVwiKTtpZihoJiZoIT10aGlzJiYhaC5vcHRpb25zLmRpc2FibGVkKWMucHVzaChbZC5pc0Z1bmN0aW9uKGgub3B0aW9ucy5pdGVtcyk/aC5vcHRpb25zLml0ZW1zLmNhbGwoaC5lbGVtZW50KTpkKGgub3B0aW9ucy5pdGVtcyxoLmVsZW1lbnQpLm5vdChcIi51aS1zb3J0YWJsZS1oZWxwZXJcIikubm90KFwiLnVpLXNvcnRhYmxlLXBsYWNlaG9sZGVyXCIpLGhdKX1jLnB1c2goW2QuaXNGdW5jdGlvbih0aGlzLm9wdGlvbnMuaXRlbXMpP3RoaXMub3B0aW9ucy5pdGVtcy5jYWxsKHRoaXMuZWxlbWVudCxudWxsLHtvcHRpb25zOnRoaXMub3B0aW9ucyxpdGVtOnRoaXMuY3VycmVudEl0ZW19KTpkKHRoaXMub3B0aW9ucy5pdGVtcyx0aGlzLmVsZW1lbnQpLm5vdChcIi51aS1zb3J0YWJsZS1oZWxwZXJcIikubm90KFwiLnVpLXNvcnRhYmxlLXBsYWNlaG9sZGVyXCIpLFxudGhpc10pO2ZvcihhPWMubGVuZ3RoLTE7YT49MDthLS0pY1thXVswXS5lYWNoKGZ1bmN0aW9uKCl7Yi5wdXNoKHRoaXMpfSk7cmV0dXJuIGQoYil9LF9yZW1vdmVDdXJyZW50c0Zyb21JdGVtczpmdW5jdGlvbigpe2Zvcih2YXIgYT10aGlzLmN1cnJlbnRJdGVtLmZpbmQoXCI6ZGF0YShzb3J0YWJsZS1pdGVtKVwiKSxiPTA7Yjx0aGlzLml0ZW1zLmxlbmd0aDtiKyspZm9yKHZhciBjPTA7YzxhLmxlbmd0aDtjKyspYVtjXT09dGhpcy5pdGVtc1tiXS5pdGVtWzBdJiZ0aGlzLml0ZW1zLnNwbGljZShiLDEpfSxfcmVmcmVzaEl0ZW1zOmZ1bmN0aW9uKGEpe3RoaXMuaXRlbXM9W107dGhpcy5jb250YWluZXJzPVt0aGlzXTt2YXIgYj10aGlzLml0ZW1zLGM9W1tkLmlzRnVuY3Rpb24odGhpcy5vcHRpb25zLml0ZW1zKT90aGlzLm9wdGlvbnMuaXRlbXMuY2FsbCh0aGlzLmVsZW1lbnRbMF0sYSx7aXRlbTp0aGlzLmN1cnJlbnRJdGVtfSk6ZCh0aGlzLm9wdGlvbnMuaXRlbXMsdGhpcy5lbGVtZW50KSxcbnRoaXNdXSxlPXRoaXMuX2Nvbm5lY3RXaXRoKCk7aWYoZSlmb3IodmFyIGY9ZS5sZW5ndGgtMTtmPj0wO2YtLSlmb3IodmFyIGc9ZChlW2ZdKSxoPWcubGVuZ3RoLTE7aD49MDtoLS0pe3ZhciBpPWQuZGF0YShnW2hdLFwic29ydGFibGVcIik7aWYoaSYmaSE9dGhpcyYmIWkub3B0aW9ucy5kaXNhYmxlZCl7Yy5wdXNoKFtkLmlzRnVuY3Rpb24oaS5vcHRpb25zLml0ZW1zKT9pLm9wdGlvbnMuaXRlbXMuY2FsbChpLmVsZW1lbnRbMF0sYSx7aXRlbTp0aGlzLmN1cnJlbnRJdGVtfSk6ZChpLm9wdGlvbnMuaXRlbXMsaS5lbGVtZW50KSxpXSk7dGhpcy5jb250YWluZXJzLnB1c2goaSl9fWZvcihmPWMubGVuZ3RoLTE7Zj49MDtmLS0pe2E9Y1tmXVsxXTtlPWNbZl1bMF07aD0wO2ZvcihnPWUubGVuZ3RoO2g8ZztoKyspe2k9ZChlW2hdKTtpLmRhdGEoXCJzb3J0YWJsZS1pdGVtXCIsYSk7Yi5wdXNoKHtpdGVtOmksaW5zdGFuY2U6YSx3aWR0aDowLGhlaWdodDowLGxlZnQ6MCx0b3A6MH0pfX19LHJlZnJlc2hQb3NpdGlvbnM6ZnVuY3Rpb24oYSl7aWYodGhpcy5vZmZzZXRQYXJlbnQmJlxudGhpcy5oZWxwZXIpdGhpcy5vZmZzZXQucGFyZW50PXRoaXMuX2dldFBhcmVudE9mZnNldCgpO2Zvcih2YXIgYj10aGlzLml0ZW1zLmxlbmd0aC0xO2I+PTA7Yi0tKXt2YXIgYz10aGlzLml0ZW1zW2JdO2lmKCEoYy5pbnN0YW5jZSE9dGhpcy5jdXJyZW50Q29udGFpbmVyJiZ0aGlzLmN1cnJlbnRDb250YWluZXImJmMuaXRlbVswXSE9dGhpcy5jdXJyZW50SXRlbVswXSkpe3ZhciBlPXRoaXMub3B0aW9ucy50b2xlcmFuY2VFbGVtZW50P2QodGhpcy5vcHRpb25zLnRvbGVyYW5jZUVsZW1lbnQsYy5pdGVtKTpjLml0ZW07aWYoIWEpe2Mud2lkdGg9ZS5vdXRlcldpZHRoKCk7Yy5oZWlnaHQ9ZS5vdXRlckhlaWdodCgpfWU9ZS5vZmZzZXQoKTtjLmxlZnQ9ZS5sZWZ0O2MudG9wPWUudG9wfX1pZih0aGlzLm9wdGlvbnMuY3VzdG9tJiZ0aGlzLm9wdGlvbnMuY3VzdG9tLnJlZnJlc2hDb250YWluZXJzKXRoaXMub3B0aW9ucy5jdXN0b20ucmVmcmVzaENvbnRhaW5lcnMuY2FsbCh0aGlzKTtlbHNlIGZvcihiPVxudGhpcy5jb250YWluZXJzLmxlbmd0aC0xO2I+PTA7Yi0tKXtlPXRoaXMuY29udGFpbmVyc1tiXS5lbGVtZW50Lm9mZnNldCgpO3RoaXMuY29udGFpbmVyc1tiXS5jb250YWluZXJDYWNoZS5sZWZ0PWUubGVmdDt0aGlzLmNvbnRhaW5lcnNbYl0uY29udGFpbmVyQ2FjaGUudG9wPWUudG9wO3RoaXMuY29udGFpbmVyc1tiXS5jb250YWluZXJDYWNoZS53aWR0aD10aGlzLmNvbnRhaW5lcnNbYl0uZWxlbWVudC5vdXRlcldpZHRoKCk7dGhpcy5jb250YWluZXJzW2JdLmNvbnRhaW5lckNhY2hlLmhlaWdodD10aGlzLmNvbnRhaW5lcnNbYl0uZWxlbWVudC5vdXRlckhlaWdodCgpfXJldHVybiB0aGlzfSxfY3JlYXRlUGxhY2Vob2xkZXI6ZnVuY3Rpb24oYSl7dmFyIGI9YXx8dGhpcyxjPWIub3B0aW9ucztpZighYy5wbGFjZWhvbGRlcnx8Yy5wbGFjZWhvbGRlci5jb25zdHJ1Y3Rvcj09U3RyaW5nKXt2YXIgZT1jLnBsYWNlaG9sZGVyO2MucGxhY2Vob2xkZXI9e2VsZW1lbnQ6ZnVuY3Rpb24oKXt2YXIgZj1cbmQoZG9jdW1lbnQuY3JlYXRlRWxlbWVudChiLmN1cnJlbnRJdGVtWzBdLm5vZGVOYW1lKSkuYWRkQ2xhc3MoZXx8Yi5jdXJyZW50SXRlbVswXS5jbGFzc05hbWUrXCIgdWktc29ydGFibGUtcGxhY2Vob2xkZXJcIikucmVtb3ZlQ2xhc3MoXCJ1aS1zb3J0YWJsZS1oZWxwZXJcIilbMF07aWYoIWUpZi5zdHlsZS52aXNpYmlsaXR5PVwiaGlkZGVuXCI7cmV0dXJuIGZ9LHVwZGF0ZTpmdW5jdGlvbihmLGcpe2lmKCEoZSYmIWMuZm9yY2VQbGFjZWhvbGRlclNpemUpKXtnLmhlaWdodCgpfHxnLmhlaWdodChiLmN1cnJlbnRJdGVtLmlubmVySGVpZ2h0KCktcGFyc2VJbnQoYi5jdXJyZW50SXRlbS5jc3MoXCJwYWRkaW5nVG9wXCIpfHwwLDEwKS1wYXJzZUludChiLmN1cnJlbnRJdGVtLmNzcyhcInBhZGRpbmdCb3R0b21cIil8fDAsMTApKTtnLndpZHRoKCl8fGcud2lkdGgoYi5jdXJyZW50SXRlbS5pbm5lcldpZHRoKCktcGFyc2VJbnQoYi5jdXJyZW50SXRlbS5jc3MoXCJwYWRkaW5nTGVmdFwiKXx8MCwxMCktcGFyc2VJbnQoYi5jdXJyZW50SXRlbS5jc3MoXCJwYWRkaW5nUmlnaHRcIil8fFxuMCwxMCkpfX19fWIucGxhY2Vob2xkZXI9ZChjLnBsYWNlaG9sZGVyLmVsZW1lbnQuY2FsbChiLmVsZW1lbnQsYi5jdXJyZW50SXRlbSkpO2IuY3VycmVudEl0ZW0uYWZ0ZXIoYi5wbGFjZWhvbGRlcik7Yy5wbGFjZWhvbGRlci51cGRhdGUoYixiLnBsYWNlaG9sZGVyKX0sX2NvbnRhY3RDb250YWluZXJzOmZ1bmN0aW9uKGEpe2Zvcih2YXIgYj1udWxsLGM9bnVsbCxlPXRoaXMuY29udGFpbmVycy5sZW5ndGgtMTtlPj0wO2UtLSlpZighZC51aS5jb250YWlucyh0aGlzLmN1cnJlbnRJdGVtWzBdLHRoaXMuY29udGFpbmVyc1tlXS5lbGVtZW50WzBdKSlpZih0aGlzLl9pbnRlcnNlY3RzV2l0aCh0aGlzLmNvbnRhaW5lcnNbZV0uY29udGFpbmVyQ2FjaGUpKXtpZighKGImJmQudWkuY29udGFpbnModGhpcy5jb250YWluZXJzW2VdLmVsZW1lbnRbMF0sYi5lbGVtZW50WzBdKSkpe2I9dGhpcy5jb250YWluZXJzW2VdO2M9ZX19ZWxzZSBpZih0aGlzLmNvbnRhaW5lcnNbZV0uY29udGFpbmVyQ2FjaGUub3Zlcil7dGhpcy5jb250YWluZXJzW2VdLl90cmlnZ2VyKFwib3V0XCIsXG5hLHRoaXMuX3VpSGFzaCh0aGlzKSk7dGhpcy5jb250YWluZXJzW2VdLmNvbnRhaW5lckNhY2hlLm92ZXI9MH1pZihiKWlmKHRoaXMuY29udGFpbmVycy5sZW5ndGg9PT0xKXt0aGlzLmNvbnRhaW5lcnNbY10uX3RyaWdnZXIoXCJvdmVyXCIsYSx0aGlzLl91aUhhc2godGhpcykpO3RoaXMuY29udGFpbmVyc1tjXS5jb250YWluZXJDYWNoZS5vdmVyPTF9ZWxzZSBpZih0aGlzLmN1cnJlbnRDb250YWluZXIhPXRoaXMuY29udGFpbmVyc1tjXSl7Yj0xRTQ7ZT1udWxsO2Zvcih2YXIgZj10aGlzLnBvc2l0aW9uQWJzW3RoaXMuY29udGFpbmVyc1tjXS5mbG9hdGluZz9cImxlZnRcIjpcInRvcFwiXSxnPXRoaXMuaXRlbXMubGVuZ3RoLTE7Zz49MDtnLS0paWYoZC51aS5jb250YWlucyh0aGlzLmNvbnRhaW5lcnNbY10uZWxlbWVudFswXSx0aGlzLml0ZW1zW2ddLml0ZW1bMF0pKXt2YXIgaD10aGlzLml0ZW1zW2ddW3RoaXMuY29udGFpbmVyc1tjXS5mbG9hdGluZz9cImxlZnRcIjpcInRvcFwiXTtpZihNYXRoLmFicyhoLVxuZik8Yil7Yj1NYXRoLmFicyhoLWYpO2U9dGhpcy5pdGVtc1tnXX19aWYoZXx8dGhpcy5vcHRpb25zLmRyb3BPbkVtcHR5KXt0aGlzLmN1cnJlbnRDb250YWluZXI9dGhpcy5jb250YWluZXJzW2NdO2U/dGhpcy5fcmVhcnJhbmdlKGEsZSxudWxsLHRydWUpOnRoaXMuX3JlYXJyYW5nZShhLG51bGwsdGhpcy5jb250YWluZXJzW2NdLmVsZW1lbnQsdHJ1ZSk7dGhpcy5fdHJpZ2dlcihcImNoYW5nZVwiLGEsdGhpcy5fdWlIYXNoKCkpO3RoaXMuY29udGFpbmVyc1tjXS5fdHJpZ2dlcihcImNoYW5nZVwiLGEsdGhpcy5fdWlIYXNoKHRoaXMpKTt0aGlzLm9wdGlvbnMucGxhY2Vob2xkZXIudXBkYXRlKHRoaXMuY3VycmVudENvbnRhaW5lcix0aGlzLnBsYWNlaG9sZGVyKTt0aGlzLmNvbnRhaW5lcnNbY10uX3RyaWdnZXIoXCJvdmVyXCIsYSx0aGlzLl91aUhhc2godGhpcykpO3RoaXMuY29udGFpbmVyc1tjXS5jb250YWluZXJDYWNoZS5vdmVyPTF9fX0sX2NyZWF0ZUhlbHBlcjpmdW5jdGlvbihhKXt2YXIgYj1cbnRoaXMub3B0aW9uczthPWQuaXNGdW5jdGlvbihiLmhlbHBlcik/ZChiLmhlbHBlci5hcHBseSh0aGlzLmVsZW1lbnRbMF0sW2EsdGhpcy5jdXJyZW50SXRlbV0pKTpiLmhlbHBlcj09XCJjbG9uZVwiP3RoaXMuY3VycmVudEl0ZW0uY2xvbmUoKTp0aGlzLmN1cnJlbnRJdGVtO2EucGFyZW50cyhcImJvZHlcIikubGVuZ3RofHxkKGIuYXBwZW5kVG8hPVwicGFyZW50XCI/Yi5hcHBlbmRUbzp0aGlzLmN1cnJlbnRJdGVtWzBdLnBhcmVudE5vZGUpWzBdLmFwcGVuZENoaWxkKGFbMF0pO2lmKGFbMF09PXRoaXMuY3VycmVudEl0ZW1bMF0pdGhpcy5fc3RvcmVkQ1NTPXt3aWR0aDp0aGlzLmN1cnJlbnRJdGVtWzBdLnN0eWxlLndpZHRoLGhlaWdodDp0aGlzLmN1cnJlbnRJdGVtWzBdLnN0eWxlLmhlaWdodCxwb3NpdGlvbjp0aGlzLmN1cnJlbnRJdGVtLmNzcyhcInBvc2l0aW9uXCIpLHRvcDp0aGlzLmN1cnJlbnRJdGVtLmNzcyhcInRvcFwiKSxsZWZ0OnRoaXMuY3VycmVudEl0ZW0uY3NzKFwibGVmdFwiKX07aWYoYVswXS5zdHlsZS53aWR0aD09XG5cIlwifHxiLmZvcmNlSGVscGVyU2l6ZSlhLndpZHRoKHRoaXMuY3VycmVudEl0ZW0ud2lkdGgoKSk7aWYoYVswXS5zdHlsZS5oZWlnaHQ9PVwiXCJ8fGIuZm9yY2VIZWxwZXJTaXplKWEuaGVpZ2h0KHRoaXMuY3VycmVudEl0ZW0uaGVpZ2h0KCkpO3JldHVybiBhfSxfYWRqdXN0T2Zmc2V0RnJvbUhlbHBlcjpmdW5jdGlvbihhKXtpZih0eXBlb2YgYT09XCJzdHJpbmdcIilhPWEuc3BsaXQoXCIgXCIpO2lmKGQuaXNBcnJheShhKSlhPXtsZWZ0OithWzBdLHRvcDorYVsxXXx8MH07aWYoXCJsZWZ0XCJpbiBhKXRoaXMub2Zmc2V0LmNsaWNrLmxlZnQ9YS5sZWZ0K3RoaXMubWFyZ2lucy5sZWZ0O2lmKFwicmlnaHRcImluIGEpdGhpcy5vZmZzZXQuY2xpY2subGVmdD10aGlzLmhlbHBlclByb3BvcnRpb25zLndpZHRoLWEucmlnaHQrdGhpcy5tYXJnaW5zLmxlZnQ7aWYoXCJ0b3BcImluIGEpdGhpcy5vZmZzZXQuY2xpY2sudG9wPWEudG9wK3RoaXMubWFyZ2lucy50b3A7aWYoXCJib3R0b21cImluIGEpdGhpcy5vZmZzZXQuY2xpY2sudG9wPVxudGhpcy5oZWxwZXJQcm9wb3J0aW9ucy5oZWlnaHQtYS5ib3R0b20rdGhpcy5tYXJnaW5zLnRvcH0sX2dldFBhcmVudE9mZnNldDpmdW5jdGlvbigpe3RoaXMub2Zmc2V0UGFyZW50PXRoaXMuaGVscGVyLm9mZnNldFBhcmVudCgpO3ZhciBhPXRoaXMub2Zmc2V0UGFyZW50Lm9mZnNldCgpO2lmKHRoaXMuY3NzUG9zaXRpb249PVwiYWJzb2x1dGVcIiYmdGhpcy5zY3JvbGxQYXJlbnRbMF0hPWRvY3VtZW50JiZkLnVpLmNvbnRhaW5zKHRoaXMuc2Nyb2xsUGFyZW50WzBdLHRoaXMub2Zmc2V0UGFyZW50WzBdKSl7YS5sZWZ0Kz10aGlzLnNjcm9sbFBhcmVudC5zY3JvbGxMZWZ0KCk7YS50b3ArPXRoaXMuc2Nyb2xsUGFyZW50LnNjcm9sbFRvcCgpfWlmKHRoaXMub2Zmc2V0UGFyZW50WzBdPT1kb2N1bWVudC5ib2R5fHx0aGlzLm9mZnNldFBhcmVudFswXS50YWdOYW1lJiZ0aGlzLm9mZnNldFBhcmVudFswXS50YWdOYW1lLnRvTG93ZXJDYXNlKCk9PVwiaHRtbFwiJiZkLmJyb3dzZXIubXNpZSlhPVxue3RvcDowLGxlZnQ6MH07cmV0dXJue3RvcDphLnRvcCsocGFyc2VJbnQodGhpcy5vZmZzZXRQYXJlbnQuY3NzKFwiYm9yZGVyVG9wV2lkdGhcIiksMTApfHwwKSxsZWZ0OmEubGVmdCsocGFyc2VJbnQodGhpcy5vZmZzZXRQYXJlbnQuY3NzKFwiYm9yZGVyTGVmdFdpZHRoXCIpLDEwKXx8MCl9fSxfZ2V0UmVsYXRpdmVPZmZzZXQ6ZnVuY3Rpb24oKXtpZih0aGlzLmNzc1Bvc2l0aW9uPT1cInJlbGF0aXZlXCIpe3ZhciBhPXRoaXMuY3VycmVudEl0ZW0ucG9zaXRpb24oKTtyZXR1cm57dG9wOmEudG9wLShwYXJzZUludCh0aGlzLmhlbHBlci5jc3MoXCJ0b3BcIiksMTApfHwwKSt0aGlzLnNjcm9sbFBhcmVudC5zY3JvbGxUb3AoKSxsZWZ0OmEubGVmdC0ocGFyc2VJbnQodGhpcy5oZWxwZXIuY3NzKFwibGVmdFwiKSwxMCl8fDApK3RoaXMuc2Nyb2xsUGFyZW50LnNjcm9sbExlZnQoKX19ZWxzZSByZXR1cm57dG9wOjAsbGVmdDowfX0sX2NhY2hlTWFyZ2luczpmdW5jdGlvbigpe3RoaXMubWFyZ2lucz17bGVmdDpwYXJzZUludCh0aGlzLmN1cnJlbnRJdGVtLmNzcyhcIm1hcmdpbkxlZnRcIiksXG4xMCl8fDAsdG9wOnBhcnNlSW50KHRoaXMuY3VycmVudEl0ZW0uY3NzKFwibWFyZ2luVG9wXCIpLDEwKXx8MH19LF9jYWNoZUhlbHBlclByb3BvcnRpb25zOmZ1bmN0aW9uKCl7dGhpcy5oZWxwZXJQcm9wb3J0aW9ucz17d2lkdGg6dGhpcy5oZWxwZXIub3V0ZXJXaWR0aCgpLGhlaWdodDp0aGlzLmhlbHBlci5vdXRlckhlaWdodCgpfX0sX3NldENvbnRhaW5tZW50OmZ1bmN0aW9uKCl7dmFyIGE9dGhpcy5vcHRpb25zO2lmKGEuY29udGFpbm1lbnQ9PVwicGFyZW50XCIpYS5jb250YWlubWVudD10aGlzLmhlbHBlclswXS5wYXJlbnROb2RlO2lmKGEuY29udGFpbm1lbnQ9PVwiZG9jdW1lbnRcInx8YS5jb250YWlubWVudD09XCJ3aW5kb3dcIil0aGlzLmNvbnRhaW5tZW50PVswLXRoaXMub2Zmc2V0LnJlbGF0aXZlLmxlZnQtdGhpcy5vZmZzZXQucGFyZW50LmxlZnQsMC10aGlzLm9mZnNldC5yZWxhdGl2ZS50b3AtdGhpcy5vZmZzZXQucGFyZW50LnRvcCxkKGEuY29udGFpbm1lbnQ9PVwiZG9jdW1lbnRcIj9cbmRvY3VtZW50OndpbmRvdykud2lkdGgoKS10aGlzLmhlbHBlclByb3BvcnRpb25zLndpZHRoLXRoaXMubWFyZ2lucy5sZWZ0LChkKGEuY29udGFpbm1lbnQ9PVwiZG9jdW1lbnRcIj9kb2N1bWVudDp3aW5kb3cpLmhlaWdodCgpfHxkb2N1bWVudC5ib2R5LnBhcmVudE5vZGUuc2Nyb2xsSGVpZ2h0KS10aGlzLmhlbHBlclByb3BvcnRpb25zLmhlaWdodC10aGlzLm1hcmdpbnMudG9wXTtpZighL14oZG9jdW1lbnR8d2luZG93fHBhcmVudCkkLy50ZXN0KGEuY29udGFpbm1lbnQpKXt2YXIgYj1kKGEuY29udGFpbm1lbnQpWzBdO2E9ZChhLmNvbnRhaW5tZW50KS5vZmZzZXQoKTt2YXIgYz1kKGIpLmNzcyhcIm92ZXJmbG93XCIpIT1cImhpZGRlblwiO3RoaXMuY29udGFpbm1lbnQ9W2EubGVmdCsocGFyc2VJbnQoZChiKS5jc3MoXCJib3JkZXJMZWZ0V2lkdGhcIiksMTApfHwwKSsocGFyc2VJbnQoZChiKS5jc3MoXCJwYWRkaW5nTGVmdFwiKSwxMCl8fDApLXRoaXMubWFyZ2lucy5sZWZ0LGEudG9wKyhwYXJzZUludChkKGIpLmNzcyhcImJvcmRlclRvcFdpZHRoXCIpLFxuMTApfHwwKSsocGFyc2VJbnQoZChiKS5jc3MoXCJwYWRkaW5nVG9wXCIpLDEwKXx8MCktdGhpcy5tYXJnaW5zLnRvcCxhLmxlZnQrKGM/TWF0aC5tYXgoYi5zY3JvbGxXaWR0aCxiLm9mZnNldFdpZHRoKTpiLm9mZnNldFdpZHRoKS0ocGFyc2VJbnQoZChiKS5jc3MoXCJib3JkZXJMZWZ0V2lkdGhcIiksMTApfHwwKS0ocGFyc2VJbnQoZChiKS5jc3MoXCJwYWRkaW5nUmlnaHRcIiksMTApfHwwKS10aGlzLmhlbHBlclByb3BvcnRpb25zLndpZHRoLXRoaXMubWFyZ2lucy5sZWZ0LGEudG9wKyhjP01hdGgubWF4KGIuc2Nyb2xsSGVpZ2h0LGIub2Zmc2V0SGVpZ2h0KTpiLm9mZnNldEhlaWdodCktKHBhcnNlSW50KGQoYikuY3NzKFwiYm9yZGVyVG9wV2lkdGhcIiksMTApfHwwKS0ocGFyc2VJbnQoZChiKS5jc3MoXCJwYWRkaW5nQm90dG9tXCIpLDEwKXx8MCktdGhpcy5oZWxwZXJQcm9wb3J0aW9ucy5oZWlnaHQtdGhpcy5tYXJnaW5zLnRvcF19fSxfY29udmVydFBvc2l0aW9uVG86ZnVuY3Rpb24oYSxiKXtpZighYiliPVxudGhpcy5wb3NpdGlvbjthPWE9PVwiYWJzb2x1dGVcIj8xOi0xO3ZhciBjPXRoaXMuY3NzUG9zaXRpb249PVwiYWJzb2x1dGVcIiYmISh0aGlzLnNjcm9sbFBhcmVudFswXSE9ZG9jdW1lbnQmJmQudWkuY29udGFpbnModGhpcy5zY3JvbGxQYXJlbnRbMF0sdGhpcy5vZmZzZXRQYXJlbnRbMF0pKT90aGlzLm9mZnNldFBhcmVudDp0aGlzLnNjcm9sbFBhcmVudCxlPS8oaHRtbHxib2R5KS9pLnRlc3QoY1swXS50YWdOYW1lKTtyZXR1cm57dG9wOmIudG9wK3RoaXMub2Zmc2V0LnJlbGF0aXZlLnRvcCphK3RoaXMub2Zmc2V0LnBhcmVudC50b3AqYS0oZC5icm93c2VyLnNhZmFyaSYmdGhpcy5jc3NQb3NpdGlvbj09XCJmaXhlZFwiPzA6KHRoaXMuY3NzUG9zaXRpb249PVwiZml4ZWRcIj8tdGhpcy5zY3JvbGxQYXJlbnQuc2Nyb2xsVG9wKCk6ZT8wOmMuc2Nyb2xsVG9wKCkpKmEpLGxlZnQ6Yi5sZWZ0K3RoaXMub2Zmc2V0LnJlbGF0aXZlLmxlZnQqYSt0aGlzLm9mZnNldC5wYXJlbnQubGVmdCphLShkLmJyb3dzZXIuc2FmYXJpJiZcbnRoaXMuY3NzUG9zaXRpb249PVwiZml4ZWRcIj8wOih0aGlzLmNzc1Bvc2l0aW9uPT1cImZpeGVkXCI/LXRoaXMuc2Nyb2xsUGFyZW50LnNjcm9sbExlZnQoKTplPzA6Yy5zY3JvbGxMZWZ0KCkpKmEpfX0sX2dlbmVyYXRlUG9zaXRpb246ZnVuY3Rpb24oYSl7dmFyIGI9dGhpcy5vcHRpb25zLGM9dGhpcy5jc3NQb3NpdGlvbj09XCJhYnNvbHV0ZVwiJiYhKHRoaXMuc2Nyb2xsUGFyZW50WzBdIT1kb2N1bWVudCYmZC51aS5jb250YWlucyh0aGlzLnNjcm9sbFBhcmVudFswXSx0aGlzLm9mZnNldFBhcmVudFswXSkpP3RoaXMub2Zmc2V0UGFyZW50OnRoaXMuc2Nyb2xsUGFyZW50LGU9LyhodG1sfGJvZHkpL2kudGVzdChjWzBdLnRhZ05hbWUpO2lmKHRoaXMuY3NzUG9zaXRpb249PVwicmVsYXRpdmVcIiYmISh0aGlzLnNjcm9sbFBhcmVudFswXSE9ZG9jdW1lbnQmJnRoaXMuc2Nyb2xsUGFyZW50WzBdIT10aGlzLm9mZnNldFBhcmVudFswXSkpdGhpcy5vZmZzZXQucmVsYXRpdmU9dGhpcy5fZ2V0UmVsYXRpdmVPZmZzZXQoKTtcbnZhciBmPWEucGFnZVgsZz1hLnBhZ2VZO2lmKHRoaXMub3JpZ2luYWxQb3NpdGlvbil7aWYodGhpcy5jb250YWlubWVudCl7aWYoYS5wYWdlWC10aGlzLm9mZnNldC5jbGljay5sZWZ0PHRoaXMuY29udGFpbm1lbnRbMF0pZj10aGlzLmNvbnRhaW5tZW50WzBdK3RoaXMub2Zmc2V0LmNsaWNrLmxlZnQ7aWYoYS5wYWdlWS10aGlzLm9mZnNldC5jbGljay50b3A8dGhpcy5jb250YWlubWVudFsxXSlnPXRoaXMuY29udGFpbm1lbnRbMV0rdGhpcy5vZmZzZXQuY2xpY2sudG9wO2lmKGEucGFnZVgtdGhpcy5vZmZzZXQuY2xpY2subGVmdD50aGlzLmNvbnRhaW5tZW50WzJdKWY9dGhpcy5jb250YWlubWVudFsyXSt0aGlzLm9mZnNldC5jbGljay5sZWZ0O2lmKGEucGFnZVktdGhpcy5vZmZzZXQuY2xpY2sudG9wPnRoaXMuY29udGFpbm1lbnRbM10pZz10aGlzLmNvbnRhaW5tZW50WzNdK3RoaXMub2Zmc2V0LmNsaWNrLnRvcH1pZihiLmdyaWQpe2c9dGhpcy5vcmlnaW5hbFBhZ2VZK01hdGgucm91bmQoKGctXG50aGlzLm9yaWdpbmFsUGFnZVkpL2IuZ3JpZFsxXSkqYi5ncmlkWzFdO2c9dGhpcy5jb250YWlubWVudD8hKGctdGhpcy5vZmZzZXQuY2xpY2sudG9wPHRoaXMuY29udGFpbm1lbnRbMV18fGctdGhpcy5vZmZzZXQuY2xpY2sudG9wPnRoaXMuY29udGFpbm1lbnRbM10pP2c6IShnLXRoaXMub2Zmc2V0LmNsaWNrLnRvcDx0aGlzLmNvbnRhaW5tZW50WzFdKT9nLWIuZ3JpZFsxXTpnK2IuZ3JpZFsxXTpnO2Y9dGhpcy5vcmlnaW5hbFBhZ2VYK01hdGgucm91bmQoKGYtdGhpcy5vcmlnaW5hbFBhZ2VYKS9iLmdyaWRbMF0pKmIuZ3JpZFswXTtmPXRoaXMuY29udGFpbm1lbnQ/IShmLXRoaXMub2Zmc2V0LmNsaWNrLmxlZnQ8dGhpcy5jb250YWlubWVudFswXXx8Zi10aGlzLm9mZnNldC5jbGljay5sZWZ0PnRoaXMuY29udGFpbm1lbnRbMl0pP2Y6IShmLXRoaXMub2Zmc2V0LmNsaWNrLmxlZnQ8dGhpcy5jb250YWlubWVudFswXSk/Zi1iLmdyaWRbMF06ZitiLmdyaWRbMF06Zn19cmV0dXJue3RvcDpnLVxudGhpcy5vZmZzZXQuY2xpY2sudG9wLXRoaXMub2Zmc2V0LnJlbGF0aXZlLnRvcC10aGlzLm9mZnNldC5wYXJlbnQudG9wKyhkLmJyb3dzZXIuc2FmYXJpJiZ0aGlzLmNzc1Bvc2l0aW9uPT1cImZpeGVkXCI/MDp0aGlzLmNzc1Bvc2l0aW9uPT1cImZpeGVkXCI/LXRoaXMuc2Nyb2xsUGFyZW50LnNjcm9sbFRvcCgpOmU/MDpjLnNjcm9sbFRvcCgpKSxsZWZ0OmYtdGhpcy5vZmZzZXQuY2xpY2subGVmdC10aGlzLm9mZnNldC5yZWxhdGl2ZS5sZWZ0LXRoaXMub2Zmc2V0LnBhcmVudC5sZWZ0KyhkLmJyb3dzZXIuc2FmYXJpJiZ0aGlzLmNzc1Bvc2l0aW9uPT1cImZpeGVkXCI/MDp0aGlzLmNzc1Bvc2l0aW9uPT1cImZpeGVkXCI/LXRoaXMuc2Nyb2xsUGFyZW50LnNjcm9sbExlZnQoKTplPzA6Yy5zY3JvbGxMZWZ0KCkpfX0sX3JlYXJyYW5nZTpmdW5jdGlvbihhLGIsYyxlKXtjP2NbMF0uYXBwZW5kQ2hpbGQodGhpcy5wbGFjZWhvbGRlclswXSk6Yi5pdGVtWzBdLnBhcmVudE5vZGUuaW5zZXJ0QmVmb3JlKHRoaXMucGxhY2Vob2xkZXJbMF0sXG50aGlzLmRpcmVjdGlvbj09XCJkb3duXCI/Yi5pdGVtWzBdOmIuaXRlbVswXS5uZXh0U2libGluZyk7dGhpcy5jb3VudGVyPXRoaXMuY291bnRlcj8rK3RoaXMuY291bnRlcjoxO3ZhciBmPXRoaXMsZz10aGlzLmNvdW50ZXI7d2luZG93LnNldFRpbWVvdXQoZnVuY3Rpb24oKXtnPT1mLmNvdW50ZXImJmYucmVmcmVzaFBvc2l0aW9ucyghZSl9LDApfSxfY2xlYXI6ZnVuY3Rpb24oYSxiKXt0aGlzLnJldmVydGluZz1mYWxzZTt2YXIgYz1bXTshdGhpcy5fbm9GaW5hbFNvcnQmJnRoaXMuY3VycmVudEl0ZW0ucGFyZW50KCkubGVuZ3RoJiZ0aGlzLnBsYWNlaG9sZGVyLmJlZm9yZSh0aGlzLmN1cnJlbnRJdGVtKTt0aGlzLl9ub0ZpbmFsU29ydD1udWxsO2lmKHRoaXMuaGVscGVyWzBdPT10aGlzLmN1cnJlbnRJdGVtWzBdKXtmb3IodmFyIGUgaW4gdGhpcy5fc3RvcmVkQ1NTKWlmKHRoaXMuX3N0b3JlZENTU1tlXT09XCJhdXRvXCJ8fHRoaXMuX3N0b3JlZENTU1tlXT09XCJzdGF0aWNcIil0aGlzLl9zdG9yZWRDU1NbZV09XG5cIlwiO3RoaXMuY3VycmVudEl0ZW0uY3NzKHRoaXMuX3N0b3JlZENTUykucmVtb3ZlQ2xhc3MoXCJ1aS1zb3J0YWJsZS1oZWxwZXJcIil9ZWxzZSB0aGlzLmN1cnJlbnRJdGVtLnNob3coKTt0aGlzLmZyb21PdXRzaWRlJiYhYiYmYy5wdXNoKGZ1bmN0aW9uKGYpe3RoaXMuX3RyaWdnZXIoXCJyZWNlaXZlXCIsZix0aGlzLl91aUhhc2godGhpcy5mcm9tT3V0c2lkZSkpfSk7aWYoKHRoaXMuZnJvbU91dHNpZGV8fHRoaXMuZG9tUG9zaXRpb24ucHJldiE9dGhpcy5jdXJyZW50SXRlbS5wcmV2KCkubm90KFwiLnVpLXNvcnRhYmxlLWhlbHBlclwiKVswXXx8dGhpcy5kb21Qb3NpdGlvbi5wYXJlbnQhPXRoaXMuY3VycmVudEl0ZW0ucGFyZW50KClbMF0pJiYhYiljLnB1c2goZnVuY3Rpb24oZil7dGhpcy5fdHJpZ2dlcihcInVwZGF0ZVwiLGYsdGhpcy5fdWlIYXNoKCkpfSk7aWYoIWQudWkuY29udGFpbnModGhpcy5lbGVtZW50WzBdLHRoaXMuY3VycmVudEl0ZW1bMF0pKXtifHxjLnB1c2goZnVuY3Rpb24oZil7dGhpcy5fdHJpZ2dlcihcInJlbW92ZVwiLFxuZix0aGlzLl91aUhhc2goKSl9KTtmb3IoZT10aGlzLmNvbnRhaW5lcnMubGVuZ3RoLTE7ZT49MDtlLS0paWYoZC51aS5jb250YWlucyh0aGlzLmNvbnRhaW5lcnNbZV0uZWxlbWVudFswXSx0aGlzLmN1cnJlbnRJdGVtWzBdKSYmIWIpe2MucHVzaChmdW5jdGlvbihmKXtyZXR1cm4gZnVuY3Rpb24oZyl7Zi5fdHJpZ2dlcihcInJlY2VpdmVcIixnLHRoaXMuX3VpSGFzaCh0aGlzKSl9fS5jYWxsKHRoaXMsdGhpcy5jb250YWluZXJzW2VdKSk7Yy5wdXNoKGZ1bmN0aW9uKGYpe3JldHVybiBmdW5jdGlvbihnKXtmLl90cmlnZ2VyKFwidXBkYXRlXCIsZyx0aGlzLl91aUhhc2godGhpcykpfX0uY2FsbCh0aGlzLHRoaXMuY29udGFpbmVyc1tlXSkpfX1mb3IoZT10aGlzLmNvbnRhaW5lcnMubGVuZ3RoLTE7ZT49MDtlLS0pe2J8fGMucHVzaChmdW5jdGlvbihmKXtyZXR1cm4gZnVuY3Rpb24oZyl7Zi5fdHJpZ2dlcihcImRlYWN0aXZhdGVcIixnLHRoaXMuX3VpSGFzaCh0aGlzKSl9fS5jYWxsKHRoaXMsXG50aGlzLmNvbnRhaW5lcnNbZV0pKTtpZih0aGlzLmNvbnRhaW5lcnNbZV0uY29udGFpbmVyQ2FjaGUub3Zlcil7Yy5wdXNoKGZ1bmN0aW9uKGYpe3JldHVybiBmdW5jdGlvbihnKXtmLl90cmlnZ2VyKFwib3V0XCIsZyx0aGlzLl91aUhhc2godGhpcykpfX0uY2FsbCh0aGlzLHRoaXMuY29udGFpbmVyc1tlXSkpO3RoaXMuY29udGFpbmVyc1tlXS5jb250YWluZXJDYWNoZS5vdmVyPTB9fXRoaXMuX3N0b3JlZEN1cnNvciYmZChcImJvZHlcIikuY3NzKFwiY3Vyc29yXCIsdGhpcy5fc3RvcmVkQ3Vyc29yKTt0aGlzLl9zdG9yZWRPcGFjaXR5JiZ0aGlzLmhlbHBlci5jc3MoXCJvcGFjaXR5XCIsdGhpcy5fc3RvcmVkT3BhY2l0eSk7aWYodGhpcy5fc3RvcmVkWkluZGV4KXRoaXMuaGVscGVyLmNzcyhcInpJbmRleFwiLHRoaXMuX3N0b3JlZFpJbmRleD09XCJhdXRvXCI/XCJcIjp0aGlzLl9zdG9yZWRaSW5kZXgpO3RoaXMuZHJhZ2dpbmc9ZmFsc2U7aWYodGhpcy5jYW5jZWxIZWxwZXJSZW1vdmFsKXtpZighYil7dGhpcy5fdHJpZ2dlcihcImJlZm9yZVN0b3BcIixcbmEsdGhpcy5fdWlIYXNoKCkpO2ZvcihlPTA7ZTxjLmxlbmd0aDtlKyspY1tlXS5jYWxsKHRoaXMsYSk7dGhpcy5fdHJpZ2dlcihcInN0b3BcIixhLHRoaXMuX3VpSGFzaCgpKX1yZXR1cm4gZmFsc2V9Ynx8dGhpcy5fdHJpZ2dlcihcImJlZm9yZVN0b3BcIixhLHRoaXMuX3VpSGFzaCgpKTt0aGlzLnBsYWNlaG9sZGVyWzBdLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQodGhpcy5wbGFjZWhvbGRlclswXSk7dGhpcy5oZWxwZXJbMF0hPXRoaXMuY3VycmVudEl0ZW1bMF0mJnRoaXMuaGVscGVyLnJlbW92ZSgpO3RoaXMuaGVscGVyPW51bGw7aWYoIWIpe2ZvcihlPTA7ZTxjLmxlbmd0aDtlKyspY1tlXS5jYWxsKHRoaXMsYSk7dGhpcy5fdHJpZ2dlcihcInN0b3BcIixhLHRoaXMuX3VpSGFzaCgpKX10aGlzLmZyb21PdXRzaWRlPWZhbHNlO3JldHVybiB0cnVlfSxfdHJpZ2dlcjpmdW5jdGlvbigpe2QuV2lkZ2V0LnByb3RvdHlwZS5fdHJpZ2dlci5hcHBseSh0aGlzLGFyZ3VtZW50cyk9PT1mYWxzZSYmdGhpcy5jYW5jZWwoKX0sXG5fdWlIYXNoOmZ1bmN0aW9uKGEpe3ZhciBiPWF8fHRoaXM7cmV0dXJue2hlbHBlcjpiLmhlbHBlcixwbGFjZWhvbGRlcjpiLnBsYWNlaG9sZGVyfHxkKFtdKSxwb3NpdGlvbjpiLnBvc2l0aW9uLG9yaWdpbmFsUG9zaXRpb246Yi5vcmlnaW5hbFBvc2l0aW9uLG9mZnNldDpiLnBvc2l0aW9uQWJzLGl0ZW06Yi5jdXJyZW50SXRlbSxzZW5kZXI6YT9hLmVsZW1lbnQ6bnVsbH19fSk7ZC5leHRlbmQoZC51aS5zb3J0YWJsZSx7dmVyc2lvbjpcIjEuOC4xNlwifSl9KShqUXVlcnkpO1xuOy8qXG4gKiBqUXVlcnkgVUkgQWNjb3JkaW9uIDEuOC4xNlxuICpcbiAqIENvcHlyaWdodCAyMDExLCBBVVRIT1JTLnR4dCAoaHR0cDovL2pxdWVyeXVpLmNvbS9hYm91dClcbiAqIER1YWwgbGljZW5zZWQgdW5kZXIgdGhlIE1JVCBvciBHUEwgVmVyc2lvbiAyIGxpY2Vuc2VzLlxuICogaHR0cDovL2pxdWVyeS5vcmcvbGljZW5zZVxuICpcbiAqIGh0dHA6Ly9kb2NzLmpxdWVyeS5jb20vVUkvQWNjb3JkaW9uXG4gKlxuICogRGVwZW5kczpcbiAqXHRqcXVlcnkudWkuY29yZS5qc1xuICpcdGpxdWVyeS51aS53aWRnZXQuanNcbiAqL1xuKGZ1bmN0aW9uKGMpe2Mud2lkZ2V0KFwidWkuYWNjb3JkaW9uXCIse29wdGlvbnM6e2FjdGl2ZTowLGFuaW1hdGVkOlwic2xpZGVcIixhdXRvSGVpZ2h0OnRydWUsY2xlYXJTdHlsZTpmYWxzZSxjb2xsYXBzaWJsZTpmYWxzZSxldmVudDpcImNsaWNrXCIsZmlsbFNwYWNlOmZhbHNlLGhlYWRlcjpcIj4gbGkgPiA6Zmlyc3QtY2hpbGQsPiA6bm90KGxpKTpldmVuXCIsaWNvbnM6e2hlYWRlcjpcInVpLWljb24tdHJpYW5nbGUtMS1lXCIsaGVhZGVyU2VsZWN0ZWQ6XCJ1aS1pY29uLXRyaWFuZ2xlLTEtc1wifSxuYXZpZ2F0aW9uOmZhbHNlLG5hdmlnYXRpb25GaWx0ZXI6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5ocmVmLnRvTG93ZXJDYXNlKCk9PT1sb2NhdGlvbi5ocmVmLnRvTG93ZXJDYXNlKCl9fSxfY3JlYXRlOmZ1bmN0aW9uKCl7dmFyIGE9dGhpcyxiPWEub3B0aW9uczthLnJ1bm5pbmc9MDthLmVsZW1lbnQuYWRkQ2xhc3MoXCJ1aS1hY2NvcmRpb24gdWktd2lkZ2V0IHVpLWhlbHBlci1yZXNldFwiKS5jaGlsZHJlbihcImxpXCIpLmFkZENsYXNzKFwidWktYWNjb3JkaW9uLWxpLWZpeFwiKTtcbmEuaGVhZGVycz1hLmVsZW1lbnQuZmluZChiLmhlYWRlcikuYWRkQ2xhc3MoXCJ1aS1hY2NvcmRpb24taGVhZGVyIHVpLWhlbHBlci1yZXNldCB1aS1zdGF0ZS1kZWZhdWx0IHVpLWNvcm5lci1hbGxcIikuYmluZChcIm1vdXNlZW50ZXIuYWNjb3JkaW9uXCIsZnVuY3Rpb24oKXtiLmRpc2FibGVkfHxjKHRoaXMpLmFkZENsYXNzKFwidWktc3RhdGUtaG92ZXJcIil9KS5iaW5kKFwibW91c2VsZWF2ZS5hY2NvcmRpb25cIixmdW5jdGlvbigpe2IuZGlzYWJsZWR8fGModGhpcykucmVtb3ZlQ2xhc3MoXCJ1aS1zdGF0ZS1ob3ZlclwiKX0pLmJpbmQoXCJmb2N1cy5hY2NvcmRpb25cIixmdW5jdGlvbigpe2IuZGlzYWJsZWR8fGModGhpcykuYWRkQ2xhc3MoXCJ1aS1zdGF0ZS1mb2N1c1wiKX0pLmJpbmQoXCJibHVyLmFjY29yZGlvblwiLGZ1bmN0aW9uKCl7Yi5kaXNhYmxlZHx8Yyh0aGlzKS5yZW1vdmVDbGFzcyhcInVpLXN0YXRlLWZvY3VzXCIpfSk7YS5oZWFkZXJzLm5leHQoKS5hZGRDbGFzcyhcInVpLWFjY29yZGlvbi1jb250ZW50IHVpLWhlbHBlci1yZXNldCB1aS13aWRnZXQtY29udGVudCB1aS1jb3JuZXItYm90dG9tXCIpO1xuaWYoYi5uYXZpZ2F0aW9uKXt2YXIgZD1hLmVsZW1lbnQuZmluZChcImFcIikuZmlsdGVyKGIubmF2aWdhdGlvbkZpbHRlcikuZXEoMCk7aWYoZC5sZW5ndGgpe3ZhciBoPWQuY2xvc2VzdChcIi51aS1hY2NvcmRpb24taGVhZGVyXCIpO2EuYWN0aXZlPWgubGVuZ3RoP2g6ZC5jbG9zZXN0KFwiLnVpLWFjY29yZGlvbi1jb250ZW50XCIpLnByZXYoKX19YS5hY3RpdmU9YS5fZmluZEFjdGl2ZShhLmFjdGl2ZXx8Yi5hY3RpdmUpLmFkZENsYXNzKFwidWktc3RhdGUtZGVmYXVsdCB1aS1zdGF0ZS1hY3RpdmVcIikudG9nZ2xlQ2xhc3MoXCJ1aS1jb3JuZXItYWxsXCIpLnRvZ2dsZUNsYXNzKFwidWktY29ybmVyLXRvcFwiKTthLmFjdGl2ZS5uZXh0KCkuYWRkQ2xhc3MoXCJ1aS1hY2NvcmRpb24tY29udGVudC1hY3RpdmVcIik7YS5fY3JlYXRlSWNvbnMoKTthLnJlc2l6ZSgpO2EuZWxlbWVudC5hdHRyKFwicm9sZVwiLFwidGFibGlzdFwiKTthLmhlYWRlcnMuYXR0cihcInJvbGVcIixcInRhYlwiKS5iaW5kKFwia2V5ZG93bi5hY2NvcmRpb25cIixcbmZ1bmN0aW9uKGYpe3JldHVybiBhLl9rZXlkb3duKGYpfSkubmV4dCgpLmF0dHIoXCJyb2xlXCIsXCJ0YWJwYW5lbFwiKTthLmhlYWRlcnMubm90KGEuYWN0aXZlfHxcIlwiKS5hdHRyKHtcImFyaWEtZXhwYW5kZWRcIjpcImZhbHNlXCIsXCJhcmlhLXNlbGVjdGVkXCI6XCJmYWxzZVwiLHRhYkluZGV4Oi0xfSkubmV4dCgpLmhpZGUoKTthLmFjdGl2ZS5sZW5ndGg/YS5hY3RpdmUuYXR0cih7XCJhcmlhLWV4cGFuZGVkXCI6XCJ0cnVlXCIsXCJhcmlhLXNlbGVjdGVkXCI6XCJ0cnVlXCIsdGFiSW5kZXg6MH0pOmEuaGVhZGVycy5lcSgwKS5hdHRyKFwidGFiSW5kZXhcIiwwKTtjLmJyb3dzZXIuc2FmYXJpfHxhLmhlYWRlcnMuZmluZChcImFcIikuYXR0cihcInRhYkluZGV4XCIsLTEpO2IuZXZlbnQmJmEuaGVhZGVycy5iaW5kKGIuZXZlbnQuc3BsaXQoXCIgXCIpLmpvaW4oXCIuYWNjb3JkaW9uIFwiKStcIi5hY2NvcmRpb25cIixmdW5jdGlvbihmKXthLl9jbGlja0hhbmRsZXIuY2FsbChhLGYsdGhpcyk7Zi5wcmV2ZW50RGVmYXVsdCgpfSl9LF9jcmVhdGVJY29uczpmdW5jdGlvbigpe3ZhciBhPVxudGhpcy5vcHRpb25zO2lmKGEuaWNvbnMpe2MoXCI8c3Bhbj48L3NwYW4+XCIpLmFkZENsYXNzKFwidWktaWNvbiBcIithLmljb25zLmhlYWRlcikucHJlcGVuZFRvKHRoaXMuaGVhZGVycyk7dGhpcy5hY3RpdmUuY2hpbGRyZW4oXCIudWktaWNvblwiKS50b2dnbGVDbGFzcyhhLmljb25zLmhlYWRlcikudG9nZ2xlQ2xhc3MoYS5pY29ucy5oZWFkZXJTZWxlY3RlZCk7dGhpcy5lbGVtZW50LmFkZENsYXNzKFwidWktYWNjb3JkaW9uLWljb25zXCIpfX0sX2Rlc3Ryb3lJY29uczpmdW5jdGlvbigpe3RoaXMuaGVhZGVycy5jaGlsZHJlbihcIi51aS1pY29uXCIpLnJlbW92ZSgpO3RoaXMuZWxlbWVudC5yZW1vdmVDbGFzcyhcInVpLWFjY29yZGlvbi1pY29uc1wiKX0sZGVzdHJveTpmdW5jdGlvbigpe3ZhciBhPXRoaXMub3B0aW9uczt0aGlzLmVsZW1lbnQucmVtb3ZlQ2xhc3MoXCJ1aS1hY2NvcmRpb24gdWktd2lkZ2V0IHVpLWhlbHBlci1yZXNldFwiKS5yZW1vdmVBdHRyKFwicm9sZVwiKTt0aGlzLmhlYWRlcnMudW5iaW5kKFwiLmFjY29yZGlvblwiKS5yZW1vdmVDbGFzcyhcInVpLWFjY29yZGlvbi1oZWFkZXIgdWktYWNjb3JkaW9uLWRpc2FibGVkIHVpLWhlbHBlci1yZXNldCB1aS1zdGF0ZS1kZWZhdWx0IHVpLWNvcm5lci1hbGwgdWktc3RhdGUtYWN0aXZlIHVpLXN0YXRlLWRpc2FibGVkIHVpLWNvcm5lci10b3BcIikucmVtb3ZlQXR0cihcInJvbGVcIikucmVtb3ZlQXR0cihcImFyaWEtZXhwYW5kZWRcIikucmVtb3ZlQXR0cihcImFyaWEtc2VsZWN0ZWRcIikucmVtb3ZlQXR0cihcInRhYkluZGV4XCIpO1xudGhpcy5oZWFkZXJzLmZpbmQoXCJhXCIpLnJlbW92ZUF0dHIoXCJ0YWJJbmRleFwiKTt0aGlzLl9kZXN0cm95SWNvbnMoKTt2YXIgYj10aGlzLmhlYWRlcnMubmV4dCgpLmNzcyhcImRpc3BsYXlcIixcIlwiKS5yZW1vdmVBdHRyKFwicm9sZVwiKS5yZW1vdmVDbGFzcyhcInVpLWhlbHBlci1yZXNldCB1aS13aWRnZXQtY29udGVudCB1aS1jb3JuZXItYm90dG9tIHVpLWFjY29yZGlvbi1jb250ZW50IHVpLWFjY29yZGlvbi1jb250ZW50LWFjdGl2ZSB1aS1hY2NvcmRpb24tZGlzYWJsZWQgdWktc3RhdGUtZGlzYWJsZWRcIik7aWYoYS5hdXRvSGVpZ2h0fHxhLmZpbGxIZWlnaHQpYi5jc3MoXCJoZWlnaHRcIixcIlwiKTtyZXR1cm4gYy5XaWRnZXQucHJvdG90eXBlLmRlc3Ryb3kuY2FsbCh0aGlzKX0sX3NldE9wdGlvbjpmdW5jdGlvbihhLGIpe2MuV2lkZ2V0LnByb3RvdHlwZS5fc2V0T3B0aW9uLmFwcGx5KHRoaXMsYXJndW1lbnRzKTthPT1cImFjdGl2ZVwiJiZ0aGlzLmFjdGl2YXRlKGIpO2lmKGE9PVwiaWNvbnNcIil7dGhpcy5fZGVzdHJveUljb25zKCk7XG5iJiZ0aGlzLl9jcmVhdGVJY29ucygpfWlmKGE9PVwiZGlzYWJsZWRcIil0aGlzLmhlYWRlcnMuYWRkKHRoaXMuaGVhZGVycy5uZXh0KCkpW2I/XCJhZGRDbGFzc1wiOlwicmVtb3ZlQ2xhc3NcIl0oXCJ1aS1hY2NvcmRpb24tZGlzYWJsZWQgdWktc3RhdGUtZGlzYWJsZWRcIil9LF9rZXlkb3duOmZ1bmN0aW9uKGEpe2lmKCEodGhpcy5vcHRpb25zLmRpc2FibGVkfHxhLmFsdEtleXx8YS5jdHJsS2V5KSl7dmFyIGI9Yy51aS5rZXlDb2RlLGQ9dGhpcy5oZWFkZXJzLmxlbmd0aCxoPXRoaXMuaGVhZGVycy5pbmRleChhLnRhcmdldCksZj1mYWxzZTtzd2l0Y2goYS5rZXlDb2RlKXtjYXNlIGIuUklHSFQ6Y2FzZSBiLkRPV046Zj10aGlzLmhlYWRlcnNbKGgrMSklZF07YnJlYWs7Y2FzZSBiLkxFRlQ6Y2FzZSBiLlVQOmY9dGhpcy5oZWFkZXJzWyhoLTErZCklZF07YnJlYWs7Y2FzZSBiLlNQQUNFOmNhc2UgYi5FTlRFUjp0aGlzLl9jbGlja0hhbmRsZXIoe3RhcmdldDphLnRhcmdldH0sYS50YXJnZXQpO1xuYS5wcmV2ZW50RGVmYXVsdCgpfWlmKGYpe2MoYS50YXJnZXQpLmF0dHIoXCJ0YWJJbmRleFwiLC0xKTtjKGYpLmF0dHIoXCJ0YWJJbmRleFwiLDApO2YuZm9jdXMoKTtyZXR1cm4gZmFsc2V9cmV0dXJuIHRydWV9fSxyZXNpemU6ZnVuY3Rpb24oKXt2YXIgYT10aGlzLm9wdGlvbnMsYjtpZihhLmZpbGxTcGFjZSl7aWYoYy5icm93c2VyLm1zaWUpe3ZhciBkPXRoaXMuZWxlbWVudC5wYXJlbnQoKS5jc3MoXCJvdmVyZmxvd1wiKTt0aGlzLmVsZW1lbnQucGFyZW50KCkuY3NzKFwib3ZlcmZsb3dcIixcImhpZGRlblwiKX1iPXRoaXMuZWxlbWVudC5wYXJlbnQoKS5oZWlnaHQoKTtjLmJyb3dzZXIubXNpZSYmdGhpcy5lbGVtZW50LnBhcmVudCgpLmNzcyhcIm92ZXJmbG93XCIsZCk7dGhpcy5oZWFkZXJzLmVhY2goZnVuY3Rpb24oKXtiLT1jKHRoaXMpLm91dGVySGVpZ2h0KHRydWUpfSk7dGhpcy5oZWFkZXJzLm5leHQoKS5lYWNoKGZ1bmN0aW9uKCl7Yyh0aGlzKS5oZWlnaHQoTWF0aC5tYXgoMCxiLWModGhpcykuaW5uZXJIZWlnaHQoKStcbmModGhpcykuaGVpZ2h0KCkpKX0pLmNzcyhcIm92ZXJmbG93XCIsXCJhdXRvXCIpfWVsc2UgaWYoYS5hdXRvSGVpZ2h0KXtiPTA7dGhpcy5oZWFkZXJzLm5leHQoKS5lYWNoKGZ1bmN0aW9uKCl7Yj1NYXRoLm1heChiLGModGhpcykuaGVpZ2h0KFwiXCIpLmhlaWdodCgpKX0pLmhlaWdodChiKX1yZXR1cm4gdGhpc30sYWN0aXZhdGU6ZnVuY3Rpb24oYSl7dGhpcy5vcHRpb25zLmFjdGl2ZT1hO2E9dGhpcy5fZmluZEFjdGl2ZShhKVswXTt0aGlzLl9jbGlja0hhbmRsZXIoe3RhcmdldDphfSxhKTtyZXR1cm4gdGhpc30sX2ZpbmRBY3RpdmU6ZnVuY3Rpb24oYSl7cmV0dXJuIGE/dHlwZW9mIGE9PT1cIm51bWJlclwiP3RoaXMuaGVhZGVycy5maWx0ZXIoXCI6ZXEoXCIrYStcIilcIik6dGhpcy5oZWFkZXJzLm5vdCh0aGlzLmhlYWRlcnMubm90KGEpKTphPT09ZmFsc2U/YyhbXSk6dGhpcy5oZWFkZXJzLmZpbHRlcihcIjplcSgwKVwiKX0sX2NsaWNrSGFuZGxlcjpmdW5jdGlvbihhLGIpe3ZhciBkPXRoaXMub3B0aW9ucztcbmlmKCFkLmRpc2FibGVkKWlmKGEudGFyZ2V0KXthPWMoYS5jdXJyZW50VGFyZ2V0fHxiKTtiPWFbMF09PT10aGlzLmFjdGl2ZVswXTtkLmFjdGl2ZT1kLmNvbGxhcHNpYmxlJiZiP2ZhbHNlOnRoaXMuaGVhZGVycy5pbmRleChhKTtpZighKHRoaXMucnVubmluZ3x8IWQuY29sbGFwc2libGUmJmIpKXt2YXIgaD10aGlzLmFjdGl2ZTtqPWEubmV4dCgpO2c9dGhpcy5hY3RpdmUubmV4dCgpO2U9e29wdGlvbnM6ZCxuZXdIZWFkZXI6YiYmZC5jb2xsYXBzaWJsZT9jKFtdKTphLG9sZEhlYWRlcjp0aGlzLmFjdGl2ZSxuZXdDb250ZW50OmImJmQuY29sbGFwc2libGU/YyhbXSk6aixvbGRDb250ZW50Omd9O3ZhciBmPXRoaXMuaGVhZGVycy5pbmRleCh0aGlzLmFjdGl2ZVswXSk+dGhpcy5oZWFkZXJzLmluZGV4KGFbMF0pO3RoaXMuYWN0aXZlPWI/YyhbXSk6YTt0aGlzLl90b2dnbGUoaixnLGUsYixmKTtoLnJlbW92ZUNsYXNzKFwidWktc3RhdGUtYWN0aXZlIHVpLWNvcm5lci10b3BcIikuYWRkQ2xhc3MoXCJ1aS1zdGF0ZS1kZWZhdWx0IHVpLWNvcm5lci1hbGxcIikuY2hpbGRyZW4oXCIudWktaWNvblwiKS5yZW1vdmVDbGFzcyhkLmljb25zLmhlYWRlclNlbGVjdGVkKS5hZGRDbGFzcyhkLmljb25zLmhlYWRlcik7XG5pZighYil7YS5yZW1vdmVDbGFzcyhcInVpLXN0YXRlLWRlZmF1bHQgdWktY29ybmVyLWFsbFwiKS5hZGRDbGFzcyhcInVpLXN0YXRlLWFjdGl2ZSB1aS1jb3JuZXItdG9wXCIpLmNoaWxkcmVuKFwiLnVpLWljb25cIikucmVtb3ZlQ2xhc3MoZC5pY29ucy5oZWFkZXIpLmFkZENsYXNzKGQuaWNvbnMuaGVhZGVyU2VsZWN0ZWQpO2EubmV4dCgpLmFkZENsYXNzKFwidWktYWNjb3JkaW9uLWNvbnRlbnQtYWN0aXZlXCIpfX19ZWxzZSBpZihkLmNvbGxhcHNpYmxlKXt0aGlzLmFjdGl2ZS5yZW1vdmVDbGFzcyhcInVpLXN0YXRlLWFjdGl2ZSB1aS1jb3JuZXItdG9wXCIpLmFkZENsYXNzKFwidWktc3RhdGUtZGVmYXVsdCB1aS1jb3JuZXItYWxsXCIpLmNoaWxkcmVuKFwiLnVpLWljb25cIikucmVtb3ZlQ2xhc3MoZC5pY29ucy5oZWFkZXJTZWxlY3RlZCkuYWRkQ2xhc3MoZC5pY29ucy5oZWFkZXIpO3RoaXMuYWN0aXZlLm5leHQoKS5hZGRDbGFzcyhcInVpLWFjY29yZGlvbi1jb250ZW50LWFjdGl2ZVwiKTt2YXIgZz10aGlzLmFjdGl2ZS5uZXh0KCksXG5lPXtvcHRpb25zOmQsbmV3SGVhZGVyOmMoW10pLG9sZEhlYWRlcjpkLmFjdGl2ZSxuZXdDb250ZW50OmMoW10pLG9sZENvbnRlbnQ6Z30saj10aGlzLmFjdGl2ZT1jKFtdKTt0aGlzLl90b2dnbGUoaixnLGUpfX0sX3RvZ2dsZTpmdW5jdGlvbihhLGIsZCxoLGYpe3ZhciBnPXRoaXMsZT1nLm9wdGlvbnM7Zy50b1Nob3c9YTtnLnRvSGlkZT1iO2cuZGF0YT1kO3ZhciBqPWZ1bmN0aW9uKCl7aWYoZylyZXR1cm4gZy5fY29tcGxldGVkLmFwcGx5KGcsYXJndW1lbnRzKX07Zy5fdHJpZ2dlcihcImNoYW5nZXN0YXJ0XCIsbnVsbCxnLmRhdGEpO2cucnVubmluZz1iLnNpemUoKT09PTA/YS5zaXplKCk6Yi5zaXplKCk7aWYoZS5hbmltYXRlZCl7ZD17fTtkPWUuY29sbGFwc2libGUmJmg/e3RvU2hvdzpjKFtdKSx0b0hpZGU6Yixjb21wbGV0ZTpqLGRvd246ZixhdXRvSGVpZ2h0OmUuYXV0b0hlaWdodHx8ZS5maWxsU3BhY2V9Ont0b1Nob3c6YSx0b0hpZGU6Yixjb21wbGV0ZTpqLGRvd246ZixhdXRvSGVpZ2h0OmUuYXV0b0hlaWdodHx8XG5lLmZpbGxTcGFjZX07aWYoIWUucHJveGllZCllLnByb3hpZWQ9ZS5hbmltYXRlZDtpZighZS5wcm94aWVkRHVyYXRpb24pZS5wcm94aWVkRHVyYXRpb249ZS5kdXJhdGlvbjtlLmFuaW1hdGVkPWMuaXNGdW5jdGlvbihlLnByb3hpZWQpP2UucHJveGllZChkKTplLnByb3hpZWQ7ZS5kdXJhdGlvbj1jLmlzRnVuY3Rpb24oZS5wcm94aWVkRHVyYXRpb24pP2UucHJveGllZER1cmF0aW9uKGQpOmUucHJveGllZER1cmF0aW9uO2g9Yy51aS5hY2NvcmRpb24uYW5pbWF0aW9uczt2YXIgaT1lLmR1cmF0aW9uLGs9ZS5hbmltYXRlZDtpZihrJiYhaFtrXSYmIWMuZWFzaW5nW2tdKWs9XCJzbGlkZVwiO2hba118fChoW2tdPWZ1bmN0aW9uKGwpe3RoaXMuc2xpZGUobCx7ZWFzaW5nOmssZHVyYXRpb246aXx8NzAwfSl9KTtoW2tdKGQpfWVsc2V7aWYoZS5jb2xsYXBzaWJsZSYmaClhLnRvZ2dsZSgpO2Vsc2V7Yi5oaWRlKCk7YS5zaG93KCl9aih0cnVlKX1iLnByZXYoKS5hdHRyKHtcImFyaWEtZXhwYW5kZWRcIjpcImZhbHNlXCIsXG5cImFyaWEtc2VsZWN0ZWRcIjpcImZhbHNlXCIsdGFiSW5kZXg6LTF9KS5ibHVyKCk7YS5wcmV2KCkuYXR0cih7XCJhcmlhLWV4cGFuZGVkXCI6XCJ0cnVlXCIsXCJhcmlhLXNlbGVjdGVkXCI6XCJ0cnVlXCIsdGFiSW5kZXg6MH0pLmZvY3VzKCl9LF9jb21wbGV0ZWQ6ZnVuY3Rpb24oYSl7dGhpcy5ydW5uaW5nPWE/MDotLXRoaXMucnVubmluZztpZighdGhpcy5ydW5uaW5nKXt0aGlzLm9wdGlvbnMuY2xlYXJTdHlsZSYmdGhpcy50b1Nob3cuYWRkKHRoaXMudG9IaWRlKS5jc3Moe2hlaWdodDpcIlwiLG92ZXJmbG93OlwiXCJ9KTt0aGlzLnRvSGlkZS5yZW1vdmVDbGFzcyhcInVpLWFjY29yZGlvbi1jb250ZW50LWFjdGl2ZVwiKTtpZih0aGlzLnRvSGlkZS5sZW5ndGgpdGhpcy50b0hpZGUucGFyZW50KClbMF0uY2xhc3NOYW1lPXRoaXMudG9IaWRlLnBhcmVudCgpWzBdLmNsYXNzTmFtZTt0aGlzLl90cmlnZ2VyKFwiY2hhbmdlXCIsbnVsbCx0aGlzLmRhdGEpfX19KTtjLmV4dGVuZChjLnVpLmFjY29yZGlvbix7dmVyc2lvbjpcIjEuOC4xNlwiLFxuYW5pbWF0aW9uczp7c2xpZGU6ZnVuY3Rpb24oYSxiKXthPWMuZXh0ZW5kKHtlYXNpbmc6XCJzd2luZ1wiLGR1cmF0aW9uOjMwMH0sYSxiKTtpZihhLnRvSGlkZS5zaXplKCkpaWYoYS50b1Nob3cuc2l6ZSgpKXt2YXIgZD1hLnRvU2hvdy5jc3MoXCJvdmVyZmxvd1wiKSxoPTAsZj17fSxnPXt9LGU7Yj1hLnRvU2hvdztlPWJbMF0uc3R5bGUud2lkdGg7Yi53aWR0aChwYXJzZUludChiLnBhcmVudCgpLndpZHRoKCksMTApLXBhcnNlSW50KGIuY3NzKFwicGFkZGluZ0xlZnRcIiksMTApLXBhcnNlSW50KGIuY3NzKFwicGFkZGluZ1JpZ2h0XCIpLDEwKS0ocGFyc2VJbnQoYi5jc3MoXCJib3JkZXJMZWZ0V2lkdGhcIiksMTApfHwwKS0ocGFyc2VJbnQoYi5jc3MoXCJib3JkZXJSaWdodFdpZHRoXCIpLDEwKXx8MCkpO2MuZWFjaChbXCJoZWlnaHRcIixcInBhZGRpbmdUb3BcIixcInBhZGRpbmdCb3R0b21cIl0sZnVuY3Rpb24oaixpKXtnW2ldPVwiaGlkZVwiO2o9KFwiXCIrYy5jc3MoYS50b1Nob3dbMF0saSkpLm1hdGNoKC9eKFtcXGQrLS5dKykoLiopJC8pO1xuZltpXT17dmFsdWU6alsxXSx1bml0OmpbMl18fFwicHhcIn19KTthLnRvU2hvdy5jc3Moe2hlaWdodDowLG92ZXJmbG93OlwiaGlkZGVuXCJ9KS5zaG93KCk7YS50b0hpZGUuZmlsdGVyKFwiOmhpZGRlblwiKS5lYWNoKGEuY29tcGxldGUpLmVuZCgpLmZpbHRlcihcIjp2aXNpYmxlXCIpLmFuaW1hdGUoZyx7c3RlcDpmdW5jdGlvbihqLGkpe2lmKGkucHJvcD09XCJoZWlnaHRcIiloPWkuZW5kLWkuc3RhcnQ9PT0wPzA6KGkubm93LWkuc3RhcnQpLyhpLmVuZC1pLnN0YXJ0KTthLnRvU2hvd1swXS5zdHlsZVtpLnByb3BdPWgqZltpLnByb3BdLnZhbHVlK2ZbaS5wcm9wXS51bml0fSxkdXJhdGlvbjphLmR1cmF0aW9uLGVhc2luZzphLmVhc2luZyxjb21wbGV0ZTpmdW5jdGlvbigpe2EuYXV0b0hlaWdodHx8YS50b1Nob3cuY3NzKFwiaGVpZ2h0XCIsXCJcIik7YS50b1Nob3cuY3NzKHt3aWR0aDplLG92ZXJmbG93OmR9KTthLmNvbXBsZXRlKCl9fSl9ZWxzZSBhLnRvSGlkZS5hbmltYXRlKHtoZWlnaHQ6XCJoaWRlXCIsXG5wYWRkaW5nVG9wOlwiaGlkZVwiLHBhZGRpbmdCb3R0b206XCJoaWRlXCJ9LGEpO2Vsc2UgYS50b1Nob3cuYW5pbWF0ZSh7aGVpZ2h0Olwic2hvd1wiLHBhZGRpbmdUb3A6XCJzaG93XCIscGFkZGluZ0JvdHRvbTpcInNob3dcIn0sYSl9LGJvdW5jZXNsaWRlOmZ1bmN0aW9uKGEpe3RoaXMuc2xpZGUoYSx7ZWFzaW5nOmEuZG93bj9cImVhc2VPdXRCb3VuY2VcIjpcInN3aW5nXCIsZHVyYXRpb246YS5kb3duPzFFMzoyMDB9KX19fSl9KShqUXVlcnkpO1xuOy8qXG4gKiBqUXVlcnkgVUkgQXV0b2NvbXBsZXRlIDEuOC4xNlxuICpcbiAqIENvcHlyaWdodCAyMDExLCBBVVRIT1JTLnR4dCAoaHR0cDovL2pxdWVyeXVpLmNvbS9hYm91dClcbiAqIER1YWwgbGljZW5zZWQgdW5kZXIgdGhlIE1JVCBvciBHUEwgVmVyc2lvbiAyIGxpY2Vuc2VzLlxuICogaHR0cDovL2pxdWVyeS5vcmcvbGljZW5zZVxuICpcbiAqIGh0dHA6Ly9kb2NzLmpxdWVyeS5jb20vVUkvQXV0b2NvbXBsZXRlXG4gKlxuICogRGVwZW5kczpcbiAqXHRqcXVlcnkudWkuY29yZS5qc1xuICpcdGpxdWVyeS51aS53aWRnZXQuanNcbiAqXHRqcXVlcnkudWkucG9zaXRpb24uanNcbiAqL1xuKGZ1bmN0aW9uKGQpe3ZhciBlPTA7ZC53aWRnZXQoXCJ1aS5hdXRvY29tcGxldGVcIix7b3B0aW9uczp7YXBwZW5kVG86XCJib2R5XCIsYXV0b0ZvY3VzOmZhbHNlLGRlbGF5OjMwMCxtaW5MZW5ndGg6MSxwb3NpdGlvbjp7bXk6XCJsZWZ0IHRvcFwiLGF0OlwibGVmdCBib3R0b21cIixjb2xsaXNpb246XCJub25lXCJ9LHNvdXJjZTpudWxsfSxwZW5kaW5nOjAsX2NyZWF0ZTpmdW5jdGlvbigpe3ZhciBhPXRoaXMsYj10aGlzLmVsZW1lbnRbMF0ub3duZXJEb2N1bWVudCxnO3RoaXMuZWxlbWVudC5hZGRDbGFzcyhcInVpLWF1dG9jb21wbGV0ZS1pbnB1dFwiKS5hdHRyKFwiYXV0b2NvbXBsZXRlXCIsXCJvZmZcIikuYXR0cih7cm9sZTpcInRleHRib3hcIixcImFyaWEtYXV0b2NvbXBsZXRlXCI6XCJsaXN0XCIsXCJhcmlhLWhhc3BvcHVwXCI6XCJ0cnVlXCJ9KS5iaW5kKFwia2V5ZG93bi5hdXRvY29tcGxldGVcIixmdW5jdGlvbihjKXtpZighKGEub3B0aW9ucy5kaXNhYmxlZHx8YS5lbGVtZW50LnByb3BBdHRyKFwicmVhZE9ubHlcIikpKXtnPVxuZmFsc2U7dmFyIGY9ZC51aS5rZXlDb2RlO3N3aXRjaChjLmtleUNvZGUpe2Nhc2UgZi5QQUdFX1VQOmEuX21vdmUoXCJwcmV2aW91c1BhZ2VcIixjKTticmVhaztjYXNlIGYuUEFHRV9ET1dOOmEuX21vdmUoXCJuZXh0UGFnZVwiLGMpO2JyZWFrO2Nhc2UgZi5VUDphLl9tb3ZlKFwicHJldmlvdXNcIixjKTtjLnByZXZlbnREZWZhdWx0KCk7YnJlYWs7Y2FzZSBmLkRPV046YS5fbW92ZShcIm5leHRcIixjKTtjLnByZXZlbnREZWZhdWx0KCk7YnJlYWs7Y2FzZSBmLkVOVEVSOmNhc2UgZi5OVU1QQURfRU5URVI6aWYoYS5tZW51LmFjdGl2ZSl7Zz10cnVlO2MucHJldmVudERlZmF1bHQoKX1jYXNlIGYuVEFCOmlmKCFhLm1lbnUuYWN0aXZlKXJldHVybjthLm1lbnUuc2VsZWN0KGMpO2JyZWFrO2Nhc2UgZi5FU0NBUEU6YS5lbGVtZW50LnZhbChhLnRlcm0pO2EuY2xvc2UoYyk7YnJlYWs7ZGVmYXVsdDpjbGVhclRpbWVvdXQoYS5zZWFyY2hpbmcpO2Euc2VhcmNoaW5nPXNldFRpbWVvdXQoZnVuY3Rpb24oKXtpZihhLnRlcm0hPVxuYS5lbGVtZW50LnZhbCgpKXthLnNlbGVjdGVkSXRlbT1udWxsO2Euc2VhcmNoKG51bGwsYyl9fSxhLm9wdGlvbnMuZGVsYXkpO2JyZWFrfX19KS5iaW5kKFwia2V5cHJlc3MuYXV0b2NvbXBsZXRlXCIsZnVuY3Rpb24oYyl7aWYoZyl7Zz1mYWxzZTtjLnByZXZlbnREZWZhdWx0KCl9fSkuYmluZChcImZvY3VzLmF1dG9jb21wbGV0ZVwiLGZ1bmN0aW9uKCl7aWYoIWEub3B0aW9ucy5kaXNhYmxlZCl7YS5zZWxlY3RlZEl0ZW09bnVsbDthLnByZXZpb3VzPWEuZWxlbWVudC52YWwoKX19KS5iaW5kKFwiYmx1ci5hdXRvY29tcGxldGVcIixmdW5jdGlvbihjKXtpZighYS5vcHRpb25zLmRpc2FibGVkKXtjbGVhclRpbWVvdXQoYS5zZWFyY2hpbmcpO2EuY2xvc2luZz1zZXRUaW1lb3V0KGZ1bmN0aW9uKCl7YS5jbG9zZShjKTthLl9jaGFuZ2UoYyl9LDE1MCl9fSk7dGhpcy5faW5pdFNvdXJjZSgpO3RoaXMucmVzcG9uc2U9ZnVuY3Rpb24oKXtyZXR1cm4gYS5fcmVzcG9uc2UuYXBwbHkoYSxhcmd1bWVudHMpfTtcbnRoaXMubWVudT1kKFwiPHVsPjwvdWw+XCIpLmFkZENsYXNzKFwidWktYXV0b2NvbXBsZXRlXCIpLmFwcGVuZFRvKGQodGhpcy5vcHRpb25zLmFwcGVuZFRvfHxcImJvZHlcIixiKVswXSkubW91c2Vkb3duKGZ1bmN0aW9uKGMpe3ZhciBmPWEubWVudS5lbGVtZW50WzBdO2QoYy50YXJnZXQpLmNsb3Nlc3QoXCIudWktbWVudS1pdGVtXCIpLmxlbmd0aHx8c2V0VGltZW91dChmdW5jdGlvbigpe2QoZG9jdW1lbnQpLm9uZShcIm1vdXNlZG93blwiLGZ1bmN0aW9uKGgpe2gudGFyZ2V0IT09YS5lbGVtZW50WzBdJiZoLnRhcmdldCE9PWYmJiFkLnVpLmNvbnRhaW5zKGYsaC50YXJnZXQpJiZhLmNsb3NlKCl9KX0sMSk7c2V0VGltZW91dChmdW5jdGlvbigpe2NsZWFyVGltZW91dChhLmNsb3NpbmcpfSwxMyl9KS5tZW51KHtmb2N1czpmdW5jdGlvbihjLGYpe2Y9Zi5pdGVtLmRhdGEoXCJpdGVtLmF1dG9jb21wbGV0ZVwiKTtmYWxzZSE9PWEuX3RyaWdnZXIoXCJmb2N1c1wiLGMse2l0ZW06Zn0pJiYvXmtleS8udGVzdChjLm9yaWdpbmFsRXZlbnQudHlwZSkmJlxuYS5lbGVtZW50LnZhbChmLnZhbHVlKX0sc2VsZWN0ZWQ6ZnVuY3Rpb24oYyxmKXt2YXIgaD1mLml0ZW0uZGF0YShcIml0ZW0uYXV0b2NvbXBsZXRlXCIpLGk9YS5wcmV2aW91cztpZihhLmVsZW1lbnRbMF0hPT1iLmFjdGl2ZUVsZW1lbnQpe2EuZWxlbWVudC5mb2N1cygpO2EucHJldmlvdXM9aTtzZXRUaW1lb3V0KGZ1bmN0aW9uKCl7YS5wcmV2aW91cz1pO2Euc2VsZWN0ZWRJdGVtPWh9LDEpfWZhbHNlIT09YS5fdHJpZ2dlcihcInNlbGVjdFwiLGMse2l0ZW06aH0pJiZhLmVsZW1lbnQudmFsKGgudmFsdWUpO2EudGVybT1hLmVsZW1lbnQudmFsKCk7YS5jbG9zZShjKTthLnNlbGVjdGVkSXRlbT1ofSxibHVyOmZ1bmN0aW9uKCl7YS5tZW51LmVsZW1lbnQuaXMoXCI6dmlzaWJsZVwiKSYmYS5lbGVtZW50LnZhbCgpIT09YS50ZXJtJiZhLmVsZW1lbnQudmFsKGEudGVybSl9fSkuekluZGV4KHRoaXMuZWxlbWVudC56SW5kZXgoKSsxKS5jc3Moe3RvcDowLGxlZnQ6MH0pLmhpZGUoKS5kYXRhKFwibWVudVwiKTtcbmQuZm4uYmdpZnJhbWUmJnRoaXMubWVudS5lbGVtZW50LmJnaWZyYW1lKCl9LGRlc3Ryb3k6ZnVuY3Rpb24oKXt0aGlzLmVsZW1lbnQucmVtb3ZlQ2xhc3MoXCJ1aS1hdXRvY29tcGxldGUtaW5wdXRcIikucmVtb3ZlQXR0cihcImF1dG9jb21wbGV0ZVwiKS5yZW1vdmVBdHRyKFwicm9sZVwiKS5yZW1vdmVBdHRyKFwiYXJpYS1hdXRvY29tcGxldGVcIikucmVtb3ZlQXR0cihcImFyaWEtaGFzcG9wdXBcIik7dGhpcy5tZW51LmVsZW1lbnQucmVtb3ZlKCk7ZC5XaWRnZXQucHJvdG90eXBlLmRlc3Ryb3kuY2FsbCh0aGlzKX0sX3NldE9wdGlvbjpmdW5jdGlvbihhLGIpe2QuV2lkZ2V0LnByb3RvdHlwZS5fc2V0T3B0aW9uLmFwcGx5KHRoaXMsYXJndW1lbnRzKTthPT09XCJzb3VyY2VcIiYmdGhpcy5faW5pdFNvdXJjZSgpO2lmKGE9PT1cImFwcGVuZFRvXCIpdGhpcy5tZW51LmVsZW1lbnQuYXBwZW5kVG8oZChifHxcImJvZHlcIix0aGlzLmVsZW1lbnRbMF0ub3duZXJEb2N1bWVudClbMF0pO2E9PT1cImRpc2FibGVkXCImJlxuYiYmdGhpcy54aHImJnRoaXMueGhyLmFib3J0KCl9LF9pbml0U291cmNlOmZ1bmN0aW9uKCl7dmFyIGE9dGhpcyxiLGc7aWYoZC5pc0FycmF5KHRoaXMub3B0aW9ucy5zb3VyY2UpKXtiPXRoaXMub3B0aW9ucy5zb3VyY2U7dGhpcy5zb3VyY2U9ZnVuY3Rpb24oYyxmKXtmKGQudWkuYXV0b2NvbXBsZXRlLmZpbHRlcihiLGMudGVybSkpfX1lbHNlIGlmKHR5cGVvZiB0aGlzLm9wdGlvbnMuc291cmNlPT09XCJzdHJpbmdcIil7Zz10aGlzLm9wdGlvbnMuc291cmNlO3RoaXMuc291cmNlPWZ1bmN0aW9uKGMsZil7YS54aHImJmEueGhyLmFib3J0KCk7YS54aHI9ZC5hamF4KHt1cmw6ZyxkYXRhOmMsZGF0YVR5cGU6XCJqc29uXCIsYXV0b2NvbXBsZXRlUmVxdWVzdDorK2Usc3VjY2VzczpmdW5jdGlvbihoKXt0aGlzLmF1dG9jb21wbGV0ZVJlcXVlc3Q9PT1lJiZmKGgpfSxlcnJvcjpmdW5jdGlvbigpe3RoaXMuYXV0b2NvbXBsZXRlUmVxdWVzdD09PWUmJmYoW10pfX0pfX1lbHNlIHRoaXMuc291cmNlPVxudGhpcy5vcHRpb25zLnNvdXJjZX0sc2VhcmNoOmZ1bmN0aW9uKGEsYil7YT1hIT1udWxsP2E6dGhpcy5lbGVtZW50LnZhbCgpO3RoaXMudGVybT10aGlzLmVsZW1lbnQudmFsKCk7aWYoYS5sZW5ndGg8dGhpcy5vcHRpb25zLm1pbkxlbmd0aClyZXR1cm4gdGhpcy5jbG9zZShiKTtjbGVhclRpbWVvdXQodGhpcy5jbG9zaW5nKTtpZih0aGlzLl90cmlnZ2VyKFwic2VhcmNoXCIsYikhPT1mYWxzZSlyZXR1cm4gdGhpcy5fc2VhcmNoKGEpfSxfc2VhcmNoOmZ1bmN0aW9uKGEpe3RoaXMucGVuZGluZysrO3RoaXMuZWxlbWVudC5hZGRDbGFzcyhcInVpLWF1dG9jb21wbGV0ZS1sb2FkaW5nXCIpO3RoaXMuc291cmNlKHt0ZXJtOmF9LHRoaXMucmVzcG9uc2UpfSxfcmVzcG9uc2U6ZnVuY3Rpb24oYSl7aWYoIXRoaXMub3B0aW9ucy5kaXNhYmxlZCYmYSYmYS5sZW5ndGgpe2E9dGhpcy5fbm9ybWFsaXplKGEpO3RoaXMuX3N1Z2dlc3QoYSk7dGhpcy5fdHJpZ2dlcihcIm9wZW5cIil9ZWxzZSB0aGlzLmNsb3NlKCk7XG50aGlzLnBlbmRpbmctLTt0aGlzLnBlbmRpbmd8fHRoaXMuZWxlbWVudC5yZW1vdmVDbGFzcyhcInVpLWF1dG9jb21wbGV0ZS1sb2FkaW5nXCIpfSxjbG9zZTpmdW5jdGlvbihhKXtjbGVhclRpbWVvdXQodGhpcy5jbG9zaW5nKTtpZih0aGlzLm1lbnUuZWxlbWVudC5pcyhcIjp2aXNpYmxlXCIpKXt0aGlzLm1lbnUuZWxlbWVudC5oaWRlKCk7dGhpcy5tZW51LmRlYWN0aXZhdGUoKTt0aGlzLl90cmlnZ2VyKFwiY2xvc2VcIixhKX19LF9jaGFuZ2U6ZnVuY3Rpb24oYSl7dGhpcy5wcmV2aW91cyE9PXRoaXMuZWxlbWVudC52YWwoKSYmdGhpcy5fdHJpZ2dlcihcImNoYW5nZVwiLGEse2l0ZW06dGhpcy5zZWxlY3RlZEl0ZW19KX0sX25vcm1hbGl6ZTpmdW5jdGlvbihhKXtpZihhLmxlbmd0aCYmYVswXS5sYWJlbCYmYVswXS52YWx1ZSlyZXR1cm4gYTtyZXR1cm4gZC5tYXAoYSxmdW5jdGlvbihiKXtpZih0eXBlb2YgYj09PVwic3RyaW5nXCIpcmV0dXJue2xhYmVsOmIsdmFsdWU6Yn07cmV0dXJuIGQuZXh0ZW5kKHtsYWJlbDpiLmxhYmVsfHxcbmIudmFsdWUsdmFsdWU6Yi52YWx1ZXx8Yi5sYWJlbH0sYil9KX0sX3N1Z2dlc3Q6ZnVuY3Rpb24oYSl7dmFyIGI9dGhpcy5tZW51LmVsZW1lbnQuZW1wdHkoKS56SW5kZXgodGhpcy5lbGVtZW50LnpJbmRleCgpKzEpO3RoaXMuX3JlbmRlck1lbnUoYixhKTt0aGlzLm1lbnUuZGVhY3RpdmF0ZSgpO3RoaXMubWVudS5yZWZyZXNoKCk7Yi5zaG93KCk7dGhpcy5fcmVzaXplTWVudSgpO2IucG9zaXRpb24oZC5leHRlbmQoe29mOnRoaXMuZWxlbWVudH0sdGhpcy5vcHRpb25zLnBvc2l0aW9uKSk7dGhpcy5vcHRpb25zLmF1dG9Gb2N1cyYmdGhpcy5tZW51Lm5leHQobmV3IGQuRXZlbnQoXCJtb3VzZW92ZXJcIikpfSxfcmVzaXplTWVudTpmdW5jdGlvbigpe3ZhciBhPXRoaXMubWVudS5lbGVtZW50O2Eub3V0ZXJXaWR0aChNYXRoLm1heChhLndpZHRoKFwiXCIpLm91dGVyV2lkdGgoKSx0aGlzLmVsZW1lbnQub3V0ZXJXaWR0aCgpKSl9LF9yZW5kZXJNZW51OmZ1bmN0aW9uKGEsYil7dmFyIGc9dGhpcztcbmQuZWFjaChiLGZ1bmN0aW9uKGMsZil7Zy5fcmVuZGVySXRlbShhLGYpfSl9LF9yZW5kZXJJdGVtOmZ1bmN0aW9uKGEsYil7cmV0dXJuIGQoXCI8bGk+PC9saT5cIikuZGF0YShcIml0ZW0uYXV0b2NvbXBsZXRlXCIsYikuYXBwZW5kKGQoXCI8YT48L2E+XCIpLnRleHQoYi5sYWJlbCkpLmFwcGVuZFRvKGEpfSxfbW92ZTpmdW5jdGlvbihhLGIpe2lmKHRoaXMubWVudS5lbGVtZW50LmlzKFwiOnZpc2libGVcIikpaWYodGhpcy5tZW51LmZpcnN0KCkmJi9ecHJldmlvdXMvLnRlc3QoYSl8fHRoaXMubWVudS5sYXN0KCkmJi9ebmV4dC8udGVzdChhKSl7dGhpcy5lbGVtZW50LnZhbCh0aGlzLnRlcm0pO3RoaXMubWVudS5kZWFjdGl2YXRlKCl9ZWxzZSB0aGlzLm1lbnVbYV0oYik7ZWxzZSB0aGlzLnNlYXJjaChudWxsLGIpfSx3aWRnZXQ6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5tZW51LmVsZW1lbnR9fSk7ZC5leHRlbmQoZC51aS5hdXRvY29tcGxldGUse2VzY2FwZVJlZ2V4OmZ1bmN0aW9uKGEpe3JldHVybiBhLnJlcGxhY2UoL1stW1xcXXt9KCkqKz8uLFxcXFxeJHwjXFxzXS9nLFxuXCJcXFxcJCZcIil9LGZpbHRlcjpmdW5jdGlvbihhLGIpe3ZhciBnPW5ldyBSZWdFeHAoZC51aS5hdXRvY29tcGxldGUuZXNjYXBlUmVnZXgoYiksXCJpXCIpO3JldHVybiBkLmdyZXAoYSxmdW5jdGlvbihjKXtyZXR1cm4gZy50ZXN0KGMubGFiZWx8fGMudmFsdWV8fGMpfSl9fSl9KShqUXVlcnkpO1xuKGZ1bmN0aW9uKGQpe2Qud2lkZ2V0KFwidWkubWVudVwiLHtfY3JlYXRlOmZ1bmN0aW9uKCl7dmFyIGU9dGhpczt0aGlzLmVsZW1lbnQuYWRkQ2xhc3MoXCJ1aS1tZW51IHVpLXdpZGdldCB1aS13aWRnZXQtY29udGVudCB1aS1jb3JuZXItYWxsXCIpLmF0dHIoe3JvbGU6XCJsaXN0Ym94XCIsXCJhcmlhLWFjdGl2ZWRlc2NlbmRhbnRcIjpcInVpLWFjdGl2ZS1tZW51aXRlbVwifSkuY2xpY2soZnVuY3Rpb24oYSl7aWYoZChhLnRhcmdldCkuY2xvc2VzdChcIi51aS1tZW51LWl0ZW0gYVwiKS5sZW5ndGgpe2EucHJldmVudERlZmF1bHQoKTtlLnNlbGVjdChhKX19KTt0aGlzLnJlZnJlc2goKX0scmVmcmVzaDpmdW5jdGlvbigpe3ZhciBlPXRoaXM7dGhpcy5lbGVtZW50LmNoaWxkcmVuKFwibGk6bm90KC51aS1tZW51LWl0ZW0pOmhhcyhhKVwiKS5hZGRDbGFzcyhcInVpLW1lbnUtaXRlbVwiKS5hdHRyKFwicm9sZVwiLFwibWVudWl0ZW1cIikuY2hpbGRyZW4oXCJhXCIpLmFkZENsYXNzKFwidWktY29ybmVyLWFsbFwiKS5hdHRyKFwidGFiaW5kZXhcIixcbi0xKS5tb3VzZWVudGVyKGZ1bmN0aW9uKGEpe2UuYWN0aXZhdGUoYSxkKHRoaXMpLnBhcmVudCgpKX0pLm1vdXNlbGVhdmUoZnVuY3Rpb24oKXtlLmRlYWN0aXZhdGUoKX0pfSxhY3RpdmF0ZTpmdW5jdGlvbihlLGEpe3RoaXMuZGVhY3RpdmF0ZSgpO2lmKHRoaXMuaGFzU2Nyb2xsKCkpe3ZhciBiPWEub2Zmc2V0KCkudG9wLXRoaXMuZWxlbWVudC5vZmZzZXQoKS50b3AsZz10aGlzLmVsZW1lbnQuc2Nyb2xsVG9wKCksYz10aGlzLmVsZW1lbnQuaGVpZ2h0KCk7aWYoYjwwKXRoaXMuZWxlbWVudC5zY3JvbGxUb3AoZytiKTtlbHNlIGI+PWMmJnRoaXMuZWxlbWVudC5zY3JvbGxUb3AoZytiLWMrYS5oZWlnaHQoKSl9dGhpcy5hY3RpdmU9YS5lcSgwKS5jaGlsZHJlbihcImFcIikuYWRkQ2xhc3MoXCJ1aS1zdGF0ZS1ob3ZlclwiKS5hdHRyKFwiaWRcIixcInVpLWFjdGl2ZS1tZW51aXRlbVwiKS5lbmQoKTt0aGlzLl90cmlnZ2VyKFwiZm9jdXNcIixlLHtpdGVtOmF9KX0sZGVhY3RpdmF0ZTpmdW5jdGlvbigpe2lmKHRoaXMuYWN0aXZlKXt0aGlzLmFjdGl2ZS5jaGlsZHJlbihcImFcIikucmVtb3ZlQ2xhc3MoXCJ1aS1zdGF0ZS1ob3ZlclwiKS5yZW1vdmVBdHRyKFwiaWRcIik7XG50aGlzLl90cmlnZ2VyKFwiYmx1clwiKTt0aGlzLmFjdGl2ZT1udWxsfX0sbmV4dDpmdW5jdGlvbihlKXt0aGlzLm1vdmUoXCJuZXh0XCIsXCIudWktbWVudS1pdGVtOmZpcnN0XCIsZSl9LHByZXZpb3VzOmZ1bmN0aW9uKGUpe3RoaXMubW92ZShcInByZXZcIixcIi51aS1tZW51LWl0ZW06bGFzdFwiLGUpfSxmaXJzdDpmdW5jdGlvbigpe3JldHVybiB0aGlzLmFjdGl2ZSYmIXRoaXMuYWN0aXZlLnByZXZBbGwoXCIudWktbWVudS1pdGVtXCIpLmxlbmd0aH0sbGFzdDpmdW5jdGlvbigpe3JldHVybiB0aGlzLmFjdGl2ZSYmIXRoaXMuYWN0aXZlLm5leHRBbGwoXCIudWktbWVudS1pdGVtXCIpLmxlbmd0aH0sbW92ZTpmdW5jdGlvbihlLGEsYil7aWYodGhpcy5hY3RpdmUpe2U9dGhpcy5hY3RpdmVbZStcIkFsbFwiXShcIi51aS1tZW51LWl0ZW1cIikuZXEoMCk7ZS5sZW5ndGg/dGhpcy5hY3RpdmF0ZShiLGUpOnRoaXMuYWN0aXZhdGUoYix0aGlzLmVsZW1lbnQuY2hpbGRyZW4oYSkpfWVsc2UgdGhpcy5hY3RpdmF0ZShiLFxudGhpcy5lbGVtZW50LmNoaWxkcmVuKGEpKX0sbmV4dFBhZ2U6ZnVuY3Rpb24oZSl7aWYodGhpcy5oYXNTY3JvbGwoKSlpZighdGhpcy5hY3RpdmV8fHRoaXMubGFzdCgpKXRoaXMuYWN0aXZhdGUoZSx0aGlzLmVsZW1lbnQuY2hpbGRyZW4oXCIudWktbWVudS1pdGVtOmZpcnN0XCIpKTtlbHNle3ZhciBhPXRoaXMuYWN0aXZlLm9mZnNldCgpLnRvcCxiPXRoaXMuZWxlbWVudC5oZWlnaHQoKSxnPXRoaXMuZWxlbWVudC5jaGlsZHJlbihcIi51aS1tZW51LWl0ZW1cIikuZmlsdGVyKGZ1bmN0aW9uKCl7dmFyIGM9ZCh0aGlzKS5vZmZzZXQoKS50b3AtYS1iK2QodGhpcykuaGVpZ2h0KCk7cmV0dXJuIGM8MTAmJmM+LTEwfSk7Zy5sZW5ndGh8fChnPXRoaXMuZWxlbWVudC5jaGlsZHJlbihcIi51aS1tZW51LWl0ZW06bGFzdFwiKSk7dGhpcy5hY3RpdmF0ZShlLGcpfWVsc2UgdGhpcy5hY3RpdmF0ZShlLHRoaXMuZWxlbWVudC5jaGlsZHJlbihcIi51aS1tZW51LWl0ZW1cIikuZmlsdGVyKCF0aGlzLmFjdGl2ZXx8XG50aGlzLmxhc3QoKT9cIjpmaXJzdFwiOlwiOmxhc3RcIikpfSxwcmV2aW91c1BhZ2U6ZnVuY3Rpb24oZSl7aWYodGhpcy5oYXNTY3JvbGwoKSlpZighdGhpcy5hY3RpdmV8fHRoaXMuZmlyc3QoKSl0aGlzLmFjdGl2YXRlKGUsdGhpcy5lbGVtZW50LmNoaWxkcmVuKFwiLnVpLW1lbnUtaXRlbTpsYXN0XCIpKTtlbHNle3ZhciBhPXRoaXMuYWN0aXZlLm9mZnNldCgpLnRvcCxiPXRoaXMuZWxlbWVudC5oZWlnaHQoKTtyZXN1bHQ9dGhpcy5lbGVtZW50LmNoaWxkcmVuKFwiLnVpLW1lbnUtaXRlbVwiKS5maWx0ZXIoZnVuY3Rpb24oKXt2YXIgZz1kKHRoaXMpLm9mZnNldCgpLnRvcC1hK2ItZCh0aGlzKS5oZWlnaHQoKTtyZXR1cm4gZzwxMCYmZz4tMTB9KTtyZXN1bHQubGVuZ3RofHwocmVzdWx0PXRoaXMuZWxlbWVudC5jaGlsZHJlbihcIi51aS1tZW51LWl0ZW06Zmlyc3RcIikpO3RoaXMuYWN0aXZhdGUoZSxyZXN1bHQpfWVsc2UgdGhpcy5hY3RpdmF0ZShlLHRoaXMuZWxlbWVudC5jaGlsZHJlbihcIi51aS1tZW51LWl0ZW1cIikuZmlsdGVyKCF0aGlzLmFjdGl2ZXx8XG50aGlzLmZpcnN0KCk/XCI6bGFzdFwiOlwiOmZpcnN0XCIpKX0saGFzU2Nyb2xsOmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuZWxlbWVudC5oZWlnaHQoKTx0aGlzLmVsZW1lbnRbZC5mbi5wcm9wP1wicHJvcFwiOlwiYXR0clwiXShcInNjcm9sbEhlaWdodFwiKX0sc2VsZWN0OmZ1bmN0aW9uKGUpe3RoaXMuX3RyaWdnZXIoXCJzZWxlY3RlZFwiLGUse2l0ZW06dGhpcy5hY3RpdmV9KX19KX0pKGpRdWVyeSk7XG47LypcbiAqIGpRdWVyeSBVSSBCdXR0b24gMS44LjE2XG4gKlxuICogQ29weXJpZ2h0IDIwMTEsIEFVVEhPUlMudHh0IChodHRwOi8vanF1ZXJ5dWkuY29tL2Fib3V0KVxuICogRHVhbCBsaWNlbnNlZCB1bmRlciB0aGUgTUlUIG9yIEdQTCBWZXJzaW9uIDIgbGljZW5zZXMuXG4gKiBodHRwOi8vanF1ZXJ5Lm9yZy9saWNlbnNlXG4gKlxuICogaHR0cDovL2RvY3MuanF1ZXJ5LmNvbS9VSS9CdXR0b25cbiAqXG4gKiBEZXBlbmRzOlxuICpcdGpxdWVyeS51aS5jb3JlLmpzXG4gKlx0anF1ZXJ5LnVpLndpZGdldC5qc1xuICovXG4oZnVuY3Rpb24oYil7dmFyIGgsaSxqLGcsbD1mdW5jdGlvbigpe3ZhciBhPWIodGhpcykuZmluZChcIjp1aS1idXR0b25cIik7c2V0VGltZW91dChmdW5jdGlvbigpe2EuYnV0dG9uKFwicmVmcmVzaFwiKX0sMSl9LGs9ZnVuY3Rpb24oYSl7dmFyIGM9YS5uYW1lLGU9YS5mb3JtLGY9YihbXSk7aWYoYylmPWU/YihlKS5maW5kKFwiW25hbWU9J1wiK2MrXCInXVwiKTpiKFwiW25hbWU9J1wiK2MrXCInXVwiLGEub3duZXJEb2N1bWVudCkuZmlsdGVyKGZ1bmN0aW9uKCl7cmV0dXJuIXRoaXMuZm9ybX0pO3JldHVybiBmfTtiLndpZGdldChcInVpLmJ1dHRvblwiLHtvcHRpb25zOntkaXNhYmxlZDpudWxsLHRleHQ6dHJ1ZSxsYWJlbDpudWxsLGljb25zOntwcmltYXJ5Om51bGwsc2Vjb25kYXJ5Om51bGx9fSxfY3JlYXRlOmZ1bmN0aW9uKCl7dGhpcy5lbGVtZW50LmNsb3Nlc3QoXCJmb3JtXCIpLnVuYmluZChcInJlc2V0LmJ1dHRvblwiKS5iaW5kKFwicmVzZXQuYnV0dG9uXCIsbCk7aWYodHlwZW9mIHRoaXMub3B0aW9ucy5kaXNhYmxlZCE9PVxuXCJib29sZWFuXCIpdGhpcy5vcHRpb25zLmRpc2FibGVkPXRoaXMuZWxlbWVudC5wcm9wQXR0cihcImRpc2FibGVkXCIpO3RoaXMuX2RldGVybWluZUJ1dHRvblR5cGUoKTt0aGlzLmhhc1RpdGxlPSEhdGhpcy5idXR0b25FbGVtZW50LmF0dHIoXCJ0aXRsZVwiKTt2YXIgYT10aGlzLGM9dGhpcy5vcHRpb25zLGU9dGhpcy50eXBlPT09XCJjaGVja2JveFwifHx0aGlzLnR5cGU9PT1cInJhZGlvXCIsZj1cInVpLXN0YXRlLWhvdmVyXCIrKCFlP1wiIHVpLXN0YXRlLWFjdGl2ZVwiOlwiXCIpO2lmKGMubGFiZWw9PT1udWxsKWMubGFiZWw9dGhpcy5idXR0b25FbGVtZW50Lmh0bWwoKTtpZih0aGlzLmVsZW1lbnQuaXMoXCI6ZGlzYWJsZWRcIikpYy5kaXNhYmxlZD10cnVlO3RoaXMuYnV0dG9uRWxlbWVudC5hZGRDbGFzcyhcInVpLWJ1dHRvbiB1aS13aWRnZXQgdWktc3RhdGUtZGVmYXVsdCB1aS1jb3JuZXItYWxsXCIpLmF0dHIoXCJyb2xlXCIsXCJidXR0b25cIikuYmluZChcIm1vdXNlZW50ZXIuYnV0dG9uXCIsZnVuY3Rpb24oKXtpZighYy5kaXNhYmxlZCl7Yih0aGlzKS5hZGRDbGFzcyhcInVpLXN0YXRlLWhvdmVyXCIpO1xudGhpcz09PWgmJmIodGhpcykuYWRkQ2xhc3MoXCJ1aS1zdGF0ZS1hY3RpdmVcIil9fSkuYmluZChcIm1vdXNlbGVhdmUuYnV0dG9uXCIsZnVuY3Rpb24oKXtjLmRpc2FibGVkfHxiKHRoaXMpLnJlbW92ZUNsYXNzKGYpfSkuYmluZChcImNsaWNrLmJ1dHRvblwiLGZ1bmN0aW9uKGQpe2lmKGMuZGlzYWJsZWQpe2QucHJldmVudERlZmF1bHQoKTtkLnN0b3BJbW1lZGlhdGVQcm9wYWdhdGlvbigpfX0pO3RoaXMuZWxlbWVudC5iaW5kKFwiZm9jdXMuYnV0dG9uXCIsZnVuY3Rpb24oKXthLmJ1dHRvbkVsZW1lbnQuYWRkQ2xhc3MoXCJ1aS1zdGF0ZS1mb2N1c1wiKX0pLmJpbmQoXCJibHVyLmJ1dHRvblwiLGZ1bmN0aW9uKCl7YS5idXR0b25FbGVtZW50LnJlbW92ZUNsYXNzKFwidWktc3RhdGUtZm9jdXNcIil9KTtpZihlKXt0aGlzLmVsZW1lbnQuYmluZChcImNoYW5nZS5idXR0b25cIixmdW5jdGlvbigpe2d8fGEucmVmcmVzaCgpfSk7dGhpcy5idXR0b25FbGVtZW50LmJpbmQoXCJtb3VzZWRvd24uYnV0dG9uXCIsZnVuY3Rpb24oZCl7aWYoIWMuZGlzYWJsZWQpe2c9XG5mYWxzZTtpPWQucGFnZVg7aj1kLnBhZ2VZfX0pLmJpbmQoXCJtb3VzZXVwLmJ1dHRvblwiLGZ1bmN0aW9uKGQpe2lmKCFjLmRpc2FibGVkKWlmKGkhPT1kLnBhZ2VYfHxqIT09ZC5wYWdlWSlnPXRydWV9KX1pZih0aGlzLnR5cGU9PT1cImNoZWNrYm94XCIpdGhpcy5idXR0b25FbGVtZW50LmJpbmQoXCJjbGljay5idXR0b25cIixmdW5jdGlvbigpe2lmKGMuZGlzYWJsZWR8fGcpcmV0dXJuIGZhbHNlO2IodGhpcykudG9nZ2xlQ2xhc3MoXCJ1aS1zdGF0ZS1hY3RpdmVcIik7YS5idXR0b25FbGVtZW50LmF0dHIoXCJhcmlhLXByZXNzZWRcIixhLmVsZW1lbnRbMF0uY2hlY2tlZCl9KTtlbHNlIGlmKHRoaXMudHlwZT09PVwicmFkaW9cIil0aGlzLmJ1dHRvbkVsZW1lbnQuYmluZChcImNsaWNrLmJ1dHRvblwiLGZ1bmN0aW9uKCl7aWYoYy5kaXNhYmxlZHx8ZylyZXR1cm4gZmFsc2U7Yih0aGlzKS5hZGRDbGFzcyhcInVpLXN0YXRlLWFjdGl2ZVwiKTthLmJ1dHRvbkVsZW1lbnQuYXR0cihcImFyaWEtcHJlc3NlZFwiLFwidHJ1ZVwiKTtcbnZhciBkPWEuZWxlbWVudFswXTtrKGQpLm5vdChkKS5tYXAoZnVuY3Rpb24oKXtyZXR1cm4gYih0aGlzKS5idXR0b24oXCJ3aWRnZXRcIilbMF19KS5yZW1vdmVDbGFzcyhcInVpLXN0YXRlLWFjdGl2ZVwiKS5hdHRyKFwiYXJpYS1wcmVzc2VkXCIsXCJmYWxzZVwiKX0pO2Vsc2V7dGhpcy5idXR0b25FbGVtZW50LmJpbmQoXCJtb3VzZWRvd24uYnV0dG9uXCIsZnVuY3Rpb24oKXtpZihjLmRpc2FibGVkKXJldHVybiBmYWxzZTtiKHRoaXMpLmFkZENsYXNzKFwidWktc3RhdGUtYWN0aXZlXCIpO2g9dGhpcztiKGRvY3VtZW50KS5vbmUoXCJtb3VzZXVwXCIsZnVuY3Rpb24oKXtoPW51bGx9KX0pLmJpbmQoXCJtb3VzZXVwLmJ1dHRvblwiLGZ1bmN0aW9uKCl7aWYoYy5kaXNhYmxlZClyZXR1cm4gZmFsc2U7Yih0aGlzKS5yZW1vdmVDbGFzcyhcInVpLXN0YXRlLWFjdGl2ZVwiKX0pLmJpbmQoXCJrZXlkb3duLmJ1dHRvblwiLGZ1bmN0aW9uKGQpe2lmKGMuZGlzYWJsZWQpcmV0dXJuIGZhbHNlO2lmKGQua2V5Q29kZT09Yi51aS5rZXlDb2RlLlNQQUNFfHxcbmQua2V5Q29kZT09Yi51aS5rZXlDb2RlLkVOVEVSKWIodGhpcykuYWRkQ2xhc3MoXCJ1aS1zdGF0ZS1hY3RpdmVcIil9KS5iaW5kKFwia2V5dXAuYnV0dG9uXCIsZnVuY3Rpb24oKXtiKHRoaXMpLnJlbW92ZUNsYXNzKFwidWktc3RhdGUtYWN0aXZlXCIpfSk7dGhpcy5idXR0b25FbGVtZW50LmlzKFwiYVwiKSYmdGhpcy5idXR0b25FbGVtZW50LmtleXVwKGZ1bmN0aW9uKGQpe2Qua2V5Q29kZT09PWIudWkua2V5Q29kZS5TUEFDRSYmYih0aGlzKS5jbGljaygpfSl9dGhpcy5fc2V0T3B0aW9uKFwiZGlzYWJsZWRcIixjLmRpc2FibGVkKTt0aGlzLl9yZXNldEJ1dHRvbigpfSxfZGV0ZXJtaW5lQnV0dG9uVHlwZTpmdW5jdGlvbigpe3RoaXMudHlwZT10aGlzLmVsZW1lbnQuaXMoXCI6Y2hlY2tib3hcIik/XCJjaGVja2JveFwiOnRoaXMuZWxlbWVudC5pcyhcIjpyYWRpb1wiKT9cInJhZGlvXCI6dGhpcy5lbGVtZW50LmlzKFwiaW5wdXRcIik/XCJpbnB1dFwiOlwiYnV0dG9uXCI7aWYodGhpcy50eXBlPT09XCJjaGVja2JveFwifHx0aGlzLnR5cGU9PT1cblwicmFkaW9cIil7dmFyIGE9dGhpcy5lbGVtZW50LnBhcmVudHMoKS5maWx0ZXIoXCI6bGFzdFwiKSxjPVwibGFiZWxbZm9yPSdcIit0aGlzLmVsZW1lbnQuYXR0cihcImlkXCIpK1wiJ11cIjt0aGlzLmJ1dHRvbkVsZW1lbnQ9YS5maW5kKGMpO2lmKCF0aGlzLmJ1dHRvbkVsZW1lbnQubGVuZ3RoKXthPWEubGVuZ3RoP2Euc2libGluZ3MoKTp0aGlzLmVsZW1lbnQuc2libGluZ3MoKTt0aGlzLmJ1dHRvbkVsZW1lbnQ9YS5maWx0ZXIoYyk7aWYoIXRoaXMuYnV0dG9uRWxlbWVudC5sZW5ndGgpdGhpcy5idXR0b25FbGVtZW50PWEuZmluZChjKX10aGlzLmVsZW1lbnQuYWRkQ2xhc3MoXCJ1aS1oZWxwZXItaGlkZGVuLWFjY2Vzc2libGVcIik7KGE9dGhpcy5lbGVtZW50LmlzKFwiOmNoZWNrZWRcIikpJiZ0aGlzLmJ1dHRvbkVsZW1lbnQuYWRkQ2xhc3MoXCJ1aS1zdGF0ZS1hY3RpdmVcIik7dGhpcy5idXR0b25FbGVtZW50LmF0dHIoXCJhcmlhLXByZXNzZWRcIixhKX1lbHNlIHRoaXMuYnV0dG9uRWxlbWVudD10aGlzLmVsZW1lbnR9LFxud2lkZ2V0OmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuYnV0dG9uRWxlbWVudH0sZGVzdHJveTpmdW5jdGlvbigpe3RoaXMuZWxlbWVudC5yZW1vdmVDbGFzcyhcInVpLWhlbHBlci1oaWRkZW4tYWNjZXNzaWJsZVwiKTt0aGlzLmJ1dHRvbkVsZW1lbnQucmVtb3ZlQ2xhc3MoXCJ1aS1idXR0b24gdWktd2lkZ2V0IHVpLXN0YXRlLWRlZmF1bHQgdWktY29ybmVyLWFsbCB1aS1zdGF0ZS1ob3ZlciB1aS1zdGF0ZS1hY3RpdmUgIHVpLWJ1dHRvbi1pY29ucy1vbmx5IHVpLWJ1dHRvbi1pY29uLW9ubHkgdWktYnV0dG9uLXRleHQtaWNvbnMgdWktYnV0dG9uLXRleHQtaWNvbi1wcmltYXJ5IHVpLWJ1dHRvbi10ZXh0LWljb24tc2Vjb25kYXJ5IHVpLWJ1dHRvbi10ZXh0LW9ubHlcIikucmVtb3ZlQXR0cihcInJvbGVcIikucmVtb3ZlQXR0cihcImFyaWEtcHJlc3NlZFwiKS5odG1sKHRoaXMuYnV0dG9uRWxlbWVudC5maW5kKFwiLnVpLWJ1dHRvbi10ZXh0XCIpLmh0bWwoKSk7dGhpcy5oYXNUaXRsZXx8dGhpcy5idXR0b25FbGVtZW50LnJlbW92ZUF0dHIoXCJ0aXRsZVwiKTtcbmIuV2lkZ2V0LnByb3RvdHlwZS5kZXN0cm95LmNhbGwodGhpcyl9LF9zZXRPcHRpb246ZnVuY3Rpb24oYSxjKXtiLldpZGdldC5wcm90b3R5cGUuX3NldE9wdGlvbi5hcHBseSh0aGlzLGFyZ3VtZW50cyk7aWYoYT09PVwiZGlzYWJsZWRcIiljP3RoaXMuZWxlbWVudC5wcm9wQXR0cihcImRpc2FibGVkXCIsdHJ1ZSk6dGhpcy5lbGVtZW50LnByb3BBdHRyKFwiZGlzYWJsZWRcIixmYWxzZSk7ZWxzZSB0aGlzLl9yZXNldEJ1dHRvbigpfSxyZWZyZXNoOmZ1bmN0aW9uKCl7dmFyIGE9dGhpcy5lbGVtZW50LmlzKFwiOmRpc2FibGVkXCIpO2EhPT10aGlzLm9wdGlvbnMuZGlzYWJsZWQmJnRoaXMuX3NldE9wdGlvbihcImRpc2FibGVkXCIsYSk7aWYodGhpcy50eXBlPT09XCJyYWRpb1wiKWsodGhpcy5lbGVtZW50WzBdKS5lYWNoKGZ1bmN0aW9uKCl7Yih0aGlzKS5pcyhcIjpjaGVja2VkXCIpP2IodGhpcykuYnV0dG9uKFwid2lkZ2V0XCIpLmFkZENsYXNzKFwidWktc3RhdGUtYWN0aXZlXCIpLmF0dHIoXCJhcmlhLXByZXNzZWRcIixcblwidHJ1ZVwiKTpiKHRoaXMpLmJ1dHRvbihcIndpZGdldFwiKS5yZW1vdmVDbGFzcyhcInVpLXN0YXRlLWFjdGl2ZVwiKS5hdHRyKFwiYXJpYS1wcmVzc2VkXCIsXCJmYWxzZVwiKX0pO2Vsc2UgaWYodGhpcy50eXBlPT09XCJjaGVja2JveFwiKXRoaXMuZWxlbWVudC5pcyhcIjpjaGVja2VkXCIpP3RoaXMuYnV0dG9uRWxlbWVudC5hZGRDbGFzcyhcInVpLXN0YXRlLWFjdGl2ZVwiKS5hdHRyKFwiYXJpYS1wcmVzc2VkXCIsXCJ0cnVlXCIpOnRoaXMuYnV0dG9uRWxlbWVudC5yZW1vdmVDbGFzcyhcInVpLXN0YXRlLWFjdGl2ZVwiKS5hdHRyKFwiYXJpYS1wcmVzc2VkXCIsXCJmYWxzZVwiKX0sX3Jlc2V0QnV0dG9uOmZ1bmN0aW9uKCl7aWYodGhpcy50eXBlPT09XCJpbnB1dFwiKXRoaXMub3B0aW9ucy5sYWJlbCYmdGhpcy5lbGVtZW50LnZhbCh0aGlzLm9wdGlvbnMubGFiZWwpO2Vsc2V7dmFyIGE9dGhpcy5idXR0b25FbGVtZW50LnJlbW92ZUNsYXNzKFwidWktYnV0dG9uLWljb25zLW9ubHkgdWktYnV0dG9uLWljb24tb25seSB1aS1idXR0b24tdGV4dC1pY29ucyB1aS1idXR0b24tdGV4dC1pY29uLXByaW1hcnkgdWktYnV0dG9uLXRleHQtaWNvbi1zZWNvbmRhcnkgdWktYnV0dG9uLXRleHQtb25seVwiKSxcbmM9YihcIjxzcGFuPjwvc3Bhbj5cIikuYWRkQ2xhc3MoXCJ1aS1idXR0b24tdGV4dFwiKS5odG1sKHRoaXMub3B0aW9ucy5sYWJlbCkuYXBwZW5kVG8oYS5lbXB0eSgpKS50ZXh0KCksZT10aGlzLm9wdGlvbnMuaWNvbnMsZj1lLnByaW1hcnkmJmUuc2Vjb25kYXJ5LGQ9W107aWYoZS5wcmltYXJ5fHxlLnNlY29uZGFyeSl7aWYodGhpcy5vcHRpb25zLnRleHQpZC5wdXNoKFwidWktYnV0dG9uLXRleHQtaWNvblwiKyhmP1wic1wiOmUucHJpbWFyeT9cIi1wcmltYXJ5XCI6XCItc2Vjb25kYXJ5XCIpKTtlLnByaW1hcnkmJmEucHJlcGVuZChcIjxzcGFuIGNsYXNzPSd1aS1idXR0b24taWNvbi1wcmltYXJ5IHVpLWljb24gXCIrZS5wcmltYXJ5K1wiJz48L3NwYW4+XCIpO2Uuc2Vjb25kYXJ5JiZhLmFwcGVuZChcIjxzcGFuIGNsYXNzPSd1aS1idXR0b24taWNvbi1zZWNvbmRhcnkgdWktaWNvbiBcIitlLnNlY29uZGFyeStcIic+PC9zcGFuPlwiKTtpZighdGhpcy5vcHRpb25zLnRleHQpe2QucHVzaChmP1widWktYnV0dG9uLWljb25zLW9ubHlcIjpcblwidWktYnV0dG9uLWljb24tb25seVwiKTt0aGlzLmhhc1RpdGxlfHxhLmF0dHIoXCJ0aXRsZVwiLGMpfX1lbHNlIGQucHVzaChcInVpLWJ1dHRvbi10ZXh0LW9ubHlcIik7YS5hZGRDbGFzcyhkLmpvaW4oXCIgXCIpKX19fSk7Yi53aWRnZXQoXCJ1aS5idXR0b25zZXRcIix7b3B0aW9uczp7aXRlbXM6XCI6YnV0dG9uLCA6c3VibWl0LCA6cmVzZXQsIDpjaGVja2JveCwgOnJhZGlvLCBhLCA6ZGF0YShidXR0b24pXCJ9LF9jcmVhdGU6ZnVuY3Rpb24oKXt0aGlzLmVsZW1lbnQuYWRkQ2xhc3MoXCJ1aS1idXR0b25zZXRcIil9LF9pbml0OmZ1bmN0aW9uKCl7dGhpcy5yZWZyZXNoKCl9LF9zZXRPcHRpb246ZnVuY3Rpb24oYSxjKXthPT09XCJkaXNhYmxlZFwiJiZ0aGlzLmJ1dHRvbnMuYnV0dG9uKFwib3B0aW9uXCIsYSxjKTtiLldpZGdldC5wcm90b3R5cGUuX3NldE9wdGlvbi5hcHBseSh0aGlzLGFyZ3VtZW50cyl9LHJlZnJlc2g6ZnVuY3Rpb24oKXt2YXIgYT10aGlzLmVsZW1lbnQuY3NzKFwiZGlyZWN0aW9uXCIpPT09XG5cImx0clwiO3RoaXMuYnV0dG9ucz10aGlzLmVsZW1lbnQuZmluZCh0aGlzLm9wdGlvbnMuaXRlbXMpLmZpbHRlcihcIjp1aS1idXR0b25cIikuYnV0dG9uKFwicmVmcmVzaFwiKS5lbmQoKS5ub3QoXCI6dWktYnV0dG9uXCIpLmJ1dHRvbigpLmVuZCgpLm1hcChmdW5jdGlvbigpe3JldHVybiBiKHRoaXMpLmJ1dHRvbihcIndpZGdldFwiKVswXX0pLnJlbW92ZUNsYXNzKFwidWktY29ybmVyLWFsbCB1aS1jb3JuZXItbGVmdCB1aS1jb3JuZXItcmlnaHRcIikuZmlsdGVyKFwiOmZpcnN0XCIpLmFkZENsYXNzKGE/XCJ1aS1jb3JuZXItbGVmdFwiOlwidWktY29ybmVyLXJpZ2h0XCIpLmVuZCgpLmZpbHRlcihcIjpsYXN0XCIpLmFkZENsYXNzKGE/XCJ1aS1jb3JuZXItcmlnaHRcIjpcInVpLWNvcm5lci1sZWZ0XCIpLmVuZCgpLmVuZCgpfSxkZXN0cm95OmZ1bmN0aW9uKCl7dGhpcy5lbGVtZW50LnJlbW92ZUNsYXNzKFwidWktYnV0dG9uc2V0XCIpO3RoaXMuYnV0dG9ucy5tYXAoZnVuY3Rpb24oKXtyZXR1cm4gYih0aGlzKS5idXR0b24oXCJ3aWRnZXRcIilbMF19KS5yZW1vdmVDbGFzcyhcInVpLWNvcm5lci1sZWZ0IHVpLWNvcm5lci1yaWdodFwiKS5lbmQoKS5idXR0b24oXCJkZXN0cm95XCIpO1xuYi5XaWRnZXQucHJvdG90eXBlLmRlc3Ryb3kuY2FsbCh0aGlzKX19KX0pKGpRdWVyeSk7XG47LypcbiAqIGpRdWVyeSBVSSBEaWFsb2cgMS44LjE2XG4gKlxuICogQ29weXJpZ2h0IDIwMTEsIEFVVEhPUlMudHh0IChodHRwOi8vanF1ZXJ5dWkuY29tL2Fib3V0KVxuICogRHVhbCBsaWNlbnNlZCB1bmRlciB0aGUgTUlUIG9yIEdQTCBWZXJzaW9uIDIgbGljZW5zZXMuXG4gKiBodHRwOi8vanF1ZXJ5Lm9yZy9saWNlbnNlXG4gKlxuICogaHR0cDovL2RvY3MuanF1ZXJ5LmNvbS9VSS9EaWFsb2dcbiAqXG4gKiBEZXBlbmRzOlxuICpcdGpxdWVyeS51aS5jb3JlLmpzXG4gKlx0anF1ZXJ5LnVpLndpZGdldC5qc1xuICogIGpxdWVyeS51aS5idXR0b24uanNcbiAqXHRqcXVlcnkudWkuZHJhZ2dhYmxlLmpzXG4gKlx0anF1ZXJ5LnVpLm1vdXNlLmpzXG4gKlx0anF1ZXJ5LnVpLnBvc2l0aW9uLmpzXG4gKlx0anF1ZXJ5LnVpLnJlc2l6YWJsZS5qc1xuICovXG4oZnVuY3Rpb24oYyxsKXt2YXIgbT17YnV0dG9uczp0cnVlLGhlaWdodDp0cnVlLG1heEhlaWdodDp0cnVlLG1heFdpZHRoOnRydWUsbWluSGVpZ2h0OnRydWUsbWluV2lkdGg6dHJ1ZSx3aWR0aDp0cnVlfSxuPXttYXhIZWlnaHQ6dHJ1ZSxtYXhXaWR0aDp0cnVlLG1pbkhlaWdodDp0cnVlLG1pbldpZHRoOnRydWV9LG89Yy5hdHRyRm58fHt2YWw6dHJ1ZSxjc3M6dHJ1ZSxodG1sOnRydWUsdGV4dDp0cnVlLGRhdGE6dHJ1ZSx3aWR0aDp0cnVlLGhlaWdodDp0cnVlLG9mZnNldDp0cnVlLGNsaWNrOnRydWV9O2Mud2lkZ2V0KFwidWkuZGlhbG9nXCIse29wdGlvbnM6e2F1dG9PcGVuOnRydWUsYnV0dG9uczp7fSxjbG9zZU9uRXNjYXBlOnRydWUsY2xvc2VUZXh0OlwiY2xvc2VcIixkaWFsb2dDbGFzczpcIlwiLGRyYWdnYWJsZTp0cnVlLGhpZGU6bnVsbCxoZWlnaHQ6XCJhdXRvXCIsbWF4SGVpZ2h0OmZhbHNlLG1heFdpZHRoOmZhbHNlLG1pbkhlaWdodDoxNTAsbWluV2lkdGg6MTUwLG1vZGFsOmZhbHNlLFxucG9zaXRpb246e215OlwiY2VudGVyXCIsYXQ6XCJjZW50ZXJcIixjb2xsaXNpb246XCJmaXRcIix1c2luZzpmdW5jdGlvbihhKXt2YXIgYj1jKHRoaXMpLmNzcyhhKS5vZmZzZXQoKS50b3A7YjwwJiZjKHRoaXMpLmNzcyhcInRvcFwiLGEudG9wLWIpfX0scmVzaXphYmxlOnRydWUsc2hvdzpudWxsLHN0YWNrOnRydWUsdGl0bGU6XCJcIix3aWR0aDozMDAsekluZGV4OjFFM30sX2NyZWF0ZTpmdW5jdGlvbigpe3RoaXMub3JpZ2luYWxUaXRsZT10aGlzLmVsZW1lbnQuYXR0cihcInRpdGxlXCIpO2lmKHR5cGVvZiB0aGlzLm9yaWdpbmFsVGl0bGUhPT1cInN0cmluZ1wiKXRoaXMub3JpZ2luYWxUaXRsZT1cIlwiO3RoaXMub3B0aW9ucy50aXRsZT10aGlzLm9wdGlvbnMudGl0bGV8fHRoaXMub3JpZ2luYWxUaXRsZTt2YXIgYT10aGlzLGI9YS5vcHRpb25zLGQ9Yi50aXRsZXx8XCImIzE2MDtcIixlPWMudWkuZGlhbG9nLmdldFRpdGxlSWQoYS5lbGVtZW50KSxnPShhLnVpRGlhbG9nPWMoXCI8ZGl2PjwvZGl2PlwiKSkuYXBwZW5kVG8oZG9jdW1lbnQuYm9keSkuaGlkZSgpLmFkZENsYXNzKFwidWktZGlhbG9nIHVpLXdpZGdldCB1aS13aWRnZXQtY29udGVudCB1aS1jb3JuZXItYWxsIFwiK1xuYi5kaWFsb2dDbGFzcykuY3NzKHt6SW5kZXg6Yi56SW5kZXh9KS5hdHRyKFwidGFiSW5kZXhcIiwtMSkuY3NzKFwib3V0bGluZVwiLDApLmtleWRvd24oZnVuY3Rpb24oaSl7aWYoYi5jbG9zZU9uRXNjYXBlJiYhaS5pc0RlZmF1bHRQcmV2ZW50ZWQoKSYmaS5rZXlDb2RlJiZpLmtleUNvZGU9PT1jLnVpLmtleUNvZGUuRVNDQVBFKXthLmNsb3NlKGkpO2kucHJldmVudERlZmF1bHQoKX19KS5hdHRyKHtyb2xlOlwiZGlhbG9nXCIsXCJhcmlhLWxhYmVsbGVkYnlcIjplfSkubW91c2Vkb3duKGZ1bmN0aW9uKGkpe2EubW92ZVRvVG9wKGZhbHNlLGkpfSk7YS5lbGVtZW50LnNob3coKS5yZW1vdmVBdHRyKFwidGl0bGVcIikuYWRkQ2xhc3MoXCJ1aS1kaWFsb2ctY29udGVudCB1aS13aWRnZXQtY29udGVudFwiKS5hcHBlbmRUbyhnKTt2YXIgZj0oYS51aURpYWxvZ1RpdGxlYmFyPWMoXCI8ZGl2PjwvZGl2PlwiKSkuYWRkQ2xhc3MoXCJ1aS1kaWFsb2ctdGl0bGViYXIgdWktd2lkZ2V0LWhlYWRlciB1aS1jb3JuZXItYWxsIHVpLWhlbHBlci1jbGVhcmZpeFwiKS5wcmVwZW5kVG8oZyksXG5oPWMoJzxhIGhyZWY9XCIjXCI+PC9hPicpLmFkZENsYXNzKFwidWktZGlhbG9nLXRpdGxlYmFyLWNsb3NlIHVpLWNvcm5lci1hbGxcIikuYXR0cihcInJvbGVcIixcImJ1dHRvblwiKS5ob3ZlcihmdW5jdGlvbigpe2guYWRkQ2xhc3MoXCJ1aS1zdGF0ZS1ob3ZlclwiKX0sZnVuY3Rpb24oKXtoLnJlbW92ZUNsYXNzKFwidWktc3RhdGUtaG92ZXJcIil9KS5mb2N1cyhmdW5jdGlvbigpe2guYWRkQ2xhc3MoXCJ1aS1zdGF0ZS1mb2N1c1wiKX0pLmJsdXIoZnVuY3Rpb24oKXtoLnJlbW92ZUNsYXNzKFwidWktc3RhdGUtZm9jdXNcIil9KS5jbGljayhmdW5jdGlvbihpKXthLmNsb3NlKGkpO3JldHVybiBmYWxzZX0pLmFwcGVuZFRvKGYpOyhhLnVpRGlhbG9nVGl0bGViYXJDbG9zZVRleHQ9YyhcIjxzcGFuPjwvc3Bhbj5cIikpLmFkZENsYXNzKFwidWktaWNvbiB1aS1pY29uLWNsb3NldGhpY2tcIikudGV4dChiLmNsb3NlVGV4dCkuYXBwZW5kVG8oaCk7YyhcIjxzcGFuPjwvc3Bhbj5cIikuYWRkQ2xhc3MoXCJ1aS1kaWFsb2ctdGl0bGVcIikuYXR0cihcImlkXCIsXG5lKS5odG1sKGQpLnByZXBlbmRUbyhmKTtpZihjLmlzRnVuY3Rpb24oYi5iZWZvcmVjbG9zZSkmJiFjLmlzRnVuY3Rpb24oYi5iZWZvcmVDbG9zZSkpYi5iZWZvcmVDbG9zZT1iLmJlZm9yZWNsb3NlO2YuZmluZChcIipcIikuYWRkKGYpLmRpc2FibGVTZWxlY3Rpb24oKTtiLmRyYWdnYWJsZSYmYy5mbi5kcmFnZ2FibGUmJmEuX21ha2VEcmFnZ2FibGUoKTtiLnJlc2l6YWJsZSYmYy5mbi5yZXNpemFibGUmJmEuX21ha2VSZXNpemFibGUoKTthLl9jcmVhdGVCdXR0b25zKGIuYnV0dG9ucyk7YS5faXNPcGVuPWZhbHNlO2MuZm4uYmdpZnJhbWUmJmcuYmdpZnJhbWUoKX0sX2luaXQ6ZnVuY3Rpb24oKXt0aGlzLm9wdGlvbnMuYXV0b09wZW4mJnRoaXMub3BlbigpfSxkZXN0cm95OmZ1bmN0aW9uKCl7dmFyIGE9dGhpczthLm92ZXJsYXkmJmEub3ZlcmxheS5kZXN0cm95KCk7YS51aURpYWxvZy5oaWRlKCk7YS5lbGVtZW50LnVuYmluZChcIi5kaWFsb2dcIikucmVtb3ZlRGF0YShcImRpYWxvZ1wiKS5yZW1vdmVDbGFzcyhcInVpLWRpYWxvZy1jb250ZW50IHVpLXdpZGdldC1jb250ZW50XCIpLmhpZGUoKS5hcHBlbmRUbyhcImJvZHlcIik7XG5hLnVpRGlhbG9nLnJlbW92ZSgpO2Eub3JpZ2luYWxUaXRsZSYmYS5lbGVtZW50LmF0dHIoXCJ0aXRsZVwiLGEub3JpZ2luYWxUaXRsZSk7cmV0dXJuIGF9LHdpZGdldDpmdW5jdGlvbigpe3JldHVybiB0aGlzLnVpRGlhbG9nfSxjbG9zZTpmdW5jdGlvbihhKXt2YXIgYj10aGlzLGQsZTtpZihmYWxzZSE9PWIuX3RyaWdnZXIoXCJiZWZvcmVDbG9zZVwiLGEpKXtiLm92ZXJsYXkmJmIub3ZlcmxheS5kZXN0cm95KCk7Yi51aURpYWxvZy51bmJpbmQoXCJrZXlwcmVzcy51aS1kaWFsb2dcIik7Yi5faXNPcGVuPWZhbHNlO2lmKGIub3B0aW9ucy5oaWRlKWIudWlEaWFsb2cuaGlkZShiLm9wdGlvbnMuaGlkZSxmdW5jdGlvbigpe2IuX3RyaWdnZXIoXCJjbG9zZVwiLGEpfSk7ZWxzZXtiLnVpRGlhbG9nLmhpZGUoKTtiLl90cmlnZ2VyKFwiY2xvc2VcIixhKX1jLnVpLmRpYWxvZy5vdmVybGF5LnJlc2l6ZSgpO2lmKGIub3B0aW9ucy5tb2RhbCl7ZD0wO2MoXCIudWktZGlhbG9nXCIpLmVhY2goZnVuY3Rpb24oKXtpZih0aGlzIT09XG5iLnVpRGlhbG9nWzBdKXtlPWModGhpcykuY3NzKFwiei1pbmRleFwiKTtpc05hTihlKXx8KGQ9TWF0aC5tYXgoZCxlKSl9fSk7Yy51aS5kaWFsb2cubWF4Wj1kfXJldHVybiBifX0saXNPcGVuOmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuX2lzT3Blbn0sbW92ZVRvVG9wOmZ1bmN0aW9uKGEsYil7dmFyIGQ9dGhpcyxlPWQub3B0aW9ucztpZihlLm1vZGFsJiYhYXx8IWUuc3RhY2smJiFlLm1vZGFsKXJldHVybiBkLl90cmlnZ2VyKFwiZm9jdXNcIixiKTtpZihlLnpJbmRleD5jLnVpLmRpYWxvZy5tYXhaKWMudWkuZGlhbG9nLm1heFo9ZS56SW5kZXg7aWYoZC5vdmVybGF5KXtjLnVpLmRpYWxvZy5tYXhaKz0xO2Qub3ZlcmxheS4kZWwuY3NzKFwiei1pbmRleFwiLGMudWkuZGlhbG9nLm92ZXJsYXkubWF4Wj1jLnVpLmRpYWxvZy5tYXhaKX1hPXtzY3JvbGxUb3A6ZC5lbGVtZW50LnNjcm9sbFRvcCgpLHNjcm9sbExlZnQ6ZC5lbGVtZW50LnNjcm9sbExlZnQoKX07Yy51aS5kaWFsb2cubWF4Wis9MTtcbmQudWlEaWFsb2cuY3NzKFwiei1pbmRleFwiLGMudWkuZGlhbG9nLm1heFopO2QuZWxlbWVudC5hdHRyKGEpO2QuX3RyaWdnZXIoXCJmb2N1c1wiLGIpO3JldHVybiBkfSxvcGVuOmZ1bmN0aW9uKCl7aWYoIXRoaXMuX2lzT3Blbil7dmFyIGE9dGhpcyxiPWEub3B0aW9ucyxkPWEudWlEaWFsb2c7YS5vdmVybGF5PWIubW9kYWw/bmV3IGMudWkuZGlhbG9nLm92ZXJsYXkoYSk6bnVsbDthLl9zaXplKCk7YS5fcG9zaXRpb24oYi5wb3NpdGlvbik7ZC5zaG93KGIuc2hvdyk7YS5tb3ZlVG9Ub3AodHJ1ZSk7Yi5tb2RhbCYmZC5iaW5kKFwia2V5cHJlc3MudWktZGlhbG9nXCIsZnVuY3Rpb24oZSl7aWYoZS5rZXlDb2RlPT09Yy51aS5rZXlDb2RlLlRBQil7dmFyIGc9YyhcIjp0YWJiYWJsZVwiLHRoaXMpLGY9Zy5maWx0ZXIoXCI6Zmlyc3RcIik7Zz1nLmZpbHRlcihcIjpsYXN0XCIpO2lmKGUudGFyZ2V0PT09Z1swXSYmIWUuc2hpZnRLZXkpe2YuZm9jdXMoMSk7cmV0dXJuIGZhbHNlfWVsc2UgaWYoZS50YXJnZXQ9PT1cbmZbMF0mJmUuc2hpZnRLZXkpe2cuZm9jdXMoMSk7cmV0dXJuIGZhbHNlfX19KTtjKGEuZWxlbWVudC5maW5kKFwiOnRhYmJhYmxlXCIpLmdldCgpLmNvbmNhdChkLmZpbmQoXCIudWktZGlhbG9nLWJ1dHRvbnBhbmUgOnRhYmJhYmxlXCIpLmdldCgpLmNvbmNhdChkLmdldCgpKSkpLmVxKDApLmZvY3VzKCk7YS5faXNPcGVuPXRydWU7YS5fdHJpZ2dlcihcIm9wZW5cIik7cmV0dXJuIGF9fSxfY3JlYXRlQnV0dG9uczpmdW5jdGlvbihhKXt2YXIgYj10aGlzLGQ9ZmFsc2UsZT1jKFwiPGRpdj48L2Rpdj5cIikuYWRkQ2xhc3MoXCJ1aS1kaWFsb2ctYnV0dG9ucGFuZSB1aS13aWRnZXQtY29udGVudCB1aS1oZWxwZXItY2xlYXJmaXhcIiksZz1jKFwiPGRpdj48L2Rpdj5cIikuYWRkQ2xhc3MoXCJ1aS1kaWFsb2ctYnV0dG9uc2V0XCIpLmFwcGVuZFRvKGUpO2IudWlEaWFsb2cuZmluZChcIi51aS1kaWFsb2ctYnV0dG9ucGFuZVwiKS5yZW1vdmUoKTt0eXBlb2YgYT09PVwib2JqZWN0XCImJmEhPT1udWxsJiZjLmVhY2goYSxcbmZ1bmN0aW9uKCl7cmV0dXJuIShkPXRydWUpfSk7aWYoZCl7Yy5lYWNoKGEsZnVuY3Rpb24oZixoKXtoPWMuaXNGdW5jdGlvbihoKT97Y2xpY2s6aCx0ZXh0OmZ9Omg7dmFyIGk9YygnPGJ1dHRvbiB0eXBlPVwiYnV0dG9uXCI+PC9idXR0b24+JykuY2xpY2soZnVuY3Rpb24oKXtoLmNsaWNrLmFwcGx5KGIuZWxlbWVudFswXSxhcmd1bWVudHMpfSkuYXBwZW5kVG8oZyk7Yy5lYWNoKGgsZnVuY3Rpb24oaixrKXtpZihqIT09XCJjbGlja1wiKWogaW4gbz9pW2pdKGspOmkuYXR0cihqLGspfSk7Yy5mbi5idXR0b24mJmkuYnV0dG9uKCl9KTtlLmFwcGVuZFRvKGIudWlEaWFsb2cpfX0sX21ha2VEcmFnZ2FibGU6ZnVuY3Rpb24oKXtmdW5jdGlvbiBhKGYpe3JldHVybntwb3NpdGlvbjpmLnBvc2l0aW9uLG9mZnNldDpmLm9mZnNldH19dmFyIGI9dGhpcyxkPWIub3B0aW9ucyxlPWMoZG9jdW1lbnQpLGc7Yi51aURpYWxvZy5kcmFnZ2FibGUoe2NhbmNlbDpcIi51aS1kaWFsb2ctY29udGVudCwgLnVpLWRpYWxvZy10aXRsZWJhci1jbG9zZVwiLFxuaGFuZGxlOlwiLnVpLWRpYWxvZy10aXRsZWJhclwiLGNvbnRhaW5tZW50OlwiZG9jdW1lbnRcIixzdGFydDpmdW5jdGlvbihmLGgpe2c9ZC5oZWlnaHQ9PT1cImF1dG9cIj9cImF1dG9cIjpjKHRoaXMpLmhlaWdodCgpO2ModGhpcykuaGVpZ2h0KGModGhpcykuaGVpZ2h0KCkpLmFkZENsYXNzKFwidWktZGlhbG9nLWRyYWdnaW5nXCIpO2IuX3RyaWdnZXIoXCJkcmFnU3RhcnRcIixmLGEoaCkpfSxkcmFnOmZ1bmN0aW9uKGYsaCl7Yi5fdHJpZ2dlcihcImRyYWdcIixmLGEoaCkpfSxzdG9wOmZ1bmN0aW9uKGYsaCl7ZC5wb3NpdGlvbj1baC5wb3NpdGlvbi5sZWZ0LWUuc2Nyb2xsTGVmdCgpLGgucG9zaXRpb24udG9wLWUuc2Nyb2xsVG9wKCldO2ModGhpcykucmVtb3ZlQ2xhc3MoXCJ1aS1kaWFsb2ctZHJhZ2dpbmdcIikuaGVpZ2h0KGcpO2IuX3RyaWdnZXIoXCJkcmFnU3RvcFwiLGYsYShoKSk7Yy51aS5kaWFsb2cub3ZlcmxheS5yZXNpemUoKX19KX0sX21ha2VSZXNpemFibGU6ZnVuY3Rpb24oYSl7ZnVuY3Rpb24gYihmKXtyZXR1cm57b3JpZ2luYWxQb3NpdGlvbjpmLm9yaWdpbmFsUG9zaXRpb24sXG5vcmlnaW5hbFNpemU6Zi5vcmlnaW5hbFNpemUscG9zaXRpb246Zi5wb3NpdGlvbixzaXplOmYuc2l6ZX19YT1hPT09bD90aGlzLm9wdGlvbnMucmVzaXphYmxlOmE7dmFyIGQ9dGhpcyxlPWQub3B0aW9ucyxnPWQudWlEaWFsb2cuY3NzKFwicG9zaXRpb25cIik7YT10eXBlb2YgYT09PVwic3RyaW5nXCI/YTpcIm4sZSxzLHcsc2Usc3csbmUsbndcIjtkLnVpRGlhbG9nLnJlc2l6YWJsZSh7Y2FuY2VsOlwiLnVpLWRpYWxvZy1jb250ZW50XCIsY29udGFpbm1lbnQ6XCJkb2N1bWVudFwiLGFsc29SZXNpemU6ZC5lbGVtZW50LG1heFdpZHRoOmUubWF4V2lkdGgsbWF4SGVpZ2h0OmUubWF4SGVpZ2h0LG1pbldpZHRoOmUubWluV2lkdGgsbWluSGVpZ2h0OmQuX21pbkhlaWdodCgpLGhhbmRsZXM6YSxzdGFydDpmdW5jdGlvbihmLGgpe2ModGhpcykuYWRkQ2xhc3MoXCJ1aS1kaWFsb2ctcmVzaXppbmdcIik7ZC5fdHJpZ2dlcihcInJlc2l6ZVN0YXJ0XCIsZixiKGgpKX0scmVzaXplOmZ1bmN0aW9uKGYsaCl7ZC5fdHJpZ2dlcihcInJlc2l6ZVwiLFxuZixiKGgpKX0sc3RvcDpmdW5jdGlvbihmLGgpe2ModGhpcykucmVtb3ZlQ2xhc3MoXCJ1aS1kaWFsb2ctcmVzaXppbmdcIik7ZS5oZWlnaHQ9Yyh0aGlzKS5oZWlnaHQoKTtlLndpZHRoPWModGhpcykud2lkdGgoKTtkLl90cmlnZ2VyKFwicmVzaXplU3RvcFwiLGYsYihoKSk7Yy51aS5kaWFsb2cub3ZlcmxheS5yZXNpemUoKX19KS5jc3MoXCJwb3NpdGlvblwiLGcpLmZpbmQoXCIudWktcmVzaXphYmxlLXNlXCIpLmFkZENsYXNzKFwidWktaWNvbiB1aS1pY29uLWdyaXAtZGlhZ29uYWwtc2VcIil9LF9taW5IZWlnaHQ6ZnVuY3Rpb24oKXt2YXIgYT10aGlzLm9wdGlvbnM7cmV0dXJuIGEuaGVpZ2h0PT09XCJhdXRvXCI/YS5taW5IZWlnaHQ6TWF0aC5taW4oYS5taW5IZWlnaHQsYS5oZWlnaHQpfSxfcG9zaXRpb246ZnVuY3Rpb24oYSl7dmFyIGI9W10sZD1bMCwwXSxlO2lmKGEpe2lmKHR5cGVvZiBhPT09XCJzdHJpbmdcInx8dHlwZW9mIGE9PT1cIm9iamVjdFwiJiZcIjBcImluIGEpe2I9YS5zcGxpdD9hLnNwbGl0KFwiIFwiKTpcblthWzBdLGFbMV1dO2lmKGIubGVuZ3RoPT09MSliWzFdPWJbMF07Yy5lYWNoKFtcImxlZnRcIixcInRvcFwiXSxmdW5jdGlvbihnLGYpe2lmKCtiW2ddPT09YltnXSl7ZFtnXT1iW2ddO2JbZ109Zn19KTthPXtteTpiLmpvaW4oXCIgXCIpLGF0OmIuam9pbihcIiBcIiksb2Zmc2V0OmQuam9pbihcIiBcIil9fWE9Yy5leHRlbmQoe30sYy51aS5kaWFsb2cucHJvdG90eXBlLm9wdGlvbnMucG9zaXRpb24sYSl9ZWxzZSBhPWMudWkuZGlhbG9nLnByb3RvdHlwZS5vcHRpb25zLnBvc2l0aW9uOyhlPXRoaXMudWlEaWFsb2cuaXMoXCI6dmlzaWJsZVwiKSl8fHRoaXMudWlEaWFsb2cuc2hvdygpO3RoaXMudWlEaWFsb2cuY3NzKHt0b3A6MCxsZWZ0OjB9KS5wb3NpdGlvbihjLmV4dGVuZCh7b2Y6d2luZG93fSxhKSk7ZXx8dGhpcy51aURpYWxvZy5oaWRlKCl9LF9zZXRPcHRpb25zOmZ1bmN0aW9uKGEpe3ZhciBiPXRoaXMsZD17fSxlPWZhbHNlO2MuZWFjaChhLGZ1bmN0aW9uKGcsZil7Yi5fc2V0T3B0aW9uKGcsZik7XG5pZihnIGluIG0pZT10cnVlO2lmKGcgaW4gbilkW2ddPWZ9KTtlJiZ0aGlzLl9zaXplKCk7dGhpcy51aURpYWxvZy5pcyhcIjpkYXRhKHJlc2l6YWJsZSlcIikmJnRoaXMudWlEaWFsb2cucmVzaXphYmxlKFwib3B0aW9uXCIsZCl9LF9zZXRPcHRpb246ZnVuY3Rpb24oYSxiKXt2YXIgZD10aGlzLGU9ZC51aURpYWxvZztzd2l0Y2goYSl7Y2FzZSBcImJlZm9yZWNsb3NlXCI6YT1cImJlZm9yZUNsb3NlXCI7YnJlYWs7Y2FzZSBcImJ1dHRvbnNcIjpkLl9jcmVhdGVCdXR0b25zKGIpO2JyZWFrO2Nhc2UgXCJjbG9zZVRleHRcIjpkLnVpRGlhbG9nVGl0bGViYXJDbG9zZVRleHQudGV4dChcIlwiK2IpO2JyZWFrO2Nhc2UgXCJkaWFsb2dDbGFzc1wiOmUucmVtb3ZlQ2xhc3MoZC5vcHRpb25zLmRpYWxvZ0NsYXNzKS5hZGRDbGFzcyhcInVpLWRpYWxvZyB1aS13aWRnZXQgdWktd2lkZ2V0LWNvbnRlbnQgdWktY29ybmVyLWFsbCBcIitiKTticmVhaztjYXNlIFwiZGlzYWJsZWRcIjpiP2UuYWRkQ2xhc3MoXCJ1aS1kaWFsb2ctZGlzYWJsZWRcIik6XG5lLnJlbW92ZUNsYXNzKFwidWktZGlhbG9nLWRpc2FibGVkXCIpO2JyZWFrO2Nhc2UgXCJkcmFnZ2FibGVcIjp2YXIgZz1lLmlzKFwiOmRhdGEoZHJhZ2dhYmxlKVwiKTtnJiYhYiYmZS5kcmFnZ2FibGUoXCJkZXN0cm95XCIpOyFnJiZiJiZkLl9tYWtlRHJhZ2dhYmxlKCk7YnJlYWs7Y2FzZSBcInBvc2l0aW9uXCI6ZC5fcG9zaXRpb24oYik7YnJlYWs7Y2FzZSBcInJlc2l6YWJsZVwiOihnPWUuaXMoXCI6ZGF0YShyZXNpemFibGUpXCIpKSYmIWImJmUucmVzaXphYmxlKFwiZGVzdHJveVwiKTtnJiZ0eXBlb2YgYj09PVwic3RyaW5nXCImJmUucmVzaXphYmxlKFwib3B0aW9uXCIsXCJoYW5kbGVzXCIsYik7IWcmJmIhPT1mYWxzZSYmZC5fbWFrZVJlc2l6YWJsZShiKTticmVhaztjYXNlIFwidGl0bGVcIjpjKFwiLnVpLWRpYWxvZy10aXRsZVwiLGQudWlEaWFsb2dUaXRsZWJhcikuaHRtbChcIlwiKyhifHxcIiYjMTYwO1wiKSk7YnJlYWt9Yy5XaWRnZXQucHJvdG90eXBlLl9zZXRPcHRpb24uYXBwbHkoZCxhcmd1bWVudHMpfSxfc2l6ZTpmdW5jdGlvbigpe3ZhciBhPVxudGhpcy5vcHRpb25zLGIsZCxlPXRoaXMudWlEaWFsb2cuaXMoXCI6dmlzaWJsZVwiKTt0aGlzLmVsZW1lbnQuc2hvdygpLmNzcyh7d2lkdGg6XCJhdXRvXCIsbWluSGVpZ2h0OjAsaGVpZ2h0OjB9KTtpZihhLm1pbldpZHRoPmEud2lkdGgpYS53aWR0aD1hLm1pbldpZHRoO2I9dGhpcy51aURpYWxvZy5jc3Moe2hlaWdodDpcImF1dG9cIix3aWR0aDphLndpZHRofSkuaGVpZ2h0KCk7ZD1NYXRoLm1heCgwLGEubWluSGVpZ2h0LWIpO2lmKGEuaGVpZ2h0PT09XCJhdXRvXCIpaWYoYy5zdXBwb3J0Lm1pbkhlaWdodCl0aGlzLmVsZW1lbnQuY3NzKHttaW5IZWlnaHQ6ZCxoZWlnaHQ6XCJhdXRvXCJ9KTtlbHNle3RoaXMudWlEaWFsb2cuc2hvdygpO2E9dGhpcy5lbGVtZW50LmNzcyhcImhlaWdodFwiLFwiYXV0b1wiKS5oZWlnaHQoKTtlfHx0aGlzLnVpRGlhbG9nLmhpZGUoKTt0aGlzLmVsZW1lbnQuaGVpZ2h0KE1hdGgubWF4KGEsZCkpfWVsc2UgdGhpcy5lbGVtZW50LmhlaWdodChNYXRoLm1heChhLmhlaWdodC1cbmIsMCkpO3RoaXMudWlEaWFsb2cuaXMoXCI6ZGF0YShyZXNpemFibGUpXCIpJiZ0aGlzLnVpRGlhbG9nLnJlc2l6YWJsZShcIm9wdGlvblwiLFwibWluSGVpZ2h0XCIsdGhpcy5fbWluSGVpZ2h0KCkpfX0pO2MuZXh0ZW5kKGMudWkuZGlhbG9nLHt2ZXJzaW9uOlwiMS44LjE2XCIsdXVpZDowLG1heFo6MCxnZXRUaXRsZUlkOmZ1bmN0aW9uKGEpe2E9YS5hdHRyKFwiaWRcIik7aWYoIWEpe3RoaXMudXVpZCs9MTthPXRoaXMudXVpZH1yZXR1cm5cInVpLWRpYWxvZy10aXRsZS1cIithfSxvdmVybGF5OmZ1bmN0aW9uKGEpe3RoaXMuJGVsPWMudWkuZGlhbG9nLm92ZXJsYXkuY3JlYXRlKGEpfX0pO2MuZXh0ZW5kKGMudWkuZGlhbG9nLm92ZXJsYXkse2luc3RhbmNlczpbXSxvbGRJbnN0YW5jZXM6W10sbWF4WjowLGV2ZW50czpjLm1hcChcImZvY3VzLG1vdXNlZG93bixtb3VzZXVwLGtleWRvd24sa2V5cHJlc3MsY2xpY2tcIi5zcGxpdChcIixcIiksZnVuY3Rpb24oYSl7cmV0dXJuIGErXCIuZGlhbG9nLW92ZXJsYXlcIn0pLmpvaW4oXCIgXCIpLFxuY3JlYXRlOmZ1bmN0aW9uKGEpe2lmKHRoaXMuaW5zdGFuY2VzLmxlbmd0aD09PTApe3NldFRpbWVvdXQoZnVuY3Rpb24oKXtjLnVpLmRpYWxvZy5vdmVybGF5Lmluc3RhbmNlcy5sZW5ndGgmJmMoZG9jdW1lbnQpLmJpbmQoYy51aS5kaWFsb2cub3ZlcmxheS5ldmVudHMsZnVuY3Rpb24oZCl7aWYoYyhkLnRhcmdldCkuekluZGV4KCk8Yy51aS5kaWFsb2cub3ZlcmxheS5tYXhaKXJldHVybiBmYWxzZX0pfSwxKTtjKGRvY3VtZW50KS5iaW5kKFwia2V5ZG93bi5kaWFsb2ctb3ZlcmxheVwiLGZ1bmN0aW9uKGQpe2lmKGEub3B0aW9ucy5jbG9zZU9uRXNjYXBlJiYhZC5pc0RlZmF1bHRQcmV2ZW50ZWQoKSYmZC5rZXlDb2RlJiZkLmtleUNvZGU9PT1jLnVpLmtleUNvZGUuRVNDQVBFKXthLmNsb3NlKGQpO2QucHJldmVudERlZmF1bHQoKX19KTtjKHdpbmRvdykuYmluZChcInJlc2l6ZS5kaWFsb2ctb3ZlcmxheVwiLGMudWkuZGlhbG9nLm92ZXJsYXkucmVzaXplKX12YXIgYj0odGhpcy5vbGRJbnN0YW5jZXMucG9wKCl8fFxuYyhcIjxkaXY+PC9kaXY+XCIpLmFkZENsYXNzKFwidWktd2lkZ2V0LW92ZXJsYXlcIikpLmFwcGVuZFRvKGRvY3VtZW50LmJvZHkpLmNzcyh7d2lkdGg6dGhpcy53aWR0aCgpLGhlaWdodDp0aGlzLmhlaWdodCgpfSk7Yy5mbi5iZ2lmcmFtZSYmYi5iZ2lmcmFtZSgpO3RoaXMuaW5zdGFuY2VzLnB1c2goYik7cmV0dXJuIGJ9LGRlc3Ryb3k6ZnVuY3Rpb24oYSl7dmFyIGI9Yy5pbkFycmF5KGEsdGhpcy5pbnN0YW5jZXMpO2IhPS0xJiZ0aGlzLm9sZEluc3RhbmNlcy5wdXNoKHRoaXMuaW5zdGFuY2VzLnNwbGljZShiLDEpWzBdKTt0aGlzLmluc3RhbmNlcy5sZW5ndGg9PT0wJiZjKFtkb2N1bWVudCx3aW5kb3ddKS51bmJpbmQoXCIuZGlhbG9nLW92ZXJsYXlcIik7YS5yZW1vdmUoKTt2YXIgZD0wO2MuZWFjaCh0aGlzLmluc3RhbmNlcyxmdW5jdGlvbigpe2Q9TWF0aC5tYXgoZCx0aGlzLmNzcyhcInotaW5kZXhcIikpfSk7dGhpcy5tYXhaPWR9LGhlaWdodDpmdW5jdGlvbigpe3ZhciBhLGI7aWYoYy5icm93c2VyLm1zaWUmJlxuYy5icm93c2VyLnZlcnNpb248Nyl7YT1NYXRoLm1heChkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuc2Nyb2xsSGVpZ2h0LGRvY3VtZW50LmJvZHkuc2Nyb2xsSGVpZ2h0KTtiPU1hdGgubWF4KGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5vZmZzZXRIZWlnaHQsZG9jdW1lbnQuYm9keS5vZmZzZXRIZWlnaHQpO3JldHVybiBhPGI/Yyh3aW5kb3cpLmhlaWdodCgpK1wicHhcIjphK1wicHhcIn1lbHNlIHJldHVybiBjKGRvY3VtZW50KS5oZWlnaHQoKStcInB4XCJ9LHdpZHRoOmZ1bmN0aW9uKCl7dmFyIGEsYjtpZihjLmJyb3dzZXIubXNpZSl7YT1NYXRoLm1heChkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuc2Nyb2xsV2lkdGgsZG9jdW1lbnQuYm9keS5zY3JvbGxXaWR0aCk7Yj1NYXRoLm1heChkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQub2Zmc2V0V2lkdGgsZG9jdW1lbnQuYm9keS5vZmZzZXRXaWR0aCk7cmV0dXJuIGE8Yj9jKHdpbmRvdykud2lkdGgoKStcInB4XCI6YStcInB4XCJ9ZWxzZSByZXR1cm4gYyhkb2N1bWVudCkud2lkdGgoKStcblwicHhcIn0scmVzaXplOmZ1bmN0aW9uKCl7dmFyIGE9YyhbXSk7Yy5lYWNoKGMudWkuZGlhbG9nLm92ZXJsYXkuaW5zdGFuY2VzLGZ1bmN0aW9uKCl7YT1hLmFkZCh0aGlzKX0pO2EuY3NzKHt3aWR0aDowLGhlaWdodDowfSkuY3NzKHt3aWR0aDpjLnVpLmRpYWxvZy5vdmVybGF5LndpZHRoKCksaGVpZ2h0OmMudWkuZGlhbG9nLm92ZXJsYXkuaGVpZ2h0KCl9KX19KTtjLmV4dGVuZChjLnVpLmRpYWxvZy5vdmVybGF5LnByb3RvdHlwZSx7ZGVzdHJveTpmdW5jdGlvbigpe2MudWkuZGlhbG9nLm92ZXJsYXkuZGVzdHJveSh0aGlzLiRlbCl9fSl9KShqUXVlcnkpO1xuOy8qXG4gKiBqUXVlcnkgVUkgU2xpZGVyIDEuOC4xNlxuICpcbiAqIENvcHlyaWdodCAyMDExLCBBVVRIT1JTLnR4dCAoaHR0cDovL2pxdWVyeXVpLmNvbS9hYm91dClcbiAqIER1YWwgbGljZW5zZWQgdW5kZXIgdGhlIE1JVCBvciBHUEwgVmVyc2lvbiAyIGxpY2Vuc2VzLlxuICogaHR0cDovL2pxdWVyeS5vcmcvbGljZW5zZVxuICpcbiAqIGh0dHA6Ly9kb2NzLmpxdWVyeS5jb20vVUkvU2xpZGVyXG4gKlxuICogRGVwZW5kczpcbiAqXHRqcXVlcnkudWkuY29yZS5qc1xuICpcdGpxdWVyeS51aS5tb3VzZS5qc1xuICpcdGpxdWVyeS51aS53aWRnZXQuanNcbiAqL1xuKGZ1bmN0aW9uKGQpe2Qud2lkZ2V0KFwidWkuc2xpZGVyXCIsZC51aS5tb3VzZSx7d2lkZ2V0RXZlbnRQcmVmaXg6XCJzbGlkZVwiLG9wdGlvbnM6e2FuaW1hdGU6ZmFsc2UsZGlzdGFuY2U6MCxtYXg6MTAwLG1pbjowLG9yaWVudGF0aW9uOlwiaG9yaXpvbnRhbFwiLHJhbmdlOmZhbHNlLHN0ZXA6MSx2YWx1ZTowLHZhbHVlczpudWxsfSxfY3JlYXRlOmZ1bmN0aW9uKCl7dmFyIGE9dGhpcyxiPXRoaXMub3B0aW9ucyxjPXRoaXMuZWxlbWVudC5maW5kKFwiLnVpLXNsaWRlci1oYW5kbGVcIikuYWRkQ2xhc3MoXCJ1aS1zdGF0ZS1kZWZhdWx0IHVpLWNvcm5lci1hbGxcIiksZj1iLnZhbHVlcyYmYi52YWx1ZXMubGVuZ3RofHwxLGU9W107dGhpcy5fbW91c2VTbGlkaW5nPXRoaXMuX2tleVNsaWRpbmc9ZmFsc2U7dGhpcy5fYW5pbWF0ZU9mZj10cnVlO3RoaXMuX2hhbmRsZUluZGV4PW51bGw7dGhpcy5fZGV0ZWN0T3JpZW50YXRpb24oKTt0aGlzLl9tb3VzZUluaXQoKTt0aGlzLmVsZW1lbnQuYWRkQ2xhc3MoXCJ1aS1zbGlkZXIgdWktc2xpZGVyLVwiK1xudGhpcy5vcmllbnRhdGlvbitcIiB1aS13aWRnZXQgdWktd2lkZ2V0LWNvbnRlbnQgdWktY29ybmVyLWFsbFwiKyhiLmRpc2FibGVkP1wiIHVpLXNsaWRlci1kaXNhYmxlZCB1aS1kaXNhYmxlZFwiOlwiXCIpKTt0aGlzLnJhbmdlPWQoW10pO2lmKGIucmFuZ2Upe2lmKGIucmFuZ2U9PT10cnVlKXtpZighYi52YWx1ZXMpYi52YWx1ZXM9W3RoaXMuX3ZhbHVlTWluKCksdGhpcy5fdmFsdWVNaW4oKV07aWYoYi52YWx1ZXMubGVuZ3RoJiZiLnZhbHVlcy5sZW5ndGghPT0yKWIudmFsdWVzPVtiLnZhbHVlc1swXSxiLnZhbHVlc1swXV19dGhpcy5yYW5nZT1kKFwiPGRpdj48L2Rpdj5cIikuYXBwZW5kVG8odGhpcy5lbGVtZW50KS5hZGRDbGFzcyhcInVpLXNsaWRlci1yYW5nZSB1aS13aWRnZXQtaGVhZGVyXCIrKGIucmFuZ2U9PT1cIm1pblwifHxiLnJhbmdlPT09XCJtYXhcIj9cIiB1aS1zbGlkZXItcmFuZ2UtXCIrYi5yYW5nZTpcIlwiKSl9Zm9yKHZhciBqPWMubGVuZ3RoO2o8ZjtqKz0xKWUucHVzaChcIjxhIGNsYXNzPSd1aS1zbGlkZXItaGFuZGxlIHVpLXN0YXRlLWRlZmF1bHQgdWktY29ybmVyLWFsbCcgaHJlZj0nIyc+PC9hPlwiKTtcbnRoaXMuaGFuZGxlcz1jLmFkZChkKGUuam9pbihcIlwiKSkuYXBwZW5kVG8oYS5lbGVtZW50KSk7dGhpcy5oYW5kbGU9dGhpcy5oYW5kbGVzLmVxKDApO3RoaXMuaGFuZGxlcy5hZGQodGhpcy5yYW5nZSkuZmlsdGVyKFwiYVwiKS5jbGljayhmdW5jdGlvbihnKXtnLnByZXZlbnREZWZhdWx0KCl9KS5ob3ZlcihmdW5jdGlvbigpe2IuZGlzYWJsZWR8fGQodGhpcykuYWRkQ2xhc3MoXCJ1aS1zdGF0ZS1ob3ZlclwiKX0sZnVuY3Rpb24oKXtkKHRoaXMpLnJlbW92ZUNsYXNzKFwidWktc3RhdGUtaG92ZXJcIil9KS5mb2N1cyhmdW5jdGlvbigpe2lmKGIuZGlzYWJsZWQpZCh0aGlzKS5ibHVyKCk7ZWxzZXtkKFwiLnVpLXNsaWRlciAudWktc3RhdGUtZm9jdXNcIikucmVtb3ZlQ2xhc3MoXCJ1aS1zdGF0ZS1mb2N1c1wiKTtkKHRoaXMpLmFkZENsYXNzKFwidWktc3RhdGUtZm9jdXNcIil9fSkuYmx1cihmdW5jdGlvbigpe2QodGhpcykucmVtb3ZlQ2xhc3MoXCJ1aS1zdGF0ZS1mb2N1c1wiKX0pO3RoaXMuaGFuZGxlcy5lYWNoKGZ1bmN0aW9uKGcpe2QodGhpcykuZGF0YShcImluZGV4LnVpLXNsaWRlci1oYW5kbGVcIixcbmcpfSk7dGhpcy5oYW5kbGVzLmtleWRvd24oZnVuY3Rpb24oZyl7dmFyIGs9dHJ1ZSxsPWQodGhpcykuZGF0YShcImluZGV4LnVpLXNsaWRlci1oYW5kbGVcIiksaSxoLG07aWYoIWEub3B0aW9ucy5kaXNhYmxlZCl7c3dpdGNoKGcua2V5Q29kZSl7Y2FzZSBkLnVpLmtleUNvZGUuSE9NRTpjYXNlIGQudWkua2V5Q29kZS5FTkQ6Y2FzZSBkLnVpLmtleUNvZGUuUEFHRV9VUDpjYXNlIGQudWkua2V5Q29kZS5QQUdFX0RPV046Y2FzZSBkLnVpLmtleUNvZGUuVVA6Y2FzZSBkLnVpLmtleUNvZGUuUklHSFQ6Y2FzZSBkLnVpLmtleUNvZGUuRE9XTjpjYXNlIGQudWkua2V5Q29kZS5MRUZUOms9ZmFsc2U7aWYoIWEuX2tleVNsaWRpbmcpe2EuX2tleVNsaWRpbmc9dHJ1ZTtkKHRoaXMpLmFkZENsYXNzKFwidWktc3RhdGUtYWN0aXZlXCIpO2k9YS5fc3RhcnQoZyxsKTtpZihpPT09ZmFsc2UpcmV0dXJufWJyZWFrfW09YS5vcHRpb25zLnN0ZXA7aT1hLm9wdGlvbnMudmFsdWVzJiZhLm9wdGlvbnMudmFsdWVzLmxlbmd0aD9cbihoPWEudmFsdWVzKGwpKTooaD1hLnZhbHVlKCkpO3N3aXRjaChnLmtleUNvZGUpe2Nhc2UgZC51aS5rZXlDb2RlLkhPTUU6aD1hLl92YWx1ZU1pbigpO2JyZWFrO2Nhc2UgZC51aS5rZXlDb2RlLkVORDpoPWEuX3ZhbHVlTWF4KCk7YnJlYWs7Y2FzZSBkLnVpLmtleUNvZGUuUEFHRV9VUDpoPWEuX3RyaW1BbGlnblZhbHVlKGkrKGEuX3ZhbHVlTWF4KCktYS5fdmFsdWVNaW4oKSkvNSk7YnJlYWs7Y2FzZSBkLnVpLmtleUNvZGUuUEFHRV9ET1dOOmg9YS5fdHJpbUFsaWduVmFsdWUoaS0oYS5fdmFsdWVNYXgoKS1hLl92YWx1ZU1pbigpKS81KTticmVhaztjYXNlIGQudWkua2V5Q29kZS5VUDpjYXNlIGQudWkua2V5Q29kZS5SSUdIVDppZihpPT09YS5fdmFsdWVNYXgoKSlyZXR1cm47aD1hLl90cmltQWxpZ25WYWx1ZShpK20pO2JyZWFrO2Nhc2UgZC51aS5rZXlDb2RlLkRPV046Y2FzZSBkLnVpLmtleUNvZGUuTEVGVDppZihpPT09YS5fdmFsdWVNaW4oKSlyZXR1cm47aD1hLl90cmltQWxpZ25WYWx1ZShpLVxubSk7YnJlYWt9YS5fc2xpZGUoZyxsLGgpO3JldHVybiBrfX0pLmtleXVwKGZ1bmN0aW9uKGcpe3ZhciBrPWQodGhpcykuZGF0YShcImluZGV4LnVpLXNsaWRlci1oYW5kbGVcIik7aWYoYS5fa2V5U2xpZGluZyl7YS5fa2V5U2xpZGluZz1mYWxzZTthLl9zdG9wKGcsayk7YS5fY2hhbmdlKGcsayk7ZCh0aGlzKS5yZW1vdmVDbGFzcyhcInVpLXN0YXRlLWFjdGl2ZVwiKX19KTt0aGlzLl9yZWZyZXNoVmFsdWUoKTt0aGlzLl9hbmltYXRlT2ZmPWZhbHNlfSxkZXN0cm95OmZ1bmN0aW9uKCl7dGhpcy5oYW5kbGVzLnJlbW92ZSgpO3RoaXMucmFuZ2UucmVtb3ZlKCk7dGhpcy5lbGVtZW50LnJlbW92ZUNsYXNzKFwidWktc2xpZGVyIHVpLXNsaWRlci1ob3Jpem9udGFsIHVpLXNsaWRlci12ZXJ0aWNhbCB1aS1zbGlkZXItZGlzYWJsZWQgdWktd2lkZ2V0IHVpLXdpZGdldC1jb250ZW50IHVpLWNvcm5lci1hbGxcIikucmVtb3ZlRGF0YShcInNsaWRlclwiKS51bmJpbmQoXCIuc2xpZGVyXCIpO3RoaXMuX21vdXNlRGVzdHJveSgpO1xucmV0dXJuIHRoaXN9LF9tb3VzZUNhcHR1cmU6ZnVuY3Rpb24oYSl7dmFyIGI9dGhpcy5vcHRpb25zLGMsZixlLGosZztpZihiLmRpc2FibGVkKXJldHVybiBmYWxzZTt0aGlzLmVsZW1lbnRTaXplPXt3aWR0aDp0aGlzLmVsZW1lbnQub3V0ZXJXaWR0aCgpLGhlaWdodDp0aGlzLmVsZW1lbnQub3V0ZXJIZWlnaHQoKX07dGhpcy5lbGVtZW50T2Zmc2V0PXRoaXMuZWxlbWVudC5vZmZzZXQoKTtjPXRoaXMuX25vcm1WYWx1ZUZyb21Nb3VzZSh7eDphLnBhZ2VYLHk6YS5wYWdlWX0pO2Y9dGhpcy5fdmFsdWVNYXgoKS10aGlzLl92YWx1ZU1pbigpKzE7aj10aGlzO3RoaXMuaGFuZGxlcy5lYWNoKGZ1bmN0aW9uKGspe3ZhciBsPU1hdGguYWJzKGMtai52YWx1ZXMoaykpO2lmKGY+bCl7Zj1sO2U9ZCh0aGlzKTtnPWt9fSk7aWYoYi5yYW5nZT09PXRydWUmJnRoaXMudmFsdWVzKDEpPT09Yi5taW4pe2crPTE7ZT1kKHRoaXMuaGFuZGxlc1tnXSl9aWYodGhpcy5fc3RhcnQoYSxnKT09PWZhbHNlKXJldHVybiBmYWxzZTtcbnRoaXMuX21vdXNlU2xpZGluZz10cnVlO2ouX2hhbmRsZUluZGV4PWc7ZS5hZGRDbGFzcyhcInVpLXN0YXRlLWFjdGl2ZVwiKS5mb2N1cygpO2I9ZS5vZmZzZXQoKTt0aGlzLl9jbGlja09mZnNldD0hZChhLnRhcmdldCkucGFyZW50cygpLmFuZFNlbGYoKS5pcyhcIi51aS1zbGlkZXItaGFuZGxlXCIpP3tsZWZ0OjAsdG9wOjB9OntsZWZ0OmEucGFnZVgtYi5sZWZ0LWUud2lkdGgoKS8yLHRvcDphLnBhZ2VZLWIudG9wLWUuaGVpZ2h0KCkvMi0ocGFyc2VJbnQoZS5jc3MoXCJib3JkZXJUb3BXaWR0aFwiKSwxMCl8fDApLShwYXJzZUludChlLmNzcyhcImJvcmRlckJvdHRvbVdpZHRoXCIpLDEwKXx8MCkrKHBhcnNlSW50KGUuY3NzKFwibWFyZ2luVG9wXCIpLDEwKXx8MCl9O3RoaXMuaGFuZGxlcy5oYXNDbGFzcyhcInVpLXN0YXRlLWhvdmVyXCIpfHx0aGlzLl9zbGlkZShhLGcsYyk7cmV0dXJuIHRoaXMuX2FuaW1hdGVPZmY9dHJ1ZX0sX21vdXNlU3RhcnQ6ZnVuY3Rpb24oKXtyZXR1cm4gdHJ1ZX0sX21vdXNlRHJhZzpmdW5jdGlvbihhKXt2YXIgYj1cbnRoaXMuX25vcm1WYWx1ZUZyb21Nb3VzZSh7eDphLnBhZ2VYLHk6YS5wYWdlWX0pO3RoaXMuX3NsaWRlKGEsdGhpcy5faGFuZGxlSW5kZXgsYik7cmV0dXJuIGZhbHNlfSxfbW91c2VTdG9wOmZ1bmN0aW9uKGEpe3RoaXMuaGFuZGxlcy5yZW1vdmVDbGFzcyhcInVpLXN0YXRlLWFjdGl2ZVwiKTt0aGlzLl9tb3VzZVNsaWRpbmc9ZmFsc2U7dGhpcy5fc3RvcChhLHRoaXMuX2hhbmRsZUluZGV4KTt0aGlzLl9jaGFuZ2UoYSx0aGlzLl9oYW5kbGVJbmRleCk7dGhpcy5fY2xpY2tPZmZzZXQ9dGhpcy5faGFuZGxlSW5kZXg9bnVsbDtyZXR1cm4gdGhpcy5fYW5pbWF0ZU9mZj1mYWxzZX0sX2RldGVjdE9yaWVudGF0aW9uOmZ1bmN0aW9uKCl7dGhpcy5vcmllbnRhdGlvbj10aGlzLm9wdGlvbnMub3JpZW50YXRpb249PT1cInZlcnRpY2FsXCI/XCJ2ZXJ0aWNhbFwiOlwiaG9yaXpvbnRhbFwifSxfbm9ybVZhbHVlRnJvbU1vdXNlOmZ1bmN0aW9uKGEpe3ZhciBiO2lmKHRoaXMub3JpZW50YXRpb249PT1cImhvcml6b250YWxcIil7Yj1cbnRoaXMuZWxlbWVudFNpemUud2lkdGg7YT1hLngtdGhpcy5lbGVtZW50T2Zmc2V0LmxlZnQtKHRoaXMuX2NsaWNrT2Zmc2V0P3RoaXMuX2NsaWNrT2Zmc2V0LmxlZnQ6MCl9ZWxzZXtiPXRoaXMuZWxlbWVudFNpemUuaGVpZ2h0O2E9YS55LXRoaXMuZWxlbWVudE9mZnNldC50b3AtKHRoaXMuX2NsaWNrT2Zmc2V0P3RoaXMuX2NsaWNrT2Zmc2V0LnRvcDowKX1iPWEvYjtpZihiPjEpYj0xO2lmKGI8MCliPTA7aWYodGhpcy5vcmllbnRhdGlvbj09PVwidmVydGljYWxcIiliPTEtYjthPXRoaXMuX3ZhbHVlTWF4KCktdGhpcy5fdmFsdWVNaW4oKTtyZXR1cm4gdGhpcy5fdHJpbUFsaWduVmFsdWUodGhpcy5fdmFsdWVNaW4oKStiKmEpfSxfc3RhcnQ6ZnVuY3Rpb24oYSxiKXt2YXIgYz17aGFuZGxlOnRoaXMuaGFuZGxlc1tiXSx2YWx1ZTp0aGlzLnZhbHVlKCl9O2lmKHRoaXMub3B0aW9ucy52YWx1ZXMmJnRoaXMub3B0aW9ucy52YWx1ZXMubGVuZ3RoKXtjLnZhbHVlPXRoaXMudmFsdWVzKGIpO1xuYy52YWx1ZXM9dGhpcy52YWx1ZXMoKX1yZXR1cm4gdGhpcy5fdHJpZ2dlcihcInN0YXJ0XCIsYSxjKX0sX3NsaWRlOmZ1bmN0aW9uKGEsYixjKXt2YXIgZjtpZih0aGlzLm9wdGlvbnMudmFsdWVzJiZ0aGlzLm9wdGlvbnMudmFsdWVzLmxlbmd0aCl7Zj10aGlzLnZhbHVlcyhiPzA6MSk7aWYodGhpcy5vcHRpb25zLnZhbHVlcy5sZW5ndGg9PT0yJiZ0aGlzLm9wdGlvbnMucmFuZ2U9PT10cnVlJiYoYj09PTAmJmM+Znx8Yj09PTEmJmM8ZikpYz1mO2lmKGMhPT10aGlzLnZhbHVlcyhiKSl7Zj10aGlzLnZhbHVlcygpO2ZbYl09YzthPXRoaXMuX3RyaWdnZXIoXCJzbGlkZVwiLGEse2hhbmRsZTp0aGlzLmhhbmRsZXNbYl0sdmFsdWU6Yyx2YWx1ZXM6Zn0pO3RoaXMudmFsdWVzKGI/MDoxKTthIT09ZmFsc2UmJnRoaXMudmFsdWVzKGIsYyx0cnVlKX19ZWxzZSBpZihjIT09dGhpcy52YWx1ZSgpKXthPXRoaXMuX3RyaWdnZXIoXCJzbGlkZVwiLGEse2hhbmRsZTp0aGlzLmhhbmRsZXNbYl0sdmFsdWU6Y30pO1xuYSE9PWZhbHNlJiZ0aGlzLnZhbHVlKGMpfX0sX3N0b3A6ZnVuY3Rpb24oYSxiKXt2YXIgYz17aGFuZGxlOnRoaXMuaGFuZGxlc1tiXSx2YWx1ZTp0aGlzLnZhbHVlKCl9O2lmKHRoaXMub3B0aW9ucy52YWx1ZXMmJnRoaXMub3B0aW9ucy52YWx1ZXMubGVuZ3RoKXtjLnZhbHVlPXRoaXMudmFsdWVzKGIpO2MudmFsdWVzPXRoaXMudmFsdWVzKCl9dGhpcy5fdHJpZ2dlcihcInN0b3BcIixhLGMpfSxfY2hhbmdlOmZ1bmN0aW9uKGEsYil7aWYoIXRoaXMuX2tleVNsaWRpbmcmJiF0aGlzLl9tb3VzZVNsaWRpbmcpe3ZhciBjPXtoYW5kbGU6dGhpcy5oYW5kbGVzW2JdLHZhbHVlOnRoaXMudmFsdWUoKX07aWYodGhpcy5vcHRpb25zLnZhbHVlcyYmdGhpcy5vcHRpb25zLnZhbHVlcy5sZW5ndGgpe2MudmFsdWU9dGhpcy52YWx1ZXMoYik7Yy52YWx1ZXM9dGhpcy52YWx1ZXMoKX10aGlzLl90cmlnZ2VyKFwiY2hhbmdlXCIsYSxjKX19LHZhbHVlOmZ1bmN0aW9uKGEpe2lmKGFyZ3VtZW50cy5sZW5ndGgpe3RoaXMub3B0aW9ucy52YWx1ZT1cbnRoaXMuX3RyaW1BbGlnblZhbHVlKGEpO3RoaXMuX3JlZnJlc2hWYWx1ZSgpO3RoaXMuX2NoYW5nZShudWxsLDApfWVsc2UgcmV0dXJuIHRoaXMuX3ZhbHVlKCl9LHZhbHVlczpmdW5jdGlvbihhLGIpe3ZhciBjLGYsZTtpZihhcmd1bWVudHMubGVuZ3RoPjEpe3RoaXMub3B0aW9ucy52YWx1ZXNbYV09dGhpcy5fdHJpbUFsaWduVmFsdWUoYik7dGhpcy5fcmVmcmVzaFZhbHVlKCk7dGhpcy5fY2hhbmdlKG51bGwsYSl9ZWxzZSBpZihhcmd1bWVudHMubGVuZ3RoKWlmKGQuaXNBcnJheShhcmd1bWVudHNbMF0pKXtjPXRoaXMub3B0aW9ucy52YWx1ZXM7Zj1hcmd1bWVudHNbMF07Zm9yKGU9MDtlPGMubGVuZ3RoO2UrPTEpe2NbZV09dGhpcy5fdHJpbUFsaWduVmFsdWUoZltlXSk7dGhpcy5fY2hhbmdlKG51bGwsZSl9dGhpcy5fcmVmcmVzaFZhbHVlKCl9ZWxzZSByZXR1cm4gdGhpcy5vcHRpb25zLnZhbHVlcyYmdGhpcy5vcHRpb25zLnZhbHVlcy5sZW5ndGg/dGhpcy5fdmFsdWVzKGEpOlxudGhpcy52YWx1ZSgpO2Vsc2UgcmV0dXJuIHRoaXMuX3ZhbHVlcygpfSxfc2V0T3B0aW9uOmZ1bmN0aW9uKGEsYil7dmFyIGMsZj0wO2lmKGQuaXNBcnJheSh0aGlzLm9wdGlvbnMudmFsdWVzKSlmPXRoaXMub3B0aW9ucy52YWx1ZXMubGVuZ3RoO2QuV2lkZ2V0LnByb3RvdHlwZS5fc2V0T3B0aW9uLmFwcGx5KHRoaXMsYXJndW1lbnRzKTtzd2l0Y2goYSl7Y2FzZSBcImRpc2FibGVkXCI6aWYoYil7dGhpcy5oYW5kbGVzLmZpbHRlcihcIi51aS1zdGF0ZS1mb2N1c1wiKS5ibHVyKCk7dGhpcy5oYW5kbGVzLnJlbW92ZUNsYXNzKFwidWktc3RhdGUtaG92ZXJcIik7dGhpcy5oYW5kbGVzLnByb3BBdHRyKFwiZGlzYWJsZWRcIix0cnVlKTt0aGlzLmVsZW1lbnQuYWRkQ2xhc3MoXCJ1aS1kaXNhYmxlZFwiKX1lbHNle3RoaXMuaGFuZGxlcy5wcm9wQXR0cihcImRpc2FibGVkXCIsZmFsc2UpO3RoaXMuZWxlbWVudC5yZW1vdmVDbGFzcyhcInVpLWRpc2FibGVkXCIpfWJyZWFrO2Nhc2UgXCJvcmllbnRhdGlvblwiOnRoaXMuX2RldGVjdE9yaWVudGF0aW9uKCk7XG50aGlzLmVsZW1lbnQucmVtb3ZlQ2xhc3MoXCJ1aS1zbGlkZXItaG9yaXpvbnRhbCB1aS1zbGlkZXItdmVydGljYWxcIikuYWRkQ2xhc3MoXCJ1aS1zbGlkZXItXCIrdGhpcy5vcmllbnRhdGlvbik7dGhpcy5fcmVmcmVzaFZhbHVlKCk7YnJlYWs7Y2FzZSBcInZhbHVlXCI6dGhpcy5fYW5pbWF0ZU9mZj10cnVlO3RoaXMuX3JlZnJlc2hWYWx1ZSgpO3RoaXMuX2NoYW5nZShudWxsLDApO3RoaXMuX2FuaW1hdGVPZmY9ZmFsc2U7YnJlYWs7Y2FzZSBcInZhbHVlc1wiOnRoaXMuX2FuaW1hdGVPZmY9dHJ1ZTt0aGlzLl9yZWZyZXNoVmFsdWUoKTtmb3IoYz0wO2M8ZjtjKz0xKXRoaXMuX2NoYW5nZShudWxsLGMpO3RoaXMuX2FuaW1hdGVPZmY9ZmFsc2U7YnJlYWt9fSxfdmFsdWU6ZnVuY3Rpb24oKXt2YXIgYT10aGlzLm9wdGlvbnMudmFsdWU7cmV0dXJuIGE9dGhpcy5fdHJpbUFsaWduVmFsdWUoYSl9LF92YWx1ZXM6ZnVuY3Rpb24oYSl7dmFyIGIsYztpZihhcmd1bWVudHMubGVuZ3RoKXtiPXRoaXMub3B0aW9ucy52YWx1ZXNbYV07XG5yZXR1cm4gYj10aGlzLl90cmltQWxpZ25WYWx1ZShiKX1lbHNle2I9dGhpcy5vcHRpb25zLnZhbHVlcy5zbGljZSgpO2ZvcihjPTA7YzxiLmxlbmd0aDtjKz0xKWJbY109dGhpcy5fdHJpbUFsaWduVmFsdWUoYltjXSk7cmV0dXJuIGJ9fSxfdHJpbUFsaWduVmFsdWU6ZnVuY3Rpb24oYSl7aWYoYTw9dGhpcy5fdmFsdWVNaW4oKSlyZXR1cm4gdGhpcy5fdmFsdWVNaW4oKTtpZihhPj10aGlzLl92YWx1ZU1heCgpKXJldHVybiB0aGlzLl92YWx1ZU1heCgpO3ZhciBiPXRoaXMub3B0aW9ucy5zdGVwPjA/dGhpcy5vcHRpb25zLnN0ZXA6MSxjPShhLXRoaXMuX3ZhbHVlTWluKCkpJWI7YT1hLWM7aWYoTWF0aC5hYnMoYykqMj49YilhKz1jPjA/YjotYjtyZXR1cm4gcGFyc2VGbG9hdChhLnRvRml4ZWQoNSkpfSxfdmFsdWVNaW46ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5vcHRpb25zLm1pbn0sX3ZhbHVlTWF4OmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMub3B0aW9ucy5tYXh9LF9yZWZyZXNoVmFsdWU6ZnVuY3Rpb24oKXt2YXIgYT1cbnRoaXMub3B0aW9ucy5yYW5nZSxiPXRoaXMub3B0aW9ucyxjPXRoaXMsZj0hdGhpcy5fYW5pbWF0ZU9mZj9iLmFuaW1hdGU6ZmFsc2UsZSxqPXt9LGcsayxsLGk7aWYodGhpcy5vcHRpb25zLnZhbHVlcyYmdGhpcy5vcHRpb25zLnZhbHVlcy5sZW5ndGgpdGhpcy5oYW5kbGVzLmVhY2goZnVuY3Rpb24oaCl7ZT0oYy52YWx1ZXMoaCktYy5fdmFsdWVNaW4oKSkvKGMuX3ZhbHVlTWF4KCktYy5fdmFsdWVNaW4oKSkqMTAwO2pbYy5vcmllbnRhdGlvbj09PVwiaG9yaXpvbnRhbFwiP1wibGVmdFwiOlwiYm90dG9tXCJdPWUrXCIlXCI7ZCh0aGlzKS5zdG9wKDEsMSlbZj9cImFuaW1hdGVcIjpcImNzc1wiXShqLGIuYW5pbWF0ZSk7aWYoYy5vcHRpb25zLnJhbmdlPT09dHJ1ZSlpZihjLm9yaWVudGF0aW9uPT09XCJob3Jpem9udGFsXCIpe2lmKGg9PT0wKWMucmFuZ2Uuc3RvcCgxLDEpW2Y/XCJhbmltYXRlXCI6XCJjc3NcIl0oe2xlZnQ6ZStcIiVcIn0sYi5hbmltYXRlKTtpZihoPT09MSljLnJhbmdlW2Y/XCJhbmltYXRlXCI6XCJjc3NcIl0oe3dpZHRoOmUtXG5nK1wiJVwifSx7cXVldWU6ZmFsc2UsZHVyYXRpb246Yi5hbmltYXRlfSl9ZWxzZXtpZihoPT09MCljLnJhbmdlLnN0b3AoMSwxKVtmP1wiYW5pbWF0ZVwiOlwiY3NzXCJdKHtib3R0b206ZStcIiVcIn0sYi5hbmltYXRlKTtpZihoPT09MSljLnJhbmdlW2Y/XCJhbmltYXRlXCI6XCJjc3NcIl0oe2hlaWdodDplLWcrXCIlXCJ9LHtxdWV1ZTpmYWxzZSxkdXJhdGlvbjpiLmFuaW1hdGV9KX1nPWV9KTtlbHNle2s9dGhpcy52YWx1ZSgpO2w9dGhpcy5fdmFsdWVNaW4oKTtpPXRoaXMuX3ZhbHVlTWF4KCk7ZT1pIT09bD8oay1sKS8oaS1sKSoxMDA6MDtqW2Mub3JpZW50YXRpb249PT1cImhvcml6b250YWxcIj9cImxlZnRcIjpcImJvdHRvbVwiXT1lK1wiJVwiO3RoaXMuaGFuZGxlLnN0b3AoMSwxKVtmP1wiYW5pbWF0ZVwiOlwiY3NzXCJdKGosYi5hbmltYXRlKTtpZihhPT09XCJtaW5cIiYmdGhpcy5vcmllbnRhdGlvbj09PVwiaG9yaXpvbnRhbFwiKXRoaXMucmFuZ2Uuc3RvcCgxLDEpW2Y/XCJhbmltYXRlXCI6XCJjc3NcIl0oe3dpZHRoOmUrXCIlXCJ9LFxuYi5hbmltYXRlKTtpZihhPT09XCJtYXhcIiYmdGhpcy5vcmllbnRhdGlvbj09PVwiaG9yaXpvbnRhbFwiKXRoaXMucmFuZ2VbZj9cImFuaW1hdGVcIjpcImNzc1wiXSh7d2lkdGg6MTAwLWUrXCIlXCJ9LHtxdWV1ZTpmYWxzZSxkdXJhdGlvbjpiLmFuaW1hdGV9KTtpZihhPT09XCJtaW5cIiYmdGhpcy5vcmllbnRhdGlvbj09PVwidmVydGljYWxcIil0aGlzLnJhbmdlLnN0b3AoMSwxKVtmP1wiYW5pbWF0ZVwiOlwiY3NzXCJdKHtoZWlnaHQ6ZStcIiVcIn0sYi5hbmltYXRlKTtpZihhPT09XCJtYXhcIiYmdGhpcy5vcmllbnRhdGlvbj09PVwidmVydGljYWxcIil0aGlzLnJhbmdlW2Y/XCJhbmltYXRlXCI6XCJjc3NcIl0oe2hlaWdodDoxMDAtZStcIiVcIn0se3F1ZXVlOmZhbHNlLGR1cmF0aW9uOmIuYW5pbWF0ZX0pfX19KTtkLmV4dGVuZChkLnVpLnNsaWRlcix7dmVyc2lvbjpcIjEuOC4xNlwifSl9KShqUXVlcnkpO1xuOy8qXG4gKiBqUXVlcnkgVUkgVGFicyAxLjguMTZcbiAqXG4gKiBDb3B5cmlnaHQgMjAxMSwgQVVUSE9SUy50eHQgKGh0dHA6Ly9qcXVlcnl1aS5jb20vYWJvdXQpXG4gKiBEdWFsIGxpY2Vuc2VkIHVuZGVyIHRoZSBNSVQgb3IgR1BMIFZlcnNpb24gMiBsaWNlbnNlcy5cbiAqIGh0dHA6Ly9qcXVlcnkub3JnL2xpY2Vuc2VcbiAqXG4gKiBodHRwOi8vZG9jcy5qcXVlcnkuY29tL1VJL1RhYnNcbiAqXG4gKiBEZXBlbmRzOlxuICpcdGpxdWVyeS51aS5jb3JlLmpzXG4gKlx0anF1ZXJ5LnVpLndpZGdldC5qc1xuICovXG4oZnVuY3Rpb24oZCxwKXtmdW5jdGlvbiB1KCl7cmV0dXJuKyt2fWZ1bmN0aW9uIHcoKXtyZXR1cm4rK3h9dmFyIHY9MCx4PTA7ZC53aWRnZXQoXCJ1aS50YWJzXCIse29wdGlvbnM6e2FkZDpudWxsLGFqYXhPcHRpb25zOm51bGwsY2FjaGU6ZmFsc2UsY29va2llOm51bGwsY29sbGFwc2libGU6ZmFsc2UsZGlzYWJsZTpudWxsLGRpc2FibGVkOltdLGVuYWJsZTpudWxsLGV2ZW50OlwiY2xpY2tcIixmeDpudWxsLGlkUHJlZml4OlwidWktdGFicy1cIixsb2FkOm51bGwscGFuZWxUZW1wbGF0ZTpcIjxkaXY+PC9kaXY+XCIscmVtb3ZlOm51bGwsc2VsZWN0Om51bGwsc2hvdzpudWxsLHNwaW5uZXI6XCI8ZW0+TG9hZGluZyYjODIzMDs8L2VtPlwiLHRhYlRlbXBsYXRlOlwiPGxpPjxhIGhyZWY9JyN7aHJlZn0nPjxzcGFuPiN7bGFiZWx9PC9zcGFuPjwvYT48L2xpPlwifSxfY3JlYXRlOmZ1bmN0aW9uKCl7dGhpcy5fdGFiaWZ5KHRydWUpfSxfc2V0T3B0aW9uOmZ1bmN0aW9uKGIsZSl7aWYoYj09XCJzZWxlY3RlZFwiKXRoaXMub3B0aW9ucy5jb2xsYXBzaWJsZSYmXG5lPT10aGlzLm9wdGlvbnMuc2VsZWN0ZWR8fHRoaXMuc2VsZWN0KGUpO2Vsc2V7dGhpcy5vcHRpb25zW2JdPWU7dGhpcy5fdGFiaWZ5KCl9fSxfdGFiSWQ6ZnVuY3Rpb24oYil7cmV0dXJuIGIudGl0bGUmJmIudGl0bGUucmVwbGFjZSgvXFxzL2csXCJfXCIpLnJlcGxhY2UoL1teXFx3XFx1MDBjMC1cXHVGRkZGLV0vZyxcIlwiKXx8dGhpcy5vcHRpb25zLmlkUHJlZml4K3UoKX0sX3Nhbml0aXplU2VsZWN0b3I6ZnVuY3Rpb24oYil7cmV0dXJuIGIucmVwbGFjZSgvOi9nLFwiXFxcXDpcIil9LF9jb29raWU6ZnVuY3Rpb24oKXt2YXIgYj10aGlzLmNvb2tpZXx8KHRoaXMuY29va2llPXRoaXMub3B0aW9ucy5jb29raWUubmFtZXx8XCJ1aS10YWJzLVwiK3coKSk7cmV0dXJuIGQuY29va2llLmFwcGx5KG51bGwsW2JdLmNvbmNhdChkLm1ha2VBcnJheShhcmd1bWVudHMpKSl9LF91aTpmdW5jdGlvbihiLGUpe3JldHVybnt0YWI6YixwYW5lbDplLGluZGV4OnRoaXMuYW5jaG9ycy5pbmRleChiKX19LF9jbGVhbnVwOmZ1bmN0aW9uKCl7dGhpcy5saXMuZmlsdGVyKFwiLnVpLXN0YXRlLXByb2Nlc3NpbmdcIikucmVtb3ZlQ2xhc3MoXCJ1aS1zdGF0ZS1wcm9jZXNzaW5nXCIpLmZpbmQoXCJzcGFuOmRhdGEobGFiZWwudGFicylcIikuZWFjaChmdW5jdGlvbigpe3ZhciBiPVxuZCh0aGlzKTtiLmh0bWwoYi5kYXRhKFwibGFiZWwudGFic1wiKSkucmVtb3ZlRGF0YShcImxhYmVsLnRhYnNcIil9KX0sX3RhYmlmeTpmdW5jdGlvbihiKXtmdW5jdGlvbiBlKGcsZil7Zy5jc3MoXCJkaXNwbGF5XCIsXCJcIik7IWQuc3VwcG9ydC5vcGFjaXR5JiZmLm9wYWNpdHkmJmdbMF0uc3R5bGUucmVtb3ZlQXR0cmlidXRlKFwiZmlsdGVyXCIpfXZhciBhPXRoaXMsYz10aGlzLm9wdGlvbnMsaD0vXiMuKy87dGhpcy5saXN0PXRoaXMuZWxlbWVudC5maW5kKFwib2wsdWxcIikuZXEoMCk7dGhpcy5saXM9ZChcIiA+IGxpOmhhcyhhW2hyZWZdKVwiLHRoaXMubGlzdCk7dGhpcy5hbmNob3JzPXRoaXMubGlzLm1hcChmdW5jdGlvbigpe3JldHVybiBkKFwiYVwiLHRoaXMpWzBdfSk7dGhpcy5wYW5lbHM9ZChbXSk7dGhpcy5hbmNob3JzLmVhY2goZnVuY3Rpb24oZyxmKXt2YXIgaT1kKGYpLmF0dHIoXCJocmVmXCIpLGw9aS5zcGxpdChcIiNcIilbMF0scTtpZihsJiYobD09PWxvY2F0aW9uLnRvU3RyaW5nKCkuc3BsaXQoXCIjXCIpWzBdfHxcbihxPWQoXCJiYXNlXCIpWzBdKSYmbD09PXEuaHJlZikpe2k9Zi5oYXNoO2YuaHJlZj1pfWlmKGgudGVzdChpKSlhLnBhbmVscz1hLnBhbmVscy5hZGQoYS5lbGVtZW50LmZpbmQoYS5fc2FuaXRpemVTZWxlY3RvcihpKSkpO2Vsc2UgaWYoaSYmaSE9PVwiI1wiKXtkLmRhdGEoZixcImhyZWYudGFic1wiLGkpO2QuZGF0YShmLFwibG9hZC50YWJzXCIsaS5yZXBsYWNlKC8jLiokLyxcIlwiKSk7aT1hLl90YWJJZChmKTtmLmhyZWY9XCIjXCIraTtmPWEuZWxlbWVudC5maW5kKFwiI1wiK2kpO2lmKCFmLmxlbmd0aCl7Zj1kKGMucGFuZWxUZW1wbGF0ZSkuYXR0cihcImlkXCIsaSkuYWRkQ2xhc3MoXCJ1aS10YWJzLXBhbmVsIHVpLXdpZGdldC1jb250ZW50IHVpLWNvcm5lci1ib3R0b21cIikuaW5zZXJ0QWZ0ZXIoYS5wYW5lbHNbZy0xXXx8YS5saXN0KTtmLmRhdGEoXCJkZXN0cm95LnRhYnNcIix0cnVlKX1hLnBhbmVscz1hLnBhbmVscy5hZGQoZil9ZWxzZSBjLmRpc2FibGVkLnB1c2goZyl9KTtpZihiKXt0aGlzLmVsZW1lbnQuYWRkQ2xhc3MoXCJ1aS10YWJzIHVpLXdpZGdldCB1aS13aWRnZXQtY29udGVudCB1aS1jb3JuZXItYWxsXCIpO1xudGhpcy5saXN0LmFkZENsYXNzKFwidWktdGFicy1uYXYgdWktaGVscGVyLXJlc2V0IHVpLWhlbHBlci1jbGVhcmZpeCB1aS13aWRnZXQtaGVhZGVyIHVpLWNvcm5lci1hbGxcIik7dGhpcy5saXMuYWRkQ2xhc3MoXCJ1aS1zdGF0ZS1kZWZhdWx0IHVpLWNvcm5lci10b3BcIik7dGhpcy5wYW5lbHMuYWRkQ2xhc3MoXCJ1aS10YWJzLXBhbmVsIHVpLXdpZGdldC1jb250ZW50IHVpLWNvcm5lci1ib3R0b21cIik7aWYoYy5zZWxlY3RlZD09PXApe2xvY2F0aW9uLmhhc2gmJnRoaXMuYW5jaG9ycy5lYWNoKGZ1bmN0aW9uKGcsZil7aWYoZi5oYXNoPT1sb2NhdGlvbi5oYXNoKXtjLnNlbGVjdGVkPWc7cmV0dXJuIGZhbHNlfX0pO2lmKHR5cGVvZiBjLnNlbGVjdGVkIT09XCJudW1iZXJcIiYmYy5jb29raWUpYy5zZWxlY3RlZD1wYXJzZUludChhLl9jb29raWUoKSwxMCk7aWYodHlwZW9mIGMuc2VsZWN0ZWQhPT1cIm51bWJlclwiJiZ0aGlzLmxpcy5maWx0ZXIoXCIudWktdGFicy1zZWxlY3RlZFwiKS5sZW5ndGgpYy5zZWxlY3RlZD1cbnRoaXMubGlzLmluZGV4KHRoaXMubGlzLmZpbHRlcihcIi51aS10YWJzLXNlbGVjdGVkXCIpKTtjLnNlbGVjdGVkPWMuc2VsZWN0ZWR8fCh0aGlzLmxpcy5sZW5ndGg/MDotMSl9ZWxzZSBpZihjLnNlbGVjdGVkPT09bnVsbCljLnNlbGVjdGVkPS0xO2Muc2VsZWN0ZWQ9Yy5zZWxlY3RlZD49MCYmdGhpcy5hbmNob3JzW2Muc2VsZWN0ZWRdfHxjLnNlbGVjdGVkPDA/Yy5zZWxlY3RlZDowO2MuZGlzYWJsZWQ9ZC51bmlxdWUoYy5kaXNhYmxlZC5jb25jYXQoZC5tYXAodGhpcy5saXMuZmlsdGVyKFwiLnVpLXN0YXRlLWRpc2FibGVkXCIpLGZ1bmN0aW9uKGcpe3JldHVybiBhLmxpcy5pbmRleChnKX0pKSkuc29ydCgpO2QuaW5BcnJheShjLnNlbGVjdGVkLGMuZGlzYWJsZWQpIT0tMSYmYy5kaXNhYmxlZC5zcGxpY2UoZC5pbkFycmF5KGMuc2VsZWN0ZWQsYy5kaXNhYmxlZCksMSk7dGhpcy5wYW5lbHMuYWRkQ2xhc3MoXCJ1aS10YWJzLWhpZGVcIik7dGhpcy5saXMucmVtb3ZlQ2xhc3MoXCJ1aS10YWJzLXNlbGVjdGVkIHVpLXN0YXRlLWFjdGl2ZVwiKTtcbmlmKGMuc2VsZWN0ZWQ+PTAmJnRoaXMuYW5jaG9ycy5sZW5ndGgpe2EuZWxlbWVudC5maW5kKGEuX3Nhbml0aXplU2VsZWN0b3IoYS5hbmNob3JzW2Muc2VsZWN0ZWRdLmhhc2gpKS5yZW1vdmVDbGFzcyhcInVpLXRhYnMtaGlkZVwiKTt0aGlzLmxpcy5lcShjLnNlbGVjdGVkKS5hZGRDbGFzcyhcInVpLXRhYnMtc2VsZWN0ZWQgdWktc3RhdGUtYWN0aXZlXCIpO2EuZWxlbWVudC5xdWV1ZShcInRhYnNcIixmdW5jdGlvbigpe2EuX3RyaWdnZXIoXCJzaG93XCIsbnVsbCxhLl91aShhLmFuY2hvcnNbYy5zZWxlY3RlZF0sYS5lbGVtZW50LmZpbmQoYS5fc2FuaXRpemVTZWxlY3RvcihhLmFuY2hvcnNbYy5zZWxlY3RlZF0uaGFzaCkpWzBdKSl9KTt0aGlzLmxvYWQoYy5zZWxlY3RlZCl9ZCh3aW5kb3cpLmJpbmQoXCJ1bmxvYWRcIixmdW5jdGlvbigpe2EubGlzLmFkZChhLmFuY2hvcnMpLnVuYmluZChcIi50YWJzXCIpO2EubGlzPWEuYW5jaG9ycz1hLnBhbmVscz1udWxsfSl9ZWxzZSBjLnNlbGVjdGVkPXRoaXMubGlzLmluZGV4KHRoaXMubGlzLmZpbHRlcihcIi51aS10YWJzLXNlbGVjdGVkXCIpKTtcbnRoaXMuZWxlbWVudFtjLmNvbGxhcHNpYmxlP1wiYWRkQ2xhc3NcIjpcInJlbW92ZUNsYXNzXCJdKFwidWktdGFicy1jb2xsYXBzaWJsZVwiKTtjLmNvb2tpZSYmdGhpcy5fY29va2llKGMuc2VsZWN0ZWQsYy5jb29raWUpO2I9MDtmb3IodmFyIGo7aj10aGlzLmxpc1tiXTtiKyspZChqKVtkLmluQXJyYXkoYixjLmRpc2FibGVkKSE9LTEmJiFkKGopLmhhc0NsYXNzKFwidWktdGFicy1zZWxlY3RlZFwiKT9cImFkZENsYXNzXCI6XCJyZW1vdmVDbGFzc1wiXShcInVpLXN0YXRlLWRpc2FibGVkXCIpO2MuY2FjaGU9PT1mYWxzZSYmdGhpcy5hbmNob3JzLnJlbW92ZURhdGEoXCJjYWNoZS50YWJzXCIpO3RoaXMubGlzLmFkZCh0aGlzLmFuY2hvcnMpLnVuYmluZChcIi50YWJzXCIpO2lmKGMuZXZlbnQhPT1cIm1vdXNlb3ZlclwiKXt2YXIgaz1mdW5jdGlvbihnLGYpe2YuaXMoXCI6bm90KC51aS1zdGF0ZS1kaXNhYmxlZClcIikmJmYuYWRkQ2xhc3MoXCJ1aS1zdGF0ZS1cIitnKX0sbj1mdW5jdGlvbihnLGYpe2YucmVtb3ZlQ2xhc3MoXCJ1aS1zdGF0ZS1cIitcbmcpfTt0aGlzLmxpcy5iaW5kKFwibW91c2VvdmVyLnRhYnNcIixmdW5jdGlvbigpe2soXCJob3ZlclwiLGQodGhpcykpfSk7dGhpcy5saXMuYmluZChcIm1vdXNlb3V0LnRhYnNcIixmdW5jdGlvbigpe24oXCJob3ZlclwiLGQodGhpcykpfSk7dGhpcy5hbmNob3JzLmJpbmQoXCJmb2N1cy50YWJzXCIsZnVuY3Rpb24oKXtrKFwiZm9jdXNcIixkKHRoaXMpLmNsb3Nlc3QoXCJsaVwiKSl9KTt0aGlzLmFuY2hvcnMuYmluZChcImJsdXIudGFic1wiLGZ1bmN0aW9uKCl7bihcImZvY3VzXCIsZCh0aGlzKS5jbG9zZXN0KFwibGlcIikpfSl9dmFyIG0sbztpZihjLmZ4KWlmKGQuaXNBcnJheShjLmZ4KSl7bT1jLmZ4WzBdO289Yy5meFsxXX1lbHNlIG09bz1jLmZ4O3ZhciByPW8/ZnVuY3Rpb24oZyxmKXtkKGcpLmNsb3Nlc3QoXCJsaVwiKS5hZGRDbGFzcyhcInVpLXRhYnMtc2VsZWN0ZWQgdWktc3RhdGUtYWN0aXZlXCIpO2YuaGlkZSgpLnJlbW92ZUNsYXNzKFwidWktdGFicy1oaWRlXCIpLmFuaW1hdGUobyxvLmR1cmF0aW9ufHxcIm5vcm1hbFwiLFxuZnVuY3Rpb24oKXtlKGYsbyk7YS5fdHJpZ2dlcihcInNob3dcIixudWxsLGEuX3VpKGcsZlswXSkpfSl9OmZ1bmN0aW9uKGcsZil7ZChnKS5jbG9zZXN0KFwibGlcIikuYWRkQ2xhc3MoXCJ1aS10YWJzLXNlbGVjdGVkIHVpLXN0YXRlLWFjdGl2ZVwiKTtmLnJlbW92ZUNsYXNzKFwidWktdGFicy1oaWRlXCIpO2EuX3RyaWdnZXIoXCJzaG93XCIsbnVsbCxhLl91aShnLGZbMF0pKX0scz1tP2Z1bmN0aW9uKGcsZil7Zi5hbmltYXRlKG0sbS5kdXJhdGlvbnx8XCJub3JtYWxcIixmdW5jdGlvbigpe2EubGlzLnJlbW92ZUNsYXNzKFwidWktdGFicy1zZWxlY3RlZCB1aS1zdGF0ZS1hY3RpdmVcIik7Zi5hZGRDbGFzcyhcInVpLXRhYnMtaGlkZVwiKTtlKGYsbSk7YS5lbGVtZW50LmRlcXVldWUoXCJ0YWJzXCIpfSl9OmZ1bmN0aW9uKGcsZil7YS5saXMucmVtb3ZlQ2xhc3MoXCJ1aS10YWJzLXNlbGVjdGVkIHVpLXN0YXRlLWFjdGl2ZVwiKTtmLmFkZENsYXNzKFwidWktdGFicy1oaWRlXCIpO2EuZWxlbWVudC5kZXF1ZXVlKFwidGFic1wiKX07XG50aGlzLmFuY2hvcnMuYmluZChjLmV2ZW50K1wiLnRhYnNcIixmdW5jdGlvbigpe3ZhciBnPXRoaXMsZj1kKGcpLmNsb3Nlc3QoXCJsaVwiKSxpPWEucGFuZWxzLmZpbHRlcihcIjpub3QoLnVpLXRhYnMtaGlkZSlcIiksbD1hLmVsZW1lbnQuZmluZChhLl9zYW5pdGl6ZVNlbGVjdG9yKGcuaGFzaCkpO2lmKGYuaGFzQ2xhc3MoXCJ1aS10YWJzLXNlbGVjdGVkXCIpJiYhYy5jb2xsYXBzaWJsZXx8Zi5oYXNDbGFzcyhcInVpLXN0YXRlLWRpc2FibGVkXCIpfHxmLmhhc0NsYXNzKFwidWktc3RhdGUtcHJvY2Vzc2luZ1wiKXx8YS5wYW5lbHMuZmlsdGVyKFwiOmFuaW1hdGVkXCIpLmxlbmd0aHx8YS5fdHJpZ2dlcihcInNlbGVjdFwiLG51bGwsYS5fdWkodGhpcyxsWzBdKSk9PT1mYWxzZSl7dGhpcy5ibHVyKCk7cmV0dXJuIGZhbHNlfWMuc2VsZWN0ZWQ9YS5hbmNob3JzLmluZGV4KHRoaXMpO2EuYWJvcnQoKTtpZihjLmNvbGxhcHNpYmxlKWlmKGYuaGFzQ2xhc3MoXCJ1aS10YWJzLXNlbGVjdGVkXCIpKXtjLnNlbGVjdGVkPVxuLTE7Yy5jb29raWUmJmEuX2Nvb2tpZShjLnNlbGVjdGVkLGMuY29va2llKTthLmVsZW1lbnQucXVldWUoXCJ0YWJzXCIsZnVuY3Rpb24oKXtzKGcsaSl9KS5kZXF1ZXVlKFwidGFic1wiKTt0aGlzLmJsdXIoKTtyZXR1cm4gZmFsc2V9ZWxzZSBpZighaS5sZW5ndGgpe2MuY29va2llJiZhLl9jb29raWUoYy5zZWxlY3RlZCxjLmNvb2tpZSk7YS5lbGVtZW50LnF1ZXVlKFwidGFic1wiLGZ1bmN0aW9uKCl7cihnLGwpfSk7YS5sb2FkKGEuYW5jaG9ycy5pbmRleCh0aGlzKSk7dGhpcy5ibHVyKCk7cmV0dXJuIGZhbHNlfWMuY29va2llJiZhLl9jb29raWUoYy5zZWxlY3RlZCxjLmNvb2tpZSk7aWYobC5sZW5ndGgpe2kubGVuZ3RoJiZhLmVsZW1lbnQucXVldWUoXCJ0YWJzXCIsZnVuY3Rpb24oKXtzKGcsaSl9KTthLmVsZW1lbnQucXVldWUoXCJ0YWJzXCIsZnVuY3Rpb24oKXtyKGcsbCl9KTthLmxvYWQoYS5hbmNob3JzLmluZGV4KHRoaXMpKX1lbHNlIHRocm93XCJqUXVlcnkgVUkgVGFiczogTWlzbWF0Y2hpbmcgZnJhZ21lbnQgaWRlbnRpZmllci5cIjtcbmQuYnJvd3Nlci5tc2llJiZ0aGlzLmJsdXIoKX0pO3RoaXMuYW5jaG9ycy5iaW5kKFwiY2xpY2sudGFic1wiLGZ1bmN0aW9uKCl7cmV0dXJuIGZhbHNlfSl9LF9nZXRJbmRleDpmdW5jdGlvbihiKXtpZih0eXBlb2YgYj09XCJzdHJpbmdcIiliPXRoaXMuYW5jaG9ycy5pbmRleCh0aGlzLmFuY2hvcnMuZmlsdGVyKFwiW2hyZWYkPVwiK2IrXCJdXCIpKTtyZXR1cm4gYn0sZGVzdHJveTpmdW5jdGlvbigpe3ZhciBiPXRoaXMub3B0aW9uczt0aGlzLmFib3J0KCk7dGhpcy5lbGVtZW50LnVuYmluZChcIi50YWJzXCIpLnJlbW92ZUNsYXNzKFwidWktdGFicyB1aS13aWRnZXQgdWktd2lkZ2V0LWNvbnRlbnQgdWktY29ybmVyLWFsbCB1aS10YWJzLWNvbGxhcHNpYmxlXCIpLnJlbW92ZURhdGEoXCJ0YWJzXCIpO3RoaXMubGlzdC5yZW1vdmVDbGFzcyhcInVpLXRhYnMtbmF2IHVpLWhlbHBlci1yZXNldCB1aS1oZWxwZXItY2xlYXJmaXggdWktd2lkZ2V0LWhlYWRlciB1aS1jb3JuZXItYWxsXCIpO3RoaXMuYW5jaG9ycy5lYWNoKGZ1bmN0aW9uKCl7dmFyIGU9XG5kLmRhdGEodGhpcyxcImhyZWYudGFic1wiKTtpZihlKXRoaXMuaHJlZj1lO3ZhciBhPWQodGhpcykudW5iaW5kKFwiLnRhYnNcIik7ZC5lYWNoKFtcImhyZWZcIixcImxvYWRcIixcImNhY2hlXCJdLGZ1bmN0aW9uKGMsaCl7YS5yZW1vdmVEYXRhKGgrXCIudGFic1wiKX0pfSk7dGhpcy5saXMudW5iaW5kKFwiLnRhYnNcIikuYWRkKHRoaXMucGFuZWxzKS5lYWNoKGZ1bmN0aW9uKCl7ZC5kYXRhKHRoaXMsXCJkZXN0cm95LnRhYnNcIik/ZCh0aGlzKS5yZW1vdmUoKTpkKHRoaXMpLnJlbW92ZUNsYXNzKFwidWktc3RhdGUtZGVmYXVsdCB1aS1jb3JuZXItdG9wIHVpLXRhYnMtc2VsZWN0ZWQgdWktc3RhdGUtYWN0aXZlIHVpLXN0YXRlLWhvdmVyIHVpLXN0YXRlLWZvY3VzIHVpLXN0YXRlLWRpc2FibGVkIHVpLXRhYnMtcGFuZWwgdWktd2lkZ2V0LWNvbnRlbnQgdWktY29ybmVyLWJvdHRvbSB1aS10YWJzLWhpZGVcIil9KTtiLmNvb2tpZSYmdGhpcy5fY29va2llKG51bGwsYi5jb29raWUpO3JldHVybiB0aGlzfSxhZGQ6ZnVuY3Rpb24oYixcbmUsYSl7aWYoYT09PXApYT10aGlzLmFuY2hvcnMubGVuZ3RoO3ZhciBjPXRoaXMsaD10aGlzLm9wdGlvbnM7ZT1kKGgudGFiVGVtcGxhdGUucmVwbGFjZSgvI1xce2hyZWZcXH0vZyxiKS5yZXBsYWNlKC8jXFx7bGFiZWxcXH0vZyxlKSk7Yj0hYi5pbmRleE9mKFwiI1wiKT9iLnJlcGxhY2UoXCIjXCIsXCJcIik6dGhpcy5fdGFiSWQoZChcImFcIixlKVswXSk7ZS5hZGRDbGFzcyhcInVpLXN0YXRlLWRlZmF1bHQgdWktY29ybmVyLXRvcFwiKS5kYXRhKFwiZGVzdHJveS50YWJzXCIsdHJ1ZSk7dmFyIGo9Yy5lbGVtZW50LmZpbmQoXCIjXCIrYik7ai5sZW5ndGh8fChqPWQoaC5wYW5lbFRlbXBsYXRlKS5hdHRyKFwiaWRcIixiKS5kYXRhKFwiZGVzdHJveS50YWJzXCIsdHJ1ZSkpO2ouYWRkQ2xhc3MoXCJ1aS10YWJzLXBhbmVsIHVpLXdpZGdldC1jb250ZW50IHVpLWNvcm5lci1ib3R0b20gdWktdGFicy1oaWRlXCIpO2lmKGE+PXRoaXMubGlzLmxlbmd0aCl7ZS5hcHBlbmRUbyh0aGlzLmxpc3QpO2ouYXBwZW5kVG8odGhpcy5saXN0WzBdLnBhcmVudE5vZGUpfWVsc2V7ZS5pbnNlcnRCZWZvcmUodGhpcy5saXNbYV0pO1xuai5pbnNlcnRCZWZvcmUodGhpcy5wYW5lbHNbYV0pfWguZGlzYWJsZWQ9ZC5tYXAoaC5kaXNhYmxlZCxmdW5jdGlvbihrKXtyZXR1cm4gaz49YT8rK2s6a30pO3RoaXMuX3RhYmlmeSgpO2lmKHRoaXMuYW5jaG9ycy5sZW5ndGg9PTEpe2guc2VsZWN0ZWQ9MDtlLmFkZENsYXNzKFwidWktdGFicy1zZWxlY3RlZCB1aS1zdGF0ZS1hY3RpdmVcIik7ai5yZW1vdmVDbGFzcyhcInVpLXRhYnMtaGlkZVwiKTt0aGlzLmVsZW1lbnQucXVldWUoXCJ0YWJzXCIsZnVuY3Rpb24oKXtjLl90cmlnZ2VyKFwic2hvd1wiLG51bGwsYy5fdWkoYy5hbmNob3JzWzBdLGMucGFuZWxzWzBdKSl9KTt0aGlzLmxvYWQoMCl9dGhpcy5fdHJpZ2dlcihcImFkZFwiLG51bGwsdGhpcy5fdWkodGhpcy5hbmNob3JzW2FdLHRoaXMucGFuZWxzW2FdKSk7cmV0dXJuIHRoaXN9LHJlbW92ZTpmdW5jdGlvbihiKXtiPXRoaXMuX2dldEluZGV4KGIpO3ZhciBlPXRoaXMub3B0aW9ucyxhPXRoaXMubGlzLmVxKGIpLnJlbW92ZSgpLGM9dGhpcy5wYW5lbHMuZXEoYikucmVtb3ZlKCk7XG5pZihhLmhhc0NsYXNzKFwidWktdGFicy1zZWxlY3RlZFwiKSYmdGhpcy5hbmNob3JzLmxlbmd0aD4xKXRoaXMuc2VsZWN0KGIrKGIrMTx0aGlzLmFuY2hvcnMubGVuZ3RoPzE6LTEpKTtlLmRpc2FibGVkPWQubWFwKGQuZ3JlcChlLmRpc2FibGVkLGZ1bmN0aW9uKGgpe3JldHVybiBoIT1ifSksZnVuY3Rpb24oaCl7cmV0dXJuIGg+PWI/LS1oOmh9KTt0aGlzLl90YWJpZnkoKTt0aGlzLl90cmlnZ2VyKFwicmVtb3ZlXCIsbnVsbCx0aGlzLl91aShhLmZpbmQoXCJhXCIpWzBdLGNbMF0pKTtyZXR1cm4gdGhpc30sZW5hYmxlOmZ1bmN0aW9uKGIpe2I9dGhpcy5fZ2V0SW5kZXgoYik7dmFyIGU9dGhpcy5vcHRpb25zO2lmKGQuaW5BcnJheShiLGUuZGlzYWJsZWQpIT0tMSl7dGhpcy5saXMuZXEoYikucmVtb3ZlQ2xhc3MoXCJ1aS1zdGF0ZS1kaXNhYmxlZFwiKTtlLmRpc2FibGVkPWQuZ3JlcChlLmRpc2FibGVkLGZ1bmN0aW9uKGEpe3JldHVybiBhIT1ifSk7dGhpcy5fdHJpZ2dlcihcImVuYWJsZVwiLG51bGwsXG50aGlzLl91aSh0aGlzLmFuY2hvcnNbYl0sdGhpcy5wYW5lbHNbYl0pKTtyZXR1cm4gdGhpc319LGRpc2FibGU6ZnVuY3Rpb24oYil7Yj10aGlzLl9nZXRJbmRleChiKTt2YXIgZT10aGlzLm9wdGlvbnM7aWYoYiE9ZS5zZWxlY3RlZCl7dGhpcy5saXMuZXEoYikuYWRkQ2xhc3MoXCJ1aS1zdGF0ZS1kaXNhYmxlZFwiKTtlLmRpc2FibGVkLnB1c2goYik7ZS5kaXNhYmxlZC5zb3J0KCk7dGhpcy5fdHJpZ2dlcihcImRpc2FibGVcIixudWxsLHRoaXMuX3VpKHRoaXMuYW5jaG9yc1tiXSx0aGlzLnBhbmVsc1tiXSkpfXJldHVybiB0aGlzfSxzZWxlY3Q6ZnVuY3Rpb24oYil7Yj10aGlzLl9nZXRJbmRleChiKTtpZihiPT0tMSlpZih0aGlzLm9wdGlvbnMuY29sbGFwc2libGUmJnRoaXMub3B0aW9ucy5zZWxlY3RlZCE9LTEpYj10aGlzLm9wdGlvbnMuc2VsZWN0ZWQ7ZWxzZSByZXR1cm4gdGhpczt0aGlzLmFuY2hvcnMuZXEoYikudHJpZ2dlcih0aGlzLm9wdGlvbnMuZXZlbnQrXCIudGFic1wiKTtyZXR1cm4gdGhpc30sXG5sb2FkOmZ1bmN0aW9uKGIpe2I9dGhpcy5fZ2V0SW5kZXgoYik7dmFyIGU9dGhpcyxhPXRoaXMub3B0aW9ucyxjPXRoaXMuYW5jaG9ycy5lcShiKVswXSxoPWQuZGF0YShjLFwibG9hZC50YWJzXCIpO3RoaXMuYWJvcnQoKTtpZighaHx8dGhpcy5lbGVtZW50LnF1ZXVlKFwidGFic1wiKS5sZW5ndGghPT0wJiZkLmRhdGEoYyxcImNhY2hlLnRhYnNcIikpdGhpcy5lbGVtZW50LmRlcXVldWUoXCJ0YWJzXCIpO2Vsc2V7dGhpcy5saXMuZXEoYikuYWRkQ2xhc3MoXCJ1aS1zdGF0ZS1wcm9jZXNzaW5nXCIpO2lmKGEuc3Bpbm5lcil7dmFyIGo9ZChcInNwYW5cIixjKTtqLmRhdGEoXCJsYWJlbC50YWJzXCIsai5odG1sKCkpLmh0bWwoYS5zcGlubmVyKX10aGlzLnhocj1kLmFqYXgoZC5leHRlbmQoe30sYS5hamF4T3B0aW9ucyx7dXJsOmgsc3VjY2VzczpmdW5jdGlvbihrLG4pe2UuZWxlbWVudC5maW5kKGUuX3Nhbml0aXplU2VsZWN0b3IoYy5oYXNoKSkuaHRtbChrKTtlLl9jbGVhbnVwKCk7YS5jYWNoZSYmZC5kYXRhKGMsXG5cImNhY2hlLnRhYnNcIix0cnVlKTtlLl90cmlnZ2VyKFwibG9hZFwiLG51bGwsZS5fdWkoZS5hbmNob3JzW2JdLGUucGFuZWxzW2JdKSk7dHJ5e2EuYWpheE9wdGlvbnMuc3VjY2VzcyhrLG4pfWNhdGNoKG0pe319LGVycm9yOmZ1bmN0aW9uKGssbil7ZS5fY2xlYW51cCgpO2UuX3RyaWdnZXIoXCJsb2FkXCIsbnVsbCxlLl91aShlLmFuY2hvcnNbYl0sZS5wYW5lbHNbYl0pKTt0cnl7YS5hamF4T3B0aW9ucy5lcnJvcihrLG4sYixjKX1jYXRjaChtKXt9fX0pKTtlLmVsZW1lbnQuZGVxdWV1ZShcInRhYnNcIik7cmV0dXJuIHRoaXN9fSxhYm9ydDpmdW5jdGlvbigpe3RoaXMuZWxlbWVudC5xdWV1ZShbXSk7dGhpcy5wYW5lbHMuc3RvcChmYWxzZSx0cnVlKTt0aGlzLmVsZW1lbnQucXVldWUoXCJ0YWJzXCIsdGhpcy5lbGVtZW50LnF1ZXVlKFwidGFic1wiKS5zcGxpY2UoLTIsMikpO2lmKHRoaXMueGhyKXt0aGlzLnhoci5hYm9ydCgpO2RlbGV0ZSB0aGlzLnhocn10aGlzLl9jbGVhbnVwKCk7cmV0dXJuIHRoaXN9LFxudXJsOmZ1bmN0aW9uKGIsZSl7dGhpcy5hbmNob3JzLmVxKGIpLnJlbW92ZURhdGEoXCJjYWNoZS50YWJzXCIpLmRhdGEoXCJsb2FkLnRhYnNcIixlKTtyZXR1cm4gdGhpc30sbGVuZ3RoOmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuYW5jaG9ycy5sZW5ndGh9fSk7ZC5leHRlbmQoZC51aS50YWJzLHt2ZXJzaW9uOlwiMS44LjE2XCJ9KTtkLmV4dGVuZChkLnVpLnRhYnMucHJvdG90eXBlLHtyb3RhdGlvbjpudWxsLHJvdGF0ZTpmdW5jdGlvbihiLGUpe3ZhciBhPXRoaXMsYz10aGlzLm9wdGlvbnMsaD1hLl9yb3RhdGV8fChhLl9yb3RhdGU9ZnVuY3Rpb24oail7Y2xlYXJUaW1lb3V0KGEucm90YXRpb24pO2Eucm90YXRpb249c2V0VGltZW91dChmdW5jdGlvbigpe3ZhciBrPWMuc2VsZWN0ZWQ7YS5zZWxlY3QoKytrPGEuYW5jaG9ycy5sZW5ndGg/azowKX0sYik7aiYmai5zdG9wUHJvcGFnYXRpb24oKX0pO2U9YS5fdW5yb3RhdGV8fChhLl91bnJvdGF0ZT0hZT9mdW5jdGlvbihqKXtqLmNsaWVudFgmJlxuYS5yb3RhdGUobnVsbCl9OmZ1bmN0aW9uKCl7dD1jLnNlbGVjdGVkO2goKX0pO2lmKGIpe3RoaXMuZWxlbWVudC5iaW5kKFwidGFic3Nob3dcIixoKTt0aGlzLmFuY2hvcnMuYmluZChjLmV2ZW50K1wiLnRhYnNcIixlKTtoKCl9ZWxzZXtjbGVhclRpbWVvdXQoYS5yb3RhdGlvbik7dGhpcy5lbGVtZW50LnVuYmluZChcInRhYnNzaG93XCIsaCk7dGhpcy5hbmNob3JzLnVuYmluZChjLmV2ZW50K1wiLnRhYnNcIixlKTtkZWxldGUgdGhpcy5fcm90YXRlO2RlbGV0ZSB0aGlzLl91bnJvdGF0ZX1yZXR1cm4gdGhpc319KX0pKGpRdWVyeSk7XG47LypcbiAqIGpRdWVyeSBVSSBEYXRlcGlja2VyIDEuOC4xNlxuICpcbiAqIENvcHlyaWdodCAyMDExLCBBVVRIT1JTLnR4dCAoaHR0cDovL2pxdWVyeXVpLmNvbS9hYm91dClcbiAqIER1YWwgbGljZW5zZWQgdW5kZXIgdGhlIE1JVCBvciBHUEwgVmVyc2lvbiAyIGxpY2Vuc2VzLlxuICogaHR0cDovL2pxdWVyeS5vcmcvbGljZW5zZVxuICpcbiAqIGh0dHA6Ly9kb2NzLmpxdWVyeS5jb20vVUkvRGF0ZXBpY2tlclxuICpcbiAqIERlcGVuZHM6XG4gKlx0anF1ZXJ5LnVpLmNvcmUuanNcbiAqL1xuKGZ1bmN0aW9uKGQsQyl7ZnVuY3Rpb24gTSgpe3RoaXMuZGVidWc9ZmFsc2U7dGhpcy5fY3VySW5zdD1udWxsO3RoaXMuX2tleUV2ZW50PWZhbHNlO3RoaXMuX2Rpc2FibGVkSW5wdXRzPVtdO3RoaXMuX2luRGlhbG9nPXRoaXMuX2RhdGVwaWNrZXJTaG93aW5nPWZhbHNlO3RoaXMuX21haW5EaXZJZD1cInVpLWRhdGVwaWNrZXItZGl2XCI7dGhpcy5faW5saW5lQ2xhc3M9XCJ1aS1kYXRlcGlja2VyLWlubGluZVwiO3RoaXMuX2FwcGVuZENsYXNzPVwidWktZGF0ZXBpY2tlci1hcHBlbmRcIjt0aGlzLl90cmlnZ2VyQ2xhc3M9XCJ1aS1kYXRlcGlja2VyLXRyaWdnZXJcIjt0aGlzLl9kaWFsb2dDbGFzcz1cInVpLWRhdGVwaWNrZXItZGlhbG9nXCI7dGhpcy5fZGlzYWJsZUNsYXNzPVwidWktZGF0ZXBpY2tlci1kaXNhYmxlZFwiO3RoaXMuX3Vuc2VsZWN0YWJsZUNsYXNzPVwidWktZGF0ZXBpY2tlci11bnNlbGVjdGFibGVcIjt0aGlzLl9jdXJyZW50Q2xhc3M9XCJ1aS1kYXRlcGlja2VyLWN1cnJlbnQtZGF5XCI7dGhpcy5fZGF5T3ZlckNsYXNzPVxuXCJ1aS1kYXRlcGlja2VyLWRheXMtY2VsbC1vdmVyXCI7dGhpcy5yZWdpb25hbD1bXTt0aGlzLnJlZ2lvbmFsW1wiXCJdPXtjbG9zZVRleHQ6XCJEb25lXCIscHJldlRleHQ6XCJQcmV2XCIsbmV4dFRleHQ6XCJOZXh0XCIsY3VycmVudFRleHQ6XCJUb2RheVwiLG1vbnRoTmFtZXM6W1wiSmFudWFyeVwiLFwiRmVicnVhcnlcIixcIk1hcmNoXCIsXCJBcHJpbFwiLFwiTWF5XCIsXCJKdW5lXCIsXCJKdWx5XCIsXCJBdWd1c3RcIixcIlNlcHRlbWJlclwiLFwiT2N0b2JlclwiLFwiTm92ZW1iZXJcIixcIkRlY2VtYmVyXCJdLG1vbnRoTmFtZXNTaG9ydDpbXCJKYW5cIixcIkZlYlwiLFwiTWFyXCIsXCJBcHJcIixcIk1heVwiLFwiSnVuXCIsXCJKdWxcIixcIkF1Z1wiLFwiU2VwXCIsXCJPY3RcIixcIk5vdlwiLFwiRGVjXCJdLGRheU5hbWVzOltcIlN1bmRheVwiLFwiTW9uZGF5XCIsXCJUdWVzZGF5XCIsXCJXZWRuZXNkYXlcIixcIlRodXJzZGF5XCIsXCJGcmlkYXlcIixcIlNhdHVyZGF5XCJdLGRheU5hbWVzU2hvcnQ6W1wiU3VuXCIsXCJNb25cIixcIlR1ZVwiLFwiV2VkXCIsXCJUaHVcIixcIkZyaVwiLFwiU2F0XCJdLGRheU5hbWVzTWluOltcIlN1XCIsXG5cIk1vXCIsXCJUdVwiLFwiV2VcIixcIlRoXCIsXCJGclwiLFwiU2FcIl0sd2Vla0hlYWRlcjpcIldrXCIsZGF0ZUZvcm1hdDpcIm1tL2RkL3l5XCIsZmlyc3REYXk6MCxpc1JUTDpmYWxzZSxzaG93TW9udGhBZnRlclllYXI6ZmFsc2UseWVhclN1ZmZpeDpcIlwifTt0aGlzLl9kZWZhdWx0cz17c2hvd09uOlwiZm9jdXNcIixzaG93QW5pbTpcImZhZGVJblwiLHNob3dPcHRpb25zOnt9LGRlZmF1bHREYXRlOm51bGwsYXBwZW5kVGV4dDpcIlwiLGJ1dHRvblRleHQ6XCIuLi5cIixidXR0b25JbWFnZTpcIlwiLGJ1dHRvbkltYWdlT25seTpmYWxzZSxoaWRlSWZOb1ByZXZOZXh0OmZhbHNlLG5hdmlnYXRpb25Bc0RhdGVGb3JtYXQ6ZmFsc2UsZ290b0N1cnJlbnQ6ZmFsc2UsY2hhbmdlTW9udGg6ZmFsc2UsY2hhbmdlWWVhcjpmYWxzZSx5ZWFyUmFuZ2U6XCJjLTEwOmMrMTBcIixzaG93T3RoZXJNb250aHM6ZmFsc2Usc2VsZWN0T3RoZXJNb250aHM6ZmFsc2Usc2hvd1dlZWs6ZmFsc2UsY2FsY3VsYXRlV2Vlazp0aGlzLmlzbzg2MDFXZWVrLHNob3J0WWVhckN1dG9mZjpcIisxMFwiLFxubWluRGF0ZTpudWxsLG1heERhdGU6bnVsbCxkdXJhdGlvbjpcImZhc3RcIixiZWZvcmVTaG93RGF5Om51bGwsYmVmb3JlU2hvdzpudWxsLG9uU2VsZWN0Om51bGwsb25DaGFuZ2VNb250aFllYXI6bnVsbCxvbkNsb3NlOm51bGwsbnVtYmVyT2ZNb250aHM6MSxzaG93Q3VycmVudEF0UG9zOjAsc3RlcE1vbnRoczoxLHN0ZXBCaWdNb250aHM6MTIsYWx0RmllbGQ6XCJcIixhbHRGb3JtYXQ6XCJcIixjb25zdHJhaW5JbnB1dDp0cnVlLHNob3dCdXR0b25QYW5lbDpmYWxzZSxhdXRvU2l6ZTpmYWxzZSxkaXNhYmxlZDpmYWxzZX07ZC5leHRlbmQodGhpcy5fZGVmYXVsdHMsdGhpcy5yZWdpb25hbFtcIlwiXSk7dGhpcy5kcERpdj1OKGQoJzxkaXYgaWQ9XCInK3RoaXMuX21haW5EaXZJZCsnXCIgY2xhc3M9XCJ1aS1kYXRlcGlja2VyIHVpLXdpZGdldCB1aS13aWRnZXQtY29udGVudCB1aS1oZWxwZXItY2xlYXJmaXggdWktY29ybmVyLWFsbFwiPjwvZGl2PicpKX1mdW5jdGlvbiBOKGEpe3JldHVybiBhLmJpbmQoXCJtb3VzZW91dFwiLFxuZnVuY3Rpb24oYil7Yj1kKGIudGFyZ2V0KS5jbG9zZXN0KFwiYnV0dG9uLCAudWktZGF0ZXBpY2tlci1wcmV2LCAudWktZGF0ZXBpY2tlci1uZXh0LCAudWktZGF0ZXBpY2tlci1jYWxlbmRhciB0ZCBhXCIpO2IubGVuZ3RoJiZiLnJlbW92ZUNsYXNzKFwidWktc3RhdGUtaG92ZXIgdWktZGF0ZXBpY2tlci1wcmV2LWhvdmVyIHVpLWRhdGVwaWNrZXItbmV4dC1ob3ZlclwiKX0pLmJpbmQoXCJtb3VzZW92ZXJcIixmdW5jdGlvbihiKXtiPWQoYi50YXJnZXQpLmNsb3Nlc3QoXCJidXR0b24sIC51aS1kYXRlcGlja2VyLXByZXYsIC51aS1kYXRlcGlja2VyLW5leHQsIC51aS1kYXRlcGlja2VyLWNhbGVuZGFyIHRkIGFcIik7aWYoIShkLmRhdGVwaWNrZXIuX2lzRGlzYWJsZWREYXRlcGlja2VyKEouaW5saW5lP2EucGFyZW50KClbMF06Si5pbnB1dFswXSl8fCFiLmxlbmd0aCkpe2IucGFyZW50cyhcIi51aS1kYXRlcGlja2VyLWNhbGVuZGFyXCIpLmZpbmQoXCJhXCIpLnJlbW92ZUNsYXNzKFwidWktc3RhdGUtaG92ZXJcIik7XG5iLmFkZENsYXNzKFwidWktc3RhdGUtaG92ZXJcIik7Yi5oYXNDbGFzcyhcInVpLWRhdGVwaWNrZXItcHJldlwiKSYmYi5hZGRDbGFzcyhcInVpLWRhdGVwaWNrZXItcHJldi1ob3ZlclwiKTtiLmhhc0NsYXNzKFwidWktZGF0ZXBpY2tlci1uZXh0XCIpJiZiLmFkZENsYXNzKFwidWktZGF0ZXBpY2tlci1uZXh0LWhvdmVyXCIpfX0pfWZ1bmN0aW9uIEgoYSxiKXtkLmV4dGVuZChhLGIpO2Zvcih2YXIgYyBpbiBiKWlmKGJbY109PW51bGx8fGJbY109PUMpYVtjXT1iW2NdO3JldHVybiBhfWQuZXh0ZW5kKGQudWkse2RhdGVwaWNrZXI6e3ZlcnNpb246XCIxLjguMTZcIn19KTt2YXIgQj0obmV3IERhdGUpLmdldFRpbWUoKSxKO2QuZXh0ZW5kKE0ucHJvdG90eXBlLHttYXJrZXJDbGFzc05hbWU6XCJoYXNEYXRlcGlja2VyXCIsbWF4Um93czo0LGxvZzpmdW5jdGlvbigpe3RoaXMuZGVidWcmJmNvbnNvbGUubG9nLmFwcGx5KFwiXCIsYXJndW1lbnRzKX0sX3dpZGdldERhdGVwaWNrZXI6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5kcERpdn0sXG5zZXREZWZhdWx0czpmdW5jdGlvbihhKXtIKHRoaXMuX2RlZmF1bHRzLGF8fHt9KTtyZXR1cm4gdGhpc30sX2F0dGFjaERhdGVwaWNrZXI6ZnVuY3Rpb24oYSxiKXt2YXIgYz1udWxsO2Zvcih2YXIgZSBpbiB0aGlzLl9kZWZhdWx0cyl7dmFyIGY9YS5nZXRBdHRyaWJ1dGUoXCJkYXRlOlwiK2UpO2lmKGYpe2M9Y3x8e307dHJ5e2NbZV09ZXZhbChmKX1jYXRjaChoKXtjW2VdPWZ9fX1lPWEubm9kZU5hbWUudG9Mb3dlckNhc2UoKTtmPWU9PVwiZGl2XCJ8fGU9PVwic3BhblwiO2lmKCFhLmlkKXt0aGlzLnV1aWQrPTE7YS5pZD1cImRwXCIrdGhpcy51dWlkfXZhciBpPXRoaXMuX25ld0luc3QoZChhKSxmKTtpLnNldHRpbmdzPWQuZXh0ZW5kKHt9LGJ8fHt9LGN8fHt9KTtpZihlPT1cImlucHV0XCIpdGhpcy5fY29ubmVjdERhdGVwaWNrZXIoYSxpKTtlbHNlIGYmJnRoaXMuX2lubGluZURhdGVwaWNrZXIoYSxpKX0sX25ld0luc3Q6ZnVuY3Rpb24oYSxiKXtyZXR1cm57aWQ6YVswXS5pZC5yZXBsYWNlKC8oW15BLVphLXowLTlfLV0pL2csXG5cIlxcXFxcXFxcJDFcIiksaW5wdXQ6YSxzZWxlY3RlZERheTowLHNlbGVjdGVkTW9udGg6MCxzZWxlY3RlZFllYXI6MCxkcmF3TW9udGg6MCxkcmF3WWVhcjowLGlubGluZTpiLGRwRGl2OiFiP3RoaXMuZHBEaXY6TihkKCc8ZGl2IGNsYXNzPVwiJyt0aGlzLl9pbmxpbmVDbGFzcysnIHVpLWRhdGVwaWNrZXIgdWktd2lkZ2V0IHVpLXdpZGdldC1jb250ZW50IHVpLWhlbHBlci1jbGVhcmZpeCB1aS1jb3JuZXItYWxsXCI+PC9kaXY+JykpfX0sX2Nvbm5lY3REYXRlcGlja2VyOmZ1bmN0aW9uKGEsYil7dmFyIGM9ZChhKTtiLmFwcGVuZD1kKFtdKTtiLnRyaWdnZXI9ZChbXSk7aWYoIWMuaGFzQ2xhc3ModGhpcy5tYXJrZXJDbGFzc05hbWUpKXt0aGlzLl9hdHRhY2htZW50cyhjLGIpO2MuYWRkQ2xhc3ModGhpcy5tYXJrZXJDbGFzc05hbWUpLmtleWRvd24odGhpcy5fZG9LZXlEb3duKS5rZXlwcmVzcyh0aGlzLl9kb0tleVByZXNzKS5rZXl1cCh0aGlzLl9kb0tleVVwKS5iaW5kKFwic2V0RGF0YS5kYXRlcGlja2VyXCIsXG5mdW5jdGlvbihlLGYsaCl7Yi5zZXR0aW5nc1tmXT1ofSkuYmluZChcImdldERhdGEuZGF0ZXBpY2tlclwiLGZ1bmN0aW9uKGUsZil7cmV0dXJuIHRoaXMuX2dldChiLGYpfSk7dGhpcy5fYXV0b1NpemUoYik7ZC5kYXRhKGEsXCJkYXRlcGlja2VyXCIsYik7Yi5zZXR0aW5ncy5kaXNhYmxlZCYmdGhpcy5fZGlzYWJsZURhdGVwaWNrZXIoYSl9fSxfYXR0YWNobWVudHM6ZnVuY3Rpb24oYSxiKXt2YXIgYz10aGlzLl9nZXQoYixcImFwcGVuZFRleHRcIiksZT10aGlzLl9nZXQoYixcImlzUlRMXCIpO2IuYXBwZW5kJiZiLmFwcGVuZC5yZW1vdmUoKTtpZihjKXtiLmFwcGVuZD1kKCc8c3BhbiBjbGFzcz1cIicrdGhpcy5fYXBwZW5kQ2xhc3MrJ1wiPicrYytcIjwvc3Bhbj5cIik7YVtlP1wiYmVmb3JlXCI6XCJhZnRlclwiXShiLmFwcGVuZCl9YS51bmJpbmQoXCJmb2N1c1wiLHRoaXMuX3Nob3dEYXRlcGlja2VyKTtiLnRyaWdnZXImJmIudHJpZ2dlci5yZW1vdmUoKTtjPXRoaXMuX2dldChiLFwic2hvd09uXCIpO2lmKGM9PVxuXCJmb2N1c1wifHxjPT1cImJvdGhcIilhLmZvY3VzKHRoaXMuX3Nob3dEYXRlcGlja2VyKTtpZihjPT1cImJ1dHRvblwifHxjPT1cImJvdGhcIil7Yz10aGlzLl9nZXQoYixcImJ1dHRvblRleHRcIik7dmFyIGY9dGhpcy5fZ2V0KGIsXCJidXR0b25JbWFnZVwiKTtiLnRyaWdnZXI9ZCh0aGlzLl9nZXQoYixcImJ1dHRvbkltYWdlT25seVwiKT9kKFwiPGltZy8+XCIpLmFkZENsYXNzKHRoaXMuX3RyaWdnZXJDbGFzcykuYXR0cih7c3JjOmYsYWx0OmMsdGl0bGU6Y30pOmQoJzxidXR0b24gdHlwZT1cImJ1dHRvblwiPjwvYnV0dG9uPicpLmFkZENsYXNzKHRoaXMuX3RyaWdnZXJDbGFzcykuaHRtbChmPT1cIlwiP2M6ZChcIjxpbWcvPlwiKS5hdHRyKHtzcmM6ZixhbHQ6Yyx0aXRsZTpjfSkpKTthW2U/XCJiZWZvcmVcIjpcImFmdGVyXCJdKGIudHJpZ2dlcik7Yi50cmlnZ2VyLmNsaWNrKGZ1bmN0aW9uKCl7ZC5kYXRlcGlja2VyLl9kYXRlcGlja2VyU2hvd2luZyYmZC5kYXRlcGlja2VyLl9sYXN0SW5wdXQ9PWFbMF0/ZC5kYXRlcGlja2VyLl9oaWRlRGF0ZXBpY2tlcigpOlxuZC5kYXRlcGlja2VyLl9zaG93RGF0ZXBpY2tlcihhWzBdKTtyZXR1cm4gZmFsc2V9KX19LF9hdXRvU2l6ZTpmdW5jdGlvbihhKXtpZih0aGlzLl9nZXQoYSxcImF1dG9TaXplXCIpJiYhYS5pbmxpbmUpe3ZhciBiPW5ldyBEYXRlKDIwMDksMTEsMjApLGM9dGhpcy5fZ2V0KGEsXCJkYXRlRm9ybWF0XCIpO2lmKGMubWF0Y2goL1tETV0vKSl7dmFyIGU9ZnVuY3Rpb24oZil7Zm9yKHZhciBoPTAsaT0wLGc9MDtnPGYubGVuZ3RoO2crKylpZihmW2ddLmxlbmd0aD5oKXtoPWZbZ10ubGVuZ3RoO2k9Z31yZXR1cm4gaX07Yi5zZXRNb250aChlKHRoaXMuX2dldChhLGMubWF0Y2goL01NLyk/XCJtb250aE5hbWVzXCI6XCJtb250aE5hbWVzU2hvcnRcIikpKTtiLnNldERhdGUoZSh0aGlzLl9nZXQoYSxjLm1hdGNoKC9ERC8pP1wiZGF5TmFtZXNcIjpcImRheU5hbWVzU2hvcnRcIikpKzIwLWIuZ2V0RGF5KCkpfWEuaW5wdXQuYXR0cihcInNpemVcIix0aGlzLl9mb3JtYXREYXRlKGEsYikubGVuZ3RoKX19LF9pbmxpbmVEYXRlcGlja2VyOmZ1bmN0aW9uKGEsXG5iKXt2YXIgYz1kKGEpO2lmKCFjLmhhc0NsYXNzKHRoaXMubWFya2VyQ2xhc3NOYW1lKSl7Yy5hZGRDbGFzcyh0aGlzLm1hcmtlckNsYXNzTmFtZSkuYXBwZW5kKGIuZHBEaXYpLmJpbmQoXCJzZXREYXRhLmRhdGVwaWNrZXJcIixmdW5jdGlvbihlLGYsaCl7Yi5zZXR0aW5nc1tmXT1ofSkuYmluZChcImdldERhdGEuZGF0ZXBpY2tlclwiLGZ1bmN0aW9uKGUsZil7cmV0dXJuIHRoaXMuX2dldChiLGYpfSk7ZC5kYXRhKGEsXCJkYXRlcGlja2VyXCIsYik7dGhpcy5fc2V0RGF0ZShiLHRoaXMuX2dldERlZmF1bHREYXRlKGIpLHRydWUpO3RoaXMuX3VwZGF0ZURhdGVwaWNrZXIoYik7dGhpcy5fdXBkYXRlQWx0ZXJuYXRlKGIpO2Iuc2V0dGluZ3MuZGlzYWJsZWQmJnRoaXMuX2Rpc2FibGVEYXRlcGlja2VyKGEpO2IuZHBEaXYuY3NzKFwiZGlzcGxheVwiLFwiYmxvY2tcIil9fSxfZGlhbG9nRGF0ZXBpY2tlcjpmdW5jdGlvbihhLGIsYyxlLGYpe2E9dGhpcy5fZGlhbG9nSW5zdDtpZighYSl7dGhpcy51dWlkKz1cbjE7dGhpcy5fZGlhbG9nSW5wdXQ9ZCgnPGlucHV0IHR5cGU9XCJ0ZXh0XCIgaWQ9XCInKyhcImRwXCIrdGhpcy51dWlkKSsnXCIgc3R5bGU9XCJwb3NpdGlvbjogYWJzb2x1dGU7IHRvcDogLTEwMHB4OyB3aWR0aDogMHB4OyB6LWluZGV4OiAtMTA7XCIvPicpO3RoaXMuX2RpYWxvZ0lucHV0LmtleWRvd24odGhpcy5fZG9LZXlEb3duKTtkKFwiYm9keVwiKS5hcHBlbmQodGhpcy5fZGlhbG9nSW5wdXQpO2E9dGhpcy5fZGlhbG9nSW5zdD10aGlzLl9uZXdJbnN0KHRoaXMuX2RpYWxvZ0lucHV0LGZhbHNlKTthLnNldHRpbmdzPXt9O2QuZGF0YSh0aGlzLl9kaWFsb2dJbnB1dFswXSxcImRhdGVwaWNrZXJcIixhKX1IKGEuc2V0dGluZ3MsZXx8e30pO2I9YiYmYi5jb25zdHJ1Y3Rvcj09RGF0ZT90aGlzLl9mb3JtYXREYXRlKGEsYik6Yjt0aGlzLl9kaWFsb2dJbnB1dC52YWwoYik7dGhpcy5fcG9zPWY/Zi5sZW5ndGg/ZjpbZi5wYWdlWCxmLnBhZ2VZXTpudWxsO2lmKCF0aGlzLl9wb3MpdGhpcy5fcG9zPVtkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuY2xpZW50V2lkdGgvXG4yLTEwMCsoZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LnNjcm9sbExlZnR8fGRvY3VtZW50LmJvZHkuc2Nyb2xsTGVmdCksZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmNsaWVudEhlaWdodC8yLTE1MCsoZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LnNjcm9sbFRvcHx8ZG9jdW1lbnQuYm9keS5zY3JvbGxUb3ApXTt0aGlzLl9kaWFsb2dJbnB1dC5jc3MoXCJsZWZ0XCIsdGhpcy5fcG9zWzBdKzIwK1wicHhcIikuY3NzKFwidG9wXCIsdGhpcy5fcG9zWzFdK1wicHhcIik7YS5zZXR0aW5ncy5vblNlbGVjdD1jO3RoaXMuX2luRGlhbG9nPXRydWU7dGhpcy5kcERpdi5hZGRDbGFzcyh0aGlzLl9kaWFsb2dDbGFzcyk7dGhpcy5fc2hvd0RhdGVwaWNrZXIodGhpcy5fZGlhbG9nSW5wdXRbMF0pO2QuYmxvY2tVSSYmZC5ibG9ja1VJKHRoaXMuZHBEaXYpO2QuZGF0YSh0aGlzLl9kaWFsb2dJbnB1dFswXSxcImRhdGVwaWNrZXJcIixhKTtyZXR1cm4gdGhpc30sX2Rlc3Ryb3lEYXRlcGlja2VyOmZ1bmN0aW9uKGEpe3ZhciBiPVxuZChhKSxjPWQuZGF0YShhLFwiZGF0ZXBpY2tlclwiKTtpZihiLmhhc0NsYXNzKHRoaXMubWFya2VyQ2xhc3NOYW1lKSl7dmFyIGU9YS5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpO2QucmVtb3ZlRGF0YShhLFwiZGF0ZXBpY2tlclwiKTtpZihlPT1cImlucHV0XCIpe2MuYXBwZW5kLnJlbW92ZSgpO2MudHJpZ2dlci5yZW1vdmUoKTtiLnJlbW92ZUNsYXNzKHRoaXMubWFya2VyQ2xhc3NOYW1lKS51bmJpbmQoXCJmb2N1c1wiLHRoaXMuX3Nob3dEYXRlcGlja2VyKS51bmJpbmQoXCJrZXlkb3duXCIsdGhpcy5fZG9LZXlEb3duKS51bmJpbmQoXCJrZXlwcmVzc1wiLHRoaXMuX2RvS2V5UHJlc3MpLnVuYmluZChcImtleXVwXCIsdGhpcy5fZG9LZXlVcCl9ZWxzZSBpZihlPT1cImRpdlwifHxlPT1cInNwYW5cIiliLnJlbW92ZUNsYXNzKHRoaXMubWFya2VyQ2xhc3NOYW1lKS5lbXB0eSgpfX0sX2VuYWJsZURhdGVwaWNrZXI6ZnVuY3Rpb24oYSl7dmFyIGI9ZChhKSxjPWQuZGF0YShhLFwiZGF0ZXBpY2tlclwiKTtpZihiLmhhc0NsYXNzKHRoaXMubWFya2VyQ2xhc3NOYW1lKSl7dmFyIGU9XG5hLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCk7aWYoZT09XCJpbnB1dFwiKXthLmRpc2FibGVkPWZhbHNlO2MudHJpZ2dlci5maWx0ZXIoXCJidXR0b25cIikuZWFjaChmdW5jdGlvbigpe3RoaXMuZGlzYWJsZWQ9ZmFsc2V9KS5lbmQoKS5maWx0ZXIoXCJpbWdcIikuY3NzKHtvcGFjaXR5OlwiMS4wXCIsY3Vyc29yOlwiXCJ9KX1lbHNlIGlmKGU9PVwiZGl2XCJ8fGU9PVwic3BhblwiKXtiPWIuY2hpbGRyZW4oXCIuXCIrdGhpcy5faW5saW5lQ2xhc3MpO2IuY2hpbGRyZW4oKS5yZW1vdmVDbGFzcyhcInVpLXN0YXRlLWRpc2FibGVkXCIpO2IuZmluZChcInNlbGVjdC51aS1kYXRlcGlja2VyLW1vbnRoLCBzZWxlY3QudWktZGF0ZXBpY2tlci15ZWFyXCIpLnJlbW92ZUF0dHIoXCJkaXNhYmxlZFwiKX10aGlzLl9kaXNhYmxlZElucHV0cz1kLm1hcCh0aGlzLl9kaXNhYmxlZElucHV0cyxmdW5jdGlvbihmKXtyZXR1cm4gZj09YT9udWxsOmZ9KX19LF9kaXNhYmxlRGF0ZXBpY2tlcjpmdW5jdGlvbihhKXt2YXIgYj1kKGEpLGM9ZC5kYXRhKGEsXG5cImRhdGVwaWNrZXJcIik7aWYoYi5oYXNDbGFzcyh0aGlzLm1hcmtlckNsYXNzTmFtZSkpe3ZhciBlPWEubm9kZU5hbWUudG9Mb3dlckNhc2UoKTtpZihlPT1cImlucHV0XCIpe2EuZGlzYWJsZWQ9dHJ1ZTtjLnRyaWdnZXIuZmlsdGVyKFwiYnV0dG9uXCIpLmVhY2goZnVuY3Rpb24oKXt0aGlzLmRpc2FibGVkPXRydWV9KS5lbmQoKS5maWx0ZXIoXCJpbWdcIikuY3NzKHtvcGFjaXR5OlwiMC41XCIsY3Vyc29yOlwiZGVmYXVsdFwifSl9ZWxzZSBpZihlPT1cImRpdlwifHxlPT1cInNwYW5cIil7Yj1iLmNoaWxkcmVuKFwiLlwiK3RoaXMuX2lubGluZUNsYXNzKTtiLmNoaWxkcmVuKCkuYWRkQ2xhc3MoXCJ1aS1zdGF0ZS1kaXNhYmxlZFwiKTtiLmZpbmQoXCJzZWxlY3QudWktZGF0ZXBpY2tlci1tb250aCwgc2VsZWN0LnVpLWRhdGVwaWNrZXIteWVhclwiKS5hdHRyKFwiZGlzYWJsZWRcIixcImRpc2FibGVkXCIpfXRoaXMuX2Rpc2FibGVkSW5wdXRzPWQubWFwKHRoaXMuX2Rpc2FibGVkSW5wdXRzLGZ1bmN0aW9uKGYpe3JldHVybiBmPT1cbmE/bnVsbDpmfSk7dGhpcy5fZGlzYWJsZWRJbnB1dHNbdGhpcy5fZGlzYWJsZWRJbnB1dHMubGVuZ3RoXT1hfX0sX2lzRGlzYWJsZWREYXRlcGlja2VyOmZ1bmN0aW9uKGEpe2lmKCFhKXJldHVybiBmYWxzZTtmb3IodmFyIGI9MDtiPHRoaXMuX2Rpc2FibGVkSW5wdXRzLmxlbmd0aDtiKyspaWYodGhpcy5fZGlzYWJsZWRJbnB1dHNbYl09PWEpcmV0dXJuIHRydWU7cmV0dXJuIGZhbHNlfSxfZ2V0SW5zdDpmdW5jdGlvbihhKXt0cnl7cmV0dXJuIGQuZGF0YShhLFwiZGF0ZXBpY2tlclwiKX1jYXRjaChiKXt0aHJvd1wiTWlzc2luZyBpbnN0YW5jZSBkYXRhIGZvciB0aGlzIGRhdGVwaWNrZXJcIjt9fSxfb3B0aW9uRGF0ZXBpY2tlcjpmdW5jdGlvbihhLGIsYyl7dmFyIGU9dGhpcy5fZ2V0SW5zdChhKTtpZihhcmd1bWVudHMubGVuZ3RoPT0yJiZ0eXBlb2YgYj09XCJzdHJpbmdcIilyZXR1cm4gYj09XCJkZWZhdWx0c1wiP2QuZXh0ZW5kKHt9LGQuZGF0ZXBpY2tlci5fZGVmYXVsdHMpOmU/Yj09XCJhbGxcIj9cbmQuZXh0ZW5kKHt9LGUuc2V0dGluZ3MpOnRoaXMuX2dldChlLGIpOm51bGw7dmFyIGY9Ynx8e307aWYodHlwZW9mIGI9PVwic3RyaW5nXCIpe2Y9e307ZltiXT1jfWlmKGUpe3RoaXMuX2N1ckluc3Q9PWUmJnRoaXMuX2hpZGVEYXRlcGlja2VyKCk7dmFyIGg9dGhpcy5fZ2V0RGF0ZURhdGVwaWNrZXIoYSx0cnVlKSxpPXRoaXMuX2dldE1pbk1heERhdGUoZSxcIm1pblwiKSxnPXRoaXMuX2dldE1pbk1heERhdGUoZSxcIm1heFwiKTtIKGUuc2V0dGluZ3MsZik7aWYoaSE9PW51bGwmJmYuZGF0ZUZvcm1hdCE9PUMmJmYubWluRGF0ZT09PUMpZS5zZXR0aW5ncy5taW5EYXRlPXRoaXMuX2Zvcm1hdERhdGUoZSxpKTtpZihnIT09bnVsbCYmZi5kYXRlRm9ybWF0IT09QyYmZi5tYXhEYXRlPT09QyllLnNldHRpbmdzLm1heERhdGU9dGhpcy5fZm9ybWF0RGF0ZShlLGcpO3RoaXMuX2F0dGFjaG1lbnRzKGQoYSksZSk7dGhpcy5fYXV0b1NpemUoZSk7dGhpcy5fc2V0RGF0ZShlLGgpO3RoaXMuX3VwZGF0ZUFsdGVybmF0ZShlKTtcbnRoaXMuX3VwZGF0ZURhdGVwaWNrZXIoZSl9fSxfY2hhbmdlRGF0ZXBpY2tlcjpmdW5jdGlvbihhLGIsYyl7dGhpcy5fb3B0aW9uRGF0ZXBpY2tlcihhLGIsYyl9LF9yZWZyZXNoRGF0ZXBpY2tlcjpmdW5jdGlvbihhKXsoYT10aGlzLl9nZXRJbnN0KGEpKSYmdGhpcy5fdXBkYXRlRGF0ZXBpY2tlcihhKX0sX3NldERhdGVEYXRlcGlja2VyOmZ1bmN0aW9uKGEsYil7aWYoYT10aGlzLl9nZXRJbnN0KGEpKXt0aGlzLl9zZXREYXRlKGEsYik7dGhpcy5fdXBkYXRlRGF0ZXBpY2tlcihhKTt0aGlzLl91cGRhdGVBbHRlcm5hdGUoYSl9fSxfZ2V0RGF0ZURhdGVwaWNrZXI6ZnVuY3Rpb24oYSxiKXsoYT10aGlzLl9nZXRJbnN0KGEpKSYmIWEuaW5saW5lJiZ0aGlzLl9zZXREYXRlRnJvbUZpZWxkKGEsYik7cmV0dXJuIGE/dGhpcy5fZ2V0RGF0ZShhKTpudWxsfSxfZG9LZXlEb3duOmZ1bmN0aW9uKGEpe3ZhciBiPWQuZGF0ZXBpY2tlci5fZ2V0SW5zdChhLnRhcmdldCksYz10cnVlLGU9Yi5kcERpdi5pcyhcIi51aS1kYXRlcGlja2VyLXJ0bFwiKTtcbmIuX2tleUV2ZW50PXRydWU7aWYoZC5kYXRlcGlja2VyLl9kYXRlcGlja2VyU2hvd2luZylzd2l0Y2goYS5rZXlDb2RlKXtjYXNlIDk6ZC5kYXRlcGlja2VyLl9oaWRlRGF0ZXBpY2tlcigpO2M9ZmFsc2U7YnJlYWs7Y2FzZSAxMzpjPWQoXCJ0ZC5cIitkLmRhdGVwaWNrZXIuX2RheU92ZXJDbGFzcytcIjpub3QoLlwiK2QuZGF0ZXBpY2tlci5fY3VycmVudENsYXNzK1wiKVwiLGIuZHBEaXYpO2NbMF0mJmQuZGF0ZXBpY2tlci5fc2VsZWN0RGF5KGEudGFyZ2V0LGIuc2VsZWN0ZWRNb250aCxiLnNlbGVjdGVkWWVhcixjWzBdKTtpZihhPWQuZGF0ZXBpY2tlci5fZ2V0KGIsXCJvblNlbGVjdFwiKSl7Yz1kLmRhdGVwaWNrZXIuX2Zvcm1hdERhdGUoYik7YS5hcHBseShiLmlucHV0P2IuaW5wdXRbMF06bnVsbCxbYyxiXSl9ZWxzZSBkLmRhdGVwaWNrZXIuX2hpZGVEYXRlcGlja2VyKCk7cmV0dXJuIGZhbHNlO2Nhc2UgMjc6ZC5kYXRlcGlja2VyLl9oaWRlRGF0ZXBpY2tlcigpO2JyZWFrO2Nhc2UgMzM6ZC5kYXRlcGlja2VyLl9hZGp1c3REYXRlKGEudGFyZ2V0LFxuYS5jdHJsS2V5Py1kLmRhdGVwaWNrZXIuX2dldChiLFwic3RlcEJpZ01vbnRoc1wiKTotZC5kYXRlcGlja2VyLl9nZXQoYixcInN0ZXBNb250aHNcIiksXCJNXCIpO2JyZWFrO2Nhc2UgMzQ6ZC5kYXRlcGlja2VyLl9hZGp1c3REYXRlKGEudGFyZ2V0LGEuY3RybEtleT8rZC5kYXRlcGlja2VyLl9nZXQoYixcInN0ZXBCaWdNb250aHNcIik6K2QuZGF0ZXBpY2tlci5fZ2V0KGIsXCJzdGVwTW9udGhzXCIpLFwiTVwiKTticmVhaztjYXNlIDM1OmlmKGEuY3RybEtleXx8YS5tZXRhS2V5KWQuZGF0ZXBpY2tlci5fY2xlYXJEYXRlKGEudGFyZ2V0KTtjPWEuY3RybEtleXx8YS5tZXRhS2V5O2JyZWFrO2Nhc2UgMzY6aWYoYS5jdHJsS2V5fHxhLm1ldGFLZXkpZC5kYXRlcGlja2VyLl9nb3RvVG9kYXkoYS50YXJnZXQpO2M9YS5jdHJsS2V5fHxhLm1ldGFLZXk7YnJlYWs7Y2FzZSAzNzppZihhLmN0cmxLZXl8fGEubWV0YUtleSlkLmRhdGVwaWNrZXIuX2FkanVzdERhdGUoYS50YXJnZXQsZT8rMTotMSxcIkRcIik7Yz1cbmEuY3RybEtleXx8YS5tZXRhS2V5O2lmKGEub3JpZ2luYWxFdmVudC5hbHRLZXkpZC5kYXRlcGlja2VyLl9hZGp1c3REYXRlKGEudGFyZ2V0LGEuY3RybEtleT8tZC5kYXRlcGlja2VyLl9nZXQoYixcInN0ZXBCaWdNb250aHNcIik6LWQuZGF0ZXBpY2tlci5fZ2V0KGIsXCJzdGVwTW9udGhzXCIpLFwiTVwiKTticmVhaztjYXNlIDM4OmlmKGEuY3RybEtleXx8YS5tZXRhS2V5KWQuZGF0ZXBpY2tlci5fYWRqdXN0RGF0ZShhLnRhcmdldCwtNyxcIkRcIik7Yz1hLmN0cmxLZXl8fGEubWV0YUtleTticmVhaztjYXNlIDM5OmlmKGEuY3RybEtleXx8YS5tZXRhS2V5KWQuZGF0ZXBpY2tlci5fYWRqdXN0RGF0ZShhLnRhcmdldCxlPy0xOisxLFwiRFwiKTtjPWEuY3RybEtleXx8YS5tZXRhS2V5O2lmKGEub3JpZ2luYWxFdmVudC5hbHRLZXkpZC5kYXRlcGlja2VyLl9hZGp1c3REYXRlKGEudGFyZ2V0LGEuY3RybEtleT8rZC5kYXRlcGlja2VyLl9nZXQoYixcInN0ZXBCaWdNb250aHNcIik6K2QuZGF0ZXBpY2tlci5fZ2V0KGIsXG5cInN0ZXBNb250aHNcIiksXCJNXCIpO2JyZWFrO2Nhc2UgNDA6aWYoYS5jdHJsS2V5fHxhLm1ldGFLZXkpZC5kYXRlcGlja2VyLl9hZGp1c3REYXRlKGEudGFyZ2V0LCs3LFwiRFwiKTtjPWEuY3RybEtleXx8YS5tZXRhS2V5O2JyZWFrO2RlZmF1bHQ6Yz1mYWxzZX1lbHNlIGlmKGEua2V5Q29kZT09MzYmJmEuY3RybEtleSlkLmRhdGVwaWNrZXIuX3Nob3dEYXRlcGlja2VyKHRoaXMpO2Vsc2UgYz1mYWxzZTtpZihjKXthLnByZXZlbnREZWZhdWx0KCk7YS5zdG9wUHJvcGFnYXRpb24oKX19LF9kb0tleVByZXNzOmZ1bmN0aW9uKGEpe3ZhciBiPWQuZGF0ZXBpY2tlci5fZ2V0SW5zdChhLnRhcmdldCk7aWYoZC5kYXRlcGlja2VyLl9nZXQoYixcImNvbnN0cmFpbklucHV0XCIpKXtiPWQuZGF0ZXBpY2tlci5fcG9zc2libGVDaGFycyhkLmRhdGVwaWNrZXIuX2dldChiLFwiZGF0ZUZvcm1hdFwiKSk7dmFyIGM9U3RyaW5nLmZyb21DaGFyQ29kZShhLmNoYXJDb2RlPT1DP2Eua2V5Q29kZTphLmNoYXJDb2RlKTtcbnJldHVybiBhLmN0cmxLZXl8fGEubWV0YUtleXx8YzxcIiBcInx8IWJ8fGIuaW5kZXhPZihjKT4tMX19LF9kb0tleVVwOmZ1bmN0aW9uKGEpe2E9ZC5kYXRlcGlja2VyLl9nZXRJbnN0KGEudGFyZ2V0KTtpZihhLmlucHV0LnZhbCgpIT1hLmxhc3RWYWwpdHJ5e2lmKGQuZGF0ZXBpY2tlci5wYXJzZURhdGUoZC5kYXRlcGlja2VyLl9nZXQoYSxcImRhdGVGb3JtYXRcIiksYS5pbnB1dD9hLmlucHV0LnZhbCgpOm51bGwsZC5kYXRlcGlja2VyLl9nZXRGb3JtYXRDb25maWcoYSkpKXtkLmRhdGVwaWNrZXIuX3NldERhdGVGcm9tRmllbGQoYSk7ZC5kYXRlcGlja2VyLl91cGRhdGVBbHRlcm5hdGUoYSk7ZC5kYXRlcGlja2VyLl91cGRhdGVEYXRlcGlja2VyKGEpfX1jYXRjaChiKXtkLmRhdGVwaWNrZXIubG9nKGIpfXJldHVybiB0cnVlfSxfc2hvd0RhdGVwaWNrZXI6ZnVuY3Rpb24oYSl7YT1hLnRhcmdldHx8YTtpZihhLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCkhPVwiaW5wdXRcIilhPWQoXCJpbnB1dFwiLFxuYS5wYXJlbnROb2RlKVswXTtpZighKGQuZGF0ZXBpY2tlci5faXNEaXNhYmxlZERhdGVwaWNrZXIoYSl8fGQuZGF0ZXBpY2tlci5fbGFzdElucHV0PT1hKSl7dmFyIGI9ZC5kYXRlcGlja2VyLl9nZXRJbnN0KGEpO2lmKGQuZGF0ZXBpY2tlci5fY3VySW5zdCYmZC5kYXRlcGlja2VyLl9jdXJJbnN0IT1iKXtkLmRhdGVwaWNrZXIuX2RhdGVwaWNrZXJTaG93aW5nJiZkLmRhdGVwaWNrZXIuX3RyaWdnZXJPbkNsb3NlKGQuZGF0ZXBpY2tlci5fY3VySW5zdCk7ZC5kYXRlcGlja2VyLl9jdXJJbnN0LmRwRGl2LnN0b3AodHJ1ZSx0cnVlKX12YXIgYz1kLmRhdGVwaWNrZXIuX2dldChiLFwiYmVmb3JlU2hvd1wiKTtjPWM/Yy5hcHBseShhLFthLGJdKTp7fTtpZihjIT09ZmFsc2Upe0goYi5zZXR0aW5ncyxjKTtiLmxhc3RWYWw9bnVsbDtkLmRhdGVwaWNrZXIuX2xhc3RJbnB1dD1hO2QuZGF0ZXBpY2tlci5fc2V0RGF0ZUZyb21GaWVsZChiKTtpZihkLmRhdGVwaWNrZXIuX2luRGlhbG9nKWEudmFsdWU9XG5cIlwiO2lmKCFkLmRhdGVwaWNrZXIuX3Bvcyl7ZC5kYXRlcGlja2VyLl9wb3M9ZC5kYXRlcGlja2VyLl9maW5kUG9zKGEpO2QuZGF0ZXBpY2tlci5fcG9zWzFdKz1hLm9mZnNldEhlaWdodH12YXIgZT1mYWxzZTtkKGEpLnBhcmVudHMoKS5lYWNoKGZ1bmN0aW9uKCl7ZXw9ZCh0aGlzKS5jc3MoXCJwb3NpdGlvblwiKT09XCJmaXhlZFwiO3JldHVybiFlfSk7aWYoZSYmZC5icm93c2VyLm9wZXJhKXtkLmRhdGVwaWNrZXIuX3Bvc1swXS09ZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LnNjcm9sbExlZnQ7ZC5kYXRlcGlja2VyLl9wb3NbMV0tPWRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5zY3JvbGxUb3B9Yz17bGVmdDpkLmRhdGVwaWNrZXIuX3Bvc1swXSx0b3A6ZC5kYXRlcGlja2VyLl9wb3NbMV19O2QuZGF0ZXBpY2tlci5fcG9zPW51bGw7Yi5kcERpdi5lbXB0eSgpO2IuZHBEaXYuY3NzKHtwb3NpdGlvbjpcImFic29sdXRlXCIsZGlzcGxheTpcImJsb2NrXCIsdG9wOlwiLTEwMDBweFwifSk7ZC5kYXRlcGlja2VyLl91cGRhdGVEYXRlcGlja2VyKGIpO1xuYz1kLmRhdGVwaWNrZXIuX2NoZWNrT2Zmc2V0KGIsYyxlKTtiLmRwRGl2LmNzcyh7cG9zaXRpb246ZC5kYXRlcGlja2VyLl9pbkRpYWxvZyYmZC5ibG9ja1VJP1wic3RhdGljXCI6ZT9cImZpeGVkXCI6XCJhYnNvbHV0ZVwiLGRpc3BsYXk6XCJub25lXCIsbGVmdDpjLmxlZnQrXCJweFwiLHRvcDpjLnRvcCtcInB4XCJ9KTtpZighYi5pbmxpbmUpe2M9ZC5kYXRlcGlja2VyLl9nZXQoYixcInNob3dBbmltXCIpO3ZhciBmPWQuZGF0ZXBpY2tlci5fZ2V0KGIsXCJkdXJhdGlvblwiKSxoPWZ1bmN0aW9uKCl7dmFyIGk9Yi5kcERpdi5maW5kKFwiaWZyYW1lLnVpLWRhdGVwaWNrZXItY292ZXJcIik7aWYoaS5sZW5ndGgpe3ZhciBnPWQuZGF0ZXBpY2tlci5fZ2V0Qm9yZGVycyhiLmRwRGl2KTtpLmNzcyh7bGVmdDotZ1swXSx0b3A6LWdbMV0sd2lkdGg6Yi5kcERpdi5vdXRlcldpZHRoKCksaGVpZ2h0OmIuZHBEaXYub3V0ZXJIZWlnaHQoKX0pfX07Yi5kcERpdi56SW5kZXgoZChhKS56SW5kZXgoKSsxKTtkLmRhdGVwaWNrZXIuX2RhdGVwaWNrZXJTaG93aW5nPVxudHJ1ZTtkLmVmZmVjdHMmJmQuZWZmZWN0c1tjXT9iLmRwRGl2LnNob3coYyxkLmRhdGVwaWNrZXIuX2dldChiLFwic2hvd09wdGlvbnNcIiksZixoKTpiLmRwRGl2W2N8fFwic2hvd1wiXShjP2Y6bnVsbCxoKTtpZighY3x8IWYpaCgpO2IuaW5wdXQuaXMoXCI6dmlzaWJsZVwiKSYmIWIuaW5wdXQuaXMoXCI6ZGlzYWJsZWRcIikmJmIuaW5wdXQuZm9jdXMoKTtkLmRhdGVwaWNrZXIuX2N1ckluc3Q9Yn19fX0sX3VwZGF0ZURhdGVwaWNrZXI6ZnVuY3Rpb24oYSl7dGhpcy5tYXhSb3dzPTQ7dmFyIGI9ZC5kYXRlcGlja2VyLl9nZXRCb3JkZXJzKGEuZHBEaXYpO0o9YTthLmRwRGl2LmVtcHR5KCkuYXBwZW5kKHRoaXMuX2dlbmVyYXRlSFRNTChhKSk7dmFyIGM9YS5kcERpdi5maW5kKFwiaWZyYW1lLnVpLWRhdGVwaWNrZXItY292ZXJcIik7Yy5sZW5ndGgmJmMuY3NzKHtsZWZ0Oi1iWzBdLHRvcDotYlsxXSx3aWR0aDphLmRwRGl2Lm91dGVyV2lkdGgoKSxoZWlnaHQ6YS5kcERpdi5vdXRlckhlaWdodCgpfSk7XG5hLmRwRGl2LmZpbmQoXCIuXCIrdGhpcy5fZGF5T3ZlckNsYXNzK1wiIGFcIikubW91c2VvdmVyKCk7Yj10aGlzLl9nZXROdW1iZXJPZk1vbnRocyhhKTtjPWJbMV07YS5kcERpdi5yZW1vdmVDbGFzcyhcInVpLWRhdGVwaWNrZXItbXVsdGktMiB1aS1kYXRlcGlja2VyLW11bHRpLTMgdWktZGF0ZXBpY2tlci1tdWx0aS00XCIpLndpZHRoKFwiXCIpO2M+MSYmYS5kcERpdi5hZGRDbGFzcyhcInVpLWRhdGVwaWNrZXItbXVsdGktXCIrYykuY3NzKFwid2lkdGhcIiwxNypjK1wiZW1cIik7YS5kcERpdlsoYlswXSE9MXx8YlsxXSE9MT9cImFkZFwiOlwicmVtb3ZlXCIpK1wiQ2xhc3NcIl0oXCJ1aS1kYXRlcGlja2VyLW11bHRpXCIpO2EuZHBEaXZbKHRoaXMuX2dldChhLFwiaXNSVExcIik/XCJhZGRcIjpcInJlbW92ZVwiKStcIkNsYXNzXCJdKFwidWktZGF0ZXBpY2tlci1ydGxcIik7YT09ZC5kYXRlcGlja2VyLl9jdXJJbnN0JiZkLmRhdGVwaWNrZXIuX2RhdGVwaWNrZXJTaG93aW5nJiZhLmlucHV0JiZhLmlucHV0LmlzKFwiOnZpc2libGVcIikmJlxuIWEuaW5wdXQuaXMoXCI6ZGlzYWJsZWRcIikmJmEuaW5wdXRbMF0hPWRvY3VtZW50LmFjdGl2ZUVsZW1lbnQmJmEuaW5wdXQuZm9jdXMoKTtpZihhLnllYXJzaHRtbCl7dmFyIGU9YS55ZWFyc2h0bWw7c2V0VGltZW91dChmdW5jdGlvbigpe2U9PT1hLnllYXJzaHRtbCYmYS55ZWFyc2h0bWwmJmEuZHBEaXYuZmluZChcInNlbGVjdC51aS1kYXRlcGlja2VyLXllYXI6Zmlyc3RcIikucmVwbGFjZVdpdGgoYS55ZWFyc2h0bWwpO2U9YS55ZWFyc2h0bWw9bnVsbH0sMCl9fSxfZ2V0Qm9yZGVyczpmdW5jdGlvbihhKXt2YXIgYj1mdW5jdGlvbihjKXtyZXR1cm57dGhpbjoxLG1lZGl1bToyLHRoaWNrOjN9W2NdfHxjfTtyZXR1cm5bcGFyc2VGbG9hdChiKGEuY3NzKFwiYm9yZGVyLWxlZnQtd2lkdGhcIikpKSxwYXJzZUZsb2F0KGIoYS5jc3MoXCJib3JkZXItdG9wLXdpZHRoXCIpKSldfSxfY2hlY2tPZmZzZXQ6ZnVuY3Rpb24oYSxiLGMpe3ZhciBlPWEuZHBEaXYub3V0ZXJXaWR0aCgpLGY9YS5kcERpdi5vdXRlckhlaWdodCgpLFxuaD1hLmlucHV0P2EuaW5wdXQub3V0ZXJXaWR0aCgpOjAsaT1hLmlucHV0P2EuaW5wdXQub3V0ZXJIZWlnaHQoKTowLGc9ZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmNsaWVudFdpZHRoK2QoZG9jdW1lbnQpLnNjcm9sbExlZnQoKSxqPWRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jbGllbnRIZWlnaHQrZChkb2N1bWVudCkuc2Nyb2xsVG9wKCk7Yi5sZWZ0LT10aGlzLl9nZXQoYSxcImlzUlRMXCIpP2UtaDowO2IubGVmdC09YyYmYi5sZWZ0PT1hLmlucHV0Lm9mZnNldCgpLmxlZnQ/ZChkb2N1bWVudCkuc2Nyb2xsTGVmdCgpOjA7Yi50b3AtPWMmJmIudG9wPT1hLmlucHV0Lm9mZnNldCgpLnRvcCtpP2QoZG9jdW1lbnQpLnNjcm9sbFRvcCgpOjA7Yi5sZWZ0LT1NYXRoLm1pbihiLmxlZnQsYi5sZWZ0K2U+ZyYmZz5lP01hdGguYWJzKGIubGVmdCtlLWcpOjApO2IudG9wLT1NYXRoLm1pbihiLnRvcCxiLnRvcCtmPmomJmo+Zj9NYXRoLmFicyhmK2kpOjApO3JldHVybiBifSxfZmluZFBvczpmdW5jdGlvbihhKXtmb3IodmFyIGI9XG50aGlzLl9nZXQodGhpcy5fZ2V0SW5zdChhKSxcImlzUlRMXCIpO2EmJihhLnR5cGU9PVwiaGlkZGVuXCJ8fGEubm9kZVR5cGUhPTF8fGQuZXhwci5maWx0ZXJzLmhpZGRlbihhKSk7KWE9YVtiP1wicHJldmlvdXNTaWJsaW5nXCI6XCJuZXh0U2libGluZ1wiXTthPWQoYSkub2Zmc2V0KCk7cmV0dXJuW2EubGVmdCxhLnRvcF19LF90cmlnZ2VyT25DbG9zZTpmdW5jdGlvbihhKXt2YXIgYj10aGlzLl9nZXQoYSxcIm9uQ2xvc2VcIik7aWYoYiliLmFwcGx5KGEuaW5wdXQ/YS5pbnB1dFswXTpudWxsLFthLmlucHV0P2EuaW5wdXQudmFsKCk6XCJcIixhXSl9LF9oaWRlRGF0ZXBpY2tlcjpmdW5jdGlvbihhKXt2YXIgYj10aGlzLl9jdXJJbnN0O2lmKCEoIWJ8fGEmJmIhPWQuZGF0YShhLFwiZGF0ZXBpY2tlclwiKSkpaWYodGhpcy5fZGF0ZXBpY2tlclNob3dpbmcpe2E9dGhpcy5fZ2V0KGIsXCJzaG93QW5pbVwiKTt2YXIgYz10aGlzLl9nZXQoYixcImR1cmF0aW9uXCIpLGU9ZnVuY3Rpb24oKXtkLmRhdGVwaWNrZXIuX3RpZHlEaWFsb2coYik7XG50aGlzLl9jdXJJbnN0PW51bGx9O2QuZWZmZWN0cyYmZC5lZmZlY3RzW2FdP2IuZHBEaXYuaGlkZShhLGQuZGF0ZXBpY2tlci5fZ2V0KGIsXCJzaG93T3B0aW9uc1wiKSxjLGUpOmIuZHBEaXZbYT09XCJzbGlkZURvd25cIj9cInNsaWRlVXBcIjphPT1cImZhZGVJblwiP1wiZmFkZU91dFwiOlwiaGlkZVwiXShhP2M6bnVsbCxlKTthfHxlKCk7ZC5kYXRlcGlja2VyLl90cmlnZ2VyT25DbG9zZShiKTt0aGlzLl9kYXRlcGlja2VyU2hvd2luZz1mYWxzZTt0aGlzLl9sYXN0SW5wdXQ9bnVsbDtpZih0aGlzLl9pbkRpYWxvZyl7dGhpcy5fZGlhbG9nSW5wdXQuY3NzKHtwb3NpdGlvbjpcImFic29sdXRlXCIsbGVmdDpcIjBcIix0b3A6XCItMTAwcHhcIn0pO2lmKGQuYmxvY2tVSSl7ZC51bmJsb2NrVUkoKTtkKFwiYm9keVwiKS5hcHBlbmQodGhpcy5kcERpdil9fXRoaXMuX2luRGlhbG9nPWZhbHNlfX0sX3RpZHlEaWFsb2c6ZnVuY3Rpb24oYSl7YS5kcERpdi5yZW1vdmVDbGFzcyh0aGlzLl9kaWFsb2dDbGFzcykudW5iaW5kKFwiLnVpLWRhdGVwaWNrZXItY2FsZW5kYXJcIil9LFxuX2NoZWNrRXh0ZXJuYWxDbGljazpmdW5jdGlvbihhKXtpZihkLmRhdGVwaWNrZXIuX2N1ckluc3Qpe2E9ZChhLnRhcmdldCk7YVswXS5pZCE9ZC5kYXRlcGlja2VyLl9tYWluRGl2SWQmJmEucGFyZW50cyhcIiNcIitkLmRhdGVwaWNrZXIuX21haW5EaXZJZCkubGVuZ3RoPT0wJiYhYS5oYXNDbGFzcyhkLmRhdGVwaWNrZXIubWFya2VyQ2xhc3NOYW1lKSYmIWEuaGFzQ2xhc3MoZC5kYXRlcGlja2VyLl90cmlnZ2VyQ2xhc3MpJiZkLmRhdGVwaWNrZXIuX2RhdGVwaWNrZXJTaG93aW5nJiYhKGQuZGF0ZXBpY2tlci5faW5EaWFsb2cmJmQuYmxvY2tVSSkmJmQuZGF0ZXBpY2tlci5faGlkZURhdGVwaWNrZXIoKX19LF9hZGp1c3REYXRlOmZ1bmN0aW9uKGEsYixjKXthPWQoYSk7dmFyIGU9dGhpcy5fZ2V0SW5zdChhWzBdKTtpZighdGhpcy5faXNEaXNhYmxlZERhdGVwaWNrZXIoYVswXSkpe3RoaXMuX2FkanVzdEluc3REYXRlKGUsYisoYz09XCJNXCI/dGhpcy5fZ2V0KGUsXCJzaG93Q3VycmVudEF0UG9zXCIpOlxuMCksYyk7dGhpcy5fdXBkYXRlRGF0ZXBpY2tlcihlKX19LF9nb3RvVG9kYXk6ZnVuY3Rpb24oYSl7YT1kKGEpO3ZhciBiPXRoaXMuX2dldEluc3QoYVswXSk7aWYodGhpcy5fZ2V0KGIsXCJnb3RvQ3VycmVudFwiKSYmYi5jdXJyZW50RGF5KXtiLnNlbGVjdGVkRGF5PWIuY3VycmVudERheTtiLmRyYXdNb250aD1iLnNlbGVjdGVkTW9udGg9Yi5jdXJyZW50TW9udGg7Yi5kcmF3WWVhcj1iLnNlbGVjdGVkWWVhcj1iLmN1cnJlbnRZZWFyfWVsc2V7dmFyIGM9bmV3IERhdGU7Yi5zZWxlY3RlZERheT1jLmdldERhdGUoKTtiLmRyYXdNb250aD1iLnNlbGVjdGVkTW9udGg9Yy5nZXRNb250aCgpO2IuZHJhd1llYXI9Yi5zZWxlY3RlZFllYXI9Yy5nZXRGdWxsWWVhcigpfXRoaXMuX25vdGlmeUNoYW5nZShiKTt0aGlzLl9hZGp1c3REYXRlKGEpfSxfc2VsZWN0TW9udGhZZWFyOmZ1bmN0aW9uKGEsYixjKXthPWQoYSk7dmFyIGU9dGhpcy5fZ2V0SW5zdChhWzBdKTtlW1wic2VsZWN0ZWRcIisoYz09XCJNXCI/XG5cIk1vbnRoXCI6XCJZZWFyXCIpXT1lW1wiZHJhd1wiKyhjPT1cIk1cIj9cIk1vbnRoXCI6XCJZZWFyXCIpXT1wYXJzZUludChiLm9wdGlvbnNbYi5zZWxlY3RlZEluZGV4XS52YWx1ZSwxMCk7dGhpcy5fbm90aWZ5Q2hhbmdlKGUpO3RoaXMuX2FkanVzdERhdGUoYSl9LF9zZWxlY3REYXk6ZnVuY3Rpb24oYSxiLGMsZSl7dmFyIGY9ZChhKTtpZighKGQoZSkuaGFzQ2xhc3ModGhpcy5fdW5zZWxlY3RhYmxlQ2xhc3MpfHx0aGlzLl9pc0Rpc2FibGVkRGF0ZXBpY2tlcihmWzBdKSkpe2Y9dGhpcy5fZ2V0SW5zdChmWzBdKTtmLnNlbGVjdGVkRGF5PWYuY3VycmVudERheT1kKFwiYVwiLGUpLmh0bWwoKTtmLnNlbGVjdGVkTW9udGg9Zi5jdXJyZW50TW9udGg9YjtmLnNlbGVjdGVkWWVhcj1mLmN1cnJlbnRZZWFyPWM7dGhpcy5fc2VsZWN0RGF0ZShhLHRoaXMuX2Zvcm1hdERhdGUoZixmLmN1cnJlbnREYXksZi5jdXJyZW50TW9udGgsZi5jdXJyZW50WWVhcikpfX0sX2NsZWFyRGF0ZTpmdW5jdGlvbihhKXthPWQoYSk7XG50aGlzLl9nZXRJbnN0KGFbMF0pO3RoaXMuX3NlbGVjdERhdGUoYSxcIlwiKX0sX3NlbGVjdERhdGU6ZnVuY3Rpb24oYSxiKXthPXRoaXMuX2dldEluc3QoZChhKVswXSk7Yj1iIT1udWxsP2I6dGhpcy5fZm9ybWF0RGF0ZShhKTthLmlucHV0JiZhLmlucHV0LnZhbChiKTt0aGlzLl91cGRhdGVBbHRlcm5hdGUoYSk7dmFyIGM9dGhpcy5fZ2V0KGEsXCJvblNlbGVjdFwiKTtpZihjKWMuYXBwbHkoYS5pbnB1dD9hLmlucHV0WzBdOm51bGwsW2IsYV0pO2Vsc2UgYS5pbnB1dCYmYS5pbnB1dC50cmlnZ2VyKFwiY2hhbmdlXCIpO2lmKGEuaW5saW5lKXRoaXMuX3VwZGF0ZURhdGVwaWNrZXIoYSk7ZWxzZXt0aGlzLl9oaWRlRGF0ZXBpY2tlcigpO3RoaXMuX2xhc3RJbnB1dD1hLmlucHV0WzBdO3R5cGVvZiBhLmlucHV0WzBdIT1cIm9iamVjdFwiJiZhLmlucHV0LmZvY3VzKCk7dGhpcy5fbGFzdElucHV0PW51bGx9fSxfdXBkYXRlQWx0ZXJuYXRlOmZ1bmN0aW9uKGEpe3ZhciBiPXRoaXMuX2dldChhLFwiYWx0RmllbGRcIik7XG5pZihiKXt2YXIgYz10aGlzLl9nZXQoYSxcImFsdEZvcm1hdFwiKXx8dGhpcy5fZ2V0KGEsXCJkYXRlRm9ybWF0XCIpLGU9dGhpcy5fZ2V0RGF0ZShhKSxmPXRoaXMuZm9ybWF0RGF0ZShjLGUsdGhpcy5fZ2V0Rm9ybWF0Q29uZmlnKGEpKTtkKGIpLmVhY2goZnVuY3Rpb24oKXtkKHRoaXMpLnZhbChmKX0pfX0sbm9XZWVrZW5kczpmdW5jdGlvbihhKXthPWEuZ2V0RGF5KCk7cmV0dXJuW2E+MCYmYTw2LFwiXCJdfSxpc284NjAxV2VlazpmdW5jdGlvbihhKXthPW5ldyBEYXRlKGEuZ2V0VGltZSgpKTthLnNldERhdGUoYS5nZXREYXRlKCkrNC0oYS5nZXREYXkoKXx8NykpO3ZhciBiPWEuZ2V0VGltZSgpO2Euc2V0TW9udGgoMCk7YS5zZXREYXRlKDEpO3JldHVybiBNYXRoLmZsb29yKE1hdGgucm91bmQoKGItYSkvODY0RTUpLzcpKzF9LHBhcnNlRGF0ZTpmdW5jdGlvbihhLGIsYyl7aWYoYT09bnVsbHx8Yj09bnVsbCl0aHJvd1wiSW52YWxpZCBhcmd1bWVudHNcIjtiPXR5cGVvZiBiPT1cIm9iamVjdFwiP1xuYi50b1N0cmluZygpOmIrXCJcIjtpZihiPT1cIlwiKXJldHVybiBudWxsO3ZhciBlPShjP2Muc2hvcnRZZWFyQ3V0b2ZmOm51bGwpfHx0aGlzLl9kZWZhdWx0cy5zaG9ydFllYXJDdXRvZmY7ZT10eXBlb2YgZSE9XCJzdHJpbmdcIj9lOihuZXcgRGF0ZSkuZ2V0RnVsbFllYXIoKSUxMDArcGFyc2VJbnQoZSwxMCk7Zm9yKHZhciBmPShjP2MuZGF5TmFtZXNTaG9ydDpudWxsKXx8dGhpcy5fZGVmYXVsdHMuZGF5TmFtZXNTaG9ydCxoPShjP2MuZGF5TmFtZXM6bnVsbCl8fHRoaXMuX2RlZmF1bHRzLmRheU5hbWVzLGk9KGM/Yy5tb250aE5hbWVzU2hvcnQ6bnVsbCl8fHRoaXMuX2RlZmF1bHRzLm1vbnRoTmFtZXNTaG9ydCxnPShjP2MubW9udGhOYW1lczpudWxsKXx8dGhpcy5fZGVmYXVsdHMubW9udGhOYW1lcyxqPWM9LTEsbD0tMSx1PS0xLGs9ZmFsc2Usbz1mdW5jdGlvbihwKXsocD1BKzE8YS5sZW5ndGgmJmEuY2hhckF0KEErMSk9PXApJiZBKys7cmV0dXJuIHB9LG09ZnVuY3Rpb24ocCl7dmFyIEQ9XG5vKHApO3A9bmV3IFJlZ0V4cChcIl5cXFxcZHsxLFwiKyhwPT1cIkBcIj8xNDpwPT1cIiFcIj8yMDpwPT1cInlcIiYmRD80OnA9PVwib1wiPzM6MikrXCJ9XCIpO3A9Yi5zdWJzdHJpbmcocSkubWF0Y2gocCk7aWYoIXApdGhyb3dcIk1pc3NpbmcgbnVtYmVyIGF0IHBvc2l0aW9uIFwiK3E7cSs9cFswXS5sZW5ndGg7cmV0dXJuIHBhcnNlSW50KHBbMF0sMTApfSxuPWZ1bmN0aW9uKHAsRCxLKXtwPWQubWFwKG8ocCk/SzpELGZ1bmN0aW9uKHcseCl7cmV0dXJuW1t4LHddXX0pLnNvcnQoZnVuY3Rpb24odyx4KXtyZXR1cm4tKHdbMV0ubGVuZ3RoLXhbMV0ubGVuZ3RoKX0pO3ZhciBFPS0xO2QuZWFjaChwLGZ1bmN0aW9uKHcseCl7dz14WzFdO2lmKGIuc3Vic3RyKHEsdy5sZW5ndGgpLnRvTG93ZXJDYXNlKCk9PXcudG9Mb3dlckNhc2UoKSl7RT14WzBdO3ErPXcubGVuZ3RoO3JldHVybiBmYWxzZX19KTtpZihFIT0tMSlyZXR1cm4gRSsxO2Vsc2UgdGhyb3dcIlVua25vd24gbmFtZSBhdCBwb3NpdGlvbiBcIitxO30scz1cbmZ1bmN0aW9uKCl7aWYoYi5jaGFyQXQocSkhPWEuY2hhckF0KEEpKXRocm93XCJVbmV4cGVjdGVkIGxpdGVyYWwgYXQgcG9zaXRpb24gXCIrcTtxKyt9LHE9MCxBPTA7QTxhLmxlbmd0aDtBKyspaWYoaylpZihhLmNoYXJBdChBKT09XCInXCImJiFvKFwiJ1wiKSlrPWZhbHNlO2Vsc2UgcygpO2Vsc2Ugc3dpdGNoKGEuY2hhckF0KEEpKXtjYXNlIFwiZFwiOmw9bShcImRcIik7YnJlYWs7Y2FzZSBcIkRcIjpuKFwiRFwiLGYsaCk7YnJlYWs7Y2FzZSBcIm9cIjp1PW0oXCJvXCIpO2JyZWFrO2Nhc2UgXCJtXCI6aj1tKFwibVwiKTticmVhaztjYXNlIFwiTVwiOmo9bihcIk1cIixpLGcpO2JyZWFrO2Nhc2UgXCJ5XCI6Yz1tKFwieVwiKTticmVhaztjYXNlIFwiQFwiOnZhciB2PW5ldyBEYXRlKG0oXCJAXCIpKTtjPXYuZ2V0RnVsbFllYXIoKTtqPXYuZ2V0TW9udGgoKSsxO2w9di5nZXREYXRlKCk7YnJlYWs7Y2FzZSBcIiFcIjp2PW5ldyBEYXRlKChtKFwiIVwiKS10aGlzLl90aWNrc1RvMTk3MCkvMUU0KTtjPXYuZ2V0RnVsbFllYXIoKTtqPXYuZ2V0TW9udGgoKStcbjE7bD12LmdldERhdGUoKTticmVhaztjYXNlIFwiJ1wiOmlmKG8oXCInXCIpKXMoKTtlbHNlIGs9dHJ1ZTticmVhaztkZWZhdWx0OnMoKX1pZihxPGIubGVuZ3RoKXRocm93XCJFeHRyYS91bnBhcnNlZCBjaGFyYWN0ZXJzIGZvdW5kIGluIGRhdGU6IFwiK2Iuc3Vic3RyaW5nKHEpO2lmKGM9PS0xKWM9KG5ldyBEYXRlKS5nZXRGdWxsWWVhcigpO2Vsc2UgaWYoYzwxMDApYys9KG5ldyBEYXRlKS5nZXRGdWxsWWVhcigpLShuZXcgRGF0ZSkuZ2V0RnVsbFllYXIoKSUxMDArKGM8PWU/MDotMTAwKTtpZih1Pi0xKXtqPTE7bD11O2Rve2U9dGhpcy5fZ2V0RGF5c0luTW9udGgoYyxqLTEpO2lmKGw8PWUpYnJlYWs7aisrO2wtPWV9d2hpbGUoMSl9dj10aGlzLl9kYXlsaWdodFNhdmluZ0FkanVzdChuZXcgRGF0ZShjLGotMSxsKSk7aWYodi5nZXRGdWxsWWVhcigpIT1jfHx2LmdldE1vbnRoKCkrMSE9anx8di5nZXREYXRlKCkhPWwpdGhyb3dcIkludmFsaWQgZGF0ZVwiO3JldHVybiB2fSxBVE9NOlwieXktbW0tZGRcIixcbkNPT0tJRTpcIkQsIGRkIE0geXlcIixJU09fODYwMTpcInl5LW1tLWRkXCIsUkZDXzgyMjpcIkQsIGQgTSB5XCIsUkZDXzg1MDpcIkRELCBkZC1NLXlcIixSRkNfMTAzNjpcIkQsIGQgTSB5XCIsUkZDXzExMjM6XCJELCBkIE0geXlcIixSRkNfMjgyMjpcIkQsIGQgTSB5eVwiLFJTUzpcIkQsIGQgTSB5XCIsVElDS1M6XCIhXCIsVElNRVNUQU1QOlwiQFwiLFczQzpcInl5LW1tLWRkXCIsX3RpY2tzVG8xOTcwOig3MTg2ODUrTWF0aC5mbG9vcig0OTIuNSktTWF0aC5mbG9vcigxOS43KStNYXRoLmZsb29yKDQuOTI1KSkqMjQqNjAqNjAqMUU3LGZvcm1hdERhdGU6ZnVuY3Rpb24oYSxiLGMpe2lmKCFiKXJldHVyblwiXCI7dmFyIGU9KGM/Yy5kYXlOYW1lc1Nob3J0Om51bGwpfHx0aGlzLl9kZWZhdWx0cy5kYXlOYW1lc1Nob3J0LGY9KGM/Yy5kYXlOYW1lczpudWxsKXx8dGhpcy5fZGVmYXVsdHMuZGF5TmFtZXMsaD0oYz9jLm1vbnRoTmFtZXNTaG9ydDpudWxsKXx8dGhpcy5fZGVmYXVsdHMubW9udGhOYW1lc1Nob3J0O2M9KGM/Yy5tb250aE5hbWVzOlxubnVsbCl8fHRoaXMuX2RlZmF1bHRzLm1vbnRoTmFtZXM7dmFyIGk9ZnVuY3Rpb24obyl7KG89aysxPGEubGVuZ3RoJiZhLmNoYXJBdChrKzEpPT1vKSYmaysrO3JldHVybiBvfSxnPWZ1bmN0aW9uKG8sbSxuKXttPVwiXCIrbTtpZihpKG8pKWZvcig7bS5sZW5ndGg8bjspbT1cIjBcIittO3JldHVybiBtfSxqPWZ1bmN0aW9uKG8sbSxuLHMpe3JldHVybiBpKG8pP3NbbV06blttXX0sbD1cIlwiLHU9ZmFsc2U7aWYoYilmb3IodmFyIGs9MDtrPGEubGVuZ3RoO2srKylpZih1KWlmKGEuY2hhckF0KGspPT1cIidcIiYmIWkoXCInXCIpKXU9ZmFsc2U7ZWxzZSBsKz1hLmNoYXJBdChrKTtlbHNlIHN3aXRjaChhLmNoYXJBdChrKSl7Y2FzZSBcImRcIjpsKz1nKFwiZFwiLGIuZ2V0RGF0ZSgpLDIpO2JyZWFrO2Nhc2UgXCJEXCI6bCs9aihcIkRcIixiLmdldERheSgpLGUsZik7YnJlYWs7Y2FzZSBcIm9cIjpsKz1nKFwib1wiLE1hdGgucm91bmQoKChuZXcgRGF0ZShiLmdldEZ1bGxZZWFyKCksYi5nZXRNb250aCgpLGIuZ2V0RGF0ZSgpKSkuZ2V0VGltZSgpLVxuKG5ldyBEYXRlKGIuZ2V0RnVsbFllYXIoKSwwLDApKS5nZXRUaW1lKCkpLzg2NEU1KSwzKTticmVhaztjYXNlIFwibVwiOmwrPWcoXCJtXCIsYi5nZXRNb250aCgpKzEsMik7YnJlYWs7Y2FzZSBcIk1cIjpsKz1qKFwiTVwiLGIuZ2V0TW9udGgoKSxoLGMpO2JyZWFrO2Nhc2UgXCJ5XCI6bCs9aShcInlcIik/Yi5nZXRGdWxsWWVhcigpOihiLmdldFllYXIoKSUxMDA8MTA/XCIwXCI6XCJcIikrYi5nZXRZZWFyKCklMTAwO2JyZWFrO2Nhc2UgXCJAXCI6bCs9Yi5nZXRUaW1lKCk7YnJlYWs7Y2FzZSBcIiFcIjpsKz1iLmdldFRpbWUoKSoxRTQrdGhpcy5fdGlja3NUbzE5NzA7YnJlYWs7Y2FzZSBcIidcIjppZihpKFwiJ1wiKSlsKz1cIidcIjtlbHNlIHU9dHJ1ZTticmVhaztkZWZhdWx0OmwrPWEuY2hhckF0KGspfXJldHVybiBsfSxfcG9zc2libGVDaGFyczpmdW5jdGlvbihhKXtmb3IodmFyIGI9XCJcIixjPWZhbHNlLGU9ZnVuY3Rpb24oaCl7KGg9ZisxPGEubGVuZ3RoJiZhLmNoYXJBdChmKzEpPT1oKSYmZisrO3JldHVybiBofSxmPVxuMDtmPGEubGVuZ3RoO2YrKylpZihjKWlmKGEuY2hhckF0KGYpPT1cIidcIiYmIWUoXCInXCIpKWM9ZmFsc2U7ZWxzZSBiKz1hLmNoYXJBdChmKTtlbHNlIHN3aXRjaChhLmNoYXJBdChmKSl7Y2FzZSBcImRcIjpjYXNlIFwibVwiOmNhc2UgXCJ5XCI6Y2FzZSBcIkBcIjpiKz1cIjAxMjM0NTY3ODlcIjticmVhaztjYXNlIFwiRFwiOmNhc2UgXCJNXCI6cmV0dXJuIG51bGw7Y2FzZSBcIidcIjppZihlKFwiJ1wiKSliKz1cIidcIjtlbHNlIGM9dHJ1ZTticmVhaztkZWZhdWx0OmIrPWEuY2hhckF0KGYpfXJldHVybiBifSxfZ2V0OmZ1bmN0aW9uKGEsYil7cmV0dXJuIGEuc2V0dGluZ3NbYl0hPT1DP2Euc2V0dGluZ3NbYl06dGhpcy5fZGVmYXVsdHNbYl19LF9zZXREYXRlRnJvbUZpZWxkOmZ1bmN0aW9uKGEsYil7aWYoYS5pbnB1dC52YWwoKSE9YS5sYXN0VmFsKXt2YXIgYz10aGlzLl9nZXQoYSxcImRhdGVGb3JtYXRcIiksZT1hLmxhc3RWYWw9YS5pbnB1dD9hLmlucHV0LnZhbCgpOm51bGwsZixoO2Y9aD10aGlzLl9nZXREZWZhdWx0RGF0ZShhKTtcbnZhciBpPXRoaXMuX2dldEZvcm1hdENvbmZpZyhhKTt0cnl7Zj10aGlzLnBhcnNlRGF0ZShjLGUsaSl8fGh9Y2F0Y2goZyl7dGhpcy5sb2coZyk7ZT1iP1wiXCI6ZX1hLnNlbGVjdGVkRGF5PWYuZ2V0RGF0ZSgpO2EuZHJhd01vbnRoPWEuc2VsZWN0ZWRNb250aD1mLmdldE1vbnRoKCk7YS5kcmF3WWVhcj1hLnNlbGVjdGVkWWVhcj1mLmdldEZ1bGxZZWFyKCk7YS5jdXJyZW50RGF5PWU/Zi5nZXREYXRlKCk6MDthLmN1cnJlbnRNb250aD1lP2YuZ2V0TW9udGgoKTowO2EuY3VycmVudFllYXI9ZT9mLmdldEZ1bGxZZWFyKCk6MDt0aGlzLl9hZGp1c3RJbnN0RGF0ZShhKX19LF9nZXREZWZhdWx0RGF0ZTpmdW5jdGlvbihhKXtyZXR1cm4gdGhpcy5fcmVzdHJpY3RNaW5NYXgoYSx0aGlzLl9kZXRlcm1pbmVEYXRlKGEsdGhpcy5fZ2V0KGEsXCJkZWZhdWx0RGF0ZVwiKSxuZXcgRGF0ZSkpfSxfZGV0ZXJtaW5lRGF0ZTpmdW5jdGlvbihhLGIsYyl7dmFyIGU9ZnVuY3Rpb24oaCl7dmFyIGk9bmV3IERhdGU7XG5pLnNldERhdGUoaS5nZXREYXRlKCkraCk7cmV0dXJuIGl9LGY9ZnVuY3Rpb24oaCl7dHJ5e3JldHVybiBkLmRhdGVwaWNrZXIucGFyc2VEYXRlKGQuZGF0ZXBpY2tlci5fZ2V0KGEsXCJkYXRlRm9ybWF0XCIpLGgsZC5kYXRlcGlja2VyLl9nZXRGb3JtYXRDb25maWcoYSkpfWNhdGNoKGkpe312YXIgZz0oaC50b0xvd2VyQ2FzZSgpLm1hdGNoKC9eYy8pP2QuZGF0ZXBpY2tlci5fZ2V0RGF0ZShhKTpudWxsKXx8bmV3IERhdGUsaj1nLmdldEZ1bGxZZWFyKCksbD1nLmdldE1vbnRoKCk7Zz1nLmdldERhdGUoKTtmb3IodmFyIHU9LyhbKy1dP1swLTldKylcXHMqKGR8RHx3fFd8bXxNfHl8WSk/L2csaz11LmV4ZWMoaCk7azspe3N3aXRjaChrWzJdfHxcImRcIil7Y2FzZSBcImRcIjpjYXNlIFwiRFwiOmcrPXBhcnNlSW50KGtbMV0sMTApO2JyZWFrO2Nhc2UgXCJ3XCI6Y2FzZSBcIldcIjpnKz1wYXJzZUludChrWzFdLDEwKSo3O2JyZWFrO2Nhc2UgXCJtXCI6Y2FzZSBcIk1cIjpsKz1wYXJzZUludChrWzFdLDEwKTtnPVxuTWF0aC5taW4oZyxkLmRhdGVwaWNrZXIuX2dldERheXNJbk1vbnRoKGosbCkpO2JyZWFrO2Nhc2UgXCJ5XCI6Y2FzZSBcIllcIjpqKz1wYXJzZUludChrWzFdLDEwKTtnPU1hdGgubWluKGcsZC5kYXRlcGlja2VyLl9nZXREYXlzSW5Nb250aChqLGwpKTticmVha31rPXUuZXhlYyhoKX1yZXR1cm4gbmV3IERhdGUoaixsLGcpfTtpZihiPShiPWI9PW51bGx8fGI9PT1cIlwiP2M6dHlwZW9mIGI9PVwic3RyaW5nXCI/ZihiKTp0eXBlb2YgYj09XCJudW1iZXJcIj9pc05hTihiKT9jOmUoYik6bmV3IERhdGUoYi5nZXRUaW1lKCkpKSYmYi50b1N0cmluZygpPT1cIkludmFsaWQgRGF0ZVwiP2M6Yil7Yi5zZXRIb3VycygwKTtiLnNldE1pbnV0ZXMoMCk7Yi5zZXRTZWNvbmRzKDApO2Iuc2V0TWlsbGlzZWNvbmRzKDApfXJldHVybiB0aGlzLl9kYXlsaWdodFNhdmluZ0FkanVzdChiKX0sX2RheWxpZ2h0U2F2aW5nQWRqdXN0OmZ1bmN0aW9uKGEpe2lmKCFhKXJldHVybiBudWxsO2Euc2V0SG91cnMoYS5nZXRIb3VycygpPlxuMTI/YS5nZXRIb3VycygpKzI6MCk7cmV0dXJuIGF9LF9zZXREYXRlOmZ1bmN0aW9uKGEsYixjKXt2YXIgZT0hYixmPWEuc2VsZWN0ZWRNb250aCxoPWEuc2VsZWN0ZWRZZWFyO2I9dGhpcy5fcmVzdHJpY3RNaW5NYXgoYSx0aGlzLl9kZXRlcm1pbmVEYXRlKGEsYixuZXcgRGF0ZSkpO2Euc2VsZWN0ZWREYXk9YS5jdXJyZW50RGF5PWIuZ2V0RGF0ZSgpO2EuZHJhd01vbnRoPWEuc2VsZWN0ZWRNb250aD1hLmN1cnJlbnRNb250aD1iLmdldE1vbnRoKCk7YS5kcmF3WWVhcj1hLnNlbGVjdGVkWWVhcj1hLmN1cnJlbnRZZWFyPWIuZ2V0RnVsbFllYXIoKTtpZigoZiE9YS5zZWxlY3RlZE1vbnRofHxoIT1hLnNlbGVjdGVkWWVhcikmJiFjKXRoaXMuX25vdGlmeUNoYW5nZShhKTt0aGlzLl9hZGp1c3RJbnN0RGF0ZShhKTtpZihhLmlucHV0KWEuaW5wdXQudmFsKGU/XCJcIjp0aGlzLl9mb3JtYXREYXRlKGEpKX0sX2dldERhdGU6ZnVuY3Rpb24oYSl7cmV0dXJuIWEuY3VycmVudFllYXJ8fGEuaW5wdXQmJlxuYS5pbnB1dC52YWwoKT09XCJcIj9udWxsOnRoaXMuX2RheWxpZ2h0U2F2aW5nQWRqdXN0KG5ldyBEYXRlKGEuY3VycmVudFllYXIsYS5jdXJyZW50TW9udGgsYS5jdXJyZW50RGF5KSl9LF9nZW5lcmF0ZUhUTUw6ZnVuY3Rpb24oYSl7dmFyIGI9bmV3IERhdGU7Yj10aGlzLl9kYXlsaWdodFNhdmluZ0FkanVzdChuZXcgRGF0ZShiLmdldEZ1bGxZZWFyKCksYi5nZXRNb250aCgpLGIuZ2V0RGF0ZSgpKSk7dmFyIGM9dGhpcy5fZ2V0KGEsXCJpc1JUTFwiKSxlPXRoaXMuX2dldChhLFwic2hvd0J1dHRvblBhbmVsXCIpLGY9dGhpcy5fZ2V0KGEsXCJoaWRlSWZOb1ByZXZOZXh0XCIpLGg9dGhpcy5fZ2V0KGEsXCJuYXZpZ2F0aW9uQXNEYXRlRm9ybWF0XCIpLGk9dGhpcy5fZ2V0TnVtYmVyT2ZNb250aHMoYSksZz10aGlzLl9nZXQoYSxcInNob3dDdXJyZW50QXRQb3NcIiksaj10aGlzLl9nZXQoYSxcInN0ZXBNb250aHNcIiksbD1pWzBdIT0xfHxpWzFdIT0xLHU9dGhpcy5fZGF5bGlnaHRTYXZpbmdBZGp1c3QoIWEuY3VycmVudERheT9cbm5ldyBEYXRlKDk5OTksOSw5KTpuZXcgRGF0ZShhLmN1cnJlbnRZZWFyLGEuY3VycmVudE1vbnRoLGEuY3VycmVudERheSkpLGs9dGhpcy5fZ2V0TWluTWF4RGF0ZShhLFwibWluXCIpLG89dGhpcy5fZ2V0TWluTWF4RGF0ZShhLFwibWF4XCIpO2c9YS5kcmF3TW9udGgtZzt2YXIgbT1hLmRyYXdZZWFyO2lmKGc8MCl7Zys9MTI7bS0tfWlmKG8pe3ZhciBuPXRoaXMuX2RheWxpZ2h0U2F2aW5nQWRqdXN0KG5ldyBEYXRlKG8uZ2V0RnVsbFllYXIoKSxvLmdldE1vbnRoKCktaVswXSppWzFdKzEsby5nZXREYXRlKCkpKTtmb3Iobj1rJiZuPGs/azpuO3RoaXMuX2RheWxpZ2h0U2F2aW5nQWRqdXN0KG5ldyBEYXRlKG0sZywxKSk+bjspe2ctLTtpZihnPDApe2c9MTE7bS0tfX19YS5kcmF3TW9udGg9ZzthLmRyYXdZZWFyPW07bj10aGlzLl9nZXQoYSxcInByZXZUZXh0XCIpO249IWg/bjp0aGlzLmZvcm1hdERhdGUobix0aGlzLl9kYXlsaWdodFNhdmluZ0FkanVzdChuZXcgRGF0ZShtLGctaiwxKSksdGhpcy5fZ2V0Rm9ybWF0Q29uZmlnKGEpKTtcbm49dGhpcy5fY2FuQWRqdXN0TW9udGgoYSwtMSxtLGcpPyc8YSBjbGFzcz1cInVpLWRhdGVwaWNrZXItcHJldiB1aS1jb3JuZXItYWxsXCIgb25jbGljaz1cIkRQX2pRdWVyeV8nK0IrXCIuZGF0ZXBpY2tlci5fYWRqdXN0RGF0ZSgnI1wiK2EuaWQrXCInLCAtXCIraitcIiwgJ00nKTtcXFwiIHRpdGxlPVxcXCJcIituKydcIj48c3BhbiBjbGFzcz1cInVpLWljb24gdWktaWNvbi1jaXJjbGUtdHJpYW5nbGUtJysoYz9cImVcIjpcIndcIikrJ1wiPicrbitcIjwvc3Bhbj48L2E+XCI6Zj9cIlwiOic8YSBjbGFzcz1cInVpLWRhdGVwaWNrZXItcHJldiB1aS1jb3JuZXItYWxsIHVpLXN0YXRlLWRpc2FibGVkXCIgdGl0bGU9XCInK24rJ1wiPjxzcGFuIGNsYXNzPVwidWktaWNvbiB1aS1pY29uLWNpcmNsZS10cmlhbmdsZS0nKyhjP1wiZVwiOlwid1wiKSsnXCI+JytuK1wiPC9zcGFuPjwvYT5cIjt2YXIgcz10aGlzLl9nZXQoYSxcIm5leHRUZXh0XCIpO3M9IWg/czp0aGlzLmZvcm1hdERhdGUocyx0aGlzLl9kYXlsaWdodFNhdmluZ0FkanVzdChuZXcgRGF0ZShtLFxuZytqLDEpKSx0aGlzLl9nZXRGb3JtYXRDb25maWcoYSkpO2Y9dGhpcy5fY2FuQWRqdXN0TW9udGgoYSwrMSxtLGcpPyc8YSBjbGFzcz1cInVpLWRhdGVwaWNrZXItbmV4dCB1aS1jb3JuZXItYWxsXCIgb25jbGljaz1cIkRQX2pRdWVyeV8nK0IrXCIuZGF0ZXBpY2tlci5fYWRqdXN0RGF0ZSgnI1wiK2EuaWQrXCInLCArXCIraitcIiwgJ00nKTtcXFwiIHRpdGxlPVxcXCJcIitzKydcIj48c3BhbiBjbGFzcz1cInVpLWljb24gdWktaWNvbi1jaXJjbGUtdHJpYW5nbGUtJysoYz9cIndcIjpcImVcIikrJ1wiPicrcytcIjwvc3Bhbj48L2E+XCI6Zj9cIlwiOic8YSBjbGFzcz1cInVpLWRhdGVwaWNrZXItbmV4dCB1aS1jb3JuZXItYWxsIHVpLXN0YXRlLWRpc2FibGVkXCIgdGl0bGU9XCInK3MrJ1wiPjxzcGFuIGNsYXNzPVwidWktaWNvbiB1aS1pY29uLWNpcmNsZS10cmlhbmdsZS0nKyhjP1wid1wiOlwiZVwiKSsnXCI+JytzK1wiPC9zcGFuPjwvYT5cIjtqPXRoaXMuX2dldChhLFwiY3VycmVudFRleHRcIik7cz10aGlzLl9nZXQoYSxcImdvdG9DdXJyZW50XCIpJiZcbmEuY3VycmVudERheT91OmI7aj0haD9qOnRoaXMuZm9ybWF0RGF0ZShqLHMsdGhpcy5fZ2V0Rm9ybWF0Q29uZmlnKGEpKTtoPSFhLmlubGluZT8nPGJ1dHRvbiB0eXBlPVwiYnV0dG9uXCIgY2xhc3M9XCJ1aS1kYXRlcGlja2VyLWNsb3NlIHVpLXN0YXRlLWRlZmF1bHQgdWktcHJpb3JpdHktcHJpbWFyeSB1aS1jb3JuZXItYWxsXCIgb25jbGljaz1cIkRQX2pRdWVyeV8nK0IrJy5kYXRlcGlja2VyLl9oaWRlRGF0ZXBpY2tlcigpO1wiPicrdGhpcy5fZ2V0KGEsXCJjbG9zZVRleHRcIikrXCI8L2J1dHRvbj5cIjpcIlwiO2U9ZT8nPGRpdiBjbGFzcz1cInVpLWRhdGVwaWNrZXItYnV0dG9ucGFuZSB1aS13aWRnZXQtY29udGVudFwiPicrKGM/aDpcIlwiKSsodGhpcy5faXNJblJhbmdlKGEscyk/JzxidXR0b24gdHlwZT1cImJ1dHRvblwiIGNsYXNzPVwidWktZGF0ZXBpY2tlci1jdXJyZW50IHVpLXN0YXRlLWRlZmF1bHQgdWktcHJpb3JpdHktc2Vjb25kYXJ5IHVpLWNvcm5lci1hbGxcIiBvbmNsaWNrPVwiRFBfalF1ZXJ5XycrXG5CK1wiLmRhdGVwaWNrZXIuX2dvdG9Ub2RheSgnI1wiK2EuaWQrXCInKTtcXFwiPlwiK2orXCI8L2J1dHRvbj5cIjpcIlwiKSsoYz9cIlwiOmgpK1wiPC9kaXY+XCI6XCJcIjtoPXBhcnNlSW50KHRoaXMuX2dldChhLFwiZmlyc3REYXlcIiksMTApO2g9aXNOYU4oaCk/MDpoO2o9dGhpcy5fZ2V0KGEsXCJzaG93V2Vla1wiKTtzPXRoaXMuX2dldChhLFwiZGF5TmFtZXNcIik7dGhpcy5fZ2V0KGEsXCJkYXlOYW1lc1Nob3J0XCIpO3ZhciBxPXRoaXMuX2dldChhLFwiZGF5TmFtZXNNaW5cIiksQT10aGlzLl9nZXQoYSxcIm1vbnRoTmFtZXNcIiksdj10aGlzLl9nZXQoYSxcIm1vbnRoTmFtZXNTaG9ydFwiKSxwPXRoaXMuX2dldChhLFwiYmVmb3JlU2hvd0RheVwiKSxEPXRoaXMuX2dldChhLFwic2hvd090aGVyTW9udGhzXCIpLEs9dGhpcy5fZ2V0KGEsXCJzZWxlY3RPdGhlck1vbnRoc1wiKTt0aGlzLl9nZXQoYSxcImNhbGN1bGF0ZVdlZWtcIik7Zm9yKHZhciBFPXRoaXMuX2dldERlZmF1bHREYXRlKGEpLHc9XCJcIix4PTA7eDxpWzBdO3grKyl7dmFyIE89XG5cIlwiO3RoaXMubWF4Um93cz00O2Zvcih2YXIgRz0wO0c8aVsxXTtHKyspe3ZhciBQPXRoaXMuX2RheWxpZ2h0U2F2aW5nQWRqdXN0KG5ldyBEYXRlKG0sZyxhLnNlbGVjdGVkRGF5KSksdD1cIiB1aS1jb3JuZXItYWxsXCIseT1cIlwiO2lmKGwpe3krPSc8ZGl2IGNsYXNzPVwidWktZGF0ZXBpY2tlci1ncm91cCc7aWYoaVsxXT4xKXN3aXRjaChHKXtjYXNlIDA6eSs9XCIgdWktZGF0ZXBpY2tlci1ncm91cC1maXJzdFwiO3Q9XCIgdWktY29ybmVyLVwiKyhjP1wicmlnaHRcIjpcImxlZnRcIik7YnJlYWs7Y2FzZSBpWzFdLTE6eSs9XCIgdWktZGF0ZXBpY2tlci1ncm91cC1sYXN0XCI7dD1cIiB1aS1jb3JuZXItXCIrKGM/XCJsZWZ0XCI6XCJyaWdodFwiKTticmVhaztkZWZhdWx0OnkrPVwiIHVpLWRhdGVwaWNrZXItZ3JvdXAtbWlkZGxlXCI7dD1cIlwiO2JyZWFrfXkrPSdcIj4nfXkrPSc8ZGl2IGNsYXNzPVwidWktZGF0ZXBpY2tlci1oZWFkZXIgdWktd2lkZ2V0LWhlYWRlciB1aS1oZWxwZXItY2xlYXJmaXgnK3QrJ1wiPicrKC9hbGx8bGVmdC8udGVzdCh0KSYmXG54PT0wP2M/ZjpuOlwiXCIpKygvYWxsfHJpZ2h0Ly50ZXN0KHQpJiZ4PT0wP2M/bjpmOlwiXCIpK3RoaXMuX2dlbmVyYXRlTW9udGhZZWFySGVhZGVyKGEsZyxtLGssbyx4PjB8fEc+MCxBLHYpKyc8L2Rpdj48dGFibGUgY2xhc3M9XCJ1aS1kYXRlcGlja2VyLWNhbGVuZGFyXCI+PHRoZWFkPjx0cj4nO3ZhciB6PWo/Jzx0aCBjbGFzcz1cInVpLWRhdGVwaWNrZXItd2Vlay1jb2xcIj4nK3RoaXMuX2dldChhLFwid2Vla0hlYWRlclwiKStcIjwvdGg+XCI6XCJcIjtmb3IodD0wO3Q8Nzt0Kyspe3ZhciByPSh0K2gpJTc7eis9XCI8dGhcIisoKHQraCs2KSU3Pj01PycgY2xhc3M9XCJ1aS1kYXRlcGlja2VyLXdlZWstZW5kXCInOlwiXCIpKyc+PHNwYW4gdGl0bGU9XCInK3Nbcl0rJ1wiPicrcVtyXStcIjwvc3Bhbj48L3RoPlwifXkrPXorXCI8L3RyPjwvdGhlYWQ+PHRib2R5PlwiO3o9dGhpcy5fZ2V0RGF5c0luTW9udGgobSxnKTtpZihtPT1hLnNlbGVjdGVkWWVhciYmZz09YS5zZWxlY3RlZE1vbnRoKWEuc2VsZWN0ZWREYXk9TWF0aC5taW4oYS5zZWxlY3RlZERheSxcbnopO3Q9KHRoaXMuX2dldEZpcnN0RGF5T2ZNb250aChtLGcpLWgrNyklNzt6PU1hdGguY2VpbCgodCt6KS83KTt0aGlzLm1heFJvd3M9ej1sP3RoaXMubWF4Um93cz56P3RoaXMubWF4Um93czp6Ono7cj10aGlzLl9kYXlsaWdodFNhdmluZ0FkanVzdChuZXcgRGF0ZShtLGcsMS10KSk7Zm9yKHZhciBRPTA7UTx6O1ErKyl7eSs9XCI8dHI+XCI7dmFyIFI9IWo/XCJcIjonPHRkIGNsYXNzPVwidWktZGF0ZXBpY2tlci13ZWVrLWNvbFwiPicrdGhpcy5fZ2V0KGEsXCJjYWxjdWxhdGVXZWVrXCIpKHIpK1wiPC90ZD5cIjtmb3IodD0wO3Q8Nzt0Kyspe3ZhciBJPXA/cC5hcHBseShhLmlucHV0P2EuaW5wdXRbMF06bnVsbCxbcl0pOlt0cnVlLFwiXCJdLEY9ci5nZXRNb250aCgpIT1nLEw9RiYmIUt8fCFJWzBdfHxrJiZyPGt8fG8mJnI+bztSKz0nPHRkIGNsYXNzPVwiJysoKHQraCs2KSU3Pj01P1wiIHVpLWRhdGVwaWNrZXItd2Vlay1lbmRcIjpcIlwiKSsoRj9cIiB1aS1kYXRlcGlja2VyLW90aGVyLW1vbnRoXCI6XCJcIikrKHIuZ2V0VGltZSgpPT1cblAuZ2V0VGltZSgpJiZnPT1hLnNlbGVjdGVkTW9udGgmJmEuX2tleUV2ZW50fHxFLmdldFRpbWUoKT09ci5nZXRUaW1lKCkmJkUuZ2V0VGltZSgpPT1QLmdldFRpbWUoKT9cIiBcIit0aGlzLl9kYXlPdmVyQ2xhc3M6XCJcIikrKEw/XCIgXCIrdGhpcy5fdW5zZWxlY3RhYmxlQ2xhc3MrXCIgdWktc3RhdGUtZGlzYWJsZWRcIjpcIlwiKSsoRiYmIUQ/XCJcIjpcIiBcIitJWzFdKyhyLmdldFRpbWUoKT09dS5nZXRUaW1lKCk/XCIgXCIrdGhpcy5fY3VycmVudENsYXNzOlwiXCIpKyhyLmdldFRpbWUoKT09Yi5nZXRUaW1lKCk/XCIgdWktZGF0ZXBpY2tlci10b2RheVwiOlwiXCIpKSsnXCInKygoIUZ8fEQpJiZJWzJdPycgdGl0bGU9XCInK0lbMl0rJ1wiJzpcIlwiKSsoTD9cIlwiOicgb25jbGljaz1cIkRQX2pRdWVyeV8nK0IrXCIuZGF0ZXBpY2tlci5fc2VsZWN0RGF5KCcjXCIrYS5pZCtcIicsXCIrci5nZXRNb250aCgpK1wiLFwiK3IuZ2V0RnVsbFllYXIoKSsnLCB0aGlzKTtyZXR1cm4gZmFsc2U7XCInKStcIj5cIisoRiYmIUQ/XCImI3hhMDtcIjpMPyc8c3BhbiBjbGFzcz1cInVpLXN0YXRlLWRlZmF1bHRcIj4nK1xuci5nZXREYXRlKCkrXCI8L3NwYW4+XCI6JzxhIGNsYXNzPVwidWktc3RhdGUtZGVmYXVsdCcrKHIuZ2V0VGltZSgpPT1iLmdldFRpbWUoKT9cIiB1aS1zdGF0ZS1oaWdobGlnaHRcIjpcIlwiKSsoci5nZXRUaW1lKCk9PXUuZ2V0VGltZSgpP1wiIHVpLXN0YXRlLWFjdGl2ZVwiOlwiXCIpKyhGP1wiIHVpLXByaW9yaXR5LXNlY29uZGFyeVwiOlwiXCIpKydcIiBocmVmPVwiI1wiPicrci5nZXREYXRlKCkrXCI8L2E+XCIpK1wiPC90ZD5cIjtyLnNldERhdGUoci5nZXREYXRlKCkrMSk7cj10aGlzLl9kYXlsaWdodFNhdmluZ0FkanVzdChyKX15Kz1SK1wiPC90cj5cIn1nKys7aWYoZz4xMSl7Zz0wO20rK315Kz1cIjwvdGJvZHk+PC90YWJsZT5cIisobD9cIjwvZGl2PlwiKyhpWzBdPjAmJkc9PWlbMV0tMT8nPGRpdiBjbGFzcz1cInVpLWRhdGVwaWNrZXItcm93LWJyZWFrXCI+PC9kaXY+JzpcIlwiKTpcIlwiKTtPKz15fXcrPU99dys9ZSsoZC5icm93c2VyLm1zaWUmJnBhcnNlSW50KGQuYnJvd3Nlci52ZXJzaW9uLDEwKTw3JiYhYS5pbmxpbmU/JzxpZnJhbWUgc3JjPVwiamF2YXNjcmlwdDpmYWxzZTtcIiBjbGFzcz1cInVpLWRhdGVwaWNrZXItY292ZXJcIiBmcmFtZWJvcmRlcj1cIjBcIj48L2lmcmFtZT4nOlxuXCJcIik7YS5fa2V5RXZlbnQ9ZmFsc2U7cmV0dXJuIHd9LF9nZW5lcmF0ZU1vbnRoWWVhckhlYWRlcjpmdW5jdGlvbihhLGIsYyxlLGYsaCxpLGcpe3ZhciBqPXRoaXMuX2dldChhLFwiY2hhbmdlTW9udGhcIiksbD10aGlzLl9nZXQoYSxcImNoYW5nZVllYXJcIiksdT10aGlzLl9nZXQoYSxcInNob3dNb250aEFmdGVyWWVhclwiKSxrPSc8ZGl2IGNsYXNzPVwidWktZGF0ZXBpY2tlci10aXRsZVwiPicsbz1cIlwiO2lmKGh8fCFqKW8rPSc8c3BhbiBjbGFzcz1cInVpLWRhdGVwaWNrZXItbW9udGhcIj4nK2lbYl0rXCI8L3NwYW4+XCI7ZWxzZXtpPWUmJmUuZ2V0RnVsbFllYXIoKT09Yzt2YXIgbT1mJiZmLmdldEZ1bGxZZWFyKCk9PWM7bys9JzxzZWxlY3QgY2xhc3M9XCJ1aS1kYXRlcGlja2VyLW1vbnRoXCIgb25jaGFuZ2U9XCJEUF9qUXVlcnlfJytCK1wiLmRhdGVwaWNrZXIuX3NlbGVjdE1vbnRoWWVhcignI1wiK2EuaWQrXCInLCB0aGlzLCAnTScpO1xcXCIgPlwiO2Zvcih2YXIgbj0wO248MTI7bisrKWlmKCghaXx8bj49ZS5nZXRNb250aCgpKSYmXG4oIW18fG48PWYuZ2V0TW9udGgoKSkpbys9JzxvcHRpb24gdmFsdWU9XCInK24rJ1wiJysobj09Yj8nIHNlbGVjdGVkPVwic2VsZWN0ZWRcIic6XCJcIikrXCI+XCIrZ1tuXStcIjwvb3B0aW9uPlwiO28rPVwiPC9zZWxlY3Q+XCJ9dXx8KGsrPW8rKGh8fCEoaiYmbCk/XCImI3hhMDtcIjpcIlwiKSk7aWYoIWEueWVhcnNodG1sKXthLnllYXJzaHRtbD1cIlwiO2lmKGh8fCFsKWsrPSc8c3BhbiBjbGFzcz1cInVpLWRhdGVwaWNrZXIteWVhclwiPicrYytcIjwvc3Bhbj5cIjtlbHNle2c9dGhpcy5fZ2V0KGEsXCJ5ZWFyUmFuZ2VcIikuc3BsaXQoXCI6XCIpO3ZhciBzPShuZXcgRGF0ZSkuZ2V0RnVsbFllYXIoKTtpPWZ1bmN0aW9uKHEpe3E9cS5tYXRjaCgvY1srLV0uKi8pP2MrcGFyc2VJbnQocS5zdWJzdHJpbmcoMSksMTApOnEubWF0Y2goL1srLV0uKi8pP3MrcGFyc2VJbnQocSwxMCk6cGFyc2VJbnQocSwxMCk7cmV0dXJuIGlzTmFOKHEpP3M6cX07Yj1pKGdbMF0pO2c9TWF0aC5tYXgoYixpKGdbMV18fFwiXCIpKTtiPWU/TWF0aC5tYXgoYixcbmUuZ2V0RnVsbFllYXIoKSk6YjtnPWY/TWF0aC5taW4oZyxmLmdldEZ1bGxZZWFyKCkpOmc7Zm9yKGEueWVhcnNodG1sKz0nPHNlbGVjdCBjbGFzcz1cInVpLWRhdGVwaWNrZXIteWVhclwiIG9uY2hhbmdlPVwiRFBfalF1ZXJ5XycrQitcIi5kYXRlcGlja2VyLl9zZWxlY3RNb250aFllYXIoJyNcIithLmlkK1wiJywgdGhpcywgJ1knKTtcXFwiID5cIjtiPD1nO2IrKylhLnllYXJzaHRtbCs9JzxvcHRpb24gdmFsdWU9XCInK2IrJ1wiJysoYj09Yz8nIHNlbGVjdGVkPVwic2VsZWN0ZWRcIic6XCJcIikrXCI+XCIrYitcIjwvb3B0aW9uPlwiO2EueWVhcnNodG1sKz1cIjwvc2VsZWN0PlwiO2srPWEueWVhcnNodG1sO2EueWVhcnNodG1sPW51bGx9fWsrPXRoaXMuX2dldChhLFwieWVhclN1ZmZpeFwiKTtpZih1KWsrPShofHwhKGomJmwpP1wiJiN4YTA7XCI6XCJcIikrbztrKz1cIjwvZGl2PlwiO3JldHVybiBrfSxfYWRqdXN0SW5zdERhdGU6ZnVuY3Rpb24oYSxiLGMpe3ZhciBlPWEuZHJhd1llYXIrKGM9PVwiWVwiP2I6MCksZj1hLmRyYXdNb250aCtcbihjPT1cIk1cIj9iOjApO2I9TWF0aC5taW4oYS5zZWxlY3RlZERheSx0aGlzLl9nZXREYXlzSW5Nb250aChlLGYpKSsoYz09XCJEXCI/YjowKTtlPXRoaXMuX3Jlc3RyaWN0TWluTWF4KGEsdGhpcy5fZGF5bGlnaHRTYXZpbmdBZGp1c3QobmV3IERhdGUoZSxmLGIpKSk7YS5zZWxlY3RlZERheT1lLmdldERhdGUoKTthLmRyYXdNb250aD1hLnNlbGVjdGVkTW9udGg9ZS5nZXRNb250aCgpO2EuZHJhd1llYXI9YS5zZWxlY3RlZFllYXI9ZS5nZXRGdWxsWWVhcigpO2lmKGM9PVwiTVwifHxjPT1cIllcIil0aGlzLl9ub3RpZnlDaGFuZ2UoYSl9LF9yZXN0cmljdE1pbk1heDpmdW5jdGlvbihhLGIpe3ZhciBjPXRoaXMuX2dldE1pbk1heERhdGUoYSxcIm1pblwiKTthPXRoaXMuX2dldE1pbk1heERhdGUoYSxcIm1heFwiKTtiPWMmJmI8Yz9jOmI7cmV0dXJuIGI9YSYmYj5hP2E6Yn0sX25vdGlmeUNoYW5nZTpmdW5jdGlvbihhKXt2YXIgYj10aGlzLl9nZXQoYSxcIm9uQ2hhbmdlTW9udGhZZWFyXCIpO2lmKGIpYi5hcHBseShhLmlucHV0P1xuYS5pbnB1dFswXTpudWxsLFthLnNlbGVjdGVkWWVhcixhLnNlbGVjdGVkTW9udGgrMSxhXSl9LF9nZXROdW1iZXJPZk1vbnRoczpmdW5jdGlvbihhKXthPXRoaXMuX2dldChhLFwibnVtYmVyT2ZNb250aHNcIik7cmV0dXJuIGE9PW51bGw/WzEsMV06dHlwZW9mIGE9PVwibnVtYmVyXCI/WzEsYV06YX0sX2dldE1pbk1heERhdGU6ZnVuY3Rpb24oYSxiKXtyZXR1cm4gdGhpcy5fZGV0ZXJtaW5lRGF0ZShhLHRoaXMuX2dldChhLGIrXCJEYXRlXCIpLG51bGwpfSxfZ2V0RGF5c0luTW9udGg6ZnVuY3Rpb24oYSxiKXtyZXR1cm4gMzItdGhpcy5fZGF5bGlnaHRTYXZpbmdBZGp1c3QobmV3IERhdGUoYSxiLDMyKSkuZ2V0RGF0ZSgpfSxfZ2V0Rmlyc3REYXlPZk1vbnRoOmZ1bmN0aW9uKGEsYil7cmV0dXJuKG5ldyBEYXRlKGEsYiwxKSkuZ2V0RGF5KCl9LF9jYW5BZGp1c3RNb250aDpmdW5jdGlvbihhLGIsYyxlKXt2YXIgZj10aGlzLl9nZXROdW1iZXJPZk1vbnRocyhhKTtjPXRoaXMuX2RheWxpZ2h0U2F2aW5nQWRqdXN0KG5ldyBEYXRlKGMsXG5lKyhiPDA/YjpmWzBdKmZbMV0pLDEpKTtiPDAmJmMuc2V0RGF0ZSh0aGlzLl9nZXREYXlzSW5Nb250aChjLmdldEZ1bGxZZWFyKCksYy5nZXRNb250aCgpKSk7cmV0dXJuIHRoaXMuX2lzSW5SYW5nZShhLGMpfSxfaXNJblJhbmdlOmZ1bmN0aW9uKGEsYil7dmFyIGM9dGhpcy5fZ2V0TWluTWF4RGF0ZShhLFwibWluXCIpO2E9dGhpcy5fZ2V0TWluTWF4RGF0ZShhLFwibWF4XCIpO3JldHVybighY3x8Yi5nZXRUaW1lKCk+PWMuZ2V0VGltZSgpKSYmKCFhfHxiLmdldFRpbWUoKTw9YS5nZXRUaW1lKCkpfSxfZ2V0Rm9ybWF0Q29uZmlnOmZ1bmN0aW9uKGEpe3ZhciBiPXRoaXMuX2dldChhLFwic2hvcnRZZWFyQ3V0b2ZmXCIpO2I9dHlwZW9mIGIhPVwic3RyaW5nXCI/YjoobmV3IERhdGUpLmdldEZ1bGxZZWFyKCklMTAwK3BhcnNlSW50KGIsMTApO3JldHVybntzaG9ydFllYXJDdXRvZmY6YixkYXlOYW1lc1Nob3J0OnRoaXMuX2dldChhLFwiZGF5TmFtZXNTaG9ydFwiKSxkYXlOYW1lczp0aGlzLl9nZXQoYSxcblwiZGF5TmFtZXNcIiksbW9udGhOYW1lc1Nob3J0OnRoaXMuX2dldChhLFwibW9udGhOYW1lc1Nob3J0XCIpLG1vbnRoTmFtZXM6dGhpcy5fZ2V0KGEsXCJtb250aE5hbWVzXCIpfX0sX2Zvcm1hdERhdGU6ZnVuY3Rpb24oYSxiLGMsZSl7aWYoIWIpe2EuY3VycmVudERheT1hLnNlbGVjdGVkRGF5O2EuY3VycmVudE1vbnRoPWEuc2VsZWN0ZWRNb250aDthLmN1cnJlbnRZZWFyPWEuc2VsZWN0ZWRZZWFyfWI9Yj90eXBlb2YgYj09XCJvYmplY3RcIj9iOnRoaXMuX2RheWxpZ2h0U2F2aW5nQWRqdXN0KG5ldyBEYXRlKGUsYyxiKSk6dGhpcy5fZGF5bGlnaHRTYXZpbmdBZGp1c3QobmV3IERhdGUoYS5jdXJyZW50WWVhcixhLmN1cnJlbnRNb250aCxhLmN1cnJlbnREYXkpKTtyZXR1cm4gdGhpcy5mb3JtYXREYXRlKHRoaXMuX2dldChhLFwiZGF0ZUZvcm1hdFwiKSxiLHRoaXMuX2dldEZvcm1hdENvbmZpZyhhKSl9fSk7ZC5mbi5kYXRlcGlja2VyPWZ1bmN0aW9uKGEpe2lmKCF0aGlzLmxlbmd0aClyZXR1cm4gdGhpcztcbmlmKCFkLmRhdGVwaWNrZXIuaW5pdGlhbGl6ZWQpe2QoZG9jdW1lbnQpLm1vdXNlZG93bihkLmRhdGVwaWNrZXIuX2NoZWNrRXh0ZXJuYWxDbGljaykuZmluZChcImJvZHlcIikuYXBwZW5kKGQuZGF0ZXBpY2tlci5kcERpdik7ZC5kYXRlcGlja2VyLmluaXRpYWxpemVkPXRydWV9dmFyIGI9QXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYXJndW1lbnRzLDEpO2lmKHR5cGVvZiBhPT1cInN0cmluZ1wiJiYoYT09XCJpc0Rpc2FibGVkXCJ8fGE9PVwiZ2V0RGF0ZVwifHxhPT1cIndpZGdldFwiKSlyZXR1cm4gZC5kYXRlcGlja2VyW1wiX1wiK2ErXCJEYXRlcGlja2VyXCJdLmFwcGx5KGQuZGF0ZXBpY2tlcixbdGhpc1swXV0uY29uY2F0KGIpKTtpZihhPT1cIm9wdGlvblwiJiZhcmd1bWVudHMubGVuZ3RoPT0yJiZ0eXBlb2YgYXJndW1lbnRzWzFdPT1cInN0cmluZ1wiKXJldHVybiBkLmRhdGVwaWNrZXJbXCJfXCIrYStcIkRhdGVwaWNrZXJcIl0uYXBwbHkoZC5kYXRlcGlja2VyLFt0aGlzWzBdXS5jb25jYXQoYikpO3JldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oKXt0eXBlb2YgYT09XG5cInN0cmluZ1wiP2QuZGF0ZXBpY2tlcltcIl9cIithK1wiRGF0ZXBpY2tlclwiXS5hcHBseShkLmRhdGVwaWNrZXIsW3RoaXNdLmNvbmNhdChiKSk6ZC5kYXRlcGlja2VyLl9hdHRhY2hEYXRlcGlja2VyKHRoaXMsYSl9KX07ZC5kYXRlcGlja2VyPW5ldyBNO2QuZGF0ZXBpY2tlci5pbml0aWFsaXplZD1mYWxzZTtkLmRhdGVwaWNrZXIudXVpZD0obmV3IERhdGUpLmdldFRpbWUoKTtkLmRhdGVwaWNrZXIudmVyc2lvbj1cIjEuOC4xNlwiO3dpbmRvd1tcIkRQX2pRdWVyeV9cIitCXT1kfSkoalF1ZXJ5KTtcbjsvKlxuICogalF1ZXJ5IFVJIFByb2dyZXNzYmFyIDEuOC4xNlxuICpcbiAqIENvcHlyaWdodCAyMDExLCBBVVRIT1JTLnR4dCAoaHR0cDovL2pxdWVyeXVpLmNvbS9hYm91dClcbiAqIER1YWwgbGljZW5zZWQgdW5kZXIgdGhlIE1JVCBvciBHUEwgVmVyc2lvbiAyIGxpY2Vuc2VzLlxuICogaHR0cDovL2pxdWVyeS5vcmcvbGljZW5zZVxuICpcbiAqIGh0dHA6Ly9kb2NzLmpxdWVyeS5jb20vVUkvUHJvZ3Jlc3NiYXJcbiAqXG4gKiBEZXBlbmRzOlxuICogICBqcXVlcnkudWkuY29yZS5qc1xuICogICBqcXVlcnkudWkud2lkZ2V0LmpzXG4gKi9cbihmdW5jdGlvbihiLGQpe2Iud2lkZ2V0KFwidWkucHJvZ3Jlc3NiYXJcIix7b3B0aW9uczp7dmFsdWU6MCxtYXg6MTAwfSxtaW46MCxfY3JlYXRlOmZ1bmN0aW9uKCl7dGhpcy5lbGVtZW50LmFkZENsYXNzKFwidWktcHJvZ3Jlc3NiYXIgdWktd2lkZ2V0IHVpLXdpZGdldC1jb250ZW50IHVpLWNvcm5lci1hbGxcIikuYXR0cih7cm9sZTpcInByb2dyZXNzYmFyXCIsXCJhcmlhLXZhbHVlbWluXCI6dGhpcy5taW4sXCJhcmlhLXZhbHVlbWF4XCI6dGhpcy5vcHRpb25zLm1heCxcImFyaWEtdmFsdWVub3dcIjp0aGlzLl92YWx1ZSgpfSk7dGhpcy52YWx1ZURpdj1iKFwiPGRpdiBjbGFzcz0ndWktcHJvZ3Jlc3NiYXItdmFsdWUgdWktd2lkZ2V0LWhlYWRlciB1aS1jb3JuZXItbGVmdCc+PC9kaXY+XCIpLmFwcGVuZFRvKHRoaXMuZWxlbWVudCk7dGhpcy5vbGRWYWx1ZT10aGlzLl92YWx1ZSgpO3RoaXMuX3JlZnJlc2hWYWx1ZSgpfSxkZXN0cm95OmZ1bmN0aW9uKCl7dGhpcy5lbGVtZW50LnJlbW92ZUNsYXNzKFwidWktcHJvZ3Jlc3NiYXIgdWktd2lkZ2V0IHVpLXdpZGdldC1jb250ZW50IHVpLWNvcm5lci1hbGxcIikucmVtb3ZlQXR0cihcInJvbGVcIikucmVtb3ZlQXR0cihcImFyaWEtdmFsdWVtaW5cIikucmVtb3ZlQXR0cihcImFyaWEtdmFsdWVtYXhcIikucmVtb3ZlQXR0cihcImFyaWEtdmFsdWVub3dcIik7XG50aGlzLnZhbHVlRGl2LnJlbW92ZSgpO2IuV2lkZ2V0LnByb3RvdHlwZS5kZXN0cm95LmFwcGx5KHRoaXMsYXJndW1lbnRzKX0sdmFsdWU6ZnVuY3Rpb24oYSl7aWYoYT09PWQpcmV0dXJuIHRoaXMuX3ZhbHVlKCk7dGhpcy5fc2V0T3B0aW9uKFwidmFsdWVcIixhKTtyZXR1cm4gdGhpc30sX3NldE9wdGlvbjpmdW5jdGlvbihhLGMpe2lmKGE9PT1cInZhbHVlXCIpe3RoaXMub3B0aW9ucy52YWx1ZT1jO3RoaXMuX3JlZnJlc2hWYWx1ZSgpO3RoaXMuX3ZhbHVlKCk9PT10aGlzLm9wdGlvbnMubWF4JiZ0aGlzLl90cmlnZ2VyKFwiY29tcGxldGVcIil9Yi5XaWRnZXQucHJvdG90eXBlLl9zZXRPcHRpb24uYXBwbHkodGhpcyxhcmd1bWVudHMpfSxfdmFsdWU6ZnVuY3Rpb24oKXt2YXIgYT10aGlzLm9wdGlvbnMudmFsdWU7aWYodHlwZW9mIGEhPT1cIm51bWJlclwiKWE9MDtyZXR1cm4gTWF0aC5taW4odGhpcy5vcHRpb25zLm1heCxNYXRoLm1heCh0aGlzLm1pbixhKSl9LF9wZXJjZW50YWdlOmZ1bmN0aW9uKCl7cmV0dXJuIDEwMCpcbnRoaXMuX3ZhbHVlKCkvdGhpcy5vcHRpb25zLm1heH0sX3JlZnJlc2hWYWx1ZTpmdW5jdGlvbigpe3ZhciBhPXRoaXMudmFsdWUoKSxjPXRoaXMuX3BlcmNlbnRhZ2UoKTtpZih0aGlzLm9sZFZhbHVlIT09YSl7dGhpcy5vbGRWYWx1ZT1hO3RoaXMuX3RyaWdnZXIoXCJjaGFuZ2VcIil9dGhpcy52YWx1ZURpdi50b2dnbGUoYT50aGlzLm1pbikudG9nZ2xlQ2xhc3MoXCJ1aS1jb3JuZXItcmlnaHRcIixhPT09dGhpcy5vcHRpb25zLm1heCkud2lkdGgoYy50b0ZpeGVkKDApK1wiJVwiKTt0aGlzLmVsZW1lbnQuYXR0cihcImFyaWEtdmFsdWVub3dcIixhKX19KTtiLmV4dGVuZChiLnVpLnByb2dyZXNzYmFyLHt2ZXJzaW9uOlwiMS44LjE2XCJ9KX0pKGpRdWVyeSk7XG47LypcbiAqIGpRdWVyeSBVSSBFZmZlY3RzIDEuOC4xNlxuICpcbiAqIENvcHlyaWdodCAyMDExLCBBVVRIT1JTLnR4dCAoaHR0cDovL2pxdWVyeXVpLmNvbS9hYm91dClcbiAqIER1YWwgbGljZW5zZWQgdW5kZXIgdGhlIE1JVCBvciBHUEwgVmVyc2lvbiAyIGxpY2Vuc2VzLlxuICogaHR0cDovL2pxdWVyeS5vcmcvbGljZW5zZVxuICpcbiAqIGh0dHA6Ly9kb2NzLmpxdWVyeS5jb20vVUkvRWZmZWN0cy9cbiAqL1xualF1ZXJ5LmVmZmVjdHN8fGZ1bmN0aW9uKGYsail7ZnVuY3Rpb24gbShjKXt2YXIgYTtpZihjJiZjLmNvbnN0cnVjdG9yPT1BcnJheSYmYy5sZW5ndGg9PTMpcmV0dXJuIGM7aWYoYT0vcmdiXFwoXFxzKihbMC05XXsxLDN9KVxccyosXFxzKihbMC05XXsxLDN9KVxccyosXFxzKihbMC05XXsxLDN9KVxccypcXCkvLmV4ZWMoYykpcmV0dXJuW3BhcnNlSW50KGFbMV0sMTApLHBhcnNlSW50KGFbMl0sMTApLHBhcnNlSW50KGFbM10sMTApXTtpZihhPS9yZ2JcXChcXHMqKFswLTldKyg/OlxcLlswLTldKyk/KVxcJVxccyosXFxzKihbMC05XSsoPzpcXC5bMC05XSspPylcXCVcXHMqLFxccyooWzAtOV0rKD86XFwuWzAtOV0rKT8pXFwlXFxzKlxcKS8uZXhlYyhjKSlyZXR1cm5bcGFyc2VGbG9hdChhWzFdKSoyLjU1LHBhcnNlRmxvYXQoYVsyXSkqMi41NSxwYXJzZUZsb2F0KGFbM10pKjIuNTVdO2lmKGE9LyMoW2EtZkEtRjAtOV17Mn0pKFthLWZBLUYwLTldezJ9KShbYS1mQS1GMC05XXsyfSkvLmV4ZWMoYykpcmV0dXJuW3BhcnNlSW50KGFbMV0sXG4xNikscGFyc2VJbnQoYVsyXSwxNikscGFyc2VJbnQoYVszXSwxNildO2lmKGE9LyMoW2EtZkEtRjAtOV0pKFthLWZBLUYwLTldKShbYS1mQS1GMC05XSkvLmV4ZWMoYykpcmV0dXJuW3BhcnNlSW50KGFbMV0rYVsxXSwxNikscGFyc2VJbnQoYVsyXSthWzJdLDE2KSxwYXJzZUludChhWzNdK2FbM10sMTYpXTtpZigvcmdiYVxcKDAsIDAsIDAsIDBcXCkvLmV4ZWMoYykpcmV0dXJuIG4udHJhbnNwYXJlbnQ7cmV0dXJuIG5bZi50cmltKGMpLnRvTG93ZXJDYXNlKCldfWZ1bmN0aW9uIHMoYyxhKXt2YXIgYjtkb3tiPWYuY3VyQ1NTKGMsYSk7aWYoYiE9XCJcIiYmYiE9XCJ0cmFuc3BhcmVudFwifHxmLm5vZGVOYW1lKGMsXCJib2R5XCIpKWJyZWFrO2E9XCJiYWNrZ3JvdW5kQ29sb3JcIn13aGlsZShjPWMucGFyZW50Tm9kZSk7cmV0dXJuIG0oYil9ZnVuY3Rpb24gbygpe3ZhciBjPWRvY3VtZW50LmRlZmF1bHRWaWV3P2RvY3VtZW50LmRlZmF1bHRWaWV3LmdldENvbXB1dGVkU3R5bGUodGhpcyxudWxsKTp0aGlzLmN1cnJlbnRTdHlsZSxcbmE9e30sYixkO2lmKGMmJmMubGVuZ3RoJiZjWzBdJiZjW2NbMF1dKWZvcih2YXIgZT1jLmxlbmd0aDtlLS07KXtiPWNbZV07aWYodHlwZW9mIGNbYl09PVwic3RyaW5nXCIpe2Q9Yi5yZXBsYWNlKC9cXC0oXFx3KS9nLGZ1bmN0aW9uKGcsaCl7cmV0dXJuIGgudG9VcHBlckNhc2UoKX0pO2FbZF09Y1tiXX19ZWxzZSBmb3IoYiBpbiBjKWlmKHR5cGVvZiBjW2JdPT09XCJzdHJpbmdcIilhW2JdPWNbYl07cmV0dXJuIGF9ZnVuY3Rpb24gcChjKXt2YXIgYSxiO2ZvcihhIGluIGMpe2I9Y1thXTtpZihiPT1udWxsfHxmLmlzRnVuY3Rpb24oYil8fGEgaW4gdHx8L3Njcm9sbGJhci8udGVzdChhKXx8IS9jb2xvci9pLnRlc3QoYSkmJmlzTmFOKHBhcnNlRmxvYXQoYikpKWRlbGV0ZSBjW2FdfXJldHVybiBjfWZ1bmN0aW9uIHUoYyxhKXt2YXIgYj17XzowfSxkO2ZvcihkIGluIGEpaWYoY1tkXSE9YVtkXSliW2RdPWFbZF07cmV0dXJuIGJ9ZnVuY3Rpb24gayhjLGEsYixkKXtpZih0eXBlb2YgYz09XCJvYmplY3RcIil7ZD1cbmE7Yj1udWxsO2E9YztjPWEuZWZmZWN0fWlmKGYuaXNGdW5jdGlvbihhKSl7ZD1hO2I9bnVsbDthPXt9fWlmKHR5cGVvZiBhPT1cIm51bWJlclwifHxmLmZ4LnNwZWVkc1thXSl7ZD1iO2I9YTthPXt9fWlmKGYuaXNGdW5jdGlvbihiKSl7ZD1iO2I9bnVsbH1hPWF8fHt9O2I9Ynx8YS5kdXJhdGlvbjtiPWYuZngub2ZmPzA6dHlwZW9mIGI9PVwibnVtYmVyXCI/YjpiIGluIGYuZnguc3BlZWRzP2YuZnguc3BlZWRzW2JdOmYuZnguc3BlZWRzLl9kZWZhdWx0O2Q9ZHx8YS5jb21wbGV0ZTtyZXR1cm5bYyxhLGIsZF19ZnVuY3Rpb24gbChjKXtpZighY3x8dHlwZW9mIGM9PT1cIm51bWJlclwifHxmLmZ4LnNwZWVkc1tjXSlyZXR1cm4gdHJ1ZTtpZih0eXBlb2YgYz09PVwic3RyaW5nXCImJiFmLmVmZmVjdHNbY10pcmV0dXJuIHRydWU7cmV0dXJuIGZhbHNlfWYuZWZmZWN0cz17fTtmLmVhY2goW1wiYmFja2dyb3VuZENvbG9yXCIsXCJib3JkZXJCb3R0b21Db2xvclwiLFwiYm9yZGVyTGVmdENvbG9yXCIsXCJib3JkZXJSaWdodENvbG9yXCIsXG5cImJvcmRlclRvcENvbG9yXCIsXCJib3JkZXJDb2xvclwiLFwiY29sb3JcIixcIm91dGxpbmVDb2xvclwiXSxmdW5jdGlvbihjLGEpe2YuZnguc3RlcFthXT1mdW5jdGlvbihiKXtpZighYi5jb2xvckluaXQpe2Iuc3RhcnQ9cyhiLmVsZW0sYSk7Yi5lbmQ9bShiLmVuZCk7Yi5jb2xvckluaXQ9dHJ1ZX1iLmVsZW0uc3R5bGVbYV09XCJyZ2IoXCIrTWF0aC5tYXgoTWF0aC5taW4ocGFyc2VJbnQoYi5wb3MqKGIuZW5kWzBdLWIuc3RhcnRbMF0pK2Iuc3RhcnRbMF0sMTApLDI1NSksMCkrXCIsXCIrTWF0aC5tYXgoTWF0aC5taW4ocGFyc2VJbnQoYi5wb3MqKGIuZW5kWzFdLWIuc3RhcnRbMV0pK2Iuc3RhcnRbMV0sMTApLDI1NSksMCkrXCIsXCIrTWF0aC5tYXgoTWF0aC5taW4ocGFyc2VJbnQoYi5wb3MqKGIuZW5kWzJdLWIuc3RhcnRbMl0pK2Iuc3RhcnRbMl0sMTApLDI1NSksMCkrXCIpXCJ9fSk7dmFyIG49e2FxdWE6WzAsMjU1LDI1NV0sYXp1cmU6WzI0MCwyNTUsMjU1XSxiZWlnZTpbMjQ1LDI0NSwyMjBdLGJsYWNrOlswLFxuMCwwXSxibHVlOlswLDAsMjU1XSxicm93bjpbMTY1LDQyLDQyXSxjeWFuOlswLDI1NSwyNTVdLGRhcmtibHVlOlswLDAsMTM5XSxkYXJrY3lhbjpbMCwxMzksMTM5XSxkYXJrZ3JleTpbMTY5LDE2OSwxNjldLGRhcmtncmVlbjpbMCwxMDAsMF0sZGFya2toYWtpOlsxODksMTgzLDEwN10sZGFya21hZ2VudGE6WzEzOSwwLDEzOV0sZGFya29saXZlZ3JlZW46Wzg1LDEwNyw0N10sZGFya29yYW5nZTpbMjU1LDE0MCwwXSxkYXJrb3JjaGlkOlsxNTMsNTAsMjA0XSxkYXJrcmVkOlsxMzksMCwwXSxkYXJrc2FsbW9uOlsyMzMsMTUwLDEyMl0sZGFya3Zpb2xldDpbMTQ4LDAsMjExXSxmdWNoc2lhOlsyNTUsMCwyNTVdLGdvbGQ6WzI1NSwyMTUsMF0sZ3JlZW46WzAsMTI4LDBdLGluZGlnbzpbNzUsMCwxMzBdLGtoYWtpOlsyNDAsMjMwLDE0MF0sbGlnaHRibHVlOlsxNzMsMjE2LDIzMF0sbGlnaHRjeWFuOlsyMjQsMjU1LDI1NV0sbGlnaHRncmVlbjpbMTQ0LDIzOCwxNDRdLGxpZ2h0Z3JleTpbMjExLFxuMjExLDIxMV0sbGlnaHRwaW5rOlsyNTUsMTgyLDE5M10sbGlnaHR5ZWxsb3c6WzI1NSwyNTUsMjI0XSxsaW1lOlswLDI1NSwwXSxtYWdlbnRhOlsyNTUsMCwyNTVdLG1hcm9vbjpbMTI4LDAsMF0sbmF2eTpbMCwwLDEyOF0sb2xpdmU6WzEyOCwxMjgsMF0sb3JhbmdlOlsyNTUsMTY1LDBdLHBpbms6WzI1NSwxOTIsMjAzXSxwdXJwbGU6WzEyOCwwLDEyOF0sdmlvbGV0OlsxMjgsMCwxMjhdLHJlZDpbMjU1LDAsMF0sc2lsdmVyOlsxOTIsMTkyLDE5Ml0sd2hpdGU6WzI1NSwyNTUsMjU1XSx5ZWxsb3c6WzI1NSwyNTUsMF0sdHJhbnNwYXJlbnQ6WzI1NSwyNTUsMjU1XX0scT1bXCJhZGRcIixcInJlbW92ZVwiLFwidG9nZ2xlXCJdLHQ9e2JvcmRlcjoxLGJvcmRlckJvdHRvbToxLGJvcmRlckNvbG9yOjEsYm9yZGVyTGVmdDoxLGJvcmRlclJpZ2h0OjEsYm9yZGVyVG9wOjEsYm9yZGVyV2lkdGg6MSxtYXJnaW46MSxwYWRkaW5nOjF9O2YuZWZmZWN0cy5hbmltYXRlQ2xhc3M9ZnVuY3Rpb24oYyxhLGIsXG5kKXtpZihmLmlzRnVuY3Rpb24oYikpe2Q9YjtiPW51bGx9cmV0dXJuIHRoaXMucXVldWUoZnVuY3Rpb24oKXt2YXIgZT1mKHRoaXMpLGc9ZS5hdHRyKFwic3R5bGVcIil8fFwiIFwiLGg9cChvLmNhbGwodGhpcykpLHIsdj1lLmF0dHIoXCJjbGFzc1wiKTtmLmVhY2gocSxmdW5jdGlvbih3LGkpe2NbaV0mJmVbaStcIkNsYXNzXCJdKGNbaV0pfSk7cj1wKG8uY2FsbCh0aGlzKSk7ZS5hdHRyKFwiY2xhc3NcIix2KTtlLmFuaW1hdGUodShoLHIpLHtxdWV1ZTpmYWxzZSxkdXJhdGlvbjphLGVhc2luZzpiLGNvbXBsZXRlOmZ1bmN0aW9uKCl7Zi5lYWNoKHEsZnVuY3Rpb24odyxpKXtjW2ldJiZlW2krXCJDbGFzc1wiXShjW2ldKX0pO2lmKHR5cGVvZiBlLmF0dHIoXCJzdHlsZVwiKT09XCJvYmplY3RcIil7ZS5hdHRyKFwic3R5bGVcIikuY3NzVGV4dD1cIlwiO2UuYXR0cihcInN0eWxlXCIpLmNzc1RleHQ9Z31lbHNlIGUuYXR0cihcInN0eWxlXCIsZyk7ZCYmZC5hcHBseSh0aGlzLGFyZ3VtZW50cyk7Zi5kZXF1ZXVlKHRoaXMpfX0pfSl9O1xuZi5mbi5leHRlbmQoe19hZGRDbGFzczpmLmZuLmFkZENsYXNzLGFkZENsYXNzOmZ1bmN0aW9uKGMsYSxiLGQpe3JldHVybiBhP2YuZWZmZWN0cy5hbmltYXRlQ2xhc3MuYXBwbHkodGhpcyxbe2FkZDpjfSxhLGIsZF0pOnRoaXMuX2FkZENsYXNzKGMpfSxfcmVtb3ZlQ2xhc3M6Zi5mbi5yZW1vdmVDbGFzcyxyZW1vdmVDbGFzczpmdW5jdGlvbihjLGEsYixkKXtyZXR1cm4gYT9mLmVmZmVjdHMuYW5pbWF0ZUNsYXNzLmFwcGx5KHRoaXMsW3tyZW1vdmU6Y30sYSxiLGRdKTp0aGlzLl9yZW1vdmVDbGFzcyhjKX0sX3RvZ2dsZUNsYXNzOmYuZm4udG9nZ2xlQ2xhc3MsdG9nZ2xlQ2xhc3M6ZnVuY3Rpb24oYyxhLGIsZCxlKXtyZXR1cm4gdHlwZW9mIGE9PVwiYm9vbGVhblwifHxhPT09aj9iP2YuZWZmZWN0cy5hbmltYXRlQ2xhc3MuYXBwbHkodGhpcyxbYT97YWRkOmN9OntyZW1vdmU6Y30sYixkLGVdKTp0aGlzLl90b2dnbGVDbGFzcyhjLGEpOmYuZWZmZWN0cy5hbmltYXRlQ2xhc3MuYXBwbHkodGhpcyxcblt7dG9nZ2xlOmN9LGEsYixkXSl9LHN3aXRjaENsYXNzOmZ1bmN0aW9uKGMsYSxiLGQsZSl7cmV0dXJuIGYuZWZmZWN0cy5hbmltYXRlQ2xhc3MuYXBwbHkodGhpcyxbe2FkZDphLHJlbW92ZTpjfSxiLGQsZV0pfX0pO2YuZXh0ZW5kKGYuZWZmZWN0cyx7dmVyc2lvbjpcIjEuOC4xNlwiLHNhdmU6ZnVuY3Rpb24oYyxhKXtmb3IodmFyIGI9MDtiPGEubGVuZ3RoO2IrKylhW2JdIT09bnVsbCYmYy5kYXRhKFwiZWMuc3RvcmFnZS5cIithW2JdLGNbMF0uc3R5bGVbYVtiXV0pfSxyZXN0b3JlOmZ1bmN0aW9uKGMsYSl7Zm9yKHZhciBiPTA7YjxhLmxlbmd0aDtiKyspYVtiXSE9PW51bGwmJmMuY3NzKGFbYl0sYy5kYXRhKFwiZWMuc3RvcmFnZS5cIithW2JdKSl9LHNldE1vZGU6ZnVuY3Rpb24oYyxhKXtpZihhPT1cInRvZ2dsZVwiKWE9Yy5pcyhcIjpoaWRkZW5cIik/XCJzaG93XCI6XCJoaWRlXCI7cmV0dXJuIGF9LGdldEJhc2VsaW5lOmZ1bmN0aW9uKGMsYSl7dmFyIGI7c3dpdGNoKGNbMF0pe2Nhc2UgXCJ0b3BcIjpiPVxuMDticmVhaztjYXNlIFwibWlkZGxlXCI6Yj0wLjU7YnJlYWs7Y2FzZSBcImJvdHRvbVwiOmI9MTticmVhaztkZWZhdWx0OmI9Y1swXS9hLmhlaWdodH1zd2l0Y2goY1sxXSl7Y2FzZSBcImxlZnRcIjpjPTA7YnJlYWs7Y2FzZSBcImNlbnRlclwiOmM9MC41O2JyZWFrO2Nhc2UgXCJyaWdodFwiOmM9MTticmVhaztkZWZhdWx0OmM9Y1sxXS9hLndpZHRofXJldHVybnt4OmMseTpifX0sY3JlYXRlV3JhcHBlcjpmdW5jdGlvbihjKXtpZihjLnBhcmVudCgpLmlzKFwiLnVpLWVmZmVjdHMtd3JhcHBlclwiKSlyZXR1cm4gYy5wYXJlbnQoKTt2YXIgYT17d2lkdGg6Yy5vdXRlcldpZHRoKHRydWUpLGhlaWdodDpjLm91dGVySGVpZ2h0KHRydWUpLFwiZmxvYXRcIjpjLmNzcyhcImZsb2F0XCIpfSxiPWYoXCI8ZGl2PjwvZGl2PlwiKS5hZGRDbGFzcyhcInVpLWVmZmVjdHMtd3JhcHBlclwiKS5jc3Moe2ZvbnRTaXplOlwiMTAwJVwiLGJhY2tncm91bmQ6XCJ0cmFuc3BhcmVudFwiLGJvcmRlcjpcIm5vbmVcIixtYXJnaW46MCxwYWRkaW5nOjB9KSxcbmQ9ZG9jdW1lbnQuYWN0aXZlRWxlbWVudDtjLndyYXAoYik7aWYoY1swXT09PWR8fGYuY29udGFpbnMoY1swXSxkKSlmKGQpLmZvY3VzKCk7Yj1jLnBhcmVudCgpO2lmKGMuY3NzKFwicG9zaXRpb25cIik9PVwic3RhdGljXCIpe2IuY3NzKHtwb3NpdGlvbjpcInJlbGF0aXZlXCJ9KTtjLmNzcyh7cG9zaXRpb246XCJyZWxhdGl2ZVwifSl9ZWxzZXtmLmV4dGVuZChhLHtwb3NpdGlvbjpjLmNzcyhcInBvc2l0aW9uXCIpLHpJbmRleDpjLmNzcyhcInotaW5kZXhcIil9KTtmLmVhY2goW1widG9wXCIsXCJsZWZ0XCIsXCJib3R0b21cIixcInJpZ2h0XCJdLGZ1bmN0aW9uKGUsZyl7YVtnXT1jLmNzcyhnKTtpZihpc05hTihwYXJzZUludChhW2ddLDEwKSkpYVtnXT1cImF1dG9cIn0pO2MuY3NzKHtwb3NpdGlvbjpcInJlbGF0aXZlXCIsdG9wOjAsbGVmdDowLHJpZ2h0OlwiYXV0b1wiLGJvdHRvbTpcImF1dG9cIn0pfXJldHVybiBiLmNzcyhhKS5zaG93KCl9LHJlbW92ZVdyYXBwZXI6ZnVuY3Rpb24oYyl7dmFyIGEsYj1kb2N1bWVudC5hY3RpdmVFbGVtZW50O1xuaWYoYy5wYXJlbnQoKS5pcyhcIi51aS1lZmZlY3RzLXdyYXBwZXJcIikpe2E9Yy5wYXJlbnQoKS5yZXBsYWNlV2l0aChjKTtpZihjWzBdPT09Ynx8Zi5jb250YWlucyhjWzBdLGIpKWYoYikuZm9jdXMoKTtyZXR1cm4gYX1yZXR1cm4gY30sc2V0VHJhbnNpdGlvbjpmdW5jdGlvbihjLGEsYixkKXtkPWR8fHt9O2YuZWFjaChhLGZ1bmN0aW9uKGUsZyl7dW5pdD1jLmNzc1VuaXQoZyk7aWYodW5pdFswXT4wKWRbZ109dW5pdFswXSpiK3VuaXRbMV19KTtyZXR1cm4gZH19KTtmLmZuLmV4dGVuZCh7ZWZmZWN0OmZ1bmN0aW9uKGMpe3ZhciBhPWsuYXBwbHkodGhpcyxhcmd1bWVudHMpLGI9e29wdGlvbnM6YVsxXSxkdXJhdGlvbjphWzJdLGNhbGxiYWNrOmFbM119O2E9Yi5vcHRpb25zLm1vZGU7dmFyIGQ9Zi5lZmZlY3RzW2NdO2lmKGYuZngub2ZmfHwhZClyZXR1cm4gYT90aGlzW2FdKGIuZHVyYXRpb24sYi5jYWxsYmFjayk6dGhpcy5lYWNoKGZ1bmN0aW9uKCl7Yi5jYWxsYmFjayYmYi5jYWxsYmFjay5jYWxsKHRoaXMpfSk7XG5yZXR1cm4gZC5jYWxsKHRoaXMsYil9LF9zaG93OmYuZm4uc2hvdyxzaG93OmZ1bmN0aW9uKGMpe2lmKGwoYykpcmV0dXJuIHRoaXMuX3Nob3cuYXBwbHkodGhpcyxhcmd1bWVudHMpO2Vsc2V7dmFyIGE9ay5hcHBseSh0aGlzLGFyZ3VtZW50cyk7YVsxXS5tb2RlPVwic2hvd1wiO3JldHVybiB0aGlzLmVmZmVjdC5hcHBseSh0aGlzLGEpfX0sX2hpZGU6Zi5mbi5oaWRlLGhpZGU6ZnVuY3Rpb24oYyl7aWYobChjKSlyZXR1cm4gdGhpcy5faGlkZS5hcHBseSh0aGlzLGFyZ3VtZW50cyk7ZWxzZXt2YXIgYT1rLmFwcGx5KHRoaXMsYXJndW1lbnRzKTthWzFdLm1vZGU9XCJoaWRlXCI7cmV0dXJuIHRoaXMuZWZmZWN0LmFwcGx5KHRoaXMsYSl9fSxfX3RvZ2dsZTpmLmZuLnRvZ2dsZSx0b2dnbGU6ZnVuY3Rpb24oYyl7aWYobChjKXx8dHlwZW9mIGM9PT1cImJvb2xlYW5cInx8Zi5pc0Z1bmN0aW9uKGMpKXJldHVybiB0aGlzLl9fdG9nZ2xlLmFwcGx5KHRoaXMsYXJndW1lbnRzKTtlbHNle3ZhciBhPWsuYXBwbHkodGhpcyxcbmFyZ3VtZW50cyk7YVsxXS5tb2RlPVwidG9nZ2xlXCI7cmV0dXJuIHRoaXMuZWZmZWN0LmFwcGx5KHRoaXMsYSl9fSxjc3NVbml0OmZ1bmN0aW9uKGMpe3ZhciBhPXRoaXMuY3NzKGMpLGI9W107Zi5lYWNoKFtcImVtXCIsXCJweFwiLFwiJVwiLFwicHRcIl0sZnVuY3Rpb24oZCxlKXtpZihhLmluZGV4T2YoZSk+MCliPVtwYXJzZUZsb2F0KGEpLGVdfSk7cmV0dXJuIGJ9fSk7Zi5lYXNpbmcuanN3aW5nPWYuZWFzaW5nLnN3aW5nO2YuZXh0ZW5kKGYuZWFzaW5nLHtkZWY6XCJlYXNlT3V0UXVhZFwiLHN3aW5nOmZ1bmN0aW9uKGMsYSxiLGQsZSl7cmV0dXJuIGYuZWFzaW5nW2YuZWFzaW5nLmRlZl0oYyxhLGIsZCxlKX0sZWFzZUluUXVhZDpmdW5jdGlvbihjLGEsYixkLGUpe3JldHVybiBkKihhLz1lKSphK2J9LGVhc2VPdXRRdWFkOmZ1bmN0aW9uKGMsYSxiLGQsZSl7cmV0dXJuLWQqKGEvPWUpKihhLTIpK2J9LGVhc2VJbk91dFF1YWQ6ZnVuY3Rpb24oYyxhLGIsZCxlKXtpZigoYS89ZS8yKTwxKXJldHVybiBkL1xuMiphKmErYjtyZXR1cm4tZC8yKigtLWEqKGEtMiktMSkrYn0sZWFzZUluQ3ViaWM6ZnVuY3Rpb24oYyxhLGIsZCxlKXtyZXR1cm4gZCooYS89ZSkqYSphK2J9LGVhc2VPdXRDdWJpYzpmdW5jdGlvbihjLGEsYixkLGUpe3JldHVybiBkKigoYT1hL2UtMSkqYSphKzEpK2J9LGVhc2VJbk91dEN1YmljOmZ1bmN0aW9uKGMsYSxiLGQsZSl7aWYoKGEvPWUvMik8MSlyZXR1cm4gZC8yKmEqYSphK2I7cmV0dXJuIGQvMiooKGEtPTIpKmEqYSsyKStifSxlYXNlSW5RdWFydDpmdW5jdGlvbihjLGEsYixkLGUpe3JldHVybiBkKihhLz1lKSphKmEqYStifSxlYXNlT3V0UXVhcnQ6ZnVuY3Rpb24oYyxhLGIsZCxlKXtyZXR1cm4tZCooKGE9YS9lLTEpKmEqYSphLTEpK2J9LGVhc2VJbk91dFF1YXJ0OmZ1bmN0aW9uKGMsYSxiLGQsZSl7aWYoKGEvPWUvMik8MSlyZXR1cm4gZC8yKmEqYSphKmErYjtyZXR1cm4tZC8yKigoYS09MikqYSphKmEtMikrYn0sZWFzZUluUXVpbnQ6ZnVuY3Rpb24oYyxhLGIsXG5kLGUpe3JldHVybiBkKihhLz1lKSphKmEqYSphK2J9LGVhc2VPdXRRdWludDpmdW5jdGlvbihjLGEsYixkLGUpe3JldHVybiBkKigoYT1hL2UtMSkqYSphKmEqYSsxKStifSxlYXNlSW5PdXRRdWludDpmdW5jdGlvbihjLGEsYixkLGUpe2lmKChhLz1lLzIpPDEpcmV0dXJuIGQvMiphKmEqYSphKmErYjtyZXR1cm4gZC8yKigoYS09MikqYSphKmEqYSsyKStifSxlYXNlSW5TaW5lOmZ1bmN0aW9uKGMsYSxiLGQsZSl7cmV0dXJuLWQqTWF0aC5jb3MoYS9lKihNYXRoLlBJLzIpKStkK2J9LGVhc2VPdXRTaW5lOmZ1bmN0aW9uKGMsYSxiLGQsZSl7cmV0dXJuIGQqTWF0aC5zaW4oYS9lKihNYXRoLlBJLzIpKStifSxlYXNlSW5PdXRTaW5lOmZ1bmN0aW9uKGMsYSxiLGQsZSl7cmV0dXJuLWQvMiooTWF0aC5jb3MoTWF0aC5QSSphL2UpLTEpK2J9LGVhc2VJbkV4cG86ZnVuY3Rpb24oYyxhLGIsZCxlKXtyZXR1cm4gYT09MD9iOmQqTWF0aC5wb3coMiwxMCooYS9lLTEpKStifSxlYXNlT3V0RXhwbzpmdW5jdGlvbihjLFxuYSxiLGQsZSl7cmV0dXJuIGE9PWU/YitkOmQqKC1NYXRoLnBvdygyLC0xMCphL2UpKzEpK2J9LGVhc2VJbk91dEV4cG86ZnVuY3Rpb24oYyxhLGIsZCxlKXtpZihhPT0wKXJldHVybiBiO2lmKGE9PWUpcmV0dXJuIGIrZDtpZigoYS89ZS8yKTwxKXJldHVybiBkLzIqTWF0aC5wb3coMiwxMCooYS0xKSkrYjtyZXR1cm4gZC8yKigtTWF0aC5wb3coMiwtMTAqLS1hKSsyKStifSxlYXNlSW5DaXJjOmZ1bmN0aW9uKGMsYSxiLGQsZSl7cmV0dXJuLWQqKE1hdGguc3FydCgxLShhLz1lKSphKS0xKStifSxlYXNlT3V0Q2lyYzpmdW5jdGlvbihjLGEsYixkLGUpe3JldHVybiBkKk1hdGguc3FydCgxLShhPWEvZS0xKSphKStifSxlYXNlSW5PdXRDaXJjOmZ1bmN0aW9uKGMsYSxiLGQsZSl7aWYoKGEvPWUvMik8MSlyZXR1cm4tZC8yKihNYXRoLnNxcnQoMS1hKmEpLTEpK2I7cmV0dXJuIGQvMiooTWF0aC5zcXJ0KDEtKGEtPTIpKmEpKzEpK2J9LGVhc2VJbkVsYXN0aWM6ZnVuY3Rpb24oYyxhLGIsXG5kLGUpe2M9MS43MDE1ODt2YXIgZz0wLGg9ZDtpZihhPT0wKXJldHVybiBiO2lmKChhLz1lKT09MSlyZXR1cm4gYitkO2d8fChnPWUqMC4zKTtpZihoPE1hdGguYWJzKGQpKXtoPWQ7Yz1nLzR9ZWxzZSBjPWcvKDIqTWF0aC5QSSkqTWF0aC5hc2luKGQvaCk7cmV0dXJuLShoKk1hdGgucG93KDIsMTAqKGEtPTEpKSpNYXRoLnNpbigoYSplLWMpKjIqTWF0aC5QSS9nKSkrYn0sZWFzZU91dEVsYXN0aWM6ZnVuY3Rpb24oYyxhLGIsZCxlKXtjPTEuNzAxNTg7dmFyIGc9MCxoPWQ7aWYoYT09MClyZXR1cm4gYjtpZigoYS89ZSk9PTEpcmV0dXJuIGIrZDtnfHwoZz1lKjAuMyk7aWYoaDxNYXRoLmFicyhkKSl7aD1kO2M9Zy80fWVsc2UgYz1nLygyKk1hdGguUEkpKk1hdGguYXNpbihkL2gpO3JldHVybiBoKk1hdGgucG93KDIsLTEwKmEpKk1hdGguc2luKChhKmUtYykqMipNYXRoLlBJL2cpK2QrYn0sZWFzZUluT3V0RWxhc3RpYzpmdW5jdGlvbihjLGEsYixkLGUpe2M9MS43MDE1ODt2YXIgZz1cbjAsaD1kO2lmKGE9PTApcmV0dXJuIGI7aWYoKGEvPWUvMik9PTIpcmV0dXJuIGIrZDtnfHwoZz1lKjAuMyoxLjUpO2lmKGg8TWF0aC5hYnMoZCkpe2g9ZDtjPWcvNH1lbHNlIGM9Zy8oMipNYXRoLlBJKSpNYXRoLmFzaW4oZC9oKTtpZihhPDEpcmV0dXJuLTAuNSpoKk1hdGgucG93KDIsMTAqKGEtPTEpKSpNYXRoLnNpbigoYSplLWMpKjIqTWF0aC5QSS9nKStiO3JldHVybiBoKk1hdGgucG93KDIsLTEwKihhLT0xKSkqTWF0aC5zaW4oKGEqZS1jKSoyKk1hdGguUEkvZykqMC41K2QrYn0sZWFzZUluQmFjazpmdW5jdGlvbihjLGEsYixkLGUsZyl7aWYoZz09ailnPTEuNzAxNTg7cmV0dXJuIGQqKGEvPWUpKmEqKChnKzEpKmEtZykrYn0sZWFzZU91dEJhY2s6ZnVuY3Rpb24oYyxhLGIsZCxlLGcpe2lmKGc9PWopZz0xLjcwMTU4O3JldHVybiBkKigoYT1hL2UtMSkqYSooKGcrMSkqYStnKSsxKStifSxlYXNlSW5PdXRCYWNrOmZ1bmN0aW9uKGMsYSxiLGQsZSxnKXtpZihnPT1qKWc9MS43MDE1ODtcbmlmKChhLz1lLzIpPDEpcmV0dXJuIGQvMiphKmEqKCgoZyo9MS41MjUpKzEpKmEtZykrYjtyZXR1cm4gZC8yKigoYS09MikqYSooKChnKj0xLjUyNSkrMSkqYStnKSsyKStifSxlYXNlSW5Cb3VuY2U6ZnVuY3Rpb24oYyxhLGIsZCxlKXtyZXR1cm4gZC1mLmVhc2luZy5lYXNlT3V0Qm91bmNlKGMsZS1hLDAsZCxlKStifSxlYXNlT3V0Qm91bmNlOmZ1bmN0aW9uKGMsYSxiLGQsZSl7cmV0dXJuKGEvPWUpPDEvMi43NT9kKjcuNTYyNSphKmErYjphPDIvMi43NT9kKig3LjU2MjUqKGEtPTEuNS8yLjc1KSphKzAuNzUpK2I6YTwyLjUvMi43NT9kKig3LjU2MjUqKGEtPTIuMjUvMi43NSkqYSswLjkzNzUpK2I6ZCooNy41NjI1KihhLT0yLjYyNS8yLjc1KSphKzAuOTg0Mzc1KStifSxlYXNlSW5PdXRCb3VuY2U6ZnVuY3Rpb24oYyxhLGIsZCxlKXtpZihhPGUvMilyZXR1cm4gZi5lYXNpbmcuZWFzZUluQm91bmNlKGMsYSoyLDAsZCxlKSowLjUrYjtyZXR1cm4gZi5lYXNpbmcuZWFzZU91dEJvdW5jZShjLFxuYSoyLWUsMCxkLGUpKjAuNStkKjAuNStifX0pfShqUXVlcnkpO1xuOy8qXG4gKiBqUXVlcnkgVUkgRWZmZWN0cyBCbGluZCAxLjguMTZcbiAqXG4gKiBDb3B5cmlnaHQgMjAxMSwgQVVUSE9SUy50eHQgKGh0dHA6Ly9qcXVlcnl1aS5jb20vYWJvdXQpXG4gKiBEdWFsIGxpY2Vuc2VkIHVuZGVyIHRoZSBNSVQgb3IgR1BMIFZlcnNpb24gMiBsaWNlbnNlcy5cbiAqIGh0dHA6Ly9qcXVlcnkub3JnL2xpY2Vuc2VcbiAqXG4gKiBodHRwOi8vZG9jcy5qcXVlcnkuY29tL1VJL0VmZmVjdHMvQmxpbmRcbiAqXG4gKiBEZXBlbmRzOlxuICpcdGpxdWVyeS5lZmZlY3RzLmNvcmUuanNcbiAqL1xuKGZ1bmN0aW9uKGIpe2IuZWZmZWN0cy5ibGluZD1mdW5jdGlvbihjKXtyZXR1cm4gdGhpcy5xdWV1ZShmdW5jdGlvbigpe3ZhciBhPWIodGhpcyksZz1bXCJwb3NpdGlvblwiLFwidG9wXCIsXCJib3R0b21cIixcImxlZnRcIixcInJpZ2h0XCJdLGY9Yi5lZmZlY3RzLnNldE1vZGUoYSxjLm9wdGlvbnMubW9kZXx8XCJoaWRlXCIpLGQ9Yy5vcHRpb25zLmRpcmVjdGlvbnx8XCJ2ZXJ0aWNhbFwiO2IuZWZmZWN0cy5zYXZlKGEsZyk7YS5zaG93KCk7dmFyIGU9Yi5lZmZlY3RzLmNyZWF0ZVdyYXBwZXIoYSkuY3NzKHtvdmVyZmxvdzpcImhpZGRlblwifSksaD1kPT1cInZlcnRpY2FsXCI/XCJoZWlnaHRcIjpcIndpZHRoXCI7ZD1kPT1cInZlcnRpY2FsXCI/ZS5oZWlnaHQoKTplLndpZHRoKCk7Zj09XCJzaG93XCImJmUuY3NzKGgsMCk7dmFyIGk9e307aVtoXT1mPT1cInNob3dcIj9kOjA7ZS5hbmltYXRlKGksYy5kdXJhdGlvbixjLm9wdGlvbnMuZWFzaW5nLGZ1bmN0aW9uKCl7Zj09XCJoaWRlXCImJmEuaGlkZSgpO2IuZWZmZWN0cy5yZXN0b3JlKGEsXG5nKTtiLmVmZmVjdHMucmVtb3ZlV3JhcHBlcihhKTtjLmNhbGxiYWNrJiZjLmNhbGxiYWNrLmFwcGx5KGFbMF0sYXJndW1lbnRzKTthLmRlcXVldWUoKX0pfSl9fSkoalF1ZXJ5KTtcbjsvKlxuICogalF1ZXJ5IFVJIEVmZmVjdHMgQm91bmNlIDEuOC4xNlxuICpcbiAqIENvcHlyaWdodCAyMDExLCBBVVRIT1JTLnR4dCAoaHR0cDovL2pxdWVyeXVpLmNvbS9hYm91dClcbiAqIER1YWwgbGljZW5zZWQgdW5kZXIgdGhlIE1JVCBvciBHUEwgVmVyc2lvbiAyIGxpY2Vuc2VzLlxuICogaHR0cDovL2pxdWVyeS5vcmcvbGljZW5zZVxuICpcbiAqIGh0dHA6Ly9kb2NzLmpxdWVyeS5jb20vVUkvRWZmZWN0cy9Cb3VuY2VcbiAqXG4gKiBEZXBlbmRzOlxuICpcdGpxdWVyeS5lZmZlY3RzLmNvcmUuanNcbiAqL1xuKGZ1bmN0aW9uKGUpe2UuZWZmZWN0cy5ib3VuY2U9ZnVuY3Rpb24oYil7cmV0dXJuIHRoaXMucXVldWUoZnVuY3Rpb24oKXt2YXIgYT1lKHRoaXMpLGw9W1wicG9zaXRpb25cIixcInRvcFwiLFwiYm90dG9tXCIsXCJsZWZ0XCIsXCJyaWdodFwiXSxoPWUuZWZmZWN0cy5zZXRNb2RlKGEsYi5vcHRpb25zLm1vZGV8fFwiZWZmZWN0XCIpLGQ9Yi5vcHRpb25zLmRpcmVjdGlvbnx8XCJ1cFwiLGM9Yi5vcHRpb25zLmRpc3RhbmNlfHwyMCxtPWIub3B0aW9ucy50aW1lc3x8NSxpPWIuZHVyYXRpb258fDI1MDsvc2hvd3xoaWRlLy50ZXN0KGgpJiZsLnB1c2goXCJvcGFjaXR5XCIpO2UuZWZmZWN0cy5zYXZlKGEsbCk7YS5zaG93KCk7ZS5lZmZlY3RzLmNyZWF0ZVdyYXBwZXIoYSk7dmFyIGY9ZD09XCJ1cFwifHxkPT1cImRvd25cIj9cInRvcFwiOlwibGVmdFwiO2Q9ZD09XCJ1cFwifHxkPT1cImxlZnRcIj9cInBvc1wiOlwibmVnXCI7Yz1iLm9wdGlvbnMuZGlzdGFuY2V8fChmPT1cInRvcFwiP2Eub3V0ZXJIZWlnaHQoe21hcmdpbjp0cnVlfSkvMzphLm91dGVyV2lkdGgoe21hcmdpbjp0cnVlfSkvXG4zKTtpZihoPT1cInNob3dcIilhLmNzcyhcIm9wYWNpdHlcIiwwKS5jc3MoZixkPT1cInBvc1wiPy1jOmMpO2lmKGg9PVwiaGlkZVwiKWMvPW0qMjtoIT1cImhpZGVcIiYmbS0tO2lmKGg9PVwic2hvd1wiKXt2YXIgZz17b3BhY2l0eToxfTtnW2ZdPShkPT1cInBvc1wiP1wiKz1cIjpcIi09XCIpK2M7YS5hbmltYXRlKGcsaS8yLGIub3B0aW9ucy5lYXNpbmcpO2MvPTI7bS0tfWZvcihnPTA7ZzxtO2crKyl7dmFyIGo9e30saz17fTtqW2ZdPShkPT1cInBvc1wiP1wiLT1cIjpcIis9XCIpK2M7a1tmXT0oZD09XCJwb3NcIj9cIis9XCI6XCItPVwiKStjO2EuYW5pbWF0ZShqLGkvMixiLm9wdGlvbnMuZWFzaW5nKS5hbmltYXRlKGssaS8yLGIub3B0aW9ucy5lYXNpbmcpO2M9aD09XCJoaWRlXCI/YyoyOmMvMn1pZihoPT1cImhpZGVcIil7Zz17b3BhY2l0eTowfTtnW2ZdPShkPT1cInBvc1wiP1wiLT1cIjpcIis9XCIpK2M7YS5hbmltYXRlKGcsaS8yLGIub3B0aW9ucy5lYXNpbmcsZnVuY3Rpb24oKXthLmhpZGUoKTtlLmVmZmVjdHMucmVzdG9yZShhLGwpO2UuZWZmZWN0cy5yZW1vdmVXcmFwcGVyKGEpO1xuYi5jYWxsYmFjayYmYi5jYWxsYmFjay5hcHBseSh0aGlzLGFyZ3VtZW50cyl9KX1lbHNle2o9e307az17fTtqW2ZdPShkPT1cInBvc1wiP1wiLT1cIjpcIis9XCIpK2M7a1tmXT0oZD09XCJwb3NcIj9cIis9XCI6XCItPVwiKStjO2EuYW5pbWF0ZShqLGkvMixiLm9wdGlvbnMuZWFzaW5nKS5hbmltYXRlKGssaS8yLGIub3B0aW9ucy5lYXNpbmcsZnVuY3Rpb24oKXtlLmVmZmVjdHMucmVzdG9yZShhLGwpO2UuZWZmZWN0cy5yZW1vdmVXcmFwcGVyKGEpO2IuY2FsbGJhY2smJmIuY2FsbGJhY2suYXBwbHkodGhpcyxhcmd1bWVudHMpfSl9YS5xdWV1ZShcImZ4XCIsZnVuY3Rpb24oKXthLmRlcXVldWUoKX0pO2EuZGVxdWV1ZSgpfSl9fSkoalF1ZXJ5KTtcbjsvKlxuICogalF1ZXJ5IFVJIEVmZmVjdHMgQ2xpcCAxLjguMTZcbiAqXG4gKiBDb3B5cmlnaHQgMjAxMSwgQVVUSE9SUy50eHQgKGh0dHA6Ly9qcXVlcnl1aS5jb20vYWJvdXQpXG4gKiBEdWFsIGxpY2Vuc2VkIHVuZGVyIHRoZSBNSVQgb3IgR1BMIFZlcnNpb24gMiBsaWNlbnNlcy5cbiAqIGh0dHA6Ly9qcXVlcnkub3JnL2xpY2Vuc2VcbiAqXG4gKiBodHRwOi8vZG9jcy5qcXVlcnkuY29tL1VJL0VmZmVjdHMvQ2xpcFxuICpcbiAqIERlcGVuZHM6XG4gKlx0anF1ZXJ5LmVmZmVjdHMuY29yZS5qc1xuICovXG4oZnVuY3Rpb24oYil7Yi5lZmZlY3RzLmNsaXA9ZnVuY3Rpb24oZSl7cmV0dXJuIHRoaXMucXVldWUoZnVuY3Rpb24oKXt2YXIgYT1iKHRoaXMpLGk9W1wicG9zaXRpb25cIixcInRvcFwiLFwiYm90dG9tXCIsXCJsZWZ0XCIsXCJyaWdodFwiLFwiaGVpZ2h0XCIsXCJ3aWR0aFwiXSxmPWIuZWZmZWN0cy5zZXRNb2RlKGEsZS5vcHRpb25zLm1vZGV8fFwiaGlkZVwiKSxjPWUub3B0aW9ucy5kaXJlY3Rpb258fFwidmVydGljYWxcIjtiLmVmZmVjdHMuc2F2ZShhLGkpO2Euc2hvdygpO3ZhciBkPWIuZWZmZWN0cy5jcmVhdGVXcmFwcGVyKGEpLmNzcyh7b3ZlcmZsb3c6XCJoaWRkZW5cIn0pO2Q9YVswXS50YWdOYW1lPT1cIklNR1wiP2Q6YTt2YXIgZz17c2l6ZTpjPT1cInZlcnRpY2FsXCI/XCJoZWlnaHRcIjpcIndpZHRoXCIscG9zaXRpb246Yz09XCJ2ZXJ0aWNhbFwiP1widG9wXCI6XCJsZWZ0XCJ9O2M9Yz09XCJ2ZXJ0aWNhbFwiP2QuaGVpZ2h0KCk6ZC53aWR0aCgpO2lmKGY9PVwic2hvd1wiKXtkLmNzcyhnLnNpemUsMCk7ZC5jc3MoZy5wb3NpdGlvbixcbmMvMil9dmFyIGg9e307aFtnLnNpemVdPWY9PVwic2hvd1wiP2M6MDtoW2cucG9zaXRpb25dPWY9PVwic2hvd1wiPzA6Yy8yO2QuYW5pbWF0ZShoLHtxdWV1ZTpmYWxzZSxkdXJhdGlvbjplLmR1cmF0aW9uLGVhc2luZzplLm9wdGlvbnMuZWFzaW5nLGNvbXBsZXRlOmZ1bmN0aW9uKCl7Zj09XCJoaWRlXCImJmEuaGlkZSgpO2IuZWZmZWN0cy5yZXN0b3JlKGEsaSk7Yi5lZmZlY3RzLnJlbW92ZVdyYXBwZXIoYSk7ZS5jYWxsYmFjayYmZS5jYWxsYmFjay5hcHBseShhWzBdLGFyZ3VtZW50cyk7YS5kZXF1ZXVlKCl9fSl9KX19KShqUXVlcnkpO1xuOy8qXG4gKiBqUXVlcnkgVUkgRWZmZWN0cyBEcm9wIDEuOC4xNlxuICpcbiAqIENvcHlyaWdodCAyMDExLCBBVVRIT1JTLnR4dCAoaHR0cDovL2pxdWVyeXVpLmNvbS9hYm91dClcbiAqIER1YWwgbGljZW5zZWQgdW5kZXIgdGhlIE1JVCBvciBHUEwgVmVyc2lvbiAyIGxpY2Vuc2VzLlxuICogaHR0cDovL2pxdWVyeS5vcmcvbGljZW5zZVxuICpcbiAqIGh0dHA6Ly9kb2NzLmpxdWVyeS5jb20vVUkvRWZmZWN0cy9Ecm9wXG4gKlxuICogRGVwZW5kczpcbiAqXHRqcXVlcnkuZWZmZWN0cy5jb3JlLmpzXG4gKi9cbihmdW5jdGlvbihjKXtjLmVmZmVjdHMuZHJvcD1mdW5jdGlvbihkKXtyZXR1cm4gdGhpcy5xdWV1ZShmdW5jdGlvbigpe3ZhciBhPWModGhpcyksaD1bXCJwb3NpdGlvblwiLFwidG9wXCIsXCJib3R0b21cIixcImxlZnRcIixcInJpZ2h0XCIsXCJvcGFjaXR5XCJdLGU9Yy5lZmZlY3RzLnNldE1vZGUoYSxkLm9wdGlvbnMubW9kZXx8XCJoaWRlXCIpLGI9ZC5vcHRpb25zLmRpcmVjdGlvbnx8XCJsZWZ0XCI7Yy5lZmZlY3RzLnNhdmUoYSxoKTthLnNob3coKTtjLmVmZmVjdHMuY3JlYXRlV3JhcHBlcihhKTt2YXIgZj1iPT1cInVwXCJ8fGI9PVwiZG93blwiP1widG9wXCI6XCJsZWZ0XCI7Yj1iPT1cInVwXCJ8fGI9PVwibGVmdFwiP1wicG9zXCI6XCJuZWdcIjt2YXIgZz1kLm9wdGlvbnMuZGlzdGFuY2V8fChmPT1cInRvcFwiP2Eub3V0ZXJIZWlnaHQoe21hcmdpbjp0cnVlfSkvMjphLm91dGVyV2lkdGgoe21hcmdpbjp0cnVlfSkvMik7aWYoZT09XCJzaG93XCIpYS5jc3MoXCJvcGFjaXR5XCIsMCkuY3NzKGYsYj09XCJwb3NcIj8tZzpnKTt2YXIgaT17b3BhY2l0eTplPT1cblwic2hvd1wiPzE6MH07aVtmXT0oZT09XCJzaG93XCI/Yj09XCJwb3NcIj9cIis9XCI6XCItPVwiOmI9PVwicG9zXCI/XCItPVwiOlwiKz1cIikrZzthLmFuaW1hdGUoaSx7cXVldWU6ZmFsc2UsZHVyYXRpb246ZC5kdXJhdGlvbixlYXNpbmc6ZC5vcHRpb25zLmVhc2luZyxjb21wbGV0ZTpmdW5jdGlvbigpe2U9PVwiaGlkZVwiJiZhLmhpZGUoKTtjLmVmZmVjdHMucmVzdG9yZShhLGgpO2MuZWZmZWN0cy5yZW1vdmVXcmFwcGVyKGEpO2QuY2FsbGJhY2smJmQuY2FsbGJhY2suYXBwbHkodGhpcyxhcmd1bWVudHMpO2EuZGVxdWV1ZSgpfX0pfSl9fSkoalF1ZXJ5KTtcbjsvKlxuICogalF1ZXJ5IFVJIEVmZmVjdHMgRXhwbG9kZSAxLjguMTZcbiAqXG4gKiBDb3B5cmlnaHQgMjAxMSwgQVVUSE9SUy50eHQgKGh0dHA6Ly9qcXVlcnl1aS5jb20vYWJvdXQpXG4gKiBEdWFsIGxpY2Vuc2VkIHVuZGVyIHRoZSBNSVQgb3IgR1BMIFZlcnNpb24gMiBsaWNlbnNlcy5cbiAqIGh0dHA6Ly9qcXVlcnkub3JnL2xpY2Vuc2VcbiAqXG4gKiBodHRwOi8vZG9jcy5qcXVlcnkuY29tL1VJL0VmZmVjdHMvRXhwbG9kZVxuICpcbiAqIERlcGVuZHM6XG4gKlx0anF1ZXJ5LmVmZmVjdHMuY29yZS5qc1xuICovXG4oZnVuY3Rpb24oail7ai5lZmZlY3RzLmV4cGxvZGU9ZnVuY3Rpb24oYSl7cmV0dXJuIHRoaXMucXVldWUoZnVuY3Rpb24oKXt2YXIgYz1hLm9wdGlvbnMucGllY2VzP01hdGgucm91bmQoTWF0aC5zcXJ0KGEub3B0aW9ucy5waWVjZXMpKTozLGQ9YS5vcHRpb25zLnBpZWNlcz9NYXRoLnJvdW5kKE1hdGguc3FydChhLm9wdGlvbnMucGllY2VzKSk6MzthLm9wdGlvbnMubW9kZT1hLm9wdGlvbnMubW9kZT09XCJ0b2dnbGVcIj9qKHRoaXMpLmlzKFwiOnZpc2libGVcIik/XCJoaWRlXCI6XCJzaG93XCI6YS5vcHRpb25zLm1vZGU7dmFyIGI9aih0aGlzKS5zaG93KCkuY3NzKFwidmlzaWJpbGl0eVwiLFwiaGlkZGVuXCIpLGc9Yi5vZmZzZXQoKTtnLnRvcC09cGFyc2VJbnQoYi5jc3MoXCJtYXJnaW5Ub3BcIiksMTApfHwwO2cubGVmdC09cGFyc2VJbnQoYi5jc3MoXCJtYXJnaW5MZWZ0XCIpLDEwKXx8MDtmb3IodmFyIGg9Yi5vdXRlcldpZHRoKHRydWUpLGk9Yi5vdXRlckhlaWdodCh0cnVlKSxlPTA7ZTxjO2UrKylmb3IodmFyIGY9XG4wO2Y8ZDtmKyspYi5jbG9uZSgpLmFwcGVuZFRvKFwiYm9keVwiKS53cmFwKFwiPGRpdj48L2Rpdj5cIikuY3NzKHtwb3NpdGlvbjpcImFic29sdXRlXCIsdmlzaWJpbGl0eTpcInZpc2libGVcIixsZWZ0Oi1mKihoL2QpLHRvcDotZSooaS9jKX0pLnBhcmVudCgpLmFkZENsYXNzKFwidWktZWZmZWN0cy1leHBsb2RlXCIpLmNzcyh7cG9zaXRpb246XCJhYnNvbHV0ZVwiLG92ZXJmbG93OlwiaGlkZGVuXCIsd2lkdGg6aC9kLGhlaWdodDppL2MsbGVmdDpnLmxlZnQrZiooaC9kKSsoYS5vcHRpb25zLm1vZGU9PVwic2hvd1wiPyhmLU1hdGguZmxvb3IoZC8yKSkqKGgvZCk6MCksdG9wOmcudG9wK2UqKGkvYykrKGEub3B0aW9ucy5tb2RlPT1cInNob3dcIj8oZS1NYXRoLmZsb29yKGMvMikpKihpL2MpOjApLG9wYWNpdHk6YS5vcHRpb25zLm1vZGU9PVwic2hvd1wiPzA6MX0pLmFuaW1hdGUoe2xlZnQ6Zy5sZWZ0K2YqKGgvZCkrKGEub3B0aW9ucy5tb2RlPT1cInNob3dcIj8wOihmLU1hdGguZmxvb3IoZC8yKSkqKGgvZCkpLHRvcDpnLnRvcCtcbmUqKGkvYykrKGEub3B0aW9ucy5tb2RlPT1cInNob3dcIj8wOihlLU1hdGguZmxvb3IoYy8yKSkqKGkvYykpLG9wYWNpdHk6YS5vcHRpb25zLm1vZGU9PVwic2hvd1wiPzE6MH0sYS5kdXJhdGlvbnx8NTAwKTtzZXRUaW1lb3V0KGZ1bmN0aW9uKCl7YS5vcHRpb25zLm1vZGU9PVwic2hvd1wiP2IuY3NzKHt2aXNpYmlsaXR5OlwidmlzaWJsZVwifSk6Yi5jc3Moe3Zpc2liaWxpdHk6XCJ2aXNpYmxlXCJ9KS5oaWRlKCk7YS5jYWxsYmFjayYmYS5jYWxsYmFjay5hcHBseShiWzBdKTtiLmRlcXVldWUoKTtqKFwiZGl2LnVpLWVmZmVjdHMtZXhwbG9kZVwiKS5yZW1vdmUoKX0sYS5kdXJhdGlvbnx8NTAwKX0pfX0pKGpRdWVyeSk7XG47LypcbiAqIGpRdWVyeSBVSSBFZmZlY3RzIEZhZGUgMS44LjE2XG4gKlxuICogQ29weXJpZ2h0IDIwMTEsIEFVVEhPUlMudHh0IChodHRwOi8vanF1ZXJ5dWkuY29tL2Fib3V0KVxuICogRHVhbCBsaWNlbnNlZCB1bmRlciB0aGUgTUlUIG9yIEdQTCBWZXJzaW9uIDIgbGljZW5zZXMuXG4gKiBodHRwOi8vanF1ZXJ5Lm9yZy9saWNlbnNlXG4gKlxuICogaHR0cDovL2RvY3MuanF1ZXJ5LmNvbS9VSS9FZmZlY3RzL0ZhZGVcbiAqXG4gKiBEZXBlbmRzOlxuICpcdGpxdWVyeS5lZmZlY3RzLmNvcmUuanNcbiAqL1xuKGZ1bmN0aW9uKGIpe2IuZWZmZWN0cy5mYWRlPWZ1bmN0aW9uKGEpe3JldHVybiB0aGlzLnF1ZXVlKGZ1bmN0aW9uKCl7dmFyIGM9Yih0aGlzKSxkPWIuZWZmZWN0cy5zZXRNb2RlKGMsYS5vcHRpb25zLm1vZGV8fFwiaGlkZVwiKTtjLmFuaW1hdGUoe29wYWNpdHk6ZH0se3F1ZXVlOmZhbHNlLGR1cmF0aW9uOmEuZHVyYXRpb24sZWFzaW5nOmEub3B0aW9ucy5lYXNpbmcsY29tcGxldGU6ZnVuY3Rpb24oKXthLmNhbGxiYWNrJiZhLmNhbGxiYWNrLmFwcGx5KHRoaXMsYXJndW1lbnRzKTtjLmRlcXVldWUoKX19KX0pfX0pKGpRdWVyeSk7XG47LypcbiAqIGpRdWVyeSBVSSBFZmZlY3RzIEZvbGQgMS44LjE2XG4gKlxuICogQ29weXJpZ2h0IDIwMTEsIEFVVEhPUlMudHh0IChodHRwOi8vanF1ZXJ5dWkuY29tL2Fib3V0KVxuICogRHVhbCBsaWNlbnNlZCB1bmRlciB0aGUgTUlUIG9yIEdQTCBWZXJzaW9uIDIgbGljZW5zZXMuXG4gKiBodHRwOi8vanF1ZXJ5Lm9yZy9saWNlbnNlXG4gKlxuICogaHR0cDovL2RvY3MuanF1ZXJ5LmNvbS9VSS9FZmZlY3RzL0ZvbGRcbiAqXG4gKiBEZXBlbmRzOlxuICpcdGpxdWVyeS5lZmZlY3RzLmNvcmUuanNcbiAqL1xuKGZ1bmN0aW9uKGMpe2MuZWZmZWN0cy5mb2xkPWZ1bmN0aW9uKGEpe3JldHVybiB0aGlzLnF1ZXVlKGZ1bmN0aW9uKCl7dmFyIGI9Yyh0aGlzKSxqPVtcInBvc2l0aW9uXCIsXCJ0b3BcIixcImJvdHRvbVwiLFwibGVmdFwiLFwicmlnaHRcIl0sZD1jLmVmZmVjdHMuc2V0TW9kZShiLGEub3B0aW9ucy5tb2RlfHxcImhpZGVcIiksZz1hLm9wdGlvbnMuc2l6ZXx8MTUsaD0hIWEub3B0aW9ucy5ob3JpekZpcnN0LGs9YS5kdXJhdGlvbj9hLmR1cmF0aW9uLzI6Yy5meC5zcGVlZHMuX2RlZmF1bHQvMjtjLmVmZmVjdHMuc2F2ZShiLGopO2Iuc2hvdygpO3ZhciBlPWMuZWZmZWN0cy5jcmVhdGVXcmFwcGVyKGIpLmNzcyh7b3ZlcmZsb3c6XCJoaWRkZW5cIn0pLGY9ZD09XCJzaG93XCIhPWgsbD1mP1tcIndpZHRoXCIsXCJoZWlnaHRcIl06W1wiaGVpZ2h0XCIsXCJ3aWR0aFwiXTtmPWY/W2Uud2lkdGgoKSxlLmhlaWdodCgpXTpbZS5oZWlnaHQoKSxlLndpZHRoKCldO3ZhciBpPS8oWzAtOV0rKSUvLmV4ZWMoZyk7aWYoaSlnPXBhcnNlSW50KGlbMV0sXG4xMCkvMTAwKmZbZD09XCJoaWRlXCI/MDoxXTtpZihkPT1cInNob3dcIillLmNzcyhoP3toZWlnaHQ6MCx3aWR0aDpnfTp7aGVpZ2h0Omcsd2lkdGg6MH0pO2g9e307aT17fTtoW2xbMF1dPWQ9PVwic2hvd1wiP2ZbMF06ZztpW2xbMV1dPWQ9PVwic2hvd1wiP2ZbMV06MDtlLmFuaW1hdGUoaCxrLGEub3B0aW9ucy5lYXNpbmcpLmFuaW1hdGUoaSxrLGEub3B0aW9ucy5lYXNpbmcsZnVuY3Rpb24oKXtkPT1cImhpZGVcIiYmYi5oaWRlKCk7Yy5lZmZlY3RzLnJlc3RvcmUoYixqKTtjLmVmZmVjdHMucmVtb3ZlV3JhcHBlcihiKTthLmNhbGxiYWNrJiZhLmNhbGxiYWNrLmFwcGx5KGJbMF0sYXJndW1lbnRzKTtiLmRlcXVldWUoKX0pfSl9fSkoalF1ZXJ5KTtcbjsvKlxuICogalF1ZXJ5IFVJIEVmZmVjdHMgSGlnaGxpZ2h0IDEuOC4xNlxuICpcbiAqIENvcHlyaWdodCAyMDExLCBBVVRIT1JTLnR4dCAoaHR0cDovL2pxdWVyeXVpLmNvbS9hYm91dClcbiAqIER1YWwgbGljZW5zZWQgdW5kZXIgdGhlIE1JVCBvciBHUEwgVmVyc2lvbiAyIGxpY2Vuc2VzLlxuICogaHR0cDovL2pxdWVyeS5vcmcvbGljZW5zZVxuICpcbiAqIGh0dHA6Ly9kb2NzLmpxdWVyeS5jb20vVUkvRWZmZWN0cy9IaWdobGlnaHRcbiAqXG4gKiBEZXBlbmRzOlxuICpcdGpxdWVyeS5lZmZlY3RzLmNvcmUuanNcbiAqL1xuKGZ1bmN0aW9uKGIpe2IuZWZmZWN0cy5oaWdobGlnaHQ9ZnVuY3Rpb24oYyl7cmV0dXJuIHRoaXMucXVldWUoZnVuY3Rpb24oKXt2YXIgYT1iKHRoaXMpLGU9W1wiYmFja2dyb3VuZEltYWdlXCIsXCJiYWNrZ3JvdW5kQ29sb3JcIixcIm9wYWNpdHlcIl0sZD1iLmVmZmVjdHMuc2V0TW9kZShhLGMub3B0aW9ucy5tb2RlfHxcInNob3dcIiksZj17YmFja2dyb3VuZENvbG9yOmEuY3NzKFwiYmFja2dyb3VuZENvbG9yXCIpfTtpZihkPT1cImhpZGVcIilmLm9wYWNpdHk9MDtiLmVmZmVjdHMuc2F2ZShhLGUpO2Euc2hvdygpLmNzcyh7YmFja2dyb3VuZEltYWdlOlwibm9uZVwiLGJhY2tncm91bmRDb2xvcjpjLm9wdGlvbnMuY29sb3J8fFwiI2ZmZmY5OVwifSkuYW5pbWF0ZShmLHtxdWV1ZTpmYWxzZSxkdXJhdGlvbjpjLmR1cmF0aW9uLGVhc2luZzpjLm9wdGlvbnMuZWFzaW5nLGNvbXBsZXRlOmZ1bmN0aW9uKCl7ZD09XCJoaWRlXCImJmEuaGlkZSgpO2IuZWZmZWN0cy5yZXN0b3JlKGEsZSk7ZD09XCJzaG93XCImJiFiLnN1cHBvcnQub3BhY2l0eSYmXG50aGlzLnN0eWxlLnJlbW92ZUF0dHJpYnV0ZShcImZpbHRlclwiKTtjLmNhbGxiYWNrJiZjLmNhbGxiYWNrLmFwcGx5KHRoaXMsYXJndW1lbnRzKTthLmRlcXVldWUoKX19KX0pfX0pKGpRdWVyeSk7XG47LypcbiAqIGpRdWVyeSBVSSBFZmZlY3RzIFB1bHNhdGUgMS44LjE2XG4gKlxuICogQ29weXJpZ2h0IDIwMTEsIEFVVEhPUlMudHh0IChodHRwOi8vanF1ZXJ5dWkuY29tL2Fib3V0KVxuICogRHVhbCBsaWNlbnNlZCB1bmRlciB0aGUgTUlUIG9yIEdQTCBWZXJzaW9uIDIgbGljZW5zZXMuXG4gKiBodHRwOi8vanF1ZXJ5Lm9yZy9saWNlbnNlXG4gKlxuICogaHR0cDovL2RvY3MuanF1ZXJ5LmNvbS9VSS9FZmZlY3RzL1B1bHNhdGVcbiAqXG4gKiBEZXBlbmRzOlxuICpcdGpxdWVyeS5lZmZlY3RzLmNvcmUuanNcbiAqL1xuKGZ1bmN0aW9uKGQpe2QuZWZmZWN0cy5wdWxzYXRlPWZ1bmN0aW9uKGEpe3JldHVybiB0aGlzLnF1ZXVlKGZ1bmN0aW9uKCl7dmFyIGI9ZCh0aGlzKSxjPWQuZWZmZWN0cy5zZXRNb2RlKGIsYS5vcHRpb25zLm1vZGV8fFwic2hvd1wiKTt0aW1lcz0oYS5vcHRpb25zLnRpbWVzfHw1KSoyLTE7ZHVyYXRpb249YS5kdXJhdGlvbj9hLmR1cmF0aW9uLzI6ZC5meC5zcGVlZHMuX2RlZmF1bHQvMjtpc1Zpc2libGU9Yi5pcyhcIjp2aXNpYmxlXCIpO2FuaW1hdGVUbz0wO2lmKCFpc1Zpc2libGUpe2IuY3NzKFwib3BhY2l0eVwiLDApLnNob3coKTthbmltYXRlVG89MX1pZihjPT1cImhpZGVcIiYmaXNWaXNpYmxlfHxjPT1cInNob3dcIiYmIWlzVmlzaWJsZSl0aW1lcy0tO2ZvcihjPTA7Yzx0aW1lcztjKyspe2IuYW5pbWF0ZSh7b3BhY2l0eTphbmltYXRlVG99LGR1cmF0aW9uLGEub3B0aW9ucy5lYXNpbmcpO2FuaW1hdGVUbz0oYW5pbWF0ZVRvKzEpJTJ9Yi5hbmltYXRlKHtvcGFjaXR5OmFuaW1hdGVUb30sZHVyYXRpb24sXG5hLm9wdGlvbnMuZWFzaW5nLGZ1bmN0aW9uKCl7YW5pbWF0ZVRvPT0wJiZiLmhpZGUoKTthLmNhbGxiYWNrJiZhLmNhbGxiYWNrLmFwcGx5KHRoaXMsYXJndW1lbnRzKX0pO2IucXVldWUoXCJmeFwiLGZ1bmN0aW9uKCl7Yi5kZXF1ZXVlKCl9KS5kZXF1ZXVlKCl9KX19KShqUXVlcnkpO1xuOy8qXG4gKiBqUXVlcnkgVUkgRWZmZWN0cyBTY2FsZSAxLjguMTZcbiAqXG4gKiBDb3B5cmlnaHQgMjAxMSwgQVVUSE9SUy50eHQgKGh0dHA6Ly9qcXVlcnl1aS5jb20vYWJvdXQpXG4gKiBEdWFsIGxpY2Vuc2VkIHVuZGVyIHRoZSBNSVQgb3IgR1BMIFZlcnNpb24gMiBsaWNlbnNlcy5cbiAqIGh0dHA6Ly9qcXVlcnkub3JnL2xpY2Vuc2VcbiAqXG4gKiBodHRwOi8vZG9jcy5qcXVlcnkuY29tL1VJL0VmZmVjdHMvU2NhbGVcbiAqXG4gKiBEZXBlbmRzOlxuICpcdGpxdWVyeS5lZmZlY3RzLmNvcmUuanNcbiAqL1xuKGZ1bmN0aW9uKGMpe2MuZWZmZWN0cy5wdWZmPWZ1bmN0aW9uKGIpe3JldHVybiB0aGlzLnF1ZXVlKGZ1bmN0aW9uKCl7dmFyIGE9Yyh0aGlzKSxlPWMuZWZmZWN0cy5zZXRNb2RlKGEsYi5vcHRpb25zLm1vZGV8fFwiaGlkZVwiKSxnPXBhcnNlSW50KGIub3B0aW9ucy5wZXJjZW50LDEwKXx8MTUwLGg9Zy8xMDAsaT17aGVpZ2h0OmEuaGVpZ2h0KCksd2lkdGg6YS53aWR0aCgpfTtjLmV4dGVuZChiLm9wdGlvbnMse2ZhZGU6dHJ1ZSxtb2RlOmUscGVyY2VudDplPT1cImhpZGVcIj9nOjEwMCxmcm9tOmU9PVwiaGlkZVwiP2k6e2hlaWdodDppLmhlaWdodCpoLHdpZHRoOmkud2lkdGgqaH19KTthLmVmZmVjdChcInNjYWxlXCIsYi5vcHRpb25zLGIuZHVyYXRpb24sYi5jYWxsYmFjayk7YS5kZXF1ZXVlKCl9KX07Yy5lZmZlY3RzLnNjYWxlPWZ1bmN0aW9uKGIpe3JldHVybiB0aGlzLnF1ZXVlKGZ1bmN0aW9uKCl7dmFyIGE9Yyh0aGlzKSxlPWMuZXh0ZW5kKHRydWUse30sYi5vcHRpb25zKSxnPWMuZWZmZWN0cy5zZXRNb2RlKGEsXG5iLm9wdGlvbnMubW9kZXx8XCJlZmZlY3RcIiksaD1wYXJzZUludChiLm9wdGlvbnMucGVyY2VudCwxMCl8fChwYXJzZUludChiLm9wdGlvbnMucGVyY2VudCwxMCk9PTA/MDpnPT1cImhpZGVcIj8wOjEwMCksaT1iLm9wdGlvbnMuZGlyZWN0aW9ufHxcImJvdGhcIixmPWIub3B0aW9ucy5vcmlnaW47aWYoZyE9XCJlZmZlY3RcIil7ZS5vcmlnaW49Znx8W1wibWlkZGxlXCIsXCJjZW50ZXJcIl07ZS5yZXN0b3JlPXRydWV9Zj17aGVpZ2h0OmEuaGVpZ2h0KCksd2lkdGg6YS53aWR0aCgpfTthLmZyb209Yi5vcHRpb25zLmZyb218fChnPT1cInNob3dcIj97aGVpZ2h0OjAsd2lkdGg6MH06Zik7aD17eTppIT1cImhvcml6b250YWxcIj9oLzEwMDoxLHg6aSE9XCJ2ZXJ0aWNhbFwiP2gvMTAwOjF9O2EudG89e2hlaWdodDpmLmhlaWdodCpoLnksd2lkdGg6Zi53aWR0aCpoLnh9O2lmKGIub3B0aW9ucy5mYWRlKXtpZihnPT1cInNob3dcIil7YS5mcm9tLm9wYWNpdHk9MDthLnRvLm9wYWNpdHk9MX1pZihnPT1cImhpZGVcIil7YS5mcm9tLm9wYWNpdHk9XG4xO2EudG8ub3BhY2l0eT0wfX1lLmZyb209YS5mcm9tO2UudG89YS50bztlLm1vZGU9ZzthLmVmZmVjdChcInNpemVcIixlLGIuZHVyYXRpb24sYi5jYWxsYmFjayk7YS5kZXF1ZXVlKCl9KX07Yy5lZmZlY3RzLnNpemU9ZnVuY3Rpb24oYil7cmV0dXJuIHRoaXMucXVldWUoZnVuY3Rpb24oKXt2YXIgYT1jKHRoaXMpLGU9W1wicG9zaXRpb25cIixcInRvcFwiLFwiYm90dG9tXCIsXCJsZWZ0XCIsXCJyaWdodFwiLFwid2lkdGhcIixcImhlaWdodFwiLFwib3ZlcmZsb3dcIixcIm9wYWNpdHlcIl0sZz1bXCJwb3NpdGlvblwiLFwidG9wXCIsXCJib3R0b21cIixcImxlZnRcIixcInJpZ2h0XCIsXCJvdmVyZmxvd1wiLFwib3BhY2l0eVwiXSxoPVtcIndpZHRoXCIsXCJoZWlnaHRcIixcIm92ZXJmbG93XCJdLGk9W1wiZm9udFNpemVcIl0sZj1bXCJib3JkZXJUb3BXaWR0aFwiLFwiYm9yZGVyQm90dG9tV2lkdGhcIixcInBhZGRpbmdUb3BcIixcInBhZGRpbmdCb3R0b21cIl0saz1bXCJib3JkZXJMZWZ0V2lkdGhcIixcImJvcmRlclJpZ2h0V2lkdGhcIixcInBhZGRpbmdMZWZ0XCIsXCJwYWRkaW5nUmlnaHRcIl0sXG5wPWMuZWZmZWN0cy5zZXRNb2RlKGEsYi5vcHRpb25zLm1vZGV8fFwiZWZmZWN0XCIpLG49Yi5vcHRpb25zLnJlc3RvcmV8fGZhbHNlLG09Yi5vcHRpb25zLnNjYWxlfHxcImJvdGhcIixsPWIub3B0aW9ucy5vcmlnaW4saj17aGVpZ2h0OmEuaGVpZ2h0KCksd2lkdGg6YS53aWR0aCgpfTthLmZyb209Yi5vcHRpb25zLmZyb218fGo7YS50bz1iLm9wdGlvbnMudG98fGo7aWYobCl7bD1jLmVmZmVjdHMuZ2V0QmFzZWxpbmUobCxqKTthLmZyb20udG9wPShqLmhlaWdodC1hLmZyb20uaGVpZ2h0KSpsLnk7YS5mcm9tLmxlZnQ9KGoud2lkdGgtYS5mcm9tLndpZHRoKSpsLng7YS50by50b3A9KGouaGVpZ2h0LWEudG8uaGVpZ2h0KSpsLnk7YS50by5sZWZ0PShqLndpZHRoLWEudG8ud2lkdGgpKmwueH12YXIgZD17ZnJvbTp7eTphLmZyb20uaGVpZ2h0L2ouaGVpZ2h0LHg6YS5mcm9tLndpZHRoL2oud2lkdGh9LHRvOnt5OmEudG8uaGVpZ2h0L2ouaGVpZ2h0LHg6YS50by53aWR0aC9qLndpZHRofX07XG5pZihtPT1cImJveFwifHxtPT1cImJvdGhcIil7aWYoZC5mcm9tLnkhPWQudG8ueSl7ZT1lLmNvbmNhdChmKTthLmZyb209Yy5lZmZlY3RzLnNldFRyYW5zaXRpb24oYSxmLGQuZnJvbS55LGEuZnJvbSk7YS50bz1jLmVmZmVjdHMuc2V0VHJhbnNpdGlvbihhLGYsZC50by55LGEudG8pfWlmKGQuZnJvbS54IT1kLnRvLngpe2U9ZS5jb25jYXQoayk7YS5mcm9tPWMuZWZmZWN0cy5zZXRUcmFuc2l0aW9uKGEsayxkLmZyb20ueCxhLmZyb20pO2EudG89Yy5lZmZlY3RzLnNldFRyYW5zaXRpb24oYSxrLGQudG8ueCxhLnRvKX19aWYobT09XCJjb250ZW50XCJ8fG09PVwiYm90aFwiKWlmKGQuZnJvbS55IT1kLnRvLnkpe2U9ZS5jb25jYXQoaSk7YS5mcm9tPWMuZWZmZWN0cy5zZXRUcmFuc2l0aW9uKGEsaSxkLmZyb20ueSxhLmZyb20pO2EudG89Yy5lZmZlY3RzLnNldFRyYW5zaXRpb24oYSxpLGQudG8ueSxhLnRvKX1jLmVmZmVjdHMuc2F2ZShhLG4/ZTpnKTthLnNob3coKTtjLmVmZmVjdHMuY3JlYXRlV3JhcHBlcihhKTtcbmEuY3NzKFwib3ZlcmZsb3dcIixcImhpZGRlblwiKS5jc3MoYS5mcm9tKTtpZihtPT1cImNvbnRlbnRcInx8bT09XCJib3RoXCIpe2Y9Zi5jb25jYXQoW1wibWFyZ2luVG9wXCIsXCJtYXJnaW5Cb3R0b21cIl0pLmNvbmNhdChpKTtrPWsuY29uY2F0KFtcIm1hcmdpbkxlZnRcIixcIm1hcmdpblJpZ2h0XCJdKTtoPWUuY29uY2F0KGYpLmNvbmNhdChrKTthLmZpbmQoXCIqW3dpZHRoXVwiKS5lYWNoKGZ1bmN0aW9uKCl7Y2hpbGQ9Yyh0aGlzKTtuJiZjLmVmZmVjdHMuc2F2ZShjaGlsZCxoKTt2YXIgbz17aGVpZ2h0OmNoaWxkLmhlaWdodCgpLHdpZHRoOmNoaWxkLndpZHRoKCl9O2NoaWxkLmZyb209e2hlaWdodDpvLmhlaWdodCpkLmZyb20ueSx3aWR0aDpvLndpZHRoKmQuZnJvbS54fTtjaGlsZC50bz17aGVpZ2h0Om8uaGVpZ2h0KmQudG8ueSx3aWR0aDpvLndpZHRoKmQudG8ueH07aWYoZC5mcm9tLnkhPWQudG8ueSl7Y2hpbGQuZnJvbT1jLmVmZmVjdHMuc2V0VHJhbnNpdGlvbihjaGlsZCxmLGQuZnJvbS55LGNoaWxkLmZyb20pO1xuY2hpbGQudG89Yy5lZmZlY3RzLnNldFRyYW5zaXRpb24oY2hpbGQsZixkLnRvLnksY2hpbGQudG8pfWlmKGQuZnJvbS54IT1kLnRvLngpe2NoaWxkLmZyb209Yy5lZmZlY3RzLnNldFRyYW5zaXRpb24oY2hpbGQsayxkLmZyb20ueCxjaGlsZC5mcm9tKTtjaGlsZC50bz1jLmVmZmVjdHMuc2V0VHJhbnNpdGlvbihjaGlsZCxrLGQudG8ueCxjaGlsZC50byl9Y2hpbGQuY3NzKGNoaWxkLmZyb20pO2NoaWxkLmFuaW1hdGUoY2hpbGQudG8sYi5kdXJhdGlvbixiLm9wdGlvbnMuZWFzaW5nLGZ1bmN0aW9uKCl7biYmYy5lZmZlY3RzLnJlc3RvcmUoY2hpbGQsaCl9KX0pfWEuYW5pbWF0ZShhLnRvLHtxdWV1ZTpmYWxzZSxkdXJhdGlvbjpiLmR1cmF0aW9uLGVhc2luZzpiLm9wdGlvbnMuZWFzaW5nLGNvbXBsZXRlOmZ1bmN0aW9uKCl7YS50by5vcGFjaXR5PT09MCYmYS5jc3MoXCJvcGFjaXR5XCIsYS5mcm9tLm9wYWNpdHkpO3A9PVwiaGlkZVwiJiZhLmhpZGUoKTtjLmVmZmVjdHMucmVzdG9yZShhLFxubj9lOmcpO2MuZWZmZWN0cy5yZW1vdmVXcmFwcGVyKGEpO2IuY2FsbGJhY2smJmIuY2FsbGJhY2suYXBwbHkodGhpcyxhcmd1bWVudHMpO2EuZGVxdWV1ZSgpfX0pfSl9fSkoalF1ZXJ5KTtcbjsvKlxuICogalF1ZXJ5IFVJIEVmZmVjdHMgU2hha2UgMS44LjE2XG4gKlxuICogQ29weXJpZ2h0IDIwMTEsIEFVVEhPUlMudHh0IChodHRwOi8vanF1ZXJ5dWkuY29tL2Fib3V0KVxuICogRHVhbCBsaWNlbnNlZCB1bmRlciB0aGUgTUlUIG9yIEdQTCBWZXJzaW9uIDIgbGljZW5zZXMuXG4gKiBodHRwOi8vanF1ZXJ5Lm9yZy9saWNlbnNlXG4gKlxuICogaHR0cDovL2RvY3MuanF1ZXJ5LmNvbS9VSS9FZmZlY3RzL1NoYWtlXG4gKlxuICogRGVwZW5kczpcbiAqXHRqcXVlcnkuZWZmZWN0cy5jb3JlLmpzXG4gKi9cbihmdW5jdGlvbihkKXtkLmVmZmVjdHMuc2hha2U9ZnVuY3Rpb24oYSl7cmV0dXJuIHRoaXMucXVldWUoZnVuY3Rpb24oKXt2YXIgYj1kKHRoaXMpLGo9W1wicG9zaXRpb25cIixcInRvcFwiLFwiYm90dG9tXCIsXCJsZWZ0XCIsXCJyaWdodFwiXTtkLmVmZmVjdHMuc2V0TW9kZShiLGEub3B0aW9ucy5tb2RlfHxcImVmZmVjdFwiKTt2YXIgYz1hLm9wdGlvbnMuZGlyZWN0aW9ufHxcImxlZnRcIixlPWEub3B0aW9ucy5kaXN0YW5jZXx8MjAsbD1hLm9wdGlvbnMudGltZXN8fDMsZj1hLmR1cmF0aW9ufHxhLm9wdGlvbnMuZHVyYXRpb258fDE0MDtkLmVmZmVjdHMuc2F2ZShiLGopO2Iuc2hvdygpO2QuZWZmZWN0cy5jcmVhdGVXcmFwcGVyKGIpO3ZhciBnPWM9PVwidXBcInx8Yz09XCJkb3duXCI/XCJ0b3BcIjpcImxlZnRcIixoPWM9PVwidXBcInx8Yz09XCJsZWZ0XCI/XCJwb3NcIjpcIm5lZ1wiO2M9e307dmFyIGk9e30saz17fTtjW2ddPShoPT1cInBvc1wiP1wiLT1cIjpcIis9XCIpK2U7aVtnXT0oaD09XCJwb3NcIj9cIis9XCI6XCItPVwiKStlKjI7a1tnXT1cbihoPT1cInBvc1wiP1wiLT1cIjpcIis9XCIpK2UqMjtiLmFuaW1hdGUoYyxmLGEub3B0aW9ucy5lYXNpbmcpO2ZvcihlPTE7ZTxsO2UrKyliLmFuaW1hdGUoaSxmLGEub3B0aW9ucy5lYXNpbmcpLmFuaW1hdGUoayxmLGEub3B0aW9ucy5lYXNpbmcpO2IuYW5pbWF0ZShpLGYsYS5vcHRpb25zLmVhc2luZykuYW5pbWF0ZShjLGYvMixhLm9wdGlvbnMuZWFzaW5nLGZ1bmN0aW9uKCl7ZC5lZmZlY3RzLnJlc3RvcmUoYixqKTtkLmVmZmVjdHMucmVtb3ZlV3JhcHBlcihiKTthLmNhbGxiYWNrJiZhLmNhbGxiYWNrLmFwcGx5KHRoaXMsYXJndW1lbnRzKX0pO2IucXVldWUoXCJmeFwiLGZ1bmN0aW9uKCl7Yi5kZXF1ZXVlKCl9KTtiLmRlcXVldWUoKX0pfX0pKGpRdWVyeSk7XG47LypcbiAqIGpRdWVyeSBVSSBFZmZlY3RzIFNsaWRlIDEuOC4xNlxuICpcbiAqIENvcHlyaWdodCAyMDExLCBBVVRIT1JTLnR4dCAoaHR0cDovL2pxdWVyeXVpLmNvbS9hYm91dClcbiAqIER1YWwgbGljZW5zZWQgdW5kZXIgdGhlIE1JVCBvciBHUEwgVmVyc2lvbiAyIGxpY2Vuc2VzLlxuICogaHR0cDovL2pxdWVyeS5vcmcvbGljZW5zZVxuICpcbiAqIGh0dHA6Ly9kb2NzLmpxdWVyeS5jb20vVUkvRWZmZWN0cy9TbGlkZVxuICpcbiAqIERlcGVuZHM6XG4gKlx0anF1ZXJ5LmVmZmVjdHMuY29yZS5qc1xuICovXG4oZnVuY3Rpb24oYyl7Yy5lZmZlY3RzLnNsaWRlPWZ1bmN0aW9uKGQpe3JldHVybiB0aGlzLnF1ZXVlKGZ1bmN0aW9uKCl7dmFyIGE9Yyh0aGlzKSxoPVtcInBvc2l0aW9uXCIsXCJ0b3BcIixcImJvdHRvbVwiLFwibGVmdFwiLFwicmlnaHRcIl0sZj1jLmVmZmVjdHMuc2V0TW9kZShhLGQub3B0aW9ucy5tb2RlfHxcInNob3dcIiksYj1kLm9wdGlvbnMuZGlyZWN0aW9ufHxcImxlZnRcIjtjLmVmZmVjdHMuc2F2ZShhLGgpO2Euc2hvdygpO2MuZWZmZWN0cy5jcmVhdGVXcmFwcGVyKGEpLmNzcyh7b3ZlcmZsb3c6XCJoaWRkZW5cIn0pO3ZhciBnPWI9PVwidXBcInx8Yj09XCJkb3duXCI/XCJ0b3BcIjpcImxlZnRcIjtiPWI9PVwidXBcInx8Yj09XCJsZWZ0XCI/XCJwb3NcIjpcIm5lZ1wiO3ZhciBlPWQub3B0aW9ucy5kaXN0YW5jZXx8KGc9PVwidG9wXCI/YS5vdXRlckhlaWdodCh7bWFyZ2luOnRydWV9KTphLm91dGVyV2lkdGgoe21hcmdpbjp0cnVlfSkpO2lmKGY9PVwic2hvd1wiKWEuY3NzKGcsYj09XCJwb3NcIj9pc05hTihlKT9cIi1cIitlOi1lOmUpO1xudmFyIGk9e307aVtnXT0oZj09XCJzaG93XCI/Yj09XCJwb3NcIj9cIis9XCI6XCItPVwiOmI9PVwicG9zXCI/XCItPVwiOlwiKz1cIikrZTthLmFuaW1hdGUoaSx7cXVldWU6ZmFsc2UsZHVyYXRpb246ZC5kdXJhdGlvbixlYXNpbmc6ZC5vcHRpb25zLmVhc2luZyxjb21wbGV0ZTpmdW5jdGlvbigpe2Y9PVwiaGlkZVwiJiZhLmhpZGUoKTtjLmVmZmVjdHMucmVzdG9yZShhLGgpO2MuZWZmZWN0cy5yZW1vdmVXcmFwcGVyKGEpO2QuY2FsbGJhY2smJmQuY2FsbGJhY2suYXBwbHkodGhpcyxhcmd1bWVudHMpO2EuZGVxdWV1ZSgpfX0pfSl9fSkoalF1ZXJ5KTtcbjsvKlxuICogalF1ZXJ5IFVJIEVmZmVjdHMgVHJhbnNmZXIgMS44LjE2XG4gKlxuICogQ29weXJpZ2h0IDIwMTEsIEFVVEhPUlMudHh0IChodHRwOi8vanF1ZXJ5dWkuY29tL2Fib3V0KVxuICogRHVhbCBsaWNlbnNlZCB1bmRlciB0aGUgTUlUIG9yIEdQTCBWZXJzaW9uIDIgbGljZW5zZXMuXG4gKiBodHRwOi8vanF1ZXJ5Lm9yZy9saWNlbnNlXG4gKlxuICogaHR0cDovL2RvY3MuanF1ZXJ5LmNvbS9VSS9FZmZlY3RzL1RyYW5zZmVyXG4gKlxuICogRGVwZW5kczpcbiAqXHRqcXVlcnkuZWZmZWN0cy5jb3JlLmpzXG4gKi9cbihmdW5jdGlvbihlKXtlLmVmZmVjdHMudHJhbnNmZXI9ZnVuY3Rpb24oYSl7cmV0dXJuIHRoaXMucXVldWUoZnVuY3Rpb24oKXt2YXIgYj1lKHRoaXMpLGM9ZShhLm9wdGlvbnMudG8pLGQ9Yy5vZmZzZXQoKTtjPXt0b3A6ZC50b3AsbGVmdDpkLmxlZnQsaGVpZ2h0OmMuaW5uZXJIZWlnaHQoKSx3aWR0aDpjLmlubmVyV2lkdGgoKX07ZD1iLm9mZnNldCgpO3ZhciBmPWUoJzxkaXYgY2xhc3M9XCJ1aS1lZmZlY3RzLXRyYW5zZmVyXCI+PC9kaXY+JykuYXBwZW5kVG8oZG9jdW1lbnQuYm9keSkuYWRkQ2xhc3MoYS5vcHRpb25zLmNsYXNzTmFtZSkuY3NzKHt0b3A6ZC50b3AsbGVmdDpkLmxlZnQsaGVpZ2h0OmIuaW5uZXJIZWlnaHQoKSx3aWR0aDpiLmlubmVyV2lkdGgoKSxwb3NpdGlvbjpcImFic29sdXRlXCJ9KS5hbmltYXRlKGMsYS5kdXJhdGlvbixhLm9wdGlvbnMuZWFzaW5nLGZ1bmN0aW9uKCl7Zi5yZW1vdmUoKTthLmNhbGxiYWNrJiZhLmNhbGxiYWNrLmFwcGx5KGJbMF0sYXJndW1lbnRzKTtcbmIuZGVxdWV1ZSgpfSl9KX19KShqUXVlcnkpO1xuOyIsIlxuKGZ1bmN0aW9uKCQpeyQudG9KU09OPWZ1bmN0aW9uKG8pXG57aWYodHlwZW9mKEpTT04pPT0nb2JqZWN0JyYmSlNPTi5zdHJpbmdpZnkpXG5yZXR1cm4gSlNPTi5zdHJpbmdpZnkobyk7dmFyIHR5cGU9dHlwZW9mKG8pO2lmKG89PT1udWxsKVxucmV0dXJuXCJudWxsXCI7aWYodHlwZT09XCJ1bmRlZmluZWRcIilcbnJldHVybiB1bmRlZmluZWQ7aWYodHlwZT09XCJudW1iZXJcInx8dHlwZT09XCJib29sZWFuXCIpXG5yZXR1cm4gbytcIlwiO2lmKHR5cGU9PVwic3RyaW5nXCIpXG5yZXR1cm4gJC5xdW90ZVN0cmluZyhvKTtpZih0eXBlPT0nb2JqZWN0JylcbntpZih0eXBlb2Ygby50b0pTT049PVwiZnVuY3Rpb25cIilcbnJldHVybiAkLnRvSlNPTihvLnRvSlNPTigpKTtpZihvLmNvbnN0cnVjdG9yPT09RGF0ZSlcbnt2YXIgbW9udGg9by5nZXRVVENNb250aCgpKzE7aWYobW9udGg8MTApbW9udGg9JzAnK21vbnRoO3ZhciBkYXk9by5nZXRVVENEYXRlKCk7aWYoZGF5PDEwKWRheT0nMCcrZGF5O3ZhciB5ZWFyPW8uZ2V0VVRDRnVsbFllYXIoKTt2YXIgaG91cnM9by5nZXRVVENIb3VycygpO2lmKGhvdXJzPDEwKWhvdXJzPScwJytob3Vyczt2YXIgbWludXRlcz1vLmdldFVUQ01pbnV0ZXMoKTtpZihtaW51dGVzPDEwKW1pbnV0ZXM9JzAnK21pbnV0ZXM7dmFyIHNlY29uZHM9by5nZXRVVENTZWNvbmRzKCk7aWYoc2Vjb25kczwxMClzZWNvbmRzPScwJytzZWNvbmRzO3ZhciBtaWxsaT1vLmdldFVUQ01pbGxpc2Vjb25kcygpO2lmKG1pbGxpPDEwMCltaWxsaT0nMCcrbWlsbGk7aWYobWlsbGk8MTApbWlsbGk9JzAnK21pbGxpO3JldHVybidcIicreWVhcisnLScrbW9udGgrJy0nK2RheSsnVCcrXG5ob3VycysnOicrbWludXRlcysnOicrc2Vjb25kcysnLicrbWlsbGkrJ1pcIic7fVxuaWYoby5jb25zdHJ1Y3Rvcj09PUFycmF5KVxue3ZhciByZXQ9W107Zm9yKHZhciBpPTA7aTxvLmxlbmd0aDtpKyspXG5yZXQucHVzaCgkLnRvSlNPTihvW2ldKXx8XCJudWxsXCIpO3JldHVyblwiW1wiK3JldC5qb2luKFwiLFwiKStcIl1cIjt9XG52YXIgcGFpcnM9W107Zm9yKHZhciBrIGluIG8pe3ZhciBuYW1lO3ZhciB0eXBlPXR5cGVvZiBrO2lmKHR5cGU9PVwibnVtYmVyXCIpXG5uYW1lPSdcIicraysnXCInO2Vsc2UgaWYodHlwZT09XCJzdHJpbmdcIilcbm5hbWU9JC5xdW90ZVN0cmluZyhrKTtlbHNlXG5jb250aW51ZTtpZih0eXBlb2Ygb1trXT09XCJmdW5jdGlvblwiKVxuY29udGludWU7dmFyIHZhbD0kLnRvSlNPTihvW2tdKTtwYWlycy5wdXNoKG5hbWUrXCI6XCIrdmFsKTt9XG5yZXR1cm5cIntcIitwYWlycy5qb2luKFwiLCBcIikrXCJ9XCI7fX07JC5ldmFsSlNPTj1mdW5jdGlvbihzcmMpXG57aWYodHlwZW9mKEpTT04pPT0nb2JqZWN0JyYmSlNPTi5wYXJzZSlcbnJldHVybiBKU09OLnBhcnNlKHNyYyk7cmV0dXJuIGV2YWwoXCIoXCIrc3JjK1wiKVwiKTt9OyQuc2VjdXJlRXZhbEpTT049ZnVuY3Rpb24oc3JjKVxue2lmKHR5cGVvZihKU09OKT09J29iamVjdCcmJkpTT04ucGFyc2UpXG5yZXR1cm4gSlNPTi5wYXJzZShzcmMpO3ZhciBmaWx0ZXJlZD1zcmM7ZmlsdGVyZWQ9ZmlsdGVyZWQucmVwbGFjZSgvXFxcXFtcIlxcXFxcXC9iZm5ydHVdL2csJ0AnKTtmaWx0ZXJlZD1maWx0ZXJlZC5yZXBsYWNlKC9cIlteXCJcXFxcXFxuXFxyXSpcInx0cnVlfGZhbHNlfG51bGx8LT9cXGQrKD86XFwuXFxkKik/KD86W2VFXVsrXFwtXT9cXGQrKT8vZywnXScpO2ZpbHRlcmVkPWZpbHRlcmVkLnJlcGxhY2UoLyg/Ol58OnwsKSg/OlxccypcXFspKy9nLCcnKTtpZigvXltcXF0sOnt9XFxzXSokLy50ZXN0KGZpbHRlcmVkKSlcbnJldHVybiBldmFsKFwiKFwiK3NyYytcIilcIik7ZWxzZVxudGhyb3cgbmV3IFN5bnRheEVycm9yKFwiRXJyb3IgcGFyc2luZyBKU09OLCBzb3VyY2UgaXMgbm90IHZhbGlkLlwiKTt9OyQucXVvdGVTdHJpbmc9ZnVuY3Rpb24oc3RyaW5nKVxue2lmKHN0cmluZy5tYXRjaChfZXNjYXBlYWJsZSkpXG57cmV0dXJuJ1wiJytzdHJpbmcucmVwbGFjZShfZXNjYXBlYWJsZSxmdW5jdGlvbihhKVxue3ZhciBjPV9tZXRhW2FdO2lmKHR5cGVvZiBjPT09J3N0cmluZycpcmV0dXJuIGM7Yz1hLmNoYXJDb2RlQXQoKTtyZXR1cm4nXFxcXHUwMCcrTWF0aC5mbG9vcihjLzE2KS50b1N0cmluZygxNikrKGMlMTYpLnRvU3RyaW5nKDE2KTt9KSsnXCInO31cbnJldHVybidcIicrc3RyaW5nKydcIic7fTt2YXIgX2VzY2FwZWFibGU9L1tcIlxcXFxcXHgwMC1cXHgxZlxceDdmLVxceDlmXS9nO3ZhciBfbWV0YT17J1xcYic6J1xcXFxiJywnXFx0JzonXFxcXHQnLCdcXG4nOidcXFxcbicsJ1xcZic6J1xcXFxmJywnXFxyJzonXFxcXHInLCdcIic6J1xcXFxcIicsJ1xcXFwnOidcXFxcXFxcXCd9O30pKGpRdWVyeSk7IiwiLyoqXG4gKiBzcHJpbnRmIGFuZCB2c3ByaW50ZiBmb3IgalF1ZXJ5XG4gKiBzb21ld2hhdCBiYXNlZCBvbiBodHRwOi8vamFuLm1vZXNlbi5udS9jb2RlL2phdmFzY3JpcHQvc3ByaW50Zi1hbmQtcHJpbnRmLWluLWphdmFzY3JpcHQvXG4gKiBcbiAqIENvcHlyaWdodCAoYykgMjAwOCBTYWJpbiBJYWNvYiAobTBuNXQzcikgPGlhY29ic0BtMG41dDNyLmluZm8+XG4gKiBUaGlzIHByb2dyYW0gaXMgZnJlZSBzb2Z0d2FyZTogeW91IGNhbiByZWRpc3RyaWJ1dGUgaXQgYW5kL29yIG1vZGlmeVxuICogaXQgdW5kZXIgdGhlIHRlcm1zIG9mIHRoZSBHTlUgR2VuZXJhbCBQdWJsaWMgTGljZW5zZSBhcyBwdWJsaXNoZWQgYnlcbiAqIHRoZSBGcmVlIFNvZnR3YXJlIEZvdW5kYXRpb24sIGVpdGhlciB2ZXJzaW9uIDMgb2YgdGhlIExpY2Vuc2UsIG9yXG4gKiAoYXQgeW91ciBvcHRpb24pIGFueSBsYXRlciB2ZXJzaW9uLlxuICpcbiAqIFRoaXMgcHJvZ3JhbSBpcyBkaXN0cmlidXRlZCBpbiB0aGUgaG9wZSB0aGF0IGl0IHdpbGwgYmUgdXNlZnVsLFxuICogYnV0IFdJVEhPVVQgQU5ZIFdBUlJBTlRZOyB3aXRob3V0IGV2ZW4gdGhlIGltcGxpZWQgd2FycmFudHkgb2ZcbiAqIE1FUkNIQU5UQUJJTElUWSBvciBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRS4gIFNlZSB0aGVcbiAqIEdOVSBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGZvciBtb3JlIGRldGFpbHMuIFxuICpcbiAqIEBsaWNlbnNlIGh0dHA6Ly93d3cuZ251Lm9yZy9saWNlbnNlcy9ncGwuaHRtbCBcbiAqIEBwcm9qZWN0IGpxdWVyeS5zcHJpbnRmXG4gKi9cbihmdW5jdGlvbigkKXtcblx0dmFyIGZvcm1hdHMgPSB7XG5cdFx0J2InOiBmdW5jdGlvbih2YWwpIHtyZXR1cm4gcGFyc2VJbnQodmFsLCAxMCkudG9TdHJpbmcoMik7fSxcblx0XHQnYyc6IGZ1bmN0aW9uKHZhbCkge3JldHVybiBTdHJpbmcuZnJvbUNoYXJDb2RlKHBhcnNlSW50KHZhbCwgMTApKTt9LFxuXHRcdCdkJzogZnVuY3Rpb24odmFsKSB7cmV0dXJuIHBhcnNlSW50KHZhbCwgMTApO30sXG5cdFx0J3UnOiBmdW5jdGlvbih2YWwpIHtyZXR1cm4gTWF0aC5hYnModmFsKTt9LFxuXHRcdCdmJzogZnVuY3Rpb24odmFsLCBwKSB7XG5cdFx0XHRwID0gcGFyc2VJbnQocCwgMTApOyBcblx0XHRcdHZhbCA9IHBhcnNlRmxvYXQodmFsKTtcblx0XHRcdGlmKGlzTmFOKHAgJiYgdmFsKSkge1xuXHRcdFx0XHRyZXR1cm4gTmFOO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHAgJiYgdmFsLnRvRml4ZWQocCkgfHwgdmFsO1xuXHRcdH0sXG5cdFx0J28nOiBmdW5jdGlvbih2YWwpIHtyZXR1cm4gcGFyc2VJbnQodmFsLCAxMCkudG9TdHJpbmcoOCk7fSxcblx0XHQncyc6IGZ1bmN0aW9uKHZhbCkge3JldHVybiB2YWw7fSxcblx0XHQneCc6IGZ1bmN0aW9uKHZhbCkge3JldHVybiAoJycgKyBwYXJzZUludCh2YWwsIDEwKS50b1N0cmluZygxNikpLnRvTG93ZXJDYXNlKCk7fSxcblx0XHQnWCc6IGZ1bmN0aW9uKHZhbCkge3JldHVybiAoJycgKyBwYXJzZUludCh2YWwsIDEwKS50b1N0cmluZygxNikpLnRvVXBwZXJDYXNlKCk7fVxuXHR9O1xuXG5cdHZhciByZSA9IC8lKD86KFxcZCspPyg/OlxcLihcXGQrKSk/fFxcKChbXildKylcXCkpKFslYmNkdWZvc3hYXSkvZztcblxuXHR2YXIgZGlzcGF0Y2ggPSBmdW5jdGlvbihkYXRhKXtcblx0XHRpZihkYXRhLmxlbmd0aCA9PSAxICYmIHR5cGVvZiBkYXRhWzBdID09ICdvYmplY3QnKSB7IC8vcHl0aG9uLXN0eWxlIHByaW50ZlxuXHRcdFx0ZGF0YSA9IGRhdGFbMF07XG5cdFx0XHRyZXR1cm4gZnVuY3Rpb24obWF0Y2gsIHcsIHAsIGxibCwgZm10LCBvZmYsIHN0cikge1xuXHRcdFx0XHRyZXR1cm4gZm9ybWF0c1tmbXRdKGRhdGFbbGJsXSk7XG5cdFx0XHR9O1xuXHRcdH0gZWxzZSB7IC8vIHJlZ3VsYXIsIHNvbWV3aGF0IGluY29tcGxldGUsIHByaW50ZlxuXHRcdFx0dmFyIGlkeCA9IDA7IFxuXHRcdFx0cmV0dXJuIGZ1bmN0aW9uKG1hdGNoLCB3LCBwLCBsYmwsIGZtdCwgb2ZmLCBzdHIpIHtcblx0XHRcdFx0aWYoZm10ID09ICclJykge1xuXHRcdFx0XHRcdHJldHVybiAnJSc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIGZvcm1hdHNbZm10XShkYXRhW2lkeCsrXSwgcCk7XG5cdFx0XHR9O1xuXHRcdH1cblx0fTtcblxuXHQkLmV4dGVuZCh7XG5cdFx0c3ByaW50ZjogZnVuY3Rpb24oZm9ybWF0KSB7XG5cdFx0XHR2YXIgYXJndiA9IEFycmF5LmFwcGx5KG51bGwsIGFyZ3VtZW50cykuc2xpY2UoMSk7XG5cdFx0XHRyZXR1cm4gZm9ybWF0LnJlcGxhY2UocmUsIGRpc3BhdGNoKGFyZ3YpKTtcblx0XHR9LFxuXHRcdHZzcHJpbnRmOiBmdW5jdGlvbihmb3JtYXQsIGRhdGEpIHtcblx0XHRcdHJldHVybiBmb3JtYXQucmVwbGFjZShyZSwgZGlzcGF0Y2goZGF0YSkpO1xuXHRcdH1cblx0fSk7XG59KShqUXVlcnkpO1xuIiwiLyogaHR0cDovL2tlaXRoLXdvb2QubmFtZS9zdmcuaHRtbFxyXG4gICBTVkcgZm9yIGpRdWVyeSB2MS40LjMuXHJcbiAgIFdyaXR0ZW4gYnkgS2VpdGggV29vZCAoa2J3b29ke2F0fWlpbmV0LmNvbS5hdSkgQXVndXN0IDIwMDcuXHJcbiAgIER1YWwgbGljZW5zZWQgdW5kZXIgdGhlIEdQTCAoaHR0cDovL2Rldi5qcXVlcnkuY29tL2Jyb3dzZXIvdHJ1bmsvanF1ZXJ5L0dQTC1MSUNFTlNFLnR4dCkgYW5kIFxyXG4gICBNSVQgKGh0dHA6Ly9kZXYuanF1ZXJ5LmNvbS9icm93c2VyL3RydW5rL2pxdWVyeS9NSVQtTElDRU5TRS50eHQpIGxpY2Vuc2VzLiBcclxuICAgUGxlYXNlIGF0dHJpYnV0ZSB0aGUgYXV0aG9yIGlmIHlvdSB1c2UgaXQuICovXHJcbihmdW5jdGlvbigkKXtmdW5jdGlvbiBTVkdNYW5hZ2VyKCl7dGhpcy5fc2V0dGluZ3M9W107dGhpcy5fZXh0ZW5zaW9ucz1bXTt0aGlzLnJlZ2lvbmFsPVtdO3RoaXMucmVnaW9uYWxbJyddPXtlcnJvckxvYWRpbmdUZXh0OidFcnJvciBsb2FkaW5nJyxub3RTdXBwb3J0ZWRUZXh0OidUaGlzIGJyb3dzZXIgZG9lcyBub3Qgc3VwcG9ydCBTVkcnfTt0aGlzLmxvY2FsPXRoaXMucmVnaW9uYWxbJyddO3RoaXMuX3V1aWQ9bmV3IERhdGUoKS5nZXRUaW1lKCk7dGhpcy5fcmVuZXNpcz1kZXRlY3RBY3RpdmVYKCdSZW5lc2lzWC5SZW5lc2lzQ3RybCcpfWZ1bmN0aW9uIGRldGVjdEFjdGl2ZVgoYSl7dHJ5e3JldHVybiEhKHdpbmRvdy5BY3RpdmVYT2JqZWN0JiZuZXcgQWN0aXZlWE9iamVjdChhKSl9Y2F0Y2goZSl7cmV0dXJuIGZhbHNlfX12YXIgcD0nc3Znd3JhcHBlcic7JC5leHRlbmQoU1ZHTWFuYWdlci5wcm90b3R5cGUse21hcmtlckNsYXNzTmFtZTonaGFzU1ZHJyxzdmdOUzonaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmcnLHhsaW5rTlM6J2h0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsnLF93cmFwcGVyQ2xhc3M6U1ZHV3JhcHBlcixfYXR0ck5hbWVzOntjbGFzc186J2NsYXNzJyxpbl86J2luJyxhbGlnbm1lbnRCYXNlbGluZTonYWxpZ25tZW50LWJhc2VsaW5lJyxiYXNlbGluZVNoaWZ0OidiYXNlbGluZS1zaGlmdCcsY2xpcFBhdGg6J2NsaXAtcGF0aCcsY2xpcFJ1bGU6J2NsaXAtcnVsZScsY29sb3JJbnRlcnBvbGF0aW9uOidjb2xvci1pbnRlcnBvbGF0aW9uJyxjb2xvckludGVycG9sYXRpb25GaWx0ZXJzOidjb2xvci1pbnRlcnBvbGF0aW9uLWZpbHRlcnMnLGNvbG9yUmVuZGVyaW5nOidjb2xvci1yZW5kZXJpbmcnLGRvbWluYW50QmFzZWxpbmU6J2RvbWluYW50LWJhc2VsaW5lJyxlbmFibGVCYWNrZ3JvdW5kOidlbmFibGUtYmFja2dyb3VuZCcsZmlsbE9wYWNpdHk6J2ZpbGwtb3BhY2l0eScsZmlsbFJ1bGU6J2ZpbGwtcnVsZScsZmxvb2RDb2xvcjonZmxvb2QtY29sb3InLGZsb29kT3BhY2l0eTonZmxvb2Qtb3BhY2l0eScsZm9udEZhbWlseTonZm9udC1mYW1pbHknLGZvbnRTaXplOidmb250LXNpemUnLGZvbnRTaXplQWRqdXN0Oidmb250LXNpemUtYWRqdXN0Jyxmb250U3RyZXRjaDonZm9udC1zdHJldGNoJyxmb250U3R5bGU6J2ZvbnQtc3R5bGUnLGZvbnRWYXJpYW50Oidmb250LXZhcmlhbnQnLGZvbnRXZWlnaHQ6J2ZvbnQtd2VpZ2h0JyxnbHlwaE9yaWVudGF0aW9uSG9yaXpvbnRhbDonZ2x5cGgtb3JpZW50YXRpb24taG9yaXpvbnRhbCcsZ2x5cGhPcmllbnRhdGlvblZlcnRpY2FsOidnbHlwaC1vcmllbnRhdGlvbi12ZXJ0aWNhbCcsaG9yaXpBZHZYOidob3Jpei1hZHYteCcsaG9yaXpPcmlnaW5YOidob3Jpei1vcmlnaW4teCcsaW1hZ2VSZW5kZXJpbmc6J2ltYWdlLXJlbmRlcmluZycsbGV0dGVyU3BhY2luZzonbGV0dGVyLXNwYWNpbmcnLGxpZ2h0aW5nQ29sb3I6J2xpZ2h0aW5nLWNvbG9yJyxtYXJrZXJFbmQ6J21hcmtlci1lbmQnLG1hcmtlck1pZDonbWFya2VyLW1pZCcsbWFya2VyU3RhcnQ6J21hcmtlci1zdGFydCcsc3RvcENvbG9yOidzdG9wLWNvbG9yJyxzdG9wT3BhY2l0eTonc3RvcC1vcGFjaXR5JyxzdHJpa2V0aHJvdWdoUG9zaXRpb246J3N0cmlrZXRocm91Z2gtcG9zaXRpb24nLHN0cmlrZXRocm91Z2hUaGlja25lc3M6J3N0cmlrZXRocm91Z2gtdGhpY2tuZXNzJyxzdHJva2VEYXNoQXJyYXk6J3N0cm9rZS1kYXNoYXJyYXknLHN0cm9rZURhc2hPZmZzZXQ6J3N0cm9rZS1kYXNob2Zmc2V0JyxzdHJva2VMaW5lQ2FwOidzdHJva2UtbGluZWNhcCcsc3Ryb2tlTGluZUpvaW46J3N0cm9rZS1saW5lam9pbicsc3Ryb2tlTWl0ZXJMaW1pdDonc3Ryb2tlLW1pdGVybGltaXQnLHN0cm9rZU9wYWNpdHk6J3N0cm9rZS1vcGFjaXR5JyxzdHJva2VXaWR0aDonc3Ryb2tlLXdpZHRoJyx0ZXh0QW5jaG9yOid0ZXh0LWFuY2hvcicsdGV4dERlY29yYXRpb246J3RleHQtZGVjb3JhdGlvbicsdGV4dFJlbmRlcmluZzondGV4dC1yZW5kZXJpbmcnLHVuZGVybGluZVBvc2l0aW9uOid1bmRlcmxpbmUtcG9zaXRpb24nLHVuZGVybGluZVRoaWNrbmVzczondW5kZXJsaW5lLXRoaWNrbmVzcycsdmVydEFkdlk6J3ZlcnQtYWR2LXknLHZlcnRPcmlnaW5ZOid2ZXJ0LW9yaWdpbi15Jyx3b3JkU3BhY2luZzond29yZC1zcGFjaW5nJyx3cml0aW5nTW9kZTond3JpdGluZy1tb2RlJ30sX2F0dGFjaFNWRzpmdW5jdGlvbihhLGIpe3ZhciBjPShhLm5hbWVzcGFjZVVSST09dGhpcy5zdmdOUz9hOm51bGwpO3ZhciBhPShjP251bGw6YSk7aWYoJChhfHxjKS5oYXNDbGFzcyh0aGlzLm1hcmtlckNsYXNzTmFtZSkpe3JldHVybn1pZih0eXBlb2YgYj09J3N0cmluZycpe2I9e2xvYWRVUkw6Yn19ZWxzZSBpZih0eXBlb2YgYj09J2Z1bmN0aW9uJyl7Yj17b25Mb2FkOmJ9fSQoYXx8YykuYWRkQ2xhc3ModGhpcy5tYXJrZXJDbGFzc05hbWUpO3RyeXtpZighYyl7Yz1kb2N1bWVudC5jcmVhdGVFbGVtZW50TlModGhpcy5zdmdOUywnc3ZnJyk7Yy5zZXRBdHRyaWJ1dGUoJ3ZlcnNpb24nLCcxLjEnKTtjLnNldEF0dHJpYnV0ZSgnd2lkdGgnLGEuY2xpZW50V2lkdGgpO2Muc2V0QXR0cmlidXRlKCdoZWlnaHQnLGEuY2xpZW50SGVpZ2h0KTthLmFwcGVuZENoaWxkKGMpfXRoaXMuX2FmdGVyTG9hZChhLGMsYnx8e30pfWNhdGNoKGUpe2lmKCQuYnJvd3Nlci5tc2llKXtpZighYS5pZCl7YS5pZD0nc3ZnJysodGhpcy5fdXVpZCsrKX10aGlzLl9zZXR0aW5nc1thLmlkXT1iO2EuaW5uZXJIVE1MPSc8ZW1iZWQgdHlwZT1cImltYWdlL3N2Zyt4bWxcIiB3aWR0aD1cIjEwMCVcIiAnKydoZWlnaHQ9XCIxMDAlXCIgc3JjPVwiJysoYi5pbml0UGF0aHx8JycpKydibGFuay5zdmdcIi8+J31lbHNle2EuaW5uZXJIVE1MPSc8cCBjbGFzcz1cInN2Z19lcnJvclwiPicrdGhpcy5sb2NhbC5ub3RTdXBwb3J0ZWRUZXh0Kyc8L3A+J319fSxfcmVnaXN0ZXJTVkc6ZnVuY3Rpb24oKXtmb3IodmFyIGk9MDtpPGRvY3VtZW50LmVtYmVkcy5sZW5ndGg7aSsrKXt2YXIgYT1kb2N1bWVudC5lbWJlZHNbaV0ucGFyZW50Tm9kZTtpZighJChhKS5oYXNDbGFzcygkLnN2Zy5tYXJrZXJDbGFzc05hbWUpfHwkLmRhdGEoYSxwKSl7Y29udGludWV9dmFyIGI9bnVsbDt0cnl7Yj1kb2N1bWVudC5lbWJlZHNbaV0uZ2V0U1ZHRG9jdW1lbnQoKX1jYXRjaChlKXtzZXRUaW1lb3V0KCQuc3ZnLl9yZWdpc3RlclNWRywyNTApO3JldHVybn1iPShiP2IuZG9jdW1lbnRFbGVtZW50Om51bGwpO2lmKGIpeyQuc3ZnLl9hZnRlckxvYWQoYSxiKX19fSxfYWZ0ZXJMb2FkOmZ1bmN0aW9uKGEsYixjKXt2YXIgYz1jfHx0aGlzLl9zZXR0aW5nc1thLmlkXTt0aGlzLl9zZXR0aW5nc1thP2EuaWQ6JyddPW51bGw7dmFyIGQ9bmV3IHRoaXMuX3dyYXBwZXJDbGFzcyhiLGEpOyQuZGF0YShhfHxiLHAsZCk7dHJ5e2lmKGMubG9hZFVSTCl7ZC5sb2FkKGMubG9hZFVSTCxjKX1pZihjLnNldHRpbmdzKXtkLmNvbmZpZ3VyZShjLnNldHRpbmdzKX1pZihjLm9uTG9hZCYmIWMubG9hZFVSTCl7Yy5vbkxvYWQuYXBwbHkoYXx8YixbZF0pfX1jYXRjaChlKXthbGVydChlKX19LF9nZXRTVkc6ZnVuY3Rpb24oYSl7YT0odHlwZW9mIGE9PSdzdHJpbmcnPyQoYSlbMF06KGEuanF1ZXJ5P2FbMF06YSkpO3JldHVybiAkLmRhdGEoYSxwKX0sX2Rlc3Ryb3lTVkc6ZnVuY3Rpb24oYSl7dmFyIGI9JChhKTtpZighYi5oYXNDbGFzcyh0aGlzLm1hcmtlckNsYXNzTmFtZSkpe3JldHVybn1iLnJlbW92ZUNsYXNzKHRoaXMubWFya2VyQ2xhc3NOYW1lKTtpZihhLm5hbWVzcGFjZVVSSSE9dGhpcy5zdmdOUyl7Yi5lbXB0eSgpfSQucmVtb3ZlRGF0YShhLHApfSxhZGRFeHRlbnNpb246ZnVuY3Rpb24oYSxiKXt0aGlzLl9leHRlbnNpb25zLnB1c2goW2EsYl0pfX0pO2Z1bmN0aW9uIFNWR1dyYXBwZXIoYSxiKXt0aGlzLl9zdmc9YTt0aGlzLl9jb250YWluZXI9Yjtmb3IodmFyIGk9MDtpPCQuc3ZnLl9leHRlbnNpb25zLmxlbmd0aDtpKyspe3ZhciBjPSQuc3ZnLl9leHRlbnNpb25zW2ldO3RoaXNbY1swXV09bmV3IGNbMV0odGhpcyl9fSQuZXh0ZW5kKFNWR1dyYXBwZXIucHJvdG90eXBlLHtfd2lkdGg6ZnVuY3Rpb24oKXtyZXR1cm4odGhpcy5fY29udGFpbmVyP3RoaXMuX2NvbnRhaW5lci5jbGllbnRXaWR0aDp0aGlzLl9zdmcud2lkdGgpfSxfaGVpZ2h0OmZ1bmN0aW9uKCl7cmV0dXJuKHRoaXMuX2NvbnRhaW5lcj90aGlzLl9jb250YWluZXIuY2xpZW50SGVpZ2h0OnRoaXMuX3N2Zy5oZWlnaHQpfSxyb290OmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuX3N2Z30sY29uZmlndXJlOmZ1bmN0aW9uKGEsYil7aWYoYil7Zm9yKHZhciBpPXRoaXMuX3N2Zy5hdHRyaWJ1dGVzLmxlbmd0aC0xO2k+PTA7aS0tKXt2YXIgYz10aGlzLl9zdmcuYXR0cmlidXRlcy5pdGVtKGkpO2lmKCEoYy5ub2RlTmFtZT09J29ubG9hZCd8fGMubm9kZU5hbWU9PSd2ZXJzaW9uJ3x8Yy5ub2RlTmFtZS5zdWJzdHJpbmcoMCw1KT09J3htbG5zJykpe3RoaXMuX3N2Zy5hdHRyaWJ1dGVzLnJlbW92ZU5hbWVkSXRlbShjLm5vZGVOYW1lKX19fWZvcih2YXIgZCBpbiBhKXt0aGlzLl9zdmcuc2V0QXR0cmlidXRlKGQsYVtkXSl9cmV0dXJuIHRoaXN9LGdldEVsZW1lbnRCeUlkOmZ1bmN0aW9uKGEpe3JldHVybiB0aGlzLl9zdmcub3duZXJEb2N1bWVudC5nZXRFbGVtZW50QnlJZChhKX0sY2hhbmdlOmZ1bmN0aW9uKGEsYil7aWYoYSl7Zm9yKHZhciBjIGluIGIpe2lmKGJbY109PW51bGwpe2EucmVtb3ZlQXR0cmlidXRlKGMpfWVsc2V7YS5zZXRBdHRyaWJ1dGUoYyxiW2NdKX19fXJldHVybiB0aGlzfSxfYXJnczpmdW5jdGlvbihiLGMsZCl7Yy5zcGxpY2UoMCwwLCdwYXJlbnQnKTtjLnNwbGljZShjLmxlbmd0aCwwLCdzZXR0aW5ncycpO3ZhciBlPXt9O3ZhciBmPTA7aWYoYlswXSE9bnVsbCYmYlswXS5qcXVlcnkpe2JbMF09YlswXVswXX1pZihiWzBdIT1udWxsJiYhKHR5cGVvZiBiWzBdPT0nb2JqZWN0JyYmYlswXS5ub2RlTmFtZSkpe2VbJ3BhcmVudCddPW51bGw7Zj0xfWZvcih2YXIgaT0wO2k8Yi5sZW5ndGg7aSsrKXtlW2NbaStmXV09YltpXX1pZihkKXskLmVhY2goZCxmdW5jdGlvbihpLGEpe2lmKHR5cGVvZiBlW2FdPT0nb2JqZWN0Jyl7ZS5zZXR0aW5ncz1lW2FdO2VbYV09bnVsbH19KX1yZXR1cm4gZX0sdGl0bGU6ZnVuY3Rpb24oYSxiLGMpe3ZhciBkPXRoaXMuX2FyZ3MoYXJndW1lbnRzLFsndGV4dCddKTt2YXIgZT10aGlzLl9tYWtlTm9kZShkLnBhcmVudCwndGl0bGUnLGQuc2V0dGluZ3N8fHt9KTtlLmFwcGVuZENoaWxkKHRoaXMuX3N2Zy5vd25lckRvY3VtZW50LmNyZWF0ZVRleHROb2RlKGQudGV4dCkpO3JldHVybiBlfSxkZXNjcmliZTpmdW5jdGlvbihhLGIsYyl7dmFyIGQ9dGhpcy5fYXJncyhhcmd1bWVudHMsWyd0ZXh0J10pO3ZhciBlPXRoaXMuX21ha2VOb2RlKGQucGFyZW50LCdkZXNjJyxkLnNldHRpbmdzfHx7fSk7ZS5hcHBlbmRDaGlsZCh0aGlzLl9zdmcub3duZXJEb2N1bWVudC5jcmVhdGVUZXh0Tm9kZShkLnRleHQpKTtyZXR1cm4gZX0sZGVmczpmdW5jdGlvbihhLGIsYyl7dmFyIGQ9dGhpcy5fYXJncyhhcmd1bWVudHMsWydpZCddLFsnaWQnXSk7cmV0dXJuIHRoaXMuX21ha2VOb2RlKGQucGFyZW50LCdkZWZzJywkLmV4dGVuZCgoZC5pZD97aWQ6ZC5pZH06e30pLGQuc2V0dGluZ3N8fHt9KSl9LHN5bWJvbDpmdW5jdGlvbihhLGIsYyxkLGUsZixnKXt2YXIgaD10aGlzLl9hcmdzKGFyZ3VtZW50cyxbJ2lkJywneDEnLCd5MScsJ3dpZHRoJywnaGVpZ2h0J10pO3JldHVybiB0aGlzLl9tYWtlTm9kZShoLnBhcmVudCwnc3ltYm9sJywkLmV4dGVuZCh7aWQ6aC5pZCx2aWV3Qm94OmgueDErJyAnK2gueTErJyAnK2gud2lkdGgrJyAnK2guaGVpZ2h0fSxoLnNldHRpbmdzfHx7fSkpfSxtYXJrZXI6ZnVuY3Rpb24oYSxiLGMsZCxlLGYsZyxoKXt2YXIgaT10aGlzLl9hcmdzKGFyZ3VtZW50cyxbJ2lkJywncmVmWCcsJ3JlZlknLCdtV2lkdGgnLCdtSGVpZ2h0Jywnb3JpZW50J10sWydvcmllbnQnXSk7cmV0dXJuIHRoaXMuX21ha2VOb2RlKGkucGFyZW50LCdtYXJrZXInLCQuZXh0ZW5kKHtpZDppLmlkLHJlZlg6aS5yZWZYLHJlZlk6aS5yZWZZLG1hcmtlcldpZHRoOmkubVdpZHRoLG1hcmtlckhlaWdodDppLm1IZWlnaHQsb3JpZW50Omkub3JpZW50fHwnYXV0byd9LGkuc2V0dGluZ3N8fHt9KSl9LHN0eWxlOmZ1bmN0aW9uKGEsYixjKXt2YXIgZD10aGlzLl9hcmdzKGFyZ3VtZW50cyxbJ3N0eWxlcyddKTt2YXIgZT10aGlzLl9tYWtlTm9kZShkLnBhcmVudCwnc3R5bGUnLCQuZXh0ZW5kKHt0eXBlOid0ZXh0L2Nzcyd9LGQuc2V0dGluZ3N8fHt9KSk7ZS5hcHBlbmRDaGlsZCh0aGlzLl9zdmcub3duZXJEb2N1bWVudC5jcmVhdGVUZXh0Tm9kZShkLnN0eWxlcykpO2lmKCQuYnJvd3Nlci5vcGVyYSl7JCgnaGVhZCcpLmFwcGVuZCgnPHN0eWxlIHR5cGU9XCJ0ZXh0L2Nzc1wiPicrZC5zdHlsZXMrJzwvc3R5bGU+Jyl9cmV0dXJuIGV9LHNjcmlwdDpmdW5jdGlvbihhLGIsYyxkKXt2YXIgZT10aGlzLl9hcmdzKGFyZ3VtZW50cyxbJ3NjcmlwdCcsJ3R5cGUnXSxbJ3R5cGUnXSk7dmFyIGY9dGhpcy5fbWFrZU5vZGUoZS5wYXJlbnQsJ3NjcmlwdCcsJC5leHRlbmQoe3R5cGU6ZS50eXBlfHwndGV4dC9qYXZhc2NyaXB0J30sZS5zZXR0aW5nc3x8e30pKTtmLmFwcGVuZENoaWxkKHRoaXMuX3N2Zy5vd25lckRvY3VtZW50LmNyZWF0ZVRleHROb2RlKHRoaXMuX2VzY2FwZVhNTChlLnNjcmlwdCkpKTtpZighJC5icm93c2VyLm1vemlsbGEpeyQuZ2xvYmFsRXZhbChlLnNjcmlwdCl9cmV0dXJuIGZ9LGxpbmVhckdyYWRpZW50OmZ1bmN0aW9uKGEsYixjLGQsZSxmLGcsaCl7dmFyIGk9dGhpcy5fYXJncyhhcmd1bWVudHMsWydpZCcsJ3N0b3BzJywneDEnLCd5MScsJ3gyJywneTInXSxbJ3gxJ10pO3ZhciBqPSQuZXh0ZW5kKHtpZDppLmlkfSwoaS54MSE9bnVsbD97eDE6aS54MSx5MTppLnkxLHgyOmkueDIseTI6aS55Mn06e30pKTtyZXR1cm4gdGhpcy5fZ3JhZGllbnQoaS5wYXJlbnQsJ2xpbmVhckdyYWRpZW50JywkLmV4dGVuZChqLGkuc2V0dGluZ3N8fHt9KSxpLnN0b3BzKX0scmFkaWFsR3JhZGllbnQ6ZnVuY3Rpb24oYSxiLGMsZCxlLHIsZixnLGgpe3ZhciBpPXRoaXMuX2FyZ3MoYXJndW1lbnRzLFsnaWQnLCdzdG9wcycsJ2N4JywnY3knLCdyJywnZngnLCdmeSddLFsnY3gnXSk7dmFyIGo9JC5leHRlbmQoe2lkOmkuaWR9LChpLmN4IT1udWxsP3tjeDppLmN4LGN5OmkuY3kscjppLnIsZng6aS5meCxmeTppLmZ5fTp7fSkpO3JldHVybiB0aGlzLl9ncmFkaWVudChpLnBhcmVudCwncmFkaWFsR3JhZGllbnQnLCQuZXh0ZW5kKGosaS5zZXR0aW5nc3x8e30pLGkuc3RvcHMpfSxfZ3JhZGllbnQ6ZnVuY3Rpb24oYSxiLGMsZCl7dmFyIGU9dGhpcy5fbWFrZU5vZGUoYSxiLGMpO2Zvcih2YXIgaT0wO2k8ZC5sZW5ndGg7aSsrKXt2YXIgZj1kW2ldO3RoaXMuX21ha2VOb2RlKGUsJ3N0b3AnLCQuZXh0ZW5kKHtvZmZzZXQ6ZlswXSxzdG9wQ29sb3I6ZlsxXX0sKGZbMl0hPW51bGw/e3N0b3BPcGFjaXR5OmZbMl19Ont9KSkpfXJldHVybiBlfSxwYXR0ZXJuOmZ1bmN0aW9uKGEsYix4LHksYyxkLGUsZixnLGgsaSl7dmFyIGo9dGhpcy5fYXJncyhhcmd1bWVudHMsWydpZCcsJ3gnLCd5Jywnd2lkdGgnLCdoZWlnaHQnLCd2eCcsJ3Z5JywndndpZHRoJywndmhlaWdodCddLFsndngnXSk7dmFyIGs9JC5leHRlbmQoe2lkOmouaWQseDpqLngseTpqLnksd2lkdGg6ai53aWR0aCxoZWlnaHQ6ai5oZWlnaHR9LChqLnZ4IT1udWxsP3t2aWV3Qm94OmoudngrJyAnK2oudnkrJyAnK2oudndpZHRoKycgJytqLnZoZWlnaHR9Ont9KSk7cmV0dXJuIHRoaXMuX21ha2VOb2RlKGoucGFyZW50LCdwYXR0ZXJuJywkLmV4dGVuZChrLGouc2V0dGluZ3N8fHt9KSl9LG1hc2s6ZnVuY3Rpb24oYSxiLHgseSxjLGQsZSl7dmFyIGY9dGhpcy5fYXJncyhhcmd1bWVudHMsWydpZCcsJ3gnLCd5Jywnd2lkdGgnLCdoZWlnaHQnXSk7cmV0dXJuIHRoaXMuX21ha2VOb2RlKGYucGFyZW50LCdtYXNrJywkLmV4dGVuZCh7aWQ6Zi5pZCx4OmYueCx5OmYueSx3aWR0aDpmLndpZHRoLGhlaWdodDpmLmhlaWdodH0sZi5zZXR0aW5nc3x8e30pKX0sY3JlYXRlUGF0aDpmdW5jdGlvbigpe3JldHVybiBuZXcgU1ZHUGF0aCgpfSxjcmVhdGVUZXh0OmZ1bmN0aW9uKCl7cmV0dXJuIG5ldyBTVkdUZXh0KCl9LHN2ZzpmdW5jdGlvbihhLHgseSxiLGMsZCxlLGYsZyxoKXt2YXIgaT10aGlzLl9hcmdzKGFyZ3VtZW50cyxbJ3gnLCd5Jywnd2lkdGgnLCdoZWlnaHQnLCd2eCcsJ3Z5JywndndpZHRoJywndmhlaWdodCddLFsndngnXSk7dmFyIGo9JC5leHRlbmQoe3g6aS54LHk6aS55LHdpZHRoOmkud2lkdGgsaGVpZ2h0OmkuaGVpZ2h0fSwoaS52eCE9bnVsbD97dmlld0JveDppLnZ4KycgJytpLnZ5KycgJytpLnZ3aWR0aCsnICcraS52aGVpZ2h0fTp7fSkpO3JldHVybiB0aGlzLl9tYWtlTm9kZShpLnBhcmVudCwnc3ZnJywkLmV4dGVuZChqLGkuc2V0dGluZ3N8fHt9KSl9LGdyb3VwOmZ1bmN0aW9uKGEsYixjKXt2YXIgZD10aGlzLl9hcmdzKGFyZ3VtZW50cyxbJ2lkJ10sWydpZCddKTtyZXR1cm4gdGhpcy5fbWFrZU5vZGUoZC5wYXJlbnQsJ2cnLCQuZXh0ZW5kKHtpZDpkLmlkfSxkLnNldHRpbmdzfHx7fSkpfSx1c2U6ZnVuY3Rpb24oYSx4LHksYixjLGQsZSl7dmFyIGY9dGhpcy5fYXJncyhhcmd1bWVudHMsWyd4JywneScsJ3dpZHRoJywnaGVpZ2h0JywncmVmJ10pO2lmKHR5cGVvZiBmLng9PSdzdHJpbmcnKXtmLnJlZj1mLng7Zi5zZXR0aW5ncz1mLnk7Zi54PWYueT1mLndpZHRoPWYuaGVpZ2h0PW51bGx9dmFyIGc9dGhpcy5fbWFrZU5vZGUoZi5wYXJlbnQsJ3VzZScsJC5leHRlbmQoe3g6Zi54LHk6Zi55LHdpZHRoOmYud2lkdGgsaGVpZ2h0OmYuaGVpZ2h0fSxmLnNldHRpbmdzfHx7fSkpO2cuc2V0QXR0cmlidXRlTlMoJC5zdmcueGxpbmtOUywnaHJlZicsZi5yZWYpO3JldHVybiBnfSxsaW5rOmZ1bmN0aW9uKGEsYixjKXt2YXIgZD10aGlzLl9hcmdzKGFyZ3VtZW50cyxbJ3JlZiddKTt2YXIgZT10aGlzLl9tYWtlTm9kZShkLnBhcmVudCwnYScsZC5zZXR0aW5ncyk7ZS5zZXRBdHRyaWJ1dGVOUygkLnN2Zy54bGlua05TLCdocmVmJyxkLnJlZik7cmV0dXJuIGV9LGltYWdlOmZ1bmN0aW9uKGEseCx5LGIsYyxkLGUpe3ZhciBmPXRoaXMuX2FyZ3MoYXJndW1lbnRzLFsneCcsJ3knLCd3aWR0aCcsJ2hlaWdodCcsJ3JlZiddKTt2YXIgZz10aGlzLl9tYWtlTm9kZShmLnBhcmVudCwnaW1hZ2UnLCQuZXh0ZW5kKHt4OmYueCx5OmYueSx3aWR0aDpmLndpZHRoLGhlaWdodDpmLmhlaWdodH0sZi5zZXR0aW5nc3x8e30pKTtnLnNldEF0dHJpYnV0ZU5TKCQuc3ZnLnhsaW5rTlMsJ2hyZWYnLGYucmVmKTtyZXR1cm4gZ30scGF0aDpmdW5jdGlvbihhLGIsYyl7dmFyIGQ9dGhpcy5fYXJncyhhcmd1bWVudHMsWydwYXRoJ10pO3JldHVybiB0aGlzLl9tYWtlTm9kZShkLnBhcmVudCwncGF0aCcsJC5leHRlbmQoe2Q6KGQucGF0aC5wYXRoP2QucGF0aC5wYXRoKCk6ZC5wYXRoKX0sZC5zZXR0aW5nc3x8e30pKX0scmVjdDpmdW5jdGlvbihhLHgseSxiLGMsZCxlLGYpe3ZhciBnPXRoaXMuX2FyZ3MoYXJndW1lbnRzLFsneCcsJ3knLCd3aWR0aCcsJ2hlaWdodCcsJ3J4JywncnknXSxbJ3J4J10pO3JldHVybiB0aGlzLl9tYWtlTm9kZShnLnBhcmVudCwncmVjdCcsJC5leHRlbmQoe3g6Zy54LHk6Zy55LHdpZHRoOmcud2lkdGgsaGVpZ2h0OmcuaGVpZ2h0fSwoZy5yeD97cng6Zy5yeCxyeTpnLnJ5fTp7fSksZy5zZXR0aW5nc3x8e30pKX0sY2lyY2xlOmZ1bmN0aW9uKGEsYixjLHIsZCl7dmFyIGU9dGhpcy5fYXJncyhhcmd1bWVudHMsWydjeCcsJ2N5JywnciddKTtyZXR1cm4gdGhpcy5fbWFrZU5vZGUoZS5wYXJlbnQsJ2NpcmNsZScsJC5leHRlbmQoe2N4OmUuY3gsY3k6ZS5jeSxyOmUucn0sZS5zZXR0aW5nc3x8e30pKX0sZWxsaXBzZTpmdW5jdGlvbihhLGIsYyxkLGUsZil7dmFyIGc9dGhpcy5fYXJncyhhcmd1bWVudHMsWydjeCcsJ2N5JywncngnLCdyeSddKTtyZXR1cm4gdGhpcy5fbWFrZU5vZGUoZy5wYXJlbnQsJ2VsbGlwc2UnLCQuZXh0ZW5kKHtjeDpnLmN4LGN5OmcuY3kscng6Zy5yeCxyeTpnLnJ5fSxnLnNldHRpbmdzfHx7fSkpfSxsaW5lOmZ1bmN0aW9uKGEsYixjLGQsZSxmKXt2YXIgZz10aGlzLl9hcmdzKGFyZ3VtZW50cyxbJ3gxJywneTEnLCd4MicsJ3kyJ10pO3JldHVybiB0aGlzLl9tYWtlTm9kZShnLnBhcmVudCwnbGluZScsJC5leHRlbmQoe3gxOmcueDEseTE6Zy55MSx4MjpnLngyLHkyOmcueTJ9LGcuc2V0dGluZ3N8fHt9KSl9LHBvbHlsaW5lOmZ1bmN0aW9uKGEsYixjKXt2YXIgZD10aGlzLl9hcmdzKGFyZ3VtZW50cyxbJ3BvaW50cyddKTtyZXR1cm4gdGhpcy5fcG9seShkLnBhcmVudCwncG9seWxpbmUnLGQucG9pbnRzLGQuc2V0dGluZ3MpfSxwb2x5Z29uOmZ1bmN0aW9uKGEsYixjKXt2YXIgZD10aGlzLl9hcmdzKGFyZ3VtZW50cyxbJ3BvaW50cyddKTtyZXR1cm4gdGhpcy5fcG9seShkLnBhcmVudCwncG9seWdvbicsZC5wb2ludHMsZC5zZXR0aW5ncyl9LF9wb2x5OmZ1bmN0aW9uKGEsYixjLGQpe3ZhciBlPScnO2Zvcih2YXIgaT0wO2k8Yy5sZW5ndGg7aSsrKXtlKz1jW2ldLmpvaW4oKSsnICd9cmV0dXJuIHRoaXMuX21ha2VOb2RlKGEsYiwkLmV4dGVuZCh7cG9pbnRzOiQudHJpbShlKX0sZHx8e30pKX0sdGV4dDpmdW5jdGlvbihhLHgseSxiLGMpe3ZhciBkPXRoaXMuX2FyZ3MoYXJndW1lbnRzLFsneCcsJ3knLCd2YWx1ZSddKTtpZih0eXBlb2YgZC54PT0nc3RyaW5nJyYmYXJndW1lbnRzLmxlbmd0aDw0KXtkLnZhbHVlPWQueDtkLnNldHRpbmdzPWQueTtkLng9ZC55PW51bGx9cmV0dXJuIHRoaXMuX3RleHQoZC5wYXJlbnQsJ3RleHQnLGQudmFsdWUsJC5leHRlbmQoe3g6KGQueCYmaXNBcnJheShkLngpP2QueC5qb2luKCcgJyk6ZC54KSx5OihkLnkmJmlzQXJyYXkoZC55KT9kLnkuam9pbignICcpOmQueSl9LGQuc2V0dGluZ3N8fHt9KSl9LHRleHRwYXRoOmZ1bmN0aW9uKGEsYixjLGQpe3ZhciBlPXRoaXMuX2FyZ3MoYXJndW1lbnRzLFsncGF0aCcsJ3ZhbHVlJ10pO3ZhciBmPXRoaXMuX3RleHQoZS5wYXJlbnQsJ3RleHRQYXRoJyxlLnZhbHVlLGUuc2V0dGluZ3N8fHt9KTtmLnNldEF0dHJpYnV0ZU5TKCQuc3ZnLnhsaW5rTlMsJ2hyZWYnLGUucGF0aCk7cmV0dXJuIGZ9LF90ZXh0OmZ1bmN0aW9uKGEsYixjLGQpe3ZhciBlPXRoaXMuX21ha2VOb2RlKGEsYixkKTtpZih0eXBlb2YgYz09J3N0cmluZycpe2UuYXBwZW5kQ2hpbGQoZS5vd25lckRvY3VtZW50LmNyZWF0ZVRleHROb2RlKGMpKX1lbHNle2Zvcih2YXIgaT0wO2k8Yy5fcGFydHMubGVuZ3RoO2krKyl7dmFyIGY9Yy5fcGFydHNbaV07aWYoZlswXT09J3RzcGFuJyl7dmFyIGc9dGhpcy5fbWFrZU5vZGUoZSxmWzBdLGZbMl0pO2cuYXBwZW5kQ2hpbGQoZS5vd25lckRvY3VtZW50LmNyZWF0ZVRleHROb2RlKGZbMV0pKTtlLmFwcGVuZENoaWxkKGcpfWVsc2UgaWYoZlswXT09J3RyZWYnKXt2YXIgZz10aGlzLl9tYWtlTm9kZShlLGZbMF0sZlsyXSk7Zy5zZXRBdHRyaWJ1dGVOUygkLnN2Zy54bGlua05TLCdocmVmJyxmWzFdKTtlLmFwcGVuZENoaWxkKGcpfWVsc2UgaWYoZlswXT09J3RleHRwYXRoJyl7dmFyIGg9JC5leHRlbmQoe30sZlsyXSk7aC5ocmVmPW51bGw7dmFyIGc9dGhpcy5fbWFrZU5vZGUoZSxmWzBdLGgpO2cuc2V0QXR0cmlidXRlTlMoJC5zdmcueGxpbmtOUywnaHJlZicsZlsyXS5ocmVmKTtnLmFwcGVuZENoaWxkKGUub3duZXJEb2N1bWVudC5jcmVhdGVUZXh0Tm9kZShmWzFdKSk7ZS5hcHBlbmRDaGlsZChnKX1lbHNle2UuYXBwZW5kQ2hpbGQoZS5vd25lckRvY3VtZW50LmNyZWF0ZVRleHROb2RlKGZbMV0pKX19fXJldHVybiBlfSxvdGhlcjpmdW5jdGlvbihhLGIsYyl7dmFyIGQ9dGhpcy5fYXJncyhhcmd1bWVudHMsWyduYW1lJ10pO3JldHVybiB0aGlzLl9tYWtlTm9kZShkLnBhcmVudCxkLm5hbWUsZC5zZXR0aW5nc3x8e30pfSxfbWFrZU5vZGU6ZnVuY3Rpb24oYSxiLGMpe2E9YXx8dGhpcy5fc3ZnO3ZhciBkPXRoaXMuX3N2Zy5vd25lckRvY3VtZW50LmNyZWF0ZUVsZW1lbnROUygkLnN2Zy5zdmdOUyxiKTtmb3IodmFyIGIgaW4gYyl7dmFyIGU9Y1tiXTtpZihlIT1udWxsJiZlIT1udWxsJiYodHlwZW9mIGUhPSdzdHJpbmcnfHxlIT0nJykpe2Quc2V0QXR0cmlidXRlKCQuc3ZnLl9hdHRyTmFtZXNbYl18fGIsZSl9fWEuYXBwZW5kQ2hpbGQoZCk7cmV0dXJuIGR9LGFkZDpmdW5jdGlvbihiLGMpe3ZhciBkPXRoaXMuX2FyZ3MoKGFyZ3VtZW50cy5sZW5ndGg9PTE/W251bGwsYl06YXJndW1lbnRzKSxbJ25vZGUnXSk7dmFyIGY9dGhpcztkLnBhcmVudD1kLnBhcmVudHx8dGhpcy5fc3ZnO3RyeXtpZigkLnN2Zy5fcmVuZXNpcyl7dGhyb3cnRm9yY2UgdHJhdmVyc2FsJzt9ZC5wYXJlbnQuYXBwZW5kQ2hpbGQoZC5ub2RlLmNsb25lTm9kZSh0cnVlKSl9Y2F0Y2goZSl7ZC5ub2RlPShkLm5vZGUuanF1ZXJ5P2Qubm9kZTokKGQubm9kZSkpO2Qubm9kZS5lYWNoKGZ1bmN0aW9uKCl7dmFyIGE9Zi5fY2xvbmVBc1NWRyh0aGlzKTtpZihhKXtkLnBhcmVudC5hcHBlbmRDaGlsZChhKX19KX1yZXR1cm4gdGhpc30sX2Nsb25lQXNTVkc6ZnVuY3Rpb24oYSl7dmFyIGI9bnVsbDtpZihhLm5vZGVUeXBlPT0xKXtiPXRoaXMuX3N2Zy5vd25lckRvY3VtZW50LmNyZWF0ZUVsZW1lbnROUygkLnN2Zy5zdmdOUyx0aGlzLl9jaGVja05hbWUoYS5ub2RlTmFtZSkpO2Zvcih2YXIgaT0wO2k8YS5hdHRyaWJ1dGVzLmxlbmd0aDtpKyspe3ZhciBjPWEuYXR0cmlidXRlcy5pdGVtKGkpO2lmKGMubm9kZU5hbWUhPSd4bWxucycmJmMubm9kZVZhbHVlKXtpZihjLnByZWZpeD09J3hsaW5rJyl7Yi5zZXRBdHRyaWJ1dGVOUygkLnN2Zy54bGlua05TLGMubG9jYWxOYW1lLGMubm9kZVZhbHVlKX1lbHNle2Iuc2V0QXR0cmlidXRlKHRoaXMuX2NoZWNrTmFtZShjLm5vZGVOYW1lKSxjLm5vZGVWYWx1ZSl9fX1mb3IodmFyIGk9MDtpPGEuY2hpbGROb2Rlcy5sZW5ndGg7aSsrKXt2YXIgZD10aGlzLl9jbG9uZUFzU1ZHKGEuY2hpbGROb2Rlc1tpXSk7aWYoZCl7Yi5hcHBlbmRDaGlsZChkKX19fWVsc2UgaWYoYS5ub2RlVHlwZT09Myl7aWYoJC50cmltKGEubm9kZVZhbHVlKSl7Yj10aGlzLl9zdmcub3duZXJEb2N1bWVudC5jcmVhdGVUZXh0Tm9kZShhLm5vZGVWYWx1ZSl9fWVsc2UgaWYoYS5ub2RlVHlwZT09NCl7aWYoJC50cmltKGEubm9kZVZhbHVlKSl7dHJ5e2I9dGhpcy5fc3ZnLm93bmVyRG9jdW1lbnQuY3JlYXRlQ0RBVEFTZWN0aW9uKGEubm9kZVZhbHVlKX1jYXRjaChlKXtiPXRoaXMuX3N2Zy5vd25lckRvY3VtZW50LmNyZWF0ZVRleHROb2RlKGEubm9kZVZhbHVlLnJlcGxhY2UoLyYvZywnJmFtcDsnKS5yZXBsYWNlKC88L2csJyZsdDsnKS5yZXBsYWNlKC8+L2csJyZndDsnKSl9fX1yZXR1cm4gYn0sX2NoZWNrTmFtZTpmdW5jdGlvbihhKXthPShhLnN1YnN0cmluZygwLDEpPj0nQScmJmEuc3Vic3RyaW5nKDAsMSk8PSdaJz9hLnRvTG93ZXJDYXNlKCk6YSk7cmV0dXJuKGEuc3Vic3RyaW5nKDAsNCk9PSdzdmc6Jz9hLnN1YnN0cmluZyg0KTphKX0sbG9hZDpmdW5jdGlvbihoLGope2o9KHR5cGVvZiBqPT0nYm9vbGVhbic/e2FkZFRvOmp9Oih0eXBlb2Ygaj09J2Z1bmN0aW9uJz97b25Mb2FkOmp9Omp8fHt9KSk7aWYoIWouYWRkVG8pe3RoaXMuY2xlYXIoZmFsc2UpfXZhciBrPVt0aGlzLl9zdmcuZ2V0QXR0cmlidXRlKCd3aWR0aCcpLHRoaXMuX3N2Zy5nZXRBdHRyaWJ1dGUoJ2hlaWdodCcpXTt2YXIgbD10aGlzO3ZhciBtPWZ1bmN0aW9uKGEpe2E9JC5zdmcubG9jYWwuZXJyb3JMb2FkaW5nVGV4dCsnOiAnK2E7aWYoai5vbkxvYWQpe2oub25Mb2FkLmFwcGx5KGwuX2NvbnRhaW5lcnx8bC5fc3ZnLFtsLGFdKX1lbHNle2wudGV4dChudWxsLDEwLDIwLGEpfX07dmFyIG49ZnVuY3Rpb24oYSl7dmFyIGI9bmV3IEFjdGl2ZVhPYmplY3QoJ01pY3Jvc29mdC5YTUxET00nKTtiLnZhbGlkYXRlT25QYXJzZT1mYWxzZTtiLnJlc29sdmVFeHRlcm5hbHM9ZmFsc2U7Yi5hc3luYz1mYWxzZTtiLmxvYWRYTUwoYSk7aWYoYi5wYXJzZUVycm9yLmVycm9yQ29kZSE9MCl7bShiLnBhcnNlRXJyb3IucmVhc29uKTtyZXR1cm4gbnVsbH1yZXR1cm4gYn07dmFyIG89ZnVuY3Rpb24oYSl7aWYoIWEpe3JldHVybn1pZihhLmRvY3VtZW50RWxlbWVudC5ub2RlTmFtZSE9J3N2Zycpe3ZhciBiPWEuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ3BhcnNlcmVycm9yJyk7dmFyIGM9KGIubGVuZ3RoP2JbMF0uZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ2RpdicpOltdKTttKCFiLmxlbmd0aD8nPz8/JzooYy5sZW5ndGg/Y1swXTpiWzBdKS5maXJzdENoaWxkLm5vZGVWYWx1ZSk7cmV0dXJufXZhciBkPXt9O2Zvcih2YXIgaT0wO2k8YS5kb2N1bWVudEVsZW1lbnQuYXR0cmlidXRlcy5sZW5ndGg7aSsrKXt2YXIgZj1hLmRvY3VtZW50RWxlbWVudC5hdHRyaWJ1dGVzLml0ZW0oaSk7aWYoIShmLm5vZGVOYW1lPT0ndmVyc2lvbid8fGYubm9kZU5hbWUuc3Vic3RyaW5nKDAsNSk9PSd4bWxucycpKXtkW2Yubm9kZU5hbWVdPWYubm9kZVZhbHVlfX1sLmNvbmZpZ3VyZShkLHRydWUpO3ZhciBnPWEuZG9jdW1lbnRFbGVtZW50LmNoaWxkTm9kZXM7Zm9yKHZhciBpPTA7aTxnLmxlbmd0aDtpKyspe3RyeXtpZigkLnN2Zy5fcmVuZXNpcyl7dGhyb3cnRm9yY2UgdHJhdmVyc2FsJzt9bC5fc3ZnLmFwcGVuZENoaWxkKGdbaV0uY2xvbmVOb2RlKHRydWUpKTtpZihnW2ldLm5vZGVOYW1lPT0nc2NyaXB0Jyl7JC5nbG9iYWxFdmFsKGdbaV0udGV4dENvbnRlbnQpfX1jYXRjaChlKXtsLmFkZChudWxsLGdbaV0pfX1pZighai5jaGFuZ2VTaXplKXtsLmNvbmZpZ3VyZSh7d2lkdGg6a1swXSxoZWlnaHQ6a1sxXX0pfWlmKGoub25Mb2FkKXtqLm9uTG9hZC5hcHBseShsLl9jb250YWluZXJ8fGwuX3N2ZyxbbF0pfX07aWYoaC5tYXRjaCgnPHN2ZycpKXtvKCQuYnJvd3Nlci5tc2llP24oaCk6bmV3IERPTVBhcnNlcigpLnBhcnNlRnJvbVN0cmluZyhoLCd0ZXh0L3htbCcpKX1lbHNleyQuYWpheCh7dXJsOmgsZGF0YVR5cGU6KCQuYnJvd3Nlci5tc2llPyd0ZXh0JzoneG1sJyksc3VjY2VzczpmdW5jdGlvbihhKXtvKCQuYnJvd3Nlci5tc2llP24oYSk6YSl9LGVycm9yOmZ1bmN0aW9uKGEsYixjKXttKGIrKGM/JyAnK2MubWVzc2FnZTonJykpfX0pfXJldHVybiB0aGlzfSxyZW1vdmU6ZnVuY3Rpb24oYSl7YT0oYS5qcXVlcnk/YVswXTphKTthLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQoYSk7cmV0dXJuIHRoaXN9LGNsZWFyOmZ1bmN0aW9uKGEpe2lmKGEpe3RoaXMuY29uZmlndXJlKHt9LHRydWUpfXdoaWxlKHRoaXMuX3N2Zy5maXJzdENoaWxkKXt0aGlzLl9zdmcucmVtb3ZlQ2hpbGQodGhpcy5fc3ZnLmZpcnN0Q2hpbGQpfXJldHVybiB0aGlzfSx0b1NWRzpmdW5jdGlvbihhKXthPWF8fHRoaXMuX3N2ZztyZXR1cm4odHlwZW9mIFhNTFNlcmlhbGl6ZXI9PSd1bmRlZmluZWQnP3RoaXMuX3RvU1ZHKGEpOm5ldyBYTUxTZXJpYWxpemVyKCkuc2VyaWFsaXplVG9TdHJpbmcoYSkpfSxfdG9TVkc6ZnVuY3Rpb24oYSl7dmFyIGI9Jyc7aWYoIWEpe3JldHVybiBifWlmKGEubm9kZVR5cGU9PTMpe2I9YS5ub2RlVmFsdWV9ZWxzZSBpZihhLm5vZGVUeXBlPT00KXtiPSc8IVtDREFUQVsnK2Eubm9kZVZhbHVlKyddXT4nfWVsc2V7Yj0nPCcrYS5ub2RlTmFtZTtpZihhLmF0dHJpYnV0ZXMpe2Zvcih2YXIgaT0wO2k8YS5hdHRyaWJ1dGVzLmxlbmd0aDtpKyspe3ZhciBjPWEuYXR0cmlidXRlcy5pdGVtKGkpO2lmKCEoJC50cmltKGMubm9kZVZhbHVlKT09Jyd8fGMubm9kZVZhbHVlLm1hdGNoKC9eXFxbb2JqZWN0Lyl8fGMubm9kZVZhbHVlLm1hdGNoKC9eZnVuY3Rpb24vKSkpe2IrPScgJysoYy5uYW1lc3BhY2VVUkk9PSQuc3ZnLnhsaW5rTlM/J3hsaW5rOic6JycpK2Mubm9kZU5hbWUrJz1cIicrYy5ub2RlVmFsdWUrJ1wiJ319fWlmKGEuZmlyc3RDaGlsZCl7Yis9Jz4nO3ZhciBkPWEuZmlyc3RDaGlsZDt3aGlsZShkKXtiKz10aGlzLl90b1NWRyhkKTtkPWQubmV4dFNpYmxpbmd9Yis9JzwvJythLm5vZGVOYW1lKyc+J31lbHNle2IrPScvPid9fXJldHVybiBifSxfZXNjYXBlWE1MOmZ1bmN0aW9uKGEpe2E9YS5yZXBsYWNlKC8mL2csJyZhbXA7Jyk7YT1hLnJlcGxhY2UoLzwvZywnJmx0OycpO2E9YS5yZXBsYWNlKC8+L2csJyZndDsnKTtyZXR1cm4gYX19KTtmdW5jdGlvbiBTVkdQYXRoKCl7dGhpcy5fcGF0aD0nJ30kLmV4dGVuZChTVkdQYXRoLnByb3RvdHlwZSx7cmVzZXQ6ZnVuY3Rpb24oKXt0aGlzLl9wYXRoPScnO3JldHVybiB0aGlzfSxtb3ZlOmZ1bmN0aW9uKHgseSxhKXthPShpc0FycmF5KHgpP3k6YSk7cmV0dXJuIHRoaXMuX2Nvb3JkcygoYT8nbSc6J00nKSx4LHkpfSxsaW5lOmZ1bmN0aW9uKHgseSxhKXthPShpc0FycmF5KHgpP3k6YSk7cmV0dXJuIHRoaXMuX2Nvb3JkcygoYT8nbCc6J0wnKSx4LHkpfSxob3JpejpmdW5jdGlvbih4LGEpe3RoaXMuX3BhdGgrPShhPydoJzonSCcpKyhpc0FycmF5KHgpP3guam9pbignICcpOngpO3JldHVybiB0aGlzfSx2ZXJ0OmZ1bmN0aW9uKHksYSl7dGhpcy5fcGF0aCs9KGE/J3YnOidWJykrKGlzQXJyYXkoeSk/eS5qb2luKCcgJyk6eSk7cmV0dXJuIHRoaXN9LGN1cnZlQzpmdW5jdGlvbihhLGIsYyxkLHgseSxlKXtlPShpc0FycmF5KGEpP2I6ZSk7cmV0dXJuIHRoaXMuX2Nvb3JkcygoZT8nYyc6J0MnKSxhLGIsYyxkLHgseSl9LHNtb290aEM6ZnVuY3Rpb24oYSxiLHgseSxjKXtjPShpc0FycmF5KGEpP2I6Yyk7cmV0dXJuIHRoaXMuX2Nvb3JkcygoYz8ncyc6J1MnKSxhLGIseCx5KX0sY3VydmVROmZ1bmN0aW9uKGEsYix4LHksYyl7Yz0oaXNBcnJheShhKT9iOmMpO3JldHVybiB0aGlzLl9jb29yZHMoKGM/J3EnOidRJyksYSxiLHgseSl9LHNtb290aFE6ZnVuY3Rpb24oeCx5LGEpe2E9KGlzQXJyYXkoeCk/eTphKTtyZXR1cm4gdGhpcy5fY29vcmRzKChhPyd0JzonVCcpLHgseSl9LF9jb29yZHM6ZnVuY3Rpb24oYSxiLGMsZCxlLGYsZyl7aWYoaXNBcnJheShiKSl7Zm9yKHZhciBpPTA7aTxiLmxlbmd0aDtpKyspe3ZhciBoPWJbaV07dGhpcy5fcGF0aCs9KGk9PTA/YTonICcpK2hbMF0rJywnK2hbMV0rKGgubGVuZ3RoPDQ/Jyc6JyAnK2hbMl0rJywnK2hbM10rKGgubGVuZ3RoPDY/Jyc6JyAnK2hbNF0rJywnK2hbNV0pKX19ZWxzZXt0aGlzLl9wYXRoKz1hK2IrJywnK2MrKGQ9PW51bGw/Jyc6JyAnK2QrJywnK2UrKGY9PW51bGw/Jyc6JyAnK2YrJywnK2cpKX1yZXR1cm4gdGhpc30sYXJjOmZ1bmN0aW9uKGEsYixjLGQsZSx4LHksZil7Zj0oaXNBcnJheShhKT9iOmYpO3RoaXMuX3BhdGgrPShmPydhJzonQScpO2lmKGlzQXJyYXkoYSkpe2Zvcih2YXIgaT0wO2k8YS5sZW5ndGg7aSsrKXt2YXIgZz1hW2ldO3RoaXMuX3BhdGgrPShpPT0wPycnOicgJykrZ1swXSsnLCcrZ1sxXSsnICcrZ1syXSsnICcrKGdbM10/JzEnOicwJykrJywnKyhnWzRdPycxJzonMCcpKycgJytnWzVdKycsJytnWzZdfX1lbHNle3RoaXMuX3BhdGgrPWErJywnK2IrJyAnK2MrJyAnKyhkPycxJzonMCcpKycsJysoZT8nMSc6JzAnKSsnICcreCsnLCcreX1yZXR1cm4gdGhpc30sY2xvc2U6ZnVuY3Rpb24oKXt0aGlzLl9wYXRoKz0neic7cmV0dXJuIHRoaXN9LHBhdGg6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5fcGF0aH19KTtTVkdQYXRoLnByb3RvdHlwZS5tb3ZlVG89U1ZHUGF0aC5wcm90b3R5cGUubW92ZTtTVkdQYXRoLnByb3RvdHlwZS5saW5lVG89U1ZHUGF0aC5wcm90b3R5cGUubGluZTtTVkdQYXRoLnByb3RvdHlwZS5ob3JpelRvPVNWR1BhdGgucHJvdG90eXBlLmhvcml6O1NWR1BhdGgucHJvdG90eXBlLnZlcnRUbz1TVkdQYXRoLnByb3RvdHlwZS52ZXJ0O1NWR1BhdGgucHJvdG90eXBlLmN1cnZlQ1RvPVNWR1BhdGgucHJvdG90eXBlLmN1cnZlQztTVkdQYXRoLnByb3RvdHlwZS5zbW9vdGhDVG89U1ZHUGF0aC5wcm90b3R5cGUuc21vb3RoQztTVkdQYXRoLnByb3RvdHlwZS5jdXJ2ZVFUbz1TVkdQYXRoLnByb3RvdHlwZS5jdXJ2ZVE7U1ZHUGF0aC5wcm90b3R5cGUuc21vb3RoUVRvPVNWR1BhdGgucHJvdG90eXBlLnNtb290aFE7U1ZHUGF0aC5wcm90b3R5cGUuYXJjVG89U1ZHUGF0aC5wcm90b3R5cGUuYXJjO2Z1bmN0aW9uIFNWR1RleHQoKXt0aGlzLl9wYXJ0cz1bXX0kLmV4dGVuZChTVkdUZXh0LnByb3RvdHlwZSx7cmVzZXQ6ZnVuY3Rpb24oKXt0aGlzLl9wYXJ0cz1bXTtyZXR1cm4gdGhpc30sc3RyaW5nOmZ1bmN0aW9uKGEpe3RoaXMuX3BhcnRzW3RoaXMuX3BhcnRzLmxlbmd0aF09Wyd0ZXh0JyxhXTtyZXR1cm4gdGhpc30sc3BhbjpmdW5jdGlvbihhLGIpe3RoaXMuX3BhcnRzW3RoaXMuX3BhcnRzLmxlbmd0aF09Wyd0c3BhbicsYSxiXTtyZXR1cm4gdGhpc30scmVmOmZ1bmN0aW9uKGEsYil7dGhpcy5fcGFydHNbdGhpcy5fcGFydHMubGVuZ3RoXT1bJ3RyZWYnLGEsYl07cmV0dXJuIHRoaXN9LHBhdGg6ZnVuY3Rpb24oYSxiLGMpe3RoaXMuX3BhcnRzW3RoaXMuX3BhcnRzLmxlbmd0aF09Wyd0ZXh0cGF0aCcsYiwkLmV4dGVuZCh7aHJlZjphfSxjfHx7fSldO3JldHVybiB0aGlzfX0pOyQuZm4uc3ZnPWZ1bmN0aW9uKGEpe3ZhciBiPUFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGFyZ3VtZW50cywxKTtpZih0eXBlb2YgYT09J3N0cmluZycmJmE9PSdnZXQnKXtyZXR1cm4gJC5zdmdbJ18nK2ErJ1NWRyddLmFwcGx5KCQuc3ZnLFt0aGlzWzBdXS5jb25jYXQoYikpfXJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oKXtpZih0eXBlb2YgYT09J3N0cmluZycpeyQuc3ZnWydfJythKydTVkcnXS5hcHBseSgkLnN2ZyxbdGhpc10uY29uY2F0KGIpKX1lbHNleyQuc3ZnLl9hdHRhY2hTVkcodGhpcyxhfHx7fSl9fSl9O2Z1bmN0aW9uIGlzQXJyYXkoYSl7cmV0dXJuKGEmJmEuY29uc3RydWN0b3I9PUFycmF5KX0kLnN2Zz1uZXcgU1ZHTWFuYWdlcigpfSkoalF1ZXJ5KTsiLCIvKiBodHRwOi8va2VpdGgtd29vZC5uYW1lL3N2Zy5odG1sXHJcbiAgIFNWRy9qUXVlcnkgRE9NIGNvbXBhdGliaWxpdHkgZm9yIGpRdWVyeSB2MS40LjMuXHJcbiAgIFdyaXR0ZW4gYnkgS2VpdGggV29vZCAoa2J3b29ke2F0fWlpbmV0LmNvbS5hdSkgQXByaWwgMjAwOS5cclxuICAgRHVhbCBsaWNlbnNlZCB1bmRlciB0aGUgR1BMIChodHRwOi8vZGV2LmpxdWVyeS5jb20vYnJvd3Nlci90cnVuay9qcXVlcnkvR1BMLUxJQ0VOU0UudHh0KSBhbmQgXHJcbiAgIE1JVCAoaHR0cDovL2Rldi5qcXVlcnkuY29tL2Jyb3dzZXIvdHJ1bmsvanF1ZXJ5L01JVC1MSUNFTlNFLnR4dCkgbGljZW5zZXMuIFxyXG4gICBQbGVhc2UgYXR0cmlidXRlIHRoZSBhdXRob3IgaWYgeW91IHVzZSBpdC4gKi9cclxuKGZ1bmN0aW9uKCQpeyQuZm4uYWRkQ2xhc3M9ZnVuY3Rpb24oZSl7cmV0dXJuIGZ1bmN0aW9uKGQpe2Q9ZHx8Jyc7cmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbigpe2lmKGlzU1ZHRWxlbSh0aGlzKSl7dmFyIGM9dGhpczskLmVhY2goZC5zcGxpdCgvXFxzKy8pLGZ1bmN0aW9uKGksYSl7dmFyIGI9KGMuY2xhc3NOYW1lP2MuY2xhc3NOYW1lLmJhc2VWYWw6Yy5nZXRBdHRyaWJ1dGUoJ2NsYXNzJykpO2lmKCQuaW5BcnJheShhLGIuc3BsaXQoL1xccysvKSk9PS0xKXtiKz0oYj8nICc6JycpK2E7KGMuY2xhc3NOYW1lP2MuY2xhc3NOYW1lLmJhc2VWYWw9YjpjLnNldEF0dHJpYnV0ZSgnY2xhc3MnLGIpKX19KX1lbHNle2UuYXBwbHkoJCh0aGlzKSxbZF0pfX0pfX0oJC5mbi5hZGRDbGFzcyk7JC5mbi5yZW1vdmVDbGFzcz1mdW5jdGlvbihlKXtyZXR1cm4gZnVuY3Rpb24oZCl7ZD1kfHwnJztyZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKCl7aWYoaXNTVkdFbGVtKHRoaXMpKXt2YXIgYz10aGlzOyQuZWFjaChkLnNwbGl0KC9cXHMrLyksZnVuY3Rpb24oaSxhKXt2YXIgYj0oYy5jbGFzc05hbWU/Yy5jbGFzc05hbWUuYmFzZVZhbDpjLmdldEF0dHJpYnV0ZSgnY2xhc3MnKSk7Yj0kLmdyZXAoYi5zcGxpdCgvXFxzKy8pLGZ1bmN0aW9uKG4saSl7cmV0dXJuIG4hPWF9KS5qb2luKCcgJyk7KGMuY2xhc3NOYW1lP2MuY2xhc3NOYW1lLmJhc2VWYWw9YjpjLnNldEF0dHJpYnV0ZSgnY2xhc3MnLGIpKX0pfWVsc2V7ZS5hcHBseSgkKHRoaXMpLFtkXSl9fSl9fSgkLmZuLnJlbW92ZUNsYXNzKTskLmZuLnRvZ2dsZUNsYXNzPWZ1bmN0aW9uKGMpe3JldHVybiBmdW5jdGlvbihhLGIpe3JldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oKXtpZihpc1NWR0VsZW0odGhpcykpe2lmKHR5cGVvZiBiIT09J2Jvb2xlYW4nKXtiPSEkKHRoaXMpLmhhc0NsYXNzKGEpfSQodGhpcylbKGI/J2FkZCc6J3JlbW92ZScpKydDbGFzcyddKGEpfWVsc2V7Yy5hcHBseSgkKHRoaXMpLFthLGJdKX19KX19KCQuZm4udG9nZ2xlQ2xhc3MpOyQuZm4uaGFzQ2xhc3M9ZnVuY3Rpb24oZCl7cmV0dXJuIGZ1bmN0aW9uKGIpe2I9Ynx8Jyc7dmFyIGM9ZmFsc2U7dGhpcy5lYWNoKGZ1bmN0aW9uKCl7aWYoaXNTVkdFbGVtKHRoaXMpKXt2YXIgYT0odGhpcy5jbGFzc05hbWU/dGhpcy5jbGFzc05hbWUuYmFzZVZhbDp0aGlzLmdldEF0dHJpYnV0ZSgnY2xhc3MnKSkuc3BsaXQoL1xccysvKTtjPSgkLmluQXJyYXkoYixhKT4tMSl9ZWxzZXtjPShkLmFwcGx5KCQodGhpcyksW2JdKSl9cmV0dXJuIWN9KTtyZXR1cm4gY319KCQuZm4uaGFzQ2xhc3MpOyQuZm4uYXR0cj1mdW5jdGlvbihoKXtyZXR1cm4gZnVuY3Rpb24oYixjLGQpe2lmKHR5cGVvZiBiPT09J3N0cmluZycmJmM9PT11bmRlZmluZWQpe3ZhciBlPWguYXBwbHkodGhpcyxbYixjLGRdKTtpZihlJiZlLmJhc2VWYWwmJmUuYmFzZVZhbC5udW1iZXJPZkl0ZW1zIT1udWxsKXtjPScnO2U9ZS5iYXNlVmFsO2Zvcih2YXIgaT0wO2k8ZS5udW1iZXJPZkl0ZW1zO2krKyl7dmFyIGY9ZS5nZXRJdGVtKGkpO3N3aXRjaChmLnR5cGUpe2Nhc2UgMTpjKz0nIG1hdHJpeCgnK2YubWF0cml4LmErJywnK2YubWF0cml4LmIrJywnK2YubWF0cml4LmMrJywnK2YubWF0cml4LmQrJywnK2YubWF0cml4LmUrJywnK2YubWF0cml4LmYrJyknO2JyZWFrO2Nhc2UgMjpjKz0nIHRyYW5zbGF0ZSgnK2YubWF0cml4LmUrJywnK2YubWF0cml4LmYrJyknO2JyZWFrO2Nhc2UgMzpjKz0nIHNjYWxlKCcrZi5tYXRyaXguYSsnLCcrZi5tYXRyaXguZCsnKSc7YnJlYWs7Y2FzZSA0OmMrPScgcm90YXRlKCcrZi5hbmdsZSsnKSc7YnJlYWs7Y2FzZSA1OmMrPScgc2tld1goJytmLmFuZ2xlKycpJzticmVhaztjYXNlIDY6Yys9JyBza2V3WSgnK2YuYW5nbGUrJyknO2JyZWFrfX1lPWMuc3Vic3RyaW5nKDEpfXJldHVybihlJiZlLmJhc2VWYWw/ZS5iYXNlVmFsLnZhbHVlQXNTdHJpbmc6ZSl9dmFyIGc9YjtpZih0eXBlb2YgYj09PSdzdHJpbmcnKXtnPXt9O2dbYl09Y31yZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKCl7aWYoaXNTVkdFbGVtKHRoaXMpKXtmb3IodmFyIG4gaW4gZyl7dmFyIGE9KCQuaXNGdW5jdGlvbihnW25dKT9nW25dKCk6Z1tuXSk7KGQ/dGhpcy5zdHlsZVtuXT1hOnRoaXMuc2V0QXR0cmlidXRlKG4sYSkpfX1lbHNle2guYXBwbHkoJCh0aGlzKSxbYixjLGRdKX19KX19KCQuZm4uYXR0cik7JC5mbi5yZW1vdmVBdHRyPWZ1bmN0aW9uKGIpe3JldHVybiBmdW5jdGlvbihhKXtyZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKCl7aWYoaXNTVkdFbGVtKHRoaXMpKXsodGhpc1thXSYmdGhpc1thXS5iYXNlVmFsP3RoaXNbYV0uYmFzZVZhbC52YWx1ZT0nJzp0aGlzLnNldEF0dHJpYnV0ZShhLCcnKSl9ZWxzZXtiLmFwcGx5KCQodGhpcyksW2FdKX19KX19KCQuZm4ucmVtb3ZlQXR0cik7ZnVuY3Rpb24gYW55U1ZHKGEpe2Zvcih2YXIgaT0wO2k8YS5sZW5ndGg7aSsrKXtpZihhW2ldLm5vZGVUeXBlPT0xJiZhW2ldLm5hbWVzcGFjZVVSST09JC5zdmcuc3ZnTlMpe3JldHVybiB0cnVlfX1yZXR1cm4gZmFsc2V9JC5leHByLnJlbGF0aXZlWycrJ109ZnVuY3Rpb24oZCl7cmV0dXJuIGZ1bmN0aW9uKGEsYixjKXtkKGEsYixjfHxhbnlTVkcoYSkpfX0oJC5leHByLnJlbGF0aXZlWycrJ10pOyQuZXhwci5yZWxhdGl2ZVsnPiddPWZ1bmN0aW9uKGQpe3JldHVybiBmdW5jdGlvbihhLGIsYyl7ZChhLGIsY3x8YW55U1ZHKGEpKX19KCQuZXhwci5yZWxhdGl2ZVsnPiddKTskLmV4cHIucmVsYXRpdmVbJyddPWZ1bmN0aW9uKGQpe3JldHVybiBmdW5jdGlvbihhLGIsYyl7ZChhLGIsY3x8YW55U1ZHKGEpKX19KCQuZXhwci5yZWxhdGl2ZVsnJ10pOyQuZXhwci5yZWxhdGl2ZVsnfiddPWZ1bmN0aW9uKGQpe3JldHVybiBmdW5jdGlvbihhLGIsYyl7ZChhLGIsY3x8YW55U1ZHKGEpKX19KCQuZXhwci5yZWxhdGl2ZVsnfiddKTskLmV4cHIuZmluZC5JRD1mdW5jdGlvbihkKXtyZXR1cm4gZnVuY3Rpb24oYSxiLGMpe3JldHVybihpc1NWR0VsZW0oYik/W2Iub3duZXJEb2N1bWVudC5nZXRFbGVtZW50QnlJZChhWzFdKV06ZChhLGIsYykpfX0oJC5leHByLmZpbmQuSUQpO3ZhciBqPWRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO2ouYXBwZW5kQ2hpbGQoZG9jdW1lbnQuY3JlYXRlQ29tbWVudCgnJykpO2lmKGouZ2V0RWxlbWVudHNCeVRhZ05hbWUoJyonKS5sZW5ndGg+MCl7JC5leHByLmZpbmQuVEFHPWZ1bmN0aW9uKGEsYil7dmFyIGM9Yi5nZXRFbGVtZW50c0J5VGFnTmFtZShhWzFdKTtpZihhWzFdPT09JyonKXt2YXIgZD1bXTtmb3IodmFyIGk9MDtjW2ldfHxjLml0ZW0oaSk7aSsrKXtpZigoY1tpXXx8Yy5pdGVtKGkpKS5ub2RlVHlwZT09PTEpe2QucHVzaChjW2ldfHxjLml0ZW0oaSkpfX1jPWR9cmV0dXJuIGN9fSQuZXhwci5wcmVGaWx0ZXIuQ0xBU1M9ZnVuY3Rpb24oYSxiLGMsZCxmLGcpe2E9JyAnK2FbMV0ucmVwbGFjZSgvXFxcXC9nLCcnKSsnICc7aWYoZyl7cmV0dXJuIGF9Zm9yKHZhciBpPTAsZWxlbT17fTtlbGVtIT1udWxsO2krKyl7ZWxlbT1iW2ldO2lmKCFlbGVtKXt0cnl7ZWxlbT1iLml0ZW0oaSl9Y2F0Y2goZSl7fX1pZihlbGVtKXt2YXIgaD0oIWlzU1ZHRWxlbShlbGVtKT9lbGVtLmNsYXNzTmFtZTooZWxlbS5jbGFzc05hbWU/ZWxlbS5jbGFzc05hbWUuYmFzZVZhbDonJyl8fGVsZW0uZ2V0QXR0cmlidXRlKCdjbGFzcycpKTtpZihmXihoJiYoJyAnK2grJyAnKS5pbmRleE9mKGEpPi0xKSl7aWYoIWMpZC5wdXNoKGVsZW0pfWVsc2UgaWYoYyl7YltpXT1mYWxzZX19fXJldHVybiBmYWxzZX07JC5leHByLmZpbHRlci5DTEFTUz1mdW5jdGlvbihhLGIpe3ZhciBjPSghaXNTVkdFbGVtKGEpP2EuY2xhc3NOYW1lOihhLmNsYXNzTmFtZT9hLmNsYXNzTmFtZS5iYXNlVmFsOmEuZ2V0QXR0cmlidXRlKCdjbGFzcycpKSk7cmV0dXJuKCcgJytjKycgJykuaW5kZXhPZihiKT4tMX07JC5leHByLmZpbHRlci5BVFRSPWZ1bmN0aW9uKGcpe3JldHVybiBmdW5jdGlvbihjLGQpe3ZhciBlPW51bGw7aWYoaXNTVkdFbGVtKGMpKXtlPWRbMV07JC5leHByLmF0dHJIYW5kbGVbZV09ZnVuY3Rpb24oYSl7dmFyIGI9YS5nZXRBdHRyaWJ1dGUoZSk7cmV0dXJuIGImJmIuYmFzZVZhbHx8Yn19dmFyIGY9ZyhjLGQpO2lmKGUpeyQuZXhwci5hdHRySGFuZGxlW2VdPW51bGx9cmV0dXJuIGZ9fSgkLmV4cHIuZmlsdGVyLkFUVFIpO2Z1bmN0aW9uIGlzU1ZHRWxlbShhKXtyZXR1cm4oYS5ub2RlVHlwZT09MSYmYS5uYW1lc3BhY2VVUkk9PSQuc3ZnLnN2Z05TKX19KShqUXVlcnkpOyIsIihmdW5jdGlvbiAoKSB7XG4gICAgZnVuY3Rpb24gY3JlYXRlKHdpbmRvdykge1xuICAgICAgICB3aW5kb3cgPSB3aW5kb3cgfHwgZXZhbChcInJlcXVpcmUoJ2pzXCIrXCJkb20nKVwiKS5qc2RvbSgpLmNyZWF0ZVdpbmRvdygpO1xuXG4gICAgICAgIC8vIGFzc3VtZSB3aW5kb3cgaXMgYSBqc2RvbSBpbnN0YW5jZS4uLlxuICAgICAgICAvLyBqc2RvbSBpbmNsdWRlcyBhbiBpbmNvbXBsZXRlIHZlcnNpb24gb2YgWE1MSHR0cFJlcXVlc3RcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIHdpbmRvdy5YTUxIdHRwUmVxdWVzdCA9IGV2YWwoXCJyZXF1aXJlKCd4bWxcIitcImh0dHByZXF1ZXN0JylcIikuWE1MSHR0cFJlcXVlc3Q7XG4gICAgICAgICAgICAvLyB0cmljayBqUXVlcnkgaW50byB0aGlua2luZyBDT1JTIGlzIHN1cHBvcnRlZCAoc2hvdWxkIGJlIGluIG5vZGUtWE1MSHR0cFJlcXVlc3QpXG4gICAgICAgICAgICB3aW5kb3cuWE1MSHR0cFJlcXVlc3QucHJvdG90eXBlLndpdGhDcmVkZW50aWFscyA9IGZhbHNlO1xuICAgICAgICB9XG4gICAgICAgIGNhdGNoIChlKSB7fVxuXG4gICAgICAgIHZhciBsb2NhdGlvbiA9IHdpbmRvdy5sb2NhdGlvbixcbiAgICAgICAgICAgIG5hdmlnYXRvciA9IHdpbmRvdy5uYXZpZ2F0b3IsXG4gICAgICAgICAgICBYTUxIdHRwUmVxdWVzdCA9IHdpbmRvdy5YTUxIdHRwUmVxdWVzdDtcblxuLyohXG4gKiBqUXVlcnkgSmF2YVNjcmlwdCBMaWJyYXJ5IHYxLjcuMVxuICogaHR0cDovL2pxdWVyeS5jb20vXG4gKlxuICogQ29weXJpZ2h0IDIwMTEsIEpvaG4gUmVzaWdcbiAqIER1YWwgbGljZW5zZWQgdW5kZXIgdGhlIE1JVCBvciBHUEwgVmVyc2lvbiAyIGxpY2Vuc2VzLlxuICogaHR0cDovL2pxdWVyeS5vcmcvbGljZW5zZVxuICpcbiAqIEluY2x1ZGVzIFNpenpsZS5qc1xuICogaHR0cDovL3NpenpsZWpzLmNvbS9cbiAqIENvcHlyaWdodCAyMDExLCBUaGUgRG9qbyBGb3VuZGF0aW9uXG4gKiBSZWxlYXNlZCB1bmRlciB0aGUgTUlULCBCU0QsIGFuZCBHUEwgTGljZW5zZXMuXG4gKlxuICogRGF0ZTogTW9uIE5vdiAyMSAyMToxMTowMyAyMDExIC0wNTAwXG4gKi9cbihmdW5jdGlvbiggd2luZG93LCB1bmRlZmluZWQgKSB7XG5cbi8vIFVzZSB0aGUgY29ycmVjdCBkb2N1bWVudCBhY2NvcmRpbmdseSB3aXRoIHdpbmRvdyBhcmd1bWVudCAoc2FuZGJveClcbiAgICB2YXIgZG9jdW1lbnQgPSB3aW5kb3cuZG9jdW1lbnQsXG4gICAgICAgIG5hdmlnYXRvciA9IHdpbmRvdy5uYXZpZ2F0b3IsXG4gICAgICAgIGxvY2F0aW9uID0gd2luZG93LmxvY2F0aW9uO1xuICAgIHZhciBqUXVlcnkgPSAoZnVuY3Rpb24oKSB7XG5cbi8vIERlZmluZSBhIGxvY2FsIGNvcHkgb2YgalF1ZXJ5XG4gICAgICAgIHZhciBqUXVlcnkgPSBmdW5jdGlvbiggc2VsZWN0b3IsIGNvbnRleHQgKSB7XG4gICAgICAgICAgICAgICAgLy8gVGhlIGpRdWVyeSBvYmplY3QgaXMgYWN0dWFsbHkganVzdCB0aGUgaW5pdCBjb25zdHJ1Y3RvciAnZW5oYW5jZWQnXG4gICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBqUXVlcnkuZm4uaW5pdCggc2VsZWN0b3IsIGNvbnRleHQsIHJvb3RqUXVlcnkgKTtcbiAgICAgICAgICAgIH0sXG5cbiAgICAgICAgLy8gTWFwIG92ZXIgalF1ZXJ5IGluIGNhc2Ugb2Ygb3ZlcndyaXRlXG4gICAgICAgICAgICBfalF1ZXJ5ID0gd2luZG93LmpRdWVyeSxcblxuICAgICAgICAvLyBNYXAgb3ZlciB0aGUgJCBpbiBjYXNlIG9mIG92ZXJ3cml0ZVxuICAgICAgICAgICAgXyQgPSB3aW5kb3cuJCxcblxuICAgICAgICAvLyBBIGNlbnRyYWwgcmVmZXJlbmNlIHRvIHRoZSByb290IGpRdWVyeShkb2N1bWVudClcbiAgICAgICAgICAgIHJvb3RqUXVlcnksXG5cbiAgICAgICAgLy8gQSBzaW1wbGUgd2F5IHRvIGNoZWNrIGZvciBIVE1MIHN0cmluZ3Mgb3IgSUQgc3RyaW5nc1xuICAgICAgICAvLyBQcmlvcml0aXplICNpZCBvdmVyIDx0YWc+IHRvIGF2b2lkIFhTUyB2aWEgbG9jYXRpb24uaGFzaCAoIzk1MjEpXG4gICAgICAgICAgICBxdWlja0V4cHIgPSAvXig/OlteIzxdKig8W1xcd1xcV10rPilbXj5dKiR8IyhbXFx3XFwtXSopJCkvLFxuXG4gICAgICAgIC8vIENoZWNrIGlmIGEgc3RyaW5nIGhhcyBhIG5vbi13aGl0ZXNwYWNlIGNoYXJhY3RlciBpbiBpdFxuICAgICAgICAgICAgcm5vdHdoaXRlID0gL1xcUy8sXG5cbiAgICAgICAgLy8gVXNlZCBmb3IgdHJpbW1pbmcgd2hpdGVzcGFjZVxuICAgICAgICAgICAgdHJpbUxlZnQgPSAvXlxccysvLFxuICAgICAgICAgICAgdHJpbVJpZ2h0ID0gL1xccyskLyxcblxuICAgICAgICAvLyBNYXRjaCBhIHN0YW5kYWxvbmUgdGFnXG4gICAgICAgICAgICByc2luZ2xlVGFnID0gL148KFxcdyspXFxzKlxcLz8+KD86PFxcL1xcMT4pPyQvLFxuXG4gICAgICAgIC8vIEpTT04gUmVnRXhwXG4gICAgICAgICAgICBydmFsaWRjaGFycyA9IC9eW1xcXSw6e31cXHNdKiQvLFxuICAgICAgICAgICAgcnZhbGlkZXNjYXBlID0gL1xcXFwoPzpbXCJcXFxcXFwvYmZucnRdfHVbMC05YS1mQS1GXXs0fSkvZyxcbiAgICAgICAgICAgIHJ2YWxpZHRva2VucyA9IC9cIlteXCJcXFxcXFxuXFxyXSpcInx0cnVlfGZhbHNlfG51bGx8LT9cXGQrKD86XFwuXFxkKik/KD86W2VFXVsrXFwtXT9cXGQrKT8vZyxcbiAgICAgICAgICAgIHJ2YWxpZGJyYWNlcyA9IC8oPzpefDp8LCkoPzpcXHMqXFxbKSsvZyxcblxuICAgICAgICAvLyBVc2VyYWdlbnQgUmVnRXhwXG4gICAgICAgICAgICByd2Via2l0ID0gLyh3ZWJraXQpWyBcXC9dKFtcXHcuXSspLyxcbiAgICAgICAgICAgIHJvcGVyYSA9IC8ob3BlcmEpKD86Lip2ZXJzaW9uKT9bIFxcL10oW1xcdy5dKykvLFxuICAgICAgICAgICAgcm1zaWUgPSAvKG1zaWUpIChbXFx3Ll0rKS8sXG4gICAgICAgICAgICBybW96aWxsYSA9IC8obW96aWxsYSkoPzouKj8gcnY6KFtcXHcuXSspKT8vLFxuXG4gICAgICAgIC8vIE1hdGNoZXMgZGFzaGVkIHN0cmluZyBmb3IgY2FtZWxpemluZ1xuICAgICAgICAgICAgcmRhc2hBbHBoYSA9IC8tKFthLXpdfFswLTldKS9pZyxcbiAgICAgICAgICAgIHJtc1ByZWZpeCA9IC9eLW1zLS8sXG5cbiAgICAgICAgLy8gVXNlZCBieSBqUXVlcnkuY2FtZWxDYXNlIGFzIGNhbGxiYWNrIHRvIHJlcGxhY2UoKVxuICAgICAgICAgICAgZmNhbWVsQ2FzZSA9IGZ1bmN0aW9uKCBhbGwsIGxldHRlciApIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gKCBsZXR0ZXIgKyBcIlwiICkudG9VcHBlckNhc2UoKTtcbiAgICAgICAgICAgIH0sXG5cbiAgICAgICAgLy8gS2VlcCBhIFVzZXJBZ2VudCBzdHJpbmcgZm9yIHVzZSB3aXRoIGpRdWVyeS5icm93c2VyXG4gICAgICAgICAgICB1c2VyQWdlbnQgPSBuYXZpZ2F0b3IudXNlckFnZW50LFxuXG4gICAgICAgIC8vIEZvciBtYXRjaGluZyB0aGUgZW5naW5lIGFuZCB2ZXJzaW9uIG9mIHRoZSBicm93c2VyXG4gICAgICAgICAgICBicm93c2VyTWF0Y2gsXG5cbiAgICAgICAgLy8gVGhlIGRlZmVycmVkIHVzZWQgb24gRE9NIHJlYWR5XG4gICAgICAgICAgICByZWFkeUxpc3QsXG5cbiAgICAgICAgLy8gVGhlIHJlYWR5IGV2ZW50IGhhbmRsZXJcbiAgICAgICAgICAgIERPTUNvbnRlbnRMb2FkZWQsXG5cbiAgICAgICAgLy8gU2F2ZSBhIHJlZmVyZW5jZSB0byBzb21lIGNvcmUgbWV0aG9kc1xuICAgICAgICAgICAgdG9TdHJpbmcgPSBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLFxuICAgICAgICAgICAgaGFzT3duID0gT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eSxcbiAgICAgICAgICAgIHB1c2ggPSBBcnJheS5wcm90b3R5cGUucHVzaCxcbiAgICAgICAgICAgIHNsaWNlID0gQXJyYXkucHJvdG90eXBlLnNsaWNlLFxuICAgICAgICAgICAgdHJpbSA9IFN0cmluZy5wcm90b3R5cGUudHJpbSxcbiAgICAgICAgICAgIGluZGV4T2YgPSBBcnJheS5wcm90b3R5cGUuaW5kZXhPZixcblxuICAgICAgICAvLyBbW0NsYXNzXV0gLT4gdHlwZSBwYWlyc1xuICAgICAgICAgICAgY2xhc3MydHlwZSA9IHt9O1xuXG4gICAgICAgIGpRdWVyeS5mbiA9IGpRdWVyeS5wcm90b3R5cGUgPSB7XG4gICAgICAgICAgICBjb25zdHJ1Y3RvcjogalF1ZXJ5LFxuICAgICAgICAgICAgaW5pdDogZnVuY3Rpb24oIHNlbGVjdG9yLCBjb250ZXh0LCByb290alF1ZXJ5ICkge1xuICAgICAgICAgICAgICAgIHZhciBtYXRjaCwgZWxlbSwgcmV0LCBkb2M7XG5cbiAgICAgICAgICAgICAgICAvLyBIYW5kbGUgJChcIlwiKSwgJChudWxsKSwgb3IgJCh1bmRlZmluZWQpXG4gICAgICAgICAgICAgICAgaWYgKCAhc2VsZWN0b3IgKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIC8vIEhhbmRsZSAkKERPTUVsZW1lbnQpXG4gICAgICAgICAgICAgICAgaWYgKCBzZWxlY3Rvci5ub2RlVHlwZSApIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5jb250ZXh0ID0gdGhpc1swXSA9IHNlbGVjdG9yO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmxlbmd0aCA9IDE7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIC8vIFRoZSBib2R5IGVsZW1lbnQgb25seSBleGlzdHMgb25jZSwgb3B0aW1pemUgZmluZGluZyBpdFxuICAgICAgICAgICAgICAgIGlmICggc2VsZWN0b3IgPT09IFwiYm9keVwiICYmICFjb250ZXh0ICYmIGRvY3VtZW50LmJvZHkgKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuY29udGV4dCA9IGRvY3VtZW50O1xuICAgICAgICAgICAgICAgICAgICB0aGlzWzBdID0gZG9jdW1lbnQuYm9keTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zZWxlY3RvciA9IHNlbGVjdG9yO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmxlbmd0aCA9IDE7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIC8vIEhhbmRsZSBIVE1MIHN0cmluZ3NcbiAgICAgICAgICAgICAgICBpZiAoIHR5cGVvZiBzZWxlY3RvciA9PT0gXCJzdHJpbmdcIiApIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gQXJlIHdlIGRlYWxpbmcgd2l0aCBIVE1MIHN0cmluZyBvciBhbiBJRD9cbiAgICAgICAgICAgICAgICAgICAgaWYgKCBzZWxlY3Rvci5jaGFyQXQoMCkgPT09IFwiPFwiICYmIHNlbGVjdG9yLmNoYXJBdCggc2VsZWN0b3IubGVuZ3RoIC0gMSApID09PSBcIj5cIiAmJiBzZWxlY3Rvci5sZW5ndGggPj0gMyApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIEFzc3VtZSB0aGF0IHN0cmluZ3MgdGhhdCBzdGFydCBhbmQgZW5kIHdpdGggPD4gYXJlIEhUTUwgYW5kIHNraXAgdGhlIHJlZ2V4IGNoZWNrXG4gICAgICAgICAgICAgICAgICAgICAgICBtYXRjaCA9IFsgbnVsbCwgc2VsZWN0b3IsIG51bGwgXTtcblxuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgbWF0Y2ggPSBxdWlja0V4cHIuZXhlYyggc2VsZWN0b3IgKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIC8vIFZlcmlmeSBhIG1hdGNoLCBhbmQgdGhhdCBubyBjb250ZXh0IHdhcyBzcGVjaWZpZWQgZm9yICNpZFxuICAgICAgICAgICAgICAgICAgICBpZiAoIG1hdGNoICYmIChtYXRjaFsxXSB8fCAhY29udGV4dCkgKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIEhBTkRMRTogJChodG1sKSAtPiAkKGFycmF5KVxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCBtYXRjaFsxXSApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb250ZXh0ID0gY29udGV4dCBpbnN0YW5jZW9mIGpRdWVyeSA/IGNvbnRleHRbMF0gOiBjb250ZXh0O1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRvYyA9ICggY29udGV4dCA/IGNvbnRleHQub3duZXJEb2N1bWVudCB8fCBjb250ZXh0IDogZG9jdW1lbnQgKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIElmIGEgc2luZ2xlIHN0cmluZyBpcyBwYXNzZWQgaW4gYW5kIGl0J3MgYSBzaW5nbGUgdGFnXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8ganVzdCBkbyBhIGNyZWF0ZUVsZW1lbnQgYW5kIHNraXAgdGhlIHJlc3RcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXQgPSByc2luZ2xlVGFnLmV4ZWMoIHNlbGVjdG9yICk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIHJldCApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCBqUXVlcnkuaXNQbGFpbk9iamVjdCggY29udGV4dCApICkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZWN0b3IgPSBbIGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoIHJldFsxXSApIF07XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBqUXVlcnkuZm4uYXR0ci5jYWxsKCBzZWxlY3RvciwgY29udGV4dCwgdHJ1ZSApO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxlY3RvciA9IFsgZG9jLmNyZWF0ZUVsZW1lbnQoIHJldFsxXSApIF07XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldCA9IGpRdWVyeS5idWlsZEZyYWdtZW50KCBbIG1hdGNoWzFdIF0sIFsgZG9jIF0gKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZWN0b3IgPSAoIHJldC5jYWNoZWFibGUgPyBqUXVlcnkuY2xvbmUocmV0LmZyYWdtZW50KSA6IHJldC5mcmFnbWVudCApLmNoaWxkTm9kZXM7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGpRdWVyeS5tZXJnZSggdGhpcywgc2VsZWN0b3IgKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIEhBTkRMRTogJChcIiNpZFwiKVxuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbGVtID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoIG1hdGNoWzJdICk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBDaGVjayBwYXJlbnROb2RlIHRvIGNhdGNoIHdoZW4gQmxhY2tiZXJyeSA0LjYgcmV0dXJuc1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIG5vZGVzIHRoYXQgYXJlIG5vIGxvbmdlciBpbiB0aGUgZG9jdW1lbnQgIzY5NjNcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIGVsZW0gJiYgZWxlbS5wYXJlbnROb2RlICkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBIYW5kbGUgdGhlIGNhc2Ugd2hlcmUgSUUgYW5kIE9wZXJhIHJldHVybiBpdGVtc1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBieSBuYW1lIGluc3RlYWQgb2YgSURcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCBlbGVtLmlkICE9PSBtYXRjaFsyXSApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiByb290alF1ZXJ5LmZpbmQoIHNlbGVjdG9yICk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBPdGhlcndpc2UsIHdlIGluamVjdCB0aGUgZWxlbWVudCBkaXJlY3RseSBpbnRvIHRoZSBqUXVlcnkgb2JqZWN0XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubGVuZ3RoID0gMTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpc1swXSA9IGVsZW07XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5jb250ZXh0ID0gZG9jdW1lbnQ7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zZWxlY3RvciA9IHNlbGVjdG9yO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBIQU5ETEU6ICQoZXhwciwgJCguLi4pKVxuICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKCAhY29udGV4dCB8fCBjb250ZXh0LmpxdWVyeSApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAoIGNvbnRleHQgfHwgcm9vdGpRdWVyeSApLmZpbmQoIHNlbGVjdG9yICk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIEhBTkRMRTogJChleHByLCBjb250ZXh0KVxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gKHdoaWNoIGlzIGp1c3QgZXF1aXZhbGVudCB0bzogJChjb250ZXh0KS5maW5kKGV4cHIpXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5jb25zdHJ1Y3RvciggY29udGV4dCApLmZpbmQoIHNlbGVjdG9yICk7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAvLyBIQU5ETEU6ICQoZnVuY3Rpb24pXG4gICAgICAgICAgICAgICAgICAgIC8vIFNob3J0Y3V0IGZvciBkb2N1bWVudCByZWFkeVxuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoIGpRdWVyeS5pc0Z1bmN0aW9uKCBzZWxlY3RvciApICkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gcm9vdGpRdWVyeS5yZWFkeSggc2VsZWN0b3IgKTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBpZiAoIHNlbGVjdG9yLnNlbGVjdG9yICE9PSB1bmRlZmluZWQgKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2VsZWN0b3IgPSBzZWxlY3Rvci5zZWxlY3RvcjtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5jb250ZXh0ID0gc2VsZWN0b3IuY29udGV4dDtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICByZXR1cm4galF1ZXJ5Lm1ha2VBcnJheSggc2VsZWN0b3IsIHRoaXMgKTtcbiAgICAgICAgICAgIH0sXG5cbiAgICAgICAgICAgIC8vIFN0YXJ0IHdpdGggYW4gZW1wdHkgc2VsZWN0b3JcbiAgICAgICAgICAgIHNlbGVjdG9yOiBcIlwiLFxuXG4gICAgICAgICAgICAvLyBUaGUgY3VycmVudCB2ZXJzaW9uIG9mIGpRdWVyeSBiZWluZyB1c2VkXG4gICAgICAgICAgICBqcXVlcnk6IFwiMS43LjFcIixcblxuICAgICAgICAgICAgLy8gVGhlIGRlZmF1bHQgbGVuZ3RoIG9mIGEgalF1ZXJ5IG9iamVjdCBpcyAwXG4gICAgICAgICAgICBsZW5ndGg6IDAsXG5cbiAgICAgICAgICAgIC8vIFRoZSBudW1iZXIgb2YgZWxlbWVudHMgY29udGFpbmVkIGluIHRoZSBtYXRjaGVkIGVsZW1lbnQgc2V0XG4gICAgICAgICAgICBzaXplOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5sZW5ndGg7XG4gICAgICAgICAgICB9LFxuXG4gICAgICAgICAgICB0b0FycmF5OiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gc2xpY2UuY2FsbCggdGhpcywgMCApO1xuICAgICAgICAgICAgfSxcblxuICAgICAgICAgICAgLy8gR2V0IHRoZSBOdGggZWxlbWVudCBpbiB0aGUgbWF0Y2hlZCBlbGVtZW50IHNldCBPUlxuICAgICAgICAgICAgLy8gR2V0IHRoZSB3aG9sZSBtYXRjaGVkIGVsZW1lbnQgc2V0IGFzIGEgY2xlYW4gYXJyYXlcbiAgICAgICAgICAgIGdldDogZnVuY3Rpb24oIG51bSApIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gbnVtID09IG51bGwgP1xuXG4gICAgICAgICAgICAgICAgICAgIC8vIFJldHVybiBhICdjbGVhbicgYXJyYXlcbiAgICAgICAgICAgICAgICAgICAgdGhpcy50b0FycmF5KCkgOlxuXG4gICAgICAgICAgICAgICAgICAgIC8vIFJldHVybiBqdXN0IHRoZSBvYmplY3RcbiAgICAgICAgICAgICAgICAgICAgKCBudW0gPCAwID8gdGhpc1sgdGhpcy5sZW5ndGggKyBudW0gXSA6IHRoaXNbIG51bSBdICk7XG4gICAgICAgICAgICB9LFxuXG4gICAgICAgICAgICAvLyBUYWtlIGFuIGFycmF5IG9mIGVsZW1lbnRzIGFuZCBwdXNoIGl0IG9udG8gdGhlIHN0YWNrXG4gICAgICAgICAgICAvLyAocmV0dXJuaW5nIHRoZSBuZXcgbWF0Y2hlZCBlbGVtZW50IHNldClcbiAgICAgICAgICAgIHB1c2hTdGFjazogZnVuY3Rpb24oIGVsZW1zLCBuYW1lLCBzZWxlY3RvciApIHtcbiAgICAgICAgICAgICAgICAvLyBCdWlsZCBhIG5ldyBqUXVlcnkgbWF0Y2hlZCBlbGVtZW50IHNldFxuICAgICAgICAgICAgICAgIHZhciByZXQgPSB0aGlzLmNvbnN0cnVjdG9yKCk7XG5cbiAgICAgICAgICAgICAgICBpZiAoIGpRdWVyeS5pc0FycmF5KCBlbGVtcyApICkge1xuICAgICAgICAgICAgICAgICAgICBwdXNoLmFwcGx5KCByZXQsIGVsZW1zICk7XG5cbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBqUXVlcnkubWVyZ2UoIHJldCwgZWxlbXMgKTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAvLyBBZGQgdGhlIG9sZCBvYmplY3Qgb250byB0aGUgc3RhY2sgKGFzIGEgcmVmZXJlbmNlKVxuICAgICAgICAgICAgICAgIHJldC5wcmV2T2JqZWN0ID0gdGhpcztcblxuICAgICAgICAgICAgICAgIHJldC5jb250ZXh0ID0gdGhpcy5jb250ZXh0O1xuXG4gICAgICAgICAgICAgICAgaWYgKCBuYW1lID09PSBcImZpbmRcIiApIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0LnNlbGVjdG9yID0gdGhpcy5zZWxlY3RvciArICggdGhpcy5zZWxlY3RvciA/IFwiIFwiIDogXCJcIiApICsgc2VsZWN0b3I7XG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmICggbmFtZSApIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0LnNlbGVjdG9yID0gdGhpcy5zZWxlY3RvciArIFwiLlwiICsgbmFtZSArIFwiKFwiICsgc2VsZWN0b3IgKyBcIilcIjtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAvLyBSZXR1cm4gdGhlIG5ld2x5LWZvcm1lZCBlbGVtZW50IHNldFxuICAgICAgICAgICAgICAgIHJldHVybiByZXQ7XG4gICAgICAgICAgICB9LFxuXG4gICAgICAgICAgICAvLyBFeGVjdXRlIGEgY2FsbGJhY2sgZm9yIGV2ZXJ5IGVsZW1lbnQgaW4gdGhlIG1hdGNoZWQgc2V0LlxuICAgICAgICAgICAgLy8gKFlvdSBjYW4gc2VlZCB0aGUgYXJndW1lbnRzIHdpdGggYW4gYXJyYXkgb2YgYXJncywgYnV0IHRoaXMgaXNcbiAgICAgICAgICAgIC8vIG9ubHkgdXNlZCBpbnRlcm5hbGx5LilcbiAgICAgICAgICAgIGVhY2g6IGZ1bmN0aW9uKCBjYWxsYmFjaywgYXJncyApIHtcbiAgICAgICAgICAgICAgICByZXR1cm4galF1ZXJ5LmVhY2goIHRoaXMsIGNhbGxiYWNrLCBhcmdzICk7XG4gICAgICAgICAgICB9LFxuXG4gICAgICAgICAgICByZWFkeTogZnVuY3Rpb24oIGZuICkge1xuICAgICAgICAgICAgICAgIC8vIEF0dGFjaCB0aGUgbGlzdGVuZXJzXG4gICAgICAgICAgICAgICAgalF1ZXJ5LmJpbmRSZWFkeSgpO1xuXG4gICAgICAgICAgICAgICAgLy8gQWRkIHRoZSBjYWxsYmFja1xuICAgICAgICAgICAgICAgIHJlYWR5TGlzdC5hZGQoIGZuICk7XG5cbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcztcbiAgICAgICAgICAgIH0sXG5cbiAgICAgICAgICAgIGVxOiBmdW5jdGlvbiggaSApIHtcbiAgICAgICAgICAgICAgICBpID0gK2k7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGkgPT09IC0xID9cbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zbGljZSggaSApIDpcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zbGljZSggaSwgaSArIDEgKTtcbiAgICAgICAgICAgIH0sXG5cbiAgICAgICAgICAgIGZpcnN0OiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5lcSggMCApO1xuICAgICAgICAgICAgfSxcblxuICAgICAgICAgICAgbGFzdDogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuZXEoIC0xICk7XG4gICAgICAgICAgICB9LFxuXG4gICAgICAgICAgICBzbGljZTogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMucHVzaFN0YWNrKCBzbGljZS5hcHBseSggdGhpcywgYXJndW1lbnRzICksXG4gICAgICAgICAgICAgICAgICAgIFwic2xpY2VcIiwgc2xpY2UuY2FsbChhcmd1bWVudHMpLmpvaW4oXCIsXCIpICk7XG4gICAgICAgICAgICB9LFxuXG4gICAgICAgICAgICBtYXA6IGZ1bmN0aW9uKCBjYWxsYmFjayApIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5wdXNoU3RhY2soIGpRdWVyeS5tYXAodGhpcywgZnVuY3Rpb24oIGVsZW0sIGkgKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBjYWxsYmFjay5jYWxsKCBlbGVtLCBpLCBlbGVtICk7XG4gICAgICAgICAgICAgICAgfSkpO1xuICAgICAgICAgICAgfSxcblxuICAgICAgICAgICAgZW5kOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5wcmV2T2JqZWN0IHx8IHRoaXMuY29uc3RydWN0b3IobnVsbCk7XG4gICAgICAgICAgICB9LFxuXG4gICAgICAgICAgICAvLyBGb3IgaW50ZXJuYWwgdXNlIG9ubHkuXG4gICAgICAgICAgICAvLyBCZWhhdmVzIGxpa2UgYW4gQXJyYXkncyBtZXRob2QsIG5vdCBsaWtlIGEgalF1ZXJ5IG1ldGhvZC5cbiAgICAgICAgICAgIHB1c2g6IHB1c2gsXG4gICAgICAgICAgICBzb3J0OiBbXS5zb3J0LFxuICAgICAgICAgICAgc3BsaWNlOiBbXS5zcGxpY2VcbiAgICAgICAgfTtcblxuLy8gR2l2ZSB0aGUgaW5pdCBmdW5jdGlvbiB0aGUgalF1ZXJ5IHByb3RvdHlwZSBmb3IgbGF0ZXIgaW5zdGFudGlhdGlvblxuICAgICAgICBqUXVlcnkuZm4uaW5pdC5wcm90b3R5cGUgPSBqUXVlcnkuZm47XG5cbiAgICAgICAgalF1ZXJ5LmV4dGVuZCA9IGpRdWVyeS5mbi5leHRlbmQgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHZhciBvcHRpb25zLCBuYW1lLCBzcmMsIGNvcHksIGNvcHlJc0FycmF5LCBjbG9uZSxcbiAgICAgICAgICAgICAgICB0YXJnZXQgPSBhcmd1bWVudHNbMF0gfHwge30sXG4gICAgICAgICAgICAgICAgaSA9IDEsXG4gICAgICAgICAgICAgICAgbGVuZ3RoID0gYXJndW1lbnRzLmxlbmd0aCxcbiAgICAgICAgICAgICAgICBkZWVwID0gZmFsc2U7XG5cbiAgICAgICAgICAgIC8vIEhhbmRsZSBhIGRlZXAgY29weSBzaXR1YXRpb25cbiAgICAgICAgICAgIGlmICggdHlwZW9mIHRhcmdldCA9PT0gXCJib29sZWFuXCIgKSB7XG4gICAgICAgICAgICAgICAgZGVlcCA9IHRhcmdldDtcbiAgICAgICAgICAgICAgICB0YXJnZXQgPSBhcmd1bWVudHNbMV0gfHwge307XG4gICAgICAgICAgICAgICAgLy8gc2tpcCB0aGUgYm9vbGVhbiBhbmQgdGhlIHRhcmdldFxuICAgICAgICAgICAgICAgIGkgPSAyO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBIYW5kbGUgY2FzZSB3aGVuIHRhcmdldCBpcyBhIHN0cmluZyBvciBzb21ldGhpbmcgKHBvc3NpYmxlIGluIGRlZXAgY29weSlcbiAgICAgICAgICAgIGlmICggdHlwZW9mIHRhcmdldCAhPT0gXCJvYmplY3RcIiAmJiAhalF1ZXJ5LmlzRnVuY3Rpb24odGFyZ2V0KSApIHtcbiAgICAgICAgICAgICAgICB0YXJnZXQgPSB7fTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gZXh0ZW5kIGpRdWVyeSBpdHNlbGYgaWYgb25seSBvbmUgYXJndW1lbnQgaXMgcGFzc2VkXG4gICAgICAgICAgICBpZiAoIGxlbmd0aCA9PT0gaSApIHtcbiAgICAgICAgICAgICAgICB0YXJnZXQgPSB0aGlzO1xuICAgICAgICAgICAgICAgIC0taTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgZm9yICggOyBpIDwgbGVuZ3RoOyBpKysgKSB7XG4gICAgICAgICAgICAgICAgLy8gT25seSBkZWFsIHdpdGggbm9uLW51bGwvdW5kZWZpbmVkIHZhbHVlc1xuICAgICAgICAgICAgICAgIGlmICggKG9wdGlvbnMgPSBhcmd1bWVudHNbIGkgXSkgIT0gbnVsbCApIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gRXh0ZW5kIHRoZSBiYXNlIG9iamVjdFxuICAgICAgICAgICAgICAgICAgICBmb3IgKCBuYW1lIGluIG9wdGlvbnMgKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzcmMgPSB0YXJnZXRbIG5hbWUgXTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvcHkgPSBvcHRpb25zWyBuYW1lIF07XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFByZXZlbnQgbmV2ZXItZW5kaW5nIGxvb3BcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICggdGFyZ2V0ID09PSBjb3B5ICkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBSZWN1cnNlIGlmIHdlJ3JlIG1lcmdpbmcgcGxhaW4gb2JqZWN0cyBvciBhcnJheXNcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICggZGVlcCAmJiBjb3B5ICYmICggalF1ZXJ5LmlzUGxhaW5PYmplY3QoY29weSkgfHwgKGNvcHlJc0FycmF5ID0galF1ZXJ5LmlzQXJyYXkoY29weSkpICkgKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCBjb3B5SXNBcnJheSApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29weUlzQXJyYXkgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2xvbmUgPSBzcmMgJiYgalF1ZXJ5LmlzQXJyYXkoc3JjKSA/IHNyYyA6IFtdO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2xvbmUgPSBzcmMgJiYgalF1ZXJ5LmlzUGxhaW5PYmplY3Qoc3JjKSA/IHNyYyA6IHt9O1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIE5ldmVyIG1vdmUgb3JpZ2luYWwgb2JqZWN0cywgY2xvbmUgdGhlbVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhcmdldFsgbmFtZSBdID0galF1ZXJ5LmV4dGVuZCggZGVlcCwgY2xvbmUsIGNvcHkgKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIERvbid0IGJyaW5nIGluIHVuZGVmaW5lZCB2YWx1ZXNcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoIGNvcHkgIT09IHVuZGVmaW5lZCApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YXJnZXRbIG5hbWUgXSA9IGNvcHk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIFJldHVybiB0aGUgbW9kaWZpZWQgb2JqZWN0XG4gICAgICAgICAgICByZXR1cm4gdGFyZ2V0O1xuICAgICAgICB9O1xuXG4gICAgICAgIGpRdWVyeS5leHRlbmQoe1xuICAgICAgICAgICAgbm9Db25mbGljdDogZnVuY3Rpb24oIGRlZXAgKSB7XG4gICAgICAgICAgICAgICAgaWYgKCB3aW5kb3cuJCA9PT0galF1ZXJ5ICkge1xuICAgICAgICAgICAgICAgICAgICB3aW5kb3cuJCA9IF8kO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGlmICggZGVlcCAmJiB3aW5kb3cualF1ZXJ5ID09PSBqUXVlcnkgKSB7XG4gICAgICAgICAgICAgICAgICAgIHdpbmRvdy5qUXVlcnkgPSBfalF1ZXJ5O1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIHJldHVybiBqUXVlcnk7XG4gICAgICAgICAgICB9LFxuXG4gICAgICAgICAgICAvLyBJcyB0aGUgRE9NIHJlYWR5IHRvIGJlIHVzZWQ/IFNldCB0byB0cnVlIG9uY2UgaXQgb2NjdXJzLlxuICAgICAgICAgICAgaXNSZWFkeTogZmFsc2UsXG5cbiAgICAgICAgICAgIC8vIEEgY291bnRlciB0byB0cmFjayBob3cgbWFueSBpdGVtcyB0byB3YWl0IGZvciBiZWZvcmVcbiAgICAgICAgICAgIC8vIHRoZSByZWFkeSBldmVudCBmaXJlcy4gU2VlICM2NzgxXG4gICAgICAgICAgICByZWFkeVdhaXQ6IDEsXG5cbiAgICAgICAgICAgIC8vIEhvbGQgKG9yIHJlbGVhc2UpIHRoZSByZWFkeSBldmVudFxuICAgICAgICAgICAgaG9sZFJlYWR5OiBmdW5jdGlvbiggaG9sZCApIHtcbiAgICAgICAgICAgICAgICBpZiAoIGhvbGQgKSB7XG4gICAgICAgICAgICAgICAgICAgIGpRdWVyeS5yZWFkeVdhaXQrKztcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBqUXVlcnkucmVhZHkoIHRydWUgKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuXG4gICAgICAgICAgICAvLyBIYW5kbGUgd2hlbiB0aGUgRE9NIGlzIHJlYWR5XG4gICAgICAgICAgICByZWFkeTogZnVuY3Rpb24oIHdhaXQgKSB7XG4gICAgICAgICAgICAgICAgLy8gRWl0aGVyIGEgcmVsZWFzZWQgaG9sZCBvciBhbiBET01yZWFkeS9sb2FkIGV2ZW50IGFuZCBub3QgeWV0IHJlYWR5XG4gICAgICAgICAgICAgICAgaWYgKCAod2FpdCA9PT0gdHJ1ZSAmJiAhLS1qUXVlcnkucmVhZHlXYWl0KSB8fCAod2FpdCAhPT0gdHJ1ZSAmJiAhalF1ZXJ5LmlzUmVhZHkpICkge1xuICAgICAgICAgICAgICAgICAgICAvLyBNYWtlIHN1cmUgYm9keSBleGlzdHMsIGF0IGxlYXN0LCBpbiBjYXNlIElFIGdldHMgYSBsaXR0bGUgb3ZlcnplYWxvdXMgKHRpY2tldCAjNTQ0MykuXG4gICAgICAgICAgICAgICAgICAgIGlmICggIWRvY3VtZW50LmJvZHkgKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gc2V0VGltZW91dCggalF1ZXJ5LnJlYWR5LCAxICk7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAvLyBSZW1lbWJlciB0aGF0IHRoZSBET00gaXMgcmVhZHlcbiAgICAgICAgICAgICAgICAgICAgalF1ZXJ5LmlzUmVhZHkgPSB0cnVlO1xuXG4gICAgICAgICAgICAgICAgICAgIC8vIElmIGEgbm9ybWFsIERPTSBSZWFkeSBldmVudCBmaXJlZCwgZGVjcmVtZW50LCBhbmQgd2FpdCBpZiBuZWVkIGJlXG4gICAgICAgICAgICAgICAgICAgIGlmICggd2FpdCAhPT0gdHJ1ZSAmJiAtLWpRdWVyeS5yZWFkeVdhaXQgPiAwICkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgLy8gSWYgdGhlcmUgYXJlIGZ1bmN0aW9ucyBib3VuZCwgdG8gZXhlY3V0ZVxuICAgICAgICAgICAgICAgICAgICByZWFkeUxpc3QuZmlyZVdpdGgoIGRvY3VtZW50LCBbIGpRdWVyeSBdICk7XG5cbiAgICAgICAgICAgICAgICAgICAgLy8gVHJpZ2dlciBhbnkgYm91bmQgcmVhZHkgZXZlbnRzXG4gICAgICAgICAgICAgICAgICAgIGlmICggalF1ZXJ5LmZuLnRyaWdnZXIgKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBqUXVlcnkoIGRvY3VtZW50ICkudHJpZ2dlciggXCJyZWFkeVwiICkub2ZmKCBcInJlYWR5XCIgKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG5cbiAgICAgICAgICAgIGJpbmRSZWFkeTogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgaWYgKCByZWFkeUxpc3QgKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICByZWFkeUxpc3QgPSBqUXVlcnkuQ2FsbGJhY2tzKCBcIm9uY2UgbWVtb3J5XCIgKTtcblxuICAgICAgICAgICAgICAgIC8vIENhdGNoIGNhc2VzIHdoZXJlICQoZG9jdW1lbnQpLnJlYWR5KCkgaXMgY2FsbGVkIGFmdGVyIHRoZVxuICAgICAgICAgICAgICAgIC8vIGJyb3dzZXIgZXZlbnQgaGFzIGFscmVhZHkgb2NjdXJyZWQuXG4gICAgICAgICAgICAgICAgaWYgKCBkb2N1bWVudC5yZWFkeVN0YXRlID09PSBcImNvbXBsZXRlXCIgKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIEhhbmRsZSBpdCBhc3luY2hyb25vdXNseSB0byBhbGxvdyBzY3JpcHRzIHRoZSBvcHBvcnR1bml0eSB0byBkZWxheSByZWFkeVxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gc2V0VGltZW91dCggalF1ZXJ5LnJlYWR5LCAxICk7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgLy8gTW96aWxsYSwgT3BlcmEgYW5kIHdlYmtpdCBuaWdodGxpZXMgY3VycmVudGx5IHN1cHBvcnQgdGhpcyBldmVudFxuICAgICAgICAgICAgICAgIGlmICggZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lciApIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gVXNlIHRoZSBoYW5keSBldmVudCBjYWxsYmFja1xuICAgICAgICAgICAgICAgICAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCBcIkRPTUNvbnRlbnRMb2FkZWRcIiwgRE9NQ29udGVudExvYWRlZCwgZmFsc2UgKTtcblxuICAgICAgICAgICAgICAgICAgICAvLyBBIGZhbGxiYWNrIHRvIHdpbmRvdy5vbmxvYWQsIHRoYXQgd2lsbCBhbHdheXMgd29ya1xuICAgICAgICAgICAgICAgICAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lciggXCJsb2FkXCIsIGpRdWVyeS5yZWFkeSwgZmFsc2UgKTtcblxuICAgICAgICAgICAgICAgICAgICAvLyBJZiBJRSBldmVudCBtb2RlbCBpcyB1c2VkXG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmICggZG9jdW1lbnQuYXR0YWNoRXZlbnQgKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIGVuc3VyZSBmaXJpbmcgYmVmb3JlIG9ubG9hZCxcbiAgICAgICAgICAgICAgICAgICAgLy8gbWF5YmUgbGF0ZSBidXQgc2FmZSBhbHNvIGZvciBpZnJhbWVzXG4gICAgICAgICAgICAgICAgICAgIGRvY3VtZW50LmF0dGFjaEV2ZW50KCBcIm9ucmVhZHlzdGF0ZWNoYW5nZVwiLCBET01Db250ZW50TG9hZGVkICk7XG5cbiAgICAgICAgICAgICAgICAgICAgLy8gQSBmYWxsYmFjayB0byB3aW5kb3cub25sb2FkLCB0aGF0IHdpbGwgYWx3YXlzIHdvcmtcbiAgICAgICAgICAgICAgICAgICAgd2luZG93LmF0dGFjaEV2ZW50KCBcIm9ubG9hZFwiLCBqUXVlcnkucmVhZHkgKTtcblxuICAgICAgICAgICAgICAgICAgICAvLyBJZiBJRSBhbmQgbm90IGEgZnJhbWVcbiAgICAgICAgICAgICAgICAgICAgLy8gY29udGludWFsbHkgY2hlY2sgdG8gc2VlIGlmIHRoZSBkb2N1bWVudCBpcyByZWFkeVxuICAgICAgICAgICAgICAgICAgICB2YXIgdG9wbGV2ZWwgPSBmYWxzZTtcblxuICAgICAgICAgICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdG9wbGV2ZWwgPSB3aW5kb3cuZnJhbWVFbGVtZW50ID09IG51bGw7XG4gICAgICAgICAgICAgICAgICAgIH0gY2F0Y2goZSkge31cblxuICAgICAgICAgICAgICAgICAgICBpZiAoIGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5kb1Njcm9sbCAmJiB0b3BsZXZlbCApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGRvU2Nyb2xsQ2hlY2soKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG5cbiAgICAgICAgICAgIC8vIFNlZSB0ZXN0L3VuaXQvY29yZS5qcyBmb3IgZGV0YWlscyBjb25jZXJuaW5nIGlzRnVuY3Rpb24uXG4gICAgICAgICAgICAvLyBTaW5jZSB2ZXJzaW9uIDEuMywgRE9NIG1ldGhvZHMgYW5kIGZ1bmN0aW9ucyBsaWtlIGFsZXJ0XG4gICAgICAgICAgICAvLyBhcmVuJ3Qgc3VwcG9ydGVkLiBUaGV5IHJldHVybiBmYWxzZSBvbiBJRSAoIzI5NjgpLlxuICAgICAgICAgICAgaXNGdW5jdGlvbjogZnVuY3Rpb24oIG9iaiApIHtcbiAgICAgICAgICAgICAgICByZXR1cm4galF1ZXJ5LnR5cGUob2JqKSA9PT0gXCJmdW5jdGlvblwiO1xuICAgICAgICAgICAgfSxcblxuICAgICAgICAgICAgaXNBcnJheTogQXJyYXkuaXNBcnJheSB8fCBmdW5jdGlvbiggb2JqICkge1xuICAgICAgICAgICAgICAgIHJldHVybiBqUXVlcnkudHlwZShvYmopID09PSBcImFycmF5XCI7XG4gICAgICAgICAgICB9LFxuXG4gICAgICAgICAgICAvLyBBIGNydWRlIHdheSBvZiBkZXRlcm1pbmluZyBpZiBhbiBvYmplY3QgaXMgYSB3aW5kb3dcbiAgICAgICAgICAgIGlzV2luZG93OiBmdW5jdGlvbiggb2JqICkge1xuICAgICAgICAgICAgICAgIHJldHVybiBvYmogJiYgdHlwZW9mIG9iaiA9PT0gXCJvYmplY3RcIiAmJiBcInNldEludGVydmFsXCIgaW4gb2JqO1xuICAgICAgICAgICAgfSxcblxuICAgICAgICAgICAgaXNOdW1lcmljOiBmdW5jdGlvbiggb2JqICkge1xuICAgICAgICAgICAgICAgIHJldHVybiAhaXNOYU4oIHBhcnNlRmxvYXQob2JqKSApICYmIGlzRmluaXRlKCBvYmogKTtcbiAgICAgICAgICAgIH0sXG5cbiAgICAgICAgICAgIHR5cGU6IGZ1bmN0aW9uKCBvYmogKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIG9iaiA9PSBudWxsID9cbiAgICAgICAgICAgICAgICAgICAgU3RyaW5nKCBvYmogKSA6XG4gICAgICAgICAgICAgICAgY2xhc3MydHlwZVsgdG9TdHJpbmcuY2FsbChvYmopIF0gfHwgXCJvYmplY3RcIjtcbiAgICAgICAgICAgIH0sXG5cbiAgICAgICAgICAgIGlzUGxhaW5PYmplY3Q6IGZ1bmN0aW9uKCBvYmogKSB7XG4gICAgICAgICAgICAgICAgLy8gTXVzdCBiZSBhbiBPYmplY3QuXG4gICAgICAgICAgICAgICAgLy8gQmVjYXVzZSBvZiBJRSwgd2UgYWxzbyBoYXZlIHRvIGNoZWNrIHRoZSBwcmVzZW5jZSBvZiB0aGUgY29uc3RydWN0b3IgcHJvcGVydHkuXG4gICAgICAgICAgICAgICAgLy8gTWFrZSBzdXJlIHRoYXQgRE9NIG5vZGVzIGFuZCB3aW5kb3cgb2JqZWN0cyBkb24ndCBwYXNzIHRocm91Z2gsIGFzIHdlbGxcbiAgICAgICAgICAgICAgICBpZiAoICFvYmogfHwgalF1ZXJ5LnR5cGUob2JqKSAhPT0gXCJvYmplY3RcIiB8fCBvYmoubm9kZVR5cGUgfHwgalF1ZXJ5LmlzV2luZG93KCBvYmogKSApIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIE5vdCBvd24gY29uc3RydWN0b3IgcHJvcGVydHkgbXVzdCBiZSBPYmplY3RcbiAgICAgICAgICAgICAgICAgICAgaWYgKCBvYmouY29uc3RydWN0b3IgJiZcbiAgICAgICAgICAgICAgICAgICAgICAgICFoYXNPd24uY2FsbChvYmosIFwiY29uc3RydWN0b3JcIikgJiZcbiAgICAgICAgICAgICAgICAgICAgICAgICFoYXNPd24uY2FsbChvYmouY29uc3RydWN0b3IucHJvdG90eXBlLCBcImlzUHJvdG90eXBlT2ZcIikgKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9IGNhdGNoICggZSApIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gSUU4LDkgV2lsbCB0aHJvdyBleGNlcHRpb25zIG9uIGNlcnRhaW4gaG9zdCBvYmplY3RzICM5ODk3XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAvLyBPd24gcHJvcGVydGllcyBhcmUgZW51bWVyYXRlZCBmaXJzdGx5LCBzbyB0byBzcGVlZCB1cCxcbiAgICAgICAgICAgICAgICAvLyBpZiBsYXN0IG9uZSBpcyBvd24sIHRoZW4gYWxsIHByb3BlcnRpZXMgYXJlIG93bi5cblxuICAgICAgICAgICAgICAgIHZhciBrZXk7XG4gICAgICAgICAgICAgICAgZm9yICgga2V5IGluIG9iaiApIHt9XG5cbiAgICAgICAgICAgICAgICByZXR1cm4ga2V5ID09PSB1bmRlZmluZWQgfHwgaGFzT3duLmNhbGwoIG9iaiwga2V5ICk7XG4gICAgICAgICAgICB9LFxuXG4gICAgICAgICAgICBpc0VtcHR5T2JqZWN0OiBmdW5jdGlvbiggb2JqICkge1xuICAgICAgICAgICAgICAgIGZvciAoIHZhciBuYW1lIGluIG9iaiApIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgIH0sXG5cbiAgICAgICAgICAgIGVycm9yOiBmdW5jdGlvbiggbXNnICkge1xuICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvciggbXNnICk7XG4gICAgICAgICAgICB9LFxuXG4gICAgICAgICAgICBwYXJzZUpTT046IGZ1bmN0aW9uKCBkYXRhICkge1xuICAgICAgICAgICAgICAgIGlmICggdHlwZW9mIGRhdGEgIT09IFwic3RyaW5nXCIgfHwgIWRhdGEgKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIC8vIE1ha2Ugc3VyZSBsZWFkaW5nL3RyYWlsaW5nIHdoaXRlc3BhY2UgaXMgcmVtb3ZlZCAoSUUgY2FuJ3QgaGFuZGxlIGl0KVxuICAgICAgICAgICAgICAgIGRhdGEgPSBqUXVlcnkudHJpbSggZGF0YSApO1xuXG4gICAgICAgICAgICAgICAgLy8gQXR0ZW1wdCB0byBwYXJzZSB1c2luZyB0aGUgbmF0aXZlIEpTT04gcGFyc2VyIGZpcnN0XG4gICAgICAgICAgICAgICAgaWYgKCB3aW5kb3cuSlNPTiAmJiB3aW5kb3cuSlNPTi5wYXJzZSApIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHdpbmRvdy5KU09OLnBhcnNlKCBkYXRhICk7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgLy8gTWFrZSBzdXJlIHRoZSBpbmNvbWluZyBkYXRhIGlzIGFjdHVhbCBKU09OXG4gICAgICAgICAgICAgICAgLy8gTG9naWMgYm9ycm93ZWQgZnJvbSBodHRwOi8vanNvbi5vcmcvanNvbjIuanNcbiAgICAgICAgICAgICAgICBpZiAoIHJ2YWxpZGNoYXJzLnRlc3QoIGRhdGEucmVwbGFjZSggcnZhbGlkZXNjYXBlLCBcIkBcIiApXG4gICAgICAgICAgICAgICAgICAgICAgICAucmVwbGFjZSggcnZhbGlkdG9rZW5zLCBcIl1cIiApXG4gICAgICAgICAgICAgICAgICAgICAgICAucmVwbGFjZSggcnZhbGlkYnJhY2VzLCBcIlwiKSkgKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICggbmV3IEZ1bmN0aW9uKCBcInJldHVybiBcIiArIGRhdGEgKSApKCk7XG5cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgalF1ZXJ5LmVycm9yKCBcIkludmFsaWQgSlNPTjogXCIgKyBkYXRhICk7XG4gICAgICAgICAgICB9LFxuXG4gICAgICAgICAgICAvLyBDcm9zcy1icm93c2VyIHhtbCBwYXJzaW5nXG4gICAgICAgICAgICBwYXJzZVhNTDogZnVuY3Rpb24oIGRhdGEgKSB7XG4gICAgICAgICAgICAgICAgdmFyIHhtbCwgdG1wO1xuICAgICAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICggd2luZG93LkRPTVBhcnNlciApIHsgLy8gU3RhbmRhcmRcbiAgICAgICAgICAgICAgICAgICAgICAgIHRtcCA9IG5ldyBET01QYXJzZXIoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHhtbCA9IHRtcC5wYXJzZUZyb21TdHJpbmcoIGRhdGEgLCBcInRleHQveG1sXCIgKTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsgLy8gSUVcbiAgICAgICAgICAgICAgICAgICAgICAgIHhtbCA9IG5ldyBBY3RpdmVYT2JqZWN0KCBcIk1pY3Jvc29mdC5YTUxET01cIiApO1xuICAgICAgICAgICAgICAgICAgICAgICAgeG1sLmFzeW5jID0gXCJmYWxzZVwiO1xuICAgICAgICAgICAgICAgICAgICAgICAgeG1sLmxvYWRYTUwoIGRhdGEgKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0gY2F0Y2goIGUgKSB7XG4gICAgICAgICAgICAgICAgICAgIHhtbCA9IHVuZGVmaW5lZDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKCAheG1sIHx8ICF4bWwuZG9jdW1lbnRFbGVtZW50IHx8IHhtbC5nZXRFbGVtZW50c0J5VGFnTmFtZSggXCJwYXJzZXJlcnJvclwiICkubGVuZ3RoICkge1xuICAgICAgICAgICAgICAgICAgICBqUXVlcnkuZXJyb3IoIFwiSW52YWxpZCBYTUw6IFwiICsgZGF0YSApO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm4geG1sO1xuICAgICAgICAgICAgfSxcblxuICAgICAgICAgICAgbm9vcDogZnVuY3Rpb24oKSB7fSxcblxuICAgICAgICAgICAgLy8gRXZhbHVhdGVzIGEgc2NyaXB0IGluIGEgZ2xvYmFsIGNvbnRleHRcbiAgICAgICAgICAgIC8vIFdvcmthcm91bmRzIGJhc2VkIG9uIGZpbmRpbmdzIGJ5IEppbSBEcmlzY29sbFxuICAgICAgICAgICAgLy8gaHR0cDovL3dlYmxvZ3MuamF2YS5uZXQvYmxvZy9kcmlzY29sbC9hcmNoaXZlLzIwMDkvMDkvMDgvZXZhbC1qYXZhc2NyaXB0LWdsb2JhbC1jb250ZXh0XG4gICAgICAgICAgICBnbG9iYWxFdmFsOiBmdW5jdGlvbiggZGF0YSApIHtcbiAgICAgICAgICAgICAgICBpZiAoIGRhdGEgJiYgcm5vdHdoaXRlLnRlc3QoIGRhdGEgKSApIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gV2UgdXNlIGV4ZWNTY3JpcHQgb24gSW50ZXJuZXQgRXhwbG9yZXJcbiAgICAgICAgICAgICAgICAgICAgLy8gV2UgdXNlIGFuIGFub255bW91cyBmdW5jdGlvbiBzbyB0aGF0IGNvbnRleHQgaXMgd2luZG93XG4gICAgICAgICAgICAgICAgICAgIC8vIHJhdGhlciB0aGFuIGpRdWVyeSBpbiBGaXJlZm94XG4gICAgICAgICAgICAgICAgICAgICggd2luZG93LmV4ZWNTY3JpcHQgfHwgZnVuY3Rpb24oIGRhdGEgKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB3aW5kb3dbIFwiZXZhbFwiIF0uY2FsbCggd2luZG93LCBkYXRhICk7XG4gICAgICAgICAgICAgICAgICAgIH0gKSggZGF0YSApO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG5cbiAgICAgICAgICAgIC8vIENvbnZlcnQgZGFzaGVkIHRvIGNhbWVsQ2FzZTsgdXNlZCBieSB0aGUgY3NzIGFuZCBkYXRhIG1vZHVsZXNcbiAgICAgICAgICAgIC8vIE1pY3Jvc29mdCBmb3Jnb3QgdG8gaHVtcCB0aGVpciB2ZW5kb3IgcHJlZml4ICgjOTU3MilcbiAgICAgICAgICAgIGNhbWVsQ2FzZTogZnVuY3Rpb24oIHN0cmluZyApIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gc3RyaW5nLnJlcGxhY2UoIHJtc1ByZWZpeCwgXCJtcy1cIiApLnJlcGxhY2UoIHJkYXNoQWxwaGEsIGZjYW1lbENhc2UgKTtcbiAgICAgICAgICAgIH0sXG5cbiAgICAgICAgICAgIG5vZGVOYW1lOiBmdW5jdGlvbiggZWxlbSwgbmFtZSApIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZWxlbS5ub2RlTmFtZSAmJiBlbGVtLm5vZGVOYW1lLnRvVXBwZXJDYXNlKCkgPT09IG5hbWUudG9VcHBlckNhc2UoKTtcbiAgICAgICAgICAgIH0sXG5cbiAgICAgICAgICAgIC8vIGFyZ3MgaXMgZm9yIGludGVybmFsIHVzYWdlIG9ubHlcbiAgICAgICAgICAgIGVhY2g6IGZ1bmN0aW9uKCBvYmplY3QsIGNhbGxiYWNrLCBhcmdzICkge1xuICAgICAgICAgICAgICAgIHZhciBuYW1lLCBpID0gMCxcbiAgICAgICAgICAgICAgICAgICAgbGVuZ3RoID0gb2JqZWN0Lmxlbmd0aCxcbiAgICAgICAgICAgICAgICAgICAgaXNPYmogPSBsZW5ndGggPT09IHVuZGVmaW5lZCB8fCBqUXVlcnkuaXNGdW5jdGlvbiggb2JqZWN0ICk7XG5cbiAgICAgICAgICAgICAgICBpZiAoIGFyZ3MgKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICggaXNPYmogKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBmb3IgKCBuYW1lIGluIG9iamVjdCApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIGNhbGxiYWNrLmFwcGx5KCBvYmplY3RbIG5hbWUgXSwgYXJncyApID09PSBmYWxzZSApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgZm9yICggOyBpIDwgbGVuZ3RoOyApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIGNhbGxiYWNrLmFwcGx5KCBvYmplY3RbIGkrKyBdLCBhcmdzICkgPT09IGZhbHNlICkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAvLyBBIHNwZWNpYWwsIGZhc3QsIGNhc2UgZm9yIHRoZSBtb3N0IGNvbW1vbiB1c2Ugb2YgZWFjaFxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICggaXNPYmogKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBmb3IgKCBuYW1lIGluIG9iamVjdCApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIGNhbGxiYWNrLmNhbGwoIG9iamVjdFsgbmFtZSBdLCBuYW1lLCBvYmplY3RbIG5hbWUgXSApID09PSBmYWxzZSApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgZm9yICggOyBpIDwgbGVuZ3RoOyApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIGNhbGxiYWNrLmNhbGwoIG9iamVjdFsgaSBdLCBpLCBvYmplY3RbIGkrKyBdICkgPT09IGZhbHNlICkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICByZXR1cm4gb2JqZWN0O1xuICAgICAgICAgICAgfSxcblxuICAgICAgICAgICAgLy8gVXNlIG5hdGl2ZSBTdHJpbmcudHJpbSBmdW5jdGlvbiB3aGVyZXZlciBwb3NzaWJsZVxuICAgICAgICAgICAgdHJpbTogdHJpbSA/XG4gICAgICAgICAgICAgICAgZnVuY3Rpb24oIHRleHQgKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0ZXh0ID09IG51bGwgP1xuICAgICAgICAgICAgICAgICAgICAgICAgXCJcIiA6XG4gICAgICAgICAgICAgICAgICAgICAgICB0cmltLmNhbGwoIHRleHQgKTtcbiAgICAgICAgICAgICAgICB9IDpcblxuICAgICAgICAgICAgICAgIC8vIE90aGVyd2lzZSB1c2Ugb3VyIG93biB0cmltbWluZyBmdW5jdGlvbmFsaXR5XG4gICAgICAgICAgICAgICAgZnVuY3Rpb24oIHRleHQgKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0ZXh0ID09IG51bGwgP1xuICAgICAgICAgICAgICAgICAgICAgICAgXCJcIiA6XG4gICAgICAgICAgICAgICAgICAgICAgICB0ZXh0LnRvU3RyaW5nKCkucmVwbGFjZSggdHJpbUxlZnQsIFwiXCIgKS5yZXBsYWNlKCB0cmltUmlnaHQsIFwiXCIgKTtcbiAgICAgICAgICAgICAgICB9LFxuXG4gICAgICAgICAgICAvLyByZXN1bHRzIGlzIGZvciBpbnRlcm5hbCB1c2FnZSBvbmx5XG4gICAgICAgICAgICBtYWtlQXJyYXk6IGZ1bmN0aW9uKCBhcnJheSwgcmVzdWx0cyApIHtcbiAgICAgICAgICAgICAgICB2YXIgcmV0ID0gcmVzdWx0cyB8fCBbXTtcblxuICAgICAgICAgICAgICAgIGlmICggYXJyYXkgIT0gbnVsbCApIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gVGhlIHdpbmRvdywgc3RyaW5ncyAoYW5kIGZ1bmN0aW9ucykgYWxzbyBoYXZlICdsZW5ndGgnXG4gICAgICAgICAgICAgICAgICAgIC8vIFR3ZWFrZWQgbG9naWMgc2xpZ2h0bHkgdG8gaGFuZGxlIEJsYWNrYmVycnkgNC43IFJlZ0V4cCBpc3N1ZXMgIzY5MzBcbiAgICAgICAgICAgICAgICAgICAgdmFyIHR5cGUgPSBqUXVlcnkudHlwZSggYXJyYXkgKTtcblxuICAgICAgICAgICAgICAgICAgICBpZiAoIGFycmF5Lmxlbmd0aCA9PSBudWxsIHx8IHR5cGUgPT09IFwic3RyaW5nXCIgfHwgdHlwZSA9PT0gXCJmdW5jdGlvblwiIHx8IHR5cGUgPT09IFwicmVnZXhwXCIgfHwgalF1ZXJ5LmlzV2luZG93KCBhcnJheSApICkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcHVzaC5jYWxsKCByZXQsIGFycmF5ICk7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBqUXVlcnkubWVyZ2UoIHJldCwgYXJyYXkgKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIHJldHVybiByZXQ7XG4gICAgICAgICAgICB9LFxuXG4gICAgICAgICAgICBpbkFycmF5OiBmdW5jdGlvbiggZWxlbSwgYXJyYXksIGkgKSB7XG4gICAgICAgICAgICAgICAgdmFyIGxlbjtcblxuICAgICAgICAgICAgICAgIGlmICggYXJyYXkgKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICggaW5kZXhPZiApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBpbmRleE9mLmNhbGwoIGFycmF5LCBlbGVtLCBpICk7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICBsZW4gPSBhcnJheS5sZW5ndGg7XG4gICAgICAgICAgICAgICAgICAgIGkgPSBpID8gaSA8IDAgPyBNYXRoLm1heCggMCwgbGVuICsgaSApIDogaSA6IDA7XG5cbiAgICAgICAgICAgICAgICAgICAgZm9yICggOyBpIDwgbGVuOyBpKysgKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBTa2lwIGFjY2Vzc2luZyBpbiBzcGFyc2UgYXJyYXlzXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoIGkgaW4gYXJyYXkgJiYgYXJyYXlbIGkgXSA9PT0gZWxlbSApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gaTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIHJldHVybiAtMTtcbiAgICAgICAgICAgIH0sXG5cbiAgICAgICAgICAgIG1lcmdlOiBmdW5jdGlvbiggZmlyc3QsIHNlY29uZCApIHtcbiAgICAgICAgICAgICAgICB2YXIgaSA9IGZpcnN0Lmxlbmd0aCxcbiAgICAgICAgICAgICAgICAgICAgaiA9IDA7XG5cbiAgICAgICAgICAgICAgICBpZiAoIHR5cGVvZiBzZWNvbmQubGVuZ3RoID09PSBcIm51bWJlclwiICkge1xuICAgICAgICAgICAgICAgICAgICBmb3IgKCB2YXIgbCA9IHNlY29uZC5sZW5ndGg7IGogPCBsOyBqKysgKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBmaXJzdFsgaSsrIF0gPSBzZWNvbmRbIGogXTtcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgd2hpbGUgKCBzZWNvbmRbal0gIT09IHVuZGVmaW5lZCApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGZpcnN0WyBpKysgXSA9IHNlY29uZFsgaisrIF07XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBmaXJzdC5sZW5ndGggPSBpO1xuXG4gICAgICAgICAgICAgICAgcmV0dXJuIGZpcnN0O1xuICAgICAgICAgICAgfSxcblxuICAgICAgICAgICAgZ3JlcDogZnVuY3Rpb24oIGVsZW1zLCBjYWxsYmFjaywgaW52ICkge1xuICAgICAgICAgICAgICAgIHZhciByZXQgPSBbXSwgcmV0VmFsO1xuICAgICAgICAgICAgICAgIGludiA9ICEhaW52O1xuXG4gICAgICAgICAgICAgICAgLy8gR28gdGhyb3VnaCB0aGUgYXJyYXksIG9ubHkgc2F2aW5nIHRoZSBpdGVtc1xuICAgICAgICAgICAgICAgIC8vIHRoYXQgcGFzcyB0aGUgdmFsaWRhdG9yIGZ1bmN0aW9uXG4gICAgICAgICAgICAgICAgZm9yICggdmFyIGkgPSAwLCBsZW5ndGggPSBlbGVtcy5sZW5ndGg7IGkgPCBsZW5ndGg7IGkrKyApIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0VmFsID0gISFjYWxsYmFjayggZWxlbXNbIGkgXSwgaSApO1xuICAgICAgICAgICAgICAgICAgICBpZiAoIGludiAhPT0gcmV0VmFsICkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0LnB1c2goIGVsZW1zWyBpIF0gKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIHJldHVybiByZXQ7XG4gICAgICAgICAgICB9LFxuXG4gICAgICAgICAgICAvLyBhcmcgaXMgZm9yIGludGVybmFsIHVzYWdlIG9ubHlcbiAgICAgICAgICAgIG1hcDogZnVuY3Rpb24oIGVsZW1zLCBjYWxsYmFjaywgYXJnICkge1xuICAgICAgICAgICAgICAgIHZhciB2YWx1ZSwga2V5LCByZXQgPSBbXSxcbiAgICAgICAgICAgICAgICAgICAgaSA9IDAsXG4gICAgICAgICAgICAgICAgICAgIGxlbmd0aCA9IGVsZW1zLmxlbmd0aCxcbiAgICAgICAgICAgICAgICAvLyBqcXVlcnkgb2JqZWN0cyBhcmUgdHJlYXRlZCBhcyBhcnJheXNcbiAgICAgICAgICAgICAgICAgICAgaXNBcnJheSA9IGVsZW1zIGluc3RhbmNlb2YgalF1ZXJ5IHx8IGxlbmd0aCAhPT0gdW5kZWZpbmVkICYmIHR5cGVvZiBsZW5ndGggPT09IFwibnVtYmVyXCIgJiYgKCAoIGxlbmd0aCA+IDAgJiYgZWxlbXNbIDAgXSAmJiBlbGVtc1sgbGVuZ3RoIC0xIF0gKSB8fCBsZW5ndGggPT09IDAgfHwgalF1ZXJ5LmlzQXJyYXkoIGVsZW1zICkgKSA7XG5cbiAgICAgICAgICAgICAgICAvLyBHbyB0aHJvdWdoIHRoZSBhcnJheSwgdHJhbnNsYXRpbmcgZWFjaCBvZiB0aGUgaXRlbXMgdG8gdGhlaXJcbiAgICAgICAgICAgICAgICBpZiAoIGlzQXJyYXkgKSB7XG4gICAgICAgICAgICAgICAgICAgIGZvciAoIDsgaSA8IGxlbmd0aDsgaSsrICkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWUgPSBjYWxsYmFjayggZWxlbXNbIGkgXSwgaSwgYXJnICk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICggdmFsdWUgIT0gbnVsbCApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXRbIHJldC5sZW5ndGggXSA9IHZhbHVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgLy8gR28gdGhyb3VnaCBldmVyeSBrZXkgb24gdGhlIG9iamVjdCxcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBmb3IgKCBrZXkgaW4gZWxlbXMgKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZSA9IGNhbGxiYWNrKCBlbGVtc1sga2V5IF0sIGtleSwgYXJnICk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICggdmFsdWUgIT0gbnVsbCApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXRbIHJldC5sZW5ndGggXSA9IHZhbHVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgLy8gRmxhdHRlbiBhbnkgbmVzdGVkIGFycmF5c1xuICAgICAgICAgICAgICAgIHJldHVybiByZXQuY29uY2F0LmFwcGx5KCBbXSwgcmV0ICk7XG4gICAgICAgICAgICB9LFxuXG4gICAgICAgICAgICAvLyBBIGdsb2JhbCBHVUlEIGNvdW50ZXIgZm9yIG9iamVjdHNcbiAgICAgICAgICAgIGd1aWQ6IDEsXG5cbiAgICAgICAgICAgIC8vIEJpbmQgYSBmdW5jdGlvbiB0byBhIGNvbnRleHQsIG9wdGlvbmFsbHkgcGFydGlhbGx5IGFwcGx5aW5nIGFueVxuICAgICAgICAgICAgLy8gYXJndW1lbnRzLlxuICAgICAgICAgICAgcHJveHk6IGZ1bmN0aW9uKCBmbiwgY29udGV4dCApIHtcbiAgICAgICAgICAgICAgICBpZiAoIHR5cGVvZiBjb250ZXh0ID09PSBcInN0cmluZ1wiICkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgdG1wID0gZm5bIGNvbnRleHQgXTtcbiAgICAgICAgICAgICAgICAgICAgY29udGV4dCA9IGZuO1xuICAgICAgICAgICAgICAgICAgICBmbiA9IHRtcDtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAvLyBRdWljayBjaGVjayB0byBkZXRlcm1pbmUgaWYgdGFyZ2V0IGlzIGNhbGxhYmxlLCBpbiB0aGUgc3BlY1xuICAgICAgICAgICAgICAgIC8vIHRoaXMgdGhyb3dzIGEgVHlwZUVycm9yLCBidXQgd2Ugd2lsbCBqdXN0IHJldHVybiB1bmRlZmluZWQuXG4gICAgICAgICAgICAgICAgaWYgKCAhalF1ZXJ5LmlzRnVuY3Rpb24oIGZuICkgKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB1bmRlZmluZWQ7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgLy8gU2ltdWxhdGVkIGJpbmRcbiAgICAgICAgICAgICAgICB2YXIgYXJncyA9IHNsaWNlLmNhbGwoIGFyZ3VtZW50cywgMiApLFxuICAgICAgICAgICAgICAgICAgICBwcm94eSA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZuLmFwcGx5KCBjb250ZXh0LCBhcmdzLmNvbmNhdCggc2xpY2UuY2FsbCggYXJndW1lbnRzICkgKSApO1xuICAgICAgICAgICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAgICAgLy8gU2V0IHRoZSBndWlkIG9mIHVuaXF1ZSBoYW5kbGVyIHRvIHRoZSBzYW1lIG9mIG9yaWdpbmFsIGhhbmRsZXIsIHNvIGl0IGNhbiBiZSByZW1vdmVkXG4gICAgICAgICAgICAgICAgcHJveHkuZ3VpZCA9IGZuLmd1aWQgPSBmbi5ndWlkIHx8IHByb3h5Lmd1aWQgfHwgalF1ZXJ5Lmd1aWQrKztcblxuICAgICAgICAgICAgICAgIHJldHVybiBwcm94eTtcbiAgICAgICAgICAgIH0sXG5cbiAgICAgICAgICAgIC8vIE11dGlmdW5jdGlvbmFsIG1ldGhvZCB0byBnZXQgYW5kIHNldCB2YWx1ZXMgdG8gYSBjb2xsZWN0aW9uXG4gICAgICAgICAgICAvLyBUaGUgdmFsdWUvcyBjYW4gb3B0aW9uYWxseSBiZSBleGVjdXRlZCBpZiBpdCdzIGEgZnVuY3Rpb25cbiAgICAgICAgICAgIGFjY2VzczogZnVuY3Rpb24oIGVsZW1zLCBrZXksIHZhbHVlLCBleGVjLCBmbiwgcGFzcyApIHtcbiAgICAgICAgICAgICAgICB2YXIgbGVuZ3RoID0gZWxlbXMubGVuZ3RoO1xuXG4gICAgICAgICAgICAgICAgLy8gU2V0dGluZyBtYW55IGF0dHJpYnV0ZXNcbiAgICAgICAgICAgICAgICBpZiAoIHR5cGVvZiBrZXkgPT09IFwib2JqZWN0XCIgKSB7XG4gICAgICAgICAgICAgICAgICAgIGZvciAoIHZhciBrIGluIGtleSApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGpRdWVyeS5hY2Nlc3MoIGVsZW1zLCBrLCBrZXlba10sIGV4ZWMsIGZuLCB2YWx1ZSApO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBlbGVtcztcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAvLyBTZXR0aW5nIG9uZSBhdHRyaWJ1dGVcbiAgICAgICAgICAgICAgICBpZiAoIHZhbHVlICE9PSB1bmRlZmluZWQgKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIE9wdGlvbmFsbHksIGZ1bmN0aW9uIHZhbHVlcyBnZXQgZXhlY3V0ZWQgaWYgZXhlYyBpcyB0cnVlXG4gICAgICAgICAgICAgICAgICAgIGV4ZWMgPSAhcGFzcyAmJiBleGVjICYmIGpRdWVyeS5pc0Z1bmN0aW9uKHZhbHVlKTtcblxuICAgICAgICAgICAgICAgICAgICBmb3IgKCB2YXIgaSA9IDA7IGkgPCBsZW5ndGg7IGkrKyApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGZuKCBlbGVtc1tpXSwga2V5LCBleGVjID8gdmFsdWUuY2FsbCggZWxlbXNbaV0sIGksIGZuKCBlbGVtc1tpXSwga2V5ICkgKSA6IHZhbHVlLCBwYXNzICk7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZWxlbXM7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgLy8gR2V0dGluZyBhbiBhdHRyaWJ1dGVcbiAgICAgICAgICAgICAgICByZXR1cm4gbGVuZ3RoID8gZm4oIGVsZW1zWzBdLCBrZXkgKSA6IHVuZGVmaW5lZDtcbiAgICAgICAgICAgIH0sXG5cbiAgICAgICAgICAgIG5vdzogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuICggbmV3IERhdGUoKSApLmdldFRpbWUoKTtcbiAgICAgICAgICAgIH0sXG5cbiAgICAgICAgICAgIC8vIFVzZSBvZiBqUXVlcnkuYnJvd3NlciBpcyBmcm93bmVkIHVwb24uXG4gICAgICAgICAgICAvLyBNb3JlIGRldGFpbHM6IGh0dHA6Ly9kb2NzLmpxdWVyeS5jb20vVXRpbGl0aWVzL2pRdWVyeS5icm93c2VyXG4gICAgICAgICAgICB1YU1hdGNoOiBmdW5jdGlvbiggdWEgKSB7XG4gICAgICAgICAgICAgICAgdWEgPSB1YS50b0xvd2VyQ2FzZSgpO1xuXG4gICAgICAgICAgICAgICAgdmFyIG1hdGNoID0gcndlYmtpdC5leGVjKCB1YSApIHx8XG4gICAgICAgICAgICAgICAgICAgIHJvcGVyYS5leGVjKCB1YSApIHx8XG4gICAgICAgICAgICAgICAgICAgIHJtc2llLmV4ZWMoIHVhICkgfHxcbiAgICAgICAgICAgICAgICAgICAgdWEuaW5kZXhPZihcImNvbXBhdGlibGVcIikgPCAwICYmIHJtb3ppbGxhLmV4ZWMoIHVhICkgfHxcbiAgICAgICAgICAgICAgICAgICAgW107XG5cbiAgICAgICAgICAgICAgICByZXR1cm4geyBicm93c2VyOiBtYXRjaFsxXSB8fCBcIlwiLCB2ZXJzaW9uOiBtYXRjaFsyXSB8fCBcIjBcIiB9O1xuICAgICAgICAgICAgfSxcblxuICAgICAgICAgICAgc3ViOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICBmdW5jdGlvbiBqUXVlcnlTdWIoIHNlbGVjdG9yLCBjb250ZXh0ICkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gbmV3IGpRdWVyeVN1Yi5mbi5pbml0KCBzZWxlY3RvciwgY29udGV4dCApO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBqUXVlcnkuZXh0ZW5kKCB0cnVlLCBqUXVlcnlTdWIsIHRoaXMgKTtcbiAgICAgICAgICAgICAgICBqUXVlcnlTdWIuc3VwZXJjbGFzcyA9IHRoaXM7XG4gICAgICAgICAgICAgICAgalF1ZXJ5U3ViLmZuID0galF1ZXJ5U3ViLnByb3RvdHlwZSA9IHRoaXMoKTtcbiAgICAgICAgICAgICAgICBqUXVlcnlTdWIuZm4uY29uc3RydWN0b3IgPSBqUXVlcnlTdWI7XG4gICAgICAgICAgICAgICAgalF1ZXJ5U3ViLnN1YiA9IHRoaXMuc3ViO1xuICAgICAgICAgICAgICAgIGpRdWVyeVN1Yi5mbi5pbml0ID0gZnVuY3Rpb24gaW5pdCggc2VsZWN0b3IsIGNvbnRleHQgKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICggY29udGV4dCAmJiBjb250ZXh0IGluc3RhbmNlb2YgalF1ZXJ5ICYmICEoY29udGV4dCBpbnN0YW5jZW9mIGpRdWVyeVN1YikgKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb250ZXh0ID0galF1ZXJ5U3ViKCBjb250ZXh0ICk7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICByZXR1cm4galF1ZXJ5LmZuLmluaXQuY2FsbCggdGhpcywgc2VsZWN0b3IsIGNvbnRleHQsIHJvb3RqUXVlcnlTdWIgKTtcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIGpRdWVyeVN1Yi5mbi5pbml0LnByb3RvdHlwZSA9IGpRdWVyeVN1Yi5mbjtcbiAgICAgICAgICAgICAgICB2YXIgcm9vdGpRdWVyeVN1YiA9IGpRdWVyeVN1Yihkb2N1bWVudCk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGpRdWVyeVN1YjtcbiAgICAgICAgICAgIH0sXG5cbiAgICAgICAgICAgIGJyb3dzZXI6IHt9XG4gICAgICAgIH0pO1xuXG4vLyBQb3B1bGF0ZSB0aGUgY2xhc3MydHlwZSBtYXBcbiAgICAgICAgalF1ZXJ5LmVhY2goXCJCb29sZWFuIE51bWJlciBTdHJpbmcgRnVuY3Rpb24gQXJyYXkgRGF0ZSBSZWdFeHAgT2JqZWN0XCIuc3BsaXQoXCIgXCIpLCBmdW5jdGlvbihpLCBuYW1lKSB7XG4gICAgICAgICAgICBjbGFzczJ0eXBlWyBcIltvYmplY3QgXCIgKyBuYW1lICsgXCJdXCIgXSA9IG5hbWUudG9Mb3dlckNhc2UoKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgYnJvd3Nlck1hdGNoID0galF1ZXJ5LnVhTWF0Y2goIHVzZXJBZ2VudCApO1xuICAgICAgICBpZiAoIGJyb3dzZXJNYXRjaC5icm93c2VyICkge1xuICAgICAgICAgICAgalF1ZXJ5LmJyb3dzZXJbIGJyb3dzZXJNYXRjaC5icm93c2VyIF0gPSB0cnVlO1xuICAgICAgICAgICAgalF1ZXJ5LmJyb3dzZXIudmVyc2lvbiA9IGJyb3dzZXJNYXRjaC52ZXJzaW9uO1xuICAgICAgICB9XG5cbi8vIERlcHJlY2F0ZWQsIHVzZSBqUXVlcnkuYnJvd3Nlci53ZWJraXQgaW5zdGVhZFxuICAgICAgICBpZiAoIGpRdWVyeS5icm93c2VyLndlYmtpdCApIHtcbiAgICAgICAgICAgIGpRdWVyeS5icm93c2VyLnNhZmFyaSA9IHRydWU7XG4gICAgICAgIH1cblxuLy8gSUUgZG9lc24ndCBtYXRjaCBub24tYnJlYWtpbmcgc3BhY2VzIHdpdGggXFxzXG4gICAgICAgIGlmICggcm5vdHdoaXRlLnRlc3QoIFwiXFx4QTBcIiApICkge1xuICAgICAgICAgICAgdHJpbUxlZnQgPSAvXltcXHNcXHhBMF0rLztcbiAgICAgICAgICAgIHRyaW1SaWdodCA9IC9bXFxzXFx4QTBdKyQvO1xuICAgICAgICB9XG5cbi8vIEFsbCBqUXVlcnkgb2JqZWN0cyBzaG91bGQgcG9pbnQgYmFjayB0byB0aGVzZVxuICAgICAgICByb290alF1ZXJ5ID0galF1ZXJ5KGRvY3VtZW50KTtcblxuLy8gQ2xlYW51cCBmdW5jdGlvbnMgZm9yIHRoZSBkb2N1bWVudCByZWFkeSBtZXRob2RcbiAgICAgICAgaWYgKCBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyICkge1xuICAgICAgICAgICAgRE9NQ29udGVudExvYWRlZCA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIGRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoIFwiRE9NQ29udGVudExvYWRlZFwiLCBET01Db250ZW50TG9hZGVkLCBmYWxzZSApO1xuICAgICAgICAgICAgICAgIGpRdWVyeS5yZWFkeSgpO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICB9IGVsc2UgaWYgKCBkb2N1bWVudC5hdHRhY2hFdmVudCApIHtcbiAgICAgICAgICAgIERPTUNvbnRlbnRMb2FkZWQgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAvLyBNYWtlIHN1cmUgYm9keSBleGlzdHMsIGF0IGxlYXN0LCBpbiBjYXNlIElFIGdldHMgYSBsaXR0bGUgb3ZlcnplYWxvdXMgKHRpY2tldCAjNTQ0MykuXG4gICAgICAgICAgICAgICAgaWYgKCBkb2N1bWVudC5yZWFkeVN0YXRlID09PSBcImNvbXBsZXRlXCIgKSB7XG4gICAgICAgICAgICAgICAgICAgIGRvY3VtZW50LmRldGFjaEV2ZW50KCBcIm9ucmVhZHlzdGF0ZWNoYW5nZVwiLCBET01Db250ZW50TG9hZGVkICk7XG4gICAgICAgICAgICAgICAgICAgIGpRdWVyeS5yZWFkeSgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH07XG4gICAgICAgIH1cblxuLy8gVGhlIERPTSByZWFkeSBjaGVjayBmb3IgSW50ZXJuZXQgRXhwbG9yZXJcbiAgICAgICAgZnVuY3Rpb24gZG9TY3JvbGxDaGVjaygpIHtcbiAgICAgICAgICAgIGlmICggalF1ZXJ5LmlzUmVhZHkgKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgIC8vIElmIElFIGlzIHVzZWQsIHVzZSB0aGUgdHJpY2sgYnkgRGllZ28gUGVyaW5pXG4gICAgICAgICAgICAgICAgLy8gaHR0cDovL2phdmFzY3JpcHQubndib3guY29tL0lFQ29udGVudExvYWRlZC9cbiAgICAgICAgICAgICAgICBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuZG9TY3JvbGwoXCJsZWZ0XCIpO1xuICAgICAgICAgICAgfSBjYXRjaChlKSB7XG4gICAgICAgICAgICAgICAgc2V0VGltZW91dCggZG9TY3JvbGxDaGVjaywgMSApO1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gYW5kIGV4ZWN1dGUgYW55IHdhaXRpbmcgZnVuY3Rpb25zXG4gICAgICAgICAgICBqUXVlcnkucmVhZHkoKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBqUXVlcnk7XG5cbiAgICB9KSgpO1xuXG5cbi8vIFN0cmluZyB0byBPYmplY3QgZmxhZ3MgZm9ybWF0IGNhY2hlXG4gICAgdmFyIGZsYWdzQ2FjaGUgPSB7fTtcblxuLy8gQ29udmVydCBTdHJpbmctZm9ybWF0dGVkIGZsYWdzIGludG8gT2JqZWN0LWZvcm1hdHRlZCBvbmVzIGFuZCBzdG9yZSBpbiBjYWNoZVxuICAgIGZ1bmN0aW9uIGNyZWF0ZUZsYWdzKCBmbGFncyApIHtcbiAgICAgICAgdmFyIG9iamVjdCA9IGZsYWdzQ2FjaGVbIGZsYWdzIF0gPSB7fSxcbiAgICAgICAgICAgIGksIGxlbmd0aDtcbiAgICAgICAgZmxhZ3MgPSBmbGFncy5zcGxpdCggL1xccysvICk7XG4gICAgICAgIGZvciAoIGkgPSAwLCBsZW5ndGggPSBmbGFncy5sZW5ndGg7IGkgPCBsZW5ndGg7IGkrKyApIHtcbiAgICAgICAgICAgIG9iamVjdFsgZmxhZ3NbaV0gXSA9IHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIG9iamVjdDtcbiAgICB9XG5cbiAgICAvKlxuICAgICAqIENyZWF0ZSBhIGNhbGxiYWNrIGxpc3QgdXNpbmcgdGhlIGZvbGxvd2luZyBwYXJhbWV0ZXJzOlxuICAgICAqXG4gICAgICpcdGZsYWdzOlx0YW4gb3B0aW9uYWwgbGlzdCBvZiBzcGFjZS1zZXBhcmF0ZWQgZmxhZ3MgdGhhdCB3aWxsIGNoYW5nZSBob3dcbiAgICAgKlx0XHRcdHRoZSBjYWxsYmFjayBsaXN0IGJlaGF2ZXNcbiAgICAgKlxuICAgICAqIEJ5IGRlZmF1bHQgYSBjYWxsYmFjayBsaXN0IHdpbGwgYWN0IGxpa2UgYW4gZXZlbnQgY2FsbGJhY2sgbGlzdCBhbmQgY2FuIGJlXG4gICAgICogXCJmaXJlZFwiIG11bHRpcGxlIHRpbWVzLlxuICAgICAqXG4gICAgICogUG9zc2libGUgZmxhZ3M6XG4gICAgICpcbiAgICAgKlx0b25jZTpcdFx0XHR3aWxsIGVuc3VyZSB0aGUgY2FsbGJhY2sgbGlzdCBjYW4gb25seSBiZSBmaXJlZCBvbmNlIChsaWtlIGEgRGVmZXJyZWQpXG4gICAgICpcbiAgICAgKlx0bWVtb3J5Olx0XHRcdHdpbGwga2VlcCB0cmFjayBvZiBwcmV2aW91cyB2YWx1ZXMgYW5kIHdpbGwgY2FsbCBhbnkgY2FsbGJhY2sgYWRkZWRcbiAgICAgKlx0XHRcdFx0XHRhZnRlciB0aGUgbGlzdCBoYXMgYmVlbiBmaXJlZCByaWdodCBhd2F5IHdpdGggdGhlIGxhdGVzdCBcIm1lbW9yaXplZFwiXG4gICAgICpcdFx0XHRcdFx0dmFsdWVzIChsaWtlIGEgRGVmZXJyZWQpXG4gICAgICpcbiAgICAgKlx0dW5pcXVlOlx0XHRcdHdpbGwgZW5zdXJlIGEgY2FsbGJhY2sgY2FuIG9ubHkgYmUgYWRkZWQgb25jZSAobm8gZHVwbGljYXRlIGluIHRoZSBsaXN0KVxuICAgICAqXG4gICAgICpcdHN0b3BPbkZhbHNlOlx0aW50ZXJydXB0IGNhbGxpbmdzIHdoZW4gYSBjYWxsYmFjayByZXR1cm5zIGZhbHNlXG4gICAgICpcbiAgICAgKi9cbiAgICBqUXVlcnkuQ2FsbGJhY2tzID0gZnVuY3Rpb24oIGZsYWdzICkge1xuXG4gICAgICAgIC8vIENvbnZlcnQgZmxhZ3MgZnJvbSBTdHJpbmctZm9ybWF0dGVkIHRvIE9iamVjdC1mb3JtYXR0ZWRcbiAgICAgICAgLy8gKHdlIGNoZWNrIGluIGNhY2hlIGZpcnN0KVxuICAgICAgICBmbGFncyA9IGZsYWdzID8gKCBmbGFnc0NhY2hlWyBmbGFncyBdIHx8IGNyZWF0ZUZsYWdzKCBmbGFncyApICkgOiB7fTtcblxuICAgICAgICB2YXIgLy8gQWN0dWFsIGNhbGxiYWNrIGxpc3RcbiAgICAgICAgICAgIGxpc3QgPSBbXSxcbiAgICAgICAgLy8gU3RhY2sgb2YgZmlyZSBjYWxscyBmb3IgcmVwZWF0YWJsZSBsaXN0c1xuICAgICAgICAgICAgc3RhY2sgPSBbXSxcbiAgICAgICAgLy8gTGFzdCBmaXJlIHZhbHVlIChmb3Igbm9uLWZvcmdldHRhYmxlIGxpc3RzKVxuICAgICAgICAgICAgbWVtb3J5LFxuICAgICAgICAvLyBGbGFnIHRvIGtub3cgaWYgbGlzdCBpcyBjdXJyZW50bHkgZmlyaW5nXG4gICAgICAgICAgICBmaXJpbmcsXG4gICAgICAgIC8vIEZpcnN0IGNhbGxiYWNrIHRvIGZpcmUgKHVzZWQgaW50ZXJuYWxseSBieSBhZGQgYW5kIGZpcmVXaXRoKVxuICAgICAgICAgICAgZmlyaW5nU3RhcnQsXG4gICAgICAgIC8vIEVuZCBvZiB0aGUgbG9vcCB3aGVuIGZpcmluZ1xuICAgICAgICAgICAgZmlyaW5nTGVuZ3RoLFxuICAgICAgICAvLyBJbmRleCBvZiBjdXJyZW50bHkgZmlyaW5nIGNhbGxiYWNrIChtb2RpZmllZCBieSByZW1vdmUgaWYgbmVlZGVkKVxuICAgICAgICAgICAgZmlyaW5nSW5kZXgsXG4gICAgICAgIC8vIEFkZCBvbmUgb3Igc2V2ZXJhbCBjYWxsYmFja3MgdG8gdGhlIGxpc3RcbiAgICAgICAgICAgIGFkZCA9IGZ1bmN0aW9uKCBhcmdzICkge1xuICAgICAgICAgICAgICAgIHZhciBpLFxuICAgICAgICAgICAgICAgICAgICBsZW5ndGgsXG4gICAgICAgICAgICAgICAgICAgIGVsZW0sXG4gICAgICAgICAgICAgICAgICAgIHR5cGUsXG4gICAgICAgICAgICAgICAgICAgIGFjdHVhbDtcbiAgICAgICAgICAgICAgICBmb3IgKCBpID0gMCwgbGVuZ3RoID0gYXJncy5sZW5ndGg7IGkgPCBsZW5ndGg7IGkrKyApIHtcbiAgICAgICAgICAgICAgICAgICAgZWxlbSA9IGFyZ3NbIGkgXTtcbiAgICAgICAgICAgICAgICAgICAgdHlwZSA9IGpRdWVyeS50eXBlKCBlbGVtICk7XG4gICAgICAgICAgICAgICAgICAgIGlmICggdHlwZSA9PT0gXCJhcnJheVwiICkge1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gSW5zcGVjdCByZWN1cnNpdmVseVxuICAgICAgICAgICAgICAgICAgICAgICAgYWRkKCBlbGVtICk7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoIHR5cGUgPT09IFwiZnVuY3Rpb25cIiApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIEFkZCBpZiBub3QgaW4gdW5pcXVlIG1vZGUgYW5kIGNhbGxiYWNrIGlzIG5vdCBpblxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCAhZmxhZ3MudW5pcXVlIHx8ICFzZWxmLmhhcyggZWxlbSApICkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxpc3QucHVzaCggZWxlbSApO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSxcbiAgICAgICAgLy8gRmlyZSBjYWxsYmFja3NcbiAgICAgICAgICAgIGZpcmUgPSBmdW5jdGlvbiggY29udGV4dCwgYXJncyApIHtcbiAgICAgICAgICAgICAgICBhcmdzID0gYXJncyB8fCBbXTtcbiAgICAgICAgICAgICAgICBtZW1vcnkgPSAhZmxhZ3MubWVtb3J5IHx8IFsgY29udGV4dCwgYXJncyBdO1xuICAgICAgICAgICAgICAgIGZpcmluZyA9IHRydWU7XG4gICAgICAgICAgICAgICAgZmlyaW5nSW5kZXggPSBmaXJpbmdTdGFydCB8fCAwO1xuICAgICAgICAgICAgICAgIGZpcmluZ1N0YXJ0ID0gMDtcbiAgICAgICAgICAgICAgICBmaXJpbmdMZW5ndGggPSBsaXN0Lmxlbmd0aDtcbiAgICAgICAgICAgICAgICBmb3IgKCA7IGxpc3QgJiYgZmlyaW5nSW5kZXggPCBmaXJpbmdMZW5ndGg7IGZpcmluZ0luZGV4KysgKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICggbGlzdFsgZmlyaW5nSW5kZXggXS5hcHBseSggY29udGV4dCwgYXJncyApID09PSBmYWxzZSAmJiBmbGFncy5zdG9wT25GYWxzZSApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG1lbW9yeSA9IHRydWU7IC8vIE1hcmsgYXMgaGFsdGVkXG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBmaXJpbmcgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICBpZiAoIGxpc3QgKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICggIWZsYWdzLm9uY2UgKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoIHN0YWNrICYmIHN0YWNrLmxlbmd0aCApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtZW1vcnkgPSBzdGFjay5zaGlmdCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuZmlyZVdpdGgoIG1lbW9yeVsgMCBdLCBtZW1vcnlbIDEgXSApO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKCBtZW1vcnkgPT09IHRydWUgKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmRpc2FibGUoKTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGxpc3QgPSBbXTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgIC8vIEFjdHVhbCBDYWxsYmFja3Mgb2JqZWN0XG4gICAgICAgICAgICBzZWxmID0ge1xuICAgICAgICAgICAgICAgIC8vIEFkZCBhIGNhbGxiYWNrIG9yIGEgY29sbGVjdGlvbiBvZiBjYWxsYmFja3MgdG8gdGhlIGxpc3RcbiAgICAgICAgICAgICAgICBhZGQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoIGxpc3QgKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgbGVuZ3RoID0gbGlzdC5sZW5ndGg7XG4gICAgICAgICAgICAgICAgICAgICAgICBhZGQoIGFyZ3VtZW50cyApO1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gRG8gd2UgbmVlZCB0byBhZGQgdGhlIGNhbGxiYWNrcyB0byB0aGVcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIGN1cnJlbnQgZmlyaW5nIGJhdGNoP1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCBmaXJpbmcgKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlyaW5nTGVuZ3RoID0gbGlzdC5sZW5ndGg7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gV2l0aCBtZW1vcnksIGlmIHdlJ3JlIG5vdCBmaXJpbmcgdGhlblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIHdlIHNob3VsZCBjYWxsIHJpZ2h0IGF3YXksIHVubGVzcyBwcmV2aW91c1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGZpcmluZyB3YXMgaGFsdGVkIChzdG9wT25GYWxzZSlcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoIG1lbW9yeSAmJiBtZW1vcnkgIT09IHRydWUgKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlyaW5nU3RhcnQgPSBsZW5ndGg7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlyZSggbWVtb3J5WyAwIF0sIG1lbW9yeVsgMSBdICk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAvLyBSZW1vdmUgYSBjYWxsYmFjayBmcm9tIHRoZSBsaXN0XG4gICAgICAgICAgICAgICAgcmVtb3ZlOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCBsaXN0ICkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGFyZ3MgPSBhcmd1bWVudHMsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYXJnSW5kZXggPSAwLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFyZ0xlbmd0aCA9IGFyZ3MubGVuZ3RoO1xuICAgICAgICAgICAgICAgICAgICAgICAgZm9yICggOyBhcmdJbmRleCA8IGFyZ0xlbmd0aCA7IGFyZ0luZGV4KysgKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yICggdmFyIGkgPSAwOyBpIDwgbGlzdC5sZW5ndGg7IGkrKyApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCBhcmdzWyBhcmdJbmRleCBdID09PSBsaXN0WyBpIF0gKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBIYW5kbGUgZmlyaW5nSW5kZXggYW5kIGZpcmluZ0xlbmd0aFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCBmaXJpbmcgKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCBpIDw9IGZpcmluZ0xlbmd0aCApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlyaW5nTGVuZ3RoLS07XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICggaSA8PSBmaXJpbmdJbmRleCApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpcmluZ0luZGV4LS07XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBSZW1vdmUgdGhlIGVsZW1lbnRcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxpc3Quc3BsaWNlKCBpLS0sIDEgKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIElmIHdlIGhhdmUgc29tZSB1bmljaXR5IHByb3BlcnR5IHRoZW5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIHdlIG9ubHkgbmVlZCB0byBkbyB0aGlzIG9uY2VcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICggZmxhZ3MudW5pcXVlICkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzO1xuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgLy8gQ29udHJvbCBpZiBhIGdpdmVuIGNhbGxiYWNrIGlzIGluIHRoZSBsaXN0XG4gICAgICAgICAgICAgICAgaGFzOiBmdW5jdGlvbiggZm4gKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICggbGlzdCApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBpID0gMCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZW5ndGggPSBsaXN0Lmxlbmd0aDtcbiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoIDsgaSA8IGxlbmd0aDsgaSsrICkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICggZm4gPT09IGxpc3RbIGkgXSApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIC8vIFJlbW92ZSBhbGwgY2FsbGJhY2tzIGZyb20gdGhlIGxpc3RcbiAgICAgICAgICAgICAgICBlbXB0eTogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgIGxpc3QgPSBbXTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAvLyBIYXZlIHRoZSBsaXN0IGRvIG5vdGhpbmcgYW55bW9yZVxuICAgICAgICAgICAgICAgIGRpc2FibGU6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICBsaXN0ID0gc3RhY2sgPSBtZW1vcnkgPSB1bmRlZmluZWQ7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzO1xuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgLy8gSXMgaXQgZGlzYWJsZWQ/XG4gICAgICAgICAgICAgICAgZGlzYWJsZWQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gIWxpc3Q7XG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAvLyBMb2NrIHRoZSBsaXN0IGluIGl0cyBjdXJyZW50IHN0YXRlXG4gICAgICAgICAgICAgICAgbG9jazogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgIHN0YWNrID0gdW5kZWZpbmVkO1xuICAgICAgICAgICAgICAgICAgICBpZiAoICFtZW1vcnkgfHwgbWVtb3J5ID09PSB0cnVlICkge1xuICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5kaXNhYmxlKCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAvLyBJcyBpdCBsb2NrZWQ/XG4gICAgICAgICAgICAgICAgbG9ja2VkOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICFzdGFjaztcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIC8vIENhbGwgYWxsIGNhbGxiYWNrcyB3aXRoIHRoZSBnaXZlbiBjb250ZXh0IGFuZCBhcmd1bWVudHNcbiAgICAgICAgICAgICAgICBmaXJlV2l0aDogZnVuY3Rpb24oIGNvbnRleHQsIGFyZ3MgKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICggc3RhY2sgKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoIGZpcmluZyApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoICFmbGFncy5vbmNlICkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGFjay5wdXNoKCBbIGNvbnRleHQsIGFyZ3MgXSApO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoICEoIGZsYWdzLm9uY2UgJiYgbWVtb3J5ICkgKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlyZSggY29udGV4dCwgYXJncyApO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzO1xuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgLy8gQ2FsbCBhbGwgdGhlIGNhbGxiYWNrcyB3aXRoIHRoZSBnaXZlbiBhcmd1bWVudHNcbiAgICAgICAgICAgICAgICBmaXJlOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgc2VsZi5maXJlV2l0aCggdGhpcywgYXJndW1lbnRzICk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzO1xuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgLy8gVG8ga25vdyBpZiB0aGUgY2FsbGJhY2tzIGhhdmUgYWxyZWFkeSBiZWVuIGNhbGxlZCBhdCBsZWFzdCBvbmNlXG4gICAgICAgICAgICAgICAgZmlyZWQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gISFtZW1vcnk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfTtcblxuICAgICAgICByZXR1cm4gc2VsZjtcbiAgICB9O1xuXG5cblxuXG4gICAgdmFyIC8vIFN0YXRpYyByZWZlcmVuY2UgdG8gc2xpY2VcbiAgICAgICAgc2xpY2VEZWZlcnJlZCA9IFtdLnNsaWNlO1xuXG4gICAgalF1ZXJ5LmV4dGVuZCh7XG5cbiAgICAgICAgRGVmZXJyZWQ6IGZ1bmN0aW9uKCBmdW5jICkge1xuICAgICAgICAgICAgdmFyIGRvbmVMaXN0ID0galF1ZXJ5LkNhbGxiYWNrcyggXCJvbmNlIG1lbW9yeVwiICksXG4gICAgICAgICAgICAgICAgZmFpbExpc3QgPSBqUXVlcnkuQ2FsbGJhY2tzKCBcIm9uY2UgbWVtb3J5XCIgKSxcbiAgICAgICAgICAgICAgICBwcm9ncmVzc0xpc3QgPSBqUXVlcnkuQ2FsbGJhY2tzKCBcIm1lbW9yeVwiICksXG4gICAgICAgICAgICAgICAgc3RhdGUgPSBcInBlbmRpbmdcIixcbiAgICAgICAgICAgICAgICBsaXN0cyA9IHtcbiAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZTogZG9uZUxpc3QsXG4gICAgICAgICAgICAgICAgICAgIHJlamVjdDogZmFpbExpc3QsXG4gICAgICAgICAgICAgICAgICAgIG5vdGlmeTogcHJvZ3Jlc3NMaXN0XG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBwcm9taXNlID0ge1xuICAgICAgICAgICAgICAgICAgICBkb25lOiBkb25lTGlzdC5hZGQsXG4gICAgICAgICAgICAgICAgICAgIGZhaWw6IGZhaWxMaXN0LmFkZCxcbiAgICAgICAgICAgICAgICAgICAgcHJvZ3Jlc3M6IHByb2dyZXNzTGlzdC5hZGQsXG5cbiAgICAgICAgICAgICAgICAgICAgc3RhdGU6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHN0YXRlO1xuICAgICAgICAgICAgICAgICAgICB9LFxuXG4gICAgICAgICAgICAgICAgICAgIC8vIERlcHJlY2F0ZWRcbiAgICAgICAgICAgICAgICAgICAgaXNSZXNvbHZlZDogZG9uZUxpc3QuZmlyZWQsXG4gICAgICAgICAgICAgICAgICAgIGlzUmVqZWN0ZWQ6IGZhaWxMaXN0LmZpcmVkLFxuXG4gICAgICAgICAgICAgICAgICAgIHRoZW46IGZ1bmN0aW9uKCBkb25lQ2FsbGJhY2tzLCBmYWlsQ2FsbGJhY2tzLCBwcm9ncmVzc0NhbGxiYWNrcyApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGRlZmVycmVkLmRvbmUoIGRvbmVDYWxsYmFja3MgKS5mYWlsKCBmYWlsQ2FsbGJhY2tzICkucHJvZ3Jlc3MoIHByb2dyZXNzQ2FsbGJhY2tzICk7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcztcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgYWx3YXlzOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGRlZmVycmVkLmRvbmUuYXBwbHkoIGRlZmVycmVkLCBhcmd1bWVudHMgKS5mYWlsLmFwcGx5KCBkZWZlcnJlZCwgYXJndW1lbnRzICk7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcztcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgcGlwZTogZnVuY3Rpb24oIGZuRG9uZSwgZm5GYWlsLCBmblByb2dyZXNzICkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGpRdWVyeS5EZWZlcnJlZChmdW5jdGlvbiggbmV3RGVmZXIgKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgalF1ZXJ5LmVhY2goIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZG9uZTogWyBmbkRvbmUsIFwicmVzb2x2ZVwiIF0sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZhaWw6IFsgZm5GYWlsLCBcInJlamVjdFwiIF0sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByb2dyZXNzOiBbIGZuUHJvZ3Jlc3MsIFwibm90aWZ5XCIgXVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sIGZ1bmN0aW9uKCBoYW5kbGVyLCBkYXRhICkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgZm4gPSBkYXRhWyAwIF0sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhY3Rpb24gPSBkYXRhWyAxIF0sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm5lZDtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCBqUXVlcnkuaXNGdW5jdGlvbiggZm4gKSApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlZmVycmVkWyBoYW5kbGVyIF0oZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuZWQgPSBmbi5hcHBseSggdGhpcywgYXJndW1lbnRzICk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCByZXR1cm5lZCAmJiBqUXVlcnkuaXNGdW5jdGlvbiggcmV0dXJuZWQucHJvbWlzZSApICkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm5lZC5wcm9taXNlKCkudGhlbiggbmV3RGVmZXIucmVzb2x2ZSwgbmV3RGVmZXIucmVqZWN0LCBuZXdEZWZlci5ub3RpZnkgKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuZXdEZWZlclsgYWN0aW9uICsgXCJXaXRoXCIgXSggdGhpcyA9PT0gZGVmZXJyZWQgPyBuZXdEZWZlciA6IHRoaXMsIFsgcmV0dXJuZWQgXSApO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVmZXJyZWRbIGhhbmRsZXIgXSggbmV3RGVmZXJbIGFjdGlvbiBdICk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pLnByb21pc2UoKTtcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgLy8gR2V0IGEgcHJvbWlzZSBmb3IgdGhpcyBkZWZlcnJlZFxuICAgICAgICAgICAgICAgICAgICAvLyBJZiBvYmogaXMgcHJvdmlkZWQsIHRoZSBwcm9taXNlIGFzcGVjdCBpcyBhZGRlZCB0byB0aGUgb2JqZWN0XG4gICAgICAgICAgICAgICAgICAgIHByb21pc2U6IGZ1bmN0aW9uKCBvYmogKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoIG9iaiA9PSBudWxsICkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9iaiA9IHByb21pc2U7XG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoIHZhciBrZXkgaW4gcHJvbWlzZSApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb2JqWyBrZXkgXSA9IHByb21pc2VbIGtleSBdO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBvYmo7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIGRlZmVycmVkID0gcHJvbWlzZS5wcm9taXNlKHt9KSxcbiAgICAgICAgICAgICAgICBrZXk7XG5cbiAgICAgICAgICAgIGZvciAoIGtleSBpbiBsaXN0cyApIHtcbiAgICAgICAgICAgICAgICBkZWZlcnJlZFsga2V5IF0gPSBsaXN0c1sga2V5IF0uZmlyZTtcbiAgICAgICAgICAgICAgICBkZWZlcnJlZFsga2V5ICsgXCJXaXRoXCIgXSA9IGxpc3RzWyBrZXkgXS5maXJlV2l0aDtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gSGFuZGxlIHN0YXRlXG4gICAgICAgICAgICBkZWZlcnJlZC5kb25lKCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICBzdGF0ZSA9IFwicmVzb2x2ZWRcIjtcbiAgICAgICAgICAgIH0sIGZhaWxMaXN0LmRpc2FibGUsIHByb2dyZXNzTGlzdC5sb2NrICkuZmFpbCggZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgc3RhdGUgPSBcInJlamVjdGVkXCI7XG4gICAgICAgICAgICB9LCBkb25lTGlzdC5kaXNhYmxlLCBwcm9ncmVzc0xpc3QubG9jayApO1xuXG4gICAgICAgICAgICAvLyBDYWxsIGdpdmVuIGZ1bmMgaWYgYW55XG4gICAgICAgICAgICBpZiAoIGZ1bmMgKSB7XG4gICAgICAgICAgICAgICAgZnVuYy5jYWxsKCBkZWZlcnJlZCwgZGVmZXJyZWQgKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gQWxsIGRvbmUhXG4gICAgICAgICAgICByZXR1cm4gZGVmZXJyZWQ7XG4gICAgICAgIH0sXG5cbiAgICAgICAgLy8gRGVmZXJyZWQgaGVscGVyXG4gICAgICAgIHdoZW46IGZ1bmN0aW9uKCBmaXJzdFBhcmFtICkge1xuICAgICAgICAgICAgdmFyIGFyZ3MgPSBzbGljZURlZmVycmVkLmNhbGwoIGFyZ3VtZW50cywgMCApLFxuICAgICAgICAgICAgICAgIGkgPSAwLFxuICAgICAgICAgICAgICAgIGxlbmd0aCA9IGFyZ3MubGVuZ3RoLFxuICAgICAgICAgICAgICAgIHBWYWx1ZXMgPSBuZXcgQXJyYXkoIGxlbmd0aCApLFxuICAgICAgICAgICAgICAgIGNvdW50ID0gbGVuZ3RoLFxuICAgICAgICAgICAgICAgIHBDb3VudCA9IGxlbmd0aCxcbiAgICAgICAgICAgICAgICBkZWZlcnJlZCA9IGxlbmd0aCA8PSAxICYmIGZpcnN0UGFyYW0gJiYgalF1ZXJ5LmlzRnVuY3Rpb24oIGZpcnN0UGFyYW0ucHJvbWlzZSApID9cbiAgICAgICAgICAgICAgICAgICAgZmlyc3RQYXJhbSA6XG4gICAgICAgICAgICAgICAgICAgIGpRdWVyeS5EZWZlcnJlZCgpLFxuICAgICAgICAgICAgICAgIHByb21pc2UgPSBkZWZlcnJlZC5wcm9taXNlKCk7XG4gICAgICAgICAgICBmdW5jdGlvbiByZXNvbHZlRnVuYyggaSApIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZnVuY3Rpb24oIHZhbHVlICkge1xuICAgICAgICAgICAgICAgICAgICBhcmdzWyBpIF0gPSBhcmd1bWVudHMubGVuZ3RoID4gMSA/IHNsaWNlRGVmZXJyZWQuY2FsbCggYXJndW1lbnRzLCAwICkgOiB2YWx1ZTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCAhKCAtLWNvdW50ICkgKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZXNvbHZlV2l0aCggZGVmZXJyZWQsIGFyZ3MgKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBmdW5jdGlvbiBwcm9ncmVzc0Z1bmMoIGkgKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKCB2YWx1ZSApIHtcbiAgICAgICAgICAgICAgICAgICAgcFZhbHVlc1sgaSBdID0gYXJndW1lbnRzLmxlbmd0aCA+IDEgPyBzbGljZURlZmVycmVkLmNhbGwoIGFyZ3VtZW50cywgMCApIDogdmFsdWU7XG4gICAgICAgICAgICAgICAgICAgIGRlZmVycmVkLm5vdGlmeVdpdGgoIHByb21pc2UsIHBWYWx1ZXMgKTtcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKCBsZW5ndGggPiAxICkge1xuICAgICAgICAgICAgICAgIGZvciAoIDsgaSA8IGxlbmd0aDsgaSsrICkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoIGFyZ3NbIGkgXSAmJiBhcmdzWyBpIF0ucHJvbWlzZSAmJiBqUXVlcnkuaXNGdW5jdGlvbiggYXJnc1sgaSBdLnByb21pc2UgKSApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGFyZ3NbIGkgXS5wcm9taXNlKCkudGhlbiggcmVzb2x2ZUZ1bmMoaSksIGRlZmVycmVkLnJlamVjdCwgcHJvZ3Jlc3NGdW5jKGkpICk7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAtLWNvdW50O1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmICggIWNvdW50ICkge1xuICAgICAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZXNvbHZlV2l0aCggZGVmZXJyZWQsIGFyZ3MgKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9IGVsc2UgaWYgKCBkZWZlcnJlZCAhPT0gZmlyc3RQYXJhbSApIHtcbiAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZXNvbHZlV2l0aCggZGVmZXJyZWQsIGxlbmd0aCA/IFsgZmlyc3RQYXJhbSBdIDogW10gKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBwcm9taXNlO1xuICAgICAgICB9XG4gICAgfSk7XG5cblxuXG5cbiAgICBqUXVlcnkuc3VwcG9ydCA9IChmdW5jdGlvbigpIHtcblxuICAgICAgICB2YXIgc3VwcG9ydCxcbiAgICAgICAgICAgIGFsbCxcbiAgICAgICAgICAgIGEsXG4gICAgICAgICAgICBzZWxlY3QsXG4gICAgICAgICAgICBvcHQsXG4gICAgICAgICAgICBpbnB1dCxcbiAgICAgICAgICAgIG1hcmdpbkRpdixcbiAgICAgICAgICAgIGZyYWdtZW50LFxuICAgICAgICAgICAgdGRzLFxuICAgICAgICAgICAgZXZlbnRzLFxuICAgICAgICAgICAgZXZlbnROYW1lLFxuICAgICAgICAgICAgaSxcbiAgICAgICAgICAgIGlzU3VwcG9ydGVkLFxuICAgICAgICAgICAgZGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCggXCJkaXZcIiApLFxuICAgICAgICAgICAgZG9jdW1lbnRFbGVtZW50ID0gZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50O1xuXG4gICAgICAgIC8vIFByZWxpbWluYXJ5IHRlc3RzXG4gICAgICAgIGRpdi5zZXRBdHRyaWJ1dGUoXCJjbGFzc05hbWVcIiwgXCJ0XCIpO1xuICAgICAgICBkaXYuaW5uZXJIVE1MID0gXCIgICA8bGluay8+PHRhYmxlPjwvdGFibGU+PGEgaHJlZj0nL2EnIHN0eWxlPSd0b3A6MXB4O2Zsb2F0OmxlZnQ7b3BhY2l0eTouNTU7Jz5hPC9hPjxpbnB1dCB0eXBlPSdjaGVja2JveCcvPlwiO1xuXG4gICAgICAgIGFsbCA9IGRpdi5nZXRFbGVtZW50c0J5VGFnTmFtZSggXCIqXCIgKTtcbiAgICAgICAgYSA9IGRpdi5nZXRFbGVtZW50c0J5VGFnTmFtZSggXCJhXCIgKVsgMCBdO1xuXG4gICAgICAgIC8vIENhbid0IGdldCBiYXNpYyB0ZXN0IHN1cHBvcnRcbiAgICAgICAgaWYgKCAhYWxsIHx8ICFhbGwubGVuZ3RoIHx8ICFhICkge1xuICAgICAgICAgICAgcmV0dXJuIHt9O1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gRmlyc3QgYmF0Y2ggb2Ygc3VwcG9ydHMgdGVzdHNcbiAgICAgICAgc2VsZWN0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCggXCJzZWxlY3RcIiApO1xuICAgICAgICBvcHQgPSBzZWxlY3QuYXBwZW5kQ2hpbGQoIGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJvcHRpb25cIikgKTtcbiAgICAgICAgaW5wdXQgPSBkaXYuZ2V0RWxlbWVudHNCeVRhZ05hbWUoIFwiaW5wdXRcIiApWyAwIF07XG5cbiAgICAgICAgc3VwcG9ydCA9IHtcbiAgICAgICAgICAgIC8vIElFIHN0cmlwcyBsZWFkaW5nIHdoaXRlc3BhY2Ugd2hlbiAuaW5uZXJIVE1MIGlzIHVzZWRcbiAgICAgICAgICAgIGxlYWRpbmdXaGl0ZXNwYWNlOiAoIGRpdi5maXJzdENoaWxkLm5vZGVUeXBlID09PSAzICksXG5cbiAgICAgICAgICAgIC8vIE1ha2Ugc3VyZSB0aGF0IHRib2R5IGVsZW1lbnRzIGFyZW4ndCBhdXRvbWF0aWNhbGx5IGluc2VydGVkXG4gICAgICAgICAgICAvLyBJRSB3aWxsIGluc2VydCB0aGVtIGludG8gZW1wdHkgdGFibGVzXG4gICAgICAgICAgICB0Ym9keTogIWRpdi5nZXRFbGVtZW50c0J5VGFnTmFtZShcInRib2R5XCIpLmxlbmd0aCxcblxuICAgICAgICAgICAgLy8gTWFrZSBzdXJlIHRoYXQgbGluayBlbGVtZW50cyBnZXQgc2VyaWFsaXplZCBjb3JyZWN0bHkgYnkgaW5uZXJIVE1MXG4gICAgICAgICAgICAvLyBUaGlzIHJlcXVpcmVzIGEgd3JhcHBlciBlbGVtZW50IGluIElFXG4gICAgICAgICAgICBodG1sU2VyaWFsaXplOiAhIWRpdi5nZXRFbGVtZW50c0J5VGFnTmFtZShcImxpbmtcIikubGVuZ3RoLFxuXG4gICAgICAgICAgICAvLyBHZXQgdGhlIHN0eWxlIGluZm9ybWF0aW9uIGZyb20gZ2V0QXR0cmlidXRlXG4gICAgICAgICAgICAvLyAoSUUgdXNlcyAuY3NzVGV4dCBpbnN0ZWFkKVxuICAgICAgICAgICAgc3R5bGU6IC90b3AvLnRlc3QoIGEuZ2V0QXR0cmlidXRlKFwic3R5bGVcIikgKSxcblxuICAgICAgICAgICAgLy8gTWFrZSBzdXJlIHRoYXQgVVJMcyBhcmVuJ3QgbWFuaXB1bGF0ZWRcbiAgICAgICAgICAgIC8vIChJRSBub3JtYWxpemVzIGl0IGJ5IGRlZmF1bHQpXG4gICAgICAgICAgICBocmVmTm9ybWFsaXplZDogKCBhLmdldEF0dHJpYnV0ZShcImhyZWZcIikgPT09IFwiL2FcIiApLFxuXG4gICAgICAgICAgICAvLyBNYWtlIHN1cmUgdGhhdCBlbGVtZW50IG9wYWNpdHkgZXhpc3RzXG4gICAgICAgICAgICAvLyAoSUUgdXNlcyBmaWx0ZXIgaW5zdGVhZClcbiAgICAgICAgICAgIC8vIFVzZSBhIHJlZ2V4IHRvIHdvcmsgYXJvdW5kIGEgV2ViS2l0IGlzc3VlLiBTZWUgIzUxNDVcbiAgICAgICAgICAgIG9wYWNpdHk6IC9eMC41NS8udGVzdCggYS5zdHlsZS5vcGFjaXR5ICksXG5cbiAgICAgICAgICAgIC8vIFZlcmlmeSBzdHlsZSBmbG9hdCBleGlzdGVuY2VcbiAgICAgICAgICAgIC8vIChJRSB1c2VzIHN0eWxlRmxvYXQgaW5zdGVhZCBvZiBjc3NGbG9hdClcbiAgICAgICAgICAgIGNzc0Zsb2F0OiAhIWEuc3R5bGUuY3NzRmxvYXQsXG5cbiAgICAgICAgICAgIC8vIE1ha2Ugc3VyZSB0aGF0IGlmIG5vIHZhbHVlIGlzIHNwZWNpZmllZCBmb3IgYSBjaGVja2JveFxuICAgICAgICAgICAgLy8gdGhhdCBpdCBkZWZhdWx0cyB0byBcIm9uXCIuXG4gICAgICAgICAgICAvLyAoV2ViS2l0IGRlZmF1bHRzIHRvIFwiXCIgaW5zdGVhZClcbiAgICAgICAgICAgIGNoZWNrT246ICggaW5wdXQudmFsdWUgPT09IFwib25cIiApLFxuXG4gICAgICAgICAgICAvLyBNYWtlIHN1cmUgdGhhdCBhIHNlbGVjdGVkLWJ5LWRlZmF1bHQgb3B0aW9uIGhhcyBhIHdvcmtpbmcgc2VsZWN0ZWQgcHJvcGVydHkuXG4gICAgICAgICAgICAvLyAoV2ViS2l0IGRlZmF1bHRzIHRvIGZhbHNlIGluc3RlYWQgb2YgdHJ1ZSwgSUUgdG9vLCBpZiBpdCdzIGluIGFuIG9wdGdyb3VwKVxuICAgICAgICAgICAgb3B0U2VsZWN0ZWQ6IG9wdC5zZWxlY3RlZCxcblxuICAgICAgICAgICAgLy8gVGVzdCBzZXRBdHRyaWJ1dGUgb24gY2FtZWxDYXNlIGNsYXNzLiBJZiBpdCB3b3Jrcywgd2UgbmVlZCBhdHRyRml4ZXMgd2hlbiBkb2luZyBnZXQvc2V0QXR0cmlidXRlIChpZTYvNylcbiAgICAgICAgICAgIGdldFNldEF0dHJpYnV0ZTogZGl2LmNsYXNzTmFtZSAhPT0gXCJ0XCIsXG5cbiAgICAgICAgICAgIC8vIFRlc3RzIGZvciBlbmN0eXBlIHN1cHBvcnQgb24gYSBmb3JtKCM2NzQzKVxuICAgICAgICAgICAgZW5jdHlwZTogISFkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZm9ybVwiKS5lbmN0eXBlLFxuXG4gICAgICAgICAgICAvLyBNYWtlcyBzdXJlIGNsb25pbmcgYW4gaHRtbDUgZWxlbWVudCBkb2VzIG5vdCBjYXVzZSBwcm9ibGVtc1xuICAgICAgICAgICAgLy8gV2hlcmUgb3V0ZXJIVE1MIGlzIHVuZGVmaW5lZCwgdGhpcyBzdGlsbCB3b3Jrc1xuICAgICAgICAgICAgaHRtbDVDbG9uZTogZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcIm5hdlwiKS5jbG9uZU5vZGUoIHRydWUgKS5vdXRlckhUTUwgIT09IFwiPDpuYXY+PC86bmF2PlwiLFxuXG4gICAgICAgICAgICAvLyBXaWxsIGJlIGRlZmluZWQgbGF0ZXJcbiAgICAgICAgICAgIHN1Ym1pdEJ1YmJsZXM6IHRydWUsXG4gICAgICAgICAgICBjaGFuZ2VCdWJibGVzOiB0cnVlLFxuICAgICAgICAgICAgZm9jdXNpbkJ1YmJsZXM6IGZhbHNlLFxuICAgICAgICAgICAgZGVsZXRlRXhwYW5kbzogdHJ1ZSxcbiAgICAgICAgICAgIG5vQ2xvbmVFdmVudDogdHJ1ZSxcbiAgICAgICAgICAgIGlubGluZUJsb2NrTmVlZHNMYXlvdXQ6IGZhbHNlLFxuICAgICAgICAgICAgc2hyaW5rV3JhcEJsb2NrczogZmFsc2UsXG4gICAgICAgICAgICByZWxpYWJsZU1hcmdpblJpZ2h0OiB0cnVlXG4gICAgICAgIH07XG5cbiAgICAgICAgLy8gTWFrZSBzdXJlIGNoZWNrZWQgc3RhdHVzIGlzIHByb3Blcmx5IGNsb25lZFxuICAgICAgICBpbnB1dC5jaGVja2VkID0gdHJ1ZTtcbiAgICAgICAgc3VwcG9ydC5ub0Nsb25lQ2hlY2tlZCA9IGlucHV0LmNsb25lTm9kZSggdHJ1ZSApLmNoZWNrZWQ7XG5cbiAgICAgICAgLy8gTWFrZSBzdXJlIHRoYXQgdGhlIG9wdGlvbnMgaW5zaWRlIGRpc2FibGVkIHNlbGVjdHMgYXJlbid0IG1hcmtlZCBhcyBkaXNhYmxlZFxuICAgICAgICAvLyAoV2ViS2l0IG1hcmtzIHRoZW0gYXMgZGlzYWJsZWQpXG4gICAgICAgIHNlbGVjdC5kaXNhYmxlZCA9IHRydWU7XG4gICAgICAgIHN1cHBvcnQub3B0RGlzYWJsZWQgPSAhb3B0LmRpc2FibGVkO1xuXG4gICAgICAgIC8vIFRlc3QgdG8gc2VlIGlmIGl0J3MgcG9zc2libGUgdG8gZGVsZXRlIGFuIGV4cGFuZG8gZnJvbSBhbiBlbGVtZW50XG4gICAgICAgIC8vIEZhaWxzIGluIEludGVybmV0IEV4cGxvcmVyXG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBkZWxldGUgZGl2LnRlc3Q7XG4gICAgICAgIH0gY2F0Y2goIGUgKSB7XG4gICAgICAgICAgICBzdXBwb3J0LmRlbGV0ZUV4cGFuZG8gPSBmYWxzZTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICggIWRpdi5hZGRFdmVudExpc3RlbmVyICYmIGRpdi5hdHRhY2hFdmVudCAmJiBkaXYuZmlyZUV2ZW50ICkge1xuICAgICAgICAgICAgZGl2LmF0dGFjaEV2ZW50KCBcIm9uY2xpY2tcIiwgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgLy8gQ2xvbmluZyBhIG5vZGUgc2hvdWxkbid0IGNvcHkgb3ZlciBhbnlcbiAgICAgICAgICAgICAgICAvLyBib3VuZCBldmVudCBoYW5kbGVycyAoSUUgZG9lcyB0aGlzKVxuICAgICAgICAgICAgICAgIHN1cHBvcnQubm9DbG9uZUV2ZW50ID0gZmFsc2U7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIGRpdi5jbG9uZU5vZGUoIHRydWUgKS5maXJlRXZlbnQoIFwib25jbGlja1wiICk7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBDaGVjayBpZiBhIHJhZGlvIG1haW50YWlucyBpdHMgdmFsdWVcbiAgICAgICAgLy8gYWZ0ZXIgYmVpbmcgYXBwZW5kZWQgdG8gdGhlIERPTVxuICAgICAgICBpbnB1dCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJpbnB1dFwiKTtcbiAgICAgICAgaW5wdXQudmFsdWUgPSBcInRcIjtcbiAgICAgICAgaW5wdXQuc2V0QXR0cmlidXRlKFwidHlwZVwiLCBcInJhZGlvXCIpO1xuICAgICAgICBzdXBwb3J0LnJhZGlvVmFsdWUgPSBpbnB1dC52YWx1ZSA9PT0gXCJ0XCI7XG5cbiAgICAgICAgaW5wdXQuc2V0QXR0cmlidXRlKFwiY2hlY2tlZFwiLCBcImNoZWNrZWRcIik7XG4gICAgICAgIGRpdi5hcHBlbmRDaGlsZCggaW5wdXQgKTtcbiAgICAgICAgZnJhZ21lbnQgPSBkb2N1bWVudC5jcmVhdGVEb2N1bWVudEZyYWdtZW50KCk7XG4gICAgICAgIGZyYWdtZW50LmFwcGVuZENoaWxkKCBkaXYubGFzdENoaWxkICk7XG5cbiAgICAgICAgLy8gV2ViS2l0IGRvZXNuJ3QgY2xvbmUgY2hlY2tlZCBzdGF0ZSBjb3JyZWN0bHkgaW4gZnJhZ21lbnRzXG4gICAgICAgIHN1cHBvcnQuY2hlY2tDbG9uZSA9IGZyYWdtZW50LmNsb25lTm9kZSggdHJ1ZSApLmNsb25lTm9kZSggdHJ1ZSApLmxhc3RDaGlsZC5jaGVja2VkO1xuXG4gICAgICAgIC8vIENoZWNrIGlmIGEgZGlzY29ubmVjdGVkIGNoZWNrYm94IHdpbGwgcmV0YWluIGl0cyBjaGVja2VkXG4gICAgICAgIC8vIHZhbHVlIG9mIHRydWUgYWZ0ZXIgYXBwZW5kZWQgdG8gdGhlIERPTSAoSUU2LzcpXG4gICAgICAgIHN1cHBvcnQuYXBwZW5kQ2hlY2tlZCA9IGlucHV0LmNoZWNrZWQ7XG5cbiAgICAgICAgZnJhZ21lbnQucmVtb3ZlQ2hpbGQoIGlucHV0ICk7XG4gICAgICAgIGZyYWdtZW50LmFwcGVuZENoaWxkKCBkaXYgKTtcblxuICAgICAgICBkaXYuaW5uZXJIVE1MID0gXCJcIjtcblxuICAgICAgICAvLyBDaGVjayBpZiBkaXYgd2l0aCBleHBsaWNpdCB3aWR0aCBhbmQgbm8gbWFyZ2luLXJpZ2h0IGluY29ycmVjdGx5XG4gICAgICAgIC8vIGdldHMgY29tcHV0ZWQgbWFyZ2luLXJpZ2h0IGJhc2VkIG9uIHdpZHRoIG9mIGNvbnRhaW5lci4gRm9yIG1vcmVcbiAgICAgICAgLy8gaW5mbyBzZWUgYnVnICMzMzMzXG4gICAgICAgIC8vIEZhaWxzIGluIFdlYktpdCBiZWZvcmUgRmViIDIwMTEgbmlnaHRsaWVzXG4gICAgICAgIC8vIFdlYktpdCBCdWcgMTMzNDMgLSBnZXRDb21wdXRlZFN0eWxlIHJldHVybnMgd3JvbmcgdmFsdWUgZm9yIG1hcmdpbi1yaWdodFxuICAgICAgICBpZiAoIHdpbmRvdy5nZXRDb21wdXRlZFN0eWxlICkge1xuICAgICAgICAgICAgbWFyZ2luRGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCggXCJkaXZcIiApO1xuICAgICAgICAgICAgbWFyZ2luRGl2LnN0eWxlLndpZHRoID0gXCIwXCI7XG4gICAgICAgICAgICBtYXJnaW5EaXYuc3R5bGUubWFyZ2luUmlnaHQgPSBcIjBcIjtcbiAgICAgICAgICAgIGRpdi5zdHlsZS53aWR0aCA9IFwiMnB4XCI7XG4gICAgICAgICAgICBkaXYuYXBwZW5kQ2hpbGQoIG1hcmdpbkRpdiApO1xuICAgICAgICAgICAgc3VwcG9ydC5yZWxpYWJsZU1hcmdpblJpZ2h0ID1cbiAgICAgICAgICAgICAgICAoIHBhcnNlSW50KCAoIHdpbmRvdy5nZXRDb21wdXRlZFN0eWxlKCBtYXJnaW5EaXYsIG51bGwgKSB8fCB7IG1hcmdpblJpZ2h0OiAwIH0gKS5tYXJnaW5SaWdodCwgMTAgKSB8fCAwICkgPT09IDA7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBUZWNobmlxdWUgZnJvbSBKdXJpeSBaYXl0c2V2XG4gICAgICAgIC8vIGh0dHA6Ly9wZXJmZWN0aW9ua2lsbHMuY29tL2RldGVjdGluZy1ldmVudC1zdXBwb3J0LXdpdGhvdXQtYnJvd3Nlci1zbmlmZmluZy9cbiAgICAgICAgLy8gV2Ugb25seSBjYXJlIGFib3V0IHRoZSBjYXNlIHdoZXJlIG5vbi1zdGFuZGFyZCBldmVudCBzeXN0ZW1zXG4gICAgICAgIC8vIGFyZSB1c2VkLCBuYW1lbHkgaW4gSUUuIFNob3J0LWNpcmN1aXRpbmcgaGVyZSBoZWxwcyB1cyB0b1xuICAgICAgICAvLyBhdm9pZCBhbiBldmFsIGNhbGwgKGluIHNldEF0dHJpYnV0ZSkgd2hpY2ggY2FuIGNhdXNlIENTUFxuICAgICAgICAvLyB0byBnbyBoYXl3aXJlLiBTZWU6IGh0dHBzOi8vZGV2ZWxvcGVyLm1vemlsbGEub3JnL2VuL1NlY3VyaXR5L0NTUFxuICAgICAgICBpZiAoIGRpdi5hdHRhY2hFdmVudCApIHtcbiAgICAgICAgICAgIGZvciggaSBpbiB7XG4gICAgICAgICAgICAgICAgc3VibWl0OiAxLFxuICAgICAgICAgICAgICAgIGNoYW5nZTogMSxcbiAgICAgICAgICAgICAgICBmb2N1c2luOiAxXG4gICAgICAgICAgICB9KSB7XG4gICAgICAgICAgICAgICAgZXZlbnROYW1lID0gXCJvblwiICsgaTtcbiAgICAgICAgICAgICAgICBpc1N1cHBvcnRlZCA9ICggZXZlbnROYW1lIGluIGRpdiApO1xuICAgICAgICAgICAgICAgIGlmICggIWlzU3VwcG9ydGVkICkge1xuICAgICAgICAgICAgICAgICAgICBkaXYuc2V0QXR0cmlidXRlKCBldmVudE5hbWUsIFwicmV0dXJuO1wiICk7XG4gICAgICAgICAgICAgICAgICAgIGlzU3VwcG9ydGVkID0gKCB0eXBlb2YgZGl2WyBldmVudE5hbWUgXSA9PT0gXCJmdW5jdGlvblwiICk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHN1cHBvcnRbIGkgKyBcIkJ1YmJsZXNcIiBdID0gaXNTdXBwb3J0ZWQ7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBmcmFnbWVudC5yZW1vdmVDaGlsZCggZGl2ICk7XG5cbiAgICAgICAgLy8gTnVsbCBlbGVtZW50cyB0byBhdm9pZCBsZWFrcyBpbiBJRVxuICAgICAgICBmcmFnbWVudCA9IHNlbGVjdCA9IG9wdCA9IG1hcmdpbkRpdiA9IGRpdiA9IGlucHV0ID0gbnVsbDtcblxuICAgICAgICAvLyBSdW4gdGVzdHMgdGhhdCBuZWVkIGEgYm9keSBhdCBkb2MgcmVhZHlcbiAgICAgICAgalF1ZXJ5KGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgdmFyIGNvbnRhaW5lciwgb3V0ZXIsIGlubmVyLCB0YWJsZSwgdGQsIG9mZnNldFN1cHBvcnQsXG4gICAgICAgICAgICAgICAgY29uTWFyZ2luVG9wLCBwdGxtLCB2Yiwgc3R5bGUsIGh0bWwsXG4gICAgICAgICAgICAgICAgYm9keSA9IGRvY3VtZW50LmdldEVsZW1lbnRzQnlUYWdOYW1lKFwiYm9keVwiKVswXTtcblxuICAgICAgICAgICAgaWYgKCAhYm9keSApIHtcbiAgICAgICAgICAgICAgICAvLyBSZXR1cm4gZm9yIGZyYW1lc2V0IGRvY3MgdGhhdCBkb24ndCBoYXZlIGEgYm9keVxuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgY29uTWFyZ2luVG9wID0gMTtcbiAgICAgICAgICAgIHB0bG0gPSBcInBvc2l0aW9uOmFic29sdXRlO3RvcDowO2xlZnQ6MDt3aWR0aDoxcHg7aGVpZ2h0OjFweDttYXJnaW46MDtcIjtcbiAgICAgICAgICAgIHZiID0gXCJ2aXNpYmlsaXR5OmhpZGRlbjtib3JkZXI6MDtcIjtcbiAgICAgICAgICAgIHN0eWxlID0gXCJzdHlsZT0nXCIgKyBwdGxtICsgXCJib3JkZXI6NXB4IHNvbGlkICMwMDA7cGFkZGluZzowOydcIjtcbiAgICAgICAgICAgIGh0bWwgPSBcIjxkaXYgXCIgKyBzdHlsZSArIFwiPjxkaXY+PC9kaXY+PC9kaXY+XCIgK1xuICAgICAgICAgICAgICAgIFwiPHRhYmxlIFwiICsgc3R5bGUgKyBcIiBjZWxscGFkZGluZz0nMCcgY2VsbHNwYWNpbmc9JzAnPlwiICtcbiAgICAgICAgICAgICAgICBcIjx0cj48dGQ+PC90ZD48L3RyPjwvdGFibGU+XCI7XG5cbiAgICAgICAgICAgIGNvbnRhaW5lciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG4gICAgICAgICAgICBjb250YWluZXIuc3R5bGUuY3NzVGV4dCA9IHZiICsgXCJ3aWR0aDowO2hlaWdodDowO3Bvc2l0aW9uOnN0YXRpYzt0b3A6MDttYXJnaW4tdG9wOlwiICsgY29uTWFyZ2luVG9wICsgXCJweFwiO1xuICAgICAgICAgICAgYm9keS5pbnNlcnRCZWZvcmUoIGNvbnRhaW5lciwgYm9keS5maXJzdENoaWxkICk7XG5cbiAgICAgICAgICAgIC8vIENvbnN0cnVjdCB0aGUgdGVzdCBlbGVtZW50XG4gICAgICAgICAgICBkaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuICAgICAgICAgICAgY29udGFpbmVyLmFwcGVuZENoaWxkKCBkaXYgKTtcblxuICAgICAgICAgICAgLy8gQ2hlY2sgaWYgdGFibGUgY2VsbHMgc3RpbGwgaGF2ZSBvZmZzZXRXaWR0aC9IZWlnaHQgd2hlbiB0aGV5IGFyZSBzZXRcbiAgICAgICAgICAgIC8vIHRvIGRpc3BsYXk6bm9uZSBhbmQgdGhlcmUgYXJlIHN0aWxsIG90aGVyIHZpc2libGUgdGFibGUgY2VsbHMgaW4gYVxuICAgICAgICAgICAgLy8gdGFibGUgcm93OyBpZiBzbywgb2Zmc2V0V2lkdGgvSGVpZ2h0IGFyZSBub3QgcmVsaWFibGUgZm9yIHVzZSB3aGVuXG4gICAgICAgICAgICAvLyBkZXRlcm1pbmluZyBpZiBhbiBlbGVtZW50IGhhcyBiZWVuIGhpZGRlbiBkaXJlY3RseSB1c2luZ1xuICAgICAgICAgICAgLy8gZGlzcGxheTpub25lIChpdCBpcyBzdGlsbCBzYWZlIHRvIHVzZSBvZmZzZXRzIGlmIGEgcGFyZW50IGVsZW1lbnQgaXNcbiAgICAgICAgICAgIC8vIGhpZGRlbjsgZG9uIHNhZmV0eSBnb2dnbGVzIGFuZCBzZWUgYnVnICM0NTEyIGZvciBtb3JlIGluZm9ybWF0aW9uKS5cbiAgICAgICAgICAgIC8vIChvbmx5IElFIDggZmFpbHMgdGhpcyB0ZXN0KVxuICAgICAgICAgICAgZGl2LmlubmVySFRNTCA9IFwiPHRhYmxlPjx0cj48dGQgc3R5bGU9J3BhZGRpbmc6MDtib3JkZXI6MDtkaXNwbGF5Om5vbmUnPjwvdGQ+PHRkPnQ8L3RkPjwvdHI+PC90YWJsZT5cIjtcbiAgICAgICAgICAgIHRkcyA9IGRpdi5nZXRFbGVtZW50c0J5VGFnTmFtZSggXCJ0ZFwiICk7XG4gICAgICAgICAgICBpc1N1cHBvcnRlZCA9ICggdGRzWyAwIF0ub2Zmc2V0SGVpZ2h0ID09PSAwICk7XG5cbiAgICAgICAgICAgIHRkc1sgMCBdLnN0eWxlLmRpc3BsYXkgPSBcIlwiO1xuICAgICAgICAgICAgdGRzWyAxIF0uc3R5bGUuZGlzcGxheSA9IFwibm9uZVwiO1xuXG4gICAgICAgICAgICAvLyBDaGVjayBpZiBlbXB0eSB0YWJsZSBjZWxscyBzdGlsbCBoYXZlIG9mZnNldFdpZHRoL0hlaWdodFxuICAgICAgICAgICAgLy8gKElFIDw9IDggZmFpbCB0aGlzIHRlc3QpXG4gICAgICAgICAgICBzdXBwb3J0LnJlbGlhYmxlSGlkZGVuT2Zmc2V0cyA9IGlzU3VwcG9ydGVkICYmICggdGRzWyAwIF0ub2Zmc2V0SGVpZ2h0ID09PSAwICk7XG5cbiAgICAgICAgICAgIC8vIEZpZ3VyZSBvdXQgaWYgdGhlIFczQyBib3ggbW9kZWwgd29ya3MgYXMgZXhwZWN0ZWRcbiAgICAgICAgICAgIGRpdi5pbm5lckhUTUwgPSBcIlwiO1xuICAgICAgICAgICAgZGl2LnN0eWxlLndpZHRoID0gZGl2LnN0eWxlLnBhZGRpbmdMZWZ0ID0gXCIxcHhcIjtcbiAgICAgICAgICAgIGpRdWVyeS5ib3hNb2RlbCA9IHN1cHBvcnQuYm94TW9kZWwgPSBkaXYub2Zmc2V0V2lkdGggPT09IDI7XG5cbiAgICAgICAgICAgIGlmICggdHlwZW9mIGRpdi5zdHlsZS56b29tICE9PSBcInVuZGVmaW5lZFwiICkge1xuICAgICAgICAgICAgICAgIC8vIENoZWNrIGlmIG5hdGl2ZWx5IGJsb2NrLWxldmVsIGVsZW1lbnRzIGFjdCBsaWtlIGlubGluZS1ibG9ja1xuICAgICAgICAgICAgICAgIC8vIGVsZW1lbnRzIHdoZW4gc2V0dGluZyB0aGVpciBkaXNwbGF5IHRvICdpbmxpbmUnIGFuZCBnaXZpbmdcbiAgICAgICAgICAgICAgICAvLyB0aGVtIGxheW91dFxuICAgICAgICAgICAgICAgIC8vIChJRSA8IDggZG9lcyB0aGlzKVxuICAgICAgICAgICAgICAgIGRpdi5zdHlsZS5kaXNwbGF5ID0gXCJpbmxpbmVcIjtcbiAgICAgICAgICAgICAgICBkaXYuc3R5bGUuem9vbSA9IDE7XG4gICAgICAgICAgICAgICAgc3VwcG9ydC5pbmxpbmVCbG9ja05lZWRzTGF5b3V0ID0gKCBkaXYub2Zmc2V0V2lkdGggPT09IDIgKTtcblxuICAgICAgICAgICAgICAgIC8vIENoZWNrIGlmIGVsZW1lbnRzIHdpdGggbGF5b3V0IHNocmluay13cmFwIHRoZWlyIGNoaWxkcmVuXG4gICAgICAgICAgICAgICAgLy8gKElFIDYgZG9lcyB0aGlzKVxuICAgICAgICAgICAgICAgIGRpdi5zdHlsZS5kaXNwbGF5ID0gXCJcIjtcbiAgICAgICAgICAgICAgICBkaXYuaW5uZXJIVE1MID0gXCI8ZGl2IHN0eWxlPSd3aWR0aDo0cHg7Jz48L2Rpdj5cIjtcbiAgICAgICAgICAgICAgICBzdXBwb3J0LnNocmlua1dyYXBCbG9ja3MgPSAoIGRpdi5vZmZzZXRXaWR0aCAhPT0gMiApO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBkaXYuc3R5bGUuY3NzVGV4dCA9IHB0bG0gKyB2YjtcbiAgICAgICAgICAgIGRpdi5pbm5lckhUTUwgPSBodG1sO1xuXG4gICAgICAgICAgICBvdXRlciA9IGRpdi5maXJzdENoaWxkO1xuICAgICAgICAgICAgaW5uZXIgPSBvdXRlci5maXJzdENoaWxkO1xuICAgICAgICAgICAgdGQgPSBvdXRlci5uZXh0U2libGluZy5maXJzdENoaWxkLmZpcnN0Q2hpbGQ7XG5cbiAgICAgICAgICAgIG9mZnNldFN1cHBvcnQgPSB7XG4gICAgICAgICAgICAgICAgZG9lc05vdEFkZEJvcmRlcjogKCBpbm5lci5vZmZzZXRUb3AgIT09IDUgKSxcbiAgICAgICAgICAgICAgICBkb2VzQWRkQm9yZGVyRm9yVGFibGVBbmRDZWxsczogKCB0ZC5vZmZzZXRUb3AgPT09IDUgKVxuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgaW5uZXIuc3R5bGUucG9zaXRpb24gPSBcImZpeGVkXCI7XG4gICAgICAgICAgICBpbm5lci5zdHlsZS50b3AgPSBcIjIwcHhcIjtcblxuICAgICAgICAgICAgLy8gc2FmYXJpIHN1YnRyYWN0cyBwYXJlbnQgYm9yZGVyIHdpZHRoIGhlcmUgd2hpY2ggaXMgNXB4XG4gICAgICAgICAgICBvZmZzZXRTdXBwb3J0LmZpeGVkUG9zaXRpb24gPSAoIGlubmVyLm9mZnNldFRvcCA9PT0gMjAgfHwgaW5uZXIub2Zmc2V0VG9wID09PSAxNSApO1xuICAgICAgICAgICAgaW5uZXIuc3R5bGUucG9zaXRpb24gPSBpbm5lci5zdHlsZS50b3AgPSBcIlwiO1xuXG4gICAgICAgICAgICBvdXRlci5zdHlsZS5vdmVyZmxvdyA9IFwiaGlkZGVuXCI7XG4gICAgICAgICAgICBvdXRlci5zdHlsZS5wb3NpdGlvbiA9IFwicmVsYXRpdmVcIjtcblxuICAgICAgICAgICAgb2Zmc2V0U3VwcG9ydC5zdWJ0cmFjdHNCb3JkZXJGb3JPdmVyZmxvd05vdFZpc2libGUgPSAoIGlubmVyLm9mZnNldFRvcCA9PT0gLTUgKTtcbiAgICAgICAgICAgIG9mZnNldFN1cHBvcnQuZG9lc05vdEluY2x1ZGVNYXJnaW5JbkJvZHlPZmZzZXQgPSAoIGJvZHkub2Zmc2V0VG9wICE9PSBjb25NYXJnaW5Ub3AgKTtcblxuICAgICAgICAgICAgYm9keS5yZW1vdmVDaGlsZCggY29udGFpbmVyICk7XG4gICAgICAgICAgICBkaXYgID0gY29udGFpbmVyID0gbnVsbDtcblxuICAgICAgICAgICAgalF1ZXJ5LmV4dGVuZCggc3VwcG9ydCwgb2Zmc2V0U3VwcG9ydCApO1xuICAgICAgICB9KTtcblxuICAgICAgICByZXR1cm4gc3VwcG9ydDtcbiAgICB9KSgpO1xuXG5cblxuXG4gICAgdmFyIHJicmFjZSA9IC9eKD86XFx7LipcXH18XFxbLipcXF0pJC8sXG4gICAgICAgIHJtdWx0aURhc2ggPSAvKFtBLVpdKS9nO1xuXG4gICAgalF1ZXJ5LmV4dGVuZCh7XG4gICAgICAgIGNhY2hlOiB7fSxcblxuICAgICAgICAvLyBQbGVhc2UgdXNlIHdpdGggY2F1dGlvblxuICAgICAgICB1dWlkOiAwLFxuXG4gICAgICAgIC8vIFVuaXF1ZSBmb3IgZWFjaCBjb3B5IG9mIGpRdWVyeSBvbiB0aGUgcGFnZVxuICAgICAgICAvLyBOb24tZGlnaXRzIHJlbW92ZWQgdG8gbWF0Y2ggcmlubGluZWpRdWVyeVxuICAgICAgICBleHBhbmRvOiBcImpRdWVyeVwiICsgKCBqUXVlcnkuZm4uanF1ZXJ5ICsgTWF0aC5yYW5kb20oKSApLnJlcGxhY2UoIC9cXEQvZywgXCJcIiApLFxuXG4gICAgICAgIC8vIFRoZSBmb2xsb3dpbmcgZWxlbWVudHMgdGhyb3cgdW5jYXRjaGFibGUgZXhjZXB0aW9ucyBpZiB5b3VcbiAgICAgICAgLy8gYXR0ZW1wdCB0byBhZGQgZXhwYW5kbyBwcm9wZXJ0aWVzIHRvIHRoZW0uXG4gICAgICAgIG5vRGF0YToge1xuICAgICAgICAgICAgXCJlbWJlZFwiOiB0cnVlLFxuICAgICAgICAgICAgLy8gQmFuIGFsbCBvYmplY3RzIGV4Y2VwdCBmb3IgRmxhc2ggKHdoaWNoIGhhbmRsZSBleHBhbmRvcylcbiAgICAgICAgICAgIFwib2JqZWN0XCI6IFwiY2xzaWQ6RDI3Q0RCNkUtQUU2RC0xMWNmLTk2QjgtNDQ0NTUzNTQwMDAwXCIsXG4gICAgICAgICAgICBcImFwcGxldFwiOiB0cnVlXG4gICAgICAgIH0sXG5cbiAgICAgICAgaGFzRGF0YTogZnVuY3Rpb24oIGVsZW0gKSB7XG4gICAgICAgICAgICBlbGVtID0gZWxlbS5ub2RlVHlwZSA/IGpRdWVyeS5jYWNoZVsgZWxlbVtqUXVlcnkuZXhwYW5kb10gXSA6IGVsZW1bIGpRdWVyeS5leHBhbmRvIF07XG4gICAgICAgICAgICByZXR1cm4gISFlbGVtICYmICFpc0VtcHR5RGF0YU9iamVjdCggZWxlbSApO1xuICAgICAgICB9LFxuXG4gICAgICAgIGRhdGE6IGZ1bmN0aW9uKCBlbGVtLCBuYW1lLCBkYXRhLCBwdnQgLyogSW50ZXJuYWwgVXNlIE9ubHkgKi8gKSB7XG4gICAgICAgICAgICBpZiAoICFqUXVlcnkuYWNjZXB0RGF0YSggZWxlbSApICkge1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdmFyIHByaXZhdGVDYWNoZSwgdGhpc0NhY2hlLCByZXQsXG4gICAgICAgICAgICAgICAgaW50ZXJuYWxLZXkgPSBqUXVlcnkuZXhwYW5kbyxcbiAgICAgICAgICAgICAgICBnZXRCeU5hbWUgPSB0eXBlb2YgbmFtZSA9PT0gXCJzdHJpbmdcIixcblxuICAgICAgICAgICAgLy8gV2UgaGF2ZSB0byBoYW5kbGUgRE9NIG5vZGVzIGFuZCBKUyBvYmplY3RzIGRpZmZlcmVudGx5IGJlY2F1c2UgSUU2LTdcbiAgICAgICAgICAgIC8vIGNhbid0IEdDIG9iamVjdCByZWZlcmVuY2VzIHByb3Blcmx5IGFjcm9zcyB0aGUgRE9NLUpTIGJvdW5kYXJ5XG4gICAgICAgICAgICAgICAgaXNOb2RlID0gZWxlbS5ub2RlVHlwZSxcblxuICAgICAgICAgICAgLy8gT25seSBET00gbm9kZXMgbmVlZCB0aGUgZ2xvYmFsIGpRdWVyeSBjYWNoZTsgSlMgb2JqZWN0IGRhdGEgaXNcbiAgICAgICAgICAgIC8vIGF0dGFjaGVkIGRpcmVjdGx5IHRvIHRoZSBvYmplY3Qgc28gR0MgY2FuIG9jY3VyIGF1dG9tYXRpY2FsbHlcbiAgICAgICAgICAgICAgICBjYWNoZSA9IGlzTm9kZSA/IGpRdWVyeS5jYWNoZSA6IGVsZW0sXG5cbiAgICAgICAgICAgIC8vIE9ubHkgZGVmaW5pbmcgYW4gSUQgZm9yIEpTIG9iamVjdHMgaWYgaXRzIGNhY2hlIGFscmVhZHkgZXhpc3RzIGFsbG93c1xuICAgICAgICAgICAgLy8gdGhlIGNvZGUgdG8gc2hvcnRjdXQgb24gdGhlIHNhbWUgcGF0aCBhcyBhIERPTSBub2RlIHdpdGggbm8gY2FjaGVcbiAgICAgICAgICAgICAgICBpZCA9IGlzTm9kZSA/IGVsZW1bIGludGVybmFsS2V5IF0gOiBlbGVtWyBpbnRlcm5hbEtleSBdICYmIGludGVybmFsS2V5LFxuICAgICAgICAgICAgICAgIGlzRXZlbnRzID0gbmFtZSA9PT0gXCJldmVudHNcIjtcblxuICAgICAgICAgICAgLy8gQXZvaWQgZG9pbmcgYW55IG1vcmUgd29yayB0aGFuIHdlIG5lZWQgdG8gd2hlbiB0cnlpbmcgdG8gZ2V0IGRhdGEgb24gYW5cbiAgICAgICAgICAgIC8vIG9iamVjdCB0aGF0IGhhcyBubyBkYXRhIGF0IGFsbFxuICAgICAgICAgICAgaWYgKCAoIWlkIHx8ICFjYWNoZVtpZF0gfHwgKCFpc0V2ZW50cyAmJiAhcHZ0ICYmICFjYWNoZVtpZF0uZGF0YSkpICYmIGdldEJ5TmFtZSAmJiBkYXRhID09PSB1bmRlZmluZWQgKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoICFpZCApIHtcbiAgICAgICAgICAgICAgICAvLyBPbmx5IERPTSBub2RlcyBuZWVkIGEgbmV3IHVuaXF1ZSBJRCBmb3IgZWFjaCBlbGVtZW50IHNpbmNlIHRoZWlyIGRhdGFcbiAgICAgICAgICAgICAgICAvLyBlbmRzIHVwIGluIHRoZSBnbG9iYWwgY2FjaGVcbiAgICAgICAgICAgICAgICBpZiAoIGlzTm9kZSApIHtcbiAgICAgICAgICAgICAgICAgICAgZWxlbVsgaW50ZXJuYWxLZXkgXSA9IGlkID0gKytqUXVlcnkudXVpZDtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBpZCA9IGludGVybmFsS2V5O1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKCAhY2FjaGVbIGlkIF0gKSB7XG4gICAgICAgICAgICAgICAgY2FjaGVbIGlkIF0gPSB7fTtcblxuICAgICAgICAgICAgICAgIC8vIEF2b2lkcyBleHBvc2luZyBqUXVlcnkgbWV0YWRhdGEgb24gcGxhaW4gSlMgb2JqZWN0cyB3aGVuIHRoZSBvYmplY3RcbiAgICAgICAgICAgICAgICAvLyBpcyBzZXJpYWxpemVkIHVzaW5nIEpTT04uc3RyaW5naWZ5XG4gICAgICAgICAgICAgICAgaWYgKCAhaXNOb2RlICkge1xuICAgICAgICAgICAgICAgICAgICBjYWNoZVsgaWQgXS50b0pTT04gPSBqUXVlcnkubm9vcDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIEFuIG9iamVjdCBjYW4gYmUgcGFzc2VkIHRvIGpRdWVyeS5kYXRhIGluc3RlYWQgb2YgYSBrZXkvdmFsdWUgcGFpcjsgdGhpcyBnZXRzXG4gICAgICAgICAgICAvLyBzaGFsbG93IGNvcGllZCBvdmVyIG9udG8gdGhlIGV4aXN0aW5nIGNhY2hlXG4gICAgICAgICAgICBpZiAoIHR5cGVvZiBuYW1lID09PSBcIm9iamVjdFwiIHx8IHR5cGVvZiBuYW1lID09PSBcImZ1bmN0aW9uXCIgKSB7XG4gICAgICAgICAgICAgICAgaWYgKCBwdnQgKSB7XG4gICAgICAgICAgICAgICAgICAgIGNhY2hlWyBpZCBdID0galF1ZXJ5LmV4dGVuZCggY2FjaGVbIGlkIF0sIG5hbWUgKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBjYWNoZVsgaWQgXS5kYXRhID0galF1ZXJ5LmV4dGVuZCggY2FjaGVbIGlkIF0uZGF0YSwgbmFtZSApO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgcHJpdmF0ZUNhY2hlID0gdGhpc0NhY2hlID0gY2FjaGVbIGlkIF07XG5cbiAgICAgICAgICAgIC8vIGpRdWVyeSBkYXRhKCkgaXMgc3RvcmVkIGluIGEgc2VwYXJhdGUgb2JqZWN0IGluc2lkZSB0aGUgb2JqZWN0J3MgaW50ZXJuYWwgZGF0YVxuICAgICAgICAgICAgLy8gY2FjaGUgaW4gb3JkZXIgdG8gYXZvaWQga2V5IGNvbGxpc2lvbnMgYmV0d2VlbiBpbnRlcm5hbCBkYXRhIGFuZCB1c2VyLWRlZmluZWRcbiAgICAgICAgICAgIC8vIGRhdGEuXG4gICAgICAgICAgICBpZiAoICFwdnQgKSB7XG4gICAgICAgICAgICAgICAgaWYgKCAhdGhpc0NhY2hlLmRhdGEgKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXNDYWNoZS5kYXRhID0ge307XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgdGhpc0NhY2hlID0gdGhpc0NhY2hlLmRhdGE7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmICggZGF0YSAhPT0gdW5kZWZpbmVkICkge1xuICAgICAgICAgICAgICAgIHRoaXNDYWNoZVsgalF1ZXJ5LmNhbWVsQ2FzZSggbmFtZSApIF0gPSBkYXRhO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBVc2VycyBzaG91bGQgbm90IGF0dGVtcHQgdG8gaW5zcGVjdCB0aGUgaW50ZXJuYWwgZXZlbnRzIG9iamVjdCB1c2luZyBqUXVlcnkuZGF0YSxcbiAgICAgICAgICAgIC8vIGl0IGlzIHVuZG9jdW1lbnRlZCBhbmQgc3ViamVjdCB0byBjaGFuZ2UuIEJ1dCBkb2VzIGFueW9uZSBsaXN0ZW4/IE5vLlxuICAgICAgICAgICAgaWYgKCBpc0V2ZW50cyAmJiAhdGhpc0NhY2hlWyBuYW1lIF0gKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHByaXZhdGVDYWNoZS5ldmVudHM7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIENoZWNrIGZvciBib3RoIGNvbnZlcnRlZC10by1jYW1lbCBhbmQgbm9uLWNvbnZlcnRlZCBkYXRhIHByb3BlcnR5IG5hbWVzXG4gICAgICAgICAgICAvLyBJZiBhIGRhdGEgcHJvcGVydHkgd2FzIHNwZWNpZmllZFxuICAgICAgICAgICAgaWYgKCBnZXRCeU5hbWUgKSB7XG5cbiAgICAgICAgICAgICAgICAvLyBGaXJzdCBUcnkgdG8gZmluZCBhcy1pcyBwcm9wZXJ0eSBkYXRhXG4gICAgICAgICAgICAgICAgcmV0ID0gdGhpc0NhY2hlWyBuYW1lIF07XG5cbiAgICAgICAgICAgICAgICAvLyBUZXN0IGZvciBudWxsfHVuZGVmaW5lZCBwcm9wZXJ0eSBkYXRhXG4gICAgICAgICAgICAgICAgaWYgKCByZXQgPT0gbnVsbCApIHtcblxuICAgICAgICAgICAgICAgICAgICAvLyBUcnkgdG8gZmluZCB0aGUgY2FtZWxDYXNlZCBwcm9wZXJ0eVxuICAgICAgICAgICAgICAgICAgICByZXQgPSB0aGlzQ2FjaGVbIGpRdWVyeS5jYW1lbENhc2UoIG5hbWUgKSBdO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgcmV0ID0gdGhpc0NhY2hlO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByZXR1cm4gcmV0O1xuICAgICAgICB9LFxuXG4gICAgICAgIHJlbW92ZURhdGE6IGZ1bmN0aW9uKCBlbGVtLCBuYW1lLCBwdnQgLyogSW50ZXJuYWwgVXNlIE9ubHkgKi8gKSB7XG4gICAgICAgICAgICBpZiAoICFqUXVlcnkuYWNjZXB0RGF0YSggZWxlbSApICkge1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdmFyIHRoaXNDYWNoZSwgaSwgbCxcblxuICAgICAgICAgICAgLy8gUmVmZXJlbmNlIHRvIGludGVybmFsIGRhdGEgY2FjaGUga2V5XG4gICAgICAgICAgICAgICAgaW50ZXJuYWxLZXkgPSBqUXVlcnkuZXhwYW5kbyxcblxuICAgICAgICAgICAgICAgIGlzTm9kZSA9IGVsZW0ubm9kZVR5cGUsXG5cbiAgICAgICAgICAgIC8vIFNlZSBqUXVlcnkuZGF0YSBmb3IgbW9yZSBpbmZvcm1hdGlvblxuICAgICAgICAgICAgICAgIGNhY2hlID0gaXNOb2RlID8galF1ZXJ5LmNhY2hlIDogZWxlbSxcblxuICAgICAgICAgICAgLy8gU2VlIGpRdWVyeS5kYXRhIGZvciBtb3JlIGluZm9ybWF0aW9uXG4gICAgICAgICAgICAgICAgaWQgPSBpc05vZGUgPyBlbGVtWyBpbnRlcm5hbEtleSBdIDogaW50ZXJuYWxLZXk7XG5cbiAgICAgICAgICAgIC8vIElmIHRoZXJlIGlzIGFscmVhZHkgbm8gY2FjaGUgZW50cnkgZm9yIHRoaXMgb2JqZWN0LCB0aGVyZSBpcyBub1xuICAgICAgICAgICAgLy8gcHVycG9zZSBpbiBjb250aW51aW5nXG4gICAgICAgICAgICBpZiAoICFjYWNoZVsgaWQgXSApIHtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmICggbmFtZSApIHtcblxuICAgICAgICAgICAgICAgIHRoaXNDYWNoZSA9IHB2dCA/IGNhY2hlWyBpZCBdIDogY2FjaGVbIGlkIF0uZGF0YTtcblxuICAgICAgICAgICAgICAgIGlmICggdGhpc0NhY2hlICkge1xuXG4gICAgICAgICAgICAgICAgICAgIC8vIFN1cHBvcnQgYXJyYXkgb3Igc3BhY2Ugc2VwYXJhdGVkIHN0cmluZyBuYW1lcyBmb3IgZGF0YSBrZXlzXG4gICAgICAgICAgICAgICAgICAgIGlmICggIWpRdWVyeS5pc0FycmF5KCBuYW1lICkgKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIHRyeSB0aGUgc3RyaW5nIGFzIGEga2V5IGJlZm9yZSBhbnkgbWFuaXB1bGF0aW9uXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoIG5hbWUgaW4gdGhpc0NhY2hlICkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5hbWUgPSBbIG5hbWUgXTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBzcGxpdCB0aGUgY2FtZWwgY2FzZWQgdmVyc2lvbiBieSBzcGFjZXMgdW5sZXNzIGEga2V5IHdpdGggdGhlIHNwYWNlcyBleGlzdHNcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBuYW1lID0galF1ZXJ5LmNhbWVsQ2FzZSggbmFtZSApO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICggbmFtZSBpbiB0aGlzQ2FjaGUgKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5hbWUgPSBbIG5hbWUgXTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuYW1lID0gbmFtZS5zcGxpdCggXCIgXCIgKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICBmb3IgKCBpID0gMCwgbCA9IG5hbWUubGVuZ3RoOyBpIDwgbDsgaSsrICkge1xuICAgICAgICAgICAgICAgICAgICAgICAgZGVsZXRlIHRoaXNDYWNoZVsgbmFtZVtpXSBdO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgLy8gSWYgdGhlcmUgaXMgbm8gZGF0YSBsZWZ0IGluIHRoZSBjYWNoZSwgd2Ugd2FudCB0byBjb250aW51ZVxuICAgICAgICAgICAgICAgICAgICAvLyBhbmQgbGV0IHRoZSBjYWNoZSBvYmplY3QgaXRzZWxmIGdldCBkZXN0cm95ZWRcbiAgICAgICAgICAgICAgICAgICAgaWYgKCAhKCBwdnQgPyBpc0VtcHR5RGF0YU9iamVjdCA6IGpRdWVyeS5pc0VtcHR5T2JqZWN0ICkoIHRoaXNDYWNoZSApICkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBTZWUgalF1ZXJ5LmRhdGEgZm9yIG1vcmUgaW5mb3JtYXRpb25cbiAgICAgICAgICAgIGlmICggIXB2dCApIHtcbiAgICAgICAgICAgICAgICBkZWxldGUgY2FjaGVbIGlkIF0uZGF0YTtcblxuICAgICAgICAgICAgICAgIC8vIERvbid0IGRlc3Ryb3kgdGhlIHBhcmVudCBjYWNoZSB1bmxlc3MgdGhlIGludGVybmFsIGRhdGEgb2JqZWN0XG4gICAgICAgICAgICAgICAgLy8gaGFkIGJlZW4gdGhlIG9ubHkgdGhpbmcgbGVmdCBpbiBpdFxuICAgICAgICAgICAgICAgIGlmICggIWlzRW1wdHlEYXRhT2JqZWN0KGNhY2hlWyBpZCBdKSApIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gQnJvd3NlcnMgdGhhdCBmYWlsIGV4cGFuZG8gZGVsZXRpb24gYWxzbyByZWZ1c2UgdG8gZGVsZXRlIGV4cGFuZG9zIG9uXG4gICAgICAgICAgICAvLyB0aGUgd2luZG93LCBidXQgaXQgd2lsbCBhbGxvdyBpdCBvbiBhbGwgb3RoZXIgSlMgb2JqZWN0czsgb3RoZXIgYnJvd3NlcnNcbiAgICAgICAgICAgIC8vIGRvbid0IGNhcmVcbiAgICAgICAgICAgIC8vIEVuc3VyZSB0aGF0IGBjYWNoZWAgaXMgbm90IGEgd2luZG93IG9iamVjdCAjMTAwODBcbiAgICAgICAgICAgIGlmICggalF1ZXJ5LnN1cHBvcnQuZGVsZXRlRXhwYW5kbyB8fCAhY2FjaGUuc2V0SW50ZXJ2YWwgKSB7XG4gICAgICAgICAgICAgICAgZGVsZXRlIGNhY2hlWyBpZCBdO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBjYWNoZVsgaWQgXSA9IG51bGw7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIFdlIGRlc3Ryb3llZCB0aGUgY2FjaGUgYW5kIG5lZWQgdG8gZWxpbWluYXRlIHRoZSBleHBhbmRvIG9uIHRoZSBub2RlIHRvIGF2b2lkXG4gICAgICAgICAgICAvLyBmYWxzZSBsb29rdXBzIGluIHRoZSBjYWNoZSBmb3IgZW50cmllcyB0aGF0IG5vIGxvbmdlciBleGlzdFxuICAgICAgICAgICAgaWYgKCBpc05vZGUgKSB7XG4gICAgICAgICAgICAgICAgLy8gSUUgZG9lcyBub3QgYWxsb3cgdXMgdG8gZGVsZXRlIGV4cGFuZG8gcHJvcGVydGllcyBmcm9tIG5vZGVzLFxuICAgICAgICAgICAgICAgIC8vIG5vciBkb2VzIGl0IGhhdmUgYSByZW1vdmVBdHRyaWJ1dGUgZnVuY3Rpb24gb24gRG9jdW1lbnQgbm9kZXM7XG4gICAgICAgICAgICAgICAgLy8gd2UgbXVzdCBoYW5kbGUgYWxsIG9mIHRoZXNlIGNhc2VzXG4gICAgICAgICAgICAgICAgaWYgKCBqUXVlcnkuc3VwcG9ydC5kZWxldGVFeHBhbmRvICkge1xuICAgICAgICAgICAgICAgICAgICBkZWxldGUgZWxlbVsgaW50ZXJuYWxLZXkgXTtcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKCBlbGVtLnJlbW92ZUF0dHJpYnV0ZSApIHtcbiAgICAgICAgICAgICAgICAgICAgZWxlbS5yZW1vdmVBdHRyaWJ1dGUoIGludGVybmFsS2V5ICk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgZWxlbVsgaW50ZXJuYWxLZXkgXSA9IG51bGw7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIC8vIEZvciBpbnRlcm5hbCB1c2Ugb25seS5cbiAgICAgICAgX2RhdGE6IGZ1bmN0aW9uKCBlbGVtLCBuYW1lLCBkYXRhICkge1xuICAgICAgICAgICAgcmV0dXJuIGpRdWVyeS5kYXRhKCBlbGVtLCBuYW1lLCBkYXRhLCB0cnVlICk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgLy8gQSBtZXRob2QgZm9yIGRldGVybWluaW5nIGlmIGEgRE9NIG5vZGUgY2FuIGhhbmRsZSB0aGUgZGF0YSBleHBhbmRvXG4gICAgICAgIGFjY2VwdERhdGE6IGZ1bmN0aW9uKCBlbGVtICkge1xuICAgICAgICAgICAgaWYgKCBlbGVtLm5vZGVOYW1lICkge1xuICAgICAgICAgICAgICAgIHZhciBtYXRjaCA9IGpRdWVyeS5ub0RhdGFbIGVsZW0ubm9kZU5hbWUudG9Mb3dlckNhc2UoKSBdO1xuXG4gICAgICAgICAgICAgICAgaWYgKCBtYXRjaCApIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICEobWF0Y2ggPT09IHRydWUgfHwgZWxlbS5nZXRBdHRyaWJ1dGUoXCJjbGFzc2lkXCIpICE9PSBtYXRjaCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfVxuICAgIH0pO1xuXG4gICAgalF1ZXJ5LmZuLmV4dGVuZCh7XG4gICAgICAgIGRhdGE6IGZ1bmN0aW9uKCBrZXksIHZhbHVlICkge1xuICAgICAgICAgICAgdmFyIHBhcnRzLCBhdHRyLCBuYW1lLFxuICAgICAgICAgICAgICAgIGRhdGEgPSBudWxsO1xuXG4gICAgICAgICAgICBpZiAoIHR5cGVvZiBrZXkgPT09IFwidW5kZWZpbmVkXCIgKSB7XG4gICAgICAgICAgICAgICAgaWYgKCB0aGlzLmxlbmd0aCApIHtcbiAgICAgICAgICAgICAgICAgICAgZGF0YSA9IGpRdWVyeS5kYXRhKCB0aGlzWzBdICk7XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKCB0aGlzWzBdLm5vZGVUeXBlID09PSAxICYmICFqUXVlcnkuX2RhdGEoIHRoaXNbMF0sIFwicGFyc2VkQXR0cnNcIiApICkge1xuICAgICAgICAgICAgICAgICAgICAgICAgYXR0ciA9IHRoaXNbMF0uYXR0cmlidXRlcztcbiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoIHZhciBpID0gMCwgbCA9IGF0dHIubGVuZ3RoOyBpIDwgbDsgaSsrICkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5hbWUgPSBhdHRyW2ldLm5hbWU7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIG5hbWUuaW5kZXhPZiggXCJkYXRhLVwiICkgPT09IDAgKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5hbWUgPSBqUXVlcnkuY2FtZWxDYXNlKCBuYW1lLnN1YnN0cmluZyg1KSApO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGFBdHRyKCB0aGlzWzBdLCBuYW1lLCBkYXRhWyBuYW1lIF0gKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBqUXVlcnkuX2RhdGEoIHRoaXNbMF0sIFwicGFyc2VkQXR0cnNcIiwgdHJ1ZSApO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgcmV0dXJuIGRhdGE7XG5cbiAgICAgICAgICAgIH0gZWxzZSBpZiAoIHR5cGVvZiBrZXkgPT09IFwib2JqZWN0XCIgKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgalF1ZXJ5LmRhdGEoIHRoaXMsIGtleSApO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBwYXJ0cyA9IGtleS5zcGxpdChcIi5cIik7XG4gICAgICAgICAgICBwYXJ0c1sxXSA9IHBhcnRzWzFdID8gXCIuXCIgKyBwYXJ0c1sxXSA6IFwiXCI7XG5cbiAgICAgICAgICAgIGlmICggdmFsdWUgPT09IHVuZGVmaW5lZCApIHtcbiAgICAgICAgICAgICAgICBkYXRhID0gdGhpcy50cmlnZ2VySGFuZGxlcihcImdldERhdGFcIiArIHBhcnRzWzFdICsgXCIhXCIsIFtwYXJ0c1swXV0pO1xuXG4gICAgICAgICAgICAgICAgLy8gVHJ5IHRvIGZldGNoIGFueSBpbnRlcm5hbGx5IHN0b3JlZCBkYXRhIGZpcnN0XG4gICAgICAgICAgICAgICAgaWYgKCBkYXRhID09PSB1bmRlZmluZWQgJiYgdGhpcy5sZW5ndGggKSB7XG4gICAgICAgICAgICAgICAgICAgIGRhdGEgPSBqUXVlcnkuZGF0YSggdGhpc1swXSwga2V5ICk7XG4gICAgICAgICAgICAgICAgICAgIGRhdGEgPSBkYXRhQXR0ciggdGhpc1swXSwga2V5LCBkYXRhICk7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgcmV0dXJuIGRhdGEgPT09IHVuZGVmaW5lZCAmJiBwYXJ0c1sxXSA/XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZGF0YSggcGFydHNbMF0gKSA6XG4gICAgICAgICAgICAgICAgICAgIGRhdGE7XG5cbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIHNlbGYgPSBqUXVlcnkoIHRoaXMgKSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGFyZ3MgPSBbIHBhcnRzWzBdLCB2YWx1ZSBdO1xuXG4gICAgICAgICAgICAgICAgICAgIHNlbGYudHJpZ2dlckhhbmRsZXIoIFwic2V0RGF0YVwiICsgcGFydHNbMV0gKyBcIiFcIiwgYXJncyApO1xuICAgICAgICAgICAgICAgICAgICBqUXVlcnkuZGF0YSggdGhpcywga2V5LCB2YWx1ZSApO1xuICAgICAgICAgICAgICAgICAgICBzZWxmLnRyaWdnZXJIYW5kbGVyKCBcImNoYW5nZURhdGFcIiArIHBhcnRzWzFdICsgXCIhXCIsIGFyZ3MgKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcblxuICAgICAgICByZW1vdmVEYXRhOiBmdW5jdGlvbigga2V5ICkge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICBqUXVlcnkucmVtb3ZlRGF0YSggdGhpcywga2V5ICk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgIH0pO1xuXG4gICAgZnVuY3Rpb24gZGF0YUF0dHIoIGVsZW0sIGtleSwgZGF0YSApIHtcbiAgICAgICAgLy8gSWYgbm90aGluZyB3YXMgZm91bmQgaW50ZXJuYWxseSwgdHJ5IHRvIGZldGNoIGFueVxuICAgICAgICAvLyBkYXRhIGZyb20gdGhlIEhUTUw1IGRhdGEtKiBhdHRyaWJ1dGVcbiAgICAgICAgaWYgKCBkYXRhID09PSB1bmRlZmluZWQgJiYgZWxlbS5ub2RlVHlwZSA9PT0gMSApIHtcblxuICAgICAgICAgICAgdmFyIG5hbWUgPSBcImRhdGEtXCIgKyBrZXkucmVwbGFjZSggcm11bHRpRGFzaCwgXCItJDFcIiApLnRvTG93ZXJDYXNlKCk7XG5cbiAgICAgICAgICAgIGRhdGEgPSBlbGVtLmdldEF0dHJpYnV0ZSggbmFtZSApO1xuXG4gICAgICAgICAgICBpZiAoIHR5cGVvZiBkYXRhID09PSBcInN0cmluZ1wiICkge1xuICAgICAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgICAgIGRhdGEgPSBkYXRhID09PSBcInRydWVcIiA/IHRydWUgOlxuICAgICAgICAgICAgICAgICAgICAgICAgZGF0YSA9PT0gXCJmYWxzZVwiID8gZmFsc2UgOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGEgPT09IFwibnVsbFwiID8gbnVsbCA6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGpRdWVyeS5pc051bWVyaWMoIGRhdGEgKSA/IHBhcnNlRmxvYXQoIGRhdGEgKSA6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByYnJhY2UudGVzdCggZGF0YSApID8galF1ZXJ5LnBhcnNlSlNPTiggZGF0YSApIDpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhO1xuICAgICAgICAgICAgICAgIH0gY2F0Y2goIGUgKSB7fVxuXG4gICAgICAgICAgICAgICAgLy8gTWFrZSBzdXJlIHdlIHNldCB0aGUgZGF0YSBzbyBpdCBpc24ndCBjaGFuZ2VkIGxhdGVyXG4gICAgICAgICAgICAgICAgalF1ZXJ5LmRhdGEoIGVsZW0sIGtleSwgZGF0YSApO1xuXG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGRhdGEgPSB1bmRlZmluZWQ7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gZGF0YTtcbiAgICB9XG5cbi8vIGNoZWNrcyBhIGNhY2hlIG9iamVjdCBmb3IgZW1wdGluZXNzXG4gICAgZnVuY3Rpb24gaXNFbXB0eURhdGFPYmplY3QoIG9iaiApIHtcbiAgICAgICAgZm9yICggdmFyIG5hbWUgaW4gb2JqICkge1xuXG4gICAgICAgICAgICAvLyBpZiB0aGUgcHVibGljIGRhdGEgb2JqZWN0IGlzIGVtcHR5LCB0aGUgcHJpdmF0ZSBpcyBzdGlsbCBlbXB0eVxuICAgICAgICAgICAgaWYgKCBuYW1lID09PSBcImRhdGFcIiAmJiBqUXVlcnkuaXNFbXB0eU9iamVjdCggb2JqW25hbWVdICkgKSB7XG4gICAgICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoIG5hbWUgIT09IFwidG9KU09OXCIgKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuXG5cblxuXG4gICAgZnVuY3Rpb24gaGFuZGxlUXVldWVNYXJrRGVmZXIoIGVsZW0sIHR5cGUsIHNyYyApIHtcbiAgICAgICAgdmFyIGRlZmVyRGF0YUtleSA9IHR5cGUgKyBcImRlZmVyXCIsXG4gICAgICAgICAgICBxdWV1ZURhdGFLZXkgPSB0eXBlICsgXCJxdWV1ZVwiLFxuICAgICAgICAgICAgbWFya0RhdGFLZXkgPSB0eXBlICsgXCJtYXJrXCIsXG4gICAgICAgICAgICBkZWZlciA9IGpRdWVyeS5fZGF0YSggZWxlbSwgZGVmZXJEYXRhS2V5ICk7XG4gICAgICAgIGlmICggZGVmZXIgJiZcbiAgICAgICAgICAgICggc3JjID09PSBcInF1ZXVlXCIgfHwgIWpRdWVyeS5fZGF0YShlbGVtLCBxdWV1ZURhdGFLZXkpICkgJiZcbiAgICAgICAgICAgICggc3JjID09PSBcIm1hcmtcIiB8fCAhalF1ZXJ5Ll9kYXRhKGVsZW0sIG1hcmtEYXRhS2V5KSApICkge1xuICAgICAgICAgICAgLy8gR2l2ZSByb29tIGZvciBoYXJkLWNvZGVkIGNhbGxiYWNrcyB0byBmaXJlIGZpcnN0XG4gICAgICAgICAgICAvLyBhbmQgZXZlbnR1YWxseSBtYXJrL3F1ZXVlIHNvbWV0aGluZyBlbHNlIG9uIHRoZSBlbGVtZW50XG4gICAgICAgICAgICBzZXRUaW1lb3V0KCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICBpZiAoICFqUXVlcnkuX2RhdGEoIGVsZW0sIHF1ZXVlRGF0YUtleSApICYmXG4gICAgICAgICAgICAgICAgICAgICFqUXVlcnkuX2RhdGEoIGVsZW0sIG1hcmtEYXRhS2V5ICkgKSB7XG4gICAgICAgICAgICAgICAgICAgIGpRdWVyeS5yZW1vdmVEYXRhKCBlbGVtLCBkZWZlckRhdGFLZXksIHRydWUgKTtcbiAgICAgICAgICAgICAgICAgICAgZGVmZXIuZmlyZSgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sIDAgKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGpRdWVyeS5leHRlbmQoe1xuXG4gICAgICAgIF9tYXJrOiBmdW5jdGlvbiggZWxlbSwgdHlwZSApIHtcbiAgICAgICAgICAgIGlmICggZWxlbSApIHtcbiAgICAgICAgICAgICAgICB0eXBlID0gKCB0eXBlIHx8IFwiZnhcIiApICsgXCJtYXJrXCI7XG4gICAgICAgICAgICAgICAgalF1ZXJ5Ll9kYXRhKCBlbGVtLCB0eXBlLCAoalF1ZXJ5Ll9kYXRhKCBlbGVtLCB0eXBlICkgfHwgMCkgKyAxICk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sXG5cbiAgICAgICAgX3VubWFyazogZnVuY3Rpb24oIGZvcmNlLCBlbGVtLCB0eXBlICkge1xuICAgICAgICAgICAgaWYgKCBmb3JjZSAhPT0gdHJ1ZSApIHtcbiAgICAgICAgICAgICAgICB0eXBlID0gZWxlbTtcbiAgICAgICAgICAgICAgICBlbGVtID0gZm9yY2U7XG4gICAgICAgICAgICAgICAgZm9yY2UgPSBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICggZWxlbSApIHtcbiAgICAgICAgICAgICAgICB0eXBlID0gdHlwZSB8fCBcImZ4XCI7XG4gICAgICAgICAgICAgICAgdmFyIGtleSA9IHR5cGUgKyBcIm1hcmtcIixcbiAgICAgICAgICAgICAgICAgICAgY291bnQgPSBmb3JjZSA/IDAgOiAoIChqUXVlcnkuX2RhdGEoIGVsZW0sIGtleSApIHx8IDEpIC0gMSApO1xuICAgICAgICAgICAgICAgIGlmICggY291bnQgKSB7XG4gICAgICAgICAgICAgICAgICAgIGpRdWVyeS5fZGF0YSggZWxlbSwga2V5LCBjb3VudCApO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGpRdWVyeS5yZW1vdmVEYXRhKCBlbGVtLCBrZXksIHRydWUgKTtcbiAgICAgICAgICAgICAgICAgICAgaGFuZGxlUXVldWVNYXJrRGVmZXIoIGVsZW0sIHR5cGUsIFwibWFya1wiICk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIHF1ZXVlOiBmdW5jdGlvbiggZWxlbSwgdHlwZSwgZGF0YSApIHtcbiAgICAgICAgICAgIHZhciBxO1xuICAgICAgICAgICAgaWYgKCBlbGVtICkge1xuICAgICAgICAgICAgICAgIHR5cGUgPSAoIHR5cGUgfHwgXCJmeFwiICkgKyBcInF1ZXVlXCI7XG4gICAgICAgICAgICAgICAgcSA9IGpRdWVyeS5fZGF0YSggZWxlbSwgdHlwZSApO1xuXG4gICAgICAgICAgICAgICAgLy8gU3BlZWQgdXAgZGVxdWV1ZSBieSBnZXR0aW5nIG91dCBxdWlja2x5IGlmIHRoaXMgaXMganVzdCBhIGxvb2t1cFxuICAgICAgICAgICAgICAgIGlmICggZGF0YSApIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCAhcSB8fCBqUXVlcnkuaXNBcnJheShkYXRhKSApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHEgPSBqUXVlcnkuX2RhdGEoIGVsZW0sIHR5cGUsIGpRdWVyeS5tYWtlQXJyYXkoZGF0YSkgKTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHEucHVzaCggZGF0YSApO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybiBxIHx8IFtdO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIGRlcXVldWU6IGZ1bmN0aW9uKCBlbGVtLCB0eXBlICkge1xuICAgICAgICAgICAgdHlwZSA9IHR5cGUgfHwgXCJmeFwiO1xuXG4gICAgICAgICAgICB2YXIgcXVldWUgPSBqUXVlcnkucXVldWUoIGVsZW0sIHR5cGUgKSxcbiAgICAgICAgICAgICAgICBmbiA9IHF1ZXVlLnNoaWZ0KCksXG4gICAgICAgICAgICAgICAgaG9va3MgPSB7fTtcblxuICAgICAgICAgICAgLy8gSWYgdGhlIGZ4IHF1ZXVlIGlzIGRlcXVldWVkLCBhbHdheXMgcmVtb3ZlIHRoZSBwcm9ncmVzcyBzZW50aW5lbFxuICAgICAgICAgICAgaWYgKCBmbiA9PT0gXCJpbnByb2dyZXNzXCIgKSB7XG4gICAgICAgICAgICAgICAgZm4gPSBxdWV1ZS5zaGlmdCgpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoIGZuICkge1xuICAgICAgICAgICAgICAgIC8vIEFkZCBhIHByb2dyZXNzIHNlbnRpbmVsIHRvIHByZXZlbnQgdGhlIGZ4IHF1ZXVlIGZyb20gYmVpbmdcbiAgICAgICAgICAgICAgICAvLyBhdXRvbWF0aWNhbGx5IGRlcXVldWVkXG4gICAgICAgICAgICAgICAgaWYgKCB0eXBlID09PSBcImZ4XCIgKSB7XG4gICAgICAgICAgICAgICAgICAgIHF1ZXVlLnVuc2hpZnQoIFwiaW5wcm9ncmVzc1wiICk7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgalF1ZXJ5Ll9kYXRhKCBlbGVtLCB0eXBlICsgXCIucnVuXCIsIGhvb2tzICk7XG4gICAgICAgICAgICAgICAgZm4uY2FsbCggZWxlbSwgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgIGpRdWVyeS5kZXF1ZXVlKCBlbGVtLCB0eXBlICk7XG4gICAgICAgICAgICAgICAgfSwgaG9va3MgKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKCAhcXVldWUubGVuZ3RoICkge1xuICAgICAgICAgICAgICAgIGpRdWVyeS5yZW1vdmVEYXRhKCBlbGVtLCB0eXBlICsgXCJxdWV1ZSBcIiArIHR5cGUgKyBcIi5ydW5cIiwgdHJ1ZSApO1xuICAgICAgICAgICAgICAgIGhhbmRsZVF1ZXVlTWFya0RlZmVyKCBlbGVtLCB0eXBlLCBcInF1ZXVlXCIgKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH0pO1xuXG4gICAgalF1ZXJ5LmZuLmV4dGVuZCh7XG4gICAgICAgIHF1ZXVlOiBmdW5jdGlvbiggdHlwZSwgZGF0YSApIHtcbiAgICAgICAgICAgIGlmICggdHlwZW9mIHR5cGUgIT09IFwic3RyaW5nXCIgKSB7XG4gICAgICAgICAgICAgICAgZGF0YSA9IHR5cGU7XG4gICAgICAgICAgICAgICAgdHlwZSA9IFwiZnhcIjtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKCBkYXRhID09PSB1bmRlZmluZWQgKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGpRdWVyeS5xdWV1ZSggdGhpc1swXSwgdHlwZSApO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICB2YXIgcXVldWUgPSBqUXVlcnkucXVldWUoIHRoaXMsIHR5cGUsIGRhdGEgKTtcblxuICAgICAgICAgICAgICAgIGlmICggdHlwZSA9PT0gXCJmeFwiICYmIHF1ZXVlWzBdICE9PSBcImlucHJvZ3Jlc3NcIiApIHtcbiAgICAgICAgICAgICAgICAgICAgalF1ZXJ5LmRlcXVldWUoIHRoaXMsIHR5cGUgKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSxcbiAgICAgICAgZGVxdWV1ZTogZnVuY3Rpb24oIHR5cGUgKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIGpRdWVyeS5kZXF1ZXVlKCB0aGlzLCB0eXBlICk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSxcbiAgICAgICAgLy8gQmFzZWQgb2ZmIG9mIHRoZSBwbHVnaW4gYnkgQ2xpbnQgSGVsZmVycywgd2l0aCBwZXJtaXNzaW9uLlxuICAgICAgICAvLyBodHRwOi8vYmxpbmRzaWduYWxzLmNvbS9pbmRleC5waHAvMjAwOS8wNy9qcXVlcnktZGVsYXkvXG4gICAgICAgIGRlbGF5OiBmdW5jdGlvbiggdGltZSwgdHlwZSApIHtcbiAgICAgICAgICAgIHRpbWUgPSBqUXVlcnkuZnggPyBqUXVlcnkuZnguc3BlZWRzWyB0aW1lIF0gfHwgdGltZSA6IHRpbWU7XG4gICAgICAgICAgICB0eXBlID0gdHlwZSB8fCBcImZ4XCI7XG5cbiAgICAgICAgICAgIHJldHVybiB0aGlzLnF1ZXVlKCB0eXBlLCBmdW5jdGlvbiggbmV4dCwgaG9va3MgKSB7XG4gICAgICAgICAgICAgICAgdmFyIHRpbWVvdXQgPSBzZXRUaW1lb3V0KCBuZXh0LCB0aW1lICk7XG4gICAgICAgICAgICAgICAgaG9va3Muc3RvcCA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICBjbGVhclRpbWVvdXQoIHRpbWVvdXQgKTtcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0sXG4gICAgICAgIGNsZWFyUXVldWU6IGZ1bmN0aW9uKCB0eXBlICkge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMucXVldWUoIHR5cGUgfHwgXCJmeFwiLCBbXSApO1xuICAgICAgICB9LFxuICAgICAgICAvLyBHZXQgYSBwcm9taXNlIHJlc29sdmVkIHdoZW4gcXVldWVzIG9mIGEgY2VydGFpbiB0eXBlXG4gICAgICAgIC8vIGFyZSBlbXB0aWVkIChmeCBpcyB0aGUgdHlwZSBieSBkZWZhdWx0KVxuICAgICAgICBwcm9taXNlOiBmdW5jdGlvbiggdHlwZSwgb2JqZWN0ICkge1xuICAgICAgICAgICAgaWYgKCB0eXBlb2YgdHlwZSAhPT0gXCJzdHJpbmdcIiApIHtcbiAgICAgICAgICAgICAgICBvYmplY3QgPSB0eXBlO1xuICAgICAgICAgICAgICAgIHR5cGUgPSB1bmRlZmluZWQ7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0eXBlID0gdHlwZSB8fCBcImZ4XCI7XG4gICAgICAgICAgICB2YXIgZGVmZXIgPSBqUXVlcnkuRGVmZXJyZWQoKSxcbiAgICAgICAgICAgICAgICBlbGVtZW50cyA9IHRoaXMsXG4gICAgICAgICAgICAgICAgaSA9IGVsZW1lbnRzLmxlbmd0aCxcbiAgICAgICAgICAgICAgICBjb3VudCA9IDEsXG4gICAgICAgICAgICAgICAgZGVmZXJEYXRhS2V5ID0gdHlwZSArIFwiZGVmZXJcIixcbiAgICAgICAgICAgICAgICBxdWV1ZURhdGFLZXkgPSB0eXBlICsgXCJxdWV1ZVwiLFxuICAgICAgICAgICAgICAgIG1hcmtEYXRhS2V5ID0gdHlwZSArIFwibWFya1wiLFxuICAgICAgICAgICAgICAgIHRtcDtcbiAgICAgICAgICAgIGZ1bmN0aW9uIHJlc29sdmUoKSB7XG4gICAgICAgICAgICAgICAgaWYgKCAhKCAtLWNvdW50ICkgKSB7XG4gICAgICAgICAgICAgICAgICAgIGRlZmVyLnJlc29sdmVXaXRoKCBlbGVtZW50cywgWyBlbGVtZW50cyBdICk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgd2hpbGUoIGktLSApIHtcbiAgICAgICAgICAgICAgICBpZiAoKCB0bXAgPSBqUXVlcnkuZGF0YSggZWxlbWVudHNbIGkgXSwgZGVmZXJEYXRhS2V5LCB1bmRlZmluZWQsIHRydWUgKSB8fFxuICAgICAgICAgICAgICAgICAgICAgICAgKCBqUXVlcnkuZGF0YSggZWxlbWVudHNbIGkgXSwgcXVldWVEYXRhS2V5LCB1bmRlZmluZWQsIHRydWUgKSB8fFxuICAgICAgICAgICAgICAgICAgICAgICAgalF1ZXJ5LmRhdGEoIGVsZW1lbnRzWyBpIF0sIG1hcmtEYXRhS2V5LCB1bmRlZmluZWQsIHRydWUgKSApICYmXG4gICAgICAgICAgICAgICAgICAgICAgICBqUXVlcnkuZGF0YSggZWxlbWVudHNbIGkgXSwgZGVmZXJEYXRhS2V5LCBqUXVlcnkuQ2FsbGJhY2tzKCBcIm9uY2UgbWVtb3J5XCIgKSwgdHJ1ZSApICkpIHtcbiAgICAgICAgICAgICAgICAgICAgY291bnQrKztcbiAgICAgICAgICAgICAgICAgICAgdG1wLmFkZCggcmVzb2x2ZSApO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJlc29sdmUoKTtcbiAgICAgICAgICAgIHJldHVybiBkZWZlci5wcm9taXNlKCk7XG4gICAgICAgIH1cbiAgICB9KTtcblxuXG5cblxuICAgIHZhciByY2xhc3MgPSAvW1xcblxcdFxccl0vZyxcbiAgICAgICAgcnNwYWNlID0gL1xccysvLFxuICAgICAgICBycmV0dXJuID0gL1xcci9nLFxuICAgICAgICBydHlwZSA9IC9eKD86YnV0dG9ufGlucHV0KSQvaSxcbiAgICAgICAgcmZvY3VzYWJsZSA9IC9eKD86YnV0dG9ufGlucHV0fG9iamVjdHxzZWxlY3R8dGV4dGFyZWEpJC9pLFxuICAgICAgICByY2xpY2thYmxlID0gL15hKD86cmVhKT8kL2ksXG4gICAgICAgIHJib29sZWFuID0gL14oPzphdXRvZm9jdXN8YXV0b3BsYXl8YXN5bmN8Y2hlY2tlZHxjb250cm9sc3xkZWZlcnxkaXNhYmxlZHxoaWRkZW58bG9vcHxtdWx0aXBsZXxvcGVufHJlYWRvbmx5fHJlcXVpcmVkfHNjb3BlZHxzZWxlY3RlZCkkL2ksXG4gICAgICAgIGdldFNldEF0dHJpYnV0ZSA9IGpRdWVyeS5zdXBwb3J0LmdldFNldEF0dHJpYnV0ZSxcbiAgICAgICAgbm9kZUhvb2ssIGJvb2xIb29rLCBmaXhTcGVjaWZpZWQ7XG5cbiAgICBqUXVlcnkuZm4uZXh0ZW5kKHtcbiAgICAgICAgYXR0cjogZnVuY3Rpb24oIG5hbWUsIHZhbHVlICkge1xuICAgICAgICAgICAgcmV0dXJuIGpRdWVyeS5hY2Nlc3MoIHRoaXMsIG5hbWUsIHZhbHVlLCB0cnVlLCBqUXVlcnkuYXR0ciApO1xuICAgICAgICB9LFxuXG4gICAgICAgIHJlbW92ZUF0dHI6IGZ1bmN0aW9uKCBuYW1lICkge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICBqUXVlcnkucmVtb3ZlQXR0ciggdGhpcywgbmFtZSApO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgcHJvcDogZnVuY3Rpb24oIG5hbWUsIHZhbHVlICkge1xuICAgICAgICAgICAgcmV0dXJuIGpRdWVyeS5hY2Nlc3MoIHRoaXMsIG5hbWUsIHZhbHVlLCB0cnVlLCBqUXVlcnkucHJvcCApO1xuICAgICAgICB9LFxuXG4gICAgICAgIHJlbW92ZVByb3A6IGZ1bmN0aW9uKCBuYW1lICkge1xuICAgICAgICAgICAgbmFtZSA9IGpRdWVyeS5wcm9wRml4WyBuYW1lIF0gfHwgbmFtZTtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgLy8gdHJ5L2NhdGNoIGhhbmRsZXMgY2FzZXMgd2hlcmUgSUUgYmFsa3MgKHN1Y2ggYXMgcmVtb3ZpbmcgYSBwcm9wZXJ0eSBvbiB3aW5kb3cpXG4gICAgICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICAgICAgdGhpc1sgbmFtZSBdID0gdW5kZWZpbmVkO1xuICAgICAgICAgICAgICAgICAgICBkZWxldGUgdGhpc1sgbmFtZSBdO1xuICAgICAgICAgICAgICAgIH0gY2F0Y2goIGUgKSB7fVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgYWRkQ2xhc3M6IGZ1bmN0aW9uKCB2YWx1ZSApIHtcbiAgICAgICAgICAgIHZhciBjbGFzc05hbWVzLCBpLCBsLCBlbGVtLFxuICAgICAgICAgICAgICAgIHNldENsYXNzLCBjLCBjbDtcblxuICAgICAgICAgICAgaWYgKCBqUXVlcnkuaXNGdW5jdGlvbiggdmFsdWUgKSApIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKCBqICkge1xuICAgICAgICAgICAgICAgICAgICBqUXVlcnkoIHRoaXMgKS5hZGRDbGFzcyggdmFsdWUuY2FsbCh0aGlzLCBqLCB0aGlzLmNsYXNzTmFtZSkgKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKCB2YWx1ZSAmJiB0eXBlb2YgdmFsdWUgPT09IFwic3RyaW5nXCIgKSB7XG4gICAgICAgICAgICAgICAgY2xhc3NOYW1lcyA9IHZhbHVlLnNwbGl0KCByc3BhY2UgKTtcblxuICAgICAgICAgICAgICAgIGZvciAoIGkgPSAwLCBsID0gdGhpcy5sZW5ndGg7IGkgPCBsOyBpKysgKSB7XG4gICAgICAgICAgICAgICAgICAgIGVsZW0gPSB0aGlzWyBpIF07XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKCBlbGVtLm5vZGVUeXBlID09PSAxICkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCAhZWxlbS5jbGFzc05hbWUgJiYgY2xhc3NOYW1lcy5sZW5ndGggPT09IDEgKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxlbS5jbGFzc05hbWUgPSB2YWx1ZTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZXRDbGFzcyA9IFwiIFwiICsgZWxlbS5jbGFzc05hbWUgKyBcIiBcIjtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoIGMgPSAwLCBjbCA9IGNsYXNzTmFtZXMubGVuZ3RoOyBjIDwgY2w7IGMrKyApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCAhfnNldENsYXNzLmluZGV4T2YoIFwiIFwiICsgY2xhc3NOYW1lc1sgYyBdICsgXCIgXCIgKSApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNldENsYXNzICs9IGNsYXNzTmFtZXNbIGMgXSArIFwiIFwiO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsZW0uY2xhc3NOYW1lID0galF1ZXJ5LnRyaW0oIHNldENsYXNzICk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHJldHVybiB0aGlzO1xuICAgICAgICB9LFxuXG4gICAgICAgIHJlbW92ZUNsYXNzOiBmdW5jdGlvbiggdmFsdWUgKSB7XG4gICAgICAgICAgICB2YXIgY2xhc3NOYW1lcywgaSwgbCwgZWxlbSwgY2xhc3NOYW1lLCBjLCBjbDtcblxuICAgICAgICAgICAgaWYgKCBqUXVlcnkuaXNGdW5jdGlvbiggdmFsdWUgKSApIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKCBqICkge1xuICAgICAgICAgICAgICAgICAgICBqUXVlcnkoIHRoaXMgKS5yZW1vdmVDbGFzcyggdmFsdWUuY2FsbCh0aGlzLCBqLCB0aGlzLmNsYXNzTmFtZSkgKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKCAodmFsdWUgJiYgdHlwZW9mIHZhbHVlID09PSBcInN0cmluZ1wiKSB8fCB2YWx1ZSA9PT0gdW5kZWZpbmVkICkge1xuICAgICAgICAgICAgICAgIGNsYXNzTmFtZXMgPSAoIHZhbHVlIHx8IFwiXCIgKS5zcGxpdCggcnNwYWNlICk7XG5cbiAgICAgICAgICAgICAgICBmb3IgKCBpID0gMCwgbCA9IHRoaXMubGVuZ3RoOyBpIDwgbDsgaSsrICkge1xuICAgICAgICAgICAgICAgICAgICBlbGVtID0gdGhpc1sgaSBdO1xuXG4gICAgICAgICAgICAgICAgICAgIGlmICggZWxlbS5ub2RlVHlwZSA9PT0gMSAmJiBlbGVtLmNsYXNzTmFtZSApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICggdmFsdWUgKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2xhc3NOYW1lID0gKFwiIFwiICsgZWxlbS5jbGFzc05hbWUgKyBcIiBcIikucmVwbGFjZSggcmNsYXNzLCBcIiBcIiApO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoIGMgPSAwLCBjbCA9IGNsYXNzTmFtZXMubGVuZ3RoOyBjIDwgY2w7IGMrKyApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2xhc3NOYW1lID0gY2xhc3NOYW1lLnJlcGxhY2UoXCIgXCIgKyBjbGFzc05hbWVzWyBjIF0gKyBcIiBcIiwgXCIgXCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbGVtLmNsYXNzTmFtZSA9IGpRdWVyeS50cmltKCBjbGFzc05hbWUgKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbGVtLmNsYXNzTmFtZSA9IFwiXCI7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHJldHVybiB0aGlzO1xuICAgICAgICB9LFxuXG4gICAgICAgIHRvZ2dsZUNsYXNzOiBmdW5jdGlvbiggdmFsdWUsIHN0YXRlVmFsICkge1xuICAgICAgICAgICAgdmFyIHR5cGUgPSB0eXBlb2YgdmFsdWUsXG4gICAgICAgICAgICAgICAgaXNCb29sID0gdHlwZW9mIHN0YXRlVmFsID09PSBcImJvb2xlYW5cIjtcblxuICAgICAgICAgICAgaWYgKCBqUXVlcnkuaXNGdW5jdGlvbiggdmFsdWUgKSApIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKCBpICkge1xuICAgICAgICAgICAgICAgICAgICBqUXVlcnkoIHRoaXMgKS50b2dnbGVDbGFzcyggdmFsdWUuY2FsbCh0aGlzLCBpLCB0aGlzLmNsYXNzTmFtZSwgc3RhdGVWYWwpLCBzdGF0ZVZhbCApO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIGlmICggdHlwZSA9PT0gXCJzdHJpbmdcIiApIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gdG9nZ2xlIGluZGl2aWR1YWwgY2xhc3MgbmFtZXNcbiAgICAgICAgICAgICAgICAgICAgdmFyIGNsYXNzTmFtZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGkgPSAwLFxuICAgICAgICAgICAgICAgICAgICAgICAgc2VsZiA9IGpRdWVyeSggdGhpcyApLFxuICAgICAgICAgICAgICAgICAgICAgICAgc3RhdGUgPSBzdGF0ZVZhbCxcbiAgICAgICAgICAgICAgICAgICAgICAgIGNsYXNzTmFtZXMgPSB2YWx1ZS5zcGxpdCggcnNwYWNlICk7XG5cbiAgICAgICAgICAgICAgICAgICAgd2hpbGUgKCAoY2xhc3NOYW1lID0gY2xhc3NOYW1lc1sgaSsrIF0pICkge1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gY2hlY2sgZWFjaCBjbGFzc05hbWUgZ2l2ZW4sIHNwYWNlIHNlcGVyYXRlZCBsaXN0XG4gICAgICAgICAgICAgICAgICAgICAgICBzdGF0ZSA9IGlzQm9vbCA/IHN0YXRlIDogIXNlbGYuaGFzQ2xhc3MoIGNsYXNzTmFtZSApO1xuICAgICAgICAgICAgICAgICAgICAgICAgc2VsZlsgc3RhdGUgPyBcImFkZENsYXNzXCIgOiBcInJlbW92ZUNsYXNzXCIgXSggY2xhc3NOYW1lICk7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoIHR5cGUgPT09IFwidW5kZWZpbmVkXCIgfHwgdHlwZSA9PT0gXCJib29sZWFuXCIgKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICggdGhpcy5jbGFzc05hbWUgKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBzdG9yZSBjbGFzc05hbWUgaWYgc2V0XG4gICAgICAgICAgICAgICAgICAgICAgICBqUXVlcnkuX2RhdGEoIHRoaXMsIFwiX19jbGFzc05hbWVfX1wiLCB0aGlzLmNsYXNzTmFtZSApO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgLy8gdG9nZ2xlIHdob2xlIGNsYXNzTmFtZVxuICAgICAgICAgICAgICAgICAgICB0aGlzLmNsYXNzTmFtZSA9IHRoaXMuY2xhc3NOYW1lIHx8IHZhbHVlID09PSBmYWxzZSA/IFwiXCIgOiBqUXVlcnkuX2RhdGEoIHRoaXMsIFwiX19jbGFzc05hbWVfX1wiICkgfHwgXCJcIjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSxcblxuICAgICAgICBoYXNDbGFzczogZnVuY3Rpb24oIHNlbGVjdG9yICkge1xuICAgICAgICAgICAgdmFyIGNsYXNzTmFtZSA9IFwiIFwiICsgc2VsZWN0b3IgKyBcIiBcIixcbiAgICAgICAgICAgICAgICBpID0gMCxcbiAgICAgICAgICAgICAgICBsID0gdGhpcy5sZW5ndGg7XG4gICAgICAgICAgICBmb3IgKCA7IGkgPCBsOyBpKysgKSB7XG4gICAgICAgICAgICAgICAgaWYgKCB0aGlzW2ldLm5vZGVUeXBlID09PSAxICYmIChcIiBcIiArIHRoaXNbaV0uY2xhc3NOYW1lICsgXCIgXCIpLnJlcGxhY2UocmNsYXNzLCBcIiBcIikuaW5kZXhPZiggY2xhc3NOYW1lICkgPiAtMSApIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH0sXG5cbiAgICAgICAgdmFsOiBmdW5jdGlvbiggdmFsdWUgKSB7XG4gICAgICAgICAgICB2YXIgaG9va3MsIHJldCwgaXNGdW5jdGlvbixcbiAgICAgICAgICAgICAgICBlbGVtID0gdGhpc1swXTtcblxuICAgICAgICAgICAgaWYgKCAhYXJndW1lbnRzLmxlbmd0aCApIHtcbiAgICAgICAgICAgICAgICBpZiAoIGVsZW0gKSB7XG4gICAgICAgICAgICAgICAgICAgIGhvb2tzID0galF1ZXJ5LnZhbEhvb2tzWyBlbGVtLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCkgXSB8fCBqUXVlcnkudmFsSG9va3NbIGVsZW0udHlwZSBdO1xuXG4gICAgICAgICAgICAgICAgICAgIGlmICggaG9va3MgJiYgXCJnZXRcIiBpbiBob29rcyAmJiAocmV0ID0gaG9va3MuZ2V0KCBlbGVtLCBcInZhbHVlXCIgKSkgIT09IHVuZGVmaW5lZCApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiByZXQ7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICByZXQgPSBlbGVtLnZhbHVlO1xuXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0eXBlb2YgcmV0ID09PSBcInN0cmluZ1wiID9cbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIGhhbmRsZSBtb3N0IGNvbW1vbiBzdHJpbmcgY2FzZXNcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldC5yZXBsYWNlKHJyZXR1cm4sIFwiXCIpIDpcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIGhhbmRsZSBjYXNlcyB3aGVyZSB2YWx1ZSBpcyBudWxsL3VuZGVmIG9yIG51bWJlclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0ID09IG51bGwgPyBcIlwiIDogcmV0O1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaXNGdW5jdGlvbiA9IGpRdWVyeS5pc0Z1bmN0aW9uKCB2YWx1ZSApO1xuXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKCBpICkge1xuICAgICAgICAgICAgICAgIHZhciBzZWxmID0galF1ZXJ5KHRoaXMpLCB2YWw7XG5cbiAgICAgICAgICAgICAgICBpZiAoIHRoaXMubm9kZVR5cGUgIT09IDEgKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBpZiAoIGlzRnVuY3Rpb24gKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhbCA9IHZhbHVlLmNhbGwoIHRoaXMsIGksIHNlbGYudmFsKCkgKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICB2YWwgPSB2YWx1ZTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAvLyBUcmVhdCBudWxsL3VuZGVmaW5lZCBhcyBcIlwiOyBjb252ZXJ0IG51bWJlcnMgdG8gc3RyaW5nXG4gICAgICAgICAgICAgICAgaWYgKCB2YWwgPT0gbnVsbCApIHtcbiAgICAgICAgICAgICAgICAgICAgdmFsID0gXCJcIjtcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKCB0eXBlb2YgdmFsID09PSBcIm51bWJlclwiICkge1xuICAgICAgICAgICAgICAgICAgICB2YWwgKz0gXCJcIjtcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKCBqUXVlcnkuaXNBcnJheSggdmFsICkgKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhbCA9IGpRdWVyeS5tYXAodmFsLCBmdW5jdGlvbiAoIHZhbHVlICkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHZhbHVlID09IG51bGwgPyBcIlwiIDogdmFsdWUgKyBcIlwiO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBob29rcyA9IGpRdWVyeS52YWxIb29rc1sgdGhpcy5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpIF0gfHwgalF1ZXJ5LnZhbEhvb2tzWyB0aGlzLnR5cGUgXTtcblxuICAgICAgICAgICAgICAgIC8vIElmIHNldCByZXR1cm5zIHVuZGVmaW5lZCwgZmFsbCBiYWNrIHRvIG5vcm1hbCBzZXR0aW5nXG4gICAgICAgICAgICAgICAgaWYgKCAhaG9va3MgfHwgIShcInNldFwiIGluIGhvb2tzKSB8fCBob29rcy5zZXQoIHRoaXMsIHZhbCwgXCJ2YWx1ZVwiICkgPT09IHVuZGVmaW5lZCApIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy52YWx1ZSA9IHZhbDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgIH0pO1xuXG4gICAgalF1ZXJ5LmV4dGVuZCh7XG4gICAgICAgIHZhbEhvb2tzOiB7XG4gICAgICAgICAgICBvcHRpb246IHtcbiAgICAgICAgICAgICAgICBnZXQ6IGZ1bmN0aW9uKCBlbGVtICkge1xuICAgICAgICAgICAgICAgICAgICAvLyBhdHRyaWJ1dGVzLnZhbHVlIGlzIHVuZGVmaW5lZCBpbiBCbGFja2JlcnJ5IDQuNyBidXRcbiAgICAgICAgICAgICAgICAgICAgLy8gdXNlcyAudmFsdWUuIFNlZSAjNjkzMlxuICAgICAgICAgICAgICAgICAgICB2YXIgdmFsID0gZWxlbS5hdHRyaWJ1dGVzLnZhbHVlO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gIXZhbCB8fCB2YWwuc3BlY2lmaWVkID8gZWxlbS52YWx1ZSA6IGVsZW0udGV4dDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgc2VsZWN0OiB7XG4gICAgICAgICAgICAgICAgZ2V0OiBmdW5jdGlvbiggZWxlbSApIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIHZhbHVlLCBpLCBtYXgsIG9wdGlvbixcbiAgICAgICAgICAgICAgICAgICAgICAgIGluZGV4ID0gZWxlbS5zZWxlY3RlZEluZGV4LFxuICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWVzID0gW10sXG4gICAgICAgICAgICAgICAgICAgICAgICBvcHRpb25zID0gZWxlbS5vcHRpb25zLFxuICAgICAgICAgICAgICAgICAgICAgICAgb25lID0gZWxlbS50eXBlID09PSBcInNlbGVjdC1vbmVcIjtcblxuICAgICAgICAgICAgICAgICAgICAvLyBOb3RoaW5nIHdhcyBzZWxlY3RlZFxuICAgICAgICAgICAgICAgICAgICBpZiAoIGluZGV4IDwgMCApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgLy8gTG9vcCB0aHJvdWdoIGFsbCB0aGUgc2VsZWN0ZWQgb3B0aW9uc1xuICAgICAgICAgICAgICAgICAgICBpID0gb25lID8gaW5kZXggOiAwO1xuICAgICAgICAgICAgICAgICAgICBtYXggPSBvbmUgPyBpbmRleCArIDEgOiBvcHRpb25zLmxlbmd0aDtcbiAgICAgICAgICAgICAgICAgICAgZm9yICggOyBpIDwgbWF4OyBpKysgKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBvcHRpb24gPSBvcHRpb25zWyBpIF07XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIERvbid0IHJldHVybiBvcHRpb25zIHRoYXQgYXJlIGRpc2FibGVkIG9yIGluIGEgZGlzYWJsZWQgb3B0Z3JvdXBcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICggb3B0aW9uLnNlbGVjdGVkICYmIChqUXVlcnkuc3VwcG9ydC5vcHREaXNhYmxlZCA/ICFvcHRpb24uZGlzYWJsZWQgOiBvcHRpb24uZ2V0QXR0cmlidXRlKFwiZGlzYWJsZWRcIikgPT09IG51bGwpICYmXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgKCFvcHRpb24ucGFyZW50Tm9kZS5kaXNhYmxlZCB8fCAhalF1ZXJ5Lm5vZGVOYW1lKCBvcHRpb24ucGFyZW50Tm9kZSwgXCJvcHRncm91cFwiICkpICkge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gR2V0IHRoZSBzcGVjaWZpYyB2YWx1ZSBmb3IgdGhlIG9wdGlvblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlID0galF1ZXJ5KCBvcHRpb24gKS52YWwoKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIFdlIGRvbid0IG5lZWQgYW4gYXJyYXkgZm9yIG9uZSBzZWxlY3RzXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCBvbmUgKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB2YWx1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBNdWx0aS1TZWxlY3RzIHJldHVybiBhbiBhcnJheVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlcy5wdXNoKCB2YWx1ZSApO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgLy8gRml4ZXMgQnVnICMyNTUxIC0tIHNlbGVjdC52YWwoKSBicm9rZW4gaW4gSUUgYWZ0ZXIgZm9ybS5yZXNldCgpXG4gICAgICAgICAgICAgICAgICAgIGlmICggb25lICYmICF2YWx1ZXMubGVuZ3RoICYmIG9wdGlvbnMubGVuZ3RoICkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGpRdWVyeSggb3B0aW9uc1sgaW5kZXggXSApLnZhbCgpO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHZhbHVlcztcbiAgICAgICAgICAgICAgICB9LFxuXG4gICAgICAgICAgICAgICAgc2V0OiBmdW5jdGlvbiggZWxlbSwgdmFsdWUgKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciB2YWx1ZXMgPSBqUXVlcnkubWFrZUFycmF5KCB2YWx1ZSApO1xuXG4gICAgICAgICAgICAgICAgICAgIGpRdWVyeShlbGVtKS5maW5kKFwib3B0aW9uXCIpLmVhY2goZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNlbGVjdGVkID0galF1ZXJ5LmluQXJyYXkoIGpRdWVyeSh0aGlzKS52YWwoKSwgdmFsdWVzICkgPj0gMDtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKCAhdmFsdWVzLmxlbmd0aCApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGVsZW0uc2VsZWN0ZWRJbmRleCA9IC0xO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB2YWx1ZXM7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIGF0dHJGbjoge1xuICAgICAgICAgICAgdmFsOiB0cnVlLFxuICAgICAgICAgICAgY3NzOiB0cnVlLFxuICAgICAgICAgICAgaHRtbDogdHJ1ZSxcbiAgICAgICAgICAgIHRleHQ6IHRydWUsXG4gICAgICAgICAgICBkYXRhOiB0cnVlLFxuICAgICAgICAgICAgd2lkdGg6IHRydWUsXG4gICAgICAgICAgICBoZWlnaHQ6IHRydWUsXG4gICAgICAgICAgICBvZmZzZXQ6IHRydWVcbiAgICAgICAgfSxcblxuICAgICAgICBhdHRyOiBmdW5jdGlvbiggZWxlbSwgbmFtZSwgdmFsdWUsIHBhc3MgKSB7XG4gICAgICAgICAgICB2YXIgcmV0LCBob29rcywgbm90eG1sLFxuICAgICAgICAgICAgICAgIG5UeXBlID0gZWxlbS5ub2RlVHlwZTtcblxuICAgICAgICAgICAgLy8gZG9uJ3QgZ2V0L3NldCBhdHRyaWJ1dGVzIG9uIHRleHQsIGNvbW1lbnQgYW5kIGF0dHJpYnV0ZSBub2Rlc1xuICAgICAgICAgICAgaWYgKCAhZWxlbSB8fCBuVHlwZSA9PT0gMyB8fCBuVHlwZSA9PT0gOCB8fCBuVHlwZSA9PT0gMiApIHtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmICggcGFzcyAmJiBuYW1lIGluIGpRdWVyeS5hdHRyRm4gKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGpRdWVyeSggZWxlbSApWyBuYW1lIF0oIHZhbHVlICk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIEZhbGxiYWNrIHRvIHByb3Agd2hlbiBhdHRyaWJ1dGVzIGFyZSBub3Qgc3VwcG9ydGVkXG4gICAgICAgICAgICBpZiAoIHR5cGVvZiBlbGVtLmdldEF0dHJpYnV0ZSA9PT0gXCJ1bmRlZmluZWRcIiApIHtcbiAgICAgICAgICAgICAgICByZXR1cm4galF1ZXJ5LnByb3AoIGVsZW0sIG5hbWUsIHZhbHVlICk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIG5vdHhtbCA9IG5UeXBlICE9PSAxIHx8ICFqUXVlcnkuaXNYTUxEb2MoIGVsZW0gKTtcblxuICAgICAgICAgICAgLy8gQWxsIGF0dHJpYnV0ZXMgYXJlIGxvd2VyY2FzZVxuICAgICAgICAgICAgLy8gR3JhYiBuZWNlc3NhcnkgaG9vayBpZiBvbmUgaXMgZGVmaW5lZFxuICAgICAgICAgICAgaWYgKCBub3R4bWwgKSB7XG4gICAgICAgICAgICAgICAgbmFtZSA9IG5hbWUudG9Mb3dlckNhc2UoKTtcbiAgICAgICAgICAgICAgICBob29rcyA9IGpRdWVyeS5hdHRySG9va3NbIG5hbWUgXSB8fCAoIHJib29sZWFuLnRlc3QoIG5hbWUgKSA/IGJvb2xIb29rIDogbm9kZUhvb2sgKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKCB2YWx1ZSAhPT0gdW5kZWZpbmVkICkge1xuXG4gICAgICAgICAgICAgICAgaWYgKCB2YWx1ZSA9PT0gbnVsbCApIHtcbiAgICAgICAgICAgICAgICAgICAgalF1ZXJ5LnJlbW92ZUF0dHIoIGVsZW0sIG5hbWUgKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuXG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmICggaG9va3MgJiYgXCJzZXRcIiBpbiBob29rcyAmJiBub3R4bWwgJiYgKHJldCA9IGhvb2tzLnNldCggZWxlbSwgdmFsdWUsIG5hbWUgKSkgIT09IHVuZGVmaW5lZCApIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJldDtcblxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGVsZW0uc2V0QXR0cmlidXRlKCBuYW1lLCBcIlwiICsgdmFsdWUgKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHZhbHVlO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgfSBlbHNlIGlmICggaG9va3MgJiYgXCJnZXRcIiBpbiBob29rcyAmJiBub3R4bWwgJiYgKHJldCA9IGhvb2tzLmdldCggZWxlbSwgbmFtZSApKSAhPT0gbnVsbCApIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gcmV0O1xuXG4gICAgICAgICAgICB9IGVsc2Uge1xuXG4gICAgICAgICAgICAgICAgcmV0ID0gZWxlbS5nZXRBdHRyaWJ1dGUoIG5hbWUgKTtcblxuICAgICAgICAgICAgICAgIC8vIE5vbi1leGlzdGVudCBhdHRyaWJ1dGVzIHJldHVybiBudWxsLCB3ZSBub3JtYWxpemUgdG8gdW5kZWZpbmVkXG4gICAgICAgICAgICAgICAgcmV0dXJuIHJldCA9PT0gbnVsbCA/XG4gICAgICAgICAgICAgICAgICAgIHVuZGVmaW5lZCA6XG4gICAgICAgICAgICAgICAgICAgIHJldDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcblxuICAgICAgICByZW1vdmVBdHRyOiBmdW5jdGlvbiggZWxlbSwgdmFsdWUgKSB7XG4gICAgICAgICAgICB2YXIgcHJvcE5hbWUsIGF0dHJOYW1lcywgbmFtZSwgbCxcbiAgICAgICAgICAgICAgICBpID0gMDtcblxuICAgICAgICAgICAgaWYgKCB2YWx1ZSAmJiBlbGVtLm5vZGVUeXBlID09PSAxICkge1xuICAgICAgICAgICAgICAgIGF0dHJOYW1lcyA9IHZhbHVlLnRvTG93ZXJDYXNlKCkuc3BsaXQoIHJzcGFjZSApO1xuICAgICAgICAgICAgICAgIGwgPSBhdHRyTmFtZXMubGVuZ3RoO1xuXG4gICAgICAgICAgICAgICAgZm9yICggOyBpIDwgbDsgaSsrICkge1xuICAgICAgICAgICAgICAgICAgICBuYW1lID0gYXR0ck5hbWVzWyBpIF07XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKCBuYW1lICkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcHJvcE5hbWUgPSBqUXVlcnkucHJvcEZpeFsgbmFtZSBdIHx8IG5hbWU7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFNlZSAjOTY5OSBmb3IgZXhwbGFuYXRpb24gb2YgdGhpcyBhcHByb2FjaCAoc2V0dGluZyBmaXJzdCwgdGhlbiByZW1vdmFsKVxuICAgICAgICAgICAgICAgICAgICAgICAgalF1ZXJ5LmF0dHIoIGVsZW0sIG5hbWUsIFwiXCIgKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGVsZW0ucmVtb3ZlQXR0cmlidXRlKCBnZXRTZXRBdHRyaWJ1dGUgPyBuYW1lIDogcHJvcE5hbWUgKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gU2V0IGNvcnJlc3BvbmRpbmcgcHJvcGVydHkgdG8gZmFsc2UgZm9yIGJvb2xlYW4gYXR0cmlidXRlc1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCByYm9vbGVhbi50ZXN0KCBuYW1lICkgJiYgcHJvcE5hbWUgaW4gZWxlbSApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbGVtWyBwcm9wTmFtZSBdID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sXG5cbiAgICAgICAgYXR0ckhvb2tzOiB7XG4gICAgICAgICAgICB0eXBlOiB7XG4gICAgICAgICAgICAgICAgc2V0OiBmdW5jdGlvbiggZWxlbSwgdmFsdWUgKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIFdlIGNhbid0IGFsbG93IHRoZSB0eXBlIHByb3BlcnR5IHRvIGJlIGNoYW5nZWQgKHNpbmNlIGl0IGNhdXNlcyBwcm9ibGVtcyBpbiBJRSlcbiAgICAgICAgICAgICAgICAgICAgaWYgKCBydHlwZS50ZXN0KCBlbGVtLm5vZGVOYW1lICkgJiYgZWxlbS5wYXJlbnROb2RlICkge1xuICAgICAgICAgICAgICAgICAgICAgICAgalF1ZXJ5LmVycm9yKCBcInR5cGUgcHJvcGVydHkgY2FuJ3QgYmUgY2hhbmdlZFwiICk7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoICFqUXVlcnkuc3VwcG9ydC5yYWRpb1ZhbHVlICYmIHZhbHVlID09PSBcInJhZGlvXCIgJiYgalF1ZXJ5Lm5vZGVOYW1lKGVsZW0sIFwiaW5wdXRcIikgKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBTZXR0aW5nIHRoZSB0eXBlIG9uIGEgcmFkaW8gYnV0dG9uIGFmdGVyIHRoZSB2YWx1ZSByZXNldHMgdGhlIHZhbHVlIGluIElFNi05XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBSZXNldCB2YWx1ZSB0byBpdCdzIGRlZmF1bHQgaW4gY2FzZSB0eXBlIGlzIHNldCBhZnRlciB2YWx1ZVxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gVGhpcyBpcyBmb3IgZWxlbWVudCBjcmVhdGlvblxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHZhbCA9IGVsZW0udmFsdWU7XG4gICAgICAgICAgICAgICAgICAgICAgICBlbGVtLnNldEF0dHJpYnV0ZSggXCJ0eXBlXCIsIHZhbHVlICk7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoIHZhbCApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbGVtLnZhbHVlID0gdmFsO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHZhbHVlO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIC8vIFVzZSB0aGUgdmFsdWUgcHJvcGVydHkgZm9yIGJhY2sgY29tcGF0XG4gICAgICAgICAgICAvLyBVc2UgdGhlIG5vZGVIb29rIGZvciBidXR0b24gZWxlbWVudHMgaW4gSUU2LzcgKCMxOTU0KVxuICAgICAgICAgICAgdmFsdWU6IHtcbiAgICAgICAgICAgICAgICBnZXQ6IGZ1bmN0aW9uKCBlbGVtLCBuYW1lICkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoIG5vZGVIb29rICYmIGpRdWVyeS5ub2RlTmFtZSggZWxlbSwgXCJidXR0b25cIiApICkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5vZGVIb29rLmdldCggZWxlbSwgbmFtZSApO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBuYW1lIGluIGVsZW0gP1xuICAgICAgICAgICAgICAgICAgICAgICAgZWxlbS52YWx1ZSA6XG4gICAgICAgICAgICAgICAgICAgICAgICBudWxsO1xuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgc2V0OiBmdW5jdGlvbiggZWxlbSwgdmFsdWUsIG5hbWUgKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICggbm9kZUhvb2sgJiYgalF1ZXJ5Lm5vZGVOYW1lKCBlbGVtLCBcImJ1dHRvblwiICkgKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gbm9kZUhvb2suc2V0KCBlbGVtLCB2YWx1ZSwgbmFtZSApO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIC8vIERvZXMgbm90IHJldHVybiBzbyB0aGF0IHNldEF0dHJpYnV0ZSBpcyBhbHNvIHVzZWRcbiAgICAgICAgICAgICAgICAgICAgZWxlbS52YWx1ZSA9IHZhbHVlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcblxuICAgICAgICBwcm9wRml4OiB7XG4gICAgICAgICAgICB0YWJpbmRleDogXCJ0YWJJbmRleFwiLFxuICAgICAgICAgICAgcmVhZG9ubHk6IFwicmVhZE9ubHlcIixcbiAgICAgICAgICAgIFwiZm9yXCI6IFwiaHRtbEZvclwiLFxuICAgICAgICAgICAgXCJjbGFzc1wiOiBcImNsYXNzTmFtZVwiLFxuICAgICAgICAgICAgbWF4bGVuZ3RoOiBcIm1heExlbmd0aFwiLFxuICAgICAgICAgICAgY2VsbHNwYWNpbmc6IFwiY2VsbFNwYWNpbmdcIixcbiAgICAgICAgICAgIGNlbGxwYWRkaW5nOiBcImNlbGxQYWRkaW5nXCIsXG4gICAgICAgICAgICByb3dzcGFuOiBcInJvd1NwYW5cIixcbiAgICAgICAgICAgIGNvbHNwYW46IFwiY29sU3BhblwiLFxuICAgICAgICAgICAgdXNlbWFwOiBcInVzZU1hcFwiLFxuICAgICAgICAgICAgZnJhbWVib3JkZXI6IFwiZnJhbWVCb3JkZXJcIixcbiAgICAgICAgICAgIGNvbnRlbnRlZGl0YWJsZTogXCJjb250ZW50RWRpdGFibGVcIlxuICAgICAgICB9LFxuXG4gICAgICAgIHByb3A6IGZ1bmN0aW9uKCBlbGVtLCBuYW1lLCB2YWx1ZSApIHtcbiAgICAgICAgICAgIHZhciByZXQsIGhvb2tzLCBub3R4bWwsXG4gICAgICAgICAgICAgICAgblR5cGUgPSBlbGVtLm5vZGVUeXBlO1xuXG4gICAgICAgICAgICAvLyBkb24ndCBnZXQvc2V0IHByb3BlcnRpZXMgb24gdGV4dCwgY29tbWVudCBhbmQgYXR0cmlidXRlIG5vZGVzXG4gICAgICAgICAgICBpZiAoICFlbGVtIHx8IG5UeXBlID09PSAzIHx8IG5UeXBlID09PSA4IHx8IG5UeXBlID09PSAyICkge1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgbm90eG1sID0gblR5cGUgIT09IDEgfHwgIWpRdWVyeS5pc1hNTERvYyggZWxlbSApO1xuXG4gICAgICAgICAgICBpZiAoIG5vdHhtbCApIHtcbiAgICAgICAgICAgICAgICAvLyBGaXggbmFtZSBhbmQgYXR0YWNoIGhvb2tzXG4gICAgICAgICAgICAgICAgbmFtZSA9IGpRdWVyeS5wcm9wRml4WyBuYW1lIF0gfHwgbmFtZTtcbiAgICAgICAgICAgICAgICBob29rcyA9IGpRdWVyeS5wcm9wSG9va3NbIG5hbWUgXTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKCB2YWx1ZSAhPT0gdW5kZWZpbmVkICkge1xuICAgICAgICAgICAgICAgIGlmICggaG9va3MgJiYgXCJzZXRcIiBpbiBob29rcyAmJiAocmV0ID0gaG9va3Muc2V0KCBlbGVtLCB2YWx1ZSwgbmFtZSApKSAhPT0gdW5kZWZpbmVkICkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmV0O1xuXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICggZWxlbVsgbmFtZSBdID0gdmFsdWUgKTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgaWYgKCBob29rcyAmJiBcImdldFwiIGluIGhvb2tzICYmIChyZXQgPSBob29rcy5nZXQoIGVsZW0sIG5hbWUgKSkgIT09IG51bGwgKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiByZXQ7XG5cbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZWxlbVsgbmFtZSBdO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcblxuICAgICAgICBwcm9wSG9va3M6IHtcbiAgICAgICAgICAgIHRhYkluZGV4OiB7XG4gICAgICAgICAgICAgICAgZ2V0OiBmdW5jdGlvbiggZWxlbSApIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gZWxlbS50YWJJbmRleCBkb2Vzbid0IGFsd2F5cyByZXR1cm4gdGhlIGNvcnJlY3QgdmFsdWUgd2hlbiBpdCBoYXNuJ3QgYmVlbiBleHBsaWNpdGx5IHNldFxuICAgICAgICAgICAgICAgICAgICAvLyBodHRwOi8vZmx1aWRwcm9qZWN0Lm9yZy9ibG9nLzIwMDgvMDEvMDkvZ2V0dGluZy1zZXR0aW5nLWFuZC1yZW1vdmluZy10YWJpbmRleC12YWx1ZXMtd2l0aC1qYXZhc2NyaXB0L1xuICAgICAgICAgICAgICAgICAgICB2YXIgYXR0cmlidXRlTm9kZSA9IGVsZW0uZ2V0QXR0cmlidXRlTm9kZShcInRhYmluZGV4XCIpO1xuXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBhdHRyaWJ1dGVOb2RlICYmIGF0dHJpYnV0ZU5vZGUuc3BlY2lmaWVkID9cbiAgICAgICAgICAgICAgICAgICAgICAgIHBhcnNlSW50KCBhdHRyaWJ1dGVOb2RlLnZhbHVlLCAxMCApIDpcbiAgICAgICAgICAgICAgICAgICAgICAgIHJmb2N1c2FibGUudGVzdCggZWxlbS5ub2RlTmFtZSApIHx8IHJjbGlja2FibGUudGVzdCggZWxlbS5ub2RlTmFtZSApICYmIGVsZW0uaHJlZiA/XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgMCA6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdW5kZWZpbmVkO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH0pO1xuXG4vLyBBZGQgdGhlIHRhYkluZGV4IHByb3BIb29rIHRvIGF0dHJIb29rcyBmb3IgYmFjay1jb21wYXQgKGRpZmZlcmVudCBjYXNlIGlzIGludGVudGlvbmFsKVxuICAgIGpRdWVyeS5hdHRySG9va3MudGFiaW5kZXggPSBqUXVlcnkucHJvcEhvb2tzLnRhYkluZGV4O1xuXG4vLyBIb29rIGZvciBib29sZWFuIGF0dHJpYnV0ZXNcbiAgICBib29sSG9vayA9IHtcbiAgICAgICAgZ2V0OiBmdW5jdGlvbiggZWxlbSwgbmFtZSApIHtcbiAgICAgICAgICAgIC8vIEFsaWduIGJvb2xlYW4gYXR0cmlidXRlcyB3aXRoIGNvcnJlc3BvbmRpbmcgcHJvcGVydGllc1xuICAgICAgICAgICAgLy8gRmFsbCBiYWNrIHRvIGF0dHJpYnV0ZSBwcmVzZW5jZSB3aGVyZSBzb21lIGJvb2xlYW5zIGFyZSBub3Qgc3VwcG9ydGVkXG4gICAgICAgICAgICB2YXIgYXR0ck5vZGUsXG4gICAgICAgICAgICAgICAgcHJvcGVydHkgPSBqUXVlcnkucHJvcCggZWxlbSwgbmFtZSApO1xuICAgICAgICAgICAgcmV0dXJuIHByb3BlcnR5ID09PSB0cnVlIHx8IHR5cGVvZiBwcm9wZXJ0eSAhPT0gXCJib29sZWFuXCIgJiYgKCBhdHRyTm9kZSA9IGVsZW0uZ2V0QXR0cmlidXRlTm9kZShuYW1lKSApICYmIGF0dHJOb2RlLm5vZGVWYWx1ZSAhPT0gZmFsc2UgP1xuICAgICAgICAgICAgICAgIG5hbWUudG9Mb3dlckNhc2UoKSA6XG4gICAgICAgICAgICAgICAgdW5kZWZpbmVkO1xuICAgICAgICB9LFxuICAgICAgICBzZXQ6IGZ1bmN0aW9uKCBlbGVtLCB2YWx1ZSwgbmFtZSApIHtcbiAgICAgICAgICAgIHZhciBwcm9wTmFtZTtcbiAgICAgICAgICAgIGlmICggdmFsdWUgPT09IGZhbHNlICkge1xuICAgICAgICAgICAgICAgIC8vIFJlbW92ZSBib29sZWFuIGF0dHJpYnV0ZXMgd2hlbiBzZXQgdG8gZmFsc2VcbiAgICAgICAgICAgICAgICBqUXVlcnkucmVtb3ZlQXR0ciggZWxlbSwgbmFtZSApO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAvLyB2YWx1ZSBpcyB0cnVlIHNpbmNlIHdlIGtub3cgYXQgdGhpcyBwb2ludCBpdCdzIHR5cGUgYm9vbGVhbiBhbmQgbm90IGZhbHNlXG4gICAgICAgICAgICAgICAgLy8gU2V0IGJvb2xlYW4gYXR0cmlidXRlcyB0byB0aGUgc2FtZSBuYW1lIGFuZCBzZXQgdGhlIERPTSBwcm9wZXJ0eVxuICAgICAgICAgICAgICAgIHByb3BOYW1lID0galF1ZXJ5LnByb3BGaXhbIG5hbWUgXSB8fCBuYW1lO1xuICAgICAgICAgICAgICAgIGlmICggcHJvcE5hbWUgaW4gZWxlbSApIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gT25seSBzZXQgdGhlIElETCBzcGVjaWZpY2FsbHkgaWYgaXQgYWxyZWFkeSBleGlzdHMgb24gdGhlIGVsZW1lbnRcbiAgICAgICAgICAgICAgICAgICAgZWxlbVsgcHJvcE5hbWUgXSA9IHRydWU7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgZWxlbS5zZXRBdHRyaWJ1dGUoIG5hbWUsIG5hbWUudG9Mb3dlckNhc2UoKSApO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIG5hbWU7XG4gICAgICAgIH1cbiAgICB9O1xuXG4vLyBJRTYvNyBkbyBub3Qgc3VwcG9ydCBnZXR0aW5nL3NldHRpbmcgc29tZSBhdHRyaWJ1dGVzIHdpdGggZ2V0L3NldEF0dHJpYnV0ZVxuICAgIGlmICggIWdldFNldEF0dHJpYnV0ZSApIHtcblxuICAgICAgICBmaXhTcGVjaWZpZWQgPSB7XG4gICAgICAgICAgICBuYW1lOiB0cnVlLFxuICAgICAgICAgICAgaWQ6IHRydWVcbiAgICAgICAgfTtcblxuICAgICAgICAvLyBVc2UgdGhpcyBmb3IgYW55IGF0dHJpYnV0ZSBpbiBJRTYvN1xuICAgICAgICAvLyBUaGlzIGZpeGVzIGFsbW9zdCBldmVyeSBJRTYvNyBpc3N1ZVxuICAgICAgICBub2RlSG9vayA9IGpRdWVyeS52YWxIb29rcy5idXR0b24gPSB7XG4gICAgICAgICAgICBnZXQ6IGZ1bmN0aW9uKCBlbGVtLCBuYW1lICkge1xuICAgICAgICAgICAgICAgIHZhciByZXQ7XG4gICAgICAgICAgICAgICAgcmV0ID0gZWxlbS5nZXRBdHRyaWJ1dGVOb2RlKCBuYW1lICk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHJldCAmJiAoIGZpeFNwZWNpZmllZFsgbmFtZSBdID8gcmV0Lm5vZGVWYWx1ZSAhPT0gXCJcIiA6IHJldC5zcGVjaWZpZWQgKSA/XG4gICAgICAgICAgICAgICAgICAgIHJldC5ub2RlVmFsdWUgOlxuICAgICAgICAgICAgICAgICAgICB1bmRlZmluZWQ7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgc2V0OiBmdW5jdGlvbiggZWxlbSwgdmFsdWUsIG5hbWUgKSB7XG4gICAgICAgICAgICAgICAgLy8gU2V0IHRoZSBleGlzdGluZyBvciBjcmVhdGUgYSBuZXcgYXR0cmlidXRlIG5vZGVcbiAgICAgICAgICAgICAgICB2YXIgcmV0ID0gZWxlbS5nZXRBdHRyaWJ1dGVOb2RlKCBuYW1lICk7XG4gICAgICAgICAgICAgICAgaWYgKCAhcmV0ICkge1xuICAgICAgICAgICAgICAgICAgICByZXQgPSBkb2N1bWVudC5jcmVhdGVBdHRyaWJ1dGUoIG5hbWUgKTtcbiAgICAgICAgICAgICAgICAgICAgZWxlbS5zZXRBdHRyaWJ1dGVOb2RlKCByZXQgKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV0dXJuICggcmV0Lm5vZGVWYWx1ZSA9IHZhbHVlICsgXCJcIiApO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuXG4gICAgICAgIC8vIEFwcGx5IHRoZSBub2RlSG9vayB0byB0YWJpbmRleFxuICAgICAgICBqUXVlcnkuYXR0ckhvb2tzLnRhYmluZGV4LnNldCA9IG5vZGVIb29rLnNldDtcblxuICAgICAgICAvLyBTZXQgd2lkdGggYW5kIGhlaWdodCB0byBhdXRvIGluc3RlYWQgb2YgMCBvbiBlbXB0eSBzdHJpbmcoIEJ1ZyAjODE1MCApXG4gICAgICAgIC8vIFRoaXMgaXMgZm9yIHJlbW92YWxzXG4gICAgICAgIGpRdWVyeS5lYWNoKFsgXCJ3aWR0aFwiLCBcImhlaWdodFwiIF0sIGZ1bmN0aW9uKCBpLCBuYW1lICkge1xuICAgICAgICAgICAgalF1ZXJ5LmF0dHJIb29rc1sgbmFtZSBdID0galF1ZXJ5LmV4dGVuZCggalF1ZXJ5LmF0dHJIb29rc1sgbmFtZSBdLCB7XG4gICAgICAgICAgICAgICAgc2V0OiBmdW5jdGlvbiggZWxlbSwgdmFsdWUgKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICggdmFsdWUgPT09IFwiXCIgKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBlbGVtLnNldEF0dHJpYnV0ZSggbmFtZSwgXCJhdXRvXCIgKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB2YWx1ZTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcblxuICAgICAgICAvLyBTZXQgY29udGVudGVkaXRhYmxlIHRvIGZhbHNlIG9uIHJlbW92YWxzKCMxMDQyOSlcbiAgICAgICAgLy8gU2V0dGluZyB0byBlbXB0eSBzdHJpbmcgdGhyb3dzIGFuIGVycm9yIGFzIGFuIGludmFsaWQgdmFsdWVcbiAgICAgICAgalF1ZXJ5LmF0dHJIb29rcy5jb250ZW50ZWRpdGFibGUgPSB7XG4gICAgICAgICAgICBnZXQ6IG5vZGVIb29rLmdldCxcbiAgICAgICAgICAgIHNldDogZnVuY3Rpb24oIGVsZW0sIHZhbHVlLCBuYW1lICkge1xuICAgICAgICAgICAgICAgIGlmICggdmFsdWUgPT09IFwiXCIgKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhbHVlID0gXCJmYWxzZVwiO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBub2RlSG9vay5zZXQoIGVsZW0sIHZhbHVlLCBuYW1lICk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgfVxuXG5cbi8vIFNvbWUgYXR0cmlidXRlcyByZXF1aXJlIGEgc3BlY2lhbCBjYWxsIG9uIElFXG4gICAgaWYgKCAhalF1ZXJ5LnN1cHBvcnQuaHJlZk5vcm1hbGl6ZWQgKSB7XG4gICAgICAgIGpRdWVyeS5lYWNoKFsgXCJocmVmXCIsIFwic3JjXCIsIFwid2lkdGhcIiwgXCJoZWlnaHRcIiBdLCBmdW5jdGlvbiggaSwgbmFtZSApIHtcbiAgICAgICAgICAgIGpRdWVyeS5hdHRySG9va3NbIG5hbWUgXSA9IGpRdWVyeS5leHRlbmQoIGpRdWVyeS5hdHRySG9va3NbIG5hbWUgXSwge1xuICAgICAgICAgICAgICAgIGdldDogZnVuY3Rpb24oIGVsZW0gKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciByZXQgPSBlbGVtLmdldEF0dHJpYnV0ZSggbmFtZSwgMiApO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmV0ID09PSBudWxsID8gdW5kZWZpbmVkIDogcmV0O1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBpZiAoICFqUXVlcnkuc3VwcG9ydC5zdHlsZSApIHtcbiAgICAgICAgalF1ZXJ5LmF0dHJIb29rcy5zdHlsZSA9IHtcbiAgICAgICAgICAgIGdldDogZnVuY3Rpb24oIGVsZW0gKSB7XG4gICAgICAgICAgICAgICAgLy8gUmV0dXJuIHVuZGVmaW5lZCBpbiB0aGUgY2FzZSBvZiBlbXB0eSBzdHJpbmdcbiAgICAgICAgICAgICAgICAvLyBOb3JtYWxpemUgdG8gbG93ZXJjYXNlIHNpbmNlIElFIHVwcGVyY2FzZXMgY3NzIHByb3BlcnR5IG5hbWVzXG4gICAgICAgICAgICAgICAgcmV0dXJuIGVsZW0uc3R5bGUuY3NzVGV4dC50b0xvd2VyQ2FzZSgpIHx8IHVuZGVmaW5lZDtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBzZXQ6IGZ1bmN0aW9uKCBlbGVtLCB2YWx1ZSApIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gKCBlbGVtLnN0eWxlLmNzc1RleHQgPSBcIlwiICsgdmFsdWUgKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICB9XG5cbi8vIFNhZmFyaSBtaXMtcmVwb3J0cyB0aGUgZGVmYXVsdCBzZWxlY3RlZCBwcm9wZXJ0eSBvZiBhbiBvcHRpb25cbi8vIEFjY2Vzc2luZyB0aGUgcGFyZW50J3Mgc2VsZWN0ZWRJbmRleCBwcm9wZXJ0eSBmaXhlcyBpdFxuICAgIGlmICggIWpRdWVyeS5zdXBwb3J0Lm9wdFNlbGVjdGVkICkge1xuICAgICAgICBqUXVlcnkucHJvcEhvb2tzLnNlbGVjdGVkID0galF1ZXJ5LmV4dGVuZCggalF1ZXJ5LnByb3BIb29rcy5zZWxlY3RlZCwge1xuICAgICAgICAgICAgZ2V0OiBmdW5jdGlvbiggZWxlbSApIHtcbiAgICAgICAgICAgICAgICB2YXIgcGFyZW50ID0gZWxlbS5wYXJlbnROb2RlO1xuXG4gICAgICAgICAgICAgICAgaWYgKCBwYXJlbnQgKSB7XG4gICAgICAgICAgICAgICAgICAgIHBhcmVudC5zZWxlY3RlZEluZGV4O1xuXG4gICAgICAgICAgICAgICAgICAgIC8vIE1ha2Ugc3VyZSB0aGF0IGl0IGFsc28gd29ya3Mgd2l0aCBvcHRncm91cHMsIHNlZSAjNTcwMVxuICAgICAgICAgICAgICAgICAgICBpZiAoIHBhcmVudC5wYXJlbnROb2RlICkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcGFyZW50LnBhcmVudE5vZGUuc2VsZWN0ZWRJbmRleDtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfVxuXG4vLyBJRTYvNyBjYWxsIGVuY3R5cGUgZW5jb2RpbmdcbiAgICBpZiAoICFqUXVlcnkuc3VwcG9ydC5lbmN0eXBlICkge1xuICAgICAgICBqUXVlcnkucHJvcEZpeC5lbmN0eXBlID0gXCJlbmNvZGluZ1wiO1xuICAgIH1cblxuLy8gUmFkaW9zIGFuZCBjaGVja2JveGVzIGdldHRlci9zZXR0ZXJcbiAgICBpZiAoICFqUXVlcnkuc3VwcG9ydC5jaGVja09uICkge1xuICAgICAgICBqUXVlcnkuZWFjaChbIFwicmFkaW9cIiwgXCJjaGVja2JveFwiIF0sIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgalF1ZXJ5LnZhbEhvb2tzWyB0aGlzIF0gPSB7XG4gICAgICAgICAgICAgICAgZ2V0OiBmdW5jdGlvbiggZWxlbSApIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gSGFuZGxlIHRoZSBjYXNlIHdoZXJlIGluIFdlYmtpdCBcIlwiIGlzIHJldHVybmVkIGluc3RlYWQgb2YgXCJvblwiIGlmIGEgdmFsdWUgaXNuJ3Qgc3BlY2lmaWVkXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBlbGVtLmdldEF0dHJpYnV0ZShcInZhbHVlXCIpID09PSBudWxsID8gXCJvblwiIDogZWxlbS52YWx1ZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9O1xuICAgICAgICB9KTtcbiAgICB9XG4gICAgalF1ZXJ5LmVhY2goWyBcInJhZGlvXCIsIFwiY2hlY2tib3hcIiBdLCBmdW5jdGlvbigpIHtcbiAgICAgICAgalF1ZXJ5LnZhbEhvb2tzWyB0aGlzIF0gPSBqUXVlcnkuZXh0ZW5kKCBqUXVlcnkudmFsSG9va3NbIHRoaXMgXSwge1xuICAgICAgICAgICAgc2V0OiBmdW5jdGlvbiggZWxlbSwgdmFsdWUgKSB7XG4gICAgICAgICAgICAgICAgaWYgKCBqUXVlcnkuaXNBcnJheSggdmFsdWUgKSApIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICggZWxlbS5jaGVja2VkID0galF1ZXJ5LmluQXJyYXkoIGpRdWVyeShlbGVtKS52YWwoKSwgdmFsdWUgKSA+PSAwICk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9KTtcblxuXG5cblxuICAgIHZhciByZm9ybUVsZW1zID0gL14oPzp0ZXh0YXJlYXxpbnB1dHxzZWxlY3QpJC9pLFxuICAgICAgICBydHlwZW5hbWVzcGFjZSA9IC9eKFteXFwuXSopPyg/OlxcLiguKykpPyQvLFxuICAgICAgICByaG92ZXJIYWNrID0gL1xcYmhvdmVyKFxcLlxcUyspP1xcYi8sXG4gICAgICAgIHJrZXlFdmVudCA9IC9ea2V5LyxcbiAgICAgICAgcm1vdXNlRXZlbnQgPSAvXig/Om1vdXNlfGNvbnRleHRtZW51KXxjbGljay8sXG4gICAgICAgIHJmb2N1c01vcnBoID0gL14oPzpmb2N1c2luZm9jdXN8Zm9jdXNvdXRibHVyKSQvLFxuICAgICAgICBycXVpY2tJcyA9IC9eKFxcdyopKD86IyhbXFx3XFwtXSspKT8oPzpcXC4oW1xcd1xcLV0rKSk/JC8sXG4gICAgICAgIHF1aWNrUGFyc2UgPSBmdW5jdGlvbiggc2VsZWN0b3IgKSB7XG4gICAgICAgICAgICB2YXIgcXVpY2sgPSBycXVpY2tJcy5leGVjKCBzZWxlY3RvciApO1xuICAgICAgICAgICAgaWYgKCBxdWljayApIHtcbiAgICAgICAgICAgICAgICAvLyAgIDAgIDEgICAgMiAgIDNcbiAgICAgICAgICAgICAgICAvLyBbIF8sIHRhZywgaWQsIGNsYXNzIF1cbiAgICAgICAgICAgICAgICBxdWlja1sxXSA9ICggcXVpY2tbMV0gfHwgXCJcIiApLnRvTG93ZXJDYXNlKCk7XG4gICAgICAgICAgICAgICAgcXVpY2tbM10gPSBxdWlja1szXSAmJiBuZXcgUmVnRXhwKCBcIig/Ol58XFxcXHMpXCIgKyBxdWlja1szXSArIFwiKD86XFxcXHN8JClcIiApO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIHF1aWNrO1xuICAgICAgICB9LFxuICAgICAgICBxdWlja0lzID0gZnVuY3Rpb24oIGVsZW0sIG0gKSB7XG4gICAgICAgICAgICB2YXIgYXR0cnMgPSBlbGVtLmF0dHJpYnV0ZXMgfHwge307XG4gICAgICAgICAgICByZXR1cm4gKFxuICAgICAgICAgICAgICAgICghbVsxXSB8fCBlbGVtLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCkgPT09IG1bMV0pICYmXG4gICAgICAgICAgICAgICAgKCFtWzJdIHx8IChhdHRycy5pZCB8fCB7fSkudmFsdWUgPT09IG1bMl0pICYmXG4gICAgICAgICAgICAgICAgKCFtWzNdIHx8IG1bM10udGVzdCggKGF0dHJzWyBcImNsYXNzXCIgXSB8fCB7fSkudmFsdWUgKSlcbiAgICAgICAgICAgICk7XG4gICAgICAgIH0sXG4gICAgICAgIGhvdmVySGFjayA9IGZ1bmN0aW9uKCBldmVudHMgKSB7XG4gICAgICAgICAgICByZXR1cm4galF1ZXJ5LmV2ZW50LnNwZWNpYWwuaG92ZXIgPyBldmVudHMgOiBldmVudHMucmVwbGFjZSggcmhvdmVySGFjaywgXCJtb3VzZWVudGVyJDEgbW91c2VsZWF2ZSQxXCIgKTtcbiAgICAgICAgfTtcblxuICAgIC8qXG4gICAgICogSGVscGVyIGZ1bmN0aW9ucyBmb3IgbWFuYWdpbmcgZXZlbnRzIC0tIG5vdCBwYXJ0IG9mIHRoZSBwdWJsaWMgaW50ZXJmYWNlLlxuICAgICAqIFByb3BzIHRvIERlYW4gRWR3YXJkcycgYWRkRXZlbnQgbGlicmFyeSBmb3IgbWFueSBvZiB0aGUgaWRlYXMuXG4gICAgICovXG4gICAgalF1ZXJ5LmV2ZW50ID0ge1xuXG4gICAgICAgIGFkZDogZnVuY3Rpb24oIGVsZW0sIHR5cGVzLCBoYW5kbGVyLCBkYXRhLCBzZWxlY3RvciApIHtcblxuICAgICAgICAgICAgdmFyIGVsZW1EYXRhLCBldmVudEhhbmRsZSwgZXZlbnRzLFxuICAgICAgICAgICAgICAgIHQsIHRucywgdHlwZSwgbmFtZXNwYWNlcywgaGFuZGxlT2JqLFxuICAgICAgICAgICAgICAgIGhhbmRsZU9iakluLCBxdWljaywgaGFuZGxlcnMsIHNwZWNpYWw7XG5cbiAgICAgICAgICAgIC8vIERvbid0IGF0dGFjaCBldmVudHMgdG8gbm9EYXRhIG9yIHRleHQvY29tbWVudCBub2RlcyAoYWxsb3cgcGxhaW4gb2JqZWN0cyB0aG8pXG4gICAgICAgICAgICBpZiAoIGVsZW0ubm9kZVR5cGUgPT09IDMgfHwgZWxlbS5ub2RlVHlwZSA9PT0gOCB8fCAhdHlwZXMgfHwgIWhhbmRsZXIgfHwgIShlbGVtRGF0YSA9IGpRdWVyeS5fZGF0YSggZWxlbSApKSApIHtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIENhbGxlciBjYW4gcGFzcyBpbiBhbiBvYmplY3Qgb2YgY3VzdG9tIGRhdGEgaW4gbGlldSBvZiB0aGUgaGFuZGxlclxuICAgICAgICAgICAgaWYgKCBoYW5kbGVyLmhhbmRsZXIgKSB7XG4gICAgICAgICAgICAgICAgaGFuZGxlT2JqSW4gPSBoYW5kbGVyO1xuICAgICAgICAgICAgICAgIGhhbmRsZXIgPSBoYW5kbGVPYmpJbi5oYW5kbGVyO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBNYWtlIHN1cmUgdGhhdCB0aGUgaGFuZGxlciBoYXMgYSB1bmlxdWUgSUQsIHVzZWQgdG8gZmluZC9yZW1vdmUgaXQgbGF0ZXJcbiAgICAgICAgICAgIGlmICggIWhhbmRsZXIuZ3VpZCApIHtcbiAgICAgICAgICAgICAgICBoYW5kbGVyLmd1aWQgPSBqUXVlcnkuZ3VpZCsrO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBJbml0IHRoZSBlbGVtZW50J3MgZXZlbnQgc3RydWN0dXJlIGFuZCBtYWluIGhhbmRsZXIsIGlmIHRoaXMgaXMgdGhlIGZpcnN0XG4gICAgICAgICAgICBldmVudHMgPSBlbGVtRGF0YS5ldmVudHM7XG4gICAgICAgICAgICBpZiAoICFldmVudHMgKSB7XG4gICAgICAgICAgICAgICAgZWxlbURhdGEuZXZlbnRzID0gZXZlbnRzID0ge307XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBldmVudEhhbmRsZSA9IGVsZW1EYXRhLmhhbmRsZTtcbiAgICAgICAgICAgIGlmICggIWV2ZW50SGFuZGxlICkge1xuICAgICAgICAgICAgICAgIGVsZW1EYXRhLmhhbmRsZSA9IGV2ZW50SGFuZGxlID0gZnVuY3Rpb24oIGUgKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIERpc2NhcmQgdGhlIHNlY29uZCBldmVudCBvZiBhIGpRdWVyeS5ldmVudC50cmlnZ2VyKCkgYW5kXG4gICAgICAgICAgICAgICAgICAgIC8vIHdoZW4gYW4gZXZlbnQgaXMgY2FsbGVkIGFmdGVyIGEgcGFnZSBoYXMgdW5sb2FkZWRcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHR5cGVvZiBqUXVlcnkgIT09IFwidW5kZWZpbmVkXCIgJiYgKCFlIHx8IGpRdWVyeS5ldmVudC50cmlnZ2VyZWQgIT09IGUudHlwZSkgP1xuICAgICAgICAgICAgICAgICAgICAgICAgalF1ZXJ5LmV2ZW50LmRpc3BhdGNoLmFwcGx5KCBldmVudEhhbmRsZS5lbGVtLCBhcmd1bWVudHMgKSA6XG4gICAgICAgICAgICAgICAgICAgICAgICB1bmRlZmluZWQ7XG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICAvLyBBZGQgZWxlbSBhcyBhIHByb3BlcnR5IG9mIHRoZSBoYW5kbGUgZm4gdG8gcHJldmVudCBhIG1lbW9yeSBsZWFrIHdpdGggSUUgbm9uLW5hdGl2ZSBldmVudHNcbiAgICAgICAgICAgICAgICBldmVudEhhbmRsZS5lbGVtID0gZWxlbTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gSGFuZGxlIG11bHRpcGxlIGV2ZW50cyBzZXBhcmF0ZWQgYnkgYSBzcGFjZVxuICAgICAgICAgICAgLy8galF1ZXJ5KC4uLikuYmluZChcIm1vdXNlb3ZlciBtb3VzZW91dFwiLCBmbik7XG4gICAgICAgICAgICB0eXBlcyA9IGpRdWVyeS50cmltKCBob3ZlckhhY2sodHlwZXMpICkuc3BsaXQoIFwiIFwiICk7XG4gICAgICAgICAgICBmb3IgKCB0ID0gMDsgdCA8IHR5cGVzLmxlbmd0aDsgdCsrICkge1xuXG4gICAgICAgICAgICAgICAgdG5zID0gcnR5cGVuYW1lc3BhY2UuZXhlYyggdHlwZXNbdF0gKSB8fCBbXTtcbiAgICAgICAgICAgICAgICB0eXBlID0gdG5zWzFdO1xuICAgICAgICAgICAgICAgIG5hbWVzcGFjZXMgPSAoIHRuc1syXSB8fCBcIlwiICkuc3BsaXQoIFwiLlwiICkuc29ydCgpO1xuXG4gICAgICAgICAgICAgICAgLy8gSWYgZXZlbnQgY2hhbmdlcyBpdHMgdHlwZSwgdXNlIHRoZSBzcGVjaWFsIGV2ZW50IGhhbmRsZXJzIGZvciB0aGUgY2hhbmdlZCB0eXBlXG4gICAgICAgICAgICAgICAgc3BlY2lhbCA9IGpRdWVyeS5ldmVudC5zcGVjaWFsWyB0eXBlIF0gfHwge307XG5cbiAgICAgICAgICAgICAgICAvLyBJZiBzZWxlY3RvciBkZWZpbmVkLCBkZXRlcm1pbmUgc3BlY2lhbCBldmVudCBhcGkgdHlwZSwgb3RoZXJ3aXNlIGdpdmVuIHR5cGVcbiAgICAgICAgICAgICAgICB0eXBlID0gKCBzZWxlY3RvciA/IHNwZWNpYWwuZGVsZWdhdGVUeXBlIDogc3BlY2lhbC5iaW5kVHlwZSApIHx8IHR5cGU7XG5cbiAgICAgICAgICAgICAgICAvLyBVcGRhdGUgc3BlY2lhbCBiYXNlZCBvbiBuZXdseSByZXNldCB0eXBlXG4gICAgICAgICAgICAgICAgc3BlY2lhbCA9IGpRdWVyeS5ldmVudC5zcGVjaWFsWyB0eXBlIF0gfHwge307XG5cbiAgICAgICAgICAgICAgICAvLyBoYW5kbGVPYmogaXMgcGFzc2VkIHRvIGFsbCBldmVudCBoYW5kbGVyc1xuICAgICAgICAgICAgICAgIGhhbmRsZU9iaiA9IGpRdWVyeS5leHRlbmQoe1xuICAgICAgICAgICAgICAgICAgICB0eXBlOiB0eXBlLFxuICAgICAgICAgICAgICAgICAgICBvcmlnVHlwZTogdG5zWzFdLFxuICAgICAgICAgICAgICAgICAgICBkYXRhOiBkYXRhLFxuICAgICAgICAgICAgICAgICAgICBoYW5kbGVyOiBoYW5kbGVyLFxuICAgICAgICAgICAgICAgICAgICBndWlkOiBoYW5kbGVyLmd1aWQsXG4gICAgICAgICAgICAgICAgICAgIHNlbGVjdG9yOiBzZWxlY3RvcixcbiAgICAgICAgICAgICAgICAgICAgcXVpY2s6IHF1aWNrUGFyc2UoIHNlbGVjdG9yICksXG4gICAgICAgICAgICAgICAgICAgIG5hbWVzcGFjZTogbmFtZXNwYWNlcy5qb2luKFwiLlwiKVxuICAgICAgICAgICAgICAgIH0sIGhhbmRsZU9iakluICk7XG5cbiAgICAgICAgICAgICAgICAvLyBJbml0IHRoZSBldmVudCBoYW5kbGVyIHF1ZXVlIGlmIHdlJ3JlIHRoZSBmaXJzdFxuICAgICAgICAgICAgICAgIGhhbmRsZXJzID0gZXZlbnRzWyB0eXBlIF07XG4gICAgICAgICAgICAgICAgaWYgKCAhaGFuZGxlcnMgKSB7XG4gICAgICAgICAgICAgICAgICAgIGhhbmRsZXJzID0gZXZlbnRzWyB0eXBlIF0gPSBbXTtcbiAgICAgICAgICAgICAgICAgICAgaGFuZGxlcnMuZGVsZWdhdGVDb3VudCA9IDA7XG5cbiAgICAgICAgICAgICAgICAgICAgLy8gT25seSB1c2UgYWRkRXZlbnRMaXN0ZW5lci9hdHRhY2hFdmVudCBpZiB0aGUgc3BlY2lhbCBldmVudHMgaGFuZGxlciByZXR1cm5zIGZhbHNlXG4gICAgICAgICAgICAgICAgICAgIGlmICggIXNwZWNpYWwuc2V0dXAgfHwgc3BlY2lhbC5zZXR1cC5jYWxsKCBlbGVtLCBkYXRhLCBuYW1lc3BhY2VzLCBldmVudEhhbmRsZSApID09PSBmYWxzZSApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIEJpbmQgdGhlIGdsb2JhbCBldmVudCBoYW5kbGVyIHRvIHRoZSBlbGVtZW50XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoIGVsZW0uYWRkRXZlbnRMaXN0ZW5lciApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbGVtLmFkZEV2ZW50TGlzdGVuZXIoIHR5cGUsIGV2ZW50SGFuZGxlLCBmYWxzZSApO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKCBlbGVtLmF0dGFjaEV2ZW50ICkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsZW0uYXR0YWNoRXZlbnQoIFwib25cIiArIHR5cGUsIGV2ZW50SGFuZGxlICk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBpZiAoIHNwZWNpYWwuYWRkICkge1xuICAgICAgICAgICAgICAgICAgICBzcGVjaWFsLmFkZC5jYWxsKCBlbGVtLCBoYW5kbGVPYmogKTtcblxuICAgICAgICAgICAgICAgICAgICBpZiAoICFoYW5kbGVPYmouaGFuZGxlci5ndWlkICkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaGFuZGxlT2JqLmhhbmRsZXIuZ3VpZCA9IGhhbmRsZXIuZ3VpZDtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIC8vIEFkZCB0byB0aGUgZWxlbWVudCdzIGhhbmRsZXIgbGlzdCwgZGVsZWdhdGVzIGluIGZyb250XG4gICAgICAgICAgICAgICAgaWYgKCBzZWxlY3RvciApIHtcbiAgICAgICAgICAgICAgICAgICAgaGFuZGxlcnMuc3BsaWNlKCBoYW5kbGVycy5kZWxlZ2F0ZUNvdW50KyssIDAsIGhhbmRsZU9iaiApO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGhhbmRsZXJzLnB1c2goIGhhbmRsZU9iaiApO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIC8vIEtlZXAgdHJhY2sgb2Ygd2hpY2ggZXZlbnRzIGhhdmUgZXZlciBiZWVuIHVzZWQsIGZvciBldmVudCBvcHRpbWl6YXRpb25cbiAgICAgICAgICAgICAgICBqUXVlcnkuZXZlbnQuZ2xvYmFsWyB0eXBlIF0gPSB0cnVlO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBOdWxsaWZ5IGVsZW0gdG8gcHJldmVudCBtZW1vcnkgbGVha3MgaW4gSUVcbiAgICAgICAgICAgIGVsZW0gPSBudWxsO1xuICAgICAgICB9LFxuXG4gICAgICAgIGdsb2JhbDoge30sXG5cbiAgICAgICAgLy8gRGV0YWNoIGFuIGV2ZW50IG9yIHNldCBvZiBldmVudHMgZnJvbSBhbiBlbGVtZW50XG4gICAgICAgIHJlbW92ZTogZnVuY3Rpb24oIGVsZW0sIHR5cGVzLCBoYW5kbGVyLCBzZWxlY3RvciwgbWFwcGVkVHlwZXMgKSB7XG5cbiAgICAgICAgICAgIHZhciBlbGVtRGF0YSA9IGpRdWVyeS5oYXNEYXRhKCBlbGVtICkgJiYgalF1ZXJ5Ll9kYXRhKCBlbGVtICksXG4gICAgICAgICAgICAgICAgdCwgdG5zLCB0eXBlLCBvcmlnVHlwZSwgbmFtZXNwYWNlcywgb3JpZ0NvdW50LFxuICAgICAgICAgICAgICAgIGosIGV2ZW50cywgc3BlY2lhbCwgaGFuZGxlLCBldmVudFR5cGUsIGhhbmRsZU9iajtcblxuICAgICAgICAgICAgaWYgKCAhZWxlbURhdGEgfHwgIShldmVudHMgPSBlbGVtRGF0YS5ldmVudHMpICkge1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gT25jZSBmb3IgZWFjaCB0eXBlLm5hbWVzcGFjZSBpbiB0eXBlczsgdHlwZSBtYXkgYmUgb21pdHRlZFxuICAgICAgICAgICAgdHlwZXMgPSBqUXVlcnkudHJpbSggaG92ZXJIYWNrKCB0eXBlcyB8fCBcIlwiICkgKS5zcGxpdChcIiBcIik7XG4gICAgICAgICAgICBmb3IgKCB0ID0gMDsgdCA8IHR5cGVzLmxlbmd0aDsgdCsrICkge1xuICAgICAgICAgICAgICAgIHRucyA9IHJ0eXBlbmFtZXNwYWNlLmV4ZWMoIHR5cGVzW3RdICkgfHwgW107XG4gICAgICAgICAgICAgICAgdHlwZSA9IG9yaWdUeXBlID0gdG5zWzFdO1xuICAgICAgICAgICAgICAgIG5hbWVzcGFjZXMgPSB0bnNbMl07XG5cbiAgICAgICAgICAgICAgICAvLyBVbmJpbmQgYWxsIGV2ZW50cyAob24gdGhpcyBuYW1lc3BhY2UsIGlmIHByb3ZpZGVkKSBmb3IgdGhlIGVsZW1lbnRcbiAgICAgICAgICAgICAgICBpZiAoICF0eXBlICkge1xuICAgICAgICAgICAgICAgICAgICBmb3IgKCB0eXBlIGluIGV2ZW50cyApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGpRdWVyeS5ldmVudC5yZW1vdmUoIGVsZW0sIHR5cGUgKyB0eXBlc1sgdCBdLCBoYW5kbGVyLCBzZWxlY3RvciwgdHJ1ZSApO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIHNwZWNpYWwgPSBqUXVlcnkuZXZlbnQuc3BlY2lhbFsgdHlwZSBdIHx8IHt9O1xuICAgICAgICAgICAgICAgIHR5cGUgPSAoIHNlbGVjdG9yPyBzcGVjaWFsLmRlbGVnYXRlVHlwZSA6IHNwZWNpYWwuYmluZFR5cGUgKSB8fCB0eXBlO1xuICAgICAgICAgICAgICAgIGV2ZW50VHlwZSA9IGV2ZW50c1sgdHlwZSBdIHx8IFtdO1xuICAgICAgICAgICAgICAgIG9yaWdDb3VudCA9IGV2ZW50VHlwZS5sZW5ndGg7XG4gICAgICAgICAgICAgICAgbmFtZXNwYWNlcyA9IG5hbWVzcGFjZXMgPyBuZXcgUmVnRXhwKFwiKF58XFxcXC4pXCIgKyBuYW1lc3BhY2VzLnNwbGl0KFwiLlwiKS5zb3J0KCkuam9pbihcIlxcXFwuKD86LipcXFxcLik/XCIpICsgXCIoXFxcXC58JClcIikgOiBudWxsO1xuXG4gICAgICAgICAgICAgICAgLy8gUmVtb3ZlIG1hdGNoaW5nIGV2ZW50c1xuICAgICAgICAgICAgICAgIGZvciAoIGogPSAwOyBqIDwgZXZlbnRUeXBlLmxlbmd0aDsgaisrICkge1xuICAgICAgICAgICAgICAgICAgICBoYW5kbGVPYmogPSBldmVudFR5cGVbIGogXTtcblxuICAgICAgICAgICAgICAgICAgICBpZiAoICggbWFwcGVkVHlwZXMgfHwgb3JpZ1R5cGUgPT09IGhhbmRsZU9iai5vcmlnVHlwZSApICYmXG4gICAgICAgICAgICAgICAgICAgICAgICAoICFoYW5kbGVyIHx8IGhhbmRsZXIuZ3VpZCA9PT0gaGFuZGxlT2JqLmd1aWQgKSAmJlxuICAgICAgICAgICAgICAgICAgICAgICAgKCAhbmFtZXNwYWNlcyB8fCBuYW1lc3BhY2VzLnRlc3QoIGhhbmRsZU9iai5uYW1lc3BhY2UgKSApICYmXG4gICAgICAgICAgICAgICAgICAgICAgICAoICFzZWxlY3RvciB8fCBzZWxlY3RvciA9PT0gaGFuZGxlT2JqLnNlbGVjdG9yIHx8IHNlbGVjdG9yID09PSBcIioqXCIgJiYgaGFuZGxlT2JqLnNlbGVjdG9yICkgKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBldmVudFR5cGUuc3BsaWNlKCBqLS0sIDEgKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCBoYW5kbGVPYmouc2VsZWN0b3IgKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZXZlbnRUeXBlLmRlbGVnYXRlQ291bnQtLTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICggc3BlY2lhbC5yZW1vdmUgKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc3BlY2lhbC5yZW1vdmUuY2FsbCggZWxlbSwgaGFuZGxlT2JqICk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAvLyBSZW1vdmUgZ2VuZXJpYyBldmVudCBoYW5kbGVyIGlmIHdlIHJlbW92ZWQgc29tZXRoaW5nIGFuZCBubyBtb3JlIGhhbmRsZXJzIGV4aXN0XG4gICAgICAgICAgICAgICAgLy8gKGF2b2lkcyBwb3RlbnRpYWwgZm9yIGVuZGxlc3MgcmVjdXJzaW9uIGR1cmluZyByZW1vdmFsIG9mIHNwZWNpYWwgZXZlbnQgaGFuZGxlcnMpXG4gICAgICAgICAgICAgICAgaWYgKCBldmVudFR5cGUubGVuZ3RoID09PSAwICYmIG9yaWdDb3VudCAhPT0gZXZlbnRUeXBlLmxlbmd0aCApIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCAhc3BlY2lhbC50ZWFyZG93biB8fCBzcGVjaWFsLnRlYXJkb3duLmNhbGwoIGVsZW0sIG5hbWVzcGFjZXMgKSA9PT0gZmFsc2UgKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBqUXVlcnkucmVtb3ZlRXZlbnQoIGVsZW0sIHR5cGUsIGVsZW1EYXRhLmhhbmRsZSApO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgZGVsZXRlIGV2ZW50c1sgdHlwZSBdO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gUmVtb3ZlIHRoZSBleHBhbmRvIGlmIGl0J3Mgbm8gbG9uZ2VyIHVzZWRcbiAgICAgICAgICAgIGlmICggalF1ZXJ5LmlzRW1wdHlPYmplY3QoIGV2ZW50cyApICkge1xuICAgICAgICAgICAgICAgIGhhbmRsZSA9IGVsZW1EYXRhLmhhbmRsZTtcbiAgICAgICAgICAgICAgICBpZiAoIGhhbmRsZSApIHtcbiAgICAgICAgICAgICAgICAgICAgaGFuZGxlLmVsZW0gPSBudWxsO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIC8vIHJlbW92ZURhdGEgYWxzbyBjaGVja3MgZm9yIGVtcHRpbmVzcyBhbmQgY2xlYXJzIHRoZSBleHBhbmRvIGlmIGVtcHR5XG4gICAgICAgICAgICAgICAgLy8gc28gdXNlIGl0IGluc3RlYWQgb2YgZGVsZXRlXG4gICAgICAgICAgICAgICAgalF1ZXJ5LnJlbW92ZURhdGEoIGVsZW0sIFsgXCJldmVudHNcIiwgXCJoYW5kbGVcIiBdLCB0cnVlICk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sXG5cbiAgICAgICAgLy8gRXZlbnRzIHRoYXQgYXJlIHNhZmUgdG8gc2hvcnQtY2lyY3VpdCBpZiBubyBoYW5kbGVycyBhcmUgYXR0YWNoZWQuXG4gICAgICAgIC8vIE5hdGl2ZSBET00gZXZlbnRzIHNob3VsZCBub3QgYmUgYWRkZWQsIHRoZXkgbWF5IGhhdmUgaW5saW5lIGhhbmRsZXJzLlxuICAgICAgICBjdXN0b21FdmVudDoge1xuICAgICAgICAgICAgXCJnZXREYXRhXCI6IHRydWUsXG4gICAgICAgICAgICBcInNldERhdGFcIjogdHJ1ZSxcbiAgICAgICAgICAgIFwiY2hhbmdlRGF0YVwiOiB0cnVlXG4gICAgICAgIH0sXG5cbiAgICAgICAgdHJpZ2dlcjogZnVuY3Rpb24oIGV2ZW50LCBkYXRhLCBlbGVtLCBvbmx5SGFuZGxlcnMgKSB7XG4gICAgICAgICAgICAvLyBEb24ndCBkbyBldmVudHMgb24gdGV4dCBhbmQgY29tbWVudCBub2Rlc1xuICAgICAgICAgICAgaWYgKCBlbGVtICYmIChlbGVtLm5vZGVUeXBlID09PSAzIHx8IGVsZW0ubm9kZVR5cGUgPT09IDgpICkge1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gRXZlbnQgb2JqZWN0IG9yIGV2ZW50IHR5cGVcbiAgICAgICAgICAgIHZhciB0eXBlID0gZXZlbnQudHlwZSB8fCBldmVudCxcbiAgICAgICAgICAgICAgICBuYW1lc3BhY2VzID0gW10sXG4gICAgICAgICAgICAgICAgY2FjaGUsIGV4Y2x1c2l2ZSwgaSwgY3VyLCBvbGQsIG9udHlwZSwgc3BlY2lhbCwgaGFuZGxlLCBldmVudFBhdGgsIGJ1YmJsZVR5cGU7XG5cbiAgICAgICAgICAgIC8vIGZvY3VzL2JsdXIgbW9ycGhzIHRvIGZvY3VzaW4vb3V0OyBlbnN1cmUgd2UncmUgbm90IGZpcmluZyB0aGVtIHJpZ2h0IG5vd1xuICAgICAgICAgICAgaWYgKCByZm9jdXNNb3JwaC50ZXN0KCB0eXBlICsgalF1ZXJ5LmV2ZW50LnRyaWdnZXJlZCApICkge1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKCB0eXBlLmluZGV4T2YoIFwiIVwiICkgPj0gMCApIHtcbiAgICAgICAgICAgICAgICAvLyBFeGNsdXNpdmUgZXZlbnRzIHRyaWdnZXIgb25seSBmb3IgdGhlIGV4YWN0IGV2ZW50IChubyBuYW1lc3BhY2VzKVxuICAgICAgICAgICAgICAgIHR5cGUgPSB0eXBlLnNsaWNlKDAsIC0xKTtcbiAgICAgICAgICAgICAgICBleGNsdXNpdmUgPSB0cnVlO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoIHR5cGUuaW5kZXhPZiggXCIuXCIgKSA+PSAwICkge1xuICAgICAgICAgICAgICAgIC8vIE5hbWVzcGFjZWQgdHJpZ2dlcjsgY3JlYXRlIGEgcmVnZXhwIHRvIG1hdGNoIGV2ZW50IHR5cGUgaW4gaGFuZGxlKClcbiAgICAgICAgICAgICAgICBuYW1lc3BhY2VzID0gdHlwZS5zcGxpdChcIi5cIik7XG4gICAgICAgICAgICAgICAgdHlwZSA9IG5hbWVzcGFjZXMuc2hpZnQoKTtcbiAgICAgICAgICAgICAgICBuYW1lc3BhY2VzLnNvcnQoKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKCAoIWVsZW0gfHwgalF1ZXJ5LmV2ZW50LmN1c3RvbUV2ZW50WyB0eXBlIF0pICYmICFqUXVlcnkuZXZlbnQuZ2xvYmFsWyB0eXBlIF0gKSB7XG4gICAgICAgICAgICAgICAgLy8gTm8galF1ZXJ5IGhhbmRsZXJzIGZvciB0aGlzIGV2ZW50IHR5cGUsIGFuZCBpdCBjYW4ndCBoYXZlIGlubGluZSBoYW5kbGVyc1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gQ2FsbGVyIGNhbiBwYXNzIGluIGFuIEV2ZW50LCBPYmplY3QsIG9yIGp1c3QgYW4gZXZlbnQgdHlwZSBzdHJpbmdcbiAgICAgICAgICAgIGV2ZW50ID0gdHlwZW9mIGV2ZW50ID09PSBcIm9iamVjdFwiID9cbiAgICAgICAgICAgICAgICAvLyBqUXVlcnkuRXZlbnQgb2JqZWN0XG4gICAgICAgICAgICAgICAgZXZlbnRbIGpRdWVyeS5leHBhbmRvIF0gPyBldmVudCA6XG4gICAgICAgICAgICAgICAgICAgIC8vIE9iamVjdCBsaXRlcmFsXG4gICAgICAgICAgICAgICAgICAgIG5ldyBqUXVlcnkuRXZlbnQoIHR5cGUsIGV2ZW50ICkgOlxuICAgICAgICAgICAgICAgIC8vIEp1c3QgdGhlIGV2ZW50IHR5cGUgKHN0cmluZylcbiAgICAgICAgICAgICAgICBuZXcgalF1ZXJ5LkV2ZW50KCB0eXBlICk7XG5cbiAgICAgICAgICAgIGV2ZW50LnR5cGUgPSB0eXBlO1xuICAgICAgICAgICAgZXZlbnQuaXNUcmlnZ2VyID0gdHJ1ZTtcbiAgICAgICAgICAgIGV2ZW50LmV4Y2x1c2l2ZSA9IGV4Y2x1c2l2ZTtcbiAgICAgICAgICAgIGV2ZW50Lm5hbWVzcGFjZSA9IG5hbWVzcGFjZXMuam9pbiggXCIuXCIgKTtcbiAgICAgICAgICAgIGV2ZW50Lm5hbWVzcGFjZV9yZSA9IGV2ZW50Lm5hbWVzcGFjZT8gbmV3IFJlZ0V4cChcIihefFxcXFwuKVwiICsgbmFtZXNwYWNlcy5qb2luKFwiXFxcXC4oPzouKlxcXFwuKT9cIikgKyBcIihcXFxcLnwkKVwiKSA6IG51bGw7XG4gICAgICAgICAgICBvbnR5cGUgPSB0eXBlLmluZGV4T2YoIFwiOlwiICkgPCAwID8gXCJvblwiICsgdHlwZSA6IFwiXCI7XG5cbiAgICAgICAgICAgIC8vIEhhbmRsZSBhIGdsb2JhbCB0cmlnZ2VyXG4gICAgICAgICAgICBpZiAoICFlbGVtICkge1xuXG4gICAgICAgICAgICAgICAgLy8gVE9ETzogU3RvcCB0YXVudGluZyB0aGUgZGF0YSBjYWNoZTsgcmVtb3ZlIGdsb2JhbCBldmVudHMgYW5kIGFsd2F5cyBhdHRhY2ggdG8gZG9jdW1lbnRcbiAgICAgICAgICAgICAgICBjYWNoZSA9IGpRdWVyeS5jYWNoZTtcbiAgICAgICAgICAgICAgICBmb3IgKCBpIGluIGNhY2hlICkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoIGNhY2hlWyBpIF0uZXZlbnRzICYmIGNhY2hlWyBpIF0uZXZlbnRzWyB0eXBlIF0gKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBqUXVlcnkuZXZlbnQudHJpZ2dlciggZXZlbnQsIGRhdGEsIGNhY2hlWyBpIF0uaGFuZGxlLmVsZW0sIHRydWUgKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIENsZWFuIHVwIHRoZSBldmVudCBpbiBjYXNlIGl0IGlzIGJlaW5nIHJldXNlZFxuICAgICAgICAgICAgZXZlbnQucmVzdWx0ID0gdW5kZWZpbmVkO1xuICAgICAgICAgICAgaWYgKCAhZXZlbnQudGFyZ2V0ICkge1xuICAgICAgICAgICAgICAgIGV2ZW50LnRhcmdldCA9IGVsZW07XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIENsb25lIGFueSBpbmNvbWluZyBkYXRhIGFuZCBwcmVwZW5kIHRoZSBldmVudCwgY3JlYXRpbmcgdGhlIGhhbmRsZXIgYXJnIGxpc3RcbiAgICAgICAgICAgIGRhdGEgPSBkYXRhICE9IG51bGwgPyBqUXVlcnkubWFrZUFycmF5KCBkYXRhICkgOiBbXTtcbiAgICAgICAgICAgIGRhdGEudW5zaGlmdCggZXZlbnQgKTtcblxuICAgICAgICAgICAgLy8gQWxsb3cgc3BlY2lhbCBldmVudHMgdG8gZHJhdyBvdXRzaWRlIHRoZSBsaW5lc1xuICAgICAgICAgICAgc3BlY2lhbCA9IGpRdWVyeS5ldmVudC5zcGVjaWFsWyB0eXBlIF0gfHwge307XG4gICAgICAgICAgICBpZiAoIHNwZWNpYWwudHJpZ2dlciAmJiBzcGVjaWFsLnRyaWdnZXIuYXBwbHkoIGVsZW0sIGRhdGEgKSA9PT0gZmFsc2UgKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBEZXRlcm1pbmUgZXZlbnQgcHJvcGFnYXRpb24gcGF0aCBpbiBhZHZhbmNlLCBwZXIgVzNDIGV2ZW50cyBzcGVjICgjOTk1MSlcbiAgICAgICAgICAgIC8vIEJ1YmJsZSB1cCB0byBkb2N1bWVudCwgdGhlbiB0byB3aW5kb3c7IHdhdGNoIGZvciBhIGdsb2JhbCBvd25lckRvY3VtZW50IHZhciAoIzk3MjQpXG4gICAgICAgICAgICBldmVudFBhdGggPSBbWyBlbGVtLCBzcGVjaWFsLmJpbmRUeXBlIHx8IHR5cGUgXV07XG4gICAgICAgICAgICBpZiAoICFvbmx5SGFuZGxlcnMgJiYgIXNwZWNpYWwubm9CdWJibGUgJiYgIWpRdWVyeS5pc1dpbmRvdyggZWxlbSApICkge1xuXG4gICAgICAgICAgICAgICAgYnViYmxlVHlwZSA9IHNwZWNpYWwuZGVsZWdhdGVUeXBlIHx8IHR5cGU7XG4gICAgICAgICAgICAgICAgY3VyID0gcmZvY3VzTW9ycGgudGVzdCggYnViYmxlVHlwZSArIHR5cGUgKSA/IGVsZW0gOiBlbGVtLnBhcmVudE5vZGU7XG4gICAgICAgICAgICAgICAgb2xkID0gbnVsbDtcbiAgICAgICAgICAgICAgICBmb3IgKCA7IGN1cjsgY3VyID0gY3VyLnBhcmVudE5vZGUgKSB7XG4gICAgICAgICAgICAgICAgICAgIGV2ZW50UGF0aC5wdXNoKFsgY3VyLCBidWJibGVUeXBlIF0pO1xuICAgICAgICAgICAgICAgICAgICBvbGQgPSBjdXI7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgLy8gT25seSBhZGQgd2luZG93IGlmIHdlIGdvdCB0byBkb2N1bWVudCAoZS5nLiwgbm90IHBsYWluIG9iaiBvciBkZXRhY2hlZCBET00pXG4gICAgICAgICAgICAgICAgaWYgKCBvbGQgJiYgb2xkID09PSBlbGVtLm93bmVyRG9jdW1lbnQgKSB7XG4gICAgICAgICAgICAgICAgICAgIGV2ZW50UGF0aC5wdXNoKFsgb2xkLmRlZmF1bHRWaWV3IHx8IG9sZC5wYXJlbnRXaW5kb3cgfHwgd2luZG93LCBidWJibGVUeXBlIF0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gRmlyZSBoYW5kbGVycyBvbiB0aGUgZXZlbnQgcGF0aFxuICAgICAgICAgICAgZm9yICggaSA9IDA7IGkgPCBldmVudFBhdGgubGVuZ3RoICYmICFldmVudC5pc1Byb3BhZ2F0aW9uU3RvcHBlZCgpOyBpKysgKSB7XG5cbiAgICAgICAgICAgICAgICBjdXIgPSBldmVudFBhdGhbaV1bMF07XG4gICAgICAgICAgICAgICAgZXZlbnQudHlwZSA9IGV2ZW50UGF0aFtpXVsxXTtcblxuICAgICAgICAgICAgICAgIGhhbmRsZSA9ICggalF1ZXJ5Ll9kYXRhKCBjdXIsIFwiZXZlbnRzXCIgKSB8fCB7fSApWyBldmVudC50eXBlIF0gJiYgalF1ZXJ5Ll9kYXRhKCBjdXIsIFwiaGFuZGxlXCIgKTtcbiAgICAgICAgICAgICAgICBpZiAoIGhhbmRsZSApIHtcbiAgICAgICAgICAgICAgICAgICAgaGFuZGxlLmFwcGx5KCBjdXIsIGRhdGEgKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgLy8gTm90ZSB0aGF0IHRoaXMgaXMgYSBiYXJlIEpTIGZ1bmN0aW9uIGFuZCBub3QgYSBqUXVlcnkgaGFuZGxlclxuICAgICAgICAgICAgICAgIGhhbmRsZSA9IG9udHlwZSAmJiBjdXJbIG9udHlwZSBdO1xuICAgICAgICAgICAgICAgIGlmICggaGFuZGxlICYmIGpRdWVyeS5hY2NlcHREYXRhKCBjdXIgKSAmJiBoYW5kbGUuYXBwbHkoIGN1ciwgZGF0YSApID09PSBmYWxzZSApIHtcbiAgICAgICAgICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBldmVudC50eXBlID0gdHlwZTtcblxuICAgICAgICAgICAgLy8gSWYgbm9ib2R5IHByZXZlbnRlZCB0aGUgZGVmYXVsdCBhY3Rpb24sIGRvIGl0IG5vd1xuICAgICAgICAgICAgaWYgKCAhb25seUhhbmRsZXJzICYmICFldmVudC5pc0RlZmF1bHRQcmV2ZW50ZWQoKSApIHtcblxuICAgICAgICAgICAgICAgIGlmICggKCFzcGVjaWFsLl9kZWZhdWx0IHx8IHNwZWNpYWwuX2RlZmF1bHQuYXBwbHkoIGVsZW0ub3duZXJEb2N1bWVudCwgZGF0YSApID09PSBmYWxzZSkgJiZcbiAgICAgICAgICAgICAgICAgICAgISh0eXBlID09PSBcImNsaWNrXCIgJiYgalF1ZXJ5Lm5vZGVOYW1lKCBlbGVtLCBcImFcIiApKSAmJiBqUXVlcnkuYWNjZXB0RGF0YSggZWxlbSApICkge1xuXG4gICAgICAgICAgICAgICAgICAgIC8vIENhbGwgYSBuYXRpdmUgRE9NIG1ldGhvZCBvbiB0aGUgdGFyZ2V0IHdpdGggdGhlIHNhbWUgbmFtZSBuYW1lIGFzIHRoZSBldmVudC5cbiAgICAgICAgICAgICAgICAgICAgLy8gQ2FuJ3QgdXNlIGFuIC5pc0Z1bmN0aW9uKCkgY2hlY2sgaGVyZSBiZWNhdXNlIElFNi83IGZhaWxzIHRoYXQgdGVzdC5cbiAgICAgICAgICAgICAgICAgICAgLy8gRG9uJ3QgZG8gZGVmYXVsdCBhY3Rpb25zIG9uIHdpbmRvdywgdGhhdCdzIHdoZXJlIGdsb2JhbCB2YXJpYWJsZXMgYmUgKCM2MTcwKVxuICAgICAgICAgICAgICAgICAgICAvLyBJRTw5IGRpZXMgb24gZm9jdXMvYmx1ciB0byBoaWRkZW4gZWxlbWVudCAoIzE0ODYpXG4gICAgICAgICAgICAgICAgICAgIGlmICggb250eXBlICYmIGVsZW1bIHR5cGUgXSAmJiAoKHR5cGUgIT09IFwiZm9jdXNcIiAmJiB0eXBlICE9PSBcImJsdXJcIikgfHwgZXZlbnQudGFyZ2V0Lm9mZnNldFdpZHRoICE9PSAwKSAmJiAhalF1ZXJ5LmlzV2luZG93KCBlbGVtICkgKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIERvbid0IHJlLXRyaWdnZXIgYW4gb25GT08gZXZlbnQgd2hlbiB3ZSBjYWxsIGl0cyBGT08oKSBtZXRob2RcbiAgICAgICAgICAgICAgICAgICAgICAgIG9sZCA9IGVsZW1bIG9udHlwZSBdO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoIG9sZCApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbGVtWyBvbnR5cGUgXSA9IG51bGw7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFByZXZlbnQgcmUtdHJpZ2dlcmluZyBvZiB0aGUgc2FtZSBldmVudCwgc2luY2Ugd2UgYWxyZWFkeSBidWJibGVkIGl0IGFib3ZlXG4gICAgICAgICAgICAgICAgICAgICAgICBqUXVlcnkuZXZlbnQudHJpZ2dlcmVkID0gdHlwZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGVsZW1bIHR5cGUgXSgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgalF1ZXJ5LmV2ZW50LnRyaWdnZXJlZCA9IHVuZGVmaW5lZDtcblxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCBvbGQgKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxlbVsgb250eXBlIF0gPSBvbGQ7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHJldHVybiBldmVudC5yZXN1bHQ7XG4gICAgICAgIH0sXG5cbiAgICAgICAgZGlzcGF0Y2g6IGZ1bmN0aW9uKCBldmVudCApIHtcblxuICAgICAgICAgICAgLy8gTWFrZSBhIHdyaXRhYmxlIGpRdWVyeS5FdmVudCBmcm9tIHRoZSBuYXRpdmUgZXZlbnQgb2JqZWN0XG4gICAgICAgICAgICBldmVudCA9IGpRdWVyeS5ldmVudC5maXgoIGV2ZW50IHx8IHdpbmRvdy5ldmVudCApO1xuXG4gICAgICAgICAgICB2YXIgaGFuZGxlcnMgPSAoIChqUXVlcnkuX2RhdGEoIHRoaXMsIFwiZXZlbnRzXCIgKSB8fCB7fSApWyBldmVudC50eXBlIF0gfHwgW10pLFxuICAgICAgICAgICAgICAgIGRlbGVnYXRlQ291bnQgPSBoYW5kbGVycy5kZWxlZ2F0ZUNvdW50LFxuICAgICAgICAgICAgICAgIGFyZ3MgPSBbXS5zbGljZS5jYWxsKCBhcmd1bWVudHMsIDAgKSxcbiAgICAgICAgICAgICAgICBydW5fYWxsID0gIWV2ZW50LmV4Y2x1c2l2ZSAmJiAhZXZlbnQubmFtZXNwYWNlLFxuICAgICAgICAgICAgICAgIGhhbmRsZXJRdWV1ZSA9IFtdLFxuICAgICAgICAgICAgICAgIGksIGosIGN1ciwganFjdXIsIHJldCwgc2VsTWF0Y2gsIG1hdGNoZWQsIG1hdGNoZXMsIGhhbmRsZU9iaiwgc2VsLCByZWxhdGVkO1xuXG4gICAgICAgICAgICAvLyBVc2UgdGhlIGZpeC1lZCBqUXVlcnkuRXZlbnQgcmF0aGVyIHRoYW4gdGhlIChyZWFkLW9ubHkpIG5hdGl2ZSBldmVudFxuICAgICAgICAgICAgYXJnc1swXSA9IGV2ZW50O1xuICAgICAgICAgICAgZXZlbnQuZGVsZWdhdGVUYXJnZXQgPSB0aGlzO1xuXG4gICAgICAgICAgICAvLyBEZXRlcm1pbmUgaGFuZGxlcnMgdGhhdCBzaG91bGQgcnVuIGlmIHRoZXJlIGFyZSBkZWxlZ2F0ZWQgZXZlbnRzXG4gICAgICAgICAgICAvLyBBdm9pZCBkaXNhYmxlZCBlbGVtZW50cyBpbiBJRSAoIzY5MTEpIGFuZCBub24tbGVmdC1jbGljayBidWJibGluZyBpbiBGaXJlZm94ICgjMzg2MSlcbiAgICAgICAgICAgIGlmICggZGVsZWdhdGVDb3VudCAmJiAhZXZlbnQudGFyZ2V0LmRpc2FibGVkICYmICEoZXZlbnQuYnV0dG9uICYmIGV2ZW50LnR5cGUgPT09IFwiY2xpY2tcIikgKSB7XG5cbiAgICAgICAgICAgICAgICAvLyBQcmVnZW5lcmF0ZSBhIHNpbmdsZSBqUXVlcnkgb2JqZWN0IGZvciByZXVzZSB3aXRoIC5pcygpXG4gICAgICAgICAgICAgICAganFjdXIgPSBqUXVlcnkodGhpcyk7XG4gICAgICAgICAgICAgICAganFjdXIuY29udGV4dCA9IHRoaXMub3duZXJEb2N1bWVudCB8fCB0aGlzO1xuXG4gICAgICAgICAgICAgICAgZm9yICggY3VyID0gZXZlbnQudGFyZ2V0OyBjdXIgIT0gdGhpczsgY3VyID0gY3VyLnBhcmVudE5vZGUgfHwgdGhpcyApIHtcbiAgICAgICAgICAgICAgICAgICAgc2VsTWF0Y2ggPSB7fTtcbiAgICAgICAgICAgICAgICAgICAgbWF0Y2hlcyA9IFtdO1xuICAgICAgICAgICAgICAgICAgICBqcWN1clswXSA9IGN1cjtcbiAgICAgICAgICAgICAgICAgICAgZm9yICggaSA9IDA7IGkgPCBkZWxlZ2F0ZUNvdW50OyBpKysgKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBoYW5kbGVPYmogPSBoYW5kbGVyc1sgaSBdO1xuICAgICAgICAgICAgICAgICAgICAgICAgc2VsID0gaGFuZGxlT2JqLnNlbGVjdG9yO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoIHNlbE1hdGNoWyBzZWwgXSA9PT0gdW5kZWZpbmVkICkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbE1hdGNoWyBzZWwgXSA9IChcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaGFuZGxlT2JqLnF1aWNrID8gcXVpY2tJcyggY3VyLCBoYW5kbGVPYmoucXVpY2sgKSA6IGpxY3VyLmlzKCBzZWwgKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoIHNlbE1hdGNoWyBzZWwgXSApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtYXRjaGVzLnB1c2goIGhhbmRsZU9iaiApO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGlmICggbWF0Y2hlcy5sZW5ndGggKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBoYW5kbGVyUXVldWUucHVzaCh7IGVsZW06IGN1ciwgbWF0Y2hlczogbWF0Y2hlcyB9KTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gQWRkIHRoZSByZW1haW5pbmcgKGRpcmVjdGx5LWJvdW5kKSBoYW5kbGVyc1xuICAgICAgICAgICAgaWYgKCBoYW5kbGVycy5sZW5ndGggPiBkZWxlZ2F0ZUNvdW50ICkge1xuICAgICAgICAgICAgICAgIGhhbmRsZXJRdWV1ZS5wdXNoKHsgZWxlbTogdGhpcywgbWF0Y2hlczogaGFuZGxlcnMuc2xpY2UoIGRlbGVnYXRlQ291bnQgKSB9KTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gUnVuIGRlbGVnYXRlcyBmaXJzdDsgdGhleSBtYXkgd2FudCB0byBzdG9wIHByb3BhZ2F0aW9uIGJlbmVhdGggdXNcbiAgICAgICAgICAgIGZvciAoIGkgPSAwOyBpIDwgaGFuZGxlclF1ZXVlLmxlbmd0aCAmJiAhZXZlbnQuaXNQcm9wYWdhdGlvblN0b3BwZWQoKTsgaSsrICkge1xuICAgICAgICAgICAgICAgIG1hdGNoZWQgPSBoYW5kbGVyUXVldWVbIGkgXTtcbiAgICAgICAgICAgICAgICBldmVudC5jdXJyZW50VGFyZ2V0ID0gbWF0Y2hlZC5lbGVtO1xuXG4gICAgICAgICAgICAgICAgZm9yICggaiA9IDA7IGogPCBtYXRjaGVkLm1hdGNoZXMubGVuZ3RoICYmICFldmVudC5pc0ltbWVkaWF0ZVByb3BhZ2F0aW9uU3RvcHBlZCgpOyBqKysgKSB7XG4gICAgICAgICAgICAgICAgICAgIGhhbmRsZU9iaiA9IG1hdGNoZWQubWF0Y2hlc1sgaiBdO1xuXG4gICAgICAgICAgICAgICAgICAgIC8vIFRyaWdnZXJlZCBldmVudCBtdXN0IGVpdGhlciAxKSBiZSBub24tZXhjbHVzaXZlIGFuZCBoYXZlIG5vIG5hbWVzcGFjZSwgb3JcbiAgICAgICAgICAgICAgICAgICAgLy8gMikgaGF2ZSBuYW1lc3BhY2UocykgYSBzdWJzZXQgb3IgZXF1YWwgdG8gdGhvc2UgaW4gdGhlIGJvdW5kIGV2ZW50IChib3RoIGNhbiBoYXZlIG5vIG5hbWVzcGFjZSkuXG4gICAgICAgICAgICAgICAgICAgIGlmICggcnVuX2FsbCB8fCAoIWV2ZW50Lm5hbWVzcGFjZSAmJiAhaGFuZGxlT2JqLm5hbWVzcGFjZSkgfHwgZXZlbnQubmFtZXNwYWNlX3JlICYmIGV2ZW50Lm5hbWVzcGFjZV9yZS50ZXN0KCBoYW5kbGVPYmoubmFtZXNwYWNlICkgKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIGV2ZW50LmRhdGEgPSBoYW5kbGVPYmouZGF0YTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGV2ZW50LmhhbmRsZU9iaiA9IGhhbmRsZU9iajtcblxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0ID0gKCAoalF1ZXJ5LmV2ZW50LnNwZWNpYWxbIGhhbmRsZU9iai5vcmlnVHlwZSBdIHx8IHt9KS5oYW5kbGUgfHwgaGFuZGxlT2JqLmhhbmRsZXIgKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5hcHBseSggbWF0Y2hlZC5lbGVtLCBhcmdzICk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICggcmV0ICE9PSB1bmRlZmluZWQgKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZXZlbnQucmVzdWx0ID0gcmV0O1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICggcmV0ID09PSBmYWxzZSApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByZXR1cm4gZXZlbnQucmVzdWx0O1xuICAgICAgICB9LFxuXG4gICAgICAgIC8vIEluY2x1ZGVzIHNvbWUgZXZlbnQgcHJvcHMgc2hhcmVkIGJ5IEtleUV2ZW50IGFuZCBNb3VzZUV2ZW50XG4gICAgICAgIC8vICoqKiBhdHRyQ2hhbmdlIGF0dHJOYW1lIHJlbGF0ZWROb2RlIHNyY0VsZW1lbnQgIGFyZSBub3Qgbm9ybWFsaXplZCwgbm9uLVczQywgZGVwcmVjYXRlZCwgd2lsbCBiZSByZW1vdmVkIGluIDEuOCAqKipcbiAgICAgICAgcHJvcHM6IFwiYXR0ckNoYW5nZSBhdHRyTmFtZSByZWxhdGVkTm9kZSBzcmNFbGVtZW50IGFsdEtleSBidWJibGVzIGNhbmNlbGFibGUgY3RybEtleSBjdXJyZW50VGFyZ2V0IGV2ZW50UGhhc2UgbWV0YUtleSByZWxhdGVkVGFyZ2V0IHNoaWZ0S2V5IHRhcmdldCB0aW1lU3RhbXAgdmlldyB3aGljaFwiLnNwbGl0KFwiIFwiKSxcblxuICAgICAgICBmaXhIb29rczoge30sXG5cbiAgICAgICAga2V5SG9va3M6IHtcbiAgICAgICAgICAgIHByb3BzOiBcImNoYXIgY2hhckNvZGUga2V5IGtleUNvZGVcIi5zcGxpdChcIiBcIiksXG4gICAgICAgICAgICBmaWx0ZXI6IGZ1bmN0aW9uKCBldmVudCwgb3JpZ2luYWwgKSB7XG5cbiAgICAgICAgICAgICAgICAvLyBBZGQgd2hpY2ggZm9yIGtleSBldmVudHNcbiAgICAgICAgICAgICAgICBpZiAoIGV2ZW50LndoaWNoID09IG51bGwgKSB7XG4gICAgICAgICAgICAgICAgICAgIGV2ZW50LndoaWNoID0gb3JpZ2luYWwuY2hhckNvZGUgIT0gbnVsbCA/IG9yaWdpbmFsLmNoYXJDb2RlIDogb3JpZ2luYWwua2V5Q29kZTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICByZXR1cm4gZXZlbnQ7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sXG5cbiAgICAgICAgbW91c2VIb29rczoge1xuICAgICAgICAgICAgcHJvcHM6IFwiYnV0dG9uIGJ1dHRvbnMgY2xpZW50WCBjbGllbnRZIGZyb21FbGVtZW50IG9mZnNldFggb2Zmc2V0WSBwYWdlWCBwYWdlWSBzY3JlZW5YIHNjcmVlblkgdG9FbGVtZW50XCIuc3BsaXQoXCIgXCIpLFxuICAgICAgICAgICAgZmlsdGVyOiBmdW5jdGlvbiggZXZlbnQsIG9yaWdpbmFsICkge1xuICAgICAgICAgICAgICAgIHZhciBldmVudERvYywgZG9jLCBib2R5LFxuICAgICAgICAgICAgICAgICAgICBidXR0b24gPSBvcmlnaW5hbC5idXR0b24sXG4gICAgICAgICAgICAgICAgICAgIGZyb21FbGVtZW50ID0gb3JpZ2luYWwuZnJvbUVsZW1lbnQ7XG5cbiAgICAgICAgICAgICAgICAvLyBDYWxjdWxhdGUgcGFnZVgvWSBpZiBtaXNzaW5nIGFuZCBjbGllbnRYL1kgYXZhaWxhYmxlXG4gICAgICAgICAgICAgICAgaWYgKCBldmVudC5wYWdlWCA9PSBudWxsICYmIG9yaWdpbmFsLmNsaWVudFggIT0gbnVsbCApIHtcbiAgICAgICAgICAgICAgICAgICAgZXZlbnREb2MgPSBldmVudC50YXJnZXQub3duZXJEb2N1bWVudCB8fCBkb2N1bWVudDtcbiAgICAgICAgICAgICAgICAgICAgZG9jID0gZXZlbnREb2MuZG9jdW1lbnRFbGVtZW50O1xuICAgICAgICAgICAgICAgICAgICBib2R5ID0gZXZlbnREb2MuYm9keTtcblxuICAgICAgICAgICAgICAgICAgICBldmVudC5wYWdlWCA9IG9yaWdpbmFsLmNsaWVudFggKyAoIGRvYyAmJiBkb2Muc2Nyb2xsTGVmdCB8fCBib2R5ICYmIGJvZHkuc2Nyb2xsTGVmdCB8fCAwICkgLSAoIGRvYyAmJiBkb2MuY2xpZW50TGVmdCB8fCBib2R5ICYmIGJvZHkuY2xpZW50TGVmdCB8fCAwICk7XG4gICAgICAgICAgICAgICAgICAgIGV2ZW50LnBhZ2VZID0gb3JpZ2luYWwuY2xpZW50WSArICggZG9jICYmIGRvYy5zY3JvbGxUb3AgIHx8IGJvZHkgJiYgYm9keS5zY3JvbGxUb3AgIHx8IDAgKSAtICggZG9jICYmIGRvYy5jbGllbnRUb3AgIHx8IGJvZHkgJiYgYm9keS5jbGllbnRUb3AgIHx8IDAgKTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAvLyBBZGQgcmVsYXRlZFRhcmdldCwgaWYgbmVjZXNzYXJ5XG4gICAgICAgICAgICAgICAgaWYgKCAhZXZlbnQucmVsYXRlZFRhcmdldCAmJiBmcm9tRWxlbWVudCApIHtcbiAgICAgICAgICAgICAgICAgICAgZXZlbnQucmVsYXRlZFRhcmdldCA9IGZyb21FbGVtZW50ID09PSBldmVudC50YXJnZXQgPyBvcmlnaW5hbC50b0VsZW1lbnQgOiBmcm9tRWxlbWVudDtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAvLyBBZGQgd2hpY2ggZm9yIGNsaWNrOiAxID09PSBsZWZ0OyAyID09PSBtaWRkbGU7IDMgPT09IHJpZ2h0XG4gICAgICAgICAgICAgICAgLy8gTm90ZTogYnV0dG9uIGlzIG5vdCBub3JtYWxpemVkLCBzbyBkb24ndCB1c2UgaXRcbiAgICAgICAgICAgICAgICBpZiAoICFldmVudC53aGljaCAmJiBidXR0b24gIT09IHVuZGVmaW5lZCApIHtcbiAgICAgICAgICAgICAgICAgICAgZXZlbnQud2hpY2ggPSAoIGJ1dHRvbiAmIDEgPyAxIDogKCBidXR0b24gJiAyID8gMyA6ICggYnV0dG9uICYgNCA/IDIgOiAwICkgKSApO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIHJldHVybiBldmVudDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcblxuICAgICAgICBmaXg6IGZ1bmN0aW9uKCBldmVudCApIHtcbiAgICAgICAgICAgIGlmICggZXZlbnRbIGpRdWVyeS5leHBhbmRvIF0gKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGV2ZW50O1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBDcmVhdGUgYSB3cml0YWJsZSBjb3B5IG9mIHRoZSBldmVudCBvYmplY3QgYW5kIG5vcm1hbGl6ZSBzb21lIHByb3BlcnRpZXNcbiAgICAgICAgICAgIHZhciBpLCBwcm9wLFxuICAgICAgICAgICAgICAgIG9yaWdpbmFsRXZlbnQgPSBldmVudCxcbiAgICAgICAgICAgICAgICBmaXhIb29rID0galF1ZXJ5LmV2ZW50LmZpeEhvb2tzWyBldmVudC50eXBlIF0gfHwge30sXG4gICAgICAgICAgICAgICAgY29weSA9IGZpeEhvb2sucHJvcHMgPyB0aGlzLnByb3BzLmNvbmNhdCggZml4SG9vay5wcm9wcyApIDogdGhpcy5wcm9wcztcblxuICAgICAgICAgICAgZXZlbnQgPSBqUXVlcnkuRXZlbnQoIG9yaWdpbmFsRXZlbnQgKTtcblxuICAgICAgICAgICAgZm9yICggaSA9IGNvcHkubGVuZ3RoOyBpOyApIHtcbiAgICAgICAgICAgICAgICBwcm9wID0gY29weVsgLS1pIF07XG4gICAgICAgICAgICAgICAgZXZlbnRbIHByb3AgXSA9IG9yaWdpbmFsRXZlbnRbIHByb3AgXTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gRml4IHRhcmdldCBwcm9wZXJ0eSwgaWYgbmVjZXNzYXJ5ICgjMTkyNSwgSUUgNi83LzggJiBTYWZhcmkyKVxuICAgICAgICAgICAgaWYgKCAhZXZlbnQudGFyZ2V0ICkge1xuICAgICAgICAgICAgICAgIGV2ZW50LnRhcmdldCA9IG9yaWdpbmFsRXZlbnQuc3JjRWxlbWVudCB8fCBkb2N1bWVudDtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gVGFyZ2V0IHNob3VsZCBub3QgYmUgYSB0ZXh0IG5vZGUgKCM1MDQsIFNhZmFyaSlcbiAgICAgICAgICAgIGlmICggZXZlbnQudGFyZ2V0Lm5vZGVUeXBlID09PSAzICkge1xuICAgICAgICAgICAgICAgIGV2ZW50LnRhcmdldCA9IGV2ZW50LnRhcmdldC5wYXJlbnROb2RlO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBGb3IgbW91c2Uva2V5IGV2ZW50czsgYWRkIG1ldGFLZXkgaWYgaXQncyBub3QgdGhlcmUgKCMzMzY4LCBJRTYvNy84KVxuICAgICAgICAgICAgaWYgKCBldmVudC5tZXRhS2V5ID09PSB1bmRlZmluZWQgKSB7XG4gICAgICAgICAgICAgICAgZXZlbnQubWV0YUtleSA9IGV2ZW50LmN0cmxLZXk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHJldHVybiBmaXhIb29rLmZpbHRlcj8gZml4SG9vay5maWx0ZXIoIGV2ZW50LCBvcmlnaW5hbEV2ZW50ICkgOiBldmVudDtcbiAgICAgICAgfSxcblxuICAgICAgICBzcGVjaWFsOiB7XG4gICAgICAgICAgICByZWFkeToge1xuICAgICAgICAgICAgICAgIC8vIE1ha2Ugc3VyZSB0aGUgcmVhZHkgZXZlbnQgaXMgc2V0dXBcbiAgICAgICAgICAgICAgICBzZXR1cDogalF1ZXJ5LmJpbmRSZWFkeVxuICAgICAgICAgICAgfSxcblxuICAgICAgICAgICAgbG9hZDoge1xuICAgICAgICAgICAgICAgIC8vIFByZXZlbnQgdHJpZ2dlcmVkIGltYWdlLmxvYWQgZXZlbnRzIGZyb20gYnViYmxpbmcgdG8gd2luZG93LmxvYWRcbiAgICAgICAgICAgICAgICBub0J1YmJsZTogdHJ1ZVxuICAgICAgICAgICAgfSxcblxuICAgICAgICAgICAgZm9jdXM6IHtcbiAgICAgICAgICAgICAgICBkZWxlZ2F0ZVR5cGU6IFwiZm9jdXNpblwiXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgYmx1cjoge1xuICAgICAgICAgICAgICAgIGRlbGVnYXRlVHlwZTogXCJmb2N1c291dFwiXG4gICAgICAgICAgICB9LFxuXG4gICAgICAgICAgICBiZWZvcmV1bmxvYWQ6IHtcbiAgICAgICAgICAgICAgICBzZXR1cDogZnVuY3Rpb24oIGRhdGEsIG5hbWVzcGFjZXMsIGV2ZW50SGFuZGxlICkge1xuICAgICAgICAgICAgICAgICAgICAvLyBXZSBvbmx5IHdhbnQgdG8gZG8gdGhpcyBzcGVjaWFsIGNhc2Ugb24gd2luZG93c1xuICAgICAgICAgICAgICAgICAgICBpZiAoIGpRdWVyeS5pc1dpbmRvdyggdGhpcyApICkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5vbmJlZm9yZXVubG9hZCA9IGV2ZW50SGFuZGxlO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSxcblxuICAgICAgICAgICAgICAgIHRlYXJkb3duOiBmdW5jdGlvbiggbmFtZXNwYWNlcywgZXZlbnRIYW5kbGUgKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICggdGhpcy5vbmJlZm9yZXVubG9hZCA9PT0gZXZlbnRIYW5kbGUgKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLm9uYmVmb3JldW5sb2FkID0gbnVsbDtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcblxuICAgICAgICBzaW11bGF0ZTogZnVuY3Rpb24oIHR5cGUsIGVsZW0sIGV2ZW50LCBidWJibGUgKSB7XG4gICAgICAgICAgICAvLyBQaWdneWJhY2sgb24gYSBkb25vciBldmVudCB0byBzaW11bGF0ZSBhIGRpZmZlcmVudCBvbmUuXG4gICAgICAgICAgICAvLyBGYWtlIG9yaWdpbmFsRXZlbnQgdG8gYXZvaWQgZG9ub3IncyBzdG9wUHJvcGFnYXRpb24sIGJ1dCBpZiB0aGVcbiAgICAgICAgICAgIC8vIHNpbXVsYXRlZCBldmVudCBwcmV2ZW50cyBkZWZhdWx0IHRoZW4gd2UgZG8gdGhlIHNhbWUgb24gdGhlIGRvbm9yLlxuICAgICAgICAgICAgdmFyIGUgPSBqUXVlcnkuZXh0ZW5kKFxuICAgICAgICAgICAgICAgIG5ldyBqUXVlcnkuRXZlbnQoKSxcbiAgICAgICAgICAgICAgICBldmVudCxcbiAgICAgICAgICAgICAgICB7IHR5cGU6IHR5cGUsXG4gICAgICAgICAgICAgICAgICAgIGlzU2ltdWxhdGVkOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICBvcmlnaW5hbEV2ZW50OiB7fVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICk7XG4gICAgICAgICAgICBpZiAoIGJ1YmJsZSApIHtcbiAgICAgICAgICAgICAgICBqUXVlcnkuZXZlbnQudHJpZ2dlciggZSwgbnVsbCwgZWxlbSApO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBqUXVlcnkuZXZlbnQuZGlzcGF0Y2guY2FsbCggZWxlbSwgZSApO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKCBlLmlzRGVmYXVsdFByZXZlbnRlZCgpICkge1xuICAgICAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9O1xuXG4vLyBTb21lIHBsdWdpbnMgYXJlIHVzaW5nLCBidXQgaXQncyB1bmRvY3VtZW50ZWQvZGVwcmVjYXRlZCBhbmQgd2lsbCBiZSByZW1vdmVkLlxuLy8gVGhlIDEuNyBzcGVjaWFsIGV2ZW50IGludGVyZmFjZSBzaG91bGQgcHJvdmlkZSBhbGwgdGhlIGhvb2tzIG5lZWRlZCBub3cuXG4gICAgalF1ZXJ5LmV2ZW50LmhhbmRsZSA9IGpRdWVyeS5ldmVudC5kaXNwYXRjaDtcblxuICAgIGpRdWVyeS5yZW1vdmVFdmVudCA9IGRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIgP1xuICAgICAgICBmdW5jdGlvbiggZWxlbSwgdHlwZSwgaGFuZGxlICkge1xuICAgICAgICAgICAgaWYgKCBlbGVtLnJlbW92ZUV2ZW50TGlzdGVuZXIgKSB7XG4gICAgICAgICAgICAgICAgZWxlbS5yZW1vdmVFdmVudExpc3RlbmVyKCB0eXBlLCBoYW5kbGUsIGZhbHNlICk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0gOlxuICAgICAgICBmdW5jdGlvbiggZWxlbSwgdHlwZSwgaGFuZGxlICkge1xuICAgICAgICAgICAgaWYgKCBlbGVtLmRldGFjaEV2ZW50ICkge1xuICAgICAgICAgICAgICAgIGVsZW0uZGV0YWNoRXZlbnQoIFwib25cIiArIHR5cGUsIGhhbmRsZSApO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuXG4gICAgalF1ZXJ5LkV2ZW50ID0gZnVuY3Rpb24oIHNyYywgcHJvcHMgKSB7XG4gICAgICAgIC8vIEFsbG93IGluc3RhbnRpYXRpb24gd2l0aG91dCB0aGUgJ25ldycga2V5d29yZFxuICAgICAgICBpZiAoICEodGhpcyBpbnN0YW5jZW9mIGpRdWVyeS5FdmVudCkgKSB7XG4gICAgICAgICAgICByZXR1cm4gbmV3IGpRdWVyeS5FdmVudCggc3JjLCBwcm9wcyApO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gRXZlbnQgb2JqZWN0XG4gICAgICAgIGlmICggc3JjICYmIHNyYy50eXBlICkge1xuICAgICAgICAgICAgdGhpcy5vcmlnaW5hbEV2ZW50ID0gc3JjO1xuICAgICAgICAgICAgdGhpcy50eXBlID0gc3JjLnR5cGU7XG5cbiAgICAgICAgICAgIC8vIEV2ZW50cyBidWJibGluZyB1cCB0aGUgZG9jdW1lbnQgbWF5IGhhdmUgYmVlbiBtYXJrZWQgYXMgcHJldmVudGVkXG4gICAgICAgICAgICAvLyBieSBhIGhhbmRsZXIgbG93ZXIgZG93biB0aGUgdHJlZTsgcmVmbGVjdCB0aGUgY29ycmVjdCB2YWx1ZS5cbiAgICAgICAgICAgIHRoaXMuaXNEZWZhdWx0UHJldmVudGVkID0gKCBzcmMuZGVmYXVsdFByZXZlbnRlZCB8fCBzcmMucmV0dXJuVmFsdWUgPT09IGZhbHNlIHx8XG4gICAgICAgICAgICBzcmMuZ2V0UHJldmVudERlZmF1bHQgJiYgc3JjLmdldFByZXZlbnREZWZhdWx0KCkgKSA/IHJldHVyblRydWUgOiByZXR1cm5GYWxzZTtcblxuICAgICAgICAgICAgLy8gRXZlbnQgdHlwZVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy50eXBlID0gc3JjO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gUHV0IGV4cGxpY2l0bHkgcHJvdmlkZWQgcHJvcGVydGllcyBvbnRvIHRoZSBldmVudCBvYmplY3RcbiAgICAgICAgaWYgKCBwcm9wcyApIHtcbiAgICAgICAgICAgIGpRdWVyeS5leHRlbmQoIHRoaXMsIHByb3BzICk7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBDcmVhdGUgYSB0aW1lc3RhbXAgaWYgaW5jb21pbmcgZXZlbnQgZG9lc24ndCBoYXZlIG9uZVxuICAgICAgICB0aGlzLnRpbWVTdGFtcCA9IHNyYyAmJiBzcmMudGltZVN0YW1wIHx8IGpRdWVyeS5ub3coKTtcblxuICAgICAgICAvLyBNYXJrIGl0IGFzIGZpeGVkXG4gICAgICAgIHRoaXNbIGpRdWVyeS5leHBhbmRvIF0gPSB0cnVlO1xuICAgIH07XG5cbiAgICBmdW5jdGlvbiByZXR1cm5GYWxzZSgpIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICBmdW5jdGlvbiByZXR1cm5UcnVlKCkge1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG5cbi8vIGpRdWVyeS5FdmVudCBpcyBiYXNlZCBvbiBET00zIEV2ZW50cyBhcyBzcGVjaWZpZWQgYnkgdGhlIEVDTUFTY3JpcHQgTGFuZ3VhZ2UgQmluZGluZ1xuLy8gaHR0cDovL3d3dy53My5vcmcvVFIvMjAwMy9XRC1ET00tTGV2ZWwtMy1FdmVudHMtMjAwMzAzMzEvZWNtYS1zY3JpcHQtYmluZGluZy5odG1sXG4gICAgalF1ZXJ5LkV2ZW50LnByb3RvdHlwZSA9IHtcbiAgICAgICAgcHJldmVudERlZmF1bHQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgdGhpcy5pc0RlZmF1bHRQcmV2ZW50ZWQgPSByZXR1cm5UcnVlO1xuXG4gICAgICAgICAgICB2YXIgZSA9IHRoaXMub3JpZ2luYWxFdmVudDtcbiAgICAgICAgICAgIGlmICggIWUgKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBpZiBwcmV2ZW50RGVmYXVsdCBleGlzdHMgcnVuIGl0IG9uIHRoZSBvcmlnaW5hbCBldmVudFxuICAgICAgICAgICAgaWYgKCBlLnByZXZlbnREZWZhdWx0ICkge1xuICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcblxuICAgICAgICAgICAgICAgIC8vIG90aGVyd2lzZSBzZXQgdGhlIHJldHVyblZhbHVlIHByb3BlcnR5IG9mIHRoZSBvcmlnaW5hbCBldmVudCB0byBmYWxzZSAoSUUpXG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGUucmV0dXJuVmFsdWUgPSBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAgc3RvcFByb3BhZ2F0aW9uOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHRoaXMuaXNQcm9wYWdhdGlvblN0b3BwZWQgPSByZXR1cm5UcnVlO1xuXG4gICAgICAgICAgICB2YXIgZSA9IHRoaXMub3JpZ2luYWxFdmVudDtcbiAgICAgICAgICAgIGlmICggIWUgKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLy8gaWYgc3RvcFByb3BhZ2F0aW9uIGV4aXN0cyBydW4gaXQgb24gdGhlIG9yaWdpbmFsIGV2ZW50XG4gICAgICAgICAgICBpZiAoIGUuc3RvcFByb3BhZ2F0aW9uICkge1xuICAgICAgICAgICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvLyBvdGhlcndpc2Ugc2V0IHRoZSBjYW5jZWxCdWJibGUgcHJvcGVydHkgb2YgdGhlIG9yaWdpbmFsIGV2ZW50IHRvIHRydWUgKElFKVxuICAgICAgICAgICAgZS5jYW5jZWxCdWJibGUgPSB0cnVlO1xuICAgICAgICB9LFxuICAgICAgICBzdG9wSW1tZWRpYXRlUHJvcGFnYXRpb246IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgdGhpcy5pc0ltbWVkaWF0ZVByb3BhZ2F0aW9uU3RvcHBlZCA9IHJldHVyblRydWU7XG4gICAgICAgICAgICB0aGlzLnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICB9LFxuICAgICAgICBpc0RlZmF1bHRQcmV2ZW50ZWQ6IHJldHVybkZhbHNlLFxuICAgICAgICBpc1Byb3BhZ2F0aW9uU3RvcHBlZDogcmV0dXJuRmFsc2UsXG4gICAgICAgIGlzSW1tZWRpYXRlUHJvcGFnYXRpb25TdG9wcGVkOiByZXR1cm5GYWxzZVxuICAgIH07XG5cbi8vIENyZWF0ZSBtb3VzZWVudGVyL2xlYXZlIGV2ZW50cyB1c2luZyBtb3VzZW92ZXIvb3V0IGFuZCBldmVudC10aW1lIGNoZWNrc1xuICAgIGpRdWVyeS5lYWNoKHtcbiAgICAgICAgbW91c2VlbnRlcjogXCJtb3VzZW92ZXJcIixcbiAgICAgICAgbW91c2VsZWF2ZTogXCJtb3VzZW91dFwiXG4gICAgfSwgZnVuY3Rpb24oIG9yaWcsIGZpeCApIHtcbiAgICAgICAgalF1ZXJ5LmV2ZW50LnNwZWNpYWxbIG9yaWcgXSA9IHtcbiAgICAgICAgICAgIGRlbGVnYXRlVHlwZTogZml4LFxuICAgICAgICAgICAgYmluZFR5cGU6IGZpeCxcblxuICAgICAgICAgICAgaGFuZGxlOiBmdW5jdGlvbiggZXZlbnQgKSB7XG4gICAgICAgICAgICAgICAgdmFyIHRhcmdldCA9IHRoaXMsXG4gICAgICAgICAgICAgICAgICAgIHJlbGF0ZWQgPSBldmVudC5yZWxhdGVkVGFyZ2V0LFxuICAgICAgICAgICAgICAgICAgICBoYW5kbGVPYmogPSBldmVudC5oYW5kbGVPYmosXG4gICAgICAgICAgICAgICAgICAgIHNlbGVjdG9yID0gaGFuZGxlT2JqLnNlbGVjdG9yLFxuICAgICAgICAgICAgICAgICAgICByZXQ7XG5cbiAgICAgICAgICAgICAgICAvLyBGb3IgbW91c2VudGVyL2xlYXZlIGNhbGwgdGhlIGhhbmRsZXIgaWYgcmVsYXRlZCBpcyBvdXRzaWRlIHRoZSB0YXJnZXQuXG4gICAgICAgICAgICAgICAgLy8gTkI6IE5vIHJlbGF0ZWRUYXJnZXQgaWYgdGhlIG1vdXNlIGxlZnQvZW50ZXJlZCB0aGUgYnJvd3NlciB3aW5kb3dcbiAgICAgICAgICAgICAgICBpZiAoICFyZWxhdGVkIHx8IChyZWxhdGVkICE9PSB0YXJnZXQgJiYgIWpRdWVyeS5jb250YWlucyggdGFyZ2V0LCByZWxhdGVkICkpICkge1xuICAgICAgICAgICAgICAgICAgICBldmVudC50eXBlID0gaGFuZGxlT2JqLm9yaWdUeXBlO1xuICAgICAgICAgICAgICAgICAgICByZXQgPSBoYW5kbGVPYmouaGFuZGxlci5hcHBseSggdGhpcywgYXJndW1lbnRzICk7XG4gICAgICAgICAgICAgICAgICAgIGV2ZW50LnR5cGUgPSBmaXg7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybiByZXQ7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgfSk7XG5cbi8vIElFIHN1Ym1pdCBkZWxlZ2F0aW9uXG4gICAgaWYgKCAhalF1ZXJ5LnN1cHBvcnQuc3VibWl0QnViYmxlcyApIHtcblxuICAgICAgICBqUXVlcnkuZXZlbnQuc3BlY2lhbC5zdWJtaXQgPSB7XG4gICAgICAgICAgICBzZXR1cDogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgLy8gT25seSBuZWVkIHRoaXMgZm9yIGRlbGVnYXRlZCBmb3JtIHN1Ym1pdCBldmVudHNcbiAgICAgICAgICAgICAgICBpZiAoIGpRdWVyeS5ub2RlTmFtZSggdGhpcywgXCJmb3JtXCIgKSApIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIC8vIExhenktYWRkIGEgc3VibWl0IGhhbmRsZXIgd2hlbiBhIGRlc2NlbmRhbnQgZm9ybSBtYXkgcG90ZW50aWFsbHkgYmUgc3VibWl0dGVkXG4gICAgICAgICAgICAgICAgalF1ZXJ5LmV2ZW50LmFkZCggdGhpcywgXCJjbGljay5fc3VibWl0IGtleXByZXNzLl9zdWJtaXRcIiwgZnVuY3Rpb24oIGUgKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIE5vZGUgbmFtZSBjaGVjayBhdm9pZHMgYSBWTUwtcmVsYXRlZCBjcmFzaCBpbiBJRSAoIzk4MDcpXG4gICAgICAgICAgICAgICAgICAgIHZhciBlbGVtID0gZS50YXJnZXQsXG4gICAgICAgICAgICAgICAgICAgICAgICBmb3JtID0galF1ZXJ5Lm5vZGVOYW1lKCBlbGVtLCBcImlucHV0XCIgKSB8fCBqUXVlcnkubm9kZU5hbWUoIGVsZW0sIFwiYnV0dG9uXCIgKSA/IGVsZW0uZm9ybSA6IHVuZGVmaW5lZDtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCBmb3JtICYmICFmb3JtLl9zdWJtaXRfYXR0YWNoZWQgKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBqUXVlcnkuZXZlbnQuYWRkKCBmb3JtLCBcInN1Ym1pdC5fc3VibWl0XCIsIGZ1bmN0aW9uKCBldmVudCApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBJZiBmb3JtIHdhcyBzdWJtaXR0ZWQgYnkgdGhlIHVzZXIsIGJ1YmJsZSB0aGUgZXZlbnQgdXAgdGhlIHRyZWVcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIHRoaXMucGFyZW50Tm9kZSAmJiAhZXZlbnQuaXNUcmlnZ2VyICkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBqUXVlcnkuZXZlbnQuc2ltdWxhdGUoIFwic3VibWl0XCIsIHRoaXMucGFyZW50Tm9kZSwgZXZlbnQsIHRydWUgKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGZvcm0uX3N1Ym1pdF9hdHRhY2hlZCA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAvLyByZXR1cm4gdW5kZWZpbmVkIHNpbmNlIHdlIGRvbid0IG5lZWQgYW4gZXZlbnQgbGlzdGVuZXJcbiAgICAgICAgICAgIH0sXG5cbiAgICAgICAgICAgIHRlYXJkb3duOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAvLyBPbmx5IG5lZWQgdGhpcyBmb3IgZGVsZWdhdGVkIGZvcm0gc3VibWl0IGV2ZW50c1xuICAgICAgICAgICAgICAgIGlmICggalF1ZXJ5Lm5vZGVOYW1lKCB0aGlzLCBcImZvcm1cIiApICkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgLy8gUmVtb3ZlIGRlbGVnYXRlZCBoYW5kbGVyczsgY2xlYW5EYXRhIGV2ZW50dWFsbHkgcmVhcHMgc3VibWl0IGhhbmRsZXJzIGF0dGFjaGVkIGFib3ZlXG4gICAgICAgICAgICAgICAgalF1ZXJ5LmV2ZW50LnJlbW92ZSggdGhpcywgXCIuX3N1Ym1pdFwiICk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgfVxuXG4vLyBJRSBjaGFuZ2UgZGVsZWdhdGlvbiBhbmQgY2hlY2tib3gvcmFkaW8gZml4XG4gICAgaWYgKCAhalF1ZXJ5LnN1cHBvcnQuY2hhbmdlQnViYmxlcyApIHtcblxuICAgICAgICBqUXVlcnkuZXZlbnQuc3BlY2lhbC5jaGFuZ2UgPSB7XG5cbiAgICAgICAgICAgIHNldHVwOiBmdW5jdGlvbigpIHtcblxuICAgICAgICAgICAgICAgIGlmICggcmZvcm1FbGVtcy50ZXN0KCB0aGlzLm5vZGVOYW1lICkgKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIElFIGRvZXNuJ3QgZmlyZSBjaGFuZ2Ugb24gYSBjaGVjay9yYWRpbyB1bnRpbCBibHVyOyB0cmlnZ2VyIGl0IG9uIGNsaWNrXG4gICAgICAgICAgICAgICAgICAgIC8vIGFmdGVyIGEgcHJvcGVydHljaGFuZ2UuIEVhdCB0aGUgYmx1ci1jaGFuZ2UgaW4gc3BlY2lhbC5jaGFuZ2UuaGFuZGxlLlxuICAgICAgICAgICAgICAgICAgICAvLyBUaGlzIHN0aWxsIGZpcmVzIG9uY2hhbmdlIGEgc2Vjb25kIHRpbWUgZm9yIGNoZWNrL3JhZGlvIGFmdGVyIGJsdXIuXG4gICAgICAgICAgICAgICAgICAgIGlmICggdGhpcy50eXBlID09PSBcImNoZWNrYm94XCIgfHwgdGhpcy50eXBlID09PSBcInJhZGlvXCIgKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBqUXVlcnkuZXZlbnQuYWRkKCB0aGlzLCBcInByb3BlcnR5Y2hhbmdlLl9jaGFuZ2VcIiwgZnVuY3Rpb24oIGV2ZW50ICkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICggZXZlbnQub3JpZ2luYWxFdmVudC5wcm9wZXJ0eU5hbWUgPT09IFwiY2hlY2tlZFwiICkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9qdXN0X2NoYW5nZWQgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgalF1ZXJ5LmV2ZW50LmFkZCggdGhpcywgXCJjbGljay5fY2hhbmdlXCIsIGZ1bmN0aW9uKCBldmVudCApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIHRoaXMuX2p1c3RfY2hhbmdlZCAmJiAhZXZlbnQuaXNUcmlnZ2VyICkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9qdXN0X2NoYW5nZWQgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgalF1ZXJ5LmV2ZW50LnNpbXVsYXRlKCBcImNoYW5nZVwiLCB0aGlzLCBldmVudCwgdHJ1ZSApO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgLy8gRGVsZWdhdGVkIGV2ZW50OyBsYXp5LWFkZCBhIGNoYW5nZSBoYW5kbGVyIG9uIGRlc2NlbmRhbnQgaW5wdXRzXG4gICAgICAgICAgICAgICAgalF1ZXJ5LmV2ZW50LmFkZCggdGhpcywgXCJiZWZvcmVhY3RpdmF0ZS5fY2hhbmdlXCIsIGZ1bmN0aW9uKCBlICkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgZWxlbSA9IGUudGFyZ2V0O1xuXG4gICAgICAgICAgICAgICAgICAgIGlmICggcmZvcm1FbGVtcy50ZXN0KCBlbGVtLm5vZGVOYW1lICkgJiYgIWVsZW0uX2NoYW5nZV9hdHRhY2hlZCApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGpRdWVyeS5ldmVudC5hZGQoIGVsZW0sIFwiY2hhbmdlLl9jaGFuZ2VcIiwgZnVuY3Rpb24oIGV2ZW50ICkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICggdGhpcy5wYXJlbnROb2RlICYmICFldmVudC5pc1NpbXVsYXRlZCAmJiAhZXZlbnQuaXNUcmlnZ2VyICkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBqUXVlcnkuZXZlbnQuc2ltdWxhdGUoIFwiY2hhbmdlXCIsIHRoaXMucGFyZW50Tm9kZSwgZXZlbnQsIHRydWUgKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGVsZW0uX2NoYW5nZV9hdHRhY2hlZCA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0sXG5cbiAgICAgICAgICAgIGhhbmRsZTogZnVuY3Rpb24oIGV2ZW50ICkge1xuICAgICAgICAgICAgICAgIHZhciBlbGVtID0gZXZlbnQudGFyZ2V0O1xuXG4gICAgICAgICAgICAgICAgLy8gU3dhbGxvdyBuYXRpdmUgY2hhbmdlIGV2ZW50cyBmcm9tIGNoZWNrYm94L3JhZGlvLCB3ZSBhbHJlYWR5IHRyaWdnZXJlZCB0aGVtIGFib3ZlXG4gICAgICAgICAgICAgICAgaWYgKCB0aGlzICE9PSBlbGVtIHx8IGV2ZW50LmlzU2ltdWxhdGVkIHx8IGV2ZW50LmlzVHJpZ2dlciB8fCAoZWxlbS50eXBlICE9PSBcInJhZGlvXCIgJiYgZWxlbS50eXBlICE9PSBcImNoZWNrYm94XCIpICkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZXZlbnQuaGFuZGxlT2JqLmhhbmRsZXIuYXBwbHkoIHRoaXMsIGFyZ3VtZW50cyApO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG5cbiAgICAgICAgICAgIHRlYXJkb3duOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICBqUXVlcnkuZXZlbnQucmVtb3ZlKCB0aGlzLCBcIi5fY2hhbmdlXCIgKTtcblxuICAgICAgICAgICAgICAgIHJldHVybiByZm9ybUVsZW1zLnRlc3QoIHRoaXMubm9kZU5hbWUgKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICB9XG5cbi8vIENyZWF0ZSBcImJ1YmJsaW5nXCIgZm9jdXMgYW5kIGJsdXIgZXZlbnRzXG4gICAgaWYgKCAhalF1ZXJ5LnN1cHBvcnQuZm9jdXNpbkJ1YmJsZXMgKSB7XG4gICAgICAgIGpRdWVyeS5lYWNoKHsgZm9jdXM6IFwiZm9jdXNpblwiLCBibHVyOiBcImZvY3Vzb3V0XCIgfSwgZnVuY3Rpb24oIG9yaWcsIGZpeCApIHtcblxuICAgICAgICAgICAgLy8gQXR0YWNoIGEgc2luZ2xlIGNhcHR1cmluZyBoYW5kbGVyIHdoaWxlIHNvbWVvbmUgd2FudHMgZm9jdXNpbi9mb2N1c291dFxuICAgICAgICAgICAgdmFyIGF0dGFjaGVzID0gMCxcbiAgICAgICAgICAgICAgICBoYW5kbGVyID0gZnVuY3Rpb24oIGV2ZW50ICkge1xuICAgICAgICAgICAgICAgICAgICBqUXVlcnkuZXZlbnQuc2ltdWxhdGUoIGZpeCwgZXZlbnQudGFyZ2V0LCBqUXVlcnkuZXZlbnQuZml4KCBldmVudCApLCB0cnVlICk7XG4gICAgICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgalF1ZXJ5LmV2ZW50LnNwZWNpYWxbIGZpeCBdID0ge1xuICAgICAgICAgICAgICAgIHNldHVwOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCBhdHRhY2hlcysrID09PSAwICkge1xuICAgICAgICAgICAgICAgICAgICAgICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lciggb3JpZywgaGFuZGxlciwgdHJ1ZSApO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICB0ZWFyZG93bjogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICggLS1hdHRhY2hlcyA9PT0gMCApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoIG9yaWcsIGhhbmRsZXIsIHRydWUgKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH07XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIGpRdWVyeS5mbi5leHRlbmQoe1xuXG4gICAgICAgIG9uOiBmdW5jdGlvbiggdHlwZXMsIHNlbGVjdG9yLCBkYXRhLCBmbiwgLypJTlRFUk5BTCovIG9uZSApIHtcbiAgICAgICAgICAgIHZhciBvcmlnRm4sIHR5cGU7XG5cbiAgICAgICAgICAgIC8vIFR5cGVzIGNhbiBiZSBhIG1hcCBvZiB0eXBlcy9oYW5kbGVyc1xuICAgICAgICAgICAgaWYgKCB0eXBlb2YgdHlwZXMgPT09IFwib2JqZWN0XCIgKSB7XG4gICAgICAgICAgICAgICAgLy8gKCB0eXBlcy1PYmplY3QsIHNlbGVjdG9yLCBkYXRhIClcbiAgICAgICAgICAgICAgICBpZiAoIHR5cGVvZiBzZWxlY3RvciAhPT0gXCJzdHJpbmdcIiApIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gKCB0eXBlcy1PYmplY3QsIGRhdGEgKVxuICAgICAgICAgICAgICAgICAgICBkYXRhID0gc2VsZWN0b3I7XG4gICAgICAgICAgICAgICAgICAgIHNlbGVjdG9yID0gdW5kZWZpbmVkO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBmb3IgKCB0eXBlIGluIHR5cGVzICkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLm9uKCB0eXBlLCBzZWxlY3RvciwgZGF0YSwgdHlwZXNbIHR5cGUgXSwgb25lICk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoIGRhdGEgPT0gbnVsbCAmJiBmbiA9PSBudWxsICkge1xuICAgICAgICAgICAgICAgIC8vICggdHlwZXMsIGZuIClcbiAgICAgICAgICAgICAgICBmbiA9IHNlbGVjdG9yO1xuICAgICAgICAgICAgICAgIGRhdGEgPSBzZWxlY3RvciA9IHVuZGVmaW5lZDtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoIGZuID09IG51bGwgKSB7XG4gICAgICAgICAgICAgICAgaWYgKCB0eXBlb2Ygc2VsZWN0b3IgPT09IFwic3RyaW5nXCIgKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vICggdHlwZXMsIHNlbGVjdG9yLCBmbiApXG4gICAgICAgICAgICAgICAgICAgIGZuID0gZGF0YTtcbiAgICAgICAgICAgICAgICAgICAgZGF0YSA9IHVuZGVmaW5lZDtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAvLyAoIHR5cGVzLCBkYXRhLCBmbiApXG4gICAgICAgICAgICAgICAgICAgIGZuID0gZGF0YTtcbiAgICAgICAgICAgICAgICAgICAgZGF0YSA9IHNlbGVjdG9yO1xuICAgICAgICAgICAgICAgICAgICBzZWxlY3RvciA9IHVuZGVmaW5lZDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoIGZuID09PSBmYWxzZSApIHtcbiAgICAgICAgICAgICAgICBmbiA9IHJldHVybkZhbHNlO1xuICAgICAgICAgICAgfSBlbHNlIGlmICggIWZuICkge1xuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoIG9uZSA9PT0gMSApIHtcbiAgICAgICAgICAgICAgICBvcmlnRm4gPSBmbjtcbiAgICAgICAgICAgICAgICBmbiA9IGZ1bmN0aW9uKCBldmVudCApIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gQ2FuIHVzZSBhbiBlbXB0eSBzZXQsIHNpbmNlIGV2ZW50IGNvbnRhaW5zIHRoZSBpbmZvXG4gICAgICAgICAgICAgICAgICAgIGpRdWVyeSgpLm9mZiggZXZlbnQgKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG9yaWdGbi5hcHBseSggdGhpcywgYXJndW1lbnRzICk7XG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICAvLyBVc2Ugc2FtZSBndWlkIHNvIGNhbGxlciBjYW4gcmVtb3ZlIHVzaW5nIG9yaWdGblxuICAgICAgICAgICAgICAgIGZuLmd1aWQgPSBvcmlnRm4uZ3VpZCB8fCAoIG9yaWdGbi5ndWlkID0galF1ZXJ5Lmd1aWQrKyApO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuZWFjaCggZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgalF1ZXJ5LmV2ZW50LmFkZCggdGhpcywgdHlwZXMsIGZuLCBkYXRhLCBzZWxlY3RvciApO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0sXG4gICAgICAgIG9uZTogZnVuY3Rpb24oIHR5cGVzLCBzZWxlY3RvciwgZGF0YSwgZm4gKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5vbi5jYWxsKCB0aGlzLCB0eXBlcywgc2VsZWN0b3IsIGRhdGEsIGZuLCAxICk7XG4gICAgICAgIH0sXG4gICAgICAgIG9mZjogZnVuY3Rpb24oIHR5cGVzLCBzZWxlY3RvciwgZm4gKSB7XG4gICAgICAgICAgICBpZiAoIHR5cGVzICYmIHR5cGVzLnByZXZlbnREZWZhdWx0ICYmIHR5cGVzLmhhbmRsZU9iaiApIHtcbiAgICAgICAgICAgICAgICAvLyAoIGV2ZW50ICkgIGRpc3BhdGNoZWQgalF1ZXJ5LkV2ZW50XG4gICAgICAgICAgICAgICAgdmFyIGhhbmRsZU9iaiA9IHR5cGVzLmhhbmRsZU9iajtcbiAgICAgICAgICAgICAgICBqUXVlcnkoIHR5cGVzLmRlbGVnYXRlVGFyZ2V0ICkub2ZmKFxuICAgICAgICAgICAgICAgICAgICBoYW5kbGVPYmoubmFtZXNwYWNlPyBoYW5kbGVPYmoudHlwZSArIFwiLlwiICsgaGFuZGxlT2JqLm5hbWVzcGFjZSA6IGhhbmRsZU9iai50eXBlLFxuICAgICAgICAgICAgICAgICAgICBoYW5kbGVPYmouc2VsZWN0b3IsXG4gICAgICAgICAgICAgICAgICAgIGhhbmRsZU9iai5oYW5kbGVyXG4gICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICggdHlwZW9mIHR5cGVzID09PSBcIm9iamVjdFwiICkge1xuICAgICAgICAgICAgICAgIC8vICggdHlwZXMtb2JqZWN0IFssIHNlbGVjdG9yXSApXG4gICAgICAgICAgICAgICAgZm9yICggdmFyIHR5cGUgaW4gdHlwZXMgKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMub2ZmKCB0eXBlLCBzZWxlY3RvciwgdHlwZXNbIHR5cGUgXSApO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICggc2VsZWN0b3IgPT09IGZhbHNlIHx8IHR5cGVvZiBzZWxlY3RvciA9PT0gXCJmdW5jdGlvblwiICkge1xuICAgICAgICAgICAgICAgIC8vICggdHlwZXMgWywgZm5dIClcbiAgICAgICAgICAgICAgICBmbiA9IHNlbGVjdG9yO1xuICAgICAgICAgICAgICAgIHNlbGVjdG9yID0gdW5kZWZpbmVkO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKCBmbiA9PT0gZmFsc2UgKSB7XG4gICAgICAgICAgICAgICAgZm4gPSByZXR1cm5GYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgalF1ZXJ5LmV2ZW50LnJlbW92ZSggdGhpcywgdHlwZXMsIGZuLCBzZWxlY3RvciApO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgYmluZDogZnVuY3Rpb24oIHR5cGVzLCBkYXRhLCBmbiApIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLm9uKCB0eXBlcywgbnVsbCwgZGF0YSwgZm4gKTtcbiAgICAgICAgfSxcbiAgICAgICAgdW5iaW5kOiBmdW5jdGlvbiggdHlwZXMsIGZuICkge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMub2ZmKCB0eXBlcywgbnVsbCwgZm4gKTtcbiAgICAgICAgfSxcblxuICAgICAgICBsaXZlOiBmdW5jdGlvbiggdHlwZXMsIGRhdGEsIGZuICkge1xuICAgICAgICAgICAgalF1ZXJ5KCB0aGlzLmNvbnRleHQgKS5vbiggdHlwZXMsIHRoaXMuc2VsZWN0b3IsIGRhdGEsIGZuICk7XG4gICAgICAgICAgICByZXR1cm4gdGhpcztcbiAgICAgICAgfSxcbiAgICAgICAgZGllOiBmdW5jdGlvbiggdHlwZXMsIGZuICkge1xuICAgICAgICAgICAgalF1ZXJ5KCB0aGlzLmNvbnRleHQgKS5vZmYoIHR5cGVzLCB0aGlzLnNlbGVjdG9yIHx8IFwiKipcIiwgZm4gKTtcbiAgICAgICAgICAgIHJldHVybiB0aGlzO1xuICAgICAgICB9LFxuXG4gICAgICAgIGRlbGVnYXRlOiBmdW5jdGlvbiggc2VsZWN0b3IsIHR5cGVzLCBkYXRhLCBmbiApIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLm9uKCB0eXBlcywgc2VsZWN0b3IsIGRhdGEsIGZuICk7XG4gICAgICAgIH0sXG4gICAgICAgIHVuZGVsZWdhdGU6IGZ1bmN0aW9uKCBzZWxlY3RvciwgdHlwZXMsIGZuICkge1xuICAgICAgICAgICAgLy8gKCBuYW1lc3BhY2UgKSBvciAoIHNlbGVjdG9yLCB0eXBlcyBbLCBmbl0gKVxuICAgICAgICAgICAgcmV0dXJuIGFyZ3VtZW50cy5sZW5ndGggPT0gMT8gdGhpcy5vZmYoIHNlbGVjdG9yLCBcIioqXCIgKSA6IHRoaXMub2ZmKCB0eXBlcywgc2VsZWN0b3IsIGZuICk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgdHJpZ2dlcjogZnVuY3Rpb24oIHR5cGUsIGRhdGEgKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIGpRdWVyeS5ldmVudC50cmlnZ2VyKCB0eXBlLCBkYXRhLCB0aGlzICk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSxcbiAgICAgICAgdHJpZ2dlckhhbmRsZXI6IGZ1bmN0aW9uKCB0eXBlLCBkYXRhICkge1xuICAgICAgICAgICAgaWYgKCB0aGlzWzBdICkge1xuICAgICAgICAgICAgICAgIHJldHVybiBqUXVlcnkuZXZlbnQudHJpZ2dlciggdHlwZSwgZGF0YSwgdGhpc1swXSwgdHJ1ZSApO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIHRvZ2dsZTogZnVuY3Rpb24oIGZuICkge1xuICAgICAgICAgICAgLy8gU2F2ZSByZWZlcmVuY2UgdG8gYXJndW1lbnRzIGZvciBhY2Nlc3MgaW4gY2xvc3VyZVxuICAgICAgICAgICAgdmFyIGFyZ3MgPSBhcmd1bWVudHMsXG4gICAgICAgICAgICAgICAgZ3VpZCA9IGZuLmd1aWQgfHwgalF1ZXJ5Lmd1aWQrKyxcbiAgICAgICAgICAgICAgICBpID0gMCxcbiAgICAgICAgICAgICAgICB0b2dnbGVyID0gZnVuY3Rpb24oIGV2ZW50ICkge1xuICAgICAgICAgICAgICAgICAgICAvLyBGaWd1cmUgb3V0IHdoaWNoIGZ1bmN0aW9uIHRvIGV4ZWN1dGVcbiAgICAgICAgICAgICAgICAgICAgdmFyIGxhc3RUb2dnbGUgPSAoIGpRdWVyeS5fZGF0YSggdGhpcywgXCJsYXN0VG9nZ2xlXCIgKyBmbi5ndWlkICkgfHwgMCApICUgaTtcbiAgICAgICAgICAgICAgICAgICAgalF1ZXJ5Ll9kYXRhKCB0aGlzLCBcImxhc3RUb2dnbGVcIiArIGZuLmd1aWQsIGxhc3RUb2dnbGUgKyAxICk7XG5cbiAgICAgICAgICAgICAgICAgICAgLy8gTWFrZSBzdXJlIHRoYXQgY2xpY2tzIHN0b3BcbiAgICAgICAgICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcblxuICAgICAgICAgICAgICAgICAgICAvLyBhbmQgZXhlY3V0ZSB0aGUgZnVuY3Rpb25cbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGFyZ3NbIGxhc3RUb2dnbGUgXS5hcHBseSggdGhpcywgYXJndW1lbnRzICkgfHwgZmFsc2U7XG4gICAgICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgLy8gbGluayBhbGwgdGhlIGZ1bmN0aW9ucywgc28gYW55IG9mIHRoZW0gY2FuIHVuYmluZCB0aGlzIGNsaWNrIGhhbmRsZXJcbiAgICAgICAgICAgIHRvZ2dsZXIuZ3VpZCA9IGd1aWQ7XG4gICAgICAgICAgICB3aGlsZSAoIGkgPCBhcmdzLmxlbmd0aCApIHtcbiAgICAgICAgICAgICAgICBhcmdzWyBpKysgXS5ndWlkID0gZ3VpZDtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuY2xpY2soIHRvZ2dsZXIgKTtcbiAgICAgICAgfSxcblxuICAgICAgICBob3ZlcjogZnVuY3Rpb24oIGZuT3ZlciwgZm5PdXQgKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5tb3VzZWVudGVyKCBmbk92ZXIgKS5tb3VzZWxlYXZlKCBmbk91dCB8fCBmbk92ZXIgKTtcbiAgICAgICAgfVxuICAgIH0pO1xuXG4gICAgalF1ZXJ5LmVhY2goIChcImJsdXIgZm9jdXMgZm9jdXNpbiBmb2N1c291dCBsb2FkIHJlc2l6ZSBzY3JvbGwgdW5sb2FkIGNsaWNrIGRibGNsaWNrIFwiICtcbiAgICBcIm1vdXNlZG93biBtb3VzZXVwIG1vdXNlbW92ZSBtb3VzZW92ZXIgbW91c2VvdXQgbW91c2VlbnRlciBtb3VzZWxlYXZlIFwiICtcbiAgICBcImNoYW5nZSBzZWxlY3Qgc3VibWl0IGtleWRvd24ga2V5cHJlc3Mga2V5dXAgZXJyb3IgY29udGV4dG1lbnVcIikuc3BsaXQoXCIgXCIpLCBmdW5jdGlvbiggaSwgbmFtZSApIHtcblxuICAgICAgICAvLyBIYW5kbGUgZXZlbnQgYmluZGluZ1xuICAgICAgICBqUXVlcnkuZm5bIG5hbWUgXSA9IGZ1bmN0aW9uKCBkYXRhLCBmbiApIHtcbiAgICAgICAgICAgIGlmICggZm4gPT0gbnVsbCApIHtcbiAgICAgICAgICAgICAgICBmbiA9IGRhdGE7XG4gICAgICAgICAgICAgICAgZGF0YSA9IG51bGw7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHJldHVybiBhcmd1bWVudHMubGVuZ3RoID4gMCA/XG4gICAgICAgICAgICAgICAgdGhpcy5vbiggbmFtZSwgbnVsbCwgZGF0YSwgZm4gKSA6XG4gICAgICAgICAgICAgICAgdGhpcy50cmlnZ2VyKCBuYW1lICk7XG4gICAgICAgIH07XG5cbiAgICAgICAgaWYgKCBqUXVlcnkuYXR0ckZuICkge1xuICAgICAgICAgICAgalF1ZXJ5LmF0dHJGblsgbmFtZSBdID0gdHJ1ZTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICggcmtleUV2ZW50LnRlc3QoIG5hbWUgKSApIHtcbiAgICAgICAgICAgIGpRdWVyeS5ldmVudC5maXhIb29rc1sgbmFtZSBdID0galF1ZXJ5LmV2ZW50LmtleUhvb2tzO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKCBybW91c2VFdmVudC50ZXN0KCBuYW1lICkgKSB7XG4gICAgICAgICAgICBqUXVlcnkuZXZlbnQuZml4SG9va3NbIG5hbWUgXSA9IGpRdWVyeS5ldmVudC5tb3VzZUhvb2tzO1xuICAgICAgICB9XG4gICAgfSk7XG5cblxuXG4gICAgLyohXG4gICAgICogU2l6emxlIENTUyBTZWxlY3RvciBFbmdpbmVcbiAgICAgKiAgQ29weXJpZ2h0IDIwMTEsIFRoZSBEb2pvIEZvdW5kYXRpb25cbiAgICAgKiAgUmVsZWFzZWQgdW5kZXIgdGhlIE1JVCwgQlNELCBhbmQgR1BMIExpY2Vuc2VzLlxuICAgICAqICBNb3JlIGluZm9ybWF0aW9uOiBodHRwOi8vc2l6emxlanMuY29tL1xuICAgICAqL1xuICAgIChmdW5jdGlvbigpe1xuXG4gICAgICAgIHZhciBjaHVua2VyID0gLygoPzpcXCgoPzpcXChbXigpXStcXCl8W14oKV0rKStcXCl8XFxbKD86XFxbW15cXFtcXF1dKlxcXXxbJ1wiXVteJ1wiXSpbJ1wiXXxbXlxcW1xcXSdcIl0rKStcXF18XFxcXC58W14gPit+LChcXFtcXFxcXSspK3xbPit+XSkoXFxzKixcXHMqKT8oKD86LnxcXHJ8XFxuKSopL2csXG4gICAgICAgICAgICBleHBhbmRvID0gXCJzaXpjYWNoZVwiICsgKE1hdGgucmFuZG9tKCkgKyAnJykucmVwbGFjZSgnLicsICcnKSxcbiAgICAgICAgICAgIGRvbmUgPSAwLFxuICAgICAgICAgICAgdG9TdHJpbmcgPSBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLFxuICAgICAgICAgICAgaGFzRHVwbGljYXRlID0gZmFsc2UsXG4gICAgICAgICAgICBiYXNlSGFzRHVwbGljYXRlID0gdHJ1ZSxcbiAgICAgICAgICAgIHJCYWNrc2xhc2ggPSAvXFxcXC9nLFxuICAgICAgICAgICAgclJldHVybiA9IC9cXHJcXG4vZyxcbiAgICAgICAgICAgIHJOb25Xb3JkID0gL1xcVy87XG5cbi8vIEhlcmUgd2UgY2hlY2sgaWYgdGhlIEphdmFTY3JpcHQgZW5naW5lIGlzIHVzaW5nIHNvbWUgc29ydCBvZlxuLy8gb3B0aW1pemF0aW9uIHdoZXJlIGl0IGRvZXMgbm90IGFsd2F5cyBjYWxsIG91ciBjb21wYXJpc2lvblxuLy8gZnVuY3Rpb24uIElmIHRoYXQgaXMgdGhlIGNhc2UsIGRpc2NhcmQgdGhlIGhhc0R1cGxpY2F0ZSB2YWx1ZS5cbi8vICAgVGh1cyBmYXIgdGhhdCBpbmNsdWRlcyBHb29nbGUgQ2hyb21lLlxuICAgICAgICBbMCwgMF0uc29ydChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIGJhc2VIYXNEdXBsaWNhdGUgPSBmYWxzZTtcbiAgICAgICAgICAgIHJldHVybiAwO1xuICAgICAgICB9KTtcblxuICAgICAgICB2YXIgU2l6emxlID0gZnVuY3Rpb24oIHNlbGVjdG9yLCBjb250ZXh0LCByZXN1bHRzLCBzZWVkICkge1xuICAgICAgICAgICAgcmVzdWx0cyA9IHJlc3VsdHMgfHwgW107XG4gICAgICAgICAgICBjb250ZXh0ID0gY29udGV4dCB8fCBkb2N1bWVudDtcblxuICAgICAgICAgICAgdmFyIG9yaWdDb250ZXh0ID0gY29udGV4dDtcblxuICAgICAgICAgICAgaWYgKCBjb250ZXh0Lm5vZGVUeXBlICE9PSAxICYmIGNvbnRleHQubm9kZVR5cGUgIT09IDkgKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIFtdO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoICFzZWxlY3RvciB8fCB0eXBlb2Ygc2VsZWN0b3IgIT09IFwic3RyaW5nXCIgKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHJlc3VsdHM7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHZhciBtLCBzZXQsIGNoZWNrU2V0LCBleHRyYSwgcmV0LCBjdXIsIHBvcCwgaSxcbiAgICAgICAgICAgICAgICBwcnVuZSA9IHRydWUsXG4gICAgICAgICAgICAgICAgY29udGV4dFhNTCA9IFNpenpsZS5pc1hNTCggY29udGV4dCApLFxuICAgICAgICAgICAgICAgIHBhcnRzID0gW10sXG4gICAgICAgICAgICAgICAgc29GYXIgPSBzZWxlY3RvcjtcblxuICAgICAgICAgICAgLy8gUmVzZXQgdGhlIHBvc2l0aW9uIG9mIHRoZSBjaHVua2VyIHJlZ2V4cCAoc3RhcnQgZnJvbSBoZWFkKVxuICAgICAgICAgICAgZG8ge1xuICAgICAgICAgICAgICAgIGNodW5rZXIuZXhlYyggXCJcIiApO1xuICAgICAgICAgICAgICAgIG0gPSBjaHVua2VyLmV4ZWMoIHNvRmFyICk7XG5cbiAgICAgICAgICAgICAgICBpZiAoIG0gKSB7XG4gICAgICAgICAgICAgICAgICAgIHNvRmFyID0gbVszXTtcblxuICAgICAgICAgICAgICAgICAgICBwYXJ0cy5wdXNoKCBtWzFdICk7XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKCBtWzJdICkge1xuICAgICAgICAgICAgICAgICAgICAgICAgZXh0cmEgPSBtWzNdO1xuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9IHdoaWxlICggbSApO1xuXG4gICAgICAgICAgICBpZiAoIHBhcnRzLmxlbmd0aCA+IDEgJiYgb3JpZ1BPUy5leGVjKCBzZWxlY3RvciApICkge1xuXG4gICAgICAgICAgICAgICAgaWYgKCBwYXJ0cy5sZW5ndGggPT09IDIgJiYgRXhwci5yZWxhdGl2ZVsgcGFydHNbMF0gXSApIHtcbiAgICAgICAgICAgICAgICAgICAgc2V0ID0gcG9zUHJvY2VzcyggcGFydHNbMF0gKyBwYXJ0c1sxXSwgY29udGV4dCwgc2VlZCApO1xuXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgc2V0ID0gRXhwci5yZWxhdGl2ZVsgcGFydHNbMF0gXSA/XG4gICAgICAgICAgICAgICAgICAgICAgICBbIGNvbnRleHQgXSA6XG4gICAgICAgICAgICAgICAgICAgICAgICBTaXp6bGUoIHBhcnRzLnNoaWZ0KCksIGNvbnRleHQgKTtcblxuICAgICAgICAgICAgICAgICAgICB3aGlsZSAoIHBhcnRzLmxlbmd0aCApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGVjdG9yID0gcGFydHMuc2hpZnQoKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCBFeHByLnJlbGF0aXZlWyBzZWxlY3RvciBdICkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGVjdG9yICs9IHBhcnRzLnNoaWZ0KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIHNldCA9IHBvc1Byb2Nlc3MoIHNlbGVjdG9yLCBzZXQsIHNlZWQgKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAvLyBUYWtlIGEgc2hvcnRjdXQgYW5kIHNldCB0aGUgY29udGV4dCBpZiB0aGUgcm9vdCBzZWxlY3RvciBpcyBhbiBJRFxuICAgICAgICAgICAgICAgIC8vIChidXQgbm90IGlmIGl0J2xsIGJlIGZhc3RlciBpZiB0aGUgaW5uZXIgc2VsZWN0b3IgaXMgYW4gSUQpXG4gICAgICAgICAgICAgICAgaWYgKCAhc2VlZCAmJiBwYXJ0cy5sZW5ndGggPiAxICYmIGNvbnRleHQubm9kZVR5cGUgPT09IDkgJiYgIWNvbnRleHRYTUwgJiZcbiAgICAgICAgICAgICAgICAgICAgRXhwci5tYXRjaC5JRC50ZXN0KHBhcnRzWzBdKSAmJiAhRXhwci5tYXRjaC5JRC50ZXN0KHBhcnRzW3BhcnRzLmxlbmd0aCAtIDFdKSApIHtcblxuICAgICAgICAgICAgICAgICAgICByZXQgPSBTaXp6bGUuZmluZCggcGFydHMuc2hpZnQoKSwgY29udGV4dCwgY29udGV4dFhNTCApO1xuICAgICAgICAgICAgICAgICAgICBjb250ZXh0ID0gcmV0LmV4cHIgP1xuICAgICAgICAgICAgICAgICAgICAgICAgU2l6emxlLmZpbHRlciggcmV0LmV4cHIsIHJldC5zZXQgKVswXSA6XG4gICAgICAgICAgICAgICAgICAgICAgICByZXQuc2V0WzBdO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGlmICggY29udGV4dCApIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0ID0gc2VlZCA/XG4gICAgICAgICAgICAgICAgICAgIHsgZXhwcjogcGFydHMucG9wKCksIHNldDogbWFrZUFycmF5KHNlZWQpIH0gOlxuICAgICAgICAgICAgICAgICAgICAgICAgU2l6emxlLmZpbmQoIHBhcnRzLnBvcCgpLCBwYXJ0cy5sZW5ndGggPT09IDEgJiYgKHBhcnRzWzBdID09PSBcIn5cIiB8fCBwYXJ0c1swXSA9PT0gXCIrXCIpICYmIGNvbnRleHQucGFyZW50Tm9kZSA/IGNvbnRleHQucGFyZW50Tm9kZSA6IGNvbnRleHQsIGNvbnRleHRYTUwgKTtcblxuICAgICAgICAgICAgICAgICAgICBzZXQgPSByZXQuZXhwciA/XG4gICAgICAgICAgICAgICAgICAgICAgICBTaXp6bGUuZmlsdGVyKCByZXQuZXhwciwgcmV0LnNldCApIDpcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldC5zZXQ7XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKCBwYXJ0cy5sZW5ndGggPiAwICkge1xuICAgICAgICAgICAgICAgICAgICAgICAgY2hlY2tTZXQgPSBtYWtlQXJyYXkoIHNldCApO1xuXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBwcnVuZSA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgd2hpbGUgKCBwYXJ0cy5sZW5ndGggKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjdXIgPSBwYXJ0cy5wb3AoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHBvcCA9IGN1cjtcblxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCAhRXhwci5yZWxhdGl2ZVsgY3VyIF0gKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY3VyID0gXCJcIjtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcG9wID0gcGFydHMucG9wKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICggcG9wID09IG51bGwgKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcG9wID0gY29udGV4dDtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAgICAgRXhwci5yZWxhdGl2ZVsgY3VyIF0oIGNoZWNrU2V0LCBwb3AsIGNvbnRleHRYTUwgKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgY2hlY2tTZXQgPSBwYXJ0cyA9IFtdO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKCAhY2hlY2tTZXQgKSB7XG4gICAgICAgICAgICAgICAgY2hlY2tTZXQgPSBzZXQ7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmICggIWNoZWNrU2V0ICkge1xuICAgICAgICAgICAgICAgIFNpenpsZS5lcnJvciggY3VyIHx8IHNlbGVjdG9yICk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmICggdG9TdHJpbmcuY2FsbChjaGVja1NldCkgPT09IFwiW29iamVjdCBBcnJheV1cIiApIHtcbiAgICAgICAgICAgICAgICBpZiAoICFwcnVuZSApIHtcbiAgICAgICAgICAgICAgICAgICAgcmVzdWx0cy5wdXNoLmFwcGx5KCByZXN1bHRzLCBjaGVja1NldCApO1xuXG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmICggY29udGV4dCAmJiBjb250ZXh0Lm5vZGVUeXBlID09PSAxICkge1xuICAgICAgICAgICAgICAgICAgICBmb3IgKCBpID0gMDsgY2hlY2tTZXRbaV0gIT0gbnVsbDsgaSsrICkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCBjaGVja1NldFtpXSAmJiAoY2hlY2tTZXRbaV0gPT09IHRydWUgfHwgY2hlY2tTZXRbaV0ubm9kZVR5cGUgPT09IDEgJiYgU2l6emxlLmNvbnRhaW5zKGNvbnRleHQsIGNoZWNrU2V0W2ldKSkgKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0cy5wdXNoKCBzZXRbaV0gKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgZm9yICggaSA9IDA7IGNoZWNrU2V0W2ldICE9IG51bGw7IGkrKyApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICggY2hlY2tTZXRbaV0gJiYgY2hlY2tTZXRbaV0ubm9kZVR5cGUgPT09IDEgKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0cy5wdXNoKCBzZXRbaV0gKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBtYWtlQXJyYXkoIGNoZWNrU2V0LCByZXN1bHRzICk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmICggZXh0cmEgKSB7XG4gICAgICAgICAgICAgICAgU2l6emxlKCBleHRyYSwgb3JpZ0NvbnRleHQsIHJlc3VsdHMsIHNlZWQgKTtcbiAgICAgICAgICAgICAgICBTaXp6bGUudW5pcXVlU29ydCggcmVzdWx0cyApO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByZXR1cm4gcmVzdWx0cztcbiAgICAgICAgfTtcblxuICAgICAgICBTaXp6bGUudW5pcXVlU29ydCA9IGZ1bmN0aW9uKCByZXN1bHRzICkge1xuICAgICAgICAgICAgaWYgKCBzb3J0T3JkZXIgKSB7XG4gICAgICAgICAgICAgICAgaGFzRHVwbGljYXRlID0gYmFzZUhhc0R1cGxpY2F0ZTtcbiAgICAgICAgICAgICAgICByZXN1bHRzLnNvcnQoIHNvcnRPcmRlciApO1xuXG4gICAgICAgICAgICAgICAgaWYgKCBoYXNEdXBsaWNhdGUgKSB7XG4gICAgICAgICAgICAgICAgICAgIGZvciAoIHZhciBpID0gMTsgaSA8IHJlc3VsdHMubGVuZ3RoOyBpKysgKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoIHJlc3VsdHNbaV0gPT09IHJlc3VsdHNbIGkgLSAxIF0gKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0cy5zcGxpY2UoIGktLSwgMSApO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByZXR1cm4gcmVzdWx0cztcbiAgICAgICAgfTtcblxuICAgICAgICBTaXp6bGUubWF0Y2hlcyA9IGZ1bmN0aW9uKCBleHByLCBzZXQgKSB7XG4gICAgICAgICAgICByZXR1cm4gU2l6emxlKCBleHByLCBudWxsLCBudWxsLCBzZXQgKTtcbiAgICAgICAgfTtcblxuICAgICAgICBTaXp6bGUubWF0Y2hlc1NlbGVjdG9yID0gZnVuY3Rpb24oIG5vZGUsIGV4cHIgKSB7XG4gICAgICAgICAgICByZXR1cm4gU2l6emxlKCBleHByLCBudWxsLCBudWxsLCBbbm9kZV0gKS5sZW5ndGggPiAwO1xuICAgICAgICB9O1xuXG4gICAgICAgIFNpenpsZS5maW5kID0gZnVuY3Rpb24oIGV4cHIsIGNvbnRleHQsIGlzWE1MICkge1xuICAgICAgICAgICAgdmFyIHNldCwgaSwgbGVuLCBtYXRjaCwgdHlwZSwgbGVmdDtcblxuICAgICAgICAgICAgaWYgKCAhZXhwciApIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gW107XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGZvciAoIGkgPSAwLCBsZW4gPSBFeHByLm9yZGVyLmxlbmd0aDsgaSA8IGxlbjsgaSsrICkge1xuICAgICAgICAgICAgICAgIHR5cGUgPSBFeHByLm9yZGVyW2ldO1xuXG4gICAgICAgICAgICAgICAgaWYgKCAobWF0Y2ggPSBFeHByLmxlZnRNYXRjaFsgdHlwZSBdLmV4ZWMoIGV4cHIgKSkgKSB7XG4gICAgICAgICAgICAgICAgICAgIGxlZnQgPSBtYXRjaFsxXTtcbiAgICAgICAgICAgICAgICAgICAgbWF0Y2guc3BsaWNlKCAxLCAxICk7XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKCBsZWZ0LnN1YnN0ciggbGVmdC5sZW5ndGggLSAxICkgIT09IFwiXFxcXFwiICkge1xuICAgICAgICAgICAgICAgICAgICAgICAgbWF0Y2hbMV0gPSAobWF0Y2hbMV0gfHwgXCJcIikucmVwbGFjZSggckJhY2tzbGFzaCwgXCJcIiApO1xuICAgICAgICAgICAgICAgICAgICAgICAgc2V0ID0gRXhwci5maW5kWyB0eXBlIF0oIG1hdGNoLCBjb250ZXh0LCBpc1hNTCApO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoIHNldCAhPSBudWxsICkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV4cHIgPSBleHByLnJlcGxhY2UoIEV4cHIubWF0Y2hbIHR5cGUgXSwgXCJcIiApO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoICFzZXQgKSB7XG4gICAgICAgICAgICAgICAgc2V0ID0gdHlwZW9mIGNvbnRleHQuZ2V0RWxlbWVudHNCeVRhZ05hbWUgIT09IFwidW5kZWZpbmVkXCIgP1xuICAgICAgICAgICAgICAgICAgICBjb250ZXh0LmdldEVsZW1lbnRzQnlUYWdOYW1lKCBcIipcIiApIDpcbiAgICAgICAgICAgICAgICAgICAgW107XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHJldHVybiB7IHNldDogc2V0LCBleHByOiBleHByIH07XG4gICAgICAgIH07XG5cbiAgICAgICAgU2l6emxlLmZpbHRlciA9IGZ1bmN0aW9uKCBleHByLCBzZXQsIGlucGxhY2UsIG5vdCApIHtcbiAgICAgICAgICAgIHZhciBtYXRjaCwgYW55Rm91bmQsXG4gICAgICAgICAgICAgICAgdHlwZSwgZm91bmQsIGl0ZW0sIGZpbHRlciwgbGVmdCxcbiAgICAgICAgICAgICAgICBpLCBwYXNzLFxuICAgICAgICAgICAgICAgIG9sZCA9IGV4cHIsXG4gICAgICAgICAgICAgICAgcmVzdWx0ID0gW10sXG4gICAgICAgICAgICAgICAgY3VyTG9vcCA9IHNldCxcbiAgICAgICAgICAgICAgICBpc1hNTEZpbHRlciA9IHNldCAmJiBzZXRbMF0gJiYgU2l6emxlLmlzWE1MKCBzZXRbMF0gKTtcblxuICAgICAgICAgICAgd2hpbGUgKCBleHByICYmIHNldC5sZW5ndGggKSB7XG4gICAgICAgICAgICAgICAgZm9yICggdHlwZSBpbiBFeHByLmZpbHRlciApIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCAobWF0Y2ggPSBFeHByLmxlZnRNYXRjaFsgdHlwZSBdLmV4ZWMoIGV4cHIgKSkgIT0gbnVsbCAmJiBtYXRjaFsyXSApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGZpbHRlciA9IEV4cHIuZmlsdGVyWyB0eXBlIF07XG4gICAgICAgICAgICAgICAgICAgICAgICBsZWZ0ID0gbWF0Y2hbMV07XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIGFueUZvdW5kID0gZmFsc2U7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIG1hdGNoLnNwbGljZSgxLDEpO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoIGxlZnQuc3Vic3RyKCBsZWZ0Lmxlbmd0aCAtIDEgKSA9PT0gXCJcXFxcXCIgKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICggY3VyTG9vcCA9PT0gcmVzdWx0ICkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdCA9IFtdO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoIEV4cHIucHJlRmlsdGVyWyB0eXBlIF0gKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbWF0Y2ggPSBFeHByLnByZUZpbHRlclsgdHlwZSBdKCBtYXRjaCwgY3VyTG9vcCwgaW5wbGFjZSwgcmVzdWx0LCBub3QsIGlzWE1MRmlsdGVyICk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoICFtYXRjaCApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYW55Rm91bmQgPSBmb3VuZCA9IHRydWU7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKCBtYXRjaCA9PT0gdHJ1ZSApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoIG1hdGNoICkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoIGkgPSAwOyAoaXRlbSA9IGN1ckxvb3BbaV0pICE9IG51bGw7IGkrKyApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCBpdGVtICkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm91bmQgPSBmaWx0ZXIoIGl0ZW0sIG1hdGNoLCBpLCBjdXJMb29wICk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXNzID0gbm90IF4gZm91bmQ7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICggaW5wbGFjZSAmJiBmb3VuZCAhPSBudWxsICkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICggcGFzcyApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYW55Rm91bmQgPSB0cnVlO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY3VyTG9vcFtpXSA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmICggcGFzcyApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQucHVzaCggaXRlbSApO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFueUZvdW5kID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCBmb3VuZCAhPT0gdW5kZWZpbmVkICkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICggIWlucGxhY2UgKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN1ckxvb3AgPSByZXN1bHQ7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZXhwciA9IGV4cHIucmVwbGFjZSggRXhwci5tYXRjaFsgdHlwZSBdLCBcIlwiICk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoICFhbnlGb3VuZCApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFtdO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgLy8gSW1wcm9wZXIgZXhwcmVzc2lvblxuICAgICAgICAgICAgICAgIGlmICggZXhwciA9PT0gb2xkICkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoIGFueUZvdW5kID09IG51bGwgKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBTaXp6bGUuZXJyb3IoIGV4cHIgKTtcblxuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBvbGQgPSBleHByO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByZXR1cm4gY3VyTG9vcDtcbiAgICAgICAgfTtcblxuICAgICAgICBTaXp6bGUuZXJyb3IgPSBmdW5jdGlvbiggbXNnICkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCBcIlN5bnRheCBlcnJvciwgdW5yZWNvZ25pemVkIGV4cHJlc3Npb246IFwiICsgbXNnICk7XG4gICAgICAgIH07XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFV0aWxpdHkgZnVuY3Rpb24gZm9yIHJldHJlaXZpbmcgdGhlIHRleHQgdmFsdWUgb2YgYW4gYXJyYXkgb2YgRE9NIG5vZGVzXG4gICAgICAgICAqIEBwYXJhbSB7QXJyYXl8RWxlbWVudH0gZWxlbVxuICAgICAgICAgKi9cbiAgICAgICAgdmFyIGdldFRleHQgPSBTaXp6bGUuZ2V0VGV4dCA9IGZ1bmN0aW9uKCBlbGVtICkge1xuICAgICAgICAgICAgdmFyIGksIG5vZGUsXG4gICAgICAgICAgICAgICAgbm9kZVR5cGUgPSBlbGVtLm5vZGVUeXBlLFxuICAgICAgICAgICAgICAgIHJldCA9IFwiXCI7XG5cbiAgICAgICAgICAgIGlmICggbm9kZVR5cGUgKSB7XG4gICAgICAgICAgICAgICAgaWYgKCBub2RlVHlwZSA9PT0gMSB8fCBub2RlVHlwZSA9PT0gOSApIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gVXNlIHRleHRDb250ZW50IHx8IGlubmVyVGV4dCBmb3IgZWxlbWVudHNcbiAgICAgICAgICAgICAgICAgICAgaWYgKCB0eXBlb2YgZWxlbS50ZXh0Q29udGVudCA9PT0gJ3N0cmluZycgKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZWxlbS50ZXh0Q29udGVudDtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmICggdHlwZW9mIGVsZW0uaW5uZXJUZXh0ID09PSAnc3RyaW5nJyApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFJlcGxhY2UgSUUncyBjYXJyaWFnZSByZXR1cm5zXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZWxlbS5pbm5lclRleHQucmVwbGFjZSggclJldHVybiwgJycgKTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFRyYXZlcnNlIGl0J3MgY2hpbGRyZW5cbiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoIGVsZW0gPSBlbGVtLmZpcnN0Q2hpbGQ7IGVsZW07IGVsZW0gPSBlbGVtLm5leHRTaWJsaW5nKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0ICs9IGdldFRleHQoIGVsZW0gKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoIG5vZGVUeXBlID09PSAzIHx8IG5vZGVUeXBlID09PSA0ICkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZWxlbS5ub2RlVmFsdWU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSBlbHNlIHtcblxuICAgICAgICAgICAgICAgIC8vIElmIG5vIG5vZGVUeXBlLCB0aGlzIGlzIGV4cGVjdGVkIHRvIGJlIGFuIGFycmF5XG4gICAgICAgICAgICAgICAgZm9yICggaSA9IDA7IChub2RlID0gZWxlbVtpXSk7IGkrKyApIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gRG8gbm90IHRyYXZlcnNlIGNvbW1lbnQgbm9kZXNcbiAgICAgICAgICAgICAgICAgICAgaWYgKCBub2RlLm5vZGVUeXBlICE9PSA4ICkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0ICs9IGdldFRleHQoIG5vZGUgKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiByZXQ7XG4gICAgICAgIH07XG5cbiAgICAgICAgdmFyIEV4cHIgPSBTaXp6bGUuc2VsZWN0b3JzID0ge1xuICAgICAgICAgICAgb3JkZXI6IFsgXCJJRFwiLCBcIk5BTUVcIiwgXCJUQUdcIiBdLFxuXG4gICAgICAgICAgICBtYXRjaDoge1xuICAgICAgICAgICAgICAgIElEOiAvIygoPzpbXFx3XFx1MDBjMC1cXHVGRkZGXFwtXXxcXFxcLikrKS8sXG4gICAgICAgICAgICAgICAgQ0xBU1M6IC9cXC4oKD86W1xcd1xcdTAwYzAtXFx1RkZGRlxcLV18XFxcXC4pKykvLFxuICAgICAgICAgICAgICAgIE5BTUU6IC9cXFtuYW1lPVsnXCJdKigoPzpbXFx3XFx1MDBjMC1cXHVGRkZGXFwtXXxcXFxcLikrKVsnXCJdKlxcXS8sXG4gICAgICAgICAgICAgICAgQVRUUjogL1xcW1xccyooKD86W1xcd1xcdTAwYzAtXFx1RkZGRlxcLV18XFxcXC4pKylcXHMqKD86KFxcUz89KVxccyooPzooWydcIl0pKC4qPylcXDN8KCM/KD86W1xcd1xcdTAwYzAtXFx1RkZGRlxcLV18XFxcXC4pKil8KXwpXFxzKlxcXS8sXG4gICAgICAgICAgICAgICAgVEFHOiAvXigoPzpbXFx3XFx1MDBjMC1cXHVGRkZGXFwqXFwtXXxcXFxcLikrKS8sXG4gICAgICAgICAgICAgICAgQ0hJTEQ6IC86KG9ubHl8bnRofGxhc3R8Zmlyc3QpLWNoaWxkKD86XFwoXFxzKihldmVufG9kZHwoPzpbK1xcLV0/XFxkK3woPzpbK1xcLV0/XFxkKik/blxccyooPzpbK1xcLV1cXHMqXFxkKyk/KSlcXHMqXFwpKT8vLFxuICAgICAgICAgICAgICAgIFBPUzogLzoobnRofGVxfGd0fGx0fGZpcnN0fGxhc3R8ZXZlbnxvZGQpKD86XFwoKFxcZCopXFwpKT8oPz1bXlxcLV18JCkvLFxuICAgICAgICAgICAgICAgIFBTRVVETzogLzooKD86W1xcd1xcdTAwYzAtXFx1RkZGRlxcLV18XFxcXC4pKykoPzpcXCgoWydcIl0/KSgoPzpcXChbXlxcKV0rXFwpfFteXFwoXFwpXSopKylcXDJcXCkpPy9cbiAgICAgICAgICAgIH0sXG5cbiAgICAgICAgICAgIGxlZnRNYXRjaDoge30sXG5cbiAgICAgICAgICAgIGF0dHJNYXA6IHtcbiAgICAgICAgICAgICAgICBcImNsYXNzXCI6IFwiY2xhc3NOYW1lXCIsXG4gICAgICAgICAgICAgICAgXCJmb3JcIjogXCJodG1sRm9yXCJcbiAgICAgICAgICAgIH0sXG5cbiAgICAgICAgICAgIGF0dHJIYW5kbGU6IHtcbiAgICAgICAgICAgICAgICBocmVmOiBmdW5jdGlvbiggZWxlbSApIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGVsZW0uZ2V0QXR0cmlidXRlKCBcImhyZWZcIiApO1xuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgdHlwZTogZnVuY3Rpb24oIGVsZW0gKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBlbGVtLmdldEF0dHJpYnV0ZSggXCJ0eXBlXCIgKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuXG4gICAgICAgICAgICByZWxhdGl2ZToge1xuICAgICAgICAgICAgICAgIFwiK1wiOiBmdW5jdGlvbihjaGVja1NldCwgcGFydCl7XG4gICAgICAgICAgICAgICAgICAgIHZhciBpc1BhcnRTdHIgPSB0eXBlb2YgcGFydCA9PT0gXCJzdHJpbmdcIixcbiAgICAgICAgICAgICAgICAgICAgICAgIGlzVGFnID0gaXNQYXJ0U3RyICYmICFyTm9uV29yZC50ZXN0KCBwYXJ0ICksXG4gICAgICAgICAgICAgICAgICAgICAgICBpc1BhcnRTdHJOb3RUYWcgPSBpc1BhcnRTdHIgJiYgIWlzVGFnO1xuXG4gICAgICAgICAgICAgICAgICAgIGlmICggaXNUYWcgKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBwYXJ0ID0gcGFydC50b0xvd2VyQ2FzZSgpO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgZm9yICggdmFyIGkgPSAwLCBsID0gY2hlY2tTZXQubGVuZ3RoLCBlbGVtOyBpIDwgbDsgaSsrICkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCAoZWxlbSA9IGNoZWNrU2V0W2ldKSApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aGlsZSAoIChlbGVtID0gZWxlbS5wcmV2aW91c1NpYmxpbmcpICYmIGVsZW0ubm9kZVR5cGUgIT09IDEgKSB7fVxuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2hlY2tTZXRbaV0gPSBpc1BhcnRTdHJOb3RUYWcgfHwgZWxlbSAmJiBlbGVtLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCkgPT09IHBhcnQgP1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsZW0gfHwgZmFsc2UgOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsZW0gPT09IHBhcnQ7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICBpZiAoIGlzUGFydFN0ck5vdFRhZyApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIFNpenpsZS5maWx0ZXIoIHBhcnQsIGNoZWNrU2V0LCB0cnVlICk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9LFxuXG4gICAgICAgICAgICAgICAgXCI+XCI6IGZ1bmN0aW9uKCBjaGVja1NldCwgcGFydCApIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGVsZW0sXG4gICAgICAgICAgICAgICAgICAgICAgICBpc1BhcnRTdHIgPSB0eXBlb2YgcGFydCA9PT0gXCJzdHJpbmdcIixcbiAgICAgICAgICAgICAgICAgICAgICAgIGkgPSAwLFxuICAgICAgICAgICAgICAgICAgICAgICAgbCA9IGNoZWNrU2V0Lmxlbmd0aDtcblxuICAgICAgICAgICAgICAgICAgICBpZiAoIGlzUGFydFN0ciAmJiAhck5vbldvcmQudGVzdCggcGFydCApICkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcGFydCA9IHBhcnQudG9Mb3dlckNhc2UoKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgZm9yICggOyBpIDwgbDsgaSsrICkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsZW0gPSBjaGVja1NldFtpXTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICggZWxlbSApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHBhcmVudCA9IGVsZW0ucGFyZW50Tm9kZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2hlY2tTZXRbaV0gPSBwYXJlbnQubm9kZU5hbWUudG9Mb3dlckNhc2UoKSA9PT0gcGFydCA/IHBhcmVudCA6IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgZm9yICggOyBpIDwgbDsgaSsrICkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsZW0gPSBjaGVja1NldFtpXTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICggZWxlbSApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2hlY2tTZXRbaV0gPSBpc1BhcnRTdHIgP1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxlbS5wYXJlbnROb2RlIDpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxlbS5wYXJlbnROb2RlID09PSBwYXJ0O1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCBpc1BhcnRTdHIgKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgU2l6emxlLmZpbHRlciggcGFydCwgY2hlY2tTZXQsIHRydWUgKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0sXG5cbiAgICAgICAgICAgICAgICBcIlwiOiBmdW5jdGlvbihjaGVja1NldCwgcGFydCwgaXNYTUwpe1xuICAgICAgICAgICAgICAgICAgICB2YXIgbm9kZUNoZWNrLFxuICAgICAgICAgICAgICAgICAgICAgICAgZG9uZU5hbWUgPSBkb25lKyssXG4gICAgICAgICAgICAgICAgICAgICAgICBjaGVja0ZuID0gZGlyQ2hlY2s7XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKCB0eXBlb2YgcGFydCA9PT0gXCJzdHJpbmdcIiAmJiAhck5vbldvcmQudGVzdCggcGFydCApICkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcGFydCA9IHBhcnQudG9Mb3dlckNhc2UoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIG5vZGVDaGVjayA9IHBhcnQ7XG4gICAgICAgICAgICAgICAgICAgICAgICBjaGVja0ZuID0gZGlyTm9kZUNoZWNrO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgY2hlY2tGbiggXCJwYXJlbnROb2RlXCIsIHBhcnQsIGRvbmVOYW1lLCBjaGVja1NldCwgbm9kZUNoZWNrLCBpc1hNTCApO1xuICAgICAgICAgICAgICAgIH0sXG5cbiAgICAgICAgICAgICAgICBcIn5cIjogZnVuY3Rpb24oIGNoZWNrU2V0LCBwYXJ0LCBpc1hNTCApIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIG5vZGVDaGVjayxcbiAgICAgICAgICAgICAgICAgICAgICAgIGRvbmVOYW1lID0gZG9uZSsrLFxuICAgICAgICAgICAgICAgICAgICAgICAgY2hlY2tGbiA9IGRpckNoZWNrO1xuXG4gICAgICAgICAgICAgICAgICAgIGlmICggdHlwZW9mIHBhcnQgPT09IFwic3RyaW5nXCIgJiYgIXJOb25Xb3JkLnRlc3QoIHBhcnQgKSApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHBhcnQgPSBwYXJ0LnRvTG93ZXJDYXNlKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBub2RlQ2hlY2sgPSBwYXJ0O1xuICAgICAgICAgICAgICAgICAgICAgICAgY2hlY2tGbiA9IGRpck5vZGVDaGVjaztcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIGNoZWNrRm4oIFwicHJldmlvdXNTaWJsaW5nXCIsIHBhcnQsIGRvbmVOYW1lLCBjaGVja1NldCwgbm9kZUNoZWNrLCBpc1hNTCApO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG5cbiAgICAgICAgICAgIGZpbmQ6IHtcbiAgICAgICAgICAgICAgICBJRDogZnVuY3Rpb24oIG1hdGNoLCBjb250ZXh0LCBpc1hNTCApIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCB0eXBlb2YgY29udGV4dC5nZXRFbGVtZW50QnlJZCAhPT0gXCJ1bmRlZmluZWRcIiAmJiAhaXNYTUwgKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgbSA9IGNvbnRleHQuZ2V0RWxlbWVudEJ5SWQobWF0Y2hbMV0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gQ2hlY2sgcGFyZW50Tm9kZSB0byBjYXRjaCB3aGVuIEJsYWNrYmVycnkgNC42IHJldHVybnNcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIG5vZGVzIHRoYXQgYXJlIG5vIGxvbmdlciBpbiB0aGUgZG9jdW1lbnQgIzY5NjNcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBtICYmIG0ucGFyZW50Tm9kZSA/IFttXSA6IFtdO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSxcblxuICAgICAgICAgICAgICAgIE5BTUU6IGZ1bmN0aW9uKCBtYXRjaCwgY29udGV4dCApIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCB0eXBlb2YgY29udGV4dC5nZXRFbGVtZW50c0J5TmFtZSAhPT0gXCJ1bmRlZmluZWRcIiApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciByZXQgPSBbXSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXN1bHRzID0gY29udGV4dC5nZXRFbGVtZW50c0J5TmFtZSggbWF0Y2hbMV0gKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgZm9yICggdmFyIGkgPSAwLCBsID0gcmVzdWx0cy5sZW5ndGg7IGkgPCBsOyBpKysgKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCByZXN1bHRzW2ldLmdldEF0dHJpYnV0ZShcIm5hbWVcIikgPT09IG1hdGNoWzFdICkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXQucHVzaCggcmVzdWx0c1tpXSApO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJldC5sZW5ndGggPT09IDAgPyBudWxsIDogcmV0O1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSxcblxuICAgICAgICAgICAgICAgIFRBRzogZnVuY3Rpb24oIG1hdGNoLCBjb250ZXh0ICkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoIHR5cGVvZiBjb250ZXh0LmdldEVsZW1lbnRzQnlUYWdOYW1lICE9PSBcInVuZGVmaW5lZFwiICkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGNvbnRleHQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoIG1hdGNoWzFdICk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgcHJlRmlsdGVyOiB7XG4gICAgICAgICAgICAgICAgQ0xBU1M6IGZ1bmN0aW9uKCBtYXRjaCwgY3VyTG9vcCwgaW5wbGFjZSwgcmVzdWx0LCBub3QsIGlzWE1MICkge1xuICAgICAgICAgICAgICAgICAgICBtYXRjaCA9IFwiIFwiICsgbWF0Y2hbMV0ucmVwbGFjZSggckJhY2tzbGFzaCwgXCJcIiApICsgXCIgXCI7XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKCBpc1hNTCApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBtYXRjaDtcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIGZvciAoIHZhciBpID0gMCwgZWxlbTsgKGVsZW0gPSBjdXJMb29wW2ldKSAhPSBudWxsOyBpKysgKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoIGVsZW0gKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCBub3QgXiAoZWxlbS5jbGFzc05hbWUgJiYgKFwiIFwiICsgZWxlbS5jbGFzc05hbWUgKyBcIiBcIikucmVwbGFjZSgvW1xcdFxcblxccl0vZywgXCIgXCIpLmluZGV4T2YobWF0Y2gpID49IDApICkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoICFpbnBsYWNlICkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0LnB1c2goIGVsZW0gKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmICggaW5wbGFjZSApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY3VyTG9vcFtpXSA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgICB9LFxuXG4gICAgICAgICAgICAgICAgSUQ6IGZ1bmN0aW9uKCBtYXRjaCApIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG1hdGNoWzFdLnJlcGxhY2UoIHJCYWNrc2xhc2gsIFwiXCIgKTtcbiAgICAgICAgICAgICAgICB9LFxuXG4gICAgICAgICAgICAgICAgVEFHOiBmdW5jdGlvbiggbWF0Y2gsIGN1ckxvb3AgKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBtYXRjaFsxXS5yZXBsYWNlKCByQmFja3NsYXNoLCBcIlwiICkudG9Mb3dlckNhc2UoKTtcbiAgICAgICAgICAgICAgICB9LFxuXG4gICAgICAgICAgICAgICAgQ0hJTEQ6IGZ1bmN0aW9uKCBtYXRjaCApIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCBtYXRjaFsxXSA9PT0gXCJudGhcIiApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICggIW1hdGNoWzJdICkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFNpenpsZS5lcnJvciggbWF0Y2hbMF0gKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAgICAgbWF0Y2hbMl0gPSBtYXRjaFsyXS5yZXBsYWNlKC9eXFwrfFxccyovZywgJycpO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBwYXJzZSBlcXVhdGlvbnMgbGlrZSAnZXZlbicsICdvZGQnLCAnNScsICcybicsICczbisyJywgJzRuLTEnLCAnLW4rNidcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciB0ZXN0ID0gLygtPykoXFxkKikoPzpuKFsrXFwtXT9cXGQqKSk/Ly5leGVjKFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1hdGNoWzJdID09PSBcImV2ZW5cIiAmJiBcIjJuXCIgfHwgbWF0Y2hbMl0gPT09IFwib2RkXCIgJiYgXCIybisxXCIgfHxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAhL1xcRC8udGVzdCggbWF0Y2hbMl0gKSAmJiBcIjBuK1wiICsgbWF0Y2hbMl0gfHwgbWF0Y2hbMl0pO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBjYWxjdWxhdGUgdGhlIG51bWJlcnMgKGZpcnN0KW4rKGxhc3QpIGluY2x1ZGluZyBpZiB0aGV5IGFyZSBuZWdhdGl2ZVxuICAgICAgICAgICAgICAgICAgICAgICAgbWF0Y2hbMl0gPSAodGVzdFsxXSArICh0ZXN0WzJdIHx8IDEpKSAtIDA7XG4gICAgICAgICAgICAgICAgICAgICAgICBtYXRjaFszXSA9IHRlc3RbM10gLSAwO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKCBtYXRjaFsyXSApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIFNpenpsZS5lcnJvciggbWF0Y2hbMF0gKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIC8vIFRPRE86IE1vdmUgdG8gbm9ybWFsIGNhY2hpbmcgc3lzdGVtXG4gICAgICAgICAgICAgICAgICAgIG1hdGNoWzBdID0gZG9uZSsrO1xuXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBtYXRjaDtcbiAgICAgICAgICAgICAgICB9LFxuXG4gICAgICAgICAgICAgICAgQVRUUjogZnVuY3Rpb24oIG1hdGNoLCBjdXJMb29wLCBpbnBsYWNlLCByZXN1bHQsIG5vdCwgaXNYTUwgKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBuYW1lID0gbWF0Y2hbMV0gPSBtYXRjaFsxXS5yZXBsYWNlKCByQmFja3NsYXNoLCBcIlwiICk7XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKCAhaXNYTUwgJiYgRXhwci5hdHRyTWFwW25hbWVdICkge1xuICAgICAgICAgICAgICAgICAgICAgICAgbWF0Y2hbMV0gPSBFeHByLmF0dHJNYXBbbmFtZV07XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAvLyBIYW5kbGUgaWYgYW4gdW4tcXVvdGVkIHZhbHVlIHdhcyB1c2VkXG4gICAgICAgICAgICAgICAgICAgIG1hdGNoWzRdID0gKCBtYXRjaFs0XSB8fCBtYXRjaFs1XSB8fCBcIlwiICkucmVwbGFjZSggckJhY2tzbGFzaCwgXCJcIiApO1xuXG4gICAgICAgICAgICAgICAgICAgIGlmICggbWF0Y2hbMl0gPT09IFwifj1cIiApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG1hdGNoWzRdID0gXCIgXCIgKyBtYXRjaFs0XSArIFwiIFwiO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG1hdGNoO1xuICAgICAgICAgICAgICAgIH0sXG5cbiAgICAgICAgICAgICAgICBQU0VVRE86IGZ1bmN0aW9uKCBtYXRjaCwgY3VyTG9vcCwgaW5wbGFjZSwgcmVzdWx0LCBub3QgKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICggbWF0Y2hbMV0gPT09IFwibm90XCIgKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBJZiB3ZSdyZSBkZWFsaW5nIHdpdGggYSBjb21wbGV4IGV4cHJlc3Npb24sIG9yIGEgc2ltcGxlIG9uZVxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCAoIGNodW5rZXIuZXhlYyhtYXRjaFszXSkgfHwgXCJcIiApLmxlbmd0aCA+IDEgfHwgL15cXHcvLnRlc3QobWF0Y2hbM10pICkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1hdGNoWzNdID0gU2l6emxlKG1hdGNoWzNdLCBudWxsLCBudWxsLCBjdXJMb29wKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgcmV0ID0gU2l6emxlLmZpbHRlcihtYXRjaFszXSwgY3VyTG9vcCwgaW5wbGFjZSwgdHJ1ZSBeIG5vdCk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoICFpbnBsYWNlICkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQucHVzaC5hcHBseSggcmVzdWx0LCByZXQgKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmICggRXhwci5tYXRjaC5QT1MudGVzdCggbWF0Y2hbMF0gKSB8fCBFeHByLm1hdGNoLkNISUxELnRlc3QoIG1hdGNoWzBdICkgKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBtYXRjaDtcbiAgICAgICAgICAgICAgICB9LFxuXG4gICAgICAgICAgICAgICAgUE9TOiBmdW5jdGlvbiggbWF0Y2ggKSB7XG4gICAgICAgICAgICAgICAgICAgIG1hdGNoLnVuc2hpZnQoIHRydWUgKTtcblxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gbWF0Y2g7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSxcblxuICAgICAgICAgICAgZmlsdGVyczoge1xuICAgICAgICAgICAgICAgIGVuYWJsZWQ6IGZ1bmN0aW9uKCBlbGVtICkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZWxlbS5kaXNhYmxlZCA9PT0gZmFsc2UgJiYgZWxlbS50eXBlICE9PSBcImhpZGRlblwiO1xuICAgICAgICAgICAgICAgIH0sXG5cbiAgICAgICAgICAgICAgICBkaXNhYmxlZDogZnVuY3Rpb24oIGVsZW0gKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBlbGVtLmRpc2FibGVkID09PSB0cnVlO1xuICAgICAgICAgICAgICAgIH0sXG5cbiAgICAgICAgICAgICAgICBjaGVja2VkOiBmdW5jdGlvbiggZWxlbSApIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGVsZW0uY2hlY2tlZCA9PT0gdHJ1ZTtcbiAgICAgICAgICAgICAgICB9LFxuXG4gICAgICAgICAgICAgICAgc2VsZWN0ZWQ6IGZ1bmN0aW9uKCBlbGVtICkge1xuICAgICAgICAgICAgICAgICAgICAvLyBBY2Nlc3NpbmcgdGhpcyBwcm9wZXJ0eSBtYWtlcyBzZWxlY3RlZC1ieS1kZWZhdWx0XG4gICAgICAgICAgICAgICAgICAgIC8vIG9wdGlvbnMgaW4gU2FmYXJpIHdvcmsgcHJvcGVybHlcbiAgICAgICAgICAgICAgICAgICAgaWYgKCBlbGVtLnBhcmVudE5vZGUgKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBlbGVtLnBhcmVudE5vZGUuc2VsZWN0ZWRJbmRleDtcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBlbGVtLnNlbGVjdGVkID09PSB0cnVlO1xuICAgICAgICAgICAgICAgIH0sXG5cbiAgICAgICAgICAgICAgICBwYXJlbnQ6IGZ1bmN0aW9uKCBlbGVtICkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gISFlbGVtLmZpcnN0Q2hpbGQ7XG4gICAgICAgICAgICAgICAgfSxcblxuICAgICAgICAgICAgICAgIGVtcHR5OiBmdW5jdGlvbiggZWxlbSApIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICFlbGVtLmZpcnN0Q2hpbGQ7XG4gICAgICAgICAgICAgICAgfSxcblxuICAgICAgICAgICAgICAgIGhhczogZnVuY3Rpb24oIGVsZW0sIGksIG1hdGNoICkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gISFTaXp6bGUoIG1hdGNoWzNdLCBlbGVtICkubGVuZ3RoO1xuICAgICAgICAgICAgICAgIH0sXG5cbiAgICAgICAgICAgICAgICBoZWFkZXI6IGZ1bmN0aW9uKCBlbGVtICkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gKC9oXFxkL2kpLnRlc3QoIGVsZW0ubm9kZU5hbWUgKTtcbiAgICAgICAgICAgICAgICB9LFxuXG4gICAgICAgICAgICAgICAgdGV4dDogZnVuY3Rpb24oIGVsZW0gKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBhdHRyID0gZWxlbS5nZXRBdHRyaWJ1dGUoIFwidHlwZVwiICksIHR5cGUgPSBlbGVtLnR5cGU7XG4gICAgICAgICAgICAgICAgICAgIC8vIElFNiBhbmQgNyB3aWxsIG1hcCBlbGVtLnR5cGUgdG8gJ3RleHQnIGZvciBuZXcgSFRNTDUgdHlwZXMgKHNlYXJjaCwgZXRjKVxuICAgICAgICAgICAgICAgICAgICAvLyB1c2UgZ2V0QXR0cmlidXRlIGluc3RlYWQgdG8gdGVzdCB0aGlzIGNhc2VcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGVsZW0ubm9kZU5hbWUudG9Mb3dlckNhc2UoKSA9PT0gXCJpbnB1dFwiICYmIFwidGV4dFwiID09PSB0eXBlICYmICggYXR0ciA9PT0gdHlwZSB8fCBhdHRyID09PSBudWxsICk7XG4gICAgICAgICAgICAgICAgfSxcblxuICAgICAgICAgICAgICAgIHJhZGlvOiBmdW5jdGlvbiggZWxlbSApIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGVsZW0ubm9kZU5hbWUudG9Mb3dlckNhc2UoKSA9PT0gXCJpbnB1dFwiICYmIFwicmFkaW9cIiA9PT0gZWxlbS50eXBlO1xuICAgICAgICAgICAgICAgIH0sXG5cbiAgICAgICAgICAgICAgICBjaGVja2JveDogZnVuY3Rpb24oIGVsZW0gKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBlbGVtLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCkgPT09IFwiaW5wdXRcIiAmJiBcImNoZWNrYm94XCIgPT09IGVsZW0udHlwZTtcbiAgICAgICAgICAgICAgICB9LFxuXG4gICAgICAgICAgICAgICAgZmlsZTogZnVuY3Rpb24oIGVsZW0gKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBlbGVtLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCkgPT09IFwiaW5wdXRcIiAmJiBcImZpbGVcIiA9PT0gZWxlbS50eXBlO1xuICAgICAgICAgICAgICAgIH0sXG5cbiAgICAgICAgICAgICAgICBwYXNzd29yZDogZnVuY3Rpb24oIGVsZW0gKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBlbGVtLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCkgPT09IFwiaW5wdXRcIiAmJiBcInBhc3N3b3JkXCIgPT09IGVsZW0udHlwZTtcbiAgICAgICAgICAgICAgICB9LFxuXG4gICAgICAgICAgICAgICAgc3VibWl0OiBmdW5jdGlvbiggZWxlbSApIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIG5hbWUgPSBlbGVtLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiAobmFtZSA9PT0gXCJpbnB1dFwiIHx8IG5hbWUgPT09IFwiYnV0dG9uXCIpICYmIFwic3VibWl0XCIgPT09IGVsZW0udHlwZTtcbiAgICAgICAgICAgICAgICB9LFxuXG4gICAgICAgICAgICAgICAgaW1hZ2U6IGZ1bmN0aW9uKCBlbGVtICkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZWxlbS5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpID09PSBcImlucHV0XCIgJiYgXCJpbWFnZVwiID09PSBlbGVtLnR5cGU7XG4gICAgICAgICAgICAgICAgfSxcblxuICAgICAgICAgICAgICAgIHJlc2V0OiBmdW5jdGlvbiggZWxlbSApIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIG5hbWUgPSBlbGVtLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiAobmFtZSA9PT0gXCJpbnB1dFwiIHx8IG5hbWUgPT09IFwiYnV0dG9uXCIpICYmIFwicmVzZXRcIiA9PT0gZWxlbS50eXBlO1xuICAgICAgICAgICAgICAgIH0sXG5cbiAgICAgICAgICAgICAgICBidXR0b246IGZ1bmN0aW9uKCBlbGVtICkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgbmFtZSA9IGVsZW0ubm9kZU5hbWUudG9Mb3dlckNhc2UoKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5hbWUgPT09IFwiaW5wdXRcIiAmJiBcImJ1dHRvblwiID09PSBlbGVtLnR5cGUgfHwgbmFtZSA9PT0gXCJidXR0b25cIjtcbiAgICAgICAgICAgICAgICB9LFxuXG4gICAgICAgICAgICAgICAgaW5wdXQ6IGZ1bmN0aW9uKCBlbGVtICkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gKC9pbnB1dHxzZWxlY3R8dGV4dGFyZWF8YnV0dG9uL2kpLnRlc3QoIGVsZW0ubm9kZU5hbWUgKTtcbiAgICAgICAgICAgICAgICB9LFxuXG4gICAgICAgICAgICAgICAgZm9jdXM6IGZ1bmN0aW9uKCBlbGVtICkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZWxlbSA9PT0gZWxlbS5vd25lckRvY3VtZW50LmFjdGl2ZUVsZW1lbnQ7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHNldEZpbHRlcnM6IHtcbiAgICAgICAgICAgICAgICBmaXJzdDogZnVuY3Rpb24oIGVsZW0sIGkgKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBpID09PSAwO1xuICAgICAgICAgICAgICAgIH0sXG5cbiAgICAgICAgICAgICAgICBsYXN0OiBmdW5jdGlvbiggZWxlbSwgaSwgbWF0Y2gsIGFycmF5ICkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gaSA9PT0gYXJyYXkubGVuZ3RoIC0gMTtcbiAgICAgICAgICAgICAgICB9LFxuXG4gICAgICAgICAgICAgICAgZXZlbjogZnVuY3Rpb24oIGVsZW0sIGkgKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBpICUgMiA9PT0gMDtcbiAgICAgICAgICAgICAgICB9LFxuXG4gICAgICAgICAgICAgICAgb2RkOiBmdW5jdGlvbiggZWxlbSwgaSApIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGkgJSAyID09PSAxO1xuICAgICAgICAgICAgICAgIH0sXG5cbiAgICAgICAgICAgICAgICBsdDogZnVuY3Rpb24oIGVsZW0sIGksIG1hdGNoICkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gaSA8IG1hdGNoWzNdIC0gMDtcbiAgICAgICAgICAgICAgICB9LFxuXG4gICAgICAgICAgICAgICAgZ3Q6IGZ1bmN0aW9uKCBlbGVtLCBpLCBtYXRjaCApIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGkgPiBtYXRjaFszXSAtIDA7XG4gICAgICAgICAgICAgICAgfSxcblxuICAgICAgICAgICAgICAgIG50aDogZnVuY3Rpb24oIGVsZW0sIGksIG1hdGNoICkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gbWF0Y2hbM10gLSAwID09PSBpO1xuICAgICAgICAgICAgICAgIH0sXG5cbiAgICAgICAgICAgICAgICBlcTogZnVuY3Rpb24oIGVsZW0sIGksIG1hdGNoICkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gbWF0Y2hbM10gLSAwID09PSBpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBmaWx0ZXI6IHtcbiAgICAgICAgICAgICAgICBQU0VVRE86IGZ1bmN0aW9uKCBlbGVtLCBtYXRjaCwgaSwgYXJyYXkgKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBuYW1lID0gbWF0Y2hbMV0sXG4gICAgICAgICAgICAgICAgICAgICAgICBmaWx0ZXIgPSBFeHByLmZpbHRlcnNbIG5hbWUgXTtcblxuICAgICAgICAgICAgICAgICAgICBpZiAoIGZpbHRlciApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmaWx0ZXIoIGVsZW0sIGksIG1hdGNoLCBhcnJheSApO1xuXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoIG5hbWUgPT09IFwiY29udGFpbnNcIiApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAoZWxlbS50ZXh0Q29udGVudCB8fCBlbGVtLmlubmVyVGV4dCB8fCBnZXRUZXh0KFsgZWxlbSBdKSB8fCBcIlwiKS5pbmRleE9mKG1hdGNoWzNdKSA+PSAwO1xuXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoIG5hbWUgPT09IFwibm90XCIgKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgbm90ID0gbWF0Y2hbM107XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoIHZhciBqID0gMCwgbCA9IG5vdC5sZW5ndGg7IGogPCBsOyBqKysgKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCBub3Rbal0gPT09IGVsZW0gKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBTaXp6bGUuZXJyb3IoIG5hbWUgKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0sXG5cbiAgICAgICAgICAgICAgICBDSElMRDogZnVuY3Rpb24oIGVsZW0sIG1hdGNoICkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgZmlyc3QsIGxhc3QsXG4gICAgICAgICAgICAgICAgICAgICAgICBkb25lTmFtZSwgcGFyZW50LCBjYWNoZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvdW50LCBkaWZmLFxuICAgICAgICAgICAgICAgICAgICAgICAgdHlwZSA9IG1hdGNoWzFdLFxuICAgICAgICAgICAgICAgICAgICAgICAgbm9kZSA9IGVsZW07XG5cbiAgICAgICAgICAgICAgICAgICAgc3dpdGNoICggdHlwZSApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgXCJvbmx5XCI6XG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlIFwiZmlyc3RcIjpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aGlsZSAoIChub2RlID0gbm9kZS5wcmV2aW91c1NpYmxpbmcpIClcdCB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICggbm9kZS5ub2RlVHlwZSA9PT0gMSApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICggdHlwZSA9PT0gXCJmaXJzdFwiICkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBub2RlID0gZWxlbTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBcImxhc3RcIjpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aGlsZSAoIChub2RlID0gbm9kZS5uZXh0U2libGluZykgKVx0IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCBub2RlLm5vZGVUeXBlID09PSAxICkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgXCJudGhcIjpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaXJzdCA9IG1hdGNoWzJdO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxhc3QgPSBtYXRjaFszXTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICggZmlyc3QgPT09IDEgJiYgbGFzdCA9PT0gMCApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZG9uZU5hbWUgPSBtYXRjaFswXTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXJlbnQgPSBlbGVtLnBhcmVudE5vZGU7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIHBhcmVudCAmJiAocGFyZW50WyBleHBhbmRvIF0gIT09IGRvbmVOYW1lIHx8ICFlbGVtLm5vZGVJbmRleCkgKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvdW50ID0gMDtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgKCBub2RlID0gcGFyZW50LmZpcnN0Q2hpbGQ7IG5vZGU7IG5vZGUgPSBub2RlLm5leHRTaWJsaW5nICkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCBub2RlLm5vZGVUeXBlID09PSAxICkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5vZGUubm9kZUluZGV4ID0gKytjb3VudDtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhcmVudFsgZXhwYW5kbyBdID0gZG9uZU5hbWU7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZGlmZiA9IGVsZW0ubm9kZUluZGV4IC0gbGFzdDtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICggZmlyc3QgPT09IDAgKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBkaWZmID09PSAwO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICggZGlmZiAlIGZpcnN0ID09PSAwICYmIGRpZmYgLyBmaXJzdCA+PSAwICk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSxcblxuICAgICAgICAgICAgICAgIElEOiBmdW5jdGlvbiggZWxlbSwgbWF0Y2ggKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBlbGVtLm5vZGVUeXBlID09PSAxICYmIGVsZW0uZ2V0QXR0cmlidXRlKFwiaWRcIikgPT09IG1hdGNoO1xuICAgICAgICAgICAgICAgIH0sXG5cbiAgICAgICAgICAgICAgICBUQUc6IGZ1bmN0aW9uKCBlbGVtLCBtYXRjaCApIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIChtYXRjaCA9PT0gXCIqXCIgJiYgZWxlbS5ub2RlVHlwZSA9PT0gMSkgfHwgISFlbGVtLm5vZGVOYW1lICYmIGVsZW0ubm9kZU5hbWUudG9Mb3dlckNhc2UoKSA9PT0gbWF0Y2g7XG4gICAgICAgICAgICAgICAgfSxcblxuICAgICAgICAgICAgICAgIENMQVNTOiBmdW5jdGlvbiggZWxlbSwgbWF0Y2ggKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiAoXCIgXCIgKyAoZWxlbS5jbGFzc05hbWUgfHwgZWxlbS5nZXRBdHRyaWJ1dGUoXCJjbGFzc1wiKSkgKyBcIiBcIilcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuaW5kZXhPZiggbWF0Y2ggKSA+IC0xO1xuICAgICAgICAgICAgICAgIH0sXG5cbiAgICAgICAgICAgICAgICBBVFRSOiBmdW5jdGlvbiggZWxlbSwgbWF0Y2ggKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBuYW1lID0gbWF0Y2hbMV0sXG4gICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQgPSBTaXp6bGUuYXR0ciA/XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgU2l6emxlLmF0dHIoIGVsZW0sIG5hbWUgKSA6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgRXhwci5hdHRySGFuZGxlWyBuYW1lIF0gP1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBFeHByLmF0dHJIYW5kbGVbIG5hbWUgXSggZWxlbSApIDpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxlbVsgbmFtZSBdICE9IG51bGwgP1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxlbVsgbmFtZSBdIDpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsZW0uZ2V0QXR0cmlidXRlKCBuYW1lICksXG4gICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZSA9IHJlc3VsdCArIFwiXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICB0eXBlID0gbWF0Y2hbMl0sXG4gICAgICAgICAgICAgICAgICAgICAgICBjaGVjayA9IG1hdGNoWzRdO1xuXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiByZXN1bHQgPT0gbnVsbCA/XG4gICAgICAgICAgICAgICAgICAgIHR5cGUgPT09IFwiIT1cIiA6XG4gICAgICAgICAgICAgICAgICAgICAgICAhdHlwZSAmJiBTaXp6bGUuYXR0ciA/XG4gICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQgIT0gbnVsbCA6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZSA9PT0gXCI9XCIgP1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlID09PSBjaGVjayA6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGUgPT09IFwiKj1cIiA/XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlLmluZGV4T2YoY2hlY2spID49IDAgOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZSA9PT0gXCJ+PVwiID9cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIChcIiBcIiArIHZhbHVlICsgXCIgXCIpLmluZGV4T2YoY2hlY2spID49IDAgOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICFjaGVjayA/XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWUgJiYgcmVzdWx0ICE9PSBmYWxzZSA6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGUgPT09IFwiIT1cIiA/XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlICE9PSBjaGVjayA6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlID09PSBcIl49XCIgP1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWUuaW5kZXhPZihjaGVjaykgPT09IDAgOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGUgPT09IFwiJD1cIiA/XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWUuc3Vic3RyKHZhbHVlLmxlbmd0aCAtIGNoZWNrLmxlbmd0aCkgPT09IGNoZWNrIDpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZSA9PT0gXCJ8PVwiID9cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWUgPT09IGNoZWNrIHx8IHZhbHVlLnN1YnN0cigwLCBjaGVjay5sZW5ndGggKyAxKSA9PT0gY2hlY2sgKyBcIi1cIiA6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmYWxzZTtcbiAgICAgICAgICAgICAgICB9LFxuXG4gICAgICAgICAgICAgICAgUE9TOiBmdW5jdGlvbiggZWxlbSwgbWF0Y2gsIGksIGFycmF5ICkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgbmFtZSA9IG1hdGNoWzJdLFxuICAgICAgICAgICAgICAgICAgICAgICAgZmlsdGVyID0gRXhwci5zZXRGaWx0ZXJzWyBuYW1lIF07XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKCBmaWx0ZXIgKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmlsdGVyKCBlbGVtLCBpLCBtYXRjaCwgYXJyYXkgKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcblxuICAgICAgICB2YXIgb3JpZ1BPUyA9IEV4cHIubWF0Y2guUE9TLFxuICAgICAgICAgICAgZmVzY2FwZSA9IGZ1bmN0aW9uKGFsbCwgbnVtKXtcbiAgICAgICAgICAgICAgICByZXR1cm4gXCJcXFxcXCIgKyAobnVtIC0gMCArIDEpO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICBmb3IgKCB2YXIgdHlwZSBpbiBFeHByLm1hdGNoICkge1xuICAgICAgICAgICAgRXhwci5tYXRjaFsgdHlwZSBdID0gbmV3IFJlZ0V4cCggRXhwci5tYXRjaFsgdHlwZSBdLnNvdXJjZSArICgvKD8hW15cXFtdKlxcXSkoPyFbXlxcKF0qXFwpKS8uc291cmNlKSApO1xuICAgICAgICAgICAgRXhwci5sZWZ0TWF0Y2hbIHR5cGUgXSA9IG5ldyBSZWdFeHAoIC8oXig/Oi58XFxyfFxcbikqPykvLnNvdXJjZSArIEV4cHIubWF0Y2hbIHR5cGUgXS5zb3VyY2UucmVwbGFjZSgvXFxcXChcXGQrKS9nLCBmZXNjYXBlKSApO1xuICAgICAgICB9XG5cbiAgICAgICAgdmFyIG1ha2VBcnJheSA9IGZ1bmN0aW9uKCBhcnJheSwgcmVzdWx0cyApIHtcbiAgICAgICAgICAgIGFycmF5ID0gQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoIGFycmF5LCAwICk7XG5cbiAgICAgICAgICAgIGlmICggcmVzdWx0cyApIHtcbiAgICAgICAgICAgICAgICByZXN1bHRzLnB1c2guYXBwbHkoIHJlc3VsdHMsIGFycmF5ICk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHJlc3VsdHM7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHJldHVybiBhcnJheTtcbiAgICAgICAgfTtcblxuLy8gUGVyZm9ybSBhIHNpbXBsZSBjaGVjayB0byBkZXRlcm1pbmUgaWYgdGhlIGJyb3dzZXIgaXMgY2FwYWJsZSBvZlxuLy8gY29udmVydGluZyBhIE5vZGVMaXN0IHRvIGFuIGFycmF5IHVzaW5nIGJ1aWx0aW4gbWV0aG9kcy5cbi8vIEFsc28gdmVyaWZpZXMgdGhhdCB0aGUgcmV0dXJuZWQgYXJyYXkgaG9sZHMgRE9NIG5vZGVzXG4vLyAod2hpY2ggaXMgbm90IHRoZSBjYXNlIGluIHRoZSBCbGFja2JlcnJ5IGJyb3dzZXIpXG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbCggZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmNoaWxkTm9kZXMsIDAgKVswXS5ub2RlVHlwZTtcblxuLy8gUHJvdmlkZSBhIGZhbGxiYWNrIG1ldGhvZCBpZiBpdCBkb2VzIG5vdCB3b3JrXG4gICAgICAgIH0gY2F0Y2goIGUgKSB7XG4gICAgICAgICAgICBtYWtlQXJyYXkgPSBmdW5jdGlvbiggYXJyYXksIHJlc3VsdHMgKSB7XG4gICAgICAgICAgICAgICAgdmFyIGkgPSAwLFxuICAgICAgICAgICAgICAgICAgICByZXQgPSByZXN1bHRzIHx8IFtdO1xuXG4gICAgICAgICAgICAgICAgaWYgKCB0b1N0cmluZy5jYWxsKGFycmF5KSA9PT0gXCJbb2JqZWN0IEFycmF5XVwiICkge1xuICAgICAgICAgICAgICAgICAgICBBcnJheS5wcm90b3R5cGUucHVzaC5hcHBseSggcmV0LCBhcnJheSApO1xuXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCB0eXBlb2YgYXJyYXkubGVuZ3RoID09PSBcIm51bWJlclwiICkge1xuICAgICAgICAgICAgICAgICAgICAgICAgZm9yICggdmFyIGwgPSBhcnJheS5sZW5ndGg7IGkgPCBsOyBpKysgKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0LnB1c2goIGFycmF5W2ldICk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoIDsgYXJyYXlbaV07IGkrKyApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXQucHVzaCggYXJyYXlbaV0gKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIHJldHVybiByZXQ7XG4gICAgICAgICAgICB9O1xuICAgICAgICB9XG5cbiAgICAgICAgdmFyIHNvcnRPcmRlciwgc2libGluZ0NoZWNrO1xuXG4gICAgICAgIGlmICggZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmNvbXBhcmVEb2N1bWVudFBvc2l0aW9uICkge1xuICAgICAgICAgICAgc29ydE9yZGVyID0gZnVuY3Rpb24oIGEsIGIgKSB7XG4gICAgICAgICAgICAgICAgaWYgKCBhID09PSBiICkge1xuICAgICAgICAgICAgICAgICAgICBoYXNEdXBsaWNhdGUgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gMDtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBpZiAoICFhLmNvbXBhcmVEb2N1bWVudFBvc2l0aW9uIHx8ICFiLmNvbXBhcmVEb2N1bWVudFBvc2l0aW9uICkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gYS5jb21wYXJlRG9jdW1lbnRQb3NpdGlvbiA/IC0xIDogMTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICByZXR1cm4gYS5jb21wYXJlRG9jdW1lbnRQb3NpdGlvbihiKSAmIDQgPyAtMSA6IDE7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBzb3J0T3JkZXIgPSBmdW5jdGlvbiggYSwgYiApIHtcbiAgICAgICAgICAgICAgICAvLyBUaGUgbm9kZXMgYXJlIGlkZW50aWNhbCwgd2UgY2FuIGV4aXQgZWFybHlcbiAgICAgICAgICAgICAgICBpZiAoIGEgPT09IGIgKSB7XG4gICAgICAgICAgICAgICAgICAgIGhhc0R1cGxpY2F0ZSA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiAwO1xuXG4gICAgICAgICAgICAgICAgICAgIC8vIEZhbGxiYWNrIHRvIHVzaW5nIHNvdXJjZUluZGV4IChpbiBJRSkgaWYgaXQncyBhdmFpbGFibGUgb24gYm90aCBub2Rlc1xuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoIGEuc291cmNlSW5kZXggJiYgYi5zb3VyY2VJbmRleCApIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGEuc291cmNlSW5kZXggLSBiLnNvdXJjZUluZGV4O1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIHZhciBhbCwgYmwsXG4gICAgICAgICAgICAgICAgICAgIGFwID0gW10sXG4gICAgICAgICAgICAgICAgICAgIGJwID0gW10sXG4gICAgICAgICAgICAgICAgICAgIGF1cCA9IGEucGFyZW50Tm9kZSxcbiAgICAgICAgICAgICAgICAgICAgYnVwID0gYi5wYXJlbnROb2RlLFxuICAgICAgICAgICAgICAgICAgICBjdXIgPSBhdXA7XG5cbiAgICAgICAgICAgICAgICAvLyBJZiB0aGUgbm9kZXMgYXJlIHNpYmxpbmdzIChvciBpZGVudGljYWwpIHdlIGNhbiBkbyBhIHF1aWNrIGNoZWNrXG4gICAgICAgICAgICAgICAgaWYgKCBhdXAgPT09IGJ1cCApIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHNpYmxpbmdDaGVjayggYSwgYiApO1xuXG4gICAgICAgICAgICAgICAgICAgIC8vIElmIG5vIHBhcmVudHMgd2VyZSBmb3VuZCB0aGVuIHRoZSBub2RlcyBhcmUgZGlzY29ubmVjdGVkXG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmICggIWF1cCApIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIC0xO1xuXG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmICggIWJ1cCApIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDE7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgLy8gT3RoZXJ3aXNlIHRoZXkncmUgc29tZXdoZXJlIGVsc2UgaW4gdGhlIHRyZWUgc28gd2UgbmVlZFxuICAgICAgICAgICAgICAgIC8vIHRvIGJ1aWxkIHVwIGEgZnVsbCBsaXN0IG9mIHRoZSBwYXJlbnROb2RlcyBmb3IgY29tcGFyaXNvblxuICAgICAgICAgICAgICAgIHdoaWxlICggY3VyICkge1xuICAgICAgICAgICAgICAgICAgICBhcC51bnNoaWZ0KCBjdXIgKTtcbiAgICAgICAgICAgICAgICAgICAgY3VyID0gY3VyLnBhcmVudE5vZGU7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgY3VyID0gYnVwO1xuXG4gICAgICAgICAgICAgICAgd2hpbGUgKCBjdXIgKSB7XG4gICAgICAgICAgICAgICAgICAgIGJwLnVuc2hpZnQoIGN1ciApO1xuICAgICAgICAgICAgICAgICAgICBjdXIgPSBjdXIucGFyZW50Tm9kZTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBhbCA9IGFwLmxlbmd0aDtcbiAgICAgICAgICAgICAgICBibCA9IGJwLmxlbmd0aDtcblxuICAgICAgICAgICAgICAgIC8vIFN0YXJ0IHdhbGtpbmcgZG93biB0aGUgdHJlZSBsb29raW5nIGZvciBhIGRpc2NyZXBhbmN5XG4gICAgICAgICAgICAgICAgZm9yICggdmFyIGkgPSAwOyBpIDwgYWwgJiYgaSA8IGJsOyBpKysgKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICggYXBbaV0gIT09IGJwW2ldICkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHNpYmxpbmdDaGVjayggYXBbaV0sIGJwW2ldICk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAvLyBXZSBlbmRlZCBzb21lcGxhY2UgdXAgdGhlIHRyZWUgc28gZG8gYSBzaWJsaW5nIGNoZWNrXG4gICAgICAgICAgICAgICAgcmV0dXJuIGkgPT09IGFsID9cbiAgICAgICAgICAgICAgICAgICAgc2libGluZ0NoZWNrKCBhLCBicFtpXSwgLTEgKSA6XG4gICAgICAgICAgICAgICAgICAgIHNpYmxpbmdDaGVjayggYXBbaV0sIGIsIDEgKTtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIHNpYmxpbmdDaGVjayA9IGZ1bmN0aW9uKCBhLCBiLCByZXQgKSB7XG4gICAgICAgICAgICAgICAgaWYgKCBhID09PSBiICkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmV0O1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIHZhciBjdXIgPSBhLm5leHRTaWJsaW5nO1xuXG4gICAgICAgICAgICAgICAgd2hpbGUgKCBjdXIgKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICggY3VyID09PSBiICkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIC0xO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgY3VyID0gY3VyLm5leHRTaWJsaW5nO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIHJldHVybiAxO1xuICAgICAgICAgICAgfTtcbiAgICAgICAgfVxuXG4vLyBDaGVjayB0byBzZWUgaWYgdGhlIGJyb3dzZXIgcmV0dXJucyBlbGVtZW50cyBieSBuYW1lIHdoZW5cbi8vIHF1ZXJ5aW5nIGJ5IGdldEVsZW1lbnRCeUlkIChhbmQgcHJvdmlkZSBhIHdvcmthcm91bmQpXG4gICAgICAgIChmdW5jdGlvbigpe1xuICAgICAgICAgICAgLy8gV2UncmUgZ29pbmcgdG8gaW5qZWN0IGEgZmFrZSBpbnB1dCBlbGVtZW50IHdpdGggYSBzcGVjaWZpZWQgbmFtZVxuICAgICAgICAgICAgdmFyIGZvcm0gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpLFxuICAgICAgICAgICAgICAgIGlkID0gXCJzY3JpcHRcIiArIChuZXcgRGF0ZSgpKS5nZXRUaW1lKCksXG4gICAgICAgICAgICAgICAgcm9vdCA9IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudDtcblxuICAgICAgICAgICAgZm9ybS5pbm5lckhUTUwgPSBcIjxhIG5hbWU9J1wiICsgaWQgKyBcIicvPlwiO1xuXG4gICAgICAgICAgICAvLyBJbmplY3QgaXQgaW50byB0aGUgcm9vdCBlbGVtZW50LCBjaGVjayBpdHMgc3RhdHVzLCBhbmQgcmVtb3ZlIGl0IHF1aWNrbHlcbiAgICAgICAgICAgIHJvb3QuaW5zZXJ0QmVmb3JlKCBmb3JtLCByb290LmZpcnN0Q2hpbGQgKTtcblxuICAgICAgICAgICAgLy8gVGhlIHdvcmthcm91bmQgaGFzIHRvIGRvIGFkZGl0aW9uYWwgY2hlY2tzIGFmdGVyIGEgZ2V0RWxlbWVudEJ5SWRcbiAgICAgICAgICAgIC8vIFdoaWNoIHNsb3dzIHRoaW5ncyBkb3duIGZvciBvdGhlciBicm93c2VycyAoaGVuY2UgdGhlIGJyYW5jaGluZylcbiAgICAgICAgICAgIGlmICggZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoIGlkICkgKSB7XG4gICAgICAgICAgICAgICAgRXhwci5maW5kLklEID0gZnVuY3Rpb24oIG1hdGNoLCBjb250ZXh0LCBpc1hNTCApIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCB0eXBlb2YgY29udGV4dC5nZXRFbGVtZW50QnlJZCAhPT0gXCJ1bmRlZmluZWRcIiAmJiAhaXNYTUwgKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgbSA9IGNvbnRleHQuZ2V0RWxlbWVudEJ5SWQobWF0Y2hbMV0pO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gbSA/XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbS5pZCA9PT0gbWF0Y2hbMV0gfHwgdHlwZW9mIG0uZ2V0QXR0cmlidXRlTm9kZSAhPT0gXCJ1bmRlZmluZWRcIiAmJiBtLmdldEF0dHJpYnV0ZU5vZGUoXCJpZFwiKS5ub2RlVmFsdWUgPT09IG1hdGNoWzFdID9cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgW21dIDpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdW5kZWZpbmVkIDpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBbXTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgICAgICBFeHByLmZpbHRlci5JRCA9IGZ1bmN0aW9uKCBlbGVtLCBtYXRjaCApIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIG5vZGUgPSB0eXBlb2YgZWxlbS5nZXRBdHRyaWJ1dGVOb2RlICE9PSBcInVuZGVmaW5lZFwiICYmIGVsZW0uZ2V0QXR0cmlidXRlTm9kZShcImlkXCIpO1xuXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBlbGVtLm5vZGVUeXBlID09PSAxICYmIG5vZGUgJiYgbm9kZS5ub2RlVmFsdWUgPT09IG1hdGNoO1xuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHJvb3QucmVtb3ZlQ2hpbGQoIGZvcm0gKTtcblxuICAgICAgICAgICAgLy8gcmVsZWFzZSBtZW1vcnkgaW4gSUVcbiAgICAgICAgICAgIHJvb3QgPSBmb3JtID0gbnVsbDtcbiAgICAgICAgfSkoKTtcblxuICAgICAgICAoZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIC8vIENoZWNrIHRvIHNlZSBpZiB0aGUgYnJvd3NlciByZXR1cm5zIG9ubHkgZWxlbWVudHNcbiAgICAgICAgICAgIC8vIHdoZW4gZG9pbmcgZ2V0RWxlbWVudHNCeVRhZ05hbWUoXCIqXCIpXG5cbiAgICAgICAgICAgIC8vIENyZWF0ZSBhIGZha2UgZWxlbWVudFxuICAgICAgICAgICAgdmFyIGRpdiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG4gICAgICAgICAgICBkaXYuYXBwZW5kQ2hpbGQoIGRvY3VtZW50LmNyZWF0ZUNvbW1lbnQoXCJcIikgKTtcblxuICAgICAgICAgICAgLy8gTWFrZSBzdXJlIG5vIGNvbW1lbnRzIGFyZSBmb3VuZFxuICAgICAgICAgICAgaWYgKCBkaXYuZ2V0RWxlbWVudHNCeVRhZ05hbWUoXCIqXCIpLmxlbmd0aCA+IDAgKSB7XG4gICAgICAgICAgICAgICAgRXhwci5maW5kLlRBRyA9IGZ1bmN0aW9uKCBtYXRjaCwgY29udGV4dCApIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIHJlc3VsdHMgPSBjb250ZXh0LmdldEVsZW1lbnRzQnlUYWdOYW1lKCBtYXRjaFsxXSApO1xuXG4gICAgICAgICAgICAgICAgICAgIC8vIEZpbHRlciBvdXQgcG9zc2libGUgY29tbWVudHNcbiAgICAgICAgICAgICAgICAgICAgaWYgKCBtYXRjaFsxXSA9PT0gXCIqXCIgKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgdG1wID0gW107XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoIHZhciBpID0gMDsgcmVzdWx0c1tpXTsgaSsrICkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICggcmVzdWx0c1tpXS5ub2RlVHlwZSA9PT0gMSApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdG1wLnB1c2goIHJlc3VsdHNbaV0gKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdHMgPSB0bXA7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmVzdWx0cztcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBDaGVjayB0byBzZWUgaWYgYW4gYXR0cmlidXRlIHJldHVybnMgbm9ybWFsaXplZCBocmVmIGF0dHJpYnV0ZXNcbiAgICAgICAgICAgIGRpdi5pbm5lckhUTUwgPSBcIjxhIGhyZWY9JyMnPjwvYT5cIjtcblxuICAgICAgICAgICAgaWYgKCBkaXYuZmlyc3RDaGlsZCAmJiB0eXBlb2YgZGl2LmZpcnN0Q2hpbGQuZ2V0QXR0cmlidXRlICE9PSBcInVuZGVmaW5lZFwiICYmXG4gICAgICAgICAgICAgICAgZGl2LmZpcnN0Q2hpbGQuZ2V0QXR0cmlidXRlKFwiaHJlZlwiKSAhPT0gXCIjXCIgKSB7XG5cbiAgICAgICAgICAgICAgICBFeHByLmF0dHJIYW5kbGUuaHJlZiA9IGZ1bmN0aW9uKCBlbGVtICkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZWxlbS5nZXRBdHRyaWJ1dGUoIFwiaHJlZlwiLCAyICk7XG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gcmVsZWFzZSBtZW1vcnkgaW4gSUVcbiAgICAgICAgICAgIGRpdiA9IG51bGw7XG4gICAgICAgIH0pKCk7XG5cbiAgICAgICAgaWYgKCBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsICkge1xuICAgICAgICAgICAgKGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgdmFyIG9sZFNpenpsZSA9IFNpenpsZSxcbiAgICAgICAgICAgICAgICAgICAgZGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKSxcbiAgICAgICAgICAgICAgICAgICAgaWQgPSBcIl9fc2l6emxlX19cIjtcblxuICAgICAgICAgICAgICAgIGRpdi5pbm5lckhUTUwgPSBcIjxwIGNsYXNzPSdURVNUJz48L3A+XCI7XG5cbiAgICAgICAgICAgICAgICAvLyBTYWZhcmkgY2FuJ3QgaGFuZGxlIHVwcGVyY2FzZSBvciB1bmljb2RlIGNoYXJhY3RlcnMgd2hlblxuICAgICAgICAgICAgICAgIC8vIGluIHF1aXJrcyBtb2RlLlxuICAgICAgICAgICAgICAgIGlmICggZGl2LnF1ZXJ5U2VsZWN0b3JBbGwgJiYgZGl2LnF1ZXJ5U2VsZWN0b3JBbGwoXCIuVEVTVFwiKS5sZW5ndGggPT09IDAgKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBTaXp6bGUgPSBmdW5jdGlvbiggcXVlcnksIGNvbnRleHQsIGV4dHJhLCBzZWVkICkge1xuICAgICAgICAgICAgICAgICAgICBjb250ZXh0ID0gY29udGV4dCB8fCBkb2N1bWVudDtcblxuICAgICAgICAgICAgICAgICAgICAvLyBPbmx5IHVzZSBxdWVyeVNlbGVjdG9yQWxsIG9uIG5vbi1YTUwgZG9jdW1lbnRzXG4gICAgICAgICAgICAgICAgICAgIC8vIChJRCBzZWxlY3RvcnMgZG9uJ3Qgd29yayBpbiBub24tSFRNTCBkb2N1bWVudHMpXG4gICAgICAgICAgICAgICAgICAgIGlmICggIXNlZWQgJiYgIVNpenpsZS5pc1hNTChjb250ZXh0KSApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFNlZSBpZiB3ZSBmaW5kIGEgc2VsZWN0b3IgdG8gc3BlZWQgdXBcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBtYXRjaCA9IC9eKFxcdyskKXxeXFwuKFtcXHdcXC1dKyQpfF4jKFtcXHdcXC1dKyQpLy5leGVjKCBxdWVyeSApO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoIG1hdGNoICYmIChjb250ZXh0Lm5vZGVUeXBlID09PSAxIHx8IGNvbnRleHQubm9kZVR5cGUgPT09IDkpICkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIFNwZWVkLXVwOiBTaXp6bGUoXCJUQUdcIilcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIG1hdGNoWzFdICkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gbWFrZUFycmF5KCBjb250ZXh0LmdldEVsZW1lbnRzQnlUYWdOYW1lKCBxdWVyeSApLCBleHRyYSApO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIFNwZWVkLXVwOiBTaXp6bGUoXCIuQ0xBU1NcIilcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKCBtYXRjaFsyXSAmJiBFeHByLmZpbmQuQ0xBU1MgJiYgY29udGV4dC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lICkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gbWFrZUFycmF5KCBjb250ZXh0LmdldEVsZW1lbnRzQnlDbGFzc05hbWUoIG1hdGNoWzJdICksIGV4dHJhICk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoIGNvbnRleHQubm9kZVR5cGUgPT09IDkgKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gU3BlZWQtdXA6IFNpenpsZShcImJvZHlcIilcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBUaGUgYm9keSBlbGVtZW50IG9ubHkgZXhpc3RzIG9uY2UsIG9wdGltaXplIGZpbmRpbmcgaXRcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIHF1ZXJ5ID09PSBcImJvZHlcIiAmJiBjb250ZXh0LmJvZHkgKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBtYWtlQXJyYXkoIFsgY29udGV4dC5ib2R5IF0sIGV4dHJhICk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gU3BlZWQtdXA6IFNpenpsZShcIiNJRFwiKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoIG1hdGNoICYmIG1hdGNoWzNdICkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgZWxlbSA9IGNvbnRleHQuZ2V0RWxlbWVudEJ5SWQoIG1hdGNoWzNdICk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gQ2hlY2sgcGFyZW50Tm9kZSB0byBjYXRjaCB3aGVuIEJsYWNrYmVycnkgNC42IHJldHVybnNcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gbm9kZXMgdGhhdCBhcmUgbm8gbG9uZ2VyIGluIHRoZSBkb2N1bWVudCAjNjk2M1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIGVsZW0gJiYgZWxlbS5wYXJlbnROb2RlICkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gSGFuZGxlIHRoZSBjYXNlIHdoZXJlIElFIGFuZCBPcGVyYSByZXR1cm4gaXRlbXNcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGJ5IG5hbWUgaW5zdGVhZCBvZiBJRFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCBlbGVtLmlkID09PSBtYXRjaFszXSApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gbWFrZUFycmF5KCBbIGVsZW0gXSwgZXh0cmEgKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG1ha2VBcnJheSggW10sIGV4dHJhICk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gbWFrZUFycmF5KCBjb250ZXh0LnF1ZXJ5U2VsZWN0b3JBbGwocXVlcnkpLCBleHRyYSApO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gY2F0Y2gocXNhRXJyb3IpIHt9XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBxU0Egd29ya3Mgc3RyYW5nZWx5IG9uIEVsZW1lbnQtcm9vdGVkIHF1ZXJpZXNcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBXZSBjYW4gd29yayBhcm91bmQgdGhpcyBieSBzcGVjaWZ5aW5nIGFuIGV4dHJhIElEIG9uIHRoZSByb290XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gYW5kIHdvcmtpbmcgdXAgZnJvbSB0aGVyZSAoVGhhbmtzIHRvIEFuZHJldyBEdXBvbnQgZm9yIHRoZSB0ZWNobmlxdWUpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gSUUgOCBkb2Vzbid0IHdvcmsgb24gb2JqZWN0IGVsZW1lbnRzXG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKCBjb250ZXh0Lm5vZGVUeXBlID09PSAxICYmIGNvbnRleHQubm9kZU5hbWUudG9Mb3dlckNhc2UoKSAhPT0gXCJvYmplY3RcIiApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgb2xkQ29udGV4dCA9IGNvbnRleHQsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9sZCA9IGNvbnRleHQuZ2V0QXR0cmlidXRlKCBcImlkXCIgKSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbmlkID0gb2xkIHx8IGlkLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBoYXNQYXJlbnQgPSBjb250ZXh0LnBhcmVudE5vZGUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlbGF0aXZlSGllcmFyY2h5U2VsZWN0b3IgPSAvXlxccypbK35dLy50ZXN0KCBxdWVyeSApO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCAhb2xkICkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb250ZXh0LnNldEF0dHJpYnV0ZSggXCJpZFwiLCBuaWQgKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuaWQgPSBuaWQucmVwbGFjZSggLycvZywgXCJcXFxcJCZcIiApO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIHJlbGF0aXZlSGllcmFyY2h5U2VsZWN0b3IgJiYgaGFzUGFyZW50ICkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb250ZXh0ID0gY29udGV4dC5wYXJlbnROb2RlO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICggIXJlbGF0aXZlSGllcmFyY2h5U2VsZWN0b3IgfHwgaGFzUGFyZW50ICkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG1ha2VBcnJheSggY29udGV4dC5xdWVyeVNlbGVjdG9yQWxsKCBcIltpZD0nXCIgKyBuaWQgKyBcIiddIFwiICsgcXVlcnkgKSwgZXh0cmEgKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBjYXRjaChwc2V1ZG9FcnJvcikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZmluYWxseSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICggIW9sZCApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9sZENvbnRleHQucmVtb3ZlQXR0cmlidXRlKCBcImlkXCIgKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBvbGRTaXp6bGUocXVlcnksIGNvbnRleHQsIGV4dHJhLCBzZWVkKTtcbiAgICAgICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAgICAgZm9yICggdmFyIHByb3AgaW4gb2xkU2l6emxlICkge1xuICAgICAgICAgICAgICAgICAgICBTaXp6bGVbIHByb3AgXSA9IG9sZFNpenpsZVsgcHJvcCBdO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIC8vIHJlbGVhc2UgbWVtb3J5IGluIElFXG4gICAgICAgICAgICAgICAgZGl2ID0gbnVsbDtcbiAgICAgICAgICAgIH0pKCk7XG4gICAgICAgIH1cblxuICAgICAgICAoZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHZhciBodG1sID0gZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LFxuICAgICAgICAgICAgICAgIG1hdGNoZXMgPSBodG1sLm1hdGNoZXNTZWxlY3RvciB8fCBodG1sLm1vek1hdGNoZXNTZWxlY3RvciB8fCBodG1sLndlYmtpdE1hdGNoZXNTZWxlY3RvciB8fCBodG1sLm1zTWF0Y2hlc1NlbGVjdG9yO1xuXG4gICAgICAgICAgICBpZiAoIG1hdGNoZXMgKSB7XG4gICAgICAgICAgICAgICAgLy8gQ2hlY2sgdG8gc2VlIGlmIGl0J3MgcG9zc2libGUgdG8gZG8gbWF0Y2hlc1NlbGVjdG9yXG4gICAgICAgICAgICAgICAgLy8gb24gYSBkaXNjb25uZWN0ZWQgbm9kZSAoSUUgOSBmYWlscyB0aGlzKVxuICAgICAgICAgICAgICAgIHZhciBkaXNjb25uZWN0ZWRNYXRjaCA9ICFtYXRjaGVzLmNhbGwoIGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoIFwiZGl2XCIgKSwgXCJkaXZcIiApLFxuICAgICAgICAgICAgICAgICAgICBwc2V1ZG9Xb3JrcyA9IGZhbHNlO1xuXG4gICAgICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICAgICAgLy8gVGhpcyBzaG91bGQgZmFpbCB3aXRoIGFuIGV4Y2VwdGlvblxuICAgICAgICAgICAgICAgICAgICAvLyBHZWNrbyBkb2VzIG5vdCBlcnJvciwgcmV0dXJucyBmYWxzZSBpbnN0ZWFkXG4gICAgICAgICAgICAgICAgICAgIG1hdGNoZXMuY2FsbCggZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LCBcIlt0ZXN0IT0nJ106c2l6emxlXCIgKTtcblxuICAgICAgICAgICAgICAgIH0gY2F0Y2goIHBzZXVkb0Vycm9yICkge1xuICAgICAgICAgICAgICAgICAgICBwc2V1ZG9Xb3JrcyA9IHRydWU7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgU2l6emxlLm1hdGNoZXNTZWxlY3RvciA9IGZ1bmN0aW9uKCBub2RlLCBleHByICkge1xuICAgICAgICAgICAgICAgICAgICAvLyBNYWtlIHN1cmUgdGhhdCBhdHRyaWJ1dGUgc2VsZWN0b3JzIGFyZSBxdW90ZWRcbiAgICAgICAgICAgICAgICAgICAgZXhwciA9IGV4cHIucmVwbGFjZSgvXFw9XFxzKihbXidcIlxcXV0qKVxccypcXF0vZywgXCI9JyQxJ11cIik7XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKCAhU2l6emxlLmlzWE1MKCBub2RlICkgKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICggcHNldWRvV29ya3MgfHwgIUV4cHIubWF0Y2guUFNFVURPLnRlc3QoIGV4cHIgKSAmJiAhLyE9Ly50ZXN0KCBleHByICkgKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciByZXQgPSBtYXRjaGVzLmNhbGwoIG5vZGUsIGV4cHIgKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBJRSA5J3MgbWF0Y2hlc1NlbGVjdG9yIHJldHVybnMgZmFsc2Ugb24gZGlzY29ubmVjdGVkIG5vZGVzXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICggcmV0IHx8ICFkaXNjb25uZWN0ZWRNYXRjaCB8fFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gQXMgd2VsbCwgZGlzY29ubmVjdGVkIG5vZGVzIGFyZSBzYWlkIHRvIGJlIGluIGEgZG9jdW1lbnRcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGZyYWdtZW50IGluIElFIDksIHNvIGNoZWNrIGZvciB0aGF0XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBub2RlLmRvY3VtZW50ICYmIG5vZGUuZG9jdW1lbnQubm9kZVR5cGUgIT09IDExICkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJldDtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH0gY2F0Y2goZSkge31cbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBTaXp6bGUoZXhwciwgbnVsbCwgbnVsbCwgW25vZGVdKS5sZW5ndGggPiAwO1xuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pKCk7XG5cbiAgICAgICAgKGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICB2YXIgZGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcblxuICAgICAgICAgICAgZGl2LmlubmVySFRNTCA9IFwiPGRpdiBjbGFzcz0ndGVzdCBlJz48L2Rpdj48ZGl2IGNsYXNzPSd0ZXN0Jz48L2Rpdj5cIjtcblxuICAgICAgICAgICAgLy8gT3BlcmEgY2FuJ3QgZmluZCBhIHNlY29uZCBjbGFzc25hbWUgKGluIDkuNilcbiAgICAgICAgICAgIC8vIEFsc28sIG1ha2Ugc3VyZSB0aGF0IGdldEVsZW1lbnRzQnlDbGFzc05hbWUgYWN0dWFsbHkgZXhpc3RzXG4gICAgICAgICAgICBpZiAoICFkaXYuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSB8fCBkaXYuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZShcImVcIikubGVuZ3RoID09PSAwICkge1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gU2FmYXJpIGNhY2hlcyBjbGFzcyBhdHRyaWJ1dGVzLCBkb2Vzbid0IGNhdGNoIGNoYW5nZXMgKGluIDMuMilcbiAgICAgICAgICAgIGRpdi5sYXN0Q2hpbGQuY2xhc3NOYW1lID0gXCJlXCI7XG5cbiAgICAgICAgICAgIGlmICggZGl2LmdldEVsZW1lbnRzQnlDbGFzc05hbWUoXCJlXCIpLmxlbmd0aCA9PT0gMSApIHtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIEV4cHIub3JkZXIuc3BsaWNlKDEsIDAsIFwiQ0xBU1NcIik7XG4gICAgICAgICAgICBFeHByLmZpbmQuQ0xBU1MgPSBmdW5jdGlvbiggbWF0Y2gsIGNvbnRleHQsIGlzWE1MICkge1xuICAgICAgICAgICAgICAgIGlmICggdHlwZW9mIGNvbnRleHQuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSAhPT0gXCJ1bmRlZmluZWRcIiAmJiAhaXNYTUwgKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBjb250ZXh0LmdldEVsZW1lbnRzQnlDbGFzc05hbWUobWF0Y2hbMV0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIC8vIHJlbGVhc2UgbWVtb3J5IGluIElFXG4gICAgICAgICAgICBkaXYgPSBudWxsO1xuICAgICAgICB9KSgpO1xuXG4gICAgICAgIGZ1bmN0aW9uIGRpck5vZGVDaGVjayggZGlyLCBjdXIsIGRvbmVOYW1lLCBjaGVja1NldCwgbm9kZUNoZWNrLCBpc1hNTCApIHtcbiAgICAgICAgICAgIGZvciAoIHZhciBpID0gMCwgbCA9IGNoZWNrU2V0Lmxlbmd0aDsgaSA8IGw7IGkrKyApIHtcbiAgICAgICAgICAgICAgICB2YXIgZWxlbSA9IGNoZWNrU2V0W2ldO1xuXG4gICAgICAgICAgICAgICAgaWYgKCBlbGVtICkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgbWF0Y2ggPSBmYWxzZTtcblxuICAgICAgICAgICAgICAgICAgICBlbGVtID0gZWxlbVtkaXJdO1xuXG4gICAgICAgICAgICAgICAgICAgIHdoaWxlICggZWxlbSApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICggZWxlbVsgZXhwYW5kbyBdID09PSBkb25lTmFtZSApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtYXRjaCA9IGNoZWNrU2V0W2VsZW0uc2l6c2V0XTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCBlbGVtLm5vZGVUeXBlID09PSAxICYmICFpc1hNTCApe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsZW1bIGV4cGFuZG8gXSA9IGRvbmVOYW1lO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsZW0uc2l6c2V0ID0gaTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCBlbGVtLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCkgPT09IGN1ciApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtYXRjaCA9IGVsZW07XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIGVsZW0gPSBlbGVtW2Rpcl07XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICBjaGVja1NldFtpXSA9IG1hdGNoO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIGRpckNoZWNrKCBkaXIsIGN1ciwgZG9uZU5hbWUsIGNoZWNrU2V0LCBub2RlQ2hlY2ssIGlzWE1MICkge1xuICAgICAgICAgICAgZm9yICggdmFyIGkgPSAwLCBsID0gY2hlY2tTZXQubGVuZ3RoOyBpIDwgbDsgaSsrICkge1xuICAgICAgICAgICAgICAgIHZhciBlbGVtID0gY2hlY2tTZXRbaV07XG5cbiAgICAgICAgICAgICAgICBpZiAoIGVsZW0gKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBtYXRjaCA9IGZhbHNlO1xuXG4gICAgICAgICAgICAgICAgICAgIGVsZW0gPSBlbGVtW2Rpcl07XG5cbiAgICAgICAgICAgICAgICAgICAgd2hpbGUgKCBlbGVtICkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCBlbGVtWyBleHBhbmRvIF0gPT09IGRvbmVOYW1lICkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1hdGNoID0gY2hlY2tTZXRbZWxlbS5zaXpzZXRdO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoIGVsZW0ubm9kZVR5cGUgPT09IDEgKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCAhaXNYTUwgKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsZW1bIGV4cGFuZG8gXSA9IGRvbmVOYW1lO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbGVtLnNpenNldCA9IGk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCB0eXBlb2YgY3VyICE9PSBcInN0cmluZ1wiICkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIGVsZW0gPT09IGN1ciApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1hdGNoID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKCBTaXp6bGUuZmlsdGVyKCBjdXIsIFtlbGVtXSApLmxlbmd0aCA+IDAgKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1hdGNoID0gZWxlbTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgICAgICBlbGVtID0gZWxlbVtkaXJdO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgY2hlY2tTZXRbaV0gPSBtYXRjaDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoIGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jb250YWlucyApIHtcbiAgICAgICAgICAgIFNpenpsZS5jb250YWlucyA9IGZ1bmN0aW9uKCBhLCBiICkge1xuICAgICAgICAgICAgICAgIHJldHVybiBhICE9PSBiICYmIChhLmNvbnRhaW5zID8gYS5jb250YWlucyhiKSA6IHRydWUpO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICB9IGVsc2UgaWYgKCBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuY29tcGFyZURvY3VtZW50UG9zaXRpb24gKSB7XG4gICAgICAgICAgICBTaXp6bGUuY29udGFpbnMgPSBmdW5jdGlvbiggYSwgYiApIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gISEoYS5jb21wYXJlRG9jdW1lbnRQb3NpdGlvbihiKSAmIDE2KTtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIFNpenpsZS5jb250YWlucyA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIH07XG4gICAgICAgIH1cblxuICAgICAgICBTaXp6bGUuaXNYTUwgPSBmdW5jdGlvbiggZWxlbSApIHtcbiAgICAgICAgICAgIC8vIGRvY3VtZW50RWxlbWVudCBpcyB2ZXJpZmllZCBmb3IgY2FzZXMgd2hlcmUgaXQgZG9lc24ndCB5ZXQgZXhpc3RcbiAgICAgICAgICAgIC8vIChzdWNoIGFzIGxvYWRpbmcgaWZyYW1lcyBpbiBJRSAtICM0ODMzKVxuICAgICAgICAgICAgdmFyIGRvY3VtZW50RWxlbWVudCA9IChlbGVtID8gZWxlbS5vd25lckRvY3VtZW50IHx8IGVsZW0gOiAwKS5kb2N1bWVudEVsZW1lbnQ7XG5cbiAgICAgICAgICAgIHJldHVybiBkb2N1bWVudEVsZW1lbnQgPyBkb2N1bWVudEVsZW1lbnQubm9kZU5hbWUgIT09IFwiSFRNTFwiIDogZmFsc2U7XG4gICAgICAgIH07XG5cbiAgICAgICAgdmFyIHBvc1Byb2Nlc3MgPSBmdW5jdGlvbiggc2VsZWN0b3IsIGNvbnRleHQsIHNlZWQgKSB7XG4gICAgICAgICAgICB2YXIgbWF0Y2gsXG4gICAgICAgICAgICAgICAgdG1wU2V0ID0gW10sXG4gICAgICAgICAgICAgICAgbGF0ZXIgPSBcIlwiLFxuICAgICAgICAgICAgICAgIHJvb3QgPSBjb250ZXh0Lm5vZGVUeXBlID8gW2NvbnRleHRdIDogY29udGV4dDtcblxuICAgICAgICAgICAgLy8gUG9zaXRpb24gc2VsZWN0b3JzIG11c3QgYmUgZG9uZSBhZnRlciB0aGUgZmlsdGVyXG4gICAgICAgICAgICAvLyBBbmQgc28gbXVzdCA6bm90KHBvc2l0aW9uYWwpIHNvIHdlIG1vdmUgYWxsIFBTRVVET3MgdG8gdGhlIGVuZFxuICAgICAgICAgICAgd2hpbGUgKCAobWF0Y2ggPSBFeHByLm1hdGNoLlBTRVVETy5leGVjKCBzZWxlY3RvciApKSApIHtcbiAgICAgICAgICAgICAgICBsYXRlciArPSBtYXRjaFswXTtcbiAgICAgICAgICAgICAgICBzZWxlY3RvciA9IHNlbGVjdG9yLnJlcGxhY2UoIEV4cHIubWF0Y2guUFNFVURPLCBcIlwiICk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHNlbGVjdG9yID0gRXhwci5yZWxhdGl2ZVtzZWxlY3Rvcl0gPyBzZWxlY3RvciArIFwiKlwiIDogc2VsZWN0b3I7XG5cbiAgICAgICAgICAgIGZvciAoIHZhciBpID0gMCwgbCA9IHJvb3QubGVuZ3RoOyBpIDwgbDsgaSsrICkge1xuICAgICAgICAgICAgICAgIFNpenpsZSggc2VsZWN0b3IsIHJvb3RbaV0sIHRtcFNldCwgc2VlZCApO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByZXR1cm4gU2l6emxlLmZpbHRlciggbGF0ZXIsIHRtcFNldCApO1xuICAgICAgICB9O1xuXG4vLyBFWFBPU0Vcbi8vIE92ZXJyaWRlIHNpenpsZSBhdHRyaWJ1dGUgcmV0cmlldmFsXG4gICAgICAgIFNpenpsZS5hdHRyID0galF1ZXJ5LmF0dHI7XG4gICAgICAgIFNpenpsZS5zZWxlY3RvcnMuYXR0ck1hcCA9IHt9O1xuICAgICAgICBqUXVlcnkuZmluZCA9IFNpenpsZTtcbiAgICAgICAgalF1ZXJ5LmV4cHIgPSBTaXp6bGUuc2VsZWN0b3JzO1xuICAgICAgICBqUXVlcnkuZXhwcltcIjpcIl0gPSBqUXVlcnkuZXhwci5maWx0ZXJzO1xuICAgICAgICBqUXVlcnkudW5pcXVlID0gU2l6emxlLnVuaXF1ZVNvcnQ7XG4gICAgICAgIGpRdWVyeS50ZXh0ID0gU2l6emxlLmdldFRleHQ7XG4gICAgICAgIGpRdWVyeS5pc1hNTERvYyA9IFNpenpsZS5pc1hNTDtcbiAgICAgICAgalF1ZXJ5LmNvbnRhaW5zID0gU2l6emxlLmNvbnRhaW5zO1xuXG5cbiAgICB9KSgpO1xuXG5cbiAgICB2YXIgcnVudGlsID0gL1VudGlsJC8sXG4gICAgICAgIHJwYXJlbnRzcHJldiA9IC9eKD86cGFyZW50c3xwcmV2VW50aWx8cHJldkFsbCkvLFxuICAgIC8vIE5vdGU6IFRoaXMgUmVnRXhwIHNob3VsZCBiZSBpbXByb3ZlZCwgb3IgbGlrZWx5IHB1bGxlZCBmcm9tIFNpenpsZVxuICAgICAgICBybXVsdGlzZWxlY3RvciA9IC8sLyxcbiAgICAgICAgaXNTaW1wbGUgPSAvXi5bXjojXFxbXFwuLF0qJC8sXG4gICAgICAgIHNsaWNlID0gQXJyYXkucHJvdG90eXBlLnNsaWNlLFxuICAgICAgICBQT1MgPSBqUXVlcnkuZXhwci5tYXRjaC5QT1MsXG4gICAgLy8gbWV0aG9kcyBndWFyYW50ZWVkIHRvIHByb2R1Y2UgYSB1bmlxdWUgc2V0IHdoZW4gc3RhcnRpbmcgZnJvbSBhIHVuaXF1ZSBzZXRcbiAgICAgICAgZ3VhcmFudGVlZFVuaXF1ZSA9IHtcbiAgICAgICAgICAgIGNoaWxkcmVuOiB0cnVlLFxuICAgICAgICAgICAgY29udGVudHM6IHRydWUsXG4gICAgICAgICAgICBuZXh0OiB0cnVlLFxuICAgICAgICAgICAgcHJldjogdHJ1ZVxuICAgICAgICB9O1xuXG4gICAgalF1ZXJ5LmZuLmV4dGVuZCh7XG4gICAgICAgIGZpbmQ6IGZ1bmN0aW9uKCBzZWxlY3RvciApIHtcbiAgICAgICAgICAgIHZhciBzZWxmID0gdGhpcyxcbiAgICAgICAgICAgICAgICBpLCBsO1xuXG4gICAgICAgICAgICBpZiAoIHR5cGVvZiBzZWxlY3RvciAhPT0gXCJzdHJpbmdcIiApIHtcbiAgICAgICAgICAgICAgICByZXR1cm4galF1ZXJ5KCBzZWxlY3RvciApLmZpbHRlcihmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgZm9yICggaSA9IDAsIGwgPSBzZWxmLmxlbmd0aDsgaSA8IGw7IGkrKyApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICggalF1ZXJ5LmNvbnRhaW5zKCBzZWxmWyBpIF0sIHRoaXMgKSApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB2YXIgcmV0ID0gdGhpcy5wdXNoU3RhY2soIFwiXCIsIFwiZmluZFwiLCBzZWxlY3RvciApLFxuICAgICAgICAgICAgICAgIGxlbmd0aCwgbiwgcjtcblxuICAgICAgICAgICAgZm9yICggaSA9IDAsIGwgPSB0aGlzLmxlbmd0aDsgaSA8IGw7IGkrKyApIHtcbiAgICAgICAgICAgICAgICBsZW5ndGggPSByZXQubGVuZ3RoO1xuICAgICAgICAgICAgICAgIGpRdWVyeS5maW5kKCBzZWxlY3RvciwgdGhpc1tpXSwgcmV0ICk7XG5cbiAgICAgICAgICAgICAgICBpZiAoIGkgPiAwICkge1xuICAgICAgICAgICAgICAgICAgICAvLyBNYWtlIHN1cmUgdGhhdCB0aGUgcmVzdWx0cyBhcmUgdW5pcXVlXG4gICAgICAgICAgICAgICAgICAgIGZvciAoIG4gPSBsZW5ndGg7IG4gPCByZXQubGVuZ3RoOyBuKysgKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBmb3IgKCByID0gMDsgciA8IGxlbmd0aDsgcisrICkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICggcmV0W3JdID09PSByZXRbbl0gKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldC5zcGxpY2Uobi0tLCAxKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByZXR1cm4gcmV0O1xuICAgICAgICB9LFxuXG4gICAgICAgIGhhczogZnVuY3Rpb24oIHRhcmdldCApIHtcbiAgICAgICAgICAgIHZhciB0YXJnZXRzID0galF1ZXJ5KCB0YXJnZXQgKTtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmZpbHRlcihmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICBmb3IgKCB2YXIgaSA9IDAsIGwgPSB0YXJnZXRzLmxlbmd0aDsgaSA8IGw7IGkrKyApIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCBqUXVlcnkuY29udGFpbnMoIHRoaXMsIHRhcmdldHNbaV0gKSApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgbm90OiBmdW5jdGlvbiggc2VsZWN0b3IgKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5wdXNoU3RhY2soIHdpbm5vdyh0aGlzLCBzZWxlY3RvciwgZmFsc2UpLCBcIm5vdFwiLCBzZWxlY3Rvcik7XG4gICAgICAgIH0sXG5cbiAgICAgICAgZmlsdGVyOiBmdW5jdGlvbiggc2VsZWN0b3IgKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5wdXNoU3RhY2soIHdpbm5vdyh0aGlzLCBzZWxlY3RvciwgdHJ1ZSksIFwiZmlsdGVyXCIsIHNlbGVjdG9yICk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgaXM6IGZ1bmN0aW9uKCBzZWxlY3RvciApIHtcbiAgICAgICAgICAgIHJldHVybiAhIXNlbGVjdG9yICYmIChcbiAgICAgICAgICAgICAgICAgICAgdHlwZW9mIHNlbGVjdG9yID09PSBcInN0cmluZ1wiID9cbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIElmIHRoaXMgaXMgYSBwb3NpdGlvbmFsIHNlbGVjdG9yLCBjaGVjayBtZW1iZXJzaGlwIGluIHRoZSByZXR1cm5lZCBzZXRcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIHNvICQoXCJwOmZpcnN0XCIpLmlzKFwicDpsYXN0XCIpIHdvbid0IHJldHVybiB0cnVlIGZvciBhIGRvYyB3aXRoIHR3byBcInBcIi5cbiAgICAgICAgICAgICAgICAgICAgICAgIFBPUy50ZXN0KCBzZWxlY3RvciApID9cbiAgICAgICAgICAgICAgICAgICAgICAgIGpRdWVyeSggc2VsZWN0b3IsIHRoaXMuY29udGV4dCApLmluZGV4KCB0aGlzWzBdICkgPj0gMCA6XG4gICAgICAgICAgICAgICAgICAgICAgICBqUXVlcnkuZmlsdGVyKCBzZWxlY3RvciwgdGhpcyApLmxlbmd0aCA+IDAgOlxuICAgICAgICAgICAgICAgICAgICB0aGlzLmZpbHRlciggc2VsZWN0b3IgKS5sZW5ndGggPiAwICk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgY2xvc2VzdDogZnVuY3Rpb24oIHNlbGVjdG9ycywgY29udGV4dCApIHtcbiAgICAgICAgICAgIHZhciByZXQgPSBbXSwgaSwgbCwgY3VyID0gdGhpc1swXTtcblxuICAgICAgICAgICAgLy8gQXJyYXkgKGRlcHJlY2F0ZWQgYXMgb2YgalF1ZXJ5IDEuNylcbiAgICAgICAgICAgIGlmICggalF1ZXJ5LmlzQXJyYXkoIHNlbGVjdG9ycyApICkge1xuICAgICAgICAgICAgICAgIHZhciBsZXZlbCA9IDE7XG5cbiAgICAgICAgICAgICAgICB3aGlsZSAoIGN1ciAmJiBjdXIub3duZXJEb2N1bWVudCAmJiBjdXIgIT09IGNvbnRleHQgKSB7XG4gICAgICAgICAgICAgICAgICAgIGZvciAoIGkgPSAwOyBpIDwgc2VsZWN0b3JzLmxlbmd0aDsgaSsrICkge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoIGpRdWVyeSggY3VyICkuaXMoIHNlbGVjdG9yc1sgaSBdICkgKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0LnB1c2goeyBzZWxlY3Rvcjogc2VsZWN0b3JzWyBpIF0sIGVsZW06IGN1ciwgbGV2ZWw6IGxldmVsIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgY3VyID0gY3VyLnBhcmVudE5vZGU7XG4gICAgICAgICAgICAgICAgICAgIGxldmVsKys7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgcmV0dXJuIHJldDtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gU3RyaW5nXG4gICAgICAgICAgICB2YXIgcG9zID0gUE9TLnRlc3QoIHNlbGVjdG9ycyApIHx8IHR5cGVvZiBzZWxlY3RvcnMgIT09IFwic3RyaW5nXCIgP1xuICAgICAgICAgICAgICAgIGpRdWVyeSggc2VsZWN0b3JzLCBjb250ZXh0IHx8IHRoaXMuY29udGV4dCApIDpcbiAgICAgICAgICAgICAgICAwO1xuXG4gICAgICAgICAgICBmb3IgKCBpID0gMCwgbCA9IHRoaXMubGVuZ3RoOyBpIDwgbDsgaSsrICkge1xuICAgICAgICAgICAgICAgIGN1ciA9IHRoaXNbaV07XG5cbiAgICAgICAgICAgICAgICB3aGlsZSAoIGN1ciApIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCBwb3MgPyBwb3MuaW5kZXgoY3VyKSA+IC0xIDogalF1ZXJ5LmZpbmQubWF0Y2hlc1NlbGVjdG9yKGN1ciwgc2VsZWN0b3JzKSApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldC5wdXNoKCBjdXIgKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjdXIgPSBjdXIucGFyZW50Tm9kZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICggIWN1ciB8fCAhY3VyLm93bmVyRG9jdW1lbnQgfHwgY3VyID09PSBjb250ZXh0IHx8IGN1ci5ub2RlVHlwZSA9PT0gMTEgKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHJldCA9IHJldC5sZW5ndGggPiAxID8galF1ZXJ5LnVuaXF1ZSggcmV0ICkgOiByZXQ7XG5cbiAgICAgICAgICAgIHJldHVybiB0aGlzLnB1c2hTdGFjayggcmV0LCBcImNsb3Nlc3RcIiwgc2VsZWN0b3JzICk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgLy8gRGV0ZXJtaW5lIHRoZSBwb3NpdGlvbiBvZiBhbiBlbGVtZW50IHdpdGhpblxuICAgICAgICAvLyB0aGUgbWF0Y2hlZCBzZXQgb2YgZWxlbWVudHNcbiAgICAgICAgaW5kZXg6IGZ1bmN0aW9uKCBlbGVtICkge1xuXG4gICAgICAgICAgICAvLyBObyBhcmd1bWVudCwgcmV0dXJuIGluZGV4IGluIHBhcmVudFxuICAgICAgICAgICAgaWYgKCAhZWxlbSApIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gKCB0aGlzWzBdICYmIHRoaXNbMF0ucGFyZW50Tm9kZSApID8gdGhpcy5wcmV2QWxsKCkubGVuZ3RoIDogLTE7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIGluZGV4IGluIHNlbGVjdG9yXG4gICAgICAgICAgICBpZiAoIHR5cGVvZiBlbGVtID09PSBcInN0cmluZ1wiICkge1xuICAgICAgICAgICAgICAgIHJldHVybiBqUXVlcnkuaW5BcnJheSggdGhpc1swXSwgalF1ZXJ5KCBlbGVtICkgKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gTG9jYXRlIHRoZSBwb3NpdGlvbiBvZiB0aGUgZGVzaXJlZCBlbGVtZW50XG4gICAgICAgICAgICByZXR1cm4galF1ZXJ5LmluQXJyYXkoXG4gICAgICAgICAgICAgICAgLy8gSWYgaXQgcmVjZWl2ZXMgYSBqUXVlcnkgb2JqZWN0LCB0aGUgZmlyc3QgZWxlbWVudCBpcyB1c2VkXG4gICAgICAgICAgICAgICAgZWxlbS5qcXVlcnkgPyBlbGVtWzBdIDogZWxlbSwgdGhpcyApO1xuICAgICAgICB9LFxuXG4gICAgICAgIGFkZDogZnVuY3Rpb24oIHNlbGVjdG9yLCBjb250ZXh0ICkge1xuICAgICAgICAgICAgdmFyIHNldCA9IHR5cGVvZiBzZWxlY3RvciA9PT0gXCJzdHJpbmdcIiA/XG4gICAgICAgICAgICAgICAgICAgIGpRdWVyeSggc2VsZWN0b3IsIGNvbnRleHQgKSA6XG4gICAgICAgICAgICAgICAgICAgIGpRdWVyeS5tYWtlQXJyYXkoIHNlbGVjdG9yICYmIHNlbGVjdG9yLm5vZGVUeXBlID8gWyBzZWxlY3RvciBdIDogc2VsZWN0b3IgKSxcbiAgICAgICAgICAgICAgICBhbGwgPSBqUXVlcnkubWVyZ2UoIHRoaXMuZ2V0KCksIHNldCApO1xuXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5wdXNoU3RhY2soIGlzRGlzY29ubmVjdGVkKCBzZXRbMF0gKSB8fCBpc0Rpc2Nvbm5lY3RlZCggYWxsWzBdICkgP1xuICAgICAgICAgICAgICAgIGFsbCA6XG4gICAgICAgICAgICAgICAgalF1ZXJ5LnVuaXF1ZSggYWxsICkgKTtcbiAgICAgICAgfSxcblxuICAgICAgICBhbmRTZWxmOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmFkZCggdGhpcy5wcmV2T2JqZWN0ICk7XG4gICAgICAgIH1cbiAgICB9KTtcblxuLy8gQSBwYWluZnVsbHkgc2ltcGxlIGNoZWNrIHRvIHNlZSBpZiBhbiBlbGVtZW50IGlzIGRpc2Nvbm5lY3RlZFxuLy8gZnJvbSBhIGRvY3VtZW50IChzaG91bGQgYmUgaW1wcm92ZWQsIHdoZXJlIGZlYXNpYmxlKS5cbiAgICBmdW5jdGlvbiBpc0Rpc2Nvbm5lY3RlZCggbm9kZSApIHtcbiAgICAgICAgcmV0dXJuICFub2RlIHx8ICFub2RlLnBhcmVudE5vZGUgfHwgbm9kZS5wYXJlbnROb2RlLm5vZGVUeXBlID09PSAxMTtcbiAgICB9XG5cbiAgICBqUXVlcnkuZWFjaCh7XG4gICAgICAgIHBhcmVudDogZnVuY3Rpb24oIGVsZW0gKSB7XG4gICAgICAgICAgICB2YXIgcGFyZW50ID0gZWxlbS5wYXJlbnROb2RlO1xuICAgICAgICAgICAgcmV0dXJuIHBhcmVudCAmJiBwYXJlbnQubm9kZVR5cGUgIT09IDExID8gcGFyZW50IDogbnVsbDtcbiAgICAgICAgfSxcbiAgICAgICAgcGFyZW50czogZnVuY3Rpb24oIGVsZW0gKSB7XG4gICAgICAgICAgICByZXR1cm4galF1ZXJ5LmRpciggZWxlbSwgXCJwYXJlbnROb2RlXCIgKTtcbiAgICAgICAgfSxcbiAgICAgICAgcGFyZW50c1VudGlsOiBmdW5jdGlvbiggZWxlbSwgaSwgdW50aWwgKSB7XG4gICAgICAgICAgICByZXR1cm4galF1ZXJ5LmRpciggZWxlbSwgXCJwYXJlbnROb2RlXCIsIHVudGlsICk7XG4gICAgICAgIH0sXG4gICAgICAgIG5leHQ6IGZ1bmN0aW9uKCBlbGVtICkge1xuICAgICAgICAgICAgcmV0dXJuIGpRdWVyeS5udGgoIGVsZW0sIDIsIFwibmV4dFNpYmxpbmdcIiApO1xuICAgICAgICB9LFxuICAgICAgICBwcmV2OiBmdW5jdGlvbiggZWxlbSApIHtcbiAgICAgICAgICAgIHJldHVybiBqUXVlcnkubnRoKCBlbGVtLCAyLCBcInByZXZpb3VzU2libGluZ1wiICk7XG4gICAgICAgIH0sXG4gICAgICAgIG5leHRBbGw6IGZ1bmN0aW9uKCBlbGVtICkge1xuICAgICAgICAgICAgcmV0dXJuIGpRdWVyeS5kaXIoIGVsZW0sIFwibmV4dFNpYmxpbmdcIiApO1xuICAgICAgICB9LFxuICAgICAgICBwcmV2QWxsOiBmdW5jdGlvbiggZWxlbSApIHtcbiAgICAgICAgICAgIHJldHVybiBqUXVlcnkuZGlyKCBlbGVtLCBcInByZXZpb3VzU2libGluZ1wiICk7XG4gICAgICAgIH0sXG4gICAgICAgIG5leHRVbnRpbDogZnVuY3Rpb24oIGVsZW0sIGksIHVudGlsICkge1xuICAgICAgICAgICAgcmV0dXJuIGpRdWVyeS5kaXIoIGVsZW0sIFwibmV4dFNpYmxpbmdcIiwgdW50aWwgKTtcbiAgICAgICAgfSxcbiAgICAgICAgcHJldlVudGlsOiBmdW5jdGlvbiggZWxlbSwgaSwgdW50aWwgKSB7XG4gICAgICAgICAgICByZXR1cm4galF1ZXJ5LmRpciggZWxlbSwgXCJwcmV2aW91c1NpYmxpbmdcIiwgdW50aWwgKTtcbiAgICAgICAgfSxcbiAgICAgICAgc2libGluZ3M6IGZ1bmN0aW9uKCBlbGVtICkge1xuICAgICAgICAgICAgcmV0dXJuIGpRdWVyeS5zaWJsaW5nKCBlbGVtLnBhcmVudE5vZGUuZmlyc3RDaGlsZCwgZWxlbSApO1xuICAgICAgICB9LFxuICAgICAgICBjaGlsZHJlbjogZnVuY3Rpb24oIGVsZW0gKSB7XG4gICAgICAgICAgICByZXR1cm4galF1ZXJ5LnNpYmxpbmcoIGVsZW0uZmlyc3RDaGlsZCApO1xuICAgICAgICB9LFxuICAgICAgICBjb250ZW50czogZnVuY3Rpb24oIGVsZW0gKSB7XG4gICAgICAgICAgICByZXR1cm4galF1ZXJ5Lm5vZGVOYW1lKCBlbGVtLCBcImlmcmFtZVwiICkgP1xuICAgICAgICAgICAgZWxlbS5jb250ZW50RG9jdW1lbnQgfHwgZWxlbS5jb250ZW50V2luZG93LmRvY3VtZW50IDpcbiAgICAgICAgICAgICAgICBqUXVlcnkubWFrZUFycmF5KCBlbGVtLmNoaWxkTm9kZXMgKTtcbiAgICAgICAgfVxuICAgIH0sIGZ1bmN0aW9uKCBuYW1lLCBmbiApIHtcbiAgICAgICAgalF1ZXJ5LmZuWyBuYW1lIF0gPSBmdW5jdGlvbiggdW50aWwsIHNlbGVjdG9yICkge1xuICAgICAgICAgICAgdmFyIHJldCA9IGpRdWVyeS5tYXAoIHRoaXMsIGZuLCB1bnRpbCApO1xuXG4gICAgICAgICAgICBpZiAoICFydW50aWwudGVzdCggbmFtZSApICkge1xuICAgICAgICAgICAgICAgIHNlbGVjdG9yID0gdW50aWw7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmICggc2VsZWN0b3IgJiYgdHlwZW9mIHNlbGVjdG9yID09PSBcInN0cmluZ1wiICkge1xuICAgICAgICAgICAgICAgIHJldCA9IGpRdWVyeS5maWx0ZXIoIHNlbGVjdG9yLCByZXQgKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgcmV0ID0gdGhpcy5sZW5ndGggPiAxICYmICFndWFyYW50ZWVkVW5pcXVlWyBuYW1lIF0gPyBqUXVlcnkudW5pcXVlKCByZXQgKSA6IHJldDtcblxuICAgICAgICAgICAgaWYgKCAodGhpcy5sZW5ndGggPiAxIHx8IHJtdWx0aXNlbGVjdG9yLnRlc3QoIHNlbGVjdG9yICkpICYmIHJwYXJlbnRzcHJldi50ZXN0KCBuYW1lICkgKSB7XG4gICAgICAgICAgICAgICAgcmV0ID0gcmV0LnJldmVyc2UoKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgcmV0dXJuIHRoaXMucHVzaFN0YWNrKCByZXQsIG5hbWUsIHNsaWNlLmNhbGwoIGFyZ3VtZW50cyApLmpvaW4oXCIsXCIpICk7XG4gICAgICAgIH07XG4gICAgfSk7XG5cbiAgICBqUXVlcnkuZXh0ZW5kKHtcbiAgICAgICAgZmlsdGVyOiBmdW5jdGlvbiggZXhwciwgZWxlbXMsIG5vdCApIHtcbiAgICAgICAgICAgIGlmICggbm90ICkge1xuICAgICAgICAgICAgICAgIGV4cHIgPSBcIjpub3QoXCIgKyBleHByICsgXCIpXCI7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHJldHVybiBlbGVtcy5sZW5ndGggPT09IDEgP1xuICAgICAgICAgICAgICAgIGpRdWVyeS5maW5kLm1hdGNoZXNTZWxlY3RvcihlbGVtc1swXSwgZXhwcikgPyBbIGVsZW1zWzBdIF0gOiBbXSA6XG4gICAgICAgICAgICAgICAgalF1ZXJ5LmZpbmQubWF0Y2hlcyhleHByLCBlbGVtcyk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgZGlyOiBmdW5jdGlvbiggZWxlbSwgZGlyLCB1bnRpbCApIHtcbiAgICAgICAgICAgIHZhciBtYXRjaGVkID0gW10sXG4gICAgICAgICAgICAgICAgY3VyID0gZWxlbVsgZGlyIF07XG5cbiAgICAgICAgICAgIHdoaWxlICggY3VyICYmIGN1ci5ub2RlVHlwZSAhPT0gOSAmJiAodW50aWwgPT09IHVuZGVmaW5lZCB8fCBjdXIubm9kZVR5cGUgIT09IDEgfHwgIWpRdWVyeSggY3VyICkuaXMoIHVudGlsICkpICkge1xuICAgICAgICAgICAgICAgIGlmICggY3VyLm5vZGVUeXBlID09PSAxICkge1xuICAgICAgICAgICAgICAgICAgICBtYXRjaGVkLnB1c2goIGN1ciApO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBjdXIgPSBjdXJbZGlyXTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBtYXRjaGVkO1xuICAgICAgICB9LFxuXG4gICAgICAgIG50aDogZnVuY3Rpb24oIGN1ciwgcmVzdWx0LCBkaXIsIGVsZW0gKSB7XG4gICAgICAgICAgICByZXN1bHQgPSByZXN1bHQgfHwgMTtcbiAgICAgICAgICAgIHZhciBudW0gPSAwO1xuXG4gICAgICAgICAgICBmb3IgKCA7IGN1cjsgY3VyID0gY3VyW2Rpcl0gKSB7XG4gICAgICAgICAgICAgICAgaWYgKCBjdXIubm9kZVR5cGUgPT09IDEgJiYgKytudW0gPT09IHJlc3VsdCApIHtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByZXR1cm4gY3VyO1xuICAgICAgICB9LFxuXG4gICAgICAgIHNpYmxpbmc6IGZ1bmN0aW9uKCBuLCBlbGVtICkge1xuICAgICAgICAgICAgdmFyIHIgPSBbXTtcblxuICAgICAgICAgICAgZm9yICggOyBuOyBuID0gbi5uZXh0U2libGluZyApIHtcbiAgICAgICAgICAgICAgICBpZiAoIG4ubm9kZVR5cGUgPT09IDEgJiYgbiAhPT0gZWxlbSApIHtcbiAgICAgICAgICAgICAgICAgICAgci5wdXNoKCBuICk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByZXR1cm4gcjtcbiAgICAgICAgfVxuICAgIH0pO1xuXG4vLyBJbXBsZW1lbnQgdGhlIGlkZW50aWNhbCBmdW5jdGlvbmFsaXR5IGZvciBmaWx0ZXIgYW5kIG5vdFxuICAgIGZ1bmN0aW9uIHdpbm5vdyggZWxlbWVudHMsIHF1YWxpZmllciwga2VlcCApIHtcblxuICAgICAgICAvLyBDYW4ndCBwYXNzIG51bGwgb3IgdW5kZWZpbmVkIHRvIGluZGV4T2YgaW4gRmlyZWZveCA0XG4gICAgICAgIC8vIFNldCB0byAwIHRvIHNraXAgc3RyaW5nIGNoZWNrXG4gICAgICAgIHF1YWxpZmllciA9IHF1YWxpZmllciB8fCAwO1xuXG4gICAgICAgIGlmICggalF1ZXJ5LmlzRnVuY3Rpb24oIHF1YWxpZmllciApICkge1xuICAgICAgICAgICAgcmV0dXJuIGpRdWVyeS5ncmVwKGVsZW1lbnRzLCBmdW5jdGlvbiggZWxlbSwgaSApIHtcbiAgICAgICAgICAgICAgICB2YXIgcmV0VmFsID0gISFxdWFsaWZpZXIuY2FsbCggZWxlbSwgaSwgZWxlbSApO1xuICAgICAgICAgICAgICAgIHJldHVybiByZXRWYWwgPT09IGtlZXA7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICB9IGVsc2UgaWYgKCBxdWFsaWZpZXIubm9kZVR5cGUgKSB7XG4gICAgICAgICAgICByZXR1cm4galF1ZXJ5LmdyZXAoZWxlbWVudHMsIGZ1bmN0aW9uKCBlbGVtLCBpICkge1xuICAgICAgICAgICAgICAgIHJldHVybiAoIGVsZW0gPT09IHF1YWxpZmllciApID09PSBrZWVwO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgfSBlbHNlIGlmICggdHlwZW9mIHF1YWxpZmllciA9PT0gXCJzdHJpbmdcIiApIHtcbiAgICAgICAgICAgIHZhciBmaWx0ZXJlZCA9IGpRdWVyeS5ncmVwKGVsZW1lbnRzLCBmdW5jdGlvbiggZWxlbSApIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZWxlbS5ub2RlVHlwZSA9PT0gMTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBpZiAoIGlzU2ltcGxlLnRlc3QoIHF1YWxpZmllciApICkge1xuICAgICAgICAgICAgICAgIHJldHVybiBqUXVlcnkuZmlsdGVyKHF1YWxpZmllciwgZmlsdGVyZWQsICFrZWVwKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgcXVhbGlmaWVyID0galF1ZXJ5LmZpbHRlciggcXVhbGlmaWVyLCBmaWx0ZXJlZCApO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIGpRdWVyeS5ncmVwKGVsZW1lbnRzLCBmdW5jdGlvbiggZWxlbSwgaSApIHtcbiAgICAgICAgICAgIHJldHVybiAoIGpRdWVyeS5pbkFycmF5KCBlbGVtLCBxdWFsaWZpZXIgKSA+PSAwICkgPT09IGtlZXA7XG4gICAgICAgIH0pO1xuICAgIH1cblxuXG5cblxuICAgIGZ1bmN0aW9uIGNyZWF0ZVNhZmVGcmFnbWVudCggZG9jdW1lbnQgKSB7XG4gICAgICAgIHZhciBsaXN0ID0gbm9kZU5hbWVzLnNwbGl0KCBcInxcIiApLFxuICAgICAgICAgICAgc2FmZUZyYWcgPSBkb2N1bWVudC5jcmVhdGVEb2N1bWVudEZyYWdtZW50KCk7XG5cbiAgICAgICAgaWYgKCBzYWZlRnJhZy5jcmVhdGVFbGVtZW50ICkge1xuICAgICAgICAgICAgd2hpbGUgKCBsaXN0Lmxlbmd0aCApIHtcbiAgICAgICAgICAgICAgICBzYWZlRnJhZy5jcmVhdGVFbGVtZW50KFxuICAgICAgICAgICAgICAgICAgICBsaXN0LnBvcCgpXG4gICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gc2FmZUZyYWc7XG4gICAgfVxuXG4gICAgdmFyIG5vZGVOYW1lcyA9IFwiYWJicnxhcnRpY2xlfGFzaWRlfGF1ZGlvfGNhbnZhc3xkYXRhbGlzdHxkZXRhaWxzfGZpZ2NhcHRpb258ZmlndXJlfGZvb3RlcnxcIiArXG4gICAgICAgICAgICBcImhlYWRlcnxoZ3JvdXB8bWFya3xtZXRlcnxuYXZ8b3V0cHV0fHByb2dyZXNzfHNlY3Rpb258c3VtbWFyeXx0aW1lfHZpZGVvXCIsXG4gICAgICAgIHJpbmxpbmVqUXVlcnkgPSAvIGpRdWVyeVxcZCs9XCIoPzpcXGQrfG51bGwpXCIvZyxcbiAgICAgICAgcmxlYWRpbmdXaGl0ZXNwYWNlID0gL15cXHMrLyxcbiAgICAgICAgcnhodG1sVGFnID0gLzwoPyFhcmVhfGJyfGNvbHxlbWJlZHxocnxpbWd8aW5wdXR8bGlua3xtZXRhfHBhcmFtKSgoW1xcdzpdKylbXj5dKilcXC8+L2lnLFxuICAgICAgICBydGFnTmFtZSA9IC88KFtcXHc6XSspLyxcbiAgICAgICAgcnRib2R5ID0gLzx0Ym9keS9pLFxuICAgICAgICByaHRtbCA9IC88fCYjP1xcdys7LyxcbiAgICAgICAgcm5vSW5uZXJodG1sID0gLzwoPzpzY3JpcHR8c3R5bGUpL2ksXG4gICAgICAgIHJub2NhY2hlID0gLzwoPzpzY3JpcHR8b2JqZWN0fGVtYmVkfG9wdGlvbnxzdHlsZSkvaSxcbiAgICAgICAgcm5vc2hpbWNhY2hlID0gbmV3IFJlZ0V4cChcIjwoPzpcIiArIG5vZGVOYW1lcyArIFwiKVwiLCBcImlcIiksXG4gICAgLy8gY2hlY2tlZD1cImNoZWNrZWRcIiBvciBjaGVja2VkXG4gICAgICAgIHJjaGVja2VkID0gL2NoZWNrZWRcXHMqKD86W149XXw9XFxzKi5jaGVja2VkLikvaSxcbiAgICAgICAgcnNjcmlwdFR5cGUgPSAvXFwvKGphdmF8ZWNtYSlzY3JpcHQvaSxcbiAgICAgICAgcmNsZWFuU2NyaXB0ID0gL15cXHMqPCEoPzpcXFtDREFUQVxcW3xcXC1cXC0pLyxcbiAgICAgICAgd3JhcE1hcCA9IHtcbiAgICAgICAgICAgIG9wdGlvbjogWyAxLCBcIjxzZWxlY3QgbXVsdGlwbGU9J211bHRpcGxlJz5cIiwgXCI8L3NlbGVjdD5cIiBdLFxuICAgICAgICAgICAgbGVnZW5kOiBbIDEsIFwiPGZpZWxkc2V0PlwiLCBcIjwvZmllbGRzZXQ+XCIgXSxcbiAgICAgICAgICAgIHRoZWFkOiBbIDEsIFwiPHRhYmxlPlwiLCBcIjwvdGFibGU+XCIgXSxcbiAgICAgICAgICAgIHRyOiBbIDIsIFwiPHRhYmxlPjx0Ym9keT5cIiwgXCI8L3Rib2R5PjwvdGFibGU+XCIgXSxcbiAgICAgICAgICAgIHRkOiBbIDMsIFwiPHRhYmxlPjx0Ym9keT48dHI+XCIsIFwiPC90cj48L3Rib2R5PjwvdGFibGU+XCIgXSxcbiAgICAgICAgICAgIGNvbDogWyAyLCBcIjx0YWJsZT48dGJvZHk+PC90Ym9keT48Y29sZ3JvdXA+XCIsIFwiPC9jb2xncm91cD48L3RhYmxlPlwiIF0sXG4gICAgICAgICAgICBhcmVhOiBbIDEsIFwiPG1hcD5cIiwgXCI8L21hcD5cIiBdLFxuICAgICAgICAgICAgX2RlZmF1bHQ6IFsgMCwgXCJcIiwgXCJcIiBdXG4gICAgICAgIH0sXG4gICAgICAgIHNhZmVGcmFnbWVudCA9IGNyZWF0ZVNhZmVGcmFnbWVudCggZG9jdW1lbnQgKTtcblxuICAgIHdyYXBNYXAub3B0Z3JvdXAgPSB3cmFwTWFwLm9wdGlvbjtcbiAgICB3cmFwTWFwLnRib2R5ID0gd3JhcE1hcC50Zm9vdCA9IHdyYXBNYXAuY29sZ3JvdXAgPSB3cmFwTWFwLmNhcHRpb24gPSB3cmFwTWFwLnRoZWFkO1xuICAgIHdyYXBNYXAudGggPSB3cmFwTWFwLnRkO1xuXG4vLyBJRSBjYW4ndCBzZXJpYWxpemUgPGxpbms+IGFuZCA8c2NyaXB0PiB0YWdzIG5vcm1hbGx5XG4gICAgaWYgKCAhalF1ZXJ5LnN1cHBvcnQuaHRtbFNlcmlhbGl6ZSApIHtcbiAgICAgICAgd3JhcE1hcC5fZGVmYXVsdCA9IFsgMSwgXCJkaXY8ZGl2PlwiLCBcIjwvZGl2PlwiIF07XG4gICAgfVxuXG4gICAgalF1ZXJ5LmZuLmV4dGVuZCh7XG4gICAgICAgIHRleHQ6IGZ1bmN0aW9uKCB0ZXh0ICkge1xuICAgICAgICAgICAgaWYgKCBqUXVlcnkuaXNGdW5jdGlvbih0ZXh0KSApIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKGkpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIHNlbGYgPSBqUXVlcnkoIHRoaXMgKTtcblxuICAgICAgICAgICAgICAgICAgICBzZWxmLnRleHQoIHRleHQuY2FsbCh0aGlzLCBpLCBzZWxmLnRleHQoKSkgKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKCB0eXBlb2YgdGV4dCAhPT0gXCJvYmplY3RcIiAmJiB0ZXh0ICE9PSB1bmRlZmluZWQgKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuZW1wdHkoKS5hcHBlbmQoICh0aGlzWzBdICYmIHRoaXNbMF0ub3duZXJEb2N1bWVudCB8fCBkb2N1bWVudCkuY3JlYXRlVGV4dE5vZGUoIHRleHQgKSApO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByZXR1cm4galF1ZXJ5LnRleHQoIHRoaXMgKTtcbiAgICAgICAgfSxcblxuICAgICAgICB3cmFwQWxsOiBmdW5jdGlvbiggaHRtbCApIHtcbiAgICAgICAgICAgIGlmICggalF1ZXJ5LmlzRnVuY3Rpb24oIGh0bWwgKSApIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKGkpIHtcbiAgICAgICAgICAgICAgICAgICAgalF1ZXJ5KHRoaXMpLndyYXBBbGwoIGh0bWwuY2FsbCh0aGlzLCBpKSApO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoIHRoaXNbMF0gKSB7XG4gICAgICAgICAgICAgICAgLy8gVGhlIGVsZW1lbnRzIHRvIHdyYXAgdGhlIHRhcmdldCBhcm91bmRcbiAgICAgICAgICAgICAgICB2YXIgd3JhcCA9IGpRdWVyeSggaHRtbCwgdGhpc1swXS5vd25lckRvY3VtZW50ICkuZXEoMCkuY2xvbmUodHJ1ZSk7XG5cbiAgICAgICAgICAgICAgICBpZiAoIHRoaXNbMF0ucGFyZW50Tm9kZSApIHtcbiAgICAgICAgICAgICAgICAgICAgd3JhcC5pbnNlcnRCZWZvcmUoIHRoaXNbMF0gKTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICB3cmFwLm1hcChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGVsZW0gPSB0aGlzO1xuXG4gICAgICAgICAgICAgICAgICAgIHdoaWxlICggZWxlbS5maXJzdENoaWxkICYmIGVsZW0uZmlyc3RDaGlsZC5ub2RlVHlwZSA9PT0gMSApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGVsZW0gPSBlbGVtLmZpcnN0Q2hpbGQ7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZWxlbTtcbiAgICAgICAgICAgICAgICB9KS5hcHBlbmQoIHRoaXMgKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgICAgIH0sXG5cbiAgICAgICAgd3JhcElubmVyOiBmdW5jdGlvbiggaHRtbCApIHtcbiAgICAgICAgICAgIGlmICggalF1ZXJ5LmlzRnVuY3Rpb24oIGh0bWwgKSApIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKGkpIHtcbiAgICAgICAgICAgICAgICAgICAgalF1ZXJ5KHRoaXMpLndyYXBJbm5lciggaHRtbC5jYWxsKHRoaXMsIGkpICk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgdmFyIHNlbGYgPSBqUXVlcnkoIHRoaXMgKSxcbiAgICAgICAgICAgICAgICAgICAgY29udGVudHMgPSBzZWxmLmNvbnRlbnRzKCk7XG5cbiAgICAgICAgICAgICAgICBpZiAoIGNvbnRlbnRzLmxlbmd0aCApIHtcbiAgICAgICAgICAgICAgICAgICAgY29udGVudHMud3JhcEFsbCggaHRtbCApO1xuXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgc2VsZi5hcHBlbmQoIGh0bWwgKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSxcblxuICAgICAgICB3cmFwOiBmdW5jdGlvbiggaHRtbCApIHtcbiAgICAgICAgICAgIHZhciBpc0Z1bmN0aW9uID0galF1ZXJ5LmlzRnVuY3Rpb24oIGh0bWwgKTtcblxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbihpKSB7XG4gICAgICAgICAgICAgICAgalF1ZXJ5KCB0aGlzICkud3JhcEFsbCggaXNGdW5jdGlvbiA/IGh0bWwuY2FsbCh0aGlzLCBpKSA6IGh0bWwgKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9LFxuXG4gICAgICAgIHVud3JhcDogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5wYXJlbnQoKS5lYWNoKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIGlmICggIWpRdWVyeS5ub2RlTmFtZSggdGhpcywgXCJib2R5XCIgKSApIHtcbiAgICAgICAgICAgICAgICAgICAgalF1ZXJ5KCB0aGlzICkucmVwbGFjZVdpdGgoIHRoaXMuY2hpbGROb2RlcyApO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pLmVuZCgpO1xuICAgICAgICB9LFxuXG4gICAgICAgIGFwcGVuZDogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5kb21NYW5pcChhcmd1bWVudHMsIHRydWUsIGZ1bmN0aW9uKCBlbGVtICkge1xuICAgICAgICAgICAgICAgIGlmICggdGhpcy5ub2RlVHlwZSA9PT0gMSApIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5hcHBlbmRDaGlsZCggZWxlbSApO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9LFxuXG4gICAgICAgIHByZXBlbmQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuZG9tTWFuaXAoYXJndW1lbnRzLCB0cnVlLCBmdW5jdGlvbiggZWxlbSApIHtcbiAgICAgICAgICAgICAgICBpZiAoIHRoaXMubm9kZVR5cGUgPT09IDEgKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuaW5zZXJ0QmVmb3JlKCBlbGVtLCB0aGlzLmZpcnN0Q2hpbGQgKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSxcblxuICAgICAgICBiZWZvcmU6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgaWYgKCB0aGlzWzBdICYmIHRoaXNbMF0ucGFyZW50Tm9kZSApIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5kb21NYW5pcChhcmd1bWVudHMsIGZhbHNlLCBmdW5jdGlvbiggZWxlbSApIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5wYXJlbnROb2RlLmluc2VydEJlZm9yZSggZWxlbSwgdGhpcyApO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSBlbHNlIGlmICggYXJndW1lbnRzLmxlbmd0aCApIHtcbiAgICAgICAgICAgICAgICB2YXIgc2V0ID0galF1ZXJ5LmNsZWFuKCBhcmd1bWVudHMgKTtcbiAgICAgICAgICAgICAgICBzZXQucHVzaC5hcHBseSggc2V0LCB0aGlzLnRvQXJyYXkoKSApO1xuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnB1c2hTdGFjayggc2V0LCBcImJlZm9yZVwiLCBhcmd1bWVudHMgKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcblxuICAgICAgICBhZnRlcjogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBpZiAoIHRoaXNbMF0gJiYgdGhpc1swXS5wYXJlbnROb2RlICkge1xuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmRvbU1hbmlwKGFyZ3VtZW50cywgZmFsc2UsIGZ1bmN0aW9uKCBlbGVtICkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnBhcmVudE5vZGUuaW5zZXJ0QmVmb3JlKCBlbGVtLCB0aGlzLm5leHRTaWJsaW5nICk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKCBhcmd1bWVudHMubGVuZ3RoICkge1xuICAgICAgICAgICAgICAgIHZhciBzZXQgPSB0aGlzLnB1c2hTdGFjayggdGhpcywgXCJhZnRlclwiLCBhcmd1bWVudHMgKTtcbiAgICAgICAgICAgICAgICBzZXQucHVzaC5hcHBseSggc2V0LCBqUXVlcnkuY2xlYW4oYXJndW1lbnRzKSApO1xuICAgICAgICAgICAgICAgIHJldHVybiBzZXQ7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sXG5cbiAgICAgICAgLy8ga2VlcERhdGEgaXMgZm9yIGludGVybmFsIHVzZSBvbmx5LS1kbyBub3QgZG9jdW1lbnRcbiAgICAgICAgcmVtb3ZlOiBmdW5jdGlvbiggc2VsZWN0b3IsIGtlZXBEYXRhICkge1xuICAgICAgICAgICAgZm9yICggdmFyIGkgPSAwLCBlbGVtOyAoZWxlbSA9IHRoaXNbaV0pICE9IG51bGw7IGkrKyApIHtcbiAgICAgICAgICAgICAgICBpZiAoICFzZWxlY3RvciB8fCBqUXVlcnkuZmlsdGVyKCBzZWxlY3RvciwgWyBlbGVtIF0gKS5sZW5ndGggKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICggIWtlZXBEYXRhICYmIGVsZW0ubm9kZVR5cGUgPT09IDEgKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBqUXVlcnkuY2xlYW5EYXRhKCBlbGVtLmdldEVsZW1lbnRzQnlUYWdOYW1lKFwiKlwiKSApO1xuICAgICAgICAgICAgICAgICAgICAgICAgalF1ZXJ5LmNsZWFuRGF0YSggWyBlbGVtIF0gKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIGlmICggZWxlbS5wYXJlbnROb2RlICkge1xuICAgICAgICAgICAgICAgICAgICAgICAgZWxlbS5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKCBlbGVtICk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHJldHVybiB0aGlzO1xuICAgICAgICB9LFxuXG4gICAgICAgIGVtcHR5OiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIGZvciAoIHZhciBpID0gMCwgZWxlbTsgKGVsZW0gPSB0aGlzW2ldKSAhPSBudWxsOyBpKysgKSB7XG4gICAgICAgICAgICAgICAgLy8gUmVtb3ZlIGVsZW1lbnQgbm9kZXMgYW5kIHByZXZlbnQgbWVtb3J5IGxlYWtzXG4gICAgICAgICAgICAgICAgaWYgKCBlbGVtLm5vZGVUeXBlID09PSAxICkge1xuICAgICAgICAgICAgICAgICAgICBqUXVlcnkuY2xlYW5EYXRhKCBlbGVtLmdldEVsZW1lbnRzQnlUYWdOYW1lKFwiKlwiKSApO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIC8vIFJlbW92ZSBhbnkgcmVtYWluaW5nIG5vZGVzXG4gICAgICAgICAgICAgICAgd2hpbGUgKCBlbGVtLmZpcnN0Q2hpbGQgKSB7XG4gICAgICAgICAgICAgICAgICAgIGVsZW0ucmVtb3ZlQ2hpbGQoIGVsZW0uZmlyc3RDaGlsZCApO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgICAgIH0sXG5cbiAgICAgICAgY2xvbmU6IGZ1bmN0aW9uKCBkYXRhQW5kRXZlbnRzLCBkZWVwRGF0YUFuZEV2ZW50cyApIHtcbiAgICAgICAgICAgIGRhdGFBbmRFdmVudHMgPSBkYXRhQW5kRXZlbnRzID09IG51bGwgPyBmYWxzZSA6IGRhdGFBbmRFdmVudHM7XG4gICAgICAgICAgICBkZWVwRGF0YUFuZEV2ZW50cyA9IGRlZXBEYXRhQW5kRXZlbnRzID09IG51bGwgPyBkYXRhQW5kRXZlbnRzIDogZGVlcERhdGFBbmRFdmVudHM7XG5cbiAgICAgICAgICAgIHJldHVybiB0aGlzLm1hcCggZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBqUXVlcnkuY2xvbmUoIHRoaXMsIGRhdGFBbmRFdmVudHMsIGRlZXBEYXRhQW5kRXZlbnRzICk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSxcblxuICAgICAgICBodG1sOiBmdW5jdGlvbiggdmFsdWUgKSB7XG4gICAgICAgICAgICBpZiAoIHZhbHVlID09PSB1bmRlZmluZWQgKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXNbMF0gJiYgdGhpc1swXS5ub2RlVHlwZSA9PT0gMSA/XG4gICAgICAgICAgICAgICAgICAgIHRoaXNbMF0uaW5uZXJIVE1MLnJlcGxhY2UocmlubGluZWpRdWVyeSwgXCJcIikgOlxuICAgICAgICAgICAgICAgICAgICBudWxsO1xuXG4gICAgICAgICAgICAgICAgLy8gU2VlIGlmIHdlIGNhbiB0YWtlIGEgc2hvcnRjdXQgYW5kIGp1c3QgdXNlIGlubmVySFRNTFxuICAgICAgICAgICAgfSBlbHNlIGlmICggdHlwZW9mIHZhbHVlID09PSBcInN0cmluZ1wiICYmICFybm9Jbm5lcmh0bWwudGVzdCggdmFsdWUgKSAmJlxuICAgICAgICAgICAgICAgIChqUXVlcnkuc3VwcG9ydC5sZWFkaW5nV2hpdGVzcGFjZSB8fCAhcmxlYWRpbmdXaGl0ZXNwYWNlLnRlc3QoIHZhbHVlICkpICYmXG4gICAgICAgICAgICAgICAgIXdyYXBNYXBbIChydGFnTmFtZS5leGVjKCB2YWx1ZSApIHx8IFtcIlwiLCBcIlwiXSlbMV0udG9Mb3dlckNhc2UoKSBdICkge1xuXG4gICAgICAgICAgICAgICAgdmFsdWUgPSB2YWx1ZS5yZXBsYWNlKHJ4aHRtbFRhZywgXCI8JDE+PC8kMj5cIik7XG5cbiAgICAgICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgICAgICBmb3IgKCB2YXIgaSA9IDAsIGwgPSB0aGlzLmxlbmd0aDsgaSA8IGw7IGkrKyApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFJlbW92ZSBlbGVtZW50IG5vZGVzIGFuZCBwcmV2ZW50IG1lbW9yeSBsZWFrc1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCB0aGlzW2ldLm5vZGVUeXBlID09PSAxICkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGpRdWVyeS5jbGVhbkRhdGEoIHRoaXNbaV0uZ2V0RWxlbWVudHNCeVRhZ05hbWUoXCIqXCIpICk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpc1tpXS5pbm5lckhUTUwgPSB2YWx1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIC8vIElmIHVzaW5nIGlubmVySFRNTCB0aHJvd3MgYW4gZXhjZXB0aW9uLCB1c2UgdGhlIGZhbGxiYWNrIG1ldGhvZFxuICAgICAgICAgICAgICAgIH0gY2F0Y2goZSkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmVtcHR5KCkuYXBwZW5kKCB2YWx1ZSApO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgfSBlbHNlIGlmICggalF1ZXJ5LmlzRnVuY3Rpb24oIHZhbHVlICkgKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5lYWNoKGZ1bmN0aW9uKGkpe1xuICAgICAgICAgICAgICAgICAgICB2YXIgc2VsZiA9IGpRdWVyeSggdGhpcyApO1xuXG4gICAgICAgICAgICAgICAgICAgIHNlbGYuaHRtbCggdmFsdWUuY2FsbCh0aGlzLCBpLCBzZWxmLmh0bWwoKSkgKTtcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB0aGlzLmVtcHR5KCkuYXBwZW5kKCB2YWx1ZSApO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByZXR1cm4gdGhpcztcbiAgICAgICAgfSxcblxuICAgICAgICByZXBsYWNlV2l0aDogZnVuY3Rpb24oIHZhbHVlICkge1xuICAgICAgICAgICAgaWYgKCB0aGlzWzBdICYmIHRoaXNbMF0ucGFyZW50Tm9kZSApIHtcbiAgICAgICAgICAgICAgICAvLyBNYWtlIHN1cmUgdGhhdCB0aGUgZWxlbWVudHMgYXJlIHJlbW92ZWQgZnJvbSB0aGUgRE9NIGJlZm9yZSB0aGV5IGFyZSBpbnNlcnRlZFxuICAgICAgICAgICAgICAgIC8vIHRoaXMgY2FuIGhlbHAgZml4IHJlcGxhY2luZyBhIHBhcmVudCB3aXRoIGNoaWxkIGVsZW1lbnRzXG4gICAgICAgICAgICAgICAgaWYgKCBqUXVlcnkuaXNGdW5jdGlvbiggdmFsdWUgKSApIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbihpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgc2VsZiA9IGpRdWVyeSh0aGlzKSwgb2xkID0gc2VsZi5odG1sKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBzZWxmLnJlcGxhY2VXaXRoKCB2YWx1ZS5jYWxsKCB0aGlzLCBpLCBvbGQgKSApO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBpZiAoIHR5cGVvZiB2YWx1ZSAhPT0gXCJzdHJpbmdcIiApIHtcbiAgICAgICAgICAgICAgICAgICAgdmFsdWUgPSBqUXVlcnkoIHZhbHVlICkuZGV0YWNoKCk7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIG5leHQgPSB0aGlzLm5leHRTaWJsaW5nLFxuICAgICAgICAgICAgICAgICAgICAgICAgcGFyZW50ID0gdGhpcy5wYXJlbnROb2RlO1xuXG4gICAgICAgICAgICAgICAgICAgIGpRdWVyeSggdGhpcyApLnJlbW92ZSgpO1xuXG4gICAgICAgICAgICAgICAgICAgIGlmICggbmV4dCApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGpRdWVyeShuZXh0KS5iZWZvcmUoIHZhbHVlICk7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBqUXVlcnkocGFyZW50KS5hcHBlbmQoIHZhbHVlICk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMubGVuZ3RoID9cbiAgICAgICAgICAgICAgICAgICAgdGhpcy5wdXNoU3RhY2soIGpRdWVyeShqUXVlcnkuaXNGdW5jdGlvbih2YWx1ZSkgPyB2YWx1ZSgpIDogdmFsdWUpLCBcInJlcGxhY2VXaXRoXCIsIHZhbHVlICkgOlxuICAgICAgICAgICAgICAgICAgICB0aGlzO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIGRldGFjaDogZnVuY3Rpb24oIHNlbGVjdG9yICkge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMucmVtb3ZlKCBzZWxlY3RvciwgdHJ1ZSApO1xuICAgICAgICB9LFxuXG4gICAgICAgIGRvbU1hbmlwOiBmdW5jdGlvbiggYXJncywgdGFibGUsIGNhbGxiYWNrICkge1xuICAgICAgICAgICAgdmFyIHJlc3VsdHMsIGZpcnN0LCBmcmFnbWVudCwgcGFyZW50LFxuICAgICAgICAgICAgICAgIHZhbHVlID0gYXJnc1swXSxcbiAgICAgICAgICAgICAgICBzY3JpcHRzID0gW107XG5cbiAgICAgICAgICAgIC8vIFdlIGNhbid0IGNsb25lTm9kZSBmcmFnbWVudHMgdGhhdCBjb250YWluIGNoZWNrZWQsIGluIFdlYktpdFxuICAgICAgICAgICAgaWYgKCAhalF1ZXJ5LnN1cHBvcnQuY2hlY2tDbG9uZSAmJiBhcmd1bWVudHMubGVuZ3RoID09PSAzICYmIHR5cGVvZiB2YWx1ZSA9PT0gXCJzdHJpbmdcIiAmJiByY2hlY2tlZC50ZXN0KCB2YWx1ZSApICkge1xuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgIGpRdWVyeSh0aGlzKS5kb21NYW5pcCggYXJncywgdGFibGUsIGNhbGxiYWNrLCB0cnVlICk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmICggalF1ZXJ5LmlzRnVuY3Rpb24odmFsdWUpICkge1xuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oaSkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgc2VsZiA9IGpRdWVyeSh0aGlzKTtcbiAgICAgICAgICAgICAgICAgICAgYXJnc1swXSA9IHZhbHVlLmNhbGwodGhpcywgaSwgdGFibGUgPyBzZWxmLmh0bWwoKSA6IHVuZGVmaW5lZCk7XG4gICAgICAgICAgICAgICAgICAgIHNlbGYuZG9tTWFuaXAoIGFyZ3MsIHRhYmxlLCBjYWxsYmFjayApO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoIHRoaXNbMF0gKSB7XG4gICAgICAgICAgICAgICAgcGFyZW50ID0gdmFsdWUgJiYgdmFsdWUucGFyZW50Tm9kZTtcblxuICAgICAgICAgICAgICAgIC8vIElmIHdlJ3JlIGluIGEgZnJhZ21lbnQsIGp1c3QgdXNlIHRoYXQgaW5zdGVhZCBvZiBidWlsZGluZyBhIG5ldyBvbmVcbiAgICAgICAgICAgICAgICBpZiAoIGpRdWVyeS5zdXBwb3J0LnBhcmVudE5vZGUgJiYgcGFyZW50ICYmIHBhcmVudC5ub2RlVHlwZSA9PT0gMTEgJiYgcGFyZW50LmNoaWxkTm9kZXMubGVuZ3RoID09PSB0aGlzLmxlbmd0aCApIHtcbiAgICAgICAgICAgICAgICAgICAgcmVzdWx0cyA9IHsgZnJhZ21lbnQ6IHBhcmVudCB9O1xuXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgcmVzdWx0cyA9IGpRdWVyeS5idWlsZEZyYWdtZW50KCBhcmdzLCB0aGlzLCBzY3JpcHRzICk7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgZnJhZ21lbnQgPSByZXN1bHRzLmZyYWdtZW50O1xuXG4gICAgICAgICAgICAgICAgaWYgKCBmcmFnbWVudC5jaGlsZE5vZGVzLmxlbmd0aCA9PT0gMSApIHtcbiAgICAgICAgICAgICAgICAgICAgZmlyc3QgPSBmcmFnbWVudCA9IGZyYWdtZW50LmZpcnN0Q2hpbGQ7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgZmlyc3QgPSBmcmFnbWVudC5maXJzdENoaWxkO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGlmICggZmlyc3QgKSB7XG4gICAgICAgICAgICAgICAgICAgIHRhYmxlID0gdGFibGUgJiYgalF1ZXJ5Lm5vZGVOYW1lKCBmaXJzdCwgXCJ0clwiICk7XG5cbiAgICAgICAgICAgICAgICAgICAgZm9yICggdmFyIGkgPSAwLCBsID0gdGhpcy5sZW5ndGgsIGxhc3RJbmRleCA9IGwgLSAxOyBpIDwgbDsgaSsrICkge1xuICAgICAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2suY2FsbChcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YWJsZSA/XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJvb3QodGhpc1tpXSwgZmlyc3QpIDpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpc1tpXSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBNYWtlIHN1cmUgdGhhdCB3ZSBkbyBub3QgbGVhayBtZW1vcnkgYnkgaW5hZHZlcnRlbnRseSBkaXNjYXJkaW5nXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gdGhlIG9yaWdpbmFsIGZyYWdtZW50ICh3aGljaCBtaWdodCBoYXZlIGF0dGFjaGVkIGRhdGEpIGluc3RlYWQgb2ZcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyB1c2luZyBpdDsgaW4gYWRkaXRpb24sIHVzZSB0aGUgb3JpZ2luYWwgZnJhZ21lbnQgb2JqZWN0IGZvciB0aGUgbGFzdFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGl0ZW0gaW5zdGVhZCBvZiBmaXJzdCBiZWNhdXNlIGl0IGNhbiBlbmQgdXAgYmVpbmcgZW1wdGllZCBpbmNvcnJlY3RseVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGluIGNlcnRhaW4gc2l0dWF0aW9ucyAoQnVnICM4MDcwKS5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBGcmFnbWVudHMgZnJvbSB0aGUgZnJhZ21lbnQgY2FjaGUgbXVzdCBhbHdheXMgYmUgY2xvbmVkIGFuZCBuZXZlciB1c2VkXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gaW4gcGxhY2UuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0cy5jYWNoZWFibGUgfHwgKCBsID4gMSAmJiBpIDwgbGFzdEluZGV4ICkgP1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBqUXVlcnkuY2xvbmUoIGZyYWdtZW50LCB0cnVlLCB0cnVlICkgOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmcmFnbWVudFxuICAgICAgICAgICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGlmICggc2NyaXB0cy5sZW5ndGggKSB7XG4gICAgICAgICAgICAgICAgICAgIGpRdWVyeS5lYWNoKCBzY3JpcHRzLCBldmFsU2NyaXB0ICk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByZXR1cm4gdGhpcztcbiAgICAgICAgfVxuICAgIH0pO1xuXG4gICAgZnVuY3Rpb24gcm9vdCggZWxlbSwgY3VyICkge1xuICAgICAgICByZXR1cm4galF1ZXJ5Lm5vZGVOYW1lKGVsZW0sIFwidGFibGVcIikgP1xuICAgICAgICAgICAgKGVsZW0uZ2V0RWxlbWVudHNCeVRhZ05hbWUoXCJ0Ym9keVwiKVswXSB8fFxuICAgICAgICAgICAgZWxlbS5hcHBlbmRDaGlsZChlbGVtLm93bmVyRG9jdW1lbnQuY3JlYXRlRWxlbWVudChcInRib2R5XCIpKSkgOlxuICAgICAgICAgICAgZWxlbTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBjbG9uZUNvcHlFdmVudCggc3JjLCBkZXN0ICkge1xuXG4gICAgICAgIGlmICggZGVzdC5ub2RlVHlwZSAhPT0gMSB8fCAhalF1ZXJ5Lmhhc0RhdGEoIHNyYyApICkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG5cbiAgICAgICAgdmFyIHR5cGUsIGksIGwsXG4gICAgICAgICAgICBvbGREYXRhID0galF1ZXJ5Ll9kYXRhKCBzcmMgKSxcbiAgICAgICAgICAgIGN1ckRhdGEgPSBqUXVlcnkuX2RhdGEoIGRlc3QsIG9sZERhdGEgKSxcbiAgICAgICAgICAgIGV2ZW50cyA9IG9sZERhdGEuZXZlbnRzO1xuXG4gICAgICAgIGlmICggZXZlbnRzICkge1xuICAgICAgICAgICAgZGVsZXRlIGN1ckRhdGEuaGFuZGxlO1xuICAgICAgICAgICAgY3VyRGF0YS5ldmVudHMgPSB7fTtcblxuICAgICAgICAgICAgZm9yICggdHlwZSBpbiBldmVudHMgKSB7XG4gICAgICAgICAgICAgICAgZm9yICggaSA9IDAsIGwgPSBldmVudHNbIHR5cGUgXS5sZW5ndGg7IGkgPCBsOyBpKysgKSB7XG4gICAgICAgICAgICAgICAgICAgIGpRdWVyeS5ldmVudC5hZGQoIGRlc3QsIHR5cGUgKyAoIGV2ZW50c1sgdHlwZSBdWyBpIF0ubmFtZXNwYWNlID8gXCIuXCIgOiBcIlwiICkgKyBldmVudHNbIHR5cGUgXVsgaSBdLm5hbWVzcGFjZSwgZXZlbnRzWyB0eXBlIF1bIGkgXSwgZXZlbnRzWyB0eXBlIF1bIGkgXS5kYXRhICk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgLy8gbWFrZSB0aGUgY2xvbmVkIHB1YmxpYyBkYXRhIG9iamVjdCBhIGNvcHkgZnJvbSB0aGUgb3JpZ2luYWxcbiAgICAgICAgaWYgKCBjdXJEYXRhLmRhdGEgKSB7XG4gICAgICAgICAgICBjdXJEYXRhLmRhdGEgPSBqUXVlcnkuZXh0ZW5kKCB7fSwgY3VyRGF0YS5kYXRhICk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBmdW5jdGlvbiBjbG9uZUZpeEF0dHJpYnV0ZXMoIHNyYywgZGVzdCApIHtcbiAgICAgICAgdmFyIG5vZGVOYW1lO1xuXG4gICAgICAgIC8vIFdlIGRvIG5vdCBuZWVkIHRvIGRvIGFueXRoaW5nIGZvciBub24tRWxlbWVudHNcbiAgICAgICAgaWYgKCBkZXN0Lm5vZGVUeXBlICE9PSAxICkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gY2xlYXJBdHRyaWJ1dGVzIHJlbW92ZXMgdGhlIGF0dHJpYnV0ZXMsIHdoaWNoIHdlIGRvbid0IHdhbnQsXG4gICAgICAgIC8vIGJ1dCBhbHNvIHJlbW92ZXMgdGhlIGF0dGFjaEV2ZW50IGV2ZW50cywgd2hpY2ggd2UgKmRvKiB3YW50XG4gICAgICAgIGlmICggZGVzdC5jbGVhckF0dHJpYnV0ZXMgKSB7XG4gICAgICAgICAgICBkZXN0LmNsZWFyQXR0cmlidXRlcygpO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gbWVyZ2VBdHRyaWJ1dGVzLCBpbiBjb250cmFzdCwgb25seSBtZXJnZXMgYmFjayBvbiB0aGVcbiAgICAgICAgLy8gb3JpZ2luYWwgYXR0cmlidXRlcywgbm90IHRoZSBldmVudHNcbiAgICAgICAgaWYgKCBkZXN0Lm1lcmdlQXR0cmlidXRlcyApIHtcbiAgICAgICAgICAgIGRlc3QubWVyZ2VBdHRyaWJ1dGVzKCBzcmMgKTtcbiAgICAgICAgfVxuXG4gICAgICAgIG5vZGVOYW1lID0gZGVzdC5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpO1xuXG4gICAgICAgIC8vIElFNi04IGZhaWwgdG8gY2xvbmUgY2hpbGRyZW4gaW5zaWRlIG9iamVjdCBlbGVtZW50cyB0aGF0IHVzZVxuICAgICAgICAvLyB0aGUgcHJvcHJpZXRhcnkgY2xhc3NpZCBhdHRyaWJ1dGUgdmFsdWUgKHJhdGhlciB0aGFuIHRoZSB0eXBlXG4gICAgICAgIC8vIGF0dHJpYnV0ZSkgdG8gaWRlbnRpZnkgdGhlIHR5cGUgb2YgY29udGVudCB0byBkaXNwbGF5XG4gICAgICAgIGlmICggbm9kZU5hbWUgPT09IFwib2JqZWN0XCIgKSB7XG4gICAgICAgICAgICBkZXN0Lm91dGVySFRNTCA9IHNyYy5vdXRlckhUTUw7XG5cbiAgICAgICAgfSBlbHNlIGlmICggbm9kZU5hbWUgPT09IFwiaW5wdXRcIiAmJiAoc3JjLnR5cGUgPT09IFwiY2hlY2tib3hcIiB8fCBzcmMudHlwZSA9PT0gXCJyYWRpb1wiKSApIHtcbiAgICAgICAgICAgIC8vIElFNi04IGZhaWxzIHRvIHBlcnNpc3QgdGhlIGNoZWNrZWQgc3RhdGUgb2YgYSBjbG9uZWQgY2hlY2tib3hcbiAgICAgICAgICAgIC8vIG9yIHJhZGlvIGJ1dHRvbi4gV29yc2UsIElFNi03IGZhaWwgdG8gZ2l2ZSB0aGUgY2xvbmVkIGVsZW1lbnRcbiAgICAgICAgICAgIC8vIGEgY2hlY2tlZCBhcHBlYXJhbmNlIGlmIHRoZSBkZWZhdWx0Q2hlY2tlZCB2YWx1ZSBpc24ndCBhbHNvIHNldFxuICAgICAgICAgICAgaWYgKCBzcmMuY2hlY2tlZCApIHtcbiAgICAgICAgICAgICAgICBkZXN0LmRlZmF1bHRDaGVja2VkID0gZGVzdC5jaGVja2VkID0gc3JjLmNoZWNrZWQ7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIElFNi03IGdldCBjb25mdXNlZCBhbmQgZW5kIHVwIHNldHRpbmcgdGhlIHZhbHVlIG9mIGEgY2xvbmVkXG4gICAgICAgICAgICAvLyBjaGVja2JveC9yYWRpbyBidXR0b24gdG8gYW4gZW1wdHkgc3RyaW5nIGluc3RlYWQgb2YgXCJvblwiXG4gICAgICAgICAgICBpZiAoIGRlc3QudmFsdWUgIT09IHNyYy52YWx1ZSApIHtcbiAgICAgICAgICAgICAgICBkZXN0LnZhbHVlID0gc3JjLnZhbHVlO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBJRTYtOCBmYWlscyB0byByZXR1cm4gdGhlIHNlbGVjdGVkIG9wdGlvbiB0byB0aGUgZGVmYXVsdCBzZWxlY3RlZFxuICAgICAgICAgICAgLy8gc3RhdGUgd2hlbiBjbG9uaW5nIG9wdGlvbnNcbiAgICAgICAgfSBlbHNlIGlmICggbm9kZU5hbWUgPT09IFwib3B0aW9uXCIgKSB7XG4gICAgICAgICAgICBkZXN0LnNlbGVjdGVkID0gc3JjLmRlZmF1bHRTZWxlY3RlZDtcblxuICAgICAgICAgICAgLy8gSUU2LTggZmFpbHMgdG8gc2V0IHRoZSBkZWZhdWx0VmFsdWUgdG8gdGhlIGNvcnJlY3QgdmFsdWUgd2hlblxuICAgICAgICAgICAgLy8gY2xvbmluZyBvdGhlciB0eXBlcyBvZiBpbnB1dCBmaWVsZHNcbiAgICAgICAgfSBlbHNlIGlmICggbm9kZU5hbWUgPT09IFwiaW5wdXRcIiB8fCBub2RlTmFtZSA9PT0gXCJ0ZXh0YXJlYVwiICkge1xuICAgICAgICAgICAgZGVzdC5kZWZhdWx0VmFsdWUgPSBzcmMuZGVmYXVsdFZhbHVlO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gRXZlbnQgZGF0YSBnZXRzIHJlZmVyZW5jZWQgaW5zdGVhZCBvZiBjb3BpZWQgaWYgdGhlIGV4cGFuZG9cbiAgICAgICAgLy8gZ2V0cyBjb3BpZWQgdG9vXG4gICAgICAgIGRlc3QucmVtb3ZlQXR0cmlidXRlKCBqUXVlcnkuZXhwYW5kbyApO1xuICAgIH1cblxuICAgIGpRdWVyeS5idWlsZEZyYWdtZW50ID0gZnVuY3Rpb24oIGFyZ3MsIG5vZGVzLCBzY3JpcHRzICkge1xuICAgICAgICB2YXIgZnJhZ21lbnQsIGNhY2hlYWJsZSwgY2FjaGVyZXN1bHRzLCBkb2MsXG4gICAgICAgICAgICBmaXJzdCA9IGFyZ3NbIDAgXTtcblxuICAgICAgICAvLyBub2RlcyBtYXkgY29udGFpbiBlaXRoZXIgYW4gZXhwbGljaXQgZG9jdW1lbnQgb2JqZWN0LFxuICAgICAgICAvLyBhIGpRdWVyeSBjb2xsZWN0aW9uIG9yIGNvbnRleHQgb2JqZWN0LlxuICAgICAgICAvLyBJZiBub2Rlc1swXSBjb250YWlucyBhIHZhbGlkIG9iamVjdCB0byBhc3NpZ24gdG8gZG9jXG4gICAgICAgIGlmICggbm9kZXMgJiYgbm9kZXNbMF0gKSB7XG4gICAgICAgICAgICBkb2MgPSBub2Rlc1swXS5vd25lckRvY3VtZW50IHx8IG5vZGVzWzBdO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gRW5zdXJlIHRoYXQgYW4gYXR0ciBvYmplY3QgZG9lc24ndCBpbmNvcnJlY3RseSBzdGFuZCBpbiBhcyBhIGRvY3VtZW50IG9iamVjdFxuICAgICAgICAvLyBDaHJvbWUgYW5kIEZpcmVmb3ggc2VlbSB0byBhbGxvdyB0aGlzIHRvIG9jY3VyIGFuZCB3aWxsIHRocm93IGV4Y2VwdGlvblxuICAgICAgICAvLyBGaXhlcyAjODk1MFxuICAgICAgICBpZiAoICFkb2MuY3JlYXRlRG9jdW1lbnRGcmFnbWVudCApIHtcbiAgICAgICAgICAgIGRvYyA9IGRvY3VtZW50O1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gT25seSBjYWNoZSBcInNtYWxsXCIgKDEvMiBLQikgSFRNTCBzdHJpbmdzIHRoYXQgYXJlIGFzc29jaWF0ZWQgd2l0aCB0aGUgbWFpbiBkb2N1bWVudFxuICAgICAgICAvLyBDbG9uaW5nIG9wdGlvbnMgbG9zZXMgdGhlIHNlbGVjdGVkIHN0YXRlLCBzbyBkb24ndCBjYWNoZSB0aGVtXG4gICAgICAgIC8vIElFIDYgZG9lc24ndCBsaWtlIGl0IHdoZW4geW91IHB1dCA8b2JqZWN0PiBvciA8ZW1iZWQ+IGVsZW1lbnRzIGluIGEgZnJhZ21lbnRcbiAgICAgICAgLy8gQWxzbywgV2ViS2l0IGRvZXMgbm90IGNsb25lICdjaGVja2VkJyBhdHRyaWJ1dGVzIG9uIGNsb25lTm9kZSwgc28gZG9uJ3QgY2FjaGVcbiAgICAgICAgLy8gTGFzdGx5LCBJRTYsNyw4IHdpbGwgbm90IGNvcnJlY3RseSByZXVzZSBjYWNoZWQgZnJhZ21lbnRzIHRoYXQgd2VyZSBjcmVhdGVkIGZyb20gdW5rbm93biBlbGVtcyAjMTA1MDFcbiAgICAgICAgaWYgKCBhcmdzLmxlbmd0aCA9PT0gMSAmJiB0eXBlb2YgZmlyc3QgPT09IFwic3RyaW5nXCIgJiYgZmlyc3QubGVuZ3RoIDwgNTEyICYmIGRvYyA9PT0gZG9jdW1lbnQgJiZcbiAgICAgICAgICAgIGZpcnN0LmNoYXJBdCgwKSA9PT0gXCI8XCIgJiYgIXJub2NhY2hlLnRlc3QoIGZpcnN0ICkgJiZcbiAgICAgICAgICAgIChqUXVlcnkuc3VwcG9ydC5jaGVja0Nsb25lIHx8ICFyY2hlY2tlZC50ZXN0KCBmaXJzdCApKSAmJlxuICAgICAgICAgICAgKGpRdWVyeS5zdXBwb3J0Lmh0bWw1Q2xvbmUgfHwgIXJub3NoaW1jYWNoZS50ZXN0KCBmaXJzdCApKSApIHtcblxuICAgICAgICAgICAgY2FjaGVhYmxlID0gdHJ1ZTtcblxuICAgICAgICAgICAgY2FjaGVyZXN1bHRzID0galF1ZXJ5LmZyYWdtZW50c1sgZmlyc3QgXTtcbiAgICAgICAgICAgIGlmICggY2FjaGVyZXN1bHRzICYmIGNhY2hlcmVzdWx0cyAhPT0gMSApIHtcbiAgICAgICAgICAgICAgICBmcmFnbWVudCA9IGNhY2hlcmVzdWx0cztcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIGlmICggIWZyYWdtZW50ICkge1xuICAgICAgICAgICAgZnJhZ21lbnQgPSBkb2MuY3JlYXRlRG9jdW1lbnRGcmFnbWVudCgpO1xuICAgICAgICAgICAgalF1ZXJ5LmNsZWFuKCBhcmdzLCBkb2MsIGZyYWdtZW50LCBzY3JpcHRzICk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoIGNhY2hlYWJsZSApIHtcbiAgICAgICAgICAgIGpRdWVyeS5mcmFnbWVudHNbIGZpcnN0IF0gPSBjYWNoZXJlc3VsdHMgPyBmcmFnbWVudCA6IDE7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4geyBmcmFnbWVudDogZnJhZ21lbnQsIGNhY2hlYWJsZTogY2FjaGVhYmxlIH07XG4gICAgfTtcblxuICAgIGpRdWVyeS5mcmFnbWVudHMgPSB7fTtcblxuICAgIGpRdWVyeS5lYWNoKHtcbiAgICAgICAgYXBwZW5kVG86IFwiYXBwZW5kXCIsXG4gICAgICAgIHByZXBlbmRUbzogXCJwcmVwZW5kXCIsXG4gICAgICAgIGluc2VydEJlZm9yZTogXCJiZWZvcmVcIixcbiAgICAgICAgaW5zZXJ0QWZ0ZXI6IFwiYWZ0ZXJcIixcbiAgICAgICAgcmVwbGFjZUFsbDogXCJyZXBsYWNlV2l0aFwiXG4gICAgfSwgZnVuY3Rpb24oIG5hbWUsIG9yaWdpbmFsICkge1xuICAgICAgICBqUXVlcnkuZm5bIG5hbWUgXSA9IGZ1bmN0aW9uKCBzZWxlY3RvciApIHtcbiAgICAgICAgICAgIHZhciByZXQgPSBbXSxcbiAgICAgICAgICAgICAgICBpbnNlcnQgPSBqUXVlcnkoIHNlbGVjdG9yICksXG4gICAgICAgICAgICAgICAgcGFyZW50ID0gdGhpcy5sZW5ndGggPT09IDEgJiYgdGhpc1swXS5wYXJlbnROb2RlO1xuXG4gICAgICAgICAgICBpZiAoIHBhcmVudCAmJiBwYXJlbnQubm9kZVR5cGUgPT09IDExICYmIHBhcmVudC5jaGlsZE5vZGVzLmxlbmd0aCA9PT0gMSAmJiBpbnNlcnQubGVuZ3RoID09PSAxICkge1xuICAgICAgICAgICAgICAgIGluc2VydFsgb3JpZ2luYWwgXSggdGhpc1swXSApO1xuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzO1xuXG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGZvciAoIHZhciBpID0gMCwgbCA9IGluc2VydC5sZW5ndGg7IGkgPCBsOyBpKysgKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBlbGVtcyA9ICggaSA+IDAgPyB0aGlzLmNsb25lKHRydWUpIDogdGhpcyApLmdldCgpO1xuICAgICAgICAgICAgICAgICAgICBqUXVlcnkoIGluc2VydFtpXSApWyBvcmlnaW5hbCBdKCBlbGVtcyApO1xuICAgICAgICAgICAgICAgICAgICByZXQgPSByZXQuY29uY2F0KCBlbGVtcyApO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnB1c2hTdGFjayggcmV0LCBuYW1lLCBpbnNlcnQuc2VsZWN0b3IgKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICB9KTtcblxuICAgIGZ1bmN0aW9uIGdldEFsbCggZWxlbSApIHtcbiAgICAgICAgaWYgKCB0eXBlb2YgZWxlbS5nZXRFbGVtZW50c0J5VGFnTmFtZSAhPT0gXCJ1bmRlZmluZWRcIiApIHtcbiAgICAgICAgICAgIHJldHVybiBlbGVtLmdldEVsZW1lbnRzQnlUYWdOYW1lKCBcIipcIiApO1xuXG4gICAgICAgIH0gZWxzZSBpZiAoIHR5cGVvZiBlbGVtLnF1ZXJ5U2VsZWN0b3JBbGwgIT09IFwidW5kZWZpbmVkXCIgKSB7XG4gICAgICAgICAgICByZXR1cm4gZWxlbS5xdWVyeVNlbGVjdG9yQWxsKCBcIipcIiApO1xuXG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gW107XG4gICAgICAgIH1cbiAgICB9XG5cbi8vIFVzZWQgaW4gY2xlYW4sIGZpeGVzIHRoZSBkZWZhdWx0Q2hlY2tlZCBwcm9wZXJ0eVxuICAgIGZ1bmN0aW9uIGZpeERlZmF1bHRDaGVja2VkKCBlbGVtICkge1xuICAgICAgICBpZiAoIGVsZW0udHlwZSA9PT0gXCJjaGVja2JveFwiIHx8IGVsZW0udHlwZSA9PT0gXCJyYWRpb1wiICkge1xuICAgICAgICAgICAgZWxlbS5kZWZhdWx0Q2hlY2tlZCA9IGVsZW0uY2hlY2tlZDtcbiAgICAgICAgfVxuICAgIH1cbi8vIEZpbmRzIGFsbCBpbnB1dHMgYW5kIHBhc3NlcyB0aGVtIHRvIGZpeERlZmF1bHRDaGVja2VkXG4gICAgZnVuY3Rpb24gZmluZElucHV0cyggZWxlbSApIHtcbiAgICAgICAgdmFyIG5vZGVOYW1lID0gKCBlbGVtLm5vZGVOYW1lIHx8IFwiXCIgKS50b0xvd2VyQ2FzZSgpO1xuICAgICAgICBpZiAoIG5vZGVOYW1lID09PSBcImlucHV0XCIgKSB7XG4gICAgICAgICAgICBmaXhEZWZhdWx0Q2hlY2tlZCggZWxlbSApO1xuICAgICAgICAgICAgLy8gU2tpcCBzY3JpcHRzLCBnZXQgb3RoZXIgY2hpbGRyZW5cbiAgICAgICAgfSBlbHNlIGlmICggbm9kZU5hbWUgIT09IFwic2NyaXB0XCIgJiYgdHlwZW9mIGVsZW0uZ2V0RWxlbWVudHNCeVRhZ05hbWUgIT09IFwidW5kZWZpbmVkXCIgKSB7XG4gICAgICAgICAgICBqUXVlcnkuZ3JlcCggZWxlbS5nZXRFbGVtZW50c0J5VGFnTmFtZShcImlucHV0XCIpLCBmaXhEZWZhdWx0Q2hlY2tlZCApO1xuICAgICAgICB9XG4gICAgfVxuXG4vLyBEZXJpdmVkIEZyb206IGh0dHA6Ly93d3cuaWVjc3MuY29tL3NoaW1wcm92ZS9qYXZhc2NyaXB0L3NoaW1wcm92ZS4xLTAtMS5qc1xuICAgIGZ1bmN0aW9uIHNoaW1DbG9uZU5vZGUoIGVsZW0gKSB7XG4gICAgICAgIHZhciBkaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCBcImRpdlwiICk7XG4gICAgICAgIHNhZmVGcmFnbWVudC5hcHBlbmRDaGlsZCggZGl2ICk7XG5cbiAgICAgICAgZGl2LmlubmVySFRNTCA9IGVsZW0ub3V0ZXJIVE1MO1xuICAgICAgICByZXR1cm4gZGl2LmZpcnN0Q2hpbGQ7XG4gICAgfVxuXG4gICAgalF1ZXJ5LmV4dGVuZCh7XG4gICAgICAgIGNsb25lOiBmdW5jdGlvbiggZWxlbSwgZGF0YUFuZEV2ZW50cywgZGVlcERhdGFBbmRFdmVudHMgKSB7XG4gICAgICAgICAgICB2YXIgc3JjRWxlbWVudHMsXG4gICAgICAgICAgICAgICAgZGVzdEVsZW1lbnRzLFxuICAgICAgICAgICAgICAgIGksXG4gICAgICAgICAgICAvLyBJRTw9OCBkb2VzIG5vdCBwcm9wZXJseSBjbG9uZSBkZXRhY2hlZCwgdW5rbm93biBlbGVtZW50IG5vZGVzXG4gICAgICAgICAgICAgICAgY2xvbmUgPSBqUXVlcnkuc3VwcG9ydC5odG1sNUNsb25lIHx8ICFybm9zaGltY2FjaGUudGVzdCggXCI8XCIgKyBlbGVtLm5vZGVOYW1lICkgP1xuICAgICAgICAgICAgICAgICAgICBlbGVtLmNsb25lTm9kZSggdHJ1ZSApIDpcbiAgICAgICAgICAgICAgICAgICAgc2hpbUNsb25lTm9kZSggZWxlbSApO1xuXG4gICAgICAgICAgICBpZiAoICghalF1ZXJ5LnN1cHBvcnQubm9DbG9uZUV2ZW50IHx8ICFqUXVlcnkuc3VwcG9ydC5ub0Nsb25lQ2hlY2tlZCkgJiZcbiAgICAgICAgICAgICAgICAoZWxlbS5ub2RlVHlwZSA9PT0gMSB8fCBlbGVtLm5vZGVUeXBlID09PSAxMSkgJiYgIWpRdWVyeS5pc1hNTERvYyhlbGVtKSApIHtcbiAgICAgICAgICAgICAgICAvLyBJRSBjb3BpZXMgZXZlbnRzIGJvdW5kIHZpYSBhdHRhY2hFdmVudCB3aGVuIHVzaW5nIGNsb25lTm9kZS5cbiAgICAgICAgICAgICAgICAvLyBDYWxsaW5nIGRldGFjaEV2ZW50IG9uIHRoZSBjbG9uZSB3aWxsIGFsc28gcmVtb3ZlIHRoZSBldmVudHNcbiAgICAgICAgICAgICAgICAvLyBmcm9tIHRoZSBvcmlnaW5hbC4gSW4gb3JkZXIgdG8gZ2V0IGFyb3VuZCB0aGlzLCB3ZSB1c2Ugc29tZVxuICAgICAgICAgICAgICAgIC8vIHByb3ByaWV0YXJ5IG1ldGhvZHMgdG8gY2xlYXIgdGhlIGV2ZW50cy4gVGhhbmtzIHRvIE1vb1Rvb2xzXG4gICAgICAgICAgICAgICAgLy8gZ3V5cyBmb3IgdGhpcyBob3RuZXNzLlxuXG4gICAgICAgICAgICAgICAgY2xvbmVGaXhBdHRyaWJ1dGVzKCBlbGVtLCBjbG9uZSApO1xuXG4gICAgICAgICAgICAgICAgLy8gVXNpbmcgU2l6emxlIGhlcmUgaXMgY3Jhenkgc2xvdywgc28gd2UgdXNlIGdldEVsZW1lbnRzQnlUYWdOYW1lIGluc3RlYWRcbiAgICAgICAgICAgICAgICBzcmNFbGVtZW50cyA9IGdldEFsbCggZWxlbSApO1xuICAgICAgICAgICAgICAgIGRlc3RFbGVtZW50cyA9IGdldEFsbCggY2xvbmUgKTtcblxuICAgICAgICAgICAgICAgIC8vIFdlaXJkIGl0ZXJhdGlvbiBiZWNhdXNlIElFIHdpbGwgcmVwbGFjZSB0aGUgbGVuZ3RoIHByb3BlcnR5XG4gICAgICAgICAgICAgICAgLy8gd2l0aCBhbiBlbGVtZW50IGlmIHlvdSBhcmUgY2xvbmluZyB0aGUgYm9keSBhbmQgb25lIG9mIHRoZVxuICAgICAgICAgICAgICAgIC8vIGVsZW1lbnRzIG9uIHRoZSBwYWdlIGhhcyBhIG5hbWUgb3IgaWQgb2YgXCJsZW5ndGhcIlxuICAgICAgICAgICAgICAgIGZvciAoIGkgPSAwOyBzcmNFbGVtZW50c1tpXTsgKytpICkge1xuICAgICAgICAgICAgICAgICAgICAvLyBFbnN1cmUgdGhhdCB0aGUgZGVzdGluYXRpb24gbm9kZSBpcyBub3QgbnVsbDsgRml4ZXMgIzk1ODdcbiAgICAgICAgICAgICAgICAgICAgaWYgKCBkZXN0RWxlbWVudHNbaV0gKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjbG9uZUZpeEF0dHJpYnV0ZXMoIHNyY0VsZW1lbnRzW2ldLCBkZXN0RWxlbWVudHNbaV0gKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gQ29weSB0aGUgZXZlbnRzIGZyb20gdGhlIG9yaWdpbmFsIHRvIHRoZSBjbG9uZVxuICAgICAgICAgICAgaWYgKCBkYXRhQW5kRXZlbnRzICkge1xuICAgICAgICAgICAgICAgIGNsb25lQ29weUV2ZW50KCBlbGVtLCBjbG9uZSApO1xuXG4gICAgICAgICAgICAgICAgaWYgKCBkZWVwRGF0YUFuZEV2ZW50cyApIHtcbiAgICAgICAgICAgICAgICAgICAgc3JjRWxlbWVudHMgPSBnZXRBbGwoIGVsZW0gKTtcbiAgICAgICAgICAgICAgICAgICAgZGVzdEVsZW1lbnRzID0gZ2V0QWxsKCBjbG9uZSApO1xuXG4gICAgICAgICAgICAgICAgICAgIGZvciAoIGkgPSAwOyBzcmNFbGVtZW50c1tpXTsgKytpICkge1xuICAgICAgICAgICAgICAgICAgICAgICAgY2xvbmVDb3B5RXZlbnQoIHNyY0VsZW1lbnRzW2ldLCBkZXN0RWxlbWVudHNbaV0gKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgc3JjRWxlbWVudHMgPSBkZXN0RWxlbWVudHMgPSBudWxsO1xuXG4gICAgICAgICAgICAvLyBSZXR1cm4gdGhlIGNsb25lZCBzZXRcbiAgICAgICAgICAgIHJldHVybiBjbG9uZTtcbiAgICAgICAgfSxcblxuICAgICAgICBjbGVhbjogZnVuY3Rpb24oIGVsZW1zLCBjb250ZXh0LCBmcmFnbWVudCwgc2NyaXB0cyApIHtcbiAgICAgICAgICAgIHZhciBjaGVja1NjcmlwdFR5cGU7XG5cbiAgICAgICAgICAgIGNvbnRleHQgPSBjb250ZXh0IHx8IGRvY3VtZW50O1xuXG4gICAgICAgICAgICAvLyAhY29udGV4dC5jcmVhdGVFbGVtZW50IGZhaWxzIGluIElFIHdpdGggYW4gZXJyb3IgYnV0IHJldHVybnMgdHlwZW9mICdvYmplY3QnXG4gICAgICAgICAgICBpZiAoIHR5cGVvZiBjb250ZXh0LmNyZWF0ZUVsZW1lbnQgPT09IFwidW5kZWZpbmVkXCIgKSB7XG4gICAgICAgICAgICAgICAgY29udGV4dCA9IGNvbnRleHQub3duZXJEb2N1bWVudCB8fCBjb250ZXh0WzBdICYmIGNvbnRleHRbMF0ub3duZXJEb2N1bWVudCB8fCBkb2N1bWVudDtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdmFyIHJldCA9IFtdLCBqO1xuXG4gICAgICAgICAgICBmb3IgKCB2YXIgaSA9IDAsIGVsZW07IChlbGVtID0gZWxlbXNbaV0pICE9IG51bGw7IGkrKyApIHtcbiAgICAgICAgICAgICAgICBpZiAoIHR5cGVvZiBlbGVtID09PSBcIm51bWJlclwiICkge1xuICAgICAgICAgICAgICAgICAgICBlbGVtICs9IFwiXCI7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgaWYgKCAhZWxlbSApIHtcbiAgICAgICAgICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgLy8gQ29udmVydCBodG1sIHN0cmluZyBpbnRvIERPTSBub2Rlc1xuICAgICAgICAgICAgICAgIGlmICggdHlwZW9mIGVsZW0gPT09IFwic3RyaW5nXCIgKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICggIXJodG1sLnRlc3QoIGVsZW0gKSApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGVsZW0gPSBjb250ZXh0LmNyZWF0ZVRleHROb2RlKCBlbGVtICk7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBGaXggXCJYSFRNTFwiLXN0eWxlIHRhZ3MgaW4gYWxsIGJyb3dzZXJzXG4gICAgICAgICAgICAgICAgICAgICAgICBlbGVtID0gZWxlbS5yZXBsYWNlKHJ4aHRtbFRhZywgXCI8JDE+PC8kMj5cIik7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFRyaW0gd2hpdGVzcGFjZSwgb3RoZXJ3aXNlIGluZGV4T2Ygd29uJ3Qgd29yayBhcyBleHBlY3RlZFxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHRhZyA9ICggcnRhZ05hbWUuZXhlYyggZWxlbSApIHx8IFtcIlwiLCBcIlwiXSApWzFdLnRvTG93ZXJDYXNlKCksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgd3JhcCA9IHdyYXBNYXBbIHRhZyBdIHx8IHdyYXBNYXAuX2RlZmF1bHQsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVwdGggPSB3cmFwWzBdLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRpdiA9IGNvbnRleHQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gQXBwZW5kIHdyYXBwZXIgZWxlbWVudCB0byB1bmtub3duIGVsZW1lbnQgc2FmZSBkb2MgZnJhZ21lbnRcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICggY29udGV4dCA9PT0gZG9jdW1lbnQgKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gVXNlIHRoZSBmcmFnbWVudCB3ZSd2ZSBhbHJlYWR5IGNyZWF0ZWQgZm9yIHRoaXMgZG9jdW1lbnRcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzYWZlRnJhZ21lbnQuYXBwZW5kQ2hpbGQoIGRpdiApO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBVc2UgYSBmcmFnbWVudCBjcmVhdGVkIHdpdGggdGhlIG93bmVyIGRvY3VtZW50XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY3JlYXRlU2FmZUZyYWdtZW50KCBjb250ZXh0ICkuYXBwZW5kQ2hpbGQoIGRpdiApO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBHbyB0byBodG1sIGFuZCBiYWNrLCB0aGVuIHBlZWwgb2ZmIGV4dHJhIHdyYXBwZXJzXG4gICAgICAgICAgICAgICAgICAgICAgICBkaXYuaW5uZXJIVE1MID0gd3JhcFsxXSArIGVsZW0gKyB3cmFwWzJdO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBNb3ZlIHRvIHRoZSByaWdodCBkZXB0aFxuICAgICAgICAgICAgICAgICAgICAgICAgd2hpbGUgKCBkZXB0aC0tICkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRpdiA9IGRpdi5sYXN0Q2hpbGQ7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFJlbW92ZSBJRSdzIGF1dG9pbnNlcnRlZCA8dGJvZHk+IGZyb20gdGFibGUgZnJhZ21lbnRzXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoICFqUXVlcnkuc3VwcG9ydC50Ym9keSApIHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIFN0cmluZyB3YXMgYSA8dGFibGU+LCAqbWF5KiBoYXZlIHNwdXJpb3VzIDx0Ym9keT5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgaGFzQm9keSA9IHJ0Ym9keS50ZXN0KGVsZW0pLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0Ym9keSA9IHRhZyA9PT0gXCJ0YWJsZVwiICYmICFoYXNCb2R5ID9cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGl2LmZpcnN0Q2hpbGQgJiYgZGl2LmZpcnN0Q2hpbGQuY2hpbGROb2RlcyA6XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIFN0cmluZyB3YXMgYSBiYXJlIDx0aGVhZD4gb3IgPHRmb290PlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgd3JhcFsxXSA9PT0gXCI8dGFibGU+XCIgJiYgIWhhc0JvZHkgP1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRpdi5jaGlsZE5vZGVzIDpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBbXTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoIGogPSB0Ym9keS5sZW5ndGggLSAxOyBqID49IDAgOyAtLWogKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICggalF1ZXJ5Lm5vZGVOYW1lKCB0Ym9keVsgaiBdLCBcInRib2R5XCIgKSAmJiAhdGJvZHlbIGogXS5jaGlsZE5vZGVzLmxlbmd0aCApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRib2R5WyBqIF0ucGFyZW50Tm9kZS5yZW1vdmVDaGlsZCggdGJvZHlbIGogXSApO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBJRSBjb21wbGV0ZWx5IGtpbGxzIGxlYWRpbmcgd2hpdGVzcGFjZSB3aGVuIGlubmVySFRNTCBpcyB1c2VkXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoICFqUXVlcnkuc3VwcG9ydC5sZWFkaW5nV2hpdGVzcGFjZSAmJiBybGVhZGluZ1doaXRlc3BhY2UudGVzdCggZWxlbSApICkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRpdi5pbnNlcnRCZWZvcmUoIGNvbnRleHQuY3JlYXRlVGV4dE5vZGUoIHJsZWFkaW5nV2hpdGVzcGFjZS5leGVjKGVsZW0pWzBdICksIGRpdi5maXJzdENoaWxkICk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIGVsZW0gPSBkaXYuY2hpbGROb2RlcztcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIC8vIFJlc2V0cyBkZWZhdWx0Q2hlY2tlZCBmb3IgYW55IHJhZGlvcyBhbmQgY2hlY2tib3hlc1xuICAgICAgICAgICAgICAgIC8vIGFib3V0IHRvIGJlIGFwcGVuZGVkIHRvIHRoZSBET00gaW4gSUUgNi83ICgjODA2MClcbiAgICAgICAgICAgICAgICB2YXIgbGVuO1xuICAgICAgICAgICAgICAgIGlmICggIWpRdWVyeS5zdXBwb3J0LmFwcGVuZENoZWNrZWQgKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICggZWxlbVswXSAmJiB0eXBlb2YgKGxlbiA9IGVsZW0ubGVuZ3RoKSA9PT0gXCJudW1iZXJcIiApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoIGogPSAwOyBqIDwgbGVuOyBqKysgKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZmluZElucHV0cyggZWxlbVtqXSApO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgZmluZElucHV0cyggZWxlbSApO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgaWYgKCBlbGVtLm5vZGVUeXBlICkge1xuICAgICAgICAgICAgICAgICAgICByZXQucHVzaCggZWxlbSApO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHJldCA9IGpRdWVyeS5tZXJnZSggcmV0LCBlbGVtICk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoIGZyYWdtZW50ICkge1xuICAgICAgICAgICAgICAgIGNoZWNrU2NyaXB0VHlwZSA9IGZ1bmN0aW9uKCBlbGVtICkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gIWVsZW0udHlwZSB8fCByc2NyaXB0VHlwZS50ZXN0KCBlbGVtLnR5cGUgKTtcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIGZvciAoIGkgPSAwOyByZXRbaV07IGkrKyApIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCBzY3JpcHRzICYmIGpRdWVyeS5ub2RlTmFtZSggcmV0W2ldLCBcInNjcmlwdFwiICkgJiYgKCFyZXRbaV0udHlwZSB8fCByZXRbaV0udHlwZS50b0xvd2VyQ2FzZSgpID09PSBcInRleHQvamF2YXNjcmlwdFwiKSApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNjcmlwdHMucHVzaCggcmV0W2ldLnBhcmVudE5vZGUgPyByZXRbaV0ucGFyZW50Tm9kZS5yZW1vdmVDaGlsZCggcmV0W2ldICkgOiByZXRbaV0gKTtcblxuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCByZXRbaV0ubm9kZVR5cGUgPT09IDEgKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGpzVGFncyA9IGpRdWVyeS5ncmVwKCByZXRbaV0uZ2V0RWxlbWVudHNCeVRhZ05hbWUoIFwic2NyaXB0XCIgKSwgY2hlY2tTY3JpcHRUeXBlICk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXQuc3BsaWNlLmFwcGx5KCByZXQsIFtpICsgMSwgMF0uY29uY2F0KCBqc1RhZ3MgKSApO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgZnJhZ21lbnQuYXBwZW5kQ2hpbGQoIHJldFtpXSApO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByZXR1cm4gcmV0O1xuICAgICAgICB9LFxuXG4gICAgICAgIGNsZWFuRGF0YTogZnVuY3Rpb24oIGVsZW1zICkge1xuICAgICAgICAgICAgdmFyIGRhdGEsIGlkLFxuICAgICAgICAgICAgICAgIGNhY2hlID0galF1ZXJ5LmNhY2hlLFxuICAgICAgICAgICAgICAgIHNwZWNpYWwgPSBqUXVlcnkuZXZlbnQuc3BlY2lhbCxcbiAgICAgICAgICAgICAgICBkZWxldGVFeHBhbmRvID0galF1ZXJ5LnN1cHBvcnQuZGVsZXRlRXhwYW5kbztcblxuICAgICAgICAgICAgZm9yICggdmFyIGkgPSAwLCBlbGVtOyAoZWxlbSA9IGVsZW1zW2ldKSAhPSBudWxsOyBpKysgKSB7XG4gICAgICAgICAgICAgICAgaWYgKCBlbGVtLm5vZGVOYW1lICYmIGpRdWVyeS5ub0RhdGFbZWxlbS5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpXSApIHtcbiAgICAgICAgICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgaWQgPSBlbGVtWyBqUXVlcnkuZXhwYW5kbyBdO1xuXG4gICAgICAgICAgICAgICAgaWYgKCBpZCApIHtcbiAgICAgICAgICAgICAgICAgICAgZGF0YSA9IGNhY2hlWyBpZCBdO1xuXG4gICAgICAgICAgICAgICAgICAgIGlmICggZGF0YSAmJiBkYXRhLmV2ZW50cyApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoIHZhciB0eXBlIGluIGRhdGEuZXZlbnRzICkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICggc3BlY2lhbFsgdHlwZSBdICkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBqUXVlcnkuZXZlbnQucmVtb3ZlKCBlbGVtLCB0eXBlICk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gVGhpcyBpcyBhIHNob3J0Y3V0IHRvIGF2b2lkIGpRdWVyeS5ldmVudC5yZW1vdmUncyBvdmVyaGVhZFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGpRdWVyeS5yZW1vdmVFdmVudCggZWxlbSwgdHlwZSwgZGF0YS5oYW5kbGUgKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIE51bGwgdGhlIERPTSByZWZlcmVuY2UgdG8gYXZvaWQgSUU2LzcvOCBsZWFrICgjNzA1NClcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICggZGF0YS5oYW5kbGUgKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YS5oYW5kbGUuZWxlbSA9IG51bGw7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICBpZiAoIGRlbGV0ZUV4cGFuZG8gKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBkZWxldGUgZWxlbVsgalF1ZXJ5LmV4cGFuZG8gXTtcblxuICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKCBlbGVtLnJlbW92ZUF0dHJpYnV0ZSApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGVsZW0ucmVtb3ZlQXR0cmlidXRlKCBqUXVlcnkuZXhwYW5kbyApO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgZGVsZXRlIGNhY2hlWyBpZCBdO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH0pO1xuXG4gICAgZnVuY3Rpb24gZXZhbFNjcmlwdCggaSwgZWxlbSApIHtcbiAgICAgICAgaWYgKCBlbGVtLnNyYyApIHtcbiAgICAgICAgICAgIGpRdWVyeS5hamF4KHtcbiAgICAgICAgICAgICAgICB1cmw6IGVsZW0uc3JjLFxuICAgICAgICAgICAgICAgIGFzeW5jOiBmYWxzZSxcbiAgICAgICAgICAgICAgICBkYXRhVHlwZTogXCJzY3JpcHRcIlxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBqUXVlcnkuZ2xvYmFsRXZhbCggKCBlbGVtLnRleHQgfHwgZWxlbS50ZXh0Q29udGVudCB8fCBlbGVtLmlubmVySFRNTCB8fCBcIlwiICkucmVwbGFjZSggcmNsZWFuU2NyaXB0LCBcIi8qJDAqL1wiICkgKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICggZWxlbS5wYXJlbnROb2RlICkge1xuICAgICAgICAgICAgZWxlbS5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKCBlbGVtICk7XG4gICAgICAgIH1cbiAgICB9XG5cblxuXG5cbiAgICB2YXIgcmFscGhhID0gL2FscGhhXFwoW14pXSpcXCkvaSxcbiAgICAgICAgcm9wYWNpdHkgPSAvb3BhY2l0eT0oW14pXSopLyxcbiAgICAvLyBmaXhlZCBmb3IgSUU5LCBzZWUgIzgzNDZcbiAgICAgICAgcnVwcGVyID0gLyhbQS1aXXxebXMpL2csXG4gICAgICAgIHJudW1weCA9IC9eLT9cXGQrKD86cHgpPyQvaSxcbiAgICAgICAgcm51bSA9IC9eLT9cXGQvLFxuICAgICAgICBycmVsTnVtID0gL14oW1xcLStdKT0oW1xcLSsuXFxkZV0rKS8sXG5cbiAgICAgICAgY3NzU2hvdyA9IHsgcG9zaXRpb246IFwiYWJzb2x1dGVcIiwgdmlzaWJpbGl0eTogXCJoaWRkZW5cIiwgZGlzcGxheTogXCJibG9ja1wiIH0sXG4gICAgICAgIGNzc1dpZHRoID0gWyBcIkxlZnRcIiwgXCJSaWdodFwiIF0sXG4gICAgICAgIGNzc0hlaWdodCA9IFsgXCJUb3BcIiwgXCJCb3R0b21cIiBdLFxuICAgICAgICBjdXJDU1MsXG5cbiAgICAgICAgZ2V0Q29tcHV0ZWRTdHlsZSxcbiAgICAgICAgY3VycmVudFN0eWxlO1xuXG4gICAgalF1ZXJ5LmZuLmNzcyA9IGZ1bmN0aW9uKCBuYW1lLCB2YWx1ZSApIHtcbiAgICAgICAgLy8gU2V0dGluZyAndW5kZWZpbmVkJyBpcyBhIG5vLW9wXG4gICAgICAgIGlmICggYXJndW1lbnRzLmxlbmd0aCA9PT0gMiAmJiB2YWx1ZSA9PT0gdW5kZWZpbmVkICkge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4galF1ZXJ5LmFjY2VzcyggdGhpcywgbmFtZSwgdmFsdWUsIHRydWUsIGZ1bmN0aW9uKCBlbGVtLCBuYW1lLCB2YWx1ZSApIHtcbiAgICAgICAgICAgIHJldHVybiB2YWx1ZSAhPT0gdW5kZWZpbmVkID9cbiAgICAgICAgICAgICAgICBqUXVlcnkuc3R5bGUoIGVsZW0sIG5hbWUsIHZhbHVlICkgOlxuICAgICAgICAgICAgICAgIGpRdWVyeS5jc3MoIGVsZW0sIG5hbWUgKTtcbiAgICAgICAgfSk7XG4gICAgfTtcblxuICAgIGpRdWVyeS5leHRlbmQoe1xuICAgICAgICAvLyBBZGQgaW4gc3R5bGUgcHJvcGVydHkgaG9va3MgZm9yIG92ZXJyaWRpbmcgdGhlIGRlZmF1bHRcbiAgICAgICAgLy8gYmVoYXZpb3Igb2YgZ2V0dGluZyBhbmQgc2V0dGluZyBhIHN0eWxlIHByb3BlcnR5XG4gICAgICAgIGNzc0hvb2tzOiB7XG4gICAgICAgICAgICBvcGFjaXR5OiB7XG4gICAgICAgICAgICAgICAgZ2V0OiBmdW5jdGlvbiggZWxlbSwgY29tcHV0ZWQgKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICggY29tcHV0ZWQgKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBXZSBzaG91bGQgYWx3YXlzIGdldCBhIG51bWJlciBiYWNrIGZyb20gb3BhY2l0eVxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHJldCA9IGN1ckNTUyggZWxlbSwgXCJvcGFjaXR5XCIsIFwib3BhY2l0eVwiICk7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmV0ID09PSBcIlwiID8gXCIxXCIgOiByZXQ7XG5cbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBlbGVtLnN0eWxlLm9wYWNpdHk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sXG5cbiAgICAgICAgLy8gRXhjbHVkZSB0aGUgZm9sbG93aW5nIGNzcyBwcm9wZXJ0aWVzIHRvIGFkZCBweFxuICAgICAgICBjc3NOdW1iZXI6IHtcbiAgICAgICAgICAgIFwiZmlsbE9wYWNpdHlcIjogdHJ1ZSxcbiAgICAgICAgICAgIFwiZm9udFdlaWdodFwiOiB0cnVlLFxuICAgICAgICAgICAgXCJsaW5lSGVpZ2h0XCI6IHRydWUsXG4gICAgICAgICAgICBcIm9wYWNpdHlcIjogdHJ1ZSxcbiAgICAgICAgICAgIFwib3JwaGFuc1wiOiB0cnVlLFxuICAgICAgICAgICAgXCJ3aWRvd3NcIjogdHJ1ZSxcbiAgICAgICAgICAgIFwiekluZGV4XCI6IHRydWUsXG4gICAgICAgICAgICBcInpvb21cIjogdHJ1ZVxuICAgICAgICB9LFxuXG4gICAgICAgIC8vIEFkZCBpbiBwcm9wZXJ0aWVzIHdob3NlIG5hbWVzIHlvdSB3aXNoIHRvIGZpeCBiZWZvcmVcbiAgICAgICAgLy8gc2V0dGluZyBvciBnZXR0aW5nIHRoZSB2YWx1ZVxuICAgICAgICBjc3NQcm9wczoge1xuICAgICAgICAgICAgLy8gbm9ybWFsaXplIGZsb2F0IGNzcyBwcm9wZXJ0eVxuICAgICAgICAgICAgXCJmbG9hdFwiOiBqUXVlcnkuc3VwcG9ydC5jc3NGbG9hdCA/IFwiY3NzRmxvYXRcIiA6IFwic3R5bGVGbG9hdFwiXG4gICAgICAgIH0sXG5cbiAgICAgICAgLy8gR2V0IGFuZCBzZXQgdGhlIHN0eWxlIHByb3BlcnR5IG9uIGEgRE9NIE5vZGVcbiAgICAgICAgc3R5bGU6IGZ1bmN0aW9uKCBlbGVtLCBuYW1lLCB2YWx1ZSwgZXh0cmEgKSB7XG4gICAgICAgICAgICAvLyBEb24ndCBzZXQgc3R5bGVzIG9uIHRleHQgYW5kIGNvbW1lbnQgbm9kZXNcbiAgICAgICAgICAgIGlmICggIWVsZW0gfHwgZWxlbS5ub2RlVHlwZSA9PT0gMyB8fCBlbGVtLm5vZGVUeXBlID09PSA4IHx8ICFlbGVtLnN0eWxlICkge1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gTWFrZSBzdXJlIHRoYXQgd2UncmUgd29ya2luZyB3aXRoIHRoZSByaWdodCBuYW1lXG4gICAgICAgICAgICB2YXIgcmV0LCB0eXBlLCBvcmlnTmFtZSA9IGpRdWVyeS5jYW1lbENhc2UoIG5hbWUgKSxcbiAgICAgICAgICAgICAgICBzdHlsZSA9IGVsZW0uc3R5bGUsIGhvb2tzID0galF1ZXJ5LmNzc0hvb2tzWyBvcmlnTmFtZSBdO1xuXG4gICAgICAgICAgICBuYW1lID0galF1ZXJ5LmNzc1Byb3BzWyBvcmlnTmFtZSBdIHx8IG9yaWdOYW1lO1xuXG4gICAgICAgICAgICAvLyBDaGVjayBpZiB3ZSdyZSBzZXR0aW5nIGEgdmFsdWVcbiAgICAgICAgICAgIGlmICggdmFsdWUgIT09IHVuZGVmaW5lZCApIHtcbiAgICAgICAgICAgICAgICB0eXBlID0gdHlwZW9mIHZhbHVlO1xuXG4gICAgICAgICAgICAgICAgLy8gY29udmVydCByZWxhdGl2ZSBudW1iZXIgc3RyaW5ncyAoKz0gb3IgLT0pIHRvIHJlbGF0aXZlIG51bWJlcnMuICM3MzQ1XG4gICAgICAgICAgICAgICAgaWYgKCB0eXBlID09PSBcInN0cmluZ1wiICYmIChyZXQgPSBycmVsTnVtLmV4ZWMoIHZhbHVlICkpICkge1xuICAgICAgICAgICAgICAgICAgICB2YWx1ZSA9ICggKyggcmV0WzFdICsgMSkgKiArcmV0WzJdICkgKyBwYXJzZUZsb2F0KCBqUXVlcnkuY3NzKCBlbGVtLCBuYW1lICkgKTtcbiAgICAgICAgICAgICAgICAgICAgLy8gRml4ZXMgYnVnICM5MjM3XG4gICAgICAgICAgICAgICAgICAgIHR5cGUgPSBcIm51bWJlclwiO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIC8vIE1ha2Ugc3VyZSB0aGF0IE5hTiBhbmQgbnVsbCB2YWx1ZXMgYXJlbid0IHNldC4gU2VlOiAjNzExNlxuICAgICAgICAgICAgICAgIGlmICggdmFsdWUgPT0gbnVsbCB8fCB0eXBlID09PSBcIm51bWJlclwiICYmIGlzTmFOKCB2YWx1ZSApICkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgLy8gSWYgYSBudW1iZXIgd2FzIHBhc3NlZCBpbiwgYWRkICdweCcgdG8gdGhlIChleGNlcHQgZm9yIGNlcnRhaW4gQ1NTIHByb3BlcnRpZXMpXG4gICAgICAgICAgICAgICAgaWYgKCB0eXBlID09PSBcIm51bWJlclwiICYmICFqUXVlcnkuY3NzTnVtYmVyWyBvcmlnTmFtZSBdICkge1xuICAgICAgICAgICAgICAgICAgICB2YWx1ZSArPSBcInB4XCI7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgLy8gSWYgYSBob29rIHdhcyBwcm92aWRlZCwgdXNlIHRoYXQgdmFsdWUsIG90aGVyd2lzZSBqdXN0IHNldCB0aGUgc3BlY2lmaWVkIHZhbHVlXG4gICAgICAgICAgICAgICAgaWYgKCAhaG9va3MgfHwgIShcInNldFwiIGluIGhvb2tzKSB8fCAodmFsdWUgPSBob29rcy5zZXQoIGVsZW0sIHZhbHVlICkpICE9PSB1bmRlZmluZWQgKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIFdyYXBwZWQgdG8gcHJldmVudCBJRSBmcm9tIHRocm93aW5nIGVycm9ycyB3aGVuICdpbnZhbGlkJyB2YWx1ZXMgYXJlIHByb3ZpZGVkXG4gICAgICAgICAgICAgICAgICAgIC8vIEZpeGVzIGJ1ZyAjNTUwOVxuICAgICAgICAgICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgICAgICAgICAgc3R5bGVbIG5hbWUgXSA9IHZhbHVlO1xuICAgICAgICAgICAgICAgICAgICB9IGNhdGNoKGUpIHt9XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIC8vIElmIGEgaG9vayB3YXMgcHJvdmlkZWQgZ2V0IHRoZSBub24tY29tcHV0ZWQgdmFsdWUgZnJvbSB0aGVyZVxuICAgICAgICAgICAgICAgIGlmICggaG9va3MgJiYgXCJnZXRcIiBpbiBob29rcyAmJiAocmV0ID0gaG9va3MuZ2V0KCBlbGVtLCBmYWxzZSwgZXh0cmEgKSkgIT09IHVuZGVmaW5lZCApIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJldDtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAvLyBPdGhlcndpc2UganVzdCBnZXQgdGhlIHZhbHVlIGZyb20gdGhlIHN0eWxlIG9iamVjdFxuICAgICAgICAgICAgICAgIHJldHVybiBzdHlsZVsgbmFtZSBdO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIGNzczogZnVuY3Rpb24oIGVsZW0sIG5hbWUsIGV4dHJhICkge1xuICAgICAgICAgICAgdmFyIHJldCwgaG9va3M7XG5cbiAgICAgICAgICAgIC8vIE1ha2Ugc3VyZSB0aGF0IHdlJ3JlIHdvcmtpbmcgd2l0aCB0aGUgcmlnaHQgbmFtZVxuICAgICAgICAgICAgbmFtZSA9IGpRdWVyeS5jYW1lbENhc2UoIG5hbWUgKTtcbiAgICAgICAgICAgIGhvb2tzID0galF1ZXJ5LmNzc0hvb2tzWyBuYW1lIF07XG4gICAgICAgICAgICBuYW1lID0galF1ZXJ5LmNzc1Byb3BzWyBuYW1lIF0gfHwgbmFtZTtcblxuICAgICAgICAgICAgLy8gY3NzRmxvYXQgbmVlZHMgYSBzcGVjaWFsIHRyZWF0bWVudFxuICAgICAgICAgICAgaWYgKCBuYW1lID09PSBcImNzc0Zsb2F0XCIgKSB7XG4gICAgICAgICAgICAgICAgbmFtZSA9IFwiZmxvYXRcIjtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gSWYgYSBob29rIHdhcyBwcm92aWRlZCBnZXQgdGhlIGNvbXB1dGVkIHZhbHVlIGZyb20gdGhlcmVcbiAgICAgICAgICAgIGlmICggaG9va3MgJiYgXCJnZXRcIiBpbiBob29rcyAmJiAocmV0ID0gaG9va3MuZ2V0KCBlbGVtLCB0cnVlLCBleHRyYSApKSAhPT0gdW5kZWZpbmVkICkge1xuICAgICAgICAgICAgICAgIHJldHVybiByZXQ7XG5cbiAgICAgICAgICAgICAgICAvLyBPdGhlcndpc2UsIGlmIGEgd2F5IHRvIGdldCB0aGUgY29tcHV0ZWQgdmFsdWUgZXhpc3RzLCB1c2UgdGhhdFxuICAgICAgICAgICAgfSBlbHNlIGlmICggY3VyQ1NTICkge1xuICAgICAgICAgICAgICAgIHJldHVybiBjdXJDU1MoIGVsZW0sIG5hbWUgKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcblxuICAgICAgICAvLyBBIG1ldGhvZCBmb3IgcXVpY2tseSBzd2FwcGluZyBpbi9vdXQgQ1NTIHByb3BlcnRpZXMgdG8gZ2V0IGNvcnJlY3QgY2FsY3VsYXRpb25zXG4gICAgICAgIHN3YXA6IGZ1bmN0aW9uKCBlbGVtLCBvcHRpb25zLCBjYWxsYmFjayApIHtcbiAgICAgICAgICAgIHZhciBvbGQgPSB7fTtcblxuICAgICAgICAgICAgLy8gUmVtZW1iZXIgdGhlIG9sZCB2YWx1ZXMsIGFuZCBpbnNlcnQgdGhlIG5ldyBvbmVzXG4gICAgICAgICAgICBmb3IgKCB2YXIgbmFtZSBpbiBvcHRpb25zICkge1xuICAgICAgICAgICAgICAgIG9sZFsgbmFtZSBdID0gZWxlbS5zdHlsZVsgbmFtZSBdO1xuICAgICAgICAgICAgICAgIGVsZW0uc3R5bGVbIG5hbWUgXSA9IG9wdGlvbnNbIG5hbWUgXTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgY2FsbGJhY2suY2FsbCggZWxlbSApO1xuXG4gICAgICAgICAgICAvLyBSZXZlcnQgdGhlIG9sZCB2YWx1ZXNcbiAgICAgICAgICAgIGZvciAoIG5hbWUgaW4gb3B0aW9ucyApIHtcbiAgICAgICAgICAgICAgICBlbGVtLnN0eWxlWyBuYW1lIF0gPSBvbGRbIG5hbWUgXTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH0pO1xuXG4vLyBERVBSRUNBVEVELCBVc2UgalF1ZXJ5LmNzcygpIGluc3RlYWRcbiAgICBqUXVlcnkuY3VyQ1NTID0galF1ZXJ5LmNzcztcblxuICAgIGpRdWVyeS5lYWNoKFtcImhlaWdodFwiLCBcIndpZHRoXCJdLCBmdW5jdGlvbiggaSwgbmFtZSApIHtcbiAgICAgICAgalF1ZXJ5LmNzc0hvb2tzWyBuYW1lIF0gPSB7XG4gICAgICAgICAgICBnZXQ6IGZ1bmN0aW9uKCBlbGVtLCBjb21wdXRlZCwgZXh0cmEgKSB7XG4gICAgICAgICAgICAgICAgdmFyIHZhbDtcblxuICAgICAgICAgICAgICAgIGlmICggY29tcHV0ZWQgKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICggZWxlbS5vZmZzZXRXaWR0aCAhPT0gMCApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBnZXRXSCggZWxlbSwgbmFtZSwgZXh0cmEgKTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGpRdWVyeS5zd2FwKCBlbGVtLCBjc3NTaG93LCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWwgPSBnZXRXSCggZWxlbSwgbmFtZSwgZXh0cmEgKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHZhbDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuXG4gICAgICAgICAgICBzZXQ6IGZ1bmN0aW9uKCBlbGVtLCB2YWx1ZSApIHtcbiAgICAgICAgICAgICAgICBpZiAoIHJudW1weC50ZXN0KCB2YWx1ZSApICkge1xuICAgICAgICAgICAgICAgICAgICAvLyBpZ25vcmUgbmVnYXRpdmUgd2lkdGggYW5kIGhlaWdodCB2YWx1ZXMgIzE1OTlcbiAgICAgICAgICAgICAgICAgICAgdmFsdWUgPSBwYXJzZUZsb2F0KCB2YWx1ZSApO1xuXG4gICAgICAgICAgICAgICAgICAgIGlmICggdmFsdWUgPj0gMCApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB2YWx1ZSArIFwicHhcIjtcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHZhbHVlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICB9KTtcblxuICAgIGlmICggIWpRdWVyeS5zdXBwb3J0Lm9wYWNpdHkgKSB7XG4gICAgICAgIGpRdWVyeS5jc3NIb29rcy5vcGFjaXR5ID0ge1xuICAgICAgICAgICAgZ2V0OiBmdW5jdGlvbiggZWxlbSwgY29tcHV0ZWQgKSB7XG4gICAgICAgICAgICAgICAgLy8gSUUgdXNlcyBmaWx0ZXJzIGZvciBvcGFjaXR5XG4gICAgICAgICAgICAgICAgcmV0dXJuIHJvcGFjaXR5LnRlc3QoIChjb21wdXRlZCAmJiBlbGVtLmN1cnJlbnRTdHlsZSA/IGVsZW0uY3VycmVudFN0eWxlLmZpbHRlciA6IGVsZW0uc3R5bGUuZmlsdGVyKSB8fCBcIlwiICkgP1xuICAgICAgICAgICAgICAgICggcGFyc2VGbG9hdCggUmVnRXhwLiQxICkgLyAxMDAgKSArIFwiXCIgOlxuICAgICAgICAgICAgICAgICAgICBjb21wdXRlZCA/IFwiMVwiIDogXCJcIjtcbiAgICAgICAgICAgIH0sXG5cbiAgICAgICAgICAgIHNldDogZnVuY3Rpb24oIGVsZW0sIHZhbHVlICkge1xuICAgICAgICAgICAgICAgIHZhciBzdHlsZSA9IGVsZW0uc3R5bGUsXG4gICAgICAgICAgICAgICAgICAgIGN1cnJlbnRTdHlsZSA9IGVsZW0uY3VycmVudFN0eWxlLFxuICAgICAgICAgICAgICAgICAgICBvcGFjaXR5ID0galF1ZXJ5LmlzTnVtZXJpYyggdmFsdWUgKSA/IFwiYWxwaGEob3BhY2l0eT1cIiArIHZhbHVlICogMTAwICsgXCIpXCIgOiBcIlwiLFxuICAgICAgICAgICAgICAgICAgICBmaWx0ZXIgPSBjdXJyZW50U3R5bGUgJiYgY3VycmVudFN0eWxlLmZpbHRlciB8fCBzdHlsZS5maWx0ZXIgfHwgXCJcIjtcblxuICAgICAgICAgICAgICAgIC8vIElFIGhhcyB0cm91YmxlIHdpdGggb3BhY2l0eSBpZiBpdCBkb2VzIG5vdCBoYXZlIGxheW91dFxuICAgICAgICAgICAgICAgIC8vIEZvcmNlIGl0IGJ5IHNldHRpbmcgdGhlIHpvb20gbGV2ZWxcbiAgICAgICAgICAgICAgICBzdHlsZS56b29tID0gMTtcblxuICAgICAgICAgICAgICAgIC8vIGlmIHNldHRpbmcgb3BhY2l0eSB0byAxLCBhbmQgbm8gb3RoZXIgZmlsdGVycyBleGlzdCAtIGF0dGVtcHQgdG8gcmVtb3ZlIGZpbHRlciBhdHRyaWJ1dGUgIzY2NTJcbiAgICAgICAgICAgICAgICBpZiAoIHZhbHVlID49IDEgJiYgalF1ZXJ5LnRyaW0oIGZpbHRlci5yZXBsYWNlKCByYWxwaGEsIFwiXCIgKSApID09PSBcIlwiICkge1xuXG4gICAgICAgICAgICAgICAgICAgIC8vIFNldHRpbmcgc3R5bGUuZmlsdGVyIHRvIG51bGwsIFwiXCIgJiBcIiBcIiBzdGlsbCBsZWF2ZSBcImZpbHRlcjpcIiBpbiB0aGUgY3NzVGV4dFxuICAgICAgICAgICAgICAgICAgICAvLyBpZiBcImZpbHRlcjpcIiBpcyBwcmVzZW50IGF0IGFsbCwgY2xlYXJUeXBlIGlzIGRpc2FibGVkLCB3ZSB3YW50IHRvIGF2b2lkIHRoaXNcbiAgICAgICAgICAgICAgICAgICAgLy8gc3R5bGUucmVtb3ZlQXR0cmlidXRlIGlzIElFIE9ubHksIGJ1dCBzbyBhcHBhcmVudGx5IGlzIHRoaXMgY29kZSBwYXRoLi4uXG4gICAgICAgICAgICAgICAgICAgIHN0eWxlLnJlbW92ZUF0dHJpYnV0ZSggXCJmaWx0ZXJcIiApO1xuXG4gICAgICAgICAgICAgICAgICAgIC8vIGlmIHRoZXJlIHRoZXJlIGlzIG5vIGZpbHRlciBzdHlsZSBhcHBsaWVkIGluIGEgY3NzIHJ1bGUsIHdlIGFyZSBkb25lXG4gICAgICAgICAgICAgICAgICAgIGlmICggY3VycmVudFN0eWxlICYmICFjdXJyZW50U3R5bGUuZmlsdGVyICkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgLy8gb3RoZXJ3aXNlLCBzZXQgbmV3IGZpbHRlciB2YWx1ZXNcbiAgICAgICAgICAgICAgICBzdHlsZS5maWx0ZXIgPSByYWxwaGEudGVzdCggZmlsdGVyICkgP1xuICAgICAgICAgICAgICAgICAgICBmaWx0ZXIucmVwbGFjZSggcmFscGhhLCBvcGFjaXR5ICkgOlxuICAgICAgICAgICAgICAgIGZpbHRlciArIFwiIFwiICsgb3BhY2l0eTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICB9XG5cbiAgICBqUXVlcnkoZnVuY3Rpb24oKSB7XG4gICAgICAgIC8vIFRoaXMgaG9vayBjYW5ub3QgYmUgYWRkZWQgdW50aWwgRE9NIHJlYWR5IGJlY2F1c2UgdGhlIHN1cHBvcnQgdGVzdFxuICAgICAgICAvLyBmb3IgaXQgaXMgbm90IHJ1biB1bnRpbCBhZnRlciBET00gcmVhZHlcbiAgICAgICAgaWYgKCAhalF1ZXJ5LnN1cHBvcnQucmVsaWFibGVNYXJnaW5SaWdodCApIHtcbiAgICAgICAgICAgIGpRdWVyeS5jc3NIb29rcy5tYXJnaW5SaWdodCA9IHtcbiAgICAgICAgICAgICAgICBnZXQ6IGZ1bmN0aW9uKCBlbGVtLCBjb21wdXRlZCApIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gV2ViS2l0IEJ1ZyAxMzM0MyAtIGdldENvbXB1dGVkU3R5bGUgcmV0dXJucyB3cm9uZyB2YWx1ZSBmb3IgbWFyZ2luLXJpZ2h0XG4gICAgICAgICAgICAgICAgICAgIC8vIFdvcmsgYXJvdW5kIGJ5IHRlbXBvcmFyaWx5IHNldHRpbmcgZWxlbWVudCBkaXNwbGF5IHRvIGlubGluZS1ibG9ja1xuICAgICAgICAgICAgICAgICAgICB2YXIgcmV0O1xuICAgICAgICAgICAgICAgICAgICBqUXVlcnkuc3dhcCggZWxlbSwgeyBcImRpc3BsYXlcIjogXCJpbmxpbmUtYmxvY2tcIiB9LCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICggY29tcHV0ZWQgKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0ID0gY3VyQ1NTKCBlbGVtLCBcIm1hcmdpbi1yaWdodFwiLCBcIm1hcmdpblJpZ2h0XCIgKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0ID0gZWxlbS5zdHlsZS5tYXJnaW5SaWdodDtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiByZXQ7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfTtcbiAgICAgICAgfVxuICAgIH0pO1xuXG4gICAgaWYgKCBkb2N1bWVudC5kZWZhdWx0VmlldyAmJiBkb2N1bWVudC5kZWZhdWx0Vmlldy5nZXRDb21wdXRlZFN0eWxlICkge1xuICAgICAgICBnZXRDb21wdXRlZFN0eWxlID0gZnVuY3Rpb24oIGVsZW0sIG5hbWUgKSB7XG4gICAgICAgICAgICB2YXIgcmV0LCBkZWZhdWx0VmlldywgY29tcHV0ZWRTdHlsZTtcblxuICAgICAgICAgICAgbmFtZSA9IG5hbWUucmVwbGFjZSggcnVwcGVyLCBcIi0kMVwiICkudG9Mb3dlckNhc2UoKTtcblxuICAgICAgICAgICAgaWYgKCAoZGVmYXVsdFZpZXcgPSBlbGVtLm93bmVyRG9jdW1lbnQuZGVmYXVsdFZpZXcpICYmXG4gICAgICAgICAgICAgICAgKGNvbXB1dGVkU3R5bGUgPSBkZWZhdWx0Vmlldy5nZXRDb21wdXRlZFN0eWxlKCBlbGVtLCBudWxsICkpICkge1xuICAgICAgICAgICAgICAgIHJldCA9IGNvbXB1dGVkU3R5bGUuZ2V0UHJvcGVydHlWYWx1ZSggbmFtZSApO1xuICAgICAgICAgICAgICAgIGlmICggcmV0ID09PSBcIlwiICYmICFqUXVlcnkuY29udGFpbnMoIGVsZW0ub3duZXJEb2N1bWVudC5kb2N1bWVudEVsZW1lbnQsIGVsZW0gKSApIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0ID0galF1ZXJ5LnN0eWxlKCBlbGVtLCBuYW1lICk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByZXR1cm4gcmV0O1xuICAgICAgICB9O1xuICAgIH1cblxuICAgIGlmICggZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmN1cnJlbnRTdHlsZSApIHtcbiAgICAgICAgY3VycmVudFN0eWxlID0gZnVuY3Rpb24oIGVsZW0sIG5hbWUgKSB7XG4gICAgICAgICAgICB2YXIgbGVmdCwgcnNMZWZ0LCB1bmNvbXB1dGVkLFxuICAgICAgICAgICAgICAgIHJldCA9IGVsZW0uY3VycmVudFN0eWxlICYmIGVsZW0uY3VycmVudFN0eWxlWyBuYW1lIF0sXG4gICAgICAgICAgICAgICAgc3R5bGUgPSBlbGVtLnN0eWxlO1xuXG4gICAgICAgICAgICAvLyBBdm9pZCBzZXR0aW5nIHJldCB0byBlbXB0eSBzdHJpbmcgaGVyZVxuICAgICAgICAgICAgLy8gc28gd2UgZG9uJ3QgZGVmYXVsdCB0byBhdXRvXG4gICAgICAgICAgICBpZiAoIHJldCA9PT0gbnVsbCAmJiBzdHlsZSAmJiAodW5jb21wdXRlZCA9IHN0eWxlWyBuYW1lIF0pICkge1xuICAgICAgICAgICAgICAgIHJldCA9IHVuY29tcHV0ZWQ7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIEZyb20gdGhlIGF3ZXNvbWUgaGFjayBieSBEZWFuIEVkd2FyZHNcbiAgICAgICAgICAgIC8vIGh0dHA6Ly9lcmlrLmVhZS5uZXQvYXJjaGl2ZXMvMjAwNy8wNy8yNy8xOC41NC4xNS8jY29tbWVudC0xMDIyOTFcblxuICAgICAgICAgICAgLy8gSWYgd2UncmUgbm90IGRlYWxpbmcgd2l0aCBhIHJlZ3VsYXIgcGl4ZWwgbnVtYmVyXG4gICAgICAgICAgICAvLyBidXQgYSBudW1iZXIgdGhhdCBoYXMgYSB3ZWlyZCBlbmRpbmcsIHdlIG5lZWQgdG8gY29udmVydCBpdCB0byBwaXhlbHNcbiAgICAgICAgICAgIGlmICggIXJudW1weC50ZXN0KCByZXQgKSAmJiBybnVtLnRlc3QoIHJldCApICkge1xuXG4gICAgICAgICAgICAgICAgLy8gUmVtZW1iZXIgdGhlIG9yaWdpbmFsIHZhbHVlc1xuICAgICAgICAgICAgICAgIGxlZnQgPSBzdHlsZS5sZWZ0O1xuICAgICAgICAgICAgICAgIHJzTGVmdCA9IGVsZW0ucnVudGltZVN0eWxlICYmIGVsZW0ucnVudGltZVN0eWxlLmxlZnQ7XG5cbiAgICAgICAgICAgICAgICAvLyBQdXQgaW4gdGhlIG5ldyB2YWx1ZXMgdG8gZ2V0IGEgY29tcHV0ZWQgdmFsdWUgb3V0XG4gICAgICAgICAgICAgICAgaWYgKCByc0xlZnQgKSB7XG4gICAgICAgICAgICAgICAgICAgIGVsZW0ucnVudGltZVN0eWxlLmxlZnQgPSBlbGVtLmN1cnJlbnRTdHlsZS5sZWZ0O1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBzdHlsZS5sZWZ0ID0gbmFtZSA9PT0gXCJmb250U2l6ZVwiID8gXCIxZW1cIiA6ICggcmV0IHx8IDAgKTtcbiAgICAgICAgICAgICAgICByZXQgPSBzdHlsZS5waXhlbExlZnQgKyBcInB4XCI7XG5cbiAgICAgICAgICAgICAgICAvLyBSZXZlcnQgdGhlIGNoYW5nZWQgdmFsdWVzXG4gICAgICAgICAgICAgICAgc3R5bGUubGVmdCA9IGxlZnQ7XG4gICAgICAgICAgICAgICAgaWYgKCByc0xlZnQgKSB7XG4gICAgICAgICAgICAgICAgICAgIGVsZW0ucnVudGltZVN0eWxlLmxlZnQgPSByc0xlZnQ7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByZXR1cm4gcmV0ID09PSBcIlwiID8gXCJhdXRvXCIgOiByZXQ7XG4gICAgICAgIH07XG4gICAgfVxuXG4gICAgY3VyQ1NTID0gZ2V0Q29tcHV0ZWRTdHlsZSB8fCBjdXJyZW50U3R5bGU7XG5cbiAgICBmdW5jdGlvbiBnZXRXSCggZWxlbSwgbmFtZSwgZXh0cmEgKSB7XG5cbiAgICAgICAgLy8gU3RhcnQgd2l0aCBvZmZzZXQgcHJvcGVydHlcbiAgICAgICAgdmFyIHZhbCA9IG5hbWUgPT09IFwid2lkdGhcIiA/IGVsZW0ub2Zmc2V0V2lkdGggOiBlbGVtLm9mZnNldEhlaWdodCxcbiAgICAgICAgICAgIHdoaWNoID0gbmFtZSA9PT0gXCJ3aWR0aFwiID8gY3NzV2lkdGggOiBjc3NIZWlnaHQsXG4gICAgICAgICAgICBpID0gMCxcbiAgICAgICAgICAgIGxlbiA9IHdoaWNoLmxlbmd0aDtcblxuICAgICAgICBpZiAoIHZhbCA+IDAgKSB7XG4gICAgICAgICAgICBpZiAoIGV4dHJhICE9PSBcImJvcmRlclwiICkge1xuICAgICAgICAgICAgICAgIGZvciAoIDsgaSA8IGxlbjsgaSsrICkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoICFleHRyYSApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhbCAtPSBwYXJzZUZsb2F0KCBqUXVlcnkuY3NzKCBlbGVtLCBcInBhZGRpbmdcIiArIHdoaWNoWyBpIF0gKSApIHx8IDA7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgaWYgKCBleHRyYSA9PT0gXCJtYXJnaW5cIiApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhbCArPSBwYXJzZUZsb2F0KCBqUXVlcnkuY3NzKCBlbGVtLCBleHRyYSArIHdoaWNoWyBpIF0gKSApIHx8IDA7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YWwgLT0gcGFyc2VGbG9hdCggalF1ZXJ5LmNzcyggZWxlbSwgXCJib3JkZXJcIiArIHdoaWNoWyBpIF0gKyBcIldpZHRoXCIgKSApIHx8IDA7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHJldHVybiB2YWwgKyBcInB4XCI7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBGYWxsIGJhY2sgdG8gY29tcHV0ZWQgdGhlbiB1bmNvbXB1dGVkIGNzcyBpZiBuZWNlc3NhcnlcbiAgICAgICAgdmFsID0gY3VyQ1NTKCBlbGVtLCBuYW1lLCBuYW1lICk7XG4gICAgICAgIGlmICggdmFsIDwgMCB8fCB2YWwgPT0gbnVsbCApIHtcbiAgICAgICAgICAgIHZhbCA9IGVsZW0uc3R5bGVbIG5hbWUgXSB8fCAwO1xuICAgICAgICB9XG4gICAgICAgIC8vIE5vcm1hbGl6ZSBcIlwiLCBhdXRvLCBhbmQgcHJlcGFyZSBmb3IgZXh0cmFcbiAgICAgICAgdmFsID0gcGFyc2VGbG9hdCggdmFsICkgfHwgMDtcblxuICAgICAgICAvLyBBZGQgcGFkZGluZywgYm9yZGVyLCBtYXJnaW5cbiAgICAgICAgaWYgKCBleHRyYSApIHtcbiAgICAgICAgICAgIGZvciAoIDsgaSA8IGxlbjsgaSsrICkge1xuICAgICAgICAgICAgICAgIHZhbCArPSBwYXJzZUZsb2F0KCBqUXVlcnkuY3NzKCBlbGVtLCBcInBhZGRpbmdcIiArIHdoaWNoWyBpIF0gKSApIHx8IDA7XG4gICAgICAgICAgICAgICAgaWYgKCBleHRyYSAhPT0gXCJwYWRkaW5nXCIgKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhbCArPSBwYXJzZUZsb2F0KCBqUXVlcnkuY3NzKCBlbGVtLCBcImJvcmRlclwiICsgd2hpY2hbIGkgXSArIFwiV2lkdGhcIiApICkgfHwgMDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKCBleHRyYSA9PT0gXCJtYXJnaW5cIiApIHtcbiAgICAgICAgICAgICAgICAgICAgdmFsICs9IHBhcnNlRmxvYXQoIGpRdWVyeS5jc3MoIGVsZW0sIGV4dHJhICsgd2hpY2hbIGkgXSApICkgfHwgMDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gdmFsICsgXCJweFwiO1xuICAgIH1cblxuICAgIGlmICggalF1ZXJ5LmV4cHIgJiYgalF1ZXJ5LmV4cHIuZmlsdGVycyApIHtcbiAgICAgICAgalF1ZXJ5LmV4cHIuZmlsdGVycy5oaWRkZW4gPSBmdW5jdGlvbiggZWxlbSApIHtcbiAgICAgICAgICAgIHZhciB3aWR0aCA9IGVsZW0ub2Zmc2V0V2lkdGgsXG4gICAgICAgICAgICAgICAgaGVpZ2h0ID0gZWxlbS5vZmZzZXRIZWlnaHQ7XG5cbiAgICAgICAgICAgIHJldHVybiAoIHdpZHRoID09PSAwICYmIGhlaWdodCA9PT0gMCApIHx8ICghalF1ZXJ5LnN1cHBvcnQucmVsaWFibGVIaWRkZW5PZmZzZXRzICYmICgoZWxlbS5zdHlsZSAmJiBlbGVtLnN0eWxlLmRpc3BsYXkpIHx8IGpRdWVyeS5jc3MoIGVsZW0sIFwiZGlzcGxheVwiICkpID09PSBcIm5vbmVcIik7XG4gICAgICAgIH07XG5cbiAgICAgICAgalF1ZXJ5LmV4cHIuZmlsdGVycy52aXNpYmxlID0gZnVuY3Rpb24oIGVsZW0gKSB7XG4gICAgICAgICAgICByZXR1cm4gIWpRdWVyeS5leHByLmZpbHRlcnMuaGlkZGVuKCBlbGVtICk7XG4gICAgICAgIH07XG4gICAgfVxuXG5cblxuXG4gICAgdmFyIHIyMCA9IC8lMjAvZyxcbiAgICAgICAgcmJyYWNrZXQgPSAvXFxbXFxdJC8sXG4gICAgICAgIHJDUkxGID0gL1xccj9cXG4vZyxcbiAgICAgICAgcmhhc2ggPSAvIy4qJC8sXG4gICAgICAgIHJoZWFkZXJzID0gL14oLio/KTpbIFxcdF0qKFteXFxyXFxuXSopXFxyPyQvbWcsIC8vIElFIGxlYXZlcyBhbiBcXHIgY2hhcmFjdGVyIGF0IEVPTFxuICAgICAgICByaW5wdXQgPSAvXig/OmNvbG9yfGRhdGV8ZGF0ZXRpbWV8ZGF0ZXRpbWUtbG9jYWx8ZW1haWx8aGlkZGVufG1vbnRofG51bWJlcnxwYXNzd29yZHxyYW5nZXxzZWFyY2h8dGVsfHRleHR8dGltZXx1cmx8d2VlaykkL2ksXG4gICAgLy8gIzc2NTMsICM4MTI1LCAjODE1MjogbG9jYWwgcHJvdG9jb2wgZGV0ZWN0aW9uXG4gICAgICAgIHJsb2NhbFByb3RvY29sID0gL14oPzphYm91dHxhcHB8YXBwXFwtc3RvcmFnZXwuK1xcLWV4dGVuc2lvbnxmaWxlfHJlc3x3aWRnZXQpOiQvLFxuICAgICAgICBybm9Db250ZW50ID0gL14oPzpHRVR8SEVBRCkkLyxcbiAgICAgICAgcnByb3RvY29sID0gL15cXC9cXC8vLFxuICAgICAgICBycXVlcnkgPSAvXFw/LyxcbiAgICAgICAgcnNjcmlwdCA9IC88c2NyaXB0XFxiW148XSooPzooPyE8XFwvc2NyaXB0Pik8W148XSopKjxcXC9zY3JpcHQ+L2dpLFxuICAgICAgICByc2VsZWN0VGV4dGFyZWEgPSAvXig/OnNlbGVjdHx0ZXh0YXJlYSkvaSxcbiAgICAgICAgcnNwYWNlc0FqYXggPSAvXFxzKy8sXG4gICAgICAgIHJ0cyA9IC8oWz8mXSlfPVteJl0qLyxcbiAgICAgICAgcnVybCA9IC9eKFtcXHdcXCtcXC5cXC1dKzopKD86XFwvXFwvKFteXFwvPyM6XSopKD86OihcXGQrKSk/KT8vLFxuXG4gICAgLy8gS2VlcCBhIGNvcHkgb2YgdGhlIG9sZCBsb2FkIG1ldGhvZFxuICAgICAgICBfbG9hZCA9IGpRdWVyeS5mbi5sb2FkLFxuXG4gICAgLyogUHJlZmlsdGVyc1xuICAgICAqIDEpIFRoZXkgYXJlIHVzZWZ1bCB0byBpbnRyb2R1Y2UgY3VzdG9tIGRhdGFUeXBlcyAoc2VlIGFqYXgvanNvbnAuanMgZm9yIGFuIGV4YW1wbGUpXG4gICAgICogMikgVGhlc2UgYXJlIGNhbGxlZDpcbiAgICAgKiAgICAtIEJFRk9SRSBhc2tpbmcgZm9yIGEgdHJhbnNwb3J0XG4gICAgICogICAgLSBBRlRFUiBwYXJhbSBzZXJpYWxpemF0aW9uIChzLmRhdGEgaXMgYSBzdHJpbmcgaWYgcy5wcm9jZXNzRGF0YSBpcyB0cnVlKVxuICAgICAqIDMpIGtleSBpcyB0aGUgZGF0YVR5cGVcbiAgICAgKiA0KSB0aGUgY2F0Y2hhbGwgc3ltYm9sIFwiKlwiIGNhbiBiZSB1c2VkXG4gICAgICogNSkgZXhlY3V0aW9uIHdpbGwgc3RhcnQgd2l0aCB0cmFuc3BvcnQgZGF0YVR5cGUgYW5kIFRIRU4gY29udGludWUgZG93biB0byBcIipcIiBpZiBuZWVkZWRcbiAgICAgKi9cbiAgICAgICAgcHJlZmlsdGVycyA9IHt9LFxuXG4gICAgLyogVHJhbnNwb3J0cyBiaW5kaW5nc1xuICAgICAqIDEpIGtleSBpcyB0aGUgZGF0YVR5cGVcbiAgICAgKiAyKSB0aGUgY2F0Y2hhbGwgc3ltYm9sIFwiKlwiIGNhbiBiZSB1c2VkXG4gICAgICogMykgc2VsZWN0aW9uIHdpbGwgc3RhcnQgd2l0aCB0cmFuc3BvcnQgZGF0YVR5cGUgYW5kIFRIRU4gZ28gdG8gXCIqXCIgaWYgbmVlZGVkXG4gICAgICovXG4gICAgICAgIHRyYW5zcG9ydHMgPSB7fSxcblxuICAgIC8vIERvY3VtZW50IGxvY2F0aW9uXG4gICAgICAgIGFqYXhMb2NhdGlvbixcblxuICAgIC8vIERvY3VtZW50IGxvY2F0aW9uIHNlZ21lbnRzXG4gICAgICAgIGFqYXhMb2NQYXJ0cyxcblxuICAgIC8vIEF2b2lkIGNvbW1lbnQtcHJvbG9nIGNoYXIgc2VxdWVuY2UgKCMxMDA5OCk7IG11c3QgYXBwZWFzZSBsaW50IGFuZCBldmFkZSBjb21wcmVzc2lvblxuICAgICAgICBhbGxUeXBlcyA9IFtcIiovXCJdICsgW1wiKlwiXTtcblxuLy8gIzgxMzgsIElFIG1heSB0aHJvdyBhbiBleGNlcHRpb24gd2hlbiBhY2Nlc3Npbmdcbi8vIGEgZmllbGQgZnJvbSB3aW5kb3cubG9jYXRpb24gaWYgZG9jdW1lbnQuZG9tYWluIGhhcyBiZWVuIHNldFxuICAgIHRyeSB7XG4gICAgICAgIGFqYXhMb2NhdGlvbiA9IGxvY2F0aW9uLmhyZWY7XG4gICAgfSBjYXRjaCggZSApIHtcbiAgICAgICAgLy8gVXNlIHRoZSBocmVmIGF0dHJpYnV0ZSBvZiBhbiBBIGVsZW1lbnRcbiAgICAgICAgLy8gc2luY2UgSUUgd2lsbCBtb2RpZnkgaXQgZ2l2ZW4gZG9jdW1lbnQubG9jYXRpb25cbiAgICAgICAgYWpheExvY2F0aW9uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCggXCJhXCIgKTtcbiAgICAgICAgYWpheExvY2F0aW9uLmhyZWYgPSBcIlwiO1xuICAgICAgICBhamF4TG9jYXRpb24gPSBhamF4TG9jYXRpb24uaHJlZjtcbiAgICB9XG5cbi8vIFNlZ21lbnQgbG9jYXRpb24gaW50byBwYXJ0c1xuICAgIGFqYXhMb2NQYXJ0cyA9IHJ1cmwuZXhlYyggYWpheExvY2F0aW9uLnRvTG93ZXJDYXNlKCkgKSB8fCBbXTtcblxuLy8gQmFzZSBcImNvbnN0cnVjdG9yXCIgZm9yIGpRdWVyeS5hamF4UHJlZmlsdGVyIGFuZCBqUXVlcnkuYWpheFRyYW5zcG9ydFxuICAgIGZ1bmN0aW9uIGFkZFRvUHJlZmlsdGVyc09yVHJhbnNwb3J0cyggc3RydWN0dXJlICkge1xuXG4gICAgICAgIC8vIGRhdGFUeXBlRXhwcmVzc2lvbiBpcyBvcHRpb25hbCBhbmQgZGVmYXVsdHMgdG8gXCIqXCJcbiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKCBkYXRhVHlwZUV4cHJlc3Npb24sIGZ1bmMgKSB7XG5cbiAgICAgICAgICAgIGlmICggdHlwZW9mIGRhdGFUeXBlRXhwcmVzc2lvbiAhPT0gXCJzdHJpbmdcIiApIHtcbiAgICAgICAgICAgICAgICBmdW5jID0gZGF0YVR5cGVFeHByZXNzaW9uO1xuICAgICAgICAgICAgICAgIGRhdGFUeXBlRXhwcmVzc2lvbiA9IFwiKlwiO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoIGpRdWVyeS5pc0Z1bmN0aW9uKCBmdW5jICkgKSB7XG4gICAgICAgICAgICAgICAgdmFyIGRhdGFUeXBlcyA9IGRhdGFUeXBlRXhwcmVzc2lvbi50b0xvd2VyQ2FzZSgpLnNwbGl0KCByc3BhY2VzQWpheCApLFxuICAgICAgICAgICAgICAgICAgICBpID0gMCxcbiAgICAgICAgICAgICAgICAgICAgbGVuZ3RoID0gZGF0YVR5cGVzLmxlbmd0aCxcbiAgICAgICAgICAgICAgICAgICAgZGF0YVR5cGUsXG4gICAgICAgICAgICAgICAgICAgIGxpc3QsXG4gICAgICAgICAgICAgICAgICAgIHBsYWNlQmVmb3JlO1xuXG4gICAgICAgICAgICAgICAgLy8gRm9yIGVhY2ggZGF0YVR5cGUgaW4gdGhlIGRhdGFUeXBlRXhwcmVzc2lvblxuICAgICAgICAgICAgICAgIGZvciAoIDsgaSA8IGxlbmd0aDsgaSsrICkge1xuICAgICAgICAgICAgICAgICAgICBkYXRhVHlwZSA9IGRhdGFUeXBlc1sgaSBdO1xuICAgICAgICAgICAgICAgICAgICAvLyBXZSBjb250cm9sIGlmIHdlJ3JlIGFza2VkIHRvIGFkZCBiZWZvcmVcbiAgICAgICAgICAgICAgICAgICAgLy8gYW55IGV4aXN0aW5nIGVsZW1lbnRcbiAgICAgICAgICAgICAgICAgICAgcGxhY2VCZWZvcmUgPSAvXlxcKy8udGVzdCggZGF0YVR5cGUgKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCBwbGFjZUJlZm9yZSApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGFUeXBlID0gZGF0YVR5cGUuc3Vic3RyKCAxICkgfHwgXCIqXCI7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgbGlzdCA9IHN0cnVjdHVyZVsgZGF0YVR5cGUgXSA9IHN0cnVjdHVyZVsgZGF0YVR5cGUgXSB8fCBbXTtcbiAgICAgICAgICAgICAgICAgICAgLy8gdGhlbiB3ZSBhZGQgdG8gdGhlIHN0cnVjdHVyZSBhY2NvcmRpbmdseVxuICAgICAgICAgICAgICAgICAgICBsaXN0WyBwbGFjZUJlZm9yZSA/IFwidW5zaGlmdFwiIDogXCJwdXNoXCIgXSggZnVuYyApO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICB9XG5cbi8vIEJhc2UgaW5zcGVjdGlvbiBmdW5jdGlvbiBmb3IgcHJlZmlsdGVycyBhbmQgdHJhbnNwb3J0c1xuICAgIGZ1bmN0aW9uIGluc3BlY3RQcmVmaWx0ZXJzT3JUcmFuc3BvcnRzKCBzdHJ1Y3R1cmUsIG9wdGlvbnMsIG9yaWdpbmFsT3B0aW9ucywganFYSFIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGFUeXBlIC8qIGludGVybmFsICovLCBpbnNwZWN0ZWQgLyogaW50ZXJuYWwgKi8gKSB7XG5cbiAgICAgICAgZGF0YVR5cGUgPSBkYXRhVHlwZSB8fCBvcHRpb25zLmRhdGFUeXBlc1sgMCBdO1xuICAgICAgICBpbnNwZWN0ZWQgPSBpbnNwZWN0ZWQgfHwge307XG5cbiAgICAgICAgaW5zcGVjdGVkWyBkYXRhVHlwZSBdID0gdHJ1ZTtcblxuICAgICAgICB2YXIgbGlzdCA9IHN0cnVjdHVyZVsgZGF0YVR5cGUgXSxcbiAgICAgICAgICAgIGkgPSAwLFxuICAgICAgICAgICAgbGVuZ3RoID0gbGlzdCA/IGxpc3QubGVuZ3RoIDogMCxcbiAgICAgICAgICAgIGV4ZWN1dGVPbmx5ID0gKCBzdHJ1Y3R1cmUgPT09IHByZWZpbHRlcnMgKSxcbiAgICAgICAgICAgIHNlbGVjdGlvbjtcblxuICAgICAgICBmb3IgKCA7IGkgPCBsZW5ndGggJiYgKCBleGVjdXRlT25seSB8fCAhc2VsZWN0aW9uICk7IGkrKyApIHtcbiAgICAgICAgICAgIHNlbGVjdGlvbiA9IGxpc3RbIGkgXSggb3B0aW9ucywgb3JpZ2luYWxPcHRpb25zLCBqcVhIUiApO1xuICAgICAgICAgICAgLy8gSWYgd2UgZ290IHJlZGlyZWN0ZWQgdG8gYW5vdGhlciBkYXRhVHlwZVxuICAgICAgICAgICAgLy8gd2UgdHJ5IHRoZXJlIGlmIGV4ZWN1dGluZyBvbmx5IGFuZCBub3QgZG9uZSBhbHJlYWR5XG4gICAgICAgICAgICBpZiAoIHR5cGVvZiBzZWxlY3Rpb24gPT09IFwic3RyaW5nXCIgKSB7XG4gICAgICAgICAgICAgICAgaWYgKCAhZXhlY3V0ZU9ubHkgfHwgaW5zcGVjdGVkWyBzZWxlY3Rpb24gXSApIHtcbiAgICAgICAgICAgICAgICAgICAgc2VsZWN0aW9uID0gdW5kZWZpbmVkO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIG9wdGlvbnMuZGF0YVR5cGVzLnVuc2hpZnQoIHNlbGVjdGlvbiApO1xuICAgICAgICAgICAgICAgICAgICBzZWxlY3Rpb24gPSBpbnNwZWN0UHJlZmlsdGVyc09yVHJhbnNwb3J0cyhcbiAgICAgICAgICAgICAgICAgICAgICAgIHN0cnVjdHVyZSwgb3B0aW9ucywgb3JpZ2luYWxPcHRpb25zLCBqcVhIUiwgc2VsZWN0aW9uLCBpbnNwZWN0ZWQgKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgLy8gSWYgd2UncmUgb25seSBleGVjdXRpbmcgb3Igbm90aGluZyB3YXMgc2VsZWN0ZWRcbiAgICAgICAgLy8gd2UgdHJ5IHRoZSBjYXRjaGFsbCBkYXRhVHlwZSBpZiBub3QgZG9uZSBhbHJlYWR5XG4gICAgICAgIGlmICggKCBleGVjdXRlT25seSB8fCAhc2VsZWN0aW9uICkgJiYgIWluc3BlY3RlZFsgXCIqXCIgXSApIHtcbiAgICAgICAgICAgIHNlbGVjdGlvbiA9IGluc3BlY3RQcmVmaWx0ZXJzT3JUcmFuc3BvcnRzKFxuICAgICAgICAgICAgICAgIHN0cnVjdHVyZSwgb3B0aW9ucywgb3JpZ2luYWxPcHRpb25zLCBqcVhIUiwgXCIqXCIsIGluc3BlY3RlZCApO1xuICAgICAgICB9XG4gICAgICAgIC8vIHVubmVjZXNzYXJ5IHdoZW4gb25seSBleGVjdXRpbmcgKHByZWZpbHRlcnMpXG4gICAgICAgIC8vIGJ1dCBpdCdsbCBiZSBpZ25vcmVkIGJ5IHRoZSBjYWxsZXIgaW4gdGhhdCBjYXNlXG4gICAgICAgIHJldHVybiBzZWxlY3Rpb247XG4gICAgfVxuXG4vLyBBIHNwZWNpYWwgZXh0ZW5kIGZvciBhamF4IG9wdGlvbnNcbi8vIHRoYXQgdGFrZXMgXCJmbGF0XCIgb3B0aW9ucyAobm90IHRvIGJlIGRlZXAgZXh0ZW5kZWQpXG4vLyBGaXhlcyAjOTg4N1xuICAgIGZ1bmN0aW9uIGFqYXhFeHRlbmQoIHRhcmdldCwgc3JjICkge1xuICAgICAgICB2YXIga2V5LCBkZWVwLFxuICAgICAgICAgICAgZmxhdE9wdGlvbnMgPSBqUXVlcnkuYWpheFNldHRpbmdzLmZsYXRPcHRpb25zIHx8IHt9O1xuICAgICAgICBmb3IgKCBrZXkgaW4gc3JjICkge1xuICAgICAgICAgICAgaWYgKCBzcmNbIGtleSBdICE9PSB1bmRlZmluZWQgKSB7XG4gICAgICAgICAgICAgICAgKCBmbGF0T3B0aW9uc1sga2V5IF0gPyB0YXJnZXQgOiAoIGRlZXAgfHwgKCBkZWVwID0ge30gKSApIClbIGtleSBdID0gc3JjWyBrZXkgXTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBpZiAoIGRlZXAgKSB7XG4gICAgICAgICAgICBqUXVlcnkuZXh0ZW5kKCB0cnVlLCB0YXJnZXQsIGRlZXAgKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGpRdWVyeS5mbi5leHRlbmQoe1xuICAgICAgICBsb2FkOiBmdW5jdGlvbiggdXJsLCBwYXJhbXMsIGNhbGxiYWNrICkge1xuICAgICAgICAgICAgaWYgKCB0eXBlb2YgdXJsICE9PSBcInN0cmluZ1wiICYmIF9sb2FkICkge1xuICAgICAgICAgICAgICAgIHJldHVybiBfbG9hZC5hcHBseSggdGhpcywgYXJndW1lbnRzICk7XG5cbiAgICAgICAgICAgICAgICAvLyBEb24ndCBkbyBhIHJlcXVlc3QgaWYgbm8gZWxlbWVudHMgYXJlIGJlaW5nIHJlcXVlc3RlZFxuICAgICAgICAgICAgfSBlbHNlIGlmICggIXRoaXMubGVuZ3RoICkge1xuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB2YXIgb2ZmID0gdXJsLmluZGV4T2YoIFwiIFwiICk7XG4gICAgICAgICAgICBpZiAoIG9mZiA+PSAwICkge1xuICAgICAgICAgICAgICAgIHZhciBzZWxlY3RvciA9IHVybC5zbGljZSggb2ZmLCB1cmwubGVuZ3RoICk7XG4gICAgICAgICAgICAgICAgdXJsID0gdXJsLnNsaWNlKCAwLCBvZmYgKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gRGVmYXVsdCB0byBhIEdFVCByZXF1ZXN0XG4gICAgICAgICAgICB2YXIgdHlwZSA9IFwiR0VUXCI7XG5cbiAgICAgICAgICAgIC8vIElmIHRoZSBzZWNvbmQgcGFyYW1ldGVyIHdhcyBwcm92aWRlZFxuICAgICAgICAgICAgaWYgKCBwYXJhbXMgKSB7XG4gICAgICAgICAgICAgICAgLy8gSWYgaXQncyBhIGZ1bmN0aW9uXG4gICAgICAgICAgICAgICAgaWYgKCBqUXVlcnkuaXNGdW5jdGlvbiggcGFyYW1zICkgKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIFdlIGFzc3VtZSB0aGF0IGl0J3MgdGhlIGNhbGxiYWNrXG4gICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrID0gcGFyYW1zO1xuICAgICAgICAgICAgICAgICAgICBwYXJhbXMgPSB1bmRlZmluZWQ7XG5cbiAgICAgICAgICAgICAgICAgICAgLy8gT3RoZXJ3aXNlLCBidWlsZCBhIHBhcmFtIHN0cmluZ1xuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoIHR5cGVvZiBwYXJhbXMgPT09IFwib2JqZWN0XCIgKSB7XG4gICAgICAgICAgICAgICAgICAgIHBhcmFtcyA9IGpRdWVyeS5wYXJhbSggcGFyYW1zLCBqUXVlcnkuYWpheFNldHRpbmdzLnRyYWRpdGlvbmFsICk7XG4gICAgICAgICAgICAgICAgICAgIHR5cGUgPSBcIlBPU1RcIjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHZhciBzZWxmID0gdGhpcztcblxuICAgICAgICAgICAgLy8gUmVxdWVzdCB0aGUgcmVtb3RlIGRvY3VtZW50XG4gICAgICAgICAgICBqUXVlcnkuYWpheCh7XG4gICAgICAgICAgICAgICAgdXJsOiB1cmwsXG4gICAgICAgICAgICAgICAgdHlwZTogdHlwZSxcbiAgICAgICAgICAgICAgICBkYXRhVHlwZTogXCJodG1sXCIsXG4gICAgICAgICAgICAgICAgZGF0YTogcGFyYW1zLFxuICAgICAgICAgICAgICAgIC8vIENvbXBsZXRlIGNhbGxiYWNrIChyZXNwb25zZVRleHQgaXMgdXNlZCBpbnRlcm5hbGx5KVxuICAgICAgICAgICAgICAgIGNvbXBsZXRlOiBmdW5jdGlvbigganFYSFIsIHN0YXR1cywgcmVzcG9uc2VUZXh0ICkge1xuICAgICAgICAgICAgICAgICAgICAvLyBTdG9yZSB0aGUgcmVzcG9uc2UgYXMgc3BlY2lmaWVkIGJ5IHRoZSBqcVhIUiBvYmplY3RcbiAgICAgICAgICAgICAgICAgICAgcmVzcG9uc2VUZXh0ID0ganFYSFIucmVzcG9uc2VUZXh0O1xuICAgICAgICAgICAgICAgICAgICAvLyBJZiBzdWNjZXNzZnVsLCBpbmplY3QgdGhlIEhUTUwgaW50byBhbGwgdGhlIG1hdGNoZWQgZWxlbWVudHNcbiAgICAgICAgICAgICAgICAgICAgaWYgKCBqcVhIUi5pc1Jlc29sdmVkKCkgKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyAjNDgyNTogR2V0IHRoZSBhY3R1YWwgcmVzcG9uc2UgaW4gY2FzZVxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gYSBkYXRhRmlsdGVyIGlzIHByZXNlbnQgaW4gYWpheFNldHRpbmdzXG4gICAgICAgICAgICAgICAgICAgICAgICBqcVhIUi5kb25lKGZ1bmN0aW9uKCByICkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc3BvbnNlVGV4dCA9IHI7XG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFNlZSBpZiBhIHNlbGVjdG9yIHdhcyBzcGVjaWZpZWRcbiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuaHRtbCggc2VsZWN0b3IgP1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIENyZWF0ZSBhIGR1bW15IGRpdiB0byBob2xkIHRoZSByZXN1bHRzXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgalF1ZXJ5KFwiPGRpdj5cIilcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBpbmplY3QgdGhlIGNvbnRlbnRzIG9mIHRoZSBkb2N1bWVudCBpbiwgcmVtb3ZpbmcgdGhlIHNjcmlwdHNcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyB0byBhdm9pZCBhbnkgJ1Blcm1pc3Npb24gRGVuaWVkJyBlcnJvcnMgaW4gSUVcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLmFwcGVuZChyZXNwb25zZVRleHQucmVwbGFjZShyc2NyaXB0LCBcIlwiKSlcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBMb2NhdGUgdGhlIHNwZWNpZmllZCBlbGVtZW50c1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAuZmluZChzZWxlY3RvcikgOlxuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gSWYgbm90LCBqdXN0IGluamVjdCB0aGUgZnVsbCByZXN1bHRcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXNwb25zZVRleHQgKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIGlmICggY2FsbGJhY2sgKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmVhY2goIGNhbGxiYWNrLCBbIHJlc3BvbnNlVGV4dCwgc3RhdHVzLCBqcVhIUiBdICk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgICAgIH0sXG5cbiAgICAgICAgc2VyaWFsaXplOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHJldHVybiBqUXVlcnkucGFyYW0oIHRoaXMuc2VyaWFsaXplQXJyYXkoKSApO1xuICAgICAgICB9LFxuXG4gICAgICAgIHNlcmlhbGl6ZUFycmF5OiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLm1hcChmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmVsZW1lbnRzID8galF1ZXJ5Lm1ha2VBcnJheSggdGhpcy5lbGVtZW50cyApIDogdGhpcztcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgLmZpbHRlcihmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5uYW1lICYmICF0aGlzLmRpc2FibGVkICYmXG4gICAgICAgICAgICAgICAgICAgICAgICAoIHRoaXMuY2hlY2tlZCB8fCByc2VsZWN0VGV4dGFyZWEudGVzdCggdGhpcy5ub2RlTmFtZSApIHx8XG4gICAgICAgICAgICAgICAgICAgICAgICByaW5wdXQudGVzdCggdGhpcy50eXBlICkgKTtcbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgIC5tYXAoZnVuY3Rpb24oIGksIGVsZW0gKXtcbiAgICAgICAgICAgICAgICAgICAgdmFyIHZhbCA9IGpRdWVyeSggdGhpcyApLnZhbCgpO1xuXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB2YWwgPT0gbnVsbCA/XG4gICAgICAgICAgICAgICAgICAgICAgICBudWxsIDpcbiAgICAgICAgICAgICAgICAgICAgICAgIGpRdWVyeS5pc0FycmF5KCB2YWwgKSA/XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgalF1ZXJ5Lm1hcCggdmFsLCBmdW5jdGlvbiggdmFsLCBpICl7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB7IG5hbWU6IGVsZW0ubmFtZSwgdmFsdWU6IHZhbC5yZXBsYWNlKCByQ1JMRiwgXCJcXHJcXG5cIiApIH07XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSkgOlxuICAgICAgICAgICAgICAgICAgICAgICAgeyBuYW1lOiBlbGVtLm5hbWUsIHZhbHVlOiB2YWwucmVwbGFjZSggckNSTEYsIFwiXFxyXFxuXCIgKSB9O1xuICAgICAgICAgICAgICAgIH0pLmdldCgpO1xuICAgICAgICB9XG4gICAgfSk7XG5cbi8vIEF0dGFjaCBhIGJ1bmNoIG9mIGZ1bmN0aW9ucyBmb3IgaGFuZGxpbmcgY29tbW9uIEFKQVggZXZlbnRzXG4gICAgalF1ZXJ5LmVhY2goIFwiYWpheFN0YXJ0IGFqYXhTdG9wIGFqYXhDb21wbGV0ZSBhamF4RXJyb3IgYWpheFN1Y2Nlc3MgYWpheFNlbmRcIi5zcGxpdCggXCIgXCIgKSwgZnVuY3Rpb24oIGksIG8gKXtcbiAgICAgICAgalF1ZXJ5LmZuWyBvIF0gPSBmdW5jdGlvbiggZiApe1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMub24oIG8sIGYgKTtcbiAgICAgICAgfTtcbiAgICB9KTtcblxuICAgIGpRdWVyeS5lYWNoKCBbIFwiZ2V0XCIsIFwicG9zdFwiIF0sIGZ1bmN0aW9uKCBpLCBtZXRob2QgKSB7XG4gICAgICAgIGpRdWVyeVsgbWV0aG9kIF0gPSBmdW5jdGlvbiggdXJsLCBkYXRhLCBjYWxsYmFjaywgdHlwZSApIHtcbiAgICAgICAgICAgIC8vIHNoaWZ0IGFyZ3VtZW50cyBpZiBkYXRhIGFyZ3VtZW50IHdhcyBvbWl0dGVkXG4gICAgICAgICAgICBpZiAoIGpRdWVyeS5pc0Z1bmN0aW9uKCBkYXRhICkgKSB7XG4gICAgICAgICAgICAgICAgdHlwZSA9IHR5cGUgfHwgY2FsbGJhY2s7XG4gICAgICAgICAgICAgICAgY2FsbGJhY2sgPSBkYXRhO1xuICAgICAgICAgICAgICAgIGRhdGEgPSB1bmRlZmluZWQ7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHJldHVybiBqUXVlcnkuYWpheCh7XG4gICAgICAgICAgICAgICAgdHlwZTogbWV0aG9kLFxuICAgICAgICAgICAgICAgIHVybDogdXJsLFxuICAgICAgICAgICAgICAgIGRhdGE6IGRhdGEsXG4gICAgICAgICAgICAgICAgc3VjY2VzczogY2FsbGJhY2ssXG4gICAgICAgICAgICAgICAgZGF0YVR5cGU6IHR5cGVcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9O1xuICAgIH0pO1xuXG4gICAgalF1ZXJ5LmV4dGVuZCh7XG5cbiAgICAgICAgZ2V0U2NyaXB0OiBmdW5jdGlvbiggdXJsLCBjYWxsYmFjayApIHtcbiAgICAgICAgICAgIHJldHVybiBqUXVlcnkuZ2V0KCB1cmwsIHVuZGVmaW5lZCwgY2FsbGJhY2ssIFwic2NyaXB0XCIgKTtcbiAgICAgICAgfSxcblxuICAgICAgICBnZXRKU09OOiBmdW5jdGlvbiggdXJsLCBkYXRhLCBjYWxsYmFjayApIHtcbiAgICAgICAgICAgIHJldHVybiBqUXVlcnkuZ2V0KCB1cmwsIGRhdGEsIGNhbGxiYWNrLCBcImpzb25cIiApO1xuICAgICAgICB9LFxuXG4gICAgICAgIC8vIENyZWF0ZXMgYSBmdWxsIGZsZWRnZWQgc2V0dGluZ3Mgb2JqZWN0IGludG8gdGFyZ2V0XG4gICAgICAgIC8vIHdpdGggYm90aCBhamF4U2V0dGluZ3MgYW5kIHNldHRpbmdzIGZpZWxkcy5cbiAgICAgICAgLy8gSWYgdGFyZ2V0IGlzIG9taXR0ZWQsIHdyaXRlcyBpbnRvIGFqYXhTZXR0aW5ncy5cbiAgICAgICAgYWpheFNldHVwOiBmdW5jdGlvbiggdGFyZ2V0LCBzZXR0aW5ncyApIHtcbiAgICAgICAgICAgIGlmICggc2V0dGluZ3MgKSB7XG4gICAgICAgICAgICAgICAgLy8gQnVpbGRpbmcgYSBzZXR0aW5ncyBvYmplY3RcbiAgICAgICAgICAgICAgICBhamF4RXh0ZW5kKCB0YXJnZXQsIGpRdWVyeS5hamF4U2V0dGluZ3MgKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgLy8gRXh0ZW5kaW5nIGFqYXhTZXR0aW5nc1xuICAgICAgICAgICAgICAgIHNldHRpbmdzID0gdGFyZ2V0O1xuICAgICAgICAgICAgICAgIHRhcmdldCA9IGpRdWVyeS5hamF4U2V0dGluZ3M7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBhamF4RXh0ZW5kKCB0YXJnZXQsIHNldHRpbmdzICk7XG4gICAgICAgICAgICByZXR1cm4gdGFyZ2V0O1xuICAgICAgICB9LFxuXG4gICAgICAgIGFqYXhTZXR0aW5nczoge1xuICAgICAgICAgICAgdXJsOiBhamF4TG9jYXRpb24sXG4gICAgICAgICAgICBpc0xvY2FsOiBybG9jYWxQcm90b2NvbC50ZXN0KCBhamF4TG9jUGFydHNbIDEgXSApLFxuICAgICAgICAgICAgZ2xvYmFsOiB0cnVlLFxuICAgICAgICAgICAgdHlwZTogXCJHRVRcIixcbiAgICAgICAgICAgIGNvbnRlbnRUeXBlOiBcImFwcGxpY2F0aW9uL3gtd3d3LWZvcm0tdXJsZW5jb2RlZFwiLFxuICAgICAgICAgICAgcHJvY2Vzc0RhdGE6IHRydWUsXG4gICAgICAgICAgICBhc3luYzogdHJ1ZSxcbiAgICAgICAgICAgIC8qXG4gICAgICAgICAgICAgdGltZW91dDogMCxcbiAgICAgICAgICAgICBkYXRhOiBudWxsLFxuICAgICAgICAgICAgIGRhdGFUeXBlOiBudWxsLFxuICAgICAgICAgICAgIHVzZXJuYW1lOiBudWxsLFxuICAgICAgICAgICAgIHBhc3N3b3JkOiBudWxsLFxuICAgICAgICAgICAgIGNhY2hlOiBudWxsLFxuICAgICAgICAgICAgIHRyYWRpdGlvbmFsOiBmYWxzZSxcbiAgICAgICAgICAgICBoZWFkZXJzOiB7fSxcbiAgICAgICAgICAgICAqL1xuXG4gICAgICAgICAgICBhY2NlcHRzOiB7XG4gICAgICAgICAgICAgICAgeG1sOiBcImFwcGxpY2F0aW9uL3htbCwgdGV4dC94bWxcIixcbiAgICAgICAgICAgICAgICBodG1sOiBcInRleHQvaHRtbFwiLFxuICAgICAgICAgICAgICAgIHRleHQ6IFwidGV4dC9wbGFpblwiLFxuICAgICAgICAgICAgICAgIGpzb246IFwiYXBwbGljYXRpb24vanNvbiwgdGV4dC9qYXZhc2NyaXB0XCIsXG4gICAgICAgICAgICAgICAgXCIqXCI6IGFsbFR5cGVzXG4gICAgICAgICAgICB9LFxuXG4gICAgICAgICAgICBjb250ZW50czoge1xuICAgICAgICAgICAgICAgIHhtbDogL3htbC8sXG4gICAgICAgICAgICAgICAgaHRtbDogL2h0bWwvLFxuICAgICAgICAgICAgICAgIGpzb246IC9qc29uL1xuICAgICAgICAgICAgfSxcblxuICAgICAgICAgICAgcmVzcG9uc2VGaWVsZHM6IHtcbiAgICAgICAgICAgICAgICB4bWw6IFwicmVzcG9uc2VYTUxcIixcbiAgICAgICAgICAgICAgICB0ZXh0OiBcInJlc3BvbnNlVGV4dFwiXG4gICAgICAgICAgICB9LFxuXG4gICAgICAgICAgICAvLyBMaXN0IG9mIGRhdGEgY29udmVydGVyc1xuICAgICAgICAgICAgLy8gMSkga2V5IGZvcm1hdCBpcyBcInNvdXJjZV90eXBlIGRlc3RpbmF0aW9uX3R5cGVcIiAoYSBzaW5nbGUgc3BhY2UgaW4tYmV0d2VlbilcbiAgICAgICAgICAgIC8vIDIpIHRoZSBjYXRjaGFsbCBzeW1ib2wgXCIqXCIgY2FuIGJlIHVzZWQgZm9yIHNvdXJjZV90eXBlXG4gICAgICAgICAgICBjb252ZXJ0ZXJzOiB7XG5cbiAgICAgICAgICAgICAgICAvLyBDb252ZXJ0IGFueXRoaW5nIHRvIHRleHRcbiAgICAgICAgICAgICAgICBcIiogdGV4dFwiOiB3aW5kb3cuU3RyaW5nLFxuXG4gICAgICAgICAgICAgICAgLy8gVGV4dCB0byBodG1sICh0cnVlID0gbm8gdHJhbnNmb3JtYXRpb24pXG4gICAgICAgICAgICAgICAgXCJ0ZXh0IGh0bWxcIjogdHJ1ZSxcblxuICAgICAgICAgICAgICAgIC8vIEV2YWx1YXRlIHRleHQgYXMgYSBqc29uIGV4cHJlc3Npb25cbiAgICAgICAgICAgICAgICBcInRleHQganNvblwiOiBqUXVlcnkucGFyc2VKU09OLFxuXG4gICAgICAgICAgICAgICAgLy8gUGFyc2UgdGV4dCBhcyB4bWxcbiAgICAgICAgICAgICAgICBcInRleHQgeG1sXCI6IGpRdWVyeS5wYXJzZVhNTFxuICAgICAgICAgICAgfSxcblxuICAgICAgICAgICAgLy8gRm9yIG9wdGlvbnMgdGhhdCBzaG91bGRuJ3QgYmUgZGVlcCBleHRlbmRlZDpcbiAgICAgICAgICAgIC8vIHlvdSBjYW4gYWRkIHlvdXIgb3duIGN1c3RvbSBvcHRpb25zIGhlcmUgaWZcbiAgICAgICAgICAgIC8vIGFuZCB3aGVuIHlvdSBjcmVhdGUgb25lIHRoYXQgc2hvdWxkbid0IGJlXG4gICAgICAgICAgICAvLyBkZWVwIGV4dGVuZGVkIChzZWUgYWpheEV4dGVuZClcbiAgICAgICAgICAgIGZsYXRPcHRpb25zOiB7XG4gICAgICAgICAgICAgICAgY29udGV4dDogdHJ1ZSxcbiAgICAgICAgICAgICAgICB1cmw6IHRydWVcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcblxuICAgICAgICBhamF4UHJlZmlsdGVyOiBhZGRUb1ByZWZpbHRlcnNPclRyYW5zcG9ydHMoIHByZWZpbHRlcnMgKSxcbiAgICAgICAgYWpheFRyYW5zcG9ydDogYWRkVG9QcmVmaWx0ZXJzT3JUcmFuc3BvcnRzKCB0cmFuc3BvcnRzICksXG5cbiAgICAgICAgLy8gTWFpbiBtZXRob2RcbiAgICAgICAgYWpheDogZnVuY3Rpb24oIHVybCwgb3B0aW9ucyApIHtcblxuICAgICAgICAgICAgLy8gSWYgdXJsIGlzIGFuIG9iamVjdCwgc2ltdWxhdGUgcHJlLTEuNSBzaWduYXR1cmVcbiAgICAgICAgICAgIGlmICggdHlwZW9mIHVybCA9PT0gXCJvYmplY3RcIiApIHtcbiAgICAgICAgICAgICAgICBvcHRpb25zID0gdXJsO1xuICAgICAgICAgICAgICAgIHVybCA9IHVuZGVmaW5lZDtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gRm9yY2Ugb3B0aW9ucyB0byBiZSBhbiBvYmplY3RcbiAgICAgICAgICAgIG9wdGlvbnMgPSBvcHRpb25zIHx8IHt9O1xuXG4gICAgICAgICAgICB2YXIgLy8gQ3JlYXRlIHRoZSBmaW5hbCBvcHRpb25zIG9iamVjdFxuICAgICAgICAgICAgICAgIHMgPSBqUXVlcnkuYWpheFNldHVwKCB7fSwgb3B0aW9ucyApLFxuICAgICAgICAgICAgLy8gQ2FsbGJhY2tzIGNvbnRleHRcbiAgICAgICAgICAgICAgICBjYWxsYmFja0NvbnRleHQgPSBzLmNvbnRleHQgfHwgcyxcbiAgICAgICAgICAgIC8vIENvbnRleHQgZm9yIGdsb2JhbCBldmVudHNcbiAgICAgICAgICAgIC8vIEl0J3MgdGhlIGNhbGxiYWNrQ29udGV4dCBpZiBvbmUgd2FzIHByb3ZpZGVkIGluIHRoZSBvcHRpb25zXG4gICAgICAgICAgICAvLyBhbmQgaWYgaXQncyBhIERPTSBub2RlIG9yIGEgalF1ZXJ5IGNvbGxlY3Rpb25cbiAgICAgICAgICAgICAgICBnbG9iYWxFdmVudENvbnRleHQgPSBjYWxsYmFja0NvbnRleHQgIT09IHMgJiZcbiAgICAgICAgICAgICAgICAoIGNhbGxiYWNrQ29udGV4dC5ub2RlVHlwZSB8fCBjYWxsYmFja0NvbnRleHQgaW5zdGFuY2VvZiBqUXVlcnkgKSA/XG4gICAgICAgICAgICAgICAgICAgIGpRdWVyeSggY2FsbGJhY2tDb250ZXh0ICkgOiBqUXVlcnkuZXZlbnQsXG4gICAgICAgICAgICAvLyBEZWZlcnJlZHNcbiAgICAgICAgICAgICAgICBkZWZlcnJlZCA9IGpRdWVyeS5EZWZlcnJlZCgpLFxuICAgICAgICAgICAgICAgIGNvbXBsZXRlRGVmZXJyZWQgPSBqUXVlcnkuQ2FsbGJhY2tzKCBcIm9uY2UgbWVtb3J5XCIgKSxcbiAgICAgICAgICAgIC8vIFN0YXR1cy1kZXBlbmRlbnQgY2FsbGJhY2tzXG4gICAgICAgICAgICAgICAgc3RhdHVzQ29kZSA9IHMuc3RhdHVzQ29kZSB8fCB7fSxcbiAgICAgICAgICAgIC8vIGlmTW9kaWZpZWQga2V5XG4gICAgICAgICAgICAgICAgaWZNb2RpZmllZEtleSxcbiAgICAgICAgICAgIC8vIEhlYWRlcnMgKHRoZXkgYXJlIHNlbnQgYWxsIGF0IG9uY2UpXG4gICAgICAgICAgICAgICAgcmVxdWVzdEhlYWRlcnMgPSB7fSxcbiAgICAgICAgICAgICAgICByZXF1ZXN0SGVhZGVyc05hbWVzID0ge30sXG4gICAgICAgICAgICAvLyBSZXNwb25zZSBoZWFkZXJzXG4gICAgICAgICAgICAgICAgcmVzcG9uc2VIZWFkZXJzU3RyaW5nLFxuICAgICAgICAgICAgICAgIHJlc3BvbnNlSGVhZGVycyxcbiAgICAgICAgICAgIC8vIHRyYW5zcG9ydFxuICAgICAgICAgICAgICAgIHRyYW5zcG9ydCxcbiAgICAgICAgICAgIC8vIHRpbWVvdXQgaGFuZGxlXG4gICAgICAgICAgICAgICAgdGltZW91dFRpbWVyLFxuICAgICAgICAgICAgLy8gQ3Jvc3MtZG9tYWluIGRldGVjdGlvbiB2YXJzXG4gICAgICAgICAgICAgICAgcGFydHMsXG4gICAgICAgICAgICAvLyBUaGUganFYSFIgc3RhdGVcbiAgICAgICAgICAgICAgICBzdGF0ZSA9IDAsXG4gICAgICAgICAgICAvLyBUbyBrbm93IGlmIGdsb2JhbCBldmVudHMgYXJlIHRvIGJlIGRpc3BhdGNoZWRcbiAgICAgICAgICAgICAgICBmaXJlR2xvYmFscyxcbiAgICAgICAgICAgIC8vIExvb3AgdmFyaWFibGVcbiAgICAgICAgICAgICAgICBpLFxuICAgICAgICAgICAgLy8gRmFrZSB4aHJcbiAgICAgICAgICAgICAgICBqcVhIUiA9IHtcblxuICAgICAgICAgICAgICAgICAgICByZWFkeVN0YXRlOiAwLFxuXG4gICAgICAgICAgICAgICAgICAgIC8vIENhY2hlcyB0aGUgaGVhZGVyXG4gICAgICAgICAgICAgICAgICAgIHNldFJlcXVlc3RIZWFkZXI6IGZ1bmN0aW9uKCBuYW1lLCB2YWx1ZSApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICggIXN0YXRlICkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBsbmFtZSA9IG5hbWUudG9Mb3dlckNhc2UoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBuYW1lID0gcmVxdWVzdEhlYWRlcnNOYW1lc1sgbG5hbWUgXSA9IHJlcXVlc3RIZWFkZXJzTmFtZXNbIGxuYW1lIF0gfHwgbmFtZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXF1ZXN0SGVhZGVyc1sgbmFtZSBdID0gdmFsdWU7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcztcbiAgICAgICAgICAgICAgICAgICAgfSxcblxuICAgICAgICAgICAgICAgICAgICAvLyBSYXcgc3RyaW5nXG4gICAgICAgICAgICAgICAgICAgIGdldEFsbFJlc3BvbnNlSGVhZGVyczogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gc3RhdGUgPT09IDIgPyByZXNwb25zZUhlYWRlcnNTdHJpbmcgOiBudWxsO1xuICAgICAgICAgICAgICAgICAgICB9LFxuXG4gICAgICAgICAgICAgICAgICAgIC8vIEJ1aWxkcyBoZWFkZXJzIGhhc2h0YWJsZSBpZiBuZWVkZWRcbiAgICAgICAgICAgICAgICAgICAgZ2V0UmVzcG9uc2VIZWFkZXI6IGZ1bmN0aW9uKCBrZXkgKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgbWF0Y2g7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoIHN0YXRlID09PSAyICkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICggIXJlc3BvbnNlSGVhZGVycyApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzcG9uc2VIZWFkZXJzID0ge307XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdoaWxlKCAoIG1hdGNoID0gcmhlYWRlcnMuZXhlYyggcmVzcG9uc2VIZWFkZXJzU3RyaW5nICkgKSApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc3BvbnNlSGVhZGVyc1sgbWF0Y2hbMV0udG9Mb3dlckNhc2UoKSBdID0gbWF0Y2hbIDIgXTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtYXRjaCA9IHJlc3BvbnNlSGVhZGVyc1sga2V5LnRvTG93ZXJDYXNlKCkgXTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBtYXRjaCA9PT0gdW5kZWZpbmVkID8gbnVsbCA6IG1hdGNoO1xuICAgICAgICAgICAgICAgICAgICB9LFxuXG4gICAgICAgICAgICAgICAgICAgIC8vIE92ZXJyaWRlcyByZXNwb25zZSBjb250ZW50LXR5cGUgaGVhZGVyXG4gICAgICAgICAgICAgICAgICAgIG92ZXJyaWRlTWltZVR5cGU6IGZ1bmN0aW9uKCB0eXBlICkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCAhc3RhdGUgKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcy5taW1lVHlwZSA9IHR5cGU7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcztcbiAgICAgICAgICAgICAgICAgICAgfSxcblxuICAgICAgICAgICAgICAgICAgICAvLyBDYW5jZWwgdGhlIHJlcXVlc3RcbiAgICAgICAgICAgICAgICAgICAgYWJvcnQ6IGZ1bmN0aW9uKCBzdGF0dXNUZXh0ICkge1xuICAgICAgICAgICAgICAgICAgICAgICAgc3RhdHVzVGV4dCA9IHN0YXR1c1RleHQgfHwgXCJhYm9ydFwiO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCB0cmFuc3BvcnQgKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJhbnNwb3J0LmFib3J0KCBzdGF0dXNUZXh0ICk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBkb25lKCAwLCBzdGF0dXNUZXh0ICk7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcztcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIC8vIENhbGxiYWNrIGZvciB3aGVuIGV2ZXJ5dGhpbmcgaXMgZG9uZVxuICAgICAgICAgICAgLy8gSXQgaXMgZGVmaW5lZCBoZXJlIGJlY2F1c2UganNsaW50IGNvbXBsYWlucyBpZiBpdCBpcyBkZWNsYXJlZFxuICAgICAgICAgICAgLy8gYXQgdGhlIGVuZCBvZiB0aGUgZnVuY3Rpb24gKHdoaWNoIHdvdWxkIGJlIG1vcmUgbG9naWNhbCBhbmQgcmVhZGFibGUpXG4gICAgICAgICAgICBmdW5jdGlvbiBkb25lKCBzdGF0dXMsIG5hdGl2ZVN0YXR1c1RleHQsIHJlc3BvbnNlcywgaGVhZGVycyApIHtcblxuICAgICAgICAgICAgICAgIC8vIENhbGxlZCBvbmNlXG4gICAgICAgICAgICAgICAgaWYgKCBzdGF0ZSA9PT0gMiApIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIC8vIFN0YXRlIGlzIFwiZG9uZVwiIG5vd1xuICAgICAgICAgICAgICAgIHN0YXRlID0gMjtcblxuICAgICAgICAgICAgICAgIC8vIENsZWFyIHRpbWVvdXQgaWYgaXQgZXhpc3RzXG4gICAgICAgICAgICAgICAgaWYgKCB0aW1lb3V0VGltZXIgKSB7XG4gICAgICAgICAgICAgICAgICAgIGNsZWFyVGltZW91dCggdGltZW91dFRpbWVyICk7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgLy8gRGVyZWZlcmVuY2UgdHJhbnNwb3J0IGZvciBlYXJseSBnYXJiYWdlIGNvbGxlY3Rpb25cbiAgICAgICAgICAgICAgICAvLyAobm8gbWF0dGVyIGhvdyBsb25nIHRoZSBqcVhIUiBvYmplY3Qgd2lsbCBiZSB1c2VkKVxuICAgICAgICAgICAgICAgIHRyYW5zcG9ydCA9IHVuZGVmaW5lZDtcblxuICAgICAgICAgICAgICAgIC8vIENhY2hlIHJlc3BvbnNlIGhlYWRlcnNcbiAgICAgICAgICAgICAgICByZXNwb25zZUhlYWRlcnNTdHJpbmcgPSBoZWFkZXJzIHx8IFwiXCI7XG5cbiAgICAgICAgICAgICAgICAvLyBTZXQgcmVhZHlTdGF0ZVxuICAgICAgICAgICAgICAgIGpxWEhSLnJlYWR5U3RhdGUgPSBzdGF0dXMgPiAwID8gNCA6IDA7XG5cbiAgICAgICAgICAgICAgICB2YXIgaXNTdWNjZXNzLFxuICAgICAgICAgICAgICAgICAgICBzdWNjZXNzLFxuICAgICAgICAgICAgICAgICAgICBlcnJvcixcbiAgICAgICAgICAgICAgICAgICAgc3RhdHVzVGV4dCA9IG5hdGl2ZVN0YXR1c1RleHQsXG4gICAgICAgICAgICAgICAgICAgIHJlc3BvbnNlID0gcmVzcG9uc2VzID8gYWpheEhhbmRsZVJlc3BvbnNlcyggcywganFYSFIsIHJlc3BvbnNlcyApIDogdW5kZWZpbmVkLFxuICAgICAgICAgICAgICAgICAgICBsYXN0TW9kaWZpZWQsXG4gICAgICAgICAgICAgICAgICAgIGV0YWc7XG5cbiAgICAgICAgICAgICAgICAvLyBJZiBzdWNjZXNzZnVsLCBoYW5kbGUgdHlwZSBjaGFpbmluZ1xuICAgICAgICAgICAgICAgIGlmICggc3RhdHVzID49IDIwMCAmJiBzdGF0dXMgPCAzMDAgfHwgc3RhdHVzID09PSAzMDQgKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgLy8gU2V0IHRoZSBJZi1Nb2RpZmllZC1TaW5jZSBhbmQvb3IgSWYtTm9uZS1NYXRjaCBoZWFkZXIsIGlmIGluIGlmTW9kaWZpZWQgbW9kZS5cbiAgICAgICAgICAgICAgICAgICAgaWYgKCBzLmlmTW9kaWZpZWQgKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICggKCBsYXN0TW9kaWZpZWQgPSBqcVhIUi5nZXRSZXNwb25zZUhlYWRlciggXCJMYXN0LU1vZGlmaWVkXCIgKSApICkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGpRdWVyeS5sYXN0TW9kaWZpZWRbIGlmTW9kaWZpZWRLZXkgXSA9IGxhc3RNb2RpZmllZDtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICggKCBldGFnID0ganFYSFIuZ2V0UmVzcG9uc2VIZWFkZXIoIFwiRXRhZ1wiICkgKSApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBqUXVlcnkuZXRhZ1sgaWZNb2RpZmllZEtleSBdID0gZXRhZztcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIC8vIElmIG5vdCBtb2RpZmllZFxuICAgICAgICAgICAgICAgICAgICBpZiAoIHN0YXR1cyA9PT0gMzA0ICkge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBzdGF0dXNUZXh0ID0gXCJub3Rtb2RpZmllZFwiO1xuICAgICAgICAgICAgICAgICAgICAgICAgaXNTdWNjZXNzID0gdHJ1ZTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gSWYgd2UgaGF2ZSBkYXRhXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc3VjY2VzcyA9IGFqYXhDb252ZXJ0KCBzLCByZXNwb25zZSApO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YXR1c1RleHQgPSBcInN1Y2Nlc3NcIjtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpc1N1Y2Nlc3MgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSBjYXRjaChlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gV2UgaGF2ZSBhIHBhcnNlcmVycm9yXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhdHVzVGV4dCA9IFwicGFyc2VyZXJyb3JcIjtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlcnJvciA9IGU7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAvLyBXZSBleHRyYWN0IGVycm9yIGZyb20gc3RhdHVzVGV4dFxuICAgICAgICAgICAgICAgICAgICAvLyB0aGVuIG5vcm1hbGl6ZSBzdGF0dXNUZXh0IGFuZCBzdGF0dXMgZm9yIG5vbi1hYm9ydHNcbiAgICAgICAgICAgICAgICAgICAgZXJyb3IgPSBzdGF0dXNUZXh0O1xuICAgICAgICAgICAgICAgICAgICBpZiAoICFzdGF0dXNUZXh0IHx8IHN0YXR1cyApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHN0YXR1c1RleHQgPSBcImVycm9yXCI7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoIHN0YXR1cyA8IDAgKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhdHVzID0gMDtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIC8vIFNldCBkYXRhIGZvciB0aGUgZmFrZSB4aHIgb2JqZWN0XG4gICAgICAgICAgICAgICAganFYSFIuc3RhdHVzID0gc3RhdHVzO1xuICAgICAgICAgICAgICAgIGpxWEhSLnN0YXR1c1RleHQgPSBcIlwiICsgKCBuYXRpdmVTdGF0dXNUZXh0IHx8IHN0YXR1c1RleHQgKTtcblxuICAgICAgICAgICAgICAgIC8vIFN1Y2Nlc3MvRXJyb3JcbiAgICAgICAgICAgICAgICBpZiAoIGlzU3VjY2VzcyApIHtcbiAgICAgICAgICAgICAgICAgICAgZGVmZXJyZWQucmVzb2x2ZVdpdGgoIGNhbGxiYWNrQ29udGV4dCwgWyBzdWNjZXNzLCBzdGF0dXNUZXh0LCBqcVhIUiBdICk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgZGVmZXJyZWQucmVqZWN0V2l0aCggY2FsbGJhY2tDb250ZXh0LCBbIGpxWEhSLCBzdGF0dXNUZXh0LCBlcnJvciBdICk7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgLy8gU3RhdHVzLWRlcGVuZGVudCBjYWxsYmFja3NcbiAgICAgICAgICAgICAgICBqcVhIUi5zdGF0dXNDb2RlKCBzdGF0dXNDb2RlICk7XG4gICAgICAgICAgICAgICAgc3RhdHVzQ29kZSA9IHVuZGVmaW5lZDtcblxuICAgICAgICAgICAgICAgIGlmICggZmlyZUdsb2JhbHMgKSB7XG4gICAgICAgICAgICAgICAgICAgIGdsb2JhbEV2ZW50Q29udGV4dC50cmlnZ2VyKCBcImFqYXhcIiArICggaXNTdWNjZXNzID8gXCJTdWNjZXNzXCIgOiBcIkVycm9yXCIgKSxcbiAgICAgICAgICAgICAgICAgICAgICAgIFsganFYSFIsIHMsIGlzU3VjY2VzcyA/IHN1Y2Nlc3MgOiBlcnJvciBdICk7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgLy8gQ29tcGxldGVcbiAgICAgICAgICAgICAgICBjb21wbGV0ZURlZmVycmVkLmZpcmVXaXRoKCBjYWxsYmFja0NvbnRleHQsIFsganFYSFIsIHN0YXR1c1RleHQgXSApO1xuXG4gICAgICAgICAgICAgICAgaWYgKCBmaXJlR2xvYmFscyApIHtcbiAgICAgICAgICAgICAgICAgICAgZ2xvYmFsRXZlbnRDb250ZXh0LnRyaWdnZXIoIFwiYWpheENvbXBsZXRlXCIsIFsganFYSFIsIHMgXSApO1xuICAgICAgICAgICAgICAgICAgICAvLyBIYW5kbGUgdGhlIGdsb2JhbCBBSkFYIGNvdW50ZXJcbiAgICAgICAgICAgICAgICAgICAgaWYgKCAhKCAtLWpRdWVyeS5hY3RpdmUgKSApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGpRdWVyeS5ldmVudC50cmlnZ2VyKCBcImFqYXhTdG9wXCIgKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gQXR0YWNoIGRlZmVycmVkc1xuICAgICAgICAgICAgZGVmZXJyZWQucHJvbWlzZSgganFYSFIgKTtcbiAgICAgICAgICAgIGpxWEhSLnN1Y2Nlc3MgPSBqcVhIUi5kb25lO1xuICAgICAgICAgICAganFYSFIuZXJyb3IgPSBqcVhIUi5mYWlsO1xuICAgICAgICAgICAganFYSFIuY29tcGxldGUgPSBjb21wbGV0ZURlZmVycmVkLmFkZDtcblxuICAgICAgICAgICAgLy8gU3RhdHVzLWRlcGVuZGVudCBjYWxsYmFja3NcbiAgICAgICAgICAgIGpxWEhSLnN0YXR1c0NvZGUgPSBmdW5jdGlvbiggbWFwICkge1xuICAgICAgICAgICAgICAgIGlmICggbWFwICkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgdG1wO1xuICAgICAgICAgICAgICAgICAgICBpZiAoIHN0YXRlIDwgMiApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoIHRtcCBpbiBtYXAgKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhdHVzQ29kZVsgdG1wIF0gPSBbIHN0YXR1c0NvZGVbdG1wXSwgbWFwW3RtcF0gXTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRtcCA9IG1hcFsganFYSFIuc3RhdHVzIF07XG4gICAgICAgICAgICAgICAgICAgICAgICBqcVhIUi50aGVuKCB0bXAsIHRtcCApO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgLy8gUmVtb3ZlIGhhc2ggY2hhcmFjdGVyICgjNzUzMTogYW5kIHN0cmluZyBwcm9tb3Rpb24pXG4gICAgICAgICAgICAvLyBBZGQgcHJvdG9jb2wgaWYgbm90IHByb3ZpZGVkICgjNTg2NjogSUU3IGlzc3VlIHdpdGggcHJvdG9jb2wtbGVzcyB1cmxzKVxuICAgICAgICAgICAgLy8gV2UgYWxzbyB1c2UgdGhlIHVybCBwYXJhbWV0ZXIgaWYgYXZhaWxhYmxlXG4gICAgICAgICAgICBzLnVybCA9ICggKCB1cmwgfHwgcy51cmwgKSArIFwiXCIgKS5yZXBsYWNlKCByaGFzaCwgXCJcIiApLnJlcGxhY2UoIHJwcm90b2NvbCwgYWpheExvY1BhcnRzWyAxIF0gKyBcIi8vXCIgKTtcblxuICAgICAgICAgICAgLy8gRXh0cmFjdCBkYXRhVHlwZXMgbGlzdFxuICAgICAgICAgICAgcy5kYXRhVHlwZXMgPSBqUXVlcnkudHJpbSggcy5kYXRhVHlwZSB8fCBcIipcIiApLnRvTG93ZXJDYXNlKCkuc3BsaXQoIHJzcGFjZXNBamF4ICk7XG5cbiAgICAgICAgICAgIC8vIERldGVybWluZSBpZiBhIGNyb3NzLWRvbWFpbiByZXF1ZXN0IGlzIGluIG9yZGVyXG4gICAgICAgICAgICBpZiAoIHMuY3Jvc3NEb21haW4gPT0gbnVsbCApIHtcbiAgICAgICAgICAgICAgICBwYXJ0cyA9IHJ1cmwuZXhlYyggcy51cmwudG9Mb3dlckNhc2UoKSApO1xuICAgICAgICAgICAgICAgIHMuY3Jvc3NEb21haW4gPSAhISggcGFydHMgJiZcbiAgICAgICAgICAgICAgICAgICAgKCBwYXJ0c1sgMSBdICE9IGFqYXhMb2NQYXJ0c1sgMSBdIHx8IHBhcnRzWyAyIF0gIT0gYWpheExvY1BhcnRzWyAyIF0gfHxcbiAgICAgICAgICAgICAgICAgICAgKCBwYXJ0c1sgMyBdIHx8ICggcGFydHNbIDEgXSA9PT0gXCJodHRwOlwiID8gODAgOiA0NDMgKSApICE9XG4gICAgICAgICAgICAgICAgICAgICggYWpheExvY1BhcnRzWyAzIF0gfHwgKCBhamF4TG9jUGFydHNbIDEgXSA9PT0gXCJodHRwOlwiID8gODAgOiA0NDMgKSApIClcbiAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBDb252ZXJ0IGRhdGEgaWYgbm90IGFscmVhZHkgYSBzdHJpbmdcbiAgICAgICAgICAgIGlmICggcy5kYXRhICYmIHMucHJvY2Vzc0RhdGEgJiYgdHlwZW9mIHMuZGF0YSAhPT0gXCJzdHJpbmdcIiApIHtcbiAgICAgICAgICAgICAgICBzLmRhdGEgPSBqUXVlcnkucGFyYW0oIHMuZGF0YSwgcy50cmFkaXRpb25hbCApO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBBcHBseSBwcmVmaWx0ZXJzXG4gICAgICAgICAgICBpbnNwZWN0UHJlZmlsdGVyc09yVHJhbnNwb3J0cyggcHJlZmlsdGVycywgcywgb3B0aW9ucywganFYSFIgKTtcblxuICAgICAgICAgICAgLy8gSWYgcmVxdWVzdCB3YXMgYWJvcnRlZCBpbnNpZGUgYSBwcmVmaWxlciwgc3RvcCB0aGVyZVxuICAgICAgICAgICAgaWYgKCBzdGF0ZSA9PT0gMiApIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIFdlIGNhbiBmaXJlIGdsb2JhbCBldmVudHMgYXMgb2Ygbm93IGlmIGFza2VkIHRvXG4gICAgICAgICAgICBmaXJlR2xvYmFscyA9IHMuZ2xvYmFsO1xuXG4gICAgICAgICAgICAvLyBVcHBlcmNhc2UgdGhlIHR5cGVcbiAgICAgICAgICAgIHMudHlwZSA9IHMudHlwZS50b1VwcGVyQ2FzZSgpO1xuXG4gICAgICAgICAgICAvLyBEZXRlcm1pbmUgaWYgcmVxdWVzdCBoYXMgY29udGVudFxuICAgICAgICAgICAgcy5oYXNDb250ZW50ID0gIXJub0NvbnRlbnQudGVzdCggcy50eXBlICk7XG5cbiAgICAgICAgICAgIC8vIFdhdGNoIGZvciBhIG5ldyBzZXQgb2YgcmVxdWVzdHNcbiAgICAgICAgICAgIGlmICggZmlyZUdsb2JhbHMgJiYgalF1ZXJ5LmFjdGl2ZSsrID09PSAwICkge1xuICAgICAgICAgICAgICAgIGpRdWVyeS5ldmVudC50cmlnZ2VyKCBcImFqYXhTdGFydFwiICk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIE1vcmUgb3B0aW9ucyBoYW5kbGluZyBmb3IgcmVxdWVzdHMgd2l0aCBubyBjb250ZW50XG4gICAgICAgICAgICBpZiAoICFzLmhhc0NvbnRlbnQgKSB7XG5cbiAgICAgICAgICAgICAgICAvLyBJZiBkYXRhIGlzIGF2YWlsYWJsZSwgYXBwZW5kIGRhdGEgdG8gdXJsXG4gICAgICAgICAgICAgICAgaWYgKCBzLmRhdGEgKSB7XG4gICAgICAgICAgICAgICAgICAgIHMudXJsICs9ICggcnF1ZXJ5LnRlc3QoIHMudXJsICkgPyBcIiZcIiA6IFwiP1wiICkgKyBzLmRhdGE7XG4gICAgICAgICAgICAgICAgICAgIC8vICM5NjgyOiByZW1vdmUgZGF0YSBzbyB0aGF0IGl0J3Mgbm90IHVzZWQgaW4gYW4gZXZlbnR1YWwgcmV0cnlcbiAgICAgICAgICAgICAgICAgICAgZGVsZXRlIHMuZGF0YTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAvLyBHZXQgaWZNb2RpZmllZEtleSBiZWZvcmUgYWRkaW5nIHRoZSBhbnRpLWNhY2hlIHBhcmFtZXRlclxuICAgICAgICAgICAgICAgIGlmTW9kaWZpZWRLZXkgPSBzLnVybDtcblxuICAgICAgICAgICAgICAgIC8vIEFkZCBhbnRpLWNhY2hlIGluIHVybCBpZiBuZWVkZWRcbiAgICAgICAgICAgICAgICBpZiAoIHMuY2FjaGUgPT09IGZhbHNlICkge1xuXG4gICAgICAgICAgICAgICAgICAgIHZhciB0cyA9IGpRdWVyeS5ub3coKSxcbiAgICAgICAgICAgICAgICAgICAgLy8gdHJ5IHJlcGxhY2luZyBfPSBpZiBpdCBpcyB0aGVyZVxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0ID0gcy51cmwucmVwbGFjZSggcnRzLCBcIiQxXz1cIiArIHRzICk7XG5cbiAgICAgICAgICAgICAgICAgICAgLy8gaWYgbm90aGluZyB3YXMgcmVwbGFjZWQsIGFkZCB0aW1lc3RhbXAgdG8gdGhlIGVuZFxuICAgICAgICAgICAgICAgICAgICBzLnVybCA9IHJldCArICggKCByZXQgPT09IHMudXJsICkgPyAoIHJxdWVyeS50ZXN0KCBzLnVybCApID8gXCImXCIgOiBcIj9cIiApICsgXCJfPVwiICsgdHMgOiBcIlwiICk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBTZXQgdGhlIGNvcnJlY3QgaGVhZGVyLCBpZiBkYXRhIGlzIGJlaW5nIHNlbnRcbiAgICAgICAgICAgIGlmICggcy5kYXRhICYmIHMuaGFzQ29udGVudCAmJiBzLmNvbnRlbnRUeXBlICE9PSBmYWxzZSB8fCBvcHRpb25zLmNvbnRlbnRUeXBlICkge1xuICAgICAgICAgICAgICAgIGpxWEhSLnNldFJlcXVlc3RIZWFkZXIoIFwiQ29udGVudC1UeXBlXCIsIHMuY29udGVudFR5cGUgKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gU2V0IHRoZSBJZi1Nb2RpZmllZC1TaW5jZSBhbmQvb3IgSWYtTm9uZS1NYXRjaCBoZWFkZXIsIGlmIGluIGlmTW9kaWZpZWQgbW9kZS5cbiAgICAgICAgICAgIGlmICggcy5pZk1vZGlmaWVkICkge1xuICAgICAgICAgICAgICAgIGlmTW9kaWZpZWRLZXkgPSBpZk1vZGlmaWVkS2V5IHx8IHMudXJsO1xuICAgICAgICAgICAgICAgIGlmICggalF1ZXJ5Lmxhc3RNb2RpZmllZFsgaWZNb2RpZmllZEtleSBdICkge1xuICAgICAgICAgICAgICAgICAgICBqcVhIUi5zZXRSZXF1ZXN0SGVhZGVyKCBcIklmLU1vZGlmaWVkLVNpbmNlXCIsIGpRdWVyeS5sYXN0TW9kaWZpZWRbIGlmTW9kaWZpZWRLZXkgXSApO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAoIGpRdWVyeS5ldGFnWyBpZk1vZGlmaWVkS2V5IF0gKSB7XG4gICAgICAgICAgICAgICAgICAgIGpxWEhSLnNldFJlcXVlc3RIZWFkZXIoIFwiSWYtTm9uZS1NYXRjaFwiLCBqUXVlcnkuZXRhZ1sgaWZNb2RpZmllZEtleSBdICk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBTZXQgdGhlIEFjY2VwdHMgaGVhZGVyIGZvciB0aGUgc2VydmVyLCBkZXBlbmRpbmcgb24gdGhlIGRhdGFUeXBlXG4gICAgICAgICAgICBqcVhIUi5zZXRSZXF1ZXN0SGVhZGVyKFxuICAgICAgICAgICAgICAgIFwiQWNjZXB0XCIsXG4gICAgICAgICAgICAgICAgcy5kYXRhVHlwZXNbIDAgXSAmJiBzLmFjY2VwdHNbIHMuZGF0YVR5cGVzWzBdIF0gP1xuICAgICAgICAgICAgICAgIHMuYWNjZXB0c1sgcy5kYXRhVHlwZXNbMF0gXSArICggcy5kYXRhVHlwZXNbIDAgXSAhPT0gXCIqXCIgPyBcIiwgXCIgKyBhbGxUeXBlcyArIFwiOyBxPTAuMDFcIiA6IFwiXCIgKSA6XG4gICAgICAgICAgICAgICAgICAgIHMuYWNjZXB0c1sgXCIqXCIgXVxuICAgICAgICAgICAgKTtcblxuICAgICAgICAgICAgLy8gQ2hlY2sgZm9yIGhlYWRlcnMgb3B0aW9uXG4gICAgICAgICAgICBmb3IgKCBpIGluIHMuaGVhZGVycyApIHtcbiAgICAgICAgICAgICAgICBqcVhIUi5zZXRSZXF1ZXN0SGVhZGVyKCBpLCBzLmhlYWRlcnNbIGkgXSApO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBBbGxvdyBjdXN0b20gaGVhZGVycy9taW1ldHlwZXMgYW5kIGVhcmx5IGFib3J0XG4gICAgICAgICAgICBpZiAoIHMuYmVmb3JlU2VuZCAmJiAoIHMuYmVmb3JlU2VuZC5jYWxsKCBjYWxsYmFja0NvbnRleHQsIGpxWEhSLCBzICkgPT09IGZhbHNlIHx8IHN0YXRlID09PSAyICkgKSB7XG4gICAgICAgICAgICAgICAgLy8gQWJvcnQgaWYgbm90IGRvbmUgYWxyZWFkeVxuICAgICAgICAgICAgICAgIGpxWEhSLmFib3J0KCk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuXG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIEluc3RhbGwgY2FsbGJhY2tzIG9uIGRlZmVycmVkc1xuICAgICAgICAgICAgZm9yICggaSBpbiB7IHN1Y2Nlc3M6IDEsIGVycm9yOiAxLCBjb21wbGV0ZTogMSB9ICkge1xuICAgICAgICAgICAgICAgIGpxWEhSWyBpIF0oIHNbIGkgXSApO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBHZXQgdHJhbnNwb3J0XG4gICAgICAgICAgICB0cmFuc3BvcnQgPSBpbnNwZWN0UHJlZmlsdGVyc09yVHJhbnNwb3J0cyggdHJhbnNwb3J0cywgcywgb3B0aW9ucywganFYSFIgKTtcblxuICAgICAgICAgICAgLy8gSWYgbm8gdHJhbnNwb3J0LCB3ZSBhdXRvLWFib3J0XG4gICAgICAgICAgICBpZiAoICF0cmFuc3BvcnQgKSB7XG4gICAgICAgICAgICAgICAgZG9uZSggLTEsIFwiTm8gVHJhbnNwb3J0XCIgKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAganFYSFIucmVhZHlTdGF0ZSA9IDE7XG4gICAgICAgICAgICAgICAgLy8gU2VuZCBnbG9iYWwgZXZlbnRcbiAgICAgICAgICAgICAgICBpZiAoIGZpcmVHbG9iYWxzICkge1xuICAgICAgICAgICAgICAgICAgICBnbG9iYWxFdmVudENvbnRleHQudHJpZ2dlciggXCJhamF4U2VuZFwiLCBbIGpxWEhSLCBzIF0gKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgLy8gVGltZW91dFxuICAgICAgICAgICAgICAgIGlmICggcy5hc3luYyAmJiBzLnRpbWVvdXQgPiAwICkge1xuICAgICAgICAgICAgICAgICAgICB0aW1lb3V0VGltZXIgPSBzZXRUaW1lb3V0KCBmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgICAgICAgICAganFYSFIuYWJvcnQoIFwidGltZW91dFwiICk7XG4gICAgICAgICAgICAgICAgICAgIH0sIHMudGltZW91dCApO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgICAgIHN0YXRlID0gMTtcbiAgICAgICAgICAgICAgICAgICAgdHJhbnNwb3J0LnNlbmQoIHJlcXVlc3RIZWFkZXJzLCBkb25lICk7XG4gICAgICAgICAgICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICAgICAgICAgICAgICAvLyBQcm9wYWdhdGUgZXhjZXB0aW9uIGFzIGVycm9yIGlmIG5vdCBkb25lXG4gICAgICAgICAgICAgICAgICAgIGlmICggc3RhdGUgPCAyICkge1xuICAgICAgICAgICAgICAgICAgICAgICAgZG9uZSggLTEsIGUgKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFNpbXBseSByZXRocm93IG90aGVyd2lzZVxuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgZTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgcmV0dXJuIGpxWEhSO1xuICAgICAgICB9LFxuXG4gICAgICAgIC8vIFNlcmlhbGl6ZSBhbiBhcnJheSBvZiBmb3JtIGVsZW1lbnRzIG9yIGEgc2V0IG9mXG4gICAgICAgIC8vIGtleS92YWx1ZXMgaW50byBhIHF1ZXJ5IHN0cmluZ1xuICAgICAgICBwYXJhbTogZnVuY3Rpb24oIGEsIHRyYWRpdGlvbmFsICkge1xuICAgICAgICAgICAgdmFyIHMgPSBbXSxcbiAgICAgICAgICAgICAgICBhZGQgPSBmdW5jdGlvbigga2V5LCB2YWx1ZSApIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gSWYgdmFsdWUgaXMgYSBmdW5jdGlvbiwgaW52b2tlIGl0IGFuZCByZXR1cm4gaXRzIHZhbHVlXG4gICAgICAgICAgICAgICAgICAgIHZhbHVlID0galF1ZXJ5LmlzRnVuY3Rpb24oIHZhbHVlICkgPyB2YWx1ZSgpIDogdmFsdWU7XG4gICAgICAgICAgICAgICAgICAgIHNbIHMubGVuZ3RoIF0gPSBlbmNvZGVVUklDb21wb25lbnQoIGtleSApICsgXCI9XCIgKyBlbmNvZGVVUklDb21wb25lbnQoIHZhbHVlICk7XG4gICAgICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgLy8gU2V0IHRyYWRpdGlvbmFsIHRvIHRydWUgZm9yIGpRdWVyeSA8PSAxLjMuMiBiZWhhdmlvci5cbiAgICAgICAgICAgIGlmICggdHJhZGl0aW9uYWwgPT09IHVuZGVmaW5lZCApIHtcbiAgICAgICAgICAgICAgICB0cmFkaXRpb25hbCA9IGpRdWVyeS5hamF4U2V0dGluZ3MudHJhZGl0aW9uYWw7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIElmIGFuIGFycmF5IHdhcyBwYXNzZWQgaW4sIGFzc3VtZSB0aGF0IGl0IGlzIGFuIGFycmF5IG9mIGZvcm0gZWxlbWVudHMuXG4gICAgICAgICAgICBpZiAoIGpRdWVyeS5pc0FycmF5KCBhICkgfHwgKCBhLmpxdWVyeSAmJiAhalF1ZXJ5LmlzUGxhaW5PYmplY3QoIGEgKSApICkge1xuICAgICAgICAgICAgICAgIC8vIFNlcmlhbGl6ZSB0aGUgZm9ybSBlbGVtZW50c1xuICAgICAgICAgICAgICAgIGpRdWVyeS5lYWNoKCBhLCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgYWRkKCB0aGlzLm5hbWUsIHRoaXMudmFsdWUgKTtcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAvLyBJZiB0cmFkaXRpb25hbCwgZW5jb2RlIHRoZSBcIm9sZFwiIHdheSAodGhlIHdheSAxLjMuMiBvciBvbGRlclxuICAgICAgICAgICAgICAgIC8vIGRpZCBpdCksIG90aGVyd2lzZSBlbmNvZGUgcGFyYW1zIHJlY3Vyc2l2ZWx5LlxuICAgICAgICAgICAgICAgIGZvciAoIHZhciBwcmVmaXggaW4gYSApIHtcbiAgICAgICAgICAgICAgICAgICAgYnVpbGRQYXJhbXMoIHByZWZpeCwgYVsgcHJlZml4IF0sIHRyYWRpdGlvbmFsLCBhZGQgKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIFJldHVybiB0aGUgcmVzdWx0aW5nIHNlcmlhbGl6YXRpb25cbiAgICAgICAgICAgIHJldHVybiBzLmpvaW4oIFwiJlwiICkucmVwbGFjZSggcjIwLCBcIitcIiApO1xuICAgICAgICB9XG4gICAgfSk7XG5cbiAgICBmdW5jdGlvbiBidWlsZFBhcmFtcyggcHJlZml4LCBvYmosIHRyYWRpdGlvbmFsLCBhZGQgKSB7XG4gICAgICAgIGlmICggalF1ZXJ5LmlzQXJyYXkoIG9iaiApICkge1xuICAgICAgICAgICAgLy8gU2VyaWFsaXplIGFycmF5IGl0ZW0uXG4gICAgICAgICAgICBqUXVlcnkuZWFjaCggb2JqLCBmdW5jdGlvbiggaSwgdiApIHtcbiAgICAgICAgICAgICAgICBpZiAoIHRyYWRpdGlvbmFsIHx8IHJicmFja2V0LnRlc3QoIHByZWZpeCApICkge1xuICAgICAgICAgICAgICAgICAgICAvLyBUcmVhdCBlYWNoIGFycmF5IGl0ZW0gYXMgYSBzY2FsYXIuXG4gICAgICAgICAgICAgICAgICAgIGFkZCggcHJlZml4LCB2ICk7XG5cbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAvLyBJZiBhcnJheSBpdGVtIGlzIG5vbi1zY2FsYXIgKGFycmF5IG9yIG9iamVjdCksIGVuY29kZSBpdHNcbiAgICAgICAgICAgICAgICAgICAgLy8gbnVtZXJpYyBpbmRleCB0byByZXNvbHZlIGRlc2VyaWFsaXphdGlvbiBhbWJpZ3VpdHkgaXNzdWVzLlxuICAgICAgICAgICAgICAgICAgICAvLyBOb3RlIHRoYXQgcmFjayAoYXMgb2YgMS4wLjApIGNhbid0IGN1cnJlbnRseSBkZXNlcmlhbGl6ZVxuICAgICAgICAgICAgICAgICAgICAvLyBuZXN0ZWQgYXJyYXlzIHByb3Blcmx5LCBhbmQgYXR0ZW1wdGluZyB0byBkbyBzbyBtYXkgY2F1c2VcbiAgICAgICAgICAgICAgICAgICAgLy8gYSBzZXJ2ZXIgZXJyb3IuIFBvc3NpYmxlIGZpeGVzIGFyZSB0byBtb2RpZnkgcmFjaydzXG4gICAgICAgICAgICAgICAgICAgIC8vIGRlc2VyaWFsaXphdGlvbiBhbGdvcml0aG0gb3IgdG8gcHJvdmlkZSBhbiBvcHRpb24gb3IgZmxhZ1xuICAgICAgICAgICAgICAgICAgICAvLyB0byBmb3JjZSBhcnJheSBzZXJpYWxpemF0aW9uIHRvIGJlIHNoYWxsb3cuXG4gICAgICAgICAgICAgICAgICAgIGJ1aWxkUGFyYW1zKCBwcmVmaXggKyBcIltcIiArICggdHlwZW9mIHYgPT09IFwib2JqZWN0XCIgfHwgalF1ZXJ5LmlzQXJyYXkodikgPyBpIDogXCJcIiApICsgXCJdXCIsIHYsIHRyYWRpdGlvbmFsLCBhZGQgKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICB9IGVsc2UgaWYgKCAhdHJhZGl0aW9uYWwgJiYgb2JqICE9IG51bGwgJiYgdHlwZW9mIG9iaiA9PT0gXCJvYmplY3RcIiApIHtcbiAgICAgICAgICAgIC8vIFNlcmlhbGl6ZSBvYmplY3QgaXRlbS5cbiAgICAgICAgICAgIGZvciAoIHZhciBuYW1lIGluIG9iaiApIHtcbiAgICAgICAgICAgICAgICBidWlsZFBhcmFtcyggcHJlZml4ICsgXCJbXCIgKyBuYW1lICsgXCJdXCIsIG9ialsgbmFtZSBdLCB0cmFkaXRpb25hbCwgYWRkICk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIC8vIFNlcmlhbGl6ZSBzY2FsYXIgaXRlbS5cbiAgICAgICAgICAgIGFkZCggcHJlZml4LCBvYmogKTtcbiAgICAgICAgfVxuICAgIH1cblxuLy8gVGhpcyBpcyBzdGlsbCBvbiB0aGUgalF1ZXJ5IG9iamVjdC4uLiBmb3Igbm93XG4vLyBXYW50IHRvIG1vdmUgdGhpcyB0byBqUXVlcnkuYWpheCBzb21lIGRheVxuICAgIGpRdWVyeS5leHRlbmQoe1xuXG4gICAgICAgIC8vIENvdW50ZXIgZm9yIGhvbGRpbmcgdGhlIG51bWJlciBvZiBhY3RpdmUgcXVlcmllc1xuICAgICAgICBhY3RpdmU6IDAsXG5cbiAgICAgICAgLy8gTGFzdC1Nb2RpZmllZCBoZWFkZXIgY2FjaGUgZm9yIG5leHQgcmVxdWVzdFxuICAgICAgICBsYXN0TW9kaWZpZWQ6IHt9LFxuICAgICAgICBldGFnOiB7fVxuXG4gICAgfSk7XG5cbiAgICAvKiBIYW5kbGVzIHJlc3BvbnNlcyB0byBhbiBhamF4IHJlcXVlc3Q6XG4gICAgICogLSBzZXRzIGFsbCByZXNwb25zZVhYWCBmaWVsZHMgYWNjb3JkaW5nbHlcbiAgICAgKiAtIGZpbmRzIHRoZSByaWdodCBkYXRhVHlwZSAobWVkaWF0ZXMgYmV0d2VlbiBjb250ZW50LXR5cGUgYW5kIGV4cGVjdGVkIGRhdGFUeXBlKVxuICAgICAqIC0gcmV0dXJucyB0aGUgY29ycmVzcG9uZGluZyByZXNwb25zZVxuICAgICAqL1xuICAgIGZ1bmN0aW9uIGFqYXhIYW5kbGVSZXNwb25zZXMoIHMsIGpxWEhSLCByZXNwb25zZXMgKSB7XG5cbiAgICAgICAgdmFyIGNvbnRlbnRzID0gcy5jb250ZW50cyxcbiAgICAgICAgICAgIGRhdGFUeXBlcyA9IHMuZGF0YVR5cGVzLFxuICAgICAgICAgICAgcmVzcG9uc2VGaWVsZHMgPSBzLnJlc3BvbnNlRmllbGRzLFxuICAgICAgICAgICAgY3QsXG4gICAgICAgICAgICB0eXBlLFxuICAgICAgICAgICAgZmluYWxEYXRhVHlwZSxcbiAgICAgICAgICAgIGZpcnN0RGF0YVR5cGU7XG5cbiAgICAgICAgLy8gRmlsbCByZXNwb25zZVhYWCBmaWVsZHNcbiAgICAgICAgZm9yICggdHlwZSBpbiByZXNwb25zZUZpZWxkcyApIHtcbiAgICAgICAgICAgIGlmICggdHlwZSBpbiByZXNwb25zZXMgKSB7XG4gICAgICAgICAgICAgICAganFYSFJbIHJlc3BvbnNlRmllbGRzW3R5cGVdIF0gPSByZXNwb25zZXNbIHR5cGUgXTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIC8vIFJlbW92ZSBhdXRvIGRhdGFUeXBlIGFuZCBnZXQgY29udGVudC10eXBlIGluIHRoZSBwcm9jZXNzXG4gICAgICAgIHdoaWxlKCBkYXRhVHlwZXNbIDAgXSA9PT0gXCIqXCIgKSB7XG4gICAgICAgICAgICBkYXRhVHlwZXMuc2hpZnQoKTtcbiAgICAgICAgICAgIGlmICggY3QgPT09IHVuZGVmaW5lZCApIHtcbiAgICAgICAgICAgICAgICBjdCA9IHMubWltZVR5cGUgfHwganFYSFIuZ2V0UmVzcG9uc2VIZWFkZXIoIFwiY29udGVudC10eXBlXCIgKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIC8vIENoZWNrIGlmIHdlJ3JlIGRlYWxpbmcgd2l0aCBhIGtub3duIGNvbnRlbnQtdHlwZVxuICAgICAgICBpZiAoIGN0ICkge1xuICAgICAgICAgICAgZm9yICggdHlwZSBpbiBjb250ZW50cyApIHtcbiAgICAgICAgICAgICAgICBpZiAoIGNvbnRlbnRzWyB0eXBlIF0gJiYgY29udGVudHNbIHR5cGUgXS50ZXN0KCBjdCApICkge1xuICAgICAgICAgICAgICAgICAgICBkYXRhVHlwZXMudW5zaGlmdCggdHlwZSApO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICAvLyBDaGVjayB0byBzZWUgaWYgd2UgaGF2ZSBhIHJlc3BvbnNlIGZvciB0aGUgZXhwZWN0ZWQgZGF0YVR5cGVcbiAgICAgICAgaWYgKCBkYXRhVHlwZXNbIDAgXSBpbiByZXNwb25zZXMgKSB7XG4gICAgICAgICAgICBmaW5hbERhdGFUeXBlID0gZGF0YVR5cGVzWyAwIF07XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAvLyBUcnkgY29udmVydGlibGUgZGF0YVR5cGVzXG4gICAgICAgICAgICBmb3IgKCB0eXBlIGluIHJlc3BvbnNlcyApIHtcbiAgICAgICAgICAgICAgICBpZiAoICFkYXRhVHlwZXNbIDAgXSB8fCBzLmNvbnZlcnRlcnNbIHR5cGUgKyBcIiBcIiArIGRhdGFUeXBlc1swXSBdICkge1xuICAgICAgICAgICAgICAgICAgICBmaW5hbERhdGFUeXBlID0gdHlwZTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmICggIWZpcnN0RGF0YVR5cGUgKSB7XG4gICAgICAgICAgICAgICAgICAgIGZpcnN0RGF0YVR5cGUgPSB0eXBlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8vIE9yIGp1c3QgdXNlIGZpcnN0IG9uZVxuICAgICAgICAgICAgZmluYWxEYXRhVHlwZSA9IGZpbmFsRGF0YVR5cGUgfHwgZmlyc3REYXRhVHlwZTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIElmIHdlIGZvdW5kIGEgZGF0YVR5cGVcbiAgICAgICAgLy8gV2UgYWRkIHRoZSBkYXRhVHlwZSB0byB0aGUgbGlzdCBpZiBuZWVkZWRcbiAgICAgICAgLy8gYW5kIHJldHVybiB0aGUgY29ycmVzcG9uZGluZyByZXNwb25zZVxuICAgICAgICBpZiAoIGZpbmFsRGF0YVR5cGUgKSB7XG4gICAgICAgICAgICBpZiAoIGZpbmFsRGF0YVR5cGUgIT09IGRhdGFUeXBlc1sgMCBdICkge1xuICAgICAgICAgICAgICAgIGRhdGFUeXBlcy51bnNoaWZ0KCBmaW5hbERhdGFUeXBlICk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gcmVzcG9uc2VzWyBmaW5hbERhdGFUeXBlIF07XG4gICAgICAgIH1cbiAgICB9XG5cbi8vIENoYWluIGNvbnZlcnNpb25zIGdpdmVuIHRoZSByZXF1ZXN0IGFuZCB0aGUgb3JpZ2luYWwgcmVzcG9uc2VcbiAgICBmdW5jdGlvbiBhamF4Q29udmVydCggcywgcmVzcG9uc2UgKSB7XG5cbiAgICAgICAgLy8gQXBwbHkgdGhlIGRhdGFGaWx0ZXIgaWYgcHJvdmlkZWRcbiAgICAgICAgaWYgKCBzLmRhdGFGaWx0ZXIgKSB7XG4gICAgICAgICAgICByZXNwb25zZSA9IHMuZGF0YUZpbHRlciggcmVzcG9uc2UsIHMuZGF0YVR5cGUgKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHZhciBkYXRhVHlwZXMgPSBzLmRhdGFUeXBlcyxcbiAgICAgICAgICAgIGNvbnZlcnRlcnMgPSB7fSxcbiAgICAgICAgICAgIGksXG4gICAgICAgICAgICBrZXksXG4gICAgICAgICAgICBsZW5ndGggPSBkYXRhVHlwZXMubGVuZ3RoLFxuICAgICAgICAgICAgdG1wLFxuICAgICAgICAvLyBDdXJyZW50IGFuZCBwcmV2aW91cyBkYXRhVHlwZXNcbiAgICAgICAgICAgIGN1cnJlbnQgPSBkYXRhVHlwZXNbIDAgXSxcbiAgICAgICAgICAgIHByZXYsXG4gICAgICAgIC8vIENvbnZlcnNpb24gZXhwcmVzc2lvblxuICAgICAgICAgICAgY29udmVyc2lvbixcbiAgICAgICAgLy8gQ29udmVyc2lvbiBmdW5jdGlvblxuICAgICAgICAgICAgY29udixcbiAgICAgICAgLy8gQ29udmVyc2lvbiBmdW5jdGlvbnMgKHRyYW5zaXRpdmUgY29udmVyc2lvbilcbiAgICAgICAgICAgIGNvbnYxLFxuICAgICAgICAgICAgY29udjI7XG5cbiAgICAgICAgLy8gRm9yIGVhY2ggZGF0YVR5cGUgaW4gdGhlIGNoYWluXG4gICAgICAgIGZvciAoIGkgPSAxOyBpIDwgbGVuZ3RoOyBpKysgKSB7XG5cbiAgICAgICAgICAgIC8vIENyZWF0ZSBjb252ZXJ0ZXJzIG1hcFxuICAgICAgICAgICAgLy8gd2l0aCBsb3dlcmNhc2VkIGtleXNcbiAgICAgICAgICAgIGlmICggaSA9PT0gMSApIHtcbiAgICAgICAgICAgICAgICBmb3IgKCBrZXkgaW4gcy5jb252ZXJ0ZXJzICkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoIHR5cGVvZiBrZXkgPT09IFwic3RyaW5nXCIgKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb252ZXJ0ZXJzWyBrZXkudG9Mb3dlckNhc2UoKSBdID0gcy5jb252ZXJ0ZXJzWyBrZXkgXTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gR2V0IHRoZSBkYXRhVHlwZXNcbiAgICAgICAgICAgIHByZXYgPSBjdXJyZW50O1xuICAgICAgICAgICAgY3VycmVudCA9IGRhdGFUeXBlc1sgaSBdO1xuXG4gICAgICAgICAgICAvLyBJZiBjdXJyZW50IGlzIGF1dG8gZGF0YVR5cGUsIHVwZGF0ZSBpdCB0byBwcmV2XG4gICAgICAgICAgICBpZiAoIGN1cnJlbnQgPT09IFwiKlwiICkge1xuICAgICAgICAgICAgICAgIGN1cnJlbnQgPSBwcmV2O1xuICAgICAgICAgICAgICAgIC8vIElmIG5vIGF1dG8gYW5kIGRhdGFUeXBlcyBhcmUgYWN0dWFsbHkgZGlmZmVyZW50XG4gICAgICAgICAgICB9IGVsc2UgaWYgKCBwcmV2ICE9PSBcIipcIiAmJiBwcmV2ICE9PSBjdXJyZW50ICkge1xuXG4gICAgICAgICAgICAgICAgLy8gR2V0IHRoZSBjb252ZXJ0ZXJcbiAgICAgICAgICAgICAgICBjb252ZXJzaW9uID0gcHJldiArIFwiIFwiICsgY3VycmVudDtcbiAgICAgICAgICAgICAgICBjb252ID0gY29udmVydGVyc1sgY29udmVyc2lvbiBdIHx8IGNvbnZlcnRlcnNbIFwiKiBcIiArIGN1cnJlbnQgXTtcblxuICAgICAgICAgICAgICAgIC8vIElmIHRoZXJlIGlzIG5vIGRpcmVjdCBjb252ZXJ0ZXIsIHNlYXJjaCB0cmFuc2l0aXZlbHlcbiAgICAgICAgICAgICAgICBpZiAoICFjb252ICkge1xuICAgICAgICAgICAgICAgICAgICBjb252MiA9IHVuZGVmaW5lZDtcbiAgICAgICAgICAgICAgICAgICAgZm9yICggY29udjEgaW4gY29udmVydGVycyApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRtcCA9IGNvbnYxLnNwbGl0KCBcIiBcIiApO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCB0bXBbIDAgXSA9PT0gcHJldiB8fCB0bXBbIDAgXSA9PT0gXCIqXCIgKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udjIgPSBjb252ZXJ0ZXJzWyB0bXBbMV0gKyBcIiBcIiArIGN1cnJlbnQgXTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIGNvbnYyICkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb252MSA9IGNvbnZlcnRlcnNbIGNvbnYxIF07XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICggY29udjEgPT09IHRydWUgKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb252ID0gY29udjI7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoIGNvbnYyID09PSB0cnVlICkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udiA9IGNvbnYxO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAvLyBJZiB3ZSBmb3VuZCBubyBjb252ZXJ0ZXIsIGRpc3BhdGNoIGFuIGVycm9yXG4gICAgICAgICAgICAgICAgaWYgKCAhKCBjb252IHx8IGNvbnYyICkgKSB7XG4gICAgICAgICAgICAgICAgICAgIGpRdWVyeS5lcnJvciggXCJObyBjb252ZXJzaW9uIGZyb20gXCIgKyBjb252ZXJzaW9uLnJlcGxhY2UoXCIgXCIsXCIgdG8gXCIpICk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIC8vIElmIGZvdW5kIGNvbnZlcnRlciBpcyBub3QgYW4gZXF1aXZhbGVuY2VcbiAgICAgICAgICAgICAgICBpZiAoIGNvbnYgIT09IHRydWUgKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIENvbnZlcnQgd2l0aCAxIG9yIDIgY29udmVydGVycyBhY2NvcmRpbmdseVxuICAgICAgICAgICAgICAgICAgICByZXNwb25zZSA9IGNvbnYgPyBjb252KCByZXNwb25zZSApIDogY29udjIoIGNvbnYxKHJlc3BvbnNlKSApO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gcmVzcG9uc2U7XG4gICAgfVxuXG5cblxuXG4gICAgdmFyIGpzYyA9IGpRdWVyeS5ub3coKSxcbiAgICAgICAganNyZSA9IC8oXFw9KVxcPygmfCQpfFxcP1xcPy9pO1xuXG4vLyBEZWZhdWx0IGpzb25wIHNldHRpbmdzXG4gICAgalF1ZXJ5LmFqYXhTZXR1cCh7XG4gICAgICAgIGpzb25wOiBcImNhbGxiYWNrXCIsXG4gICAgICAgIGpzb25wQ2FsbGJhY2s6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgcmV0dXJuIGpRdWVyeS5leHBhbmRvICsgXCJfXCIgKyAoIGpzYysrICk7XG4gICAgICAgIH1cbiAgICB9KTtcblxuLy8gRGV0ZWN0LCBub3JtYWxpemUgb3B0aW9ucyBhbmQgaW5zdGFsbCBjYWxsYmFja3MgZm9yIGpzb25wIHJlcXVlc3RzXG4gICAgalF1ZXJ5LmFqYXhQcmVmaWx0ZXIoIFwianNvbiBqc29ucFwiLCBmdW5jdGlvbiggcywgb3JpZ2luYWxTZXR0aW5ncywganFYSFIgKSB7XG5cbiAgICAgICAgdmFyIGluc3BlY3REYXRhID0gcy5jb250ZW50VHlwZSA9PT0gXCJhcHBsaWNhdGlvbi94LXd3dy1mb3JtLXVybGVuY29kZWRcIiAmJlxuICAgICAgICAgICAgKCB0eXBlb2Ygcy5kYXRhID09PSBcInN0cmluZ1wiICk7XG5cbiAgICAgICAgaWYgKCBzLmRhdGFUeXBlc1sgMCBdID09PSBcImpzb25wXCIgfHxcbiAgICAgICAgICAgIHMuanNvbnAgIT09IGZhbHNlICYmICgganNyZS50ZXN0KCBzLnVybCApIHx8XG4gICAgICAgICAgICBpbnNwZWN0RGF0YSAmJiBqc3JlLnRlc3QoIHMuZGF0YSApICkgKSB7XG5cbiAgICAgICAgICAgIHZhciByZXNwb25zZUNvbnRhaW5lcixcbiAgICAgICAgICAgICAgICBqc29ucENhbGxiYWNrID0gcy5qc29ucENhbGxiYWNrID1cbiAgICAgICAgICAgICAgICAgICAgalF1ZXJ5LmlzRnVuY3Rpb24oIHMuanNvbnBDYWxsYmFjayApID8gcy5qc29ucENhbGxiYWNrKCkgOiBzLmpzb25wQ2FsbGJhY2ssXG4gICAgICAgICAgICAgICAgcHJldmlvdXMgPSB3aW5kb3dbIGpzb25wQ2FsbGJhY2sgXSxcbiAgICAgICAgICAgICAgICB1cmwgPSBzLnVybCxcbiAgICAgICAgICAgICAgICBkYXRhID0gcy5kYXRhLFxuICAgICAgICAgICAgICAgIHJlcGxhY2UgPSBcIiQxXCIgKyBqc29ucENhbGxiYWNrICsgXCIkMlwiO1xuXG4gICAgICAgICAgICBpZiAoIHMuanNvbnAgIT09IGZhbHNlICkge1xuICAgICAgICAgICAgICAgIHVybCA9IHVybC5yZXBsYWNlKCBqc3JlLCByZXBsYWNlICk7XG4gICAgICAgICAgICAgICAgaWYgKCBzLnVybCA9PT0gdXJsICkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoIGluc3BlY3REYXRhICkge1xuICAgICAgICAgICAgICAgICAgICAgICAgZGF0YSA9IGRhdGEucmVwbGFjZSgganNyZSwgcmVwbGFjZSApO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGlmICggcy5kYXRhID09PSBkYXRhICkge1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gQWRkIGNhbGxiYWNrIG1hbnVhbGx5XG4gICAgICAgICAgICAgICAgICAgICAgICB1cmwgKz0gKC9cXD8vLnRlc3QoIHVybCApID8gXCImXCIgOiBcIj9cIikgKyBzLmpzb25wICsgXCI9XCIgKyBqc29ucENhbGxiYWNrO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBzLnVybCA9IHVybDtcbiAgICAgICAgICAgIHMuZGF0YSA9IGRhdGE7XG5cbiAgICAgICAgICAgIC8vIEluc3RhbGwgY2FsbGJhY2tcbiAgICAgICAgICAgIHdpbmRvd1sganNvbnBDYWxsYmFjayBdID0gZnVuY3Rpb24oIHJlc3BvbnNlICkge1xuICAgICAgICAgICAgICAgIHJlc3BvbnNlQ29udGFpbmVyID0gWyByZXNwb25zZSBdO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgLy8gQ2xlYW4tdXAgZnVuY3Rpb25cbiAgICAgICAgICAgIGpxWEhSLmFsd2F5cyhmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAvLyBTZXQgY2FsbGJhY2sgYmFjayB0byBwcmV2aW91cyB2YWx1ZVxuICAgICAgICAgICAgICAgIHdpbmRvd1sganNvbnBDYWxsYmFjayBdID0gcHJldmlvdXM7XG4gICAgICAgICAgICAgICAgLy8gQ2FsbCBpZiBpdCB3YXMgYSBmdW5jdGlvbiBhbmQgd2UgaGF2ZSBhIHJlc3BvbnNlXG4gICAgICAgICAgICAgICAgaWYgKCByZXNwb25zZUNvbnRhaW5lciAmJiBqUXVlcnkuaXNGdW5jdGlvbiggcHJldmlvdXMgKSApIHtcbiAgICAgICAgICAgICAgICAgICAgd2luZG93WyBqc29ucENhbGxiYWNrIF0oIHJlc3BvbnNlQ29udGFpbmVyWyAwIF0gKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgLy8gVXNlIGRhdGEgY29udmVydGVyIHRvIHJldHJpZXZlIGpzb24gYWZ0ZXIgc2NyaXB0IGV4ZWN1dGlvblxuICAgICAgICAgICAgcy5jb252ZXJ0ZXJzW1wic2NyaXB0IGpzb25cIl0gPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICBpZiAoICFyZXNwb25zZUNvbnRhaW5lciApIHtcbiAgICAgICAgICAgICAgICAgICAgalF1ZXJ5LmVycm9yKCBqc29ucENhbGxiYWNrICsgXCIgd2FzIG5vdCBjYWxsZWRcIiApO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm4gcmVzcG9uc2VDb250YWluZXJbIDAgXTtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIC8vIGZvcmNlIGpzb24gZGF0YVR5cGVcbiAgICAgICAgICAgIHMuZGF0YVR5cGVzWyAwIF0gPSBcImpzb25cIjtcblxuICAgICAgICAgICAgLy8gRGVsZWdhdGUgdG8gc2NyaXB0XG4gICAgICAgICAgICByZXR1cm4gXCJzY3JpcHRcIjtcbiAgICAgICAgfVxuICAgIH0pO1xuXG5cblxuXG4vLyBJbnN0YWxsIHNjcmlwdCBkYXRhVHlwZVxuICAgIGpRdWVyeS5hamF4U2V0dXAoe1xuICAgICAgICBhY2NlcHRzOiB7XG4gICAgICAgICAgICBzY3JpcHQ6IFwidGV4dC9qYXZhc2NyaXB0LCBhcHBsaWNhdGlvbi9qYXZhc2NyaXB0LCBhcHBsaWNhdGlvbi9lY21hc2NyaXB0LCBhcHBsaWNhdGlvbi94LWVjbWFzY3JpcHRcIlxuICAgICAgICB9LFxuICAgICAgICBjb250ZW50czoge1xuICAgICAgICAgICAgc2NyaXB0OiAvamF2YXNjcmlwdHxlY21hc2NyaXB0L1xuICAgICAgICB9LFxuICAgICAgICBjb252ZXJ0ZXJzOiB7XG4gICAgICAgICAgICBcInRleHQgc2NyaXB0XCI6IGZ1bmN0aW9uKCB0ZXh0ICkge1xuICAgICAgICAgICAgICAgIGpRdWVyeS5nbG9iYWxFdmFsKCB0ZXh0ICk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRleHQ7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9KTtcblxuLy8gSGFuZGxlIGNhY2hlJ3Mgc3BlY2lhbCBjYXNlIGFuZCBnbG9iYWxcbiAgICBqUXVlcnkuYWpheFByZWZpbHRlciggXCJzY3JpcHRcIiwgZnVuY3Rpb24oIHMgKSB7XG4gICAgICAgIGlmICggcy5jYWNoZSA9PT0gdW5kZWZpbmVkICkge1xuICAgICAgICAgICAgcy5jYWNoZSA9IGZhbHNlO1xuICAgICAgICB9XG4gICAgICAgIGlmICggcy5jcm9zc0RvbWFpbiApIHtcbiAgICAgICAgICAgIHMudHlwZSA9IFwiR0VUXCI7XG4gICAgICAgICAgICBzLmdsb2JhbCA9IGZhbHNlO1xuICAgICAgICB9XG4gICAgfSk7XG5cbi8vIEJpbmQgc2NyaXB0IHRhZyBoYWNrIHRyYW5zcG9ydFxuICAgIGpRdWVyeS5hamF4VHJhbnNwb3J0KCBcInNjcmlwdFwiLCBmdW5jdGlvbihzKSB7XG5cbiAgICAgICAgLy8gVGhpcyB0cmFuc3BvcnQgb25seSBkZWFscyB3aXRoIGNyb3NzIGRvbWFpbiByZXF1ZXN0c1xuICAgICAgICBpZiAoIHMuY3Jvc3NEb21haW4gKSB7XG5cbiAgICAgICAgICAgIHZhciBzY3JpcHQsXG4gICAgICAgICAgICAgICAgaGVhZCA9IGRvY3VtZW50LmhlYWQgfHwgZG9jdW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoIFwiaGVhZFwiIClbMF0gfHwgZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50O1xuXG4gICAgICAgICAgICByZXR1cm4ge1xuXG4gICAgICAgICAgICAgICAgc2VuZDogZnVuY3Rpb24oIF8sIGNhbGxiYWNrICkge1xuXG4gICAgICAgICAgICAgICAgICAgIHNjcmlwdCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoIFwic2NyaXB0XCIgKTtcblxuICAgICAgICAgICAgICAgICAgICBzY3JpcHQuYXN5bmMgPSBcImFzeW5jXCI7XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKCBzLnNjcmlwdENoYXJzZXQgKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzY3JpcHQuY2hhcnNldCA9IHMuc2NyaXB0Q2hhcnNldDtcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIHNjcmlwdC5zcmMgPSBzLnVybDtcblxuICAgICAgICAgICAgICAgICAgICAvLyBBdHRhY2ggaGFuZGxlcnMgZm9yIGFsbCBicm93c2Vyc1xuICAgICAgICAgICAgICAgICAgICBzY3JpcHQub25sb2FkID0gc2NyaXB0Lm9ucmVhZHlzdGF0ZWNoYW5nZSA9IGZ1bmN0aW9uKCBfLCBpc0Fib3J0ICkge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoIGlzQWJvcnQgfHwgIXNjcmlwdC5yZWFkeVN0YXRlIHx8IC9sb2FkZWR8Y29tcGxldGUvLnRlc3QoIHNjcmlwdC5yZWFkeVN0YXRlICkgKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBIYW5kbGUgbWVtb3J5IGxlYWsgaW4gSUVcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzY3JpcHQub25sb2FkID0gc2NyaXB0Lm9ucmVhZHlzdGF0ZWNoYW5nZSA9IG51bGw7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBSZW1vdmUgdGhlIHNjcmlwdFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICggaGVhZCAmJiBzY3JpcHQucGFyZW50Tm9kZSApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaGVhZC5yZW1vdmVDaGlsZCggc2NyaXB0ICk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gRGVyZWZlcmVuY2UgdGhlIHNjcmlwdFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNjcmlwdCA9IHVuZGVmaW5lZDtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIENhbGxiYWNrIGlmIG5vdCBhYm9ydFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICggIWlzQWJvcnQgKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrKCAyMDAsIFwic3VjY2Vzc1wiICk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgICAgICAvLyBVc2UgaW5zZXJ0QmVmb3JlIGluc3RlYWQgb2YgYXBwZW5kQ2hpbGQgIHRvIGNpcmN1bXZlbnQgYW4gSUU2IGJ1Zy5cbiAgICAgICAgICAgICAgICAgICAgLy8gVGhpcyBhcmlzZXMgd2hlbiBhIGJhc2Ugbm9kZSBpcyB1c2VkICgjMjcwOSBhbmQgIzQzNzgpLlxuICAgICAgICAgICAgICAgICAgICBoZWFkLmluc2VydEJlZm9yZSggc2NyaXB0LCBoZWFkLmZpcnN0Q2hpbGQgKTtcbiAgICAgICAgICAgICAgICB9LFxuXG4gICAgICAgICAgICAgICAgYWJvcnQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoIHNjcmlwdCApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNjcmlwdC5vbmxvYWQoIDAsIDEgKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH07XG4gICAgICAgIH1cbiAgICB9KTtcblxuXG5cblxuICAgIHZhciAvLyAjNTI4MDogSW50ZXJuZXQgRXhwbG9yZXIgd2lsbCBrZWVwIGNvbm5lY3Rpb25zIGFsaXZlIGlmIHdlIGRvbid0IGFib3J0IG9uIHVubG9hZFxuICAgICAgICB4aHJPblVubG9hZEFib3J0ID0gd2luZG93LkFjdGl2ZVhPYmplY3QgPyBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIC8vIEFib3J0IGFsbCBwZW5kaW5nIHJlcXVlc3RzXG4gICAgICAgICAgICBmb3IgKCB2YXIga2V5IGluIHhockNhbGxiYWNrcyApIHtcbiAgICAgICAgICAgICAgICB4aHJDYWxsYmFja3NbIGtleSBdKCAwLCAxICk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0gOiBmYWxzZSxcbiAgICAgICAgeGhySWQgPSAwLFxuICAgICAgICB4aHJDYWxsYmFja3M7XG5cbi8vIEZ1bmN0aW9ucyB0byBjcmVhdGUgeGhyc1xuICAgIGZ1bmN0aW9uIGNyZWF0ZVN0YW5kYXJkWEhSKCkge1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgcmV0dXJuIG5ldyB3aW5kb3cuWE1MSHR0cFJlcXVlc3QoKTtcbiAgICAgICAgfSBjYXRjaCggZSApIHt9XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gY3JlYXRlQWN0aXZlWEhSKCkge1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgcmV0dXJuIG5ldyB3aW5kb3cuQWN0aXZlWE9iamVjdCggXCJNaWNyb3NvZnQuWE1MSFRUUFwiICk7XG4gICAgICAgIH0gY2F0Y2goIGUgKSB7fVxuICAgIH1cblxuLy8gQ3JlYXRlIHRoZSByZXF1ZXN0IG9iamVjdFxuLy8gKFRoaXMgaXMgc3RpbGwgYXR0YWNoZWQgdG8gYWpheFNldHRpbmdzIGZvciBiYWNrd2FyZCBjb21wYXRpYmlsaXR5KVxuICAgIGpRdWVyeS5hamF4U2V0dGluZ3MueGhyID0gd2luZG93LkFjdGl2ZVhPYmplY3QgP1xuICAgICAgICAvKiBNaWNyb3NvZnQgZmFpbGVkIHRvIHByb3Blcmx5XG4gICAgICAgICAqIGltcGxlbWVudCB0aGUgWE1MSHR0cFJlcXVlc3QgaW4gSUU3IChjYW4ndCByZXF1ZXN0IGxvY2FsIGZpbGVzKSxcbiAgICAgICAgICogc28gd2UgdXNlIHRoZSBBY3RpdmVYT2JqZWN0IHdoZW4gaXQgaXMgYXZhaWxhYmxlXG4gICAgICAgICAqIEFkZGl0aW9uYWxseSBYTUxIdHRwUmVxdWVzdCBjYW4gYmUgZGlzYWJsZWQgaW4gSUU3L0lFOCBzb1xuICAgICAgICAgKiB3ZSBuZWVkIGEgZmFsbGJhY2suXG4gICAgICAgICAqL1xuICAgICAgICBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHJldHVybiAhdGhpcy5pc0xvY2FsICYmIGNyZWF0ZVN0YW5kYXJkWEhSKCkgfHwgY3JlYXRlQWN0aXZlWEhSKCk7XG4gICAgICAgIH0gOlxuICAgICAgICAvLyBGb3IgYWxsIG90aGVyIGJyb3dzZXJzLCB1c2UgdGhlIHN0YW5kYXJkIFhNTEh0dHBSZXF1ZXN0IG9iamVjdFxuICAgICAgICBjcmVhdGVTdGFuZGFyZFhIUjtcblxuLy8gRGV0ZXJtaW5lIHN1cHBvcnQgcHJvcGVydGllc1xuICAgIChmdW5jdGlvbiggeGhyICkge1xuICAgICAgICBqUXVlcnkuZXh0ZW5kKCBqUXVlcnkuc3VwcG9ydCwge1xuICAgICAgICAgICAgYWpheDogISF4aHIsXG4gICAgICAgICAgICBjb3JzOiAhIXhociAmJiAoIFwid2l0aENyZWRlbnRpYWxzXCIgaW4geGhyIClcbiAgICAgICAgfSk7XG4gICAgfSkoIGpRdWVyeS5hamF4U2V0dGluZ3MueGhyKCkgKTtcblxuLy8gQ3JlYXRlIHRyYW5zcG9ydCBpZiB0aGUgYnJvd3NlciBjYW4gcHJvdmlkZSBhbiB4aHJcbiAgICBpZiAoIGpRdWVyeS5zdXBwb3J0LmFqYXggKSB7XG5cbiAgICAgICAgalF1ZXJ5LmFqYXhUcmFuc3BvcnQoZnVuY3Rpb24oIHMgKSB7XG4gICAgICAgICAgICAvLyBDcm9zcyBkb21haW4gb25seSBhbGxvd2VkIGlmIHN1cHBvcnRlZCB0aHJvdWdoIFhNTEh0dHBSZXF1ZXN0XG4gICAgICAgICAgICBpZiAoICFzLmNyb3NzRG9tYWluIHx8IGpRdWVyeS5zdXBwb3J0LmNvcnMgKSB7XG5cbiAgICAgICAgICAgICAgICB2YXIgY2FsbGJhY2s7XG5cbiAgICAgICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgICAgICBzZW5kOiBmdW5jdGlvbiggaGVhZGVycywgY29tcGxldGUgKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIEdldCBhIG5ldyB4aHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciB4aHIgPSBzLnhocigpLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhhbmRsZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBPcGVuIHRoZSBzb2NrZXRcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFBhc3NpbmcgbnVsbCB1c2VybmFtZSwgZ2VuZXJhdGVzIGEgbG9naW4gcG9wdXAgb24gT3BlcmEgKCMyODY1KVxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCBzLnVzZXJuYW1lICkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHhoci5vcGVuKCBzLnR5cGUsIHMudXJsLCBzLmFzeW5jLCBzLnVzZXJuYW1lLCBzLnBhc3N3b3JkICk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHhoci5vcGVuKCBzLnR5cGUsIHMudXJsLCBzLmFzeW5jICk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIEFwcGx5IGN1c3RvbSBmaWVsZHMgaWYgcHJvdmlkZWRcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICggcy54aHJGaWVsZHMgKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yICggaSBpbiBzLnhockZpZWxkcyApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgeGhyWyBpIF0gPSBzLnhockZpZWxkc1sgaSBdO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gT3ZlcnJpZGUgbWltZSB0eXBlIGlmIG5lZWRlZFxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCBzLm1pbWVUeXBlICYmIHhoci5vdmVycmlkZU1pbWVUeXBlICkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHhoci5vdmVycmlkZU1pbWVUeXBlKCBzLm1pbWVUeXBlICk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFgtUmVxdWVzdGVkLVdpdGggaGVhZGVyXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBGb3IgY3Jvc3MtZG9tYWluIHJlcXVlc3RzLCBzZWVpbmcgYXMgY29uZGl0aW9ucyBmb3IgYSBwcmVmbGlnaHQgYXJlXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBha2luIHRvIGEgamlnc2F3IHB1enpsZSwgd2Ugc2ltcGx5IG5ldmVyIHNldCBpdCB0byBiZSBzdXJlLlxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gKGl0IGNhbiBhbHdheXMgYmUgc2V0IG9uIGEgcGVyLXJlcXVlc3QgYmFzaXMgb3IgZXZlbiB1c2luZyBhamF4U2V0dXApXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBGb3Igc2FtZS1kb21haW4gcmVxdWVzdHMsIHdvbid0IGNoYW5nZSBoZWFkZXIgaWYgYWxyZWFkeSBwcm92aWRlZC5cbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICggIXMuY3Jvc3NEb21haW4gJiYgIWhlYWRlcnNbXCJYLVJlcXVlc3RlZC1XaXRoXCJdICkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhlYWRlcnNbIFwiWC1SZXF1ZXN0ZWQtV2l0aFwiIF0gPSBcIlhNTEh0dHBSZXF1ZXN0XCI7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIE5lZWQgYW4gZXh0cmEgdHJ5L2NhdGNoIGZvciBjcm9zcyBkb21haW4gcmVxdWVzdHMgaW4gRmlyZWZveCAzXG4gICAgICAgICAgICAgICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoIGkgaW4gaGVhZGVycyApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgeGhyLnNldFJlcXVlc3RIZWFkZXIoIGksIGhlYWRlcnNbIGkgXSApO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH0gY2F0Y2goIF8gKSB7fVxuXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBEbyBzZW5kIHRoZSByZXF1ZXN0XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBUaGlzIG1heSByYWlzZSBhbiBleGNlcHRpb24gd2hpY2ggaXMgYWN0dWFsbHlcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIGhhbmRsZWQgaW4galF1ZXJ5LmFqYXggKHNvIG5vIHRyeS9jYXRjaCBoZXJlKVxuICAgICAgICAgICAgICAgICAgICAgICAgeGhyLnNlbmQoICggcy5oYXNDb250ZW50ICYmIHMuZGF0YSApIHx8IG51bGwgKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gTGlzdGVuZXJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrID0gZnVuY3Rpb24oIF8sIGlzQWJvcnQgKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgc3RhdHVzLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGF0dXNUZXh0LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXNwb25zZUhlYWRlcnMsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc3BvbnNlcyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgeG1sO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gRmlyZWZveCB0aHJvd3MgZXhjZXB0aW9ucyB3aGVuIGFjY2Vzc2luZyBwcm9wZXJ0aWVzXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gb2YgYW4geGhyIHdoZW4gYSBuZXR3b3JrIGVycm9yIG9jY3VyZWRcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBodHRwOi8vaGVscGZ1bC5rbm9icy1kaWFscy5jb20vaW5kZXgucGhwL0NvbXBvbmVudF9yZXR1cm5lZF9mYWlsdXJlX2NvZGU6XzB4ODAwNDAxMTFfKE5TX0VSUk9SX05PVF9BVkFJTEFCTEUpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJ5IHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBXYXMgbmV2ZXIgY2FsbGVkIGFuZCBpcyBhYm9ydGVkIG9yIGNvbXBsZXRlXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICggY2FsbGJhY2sgJiYgKCBpc0Fib3J0IHx8IHhoci5yZWFkeVN0YXRlID09PSA0ICkgKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIE9ubHkgY2FsbGVkIG9uY2VcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrID0gdW5kZWZpbmVkO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBEbyBub3Qga2VlcCBhcyBhY3RpdmUgYW55bW9yZVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCBoYW5kbGUgKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgeGhyLm9ucmVhZHlzdGF0ZWNoYW5nZSA9IGpRdWVyeS5ub29wO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICggeGhyT25VbmxvYWRBYm9ydCApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVsZXRlIHhockNhbGxiYWNrc1sgaGFuZGxlIF07XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBJZiBpdCdzIGFuIGFib3J0XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIGlzQWJvcnQgKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gQWJvcnQgaXQgbWFudWFsbHkgaWYgbmVlZGVkXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCB4aHIucmVhZHlTdGF0ZSAhPT0gNCApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgeGhyLmFib3J0KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGF0dXMgPSB4aHIuc3RhdHVzO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc3BvbnNlSGVhZGVycyA9IHhoci5nZXRBbGxSZXNwb25zZUhlYWRlcnMoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXNwb25zZXMgPSB7fTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB4bWwgPSB4aHIucmVzcG9uc2VYTUw7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBDb25zdHJ1Y3QgcmVzcG9uc2UgbGlzdFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICggeG1sICYmIHhtbC5kb2N1bWVudEVsZW1lbnQgLyogIzQ5NTggKi8gKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc3BvbnNlcy54bWwgPSB4bWw7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc3BvbnNlcy50ZXh0ID0geGhyLnJlc3BvbnNlVGV4dDtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIEZpcmVmb3ggdGhyb3dzIGFuIGV4Y2VwdGlvbiB3aGVuIGFjY2Vzc2luZ1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIHN0YXR1c1RleHQgZm9yIGZhdWx0eSBjcm9zcy1kb21haW4gcmVxdWVzdHNcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGF0dXNUZXh0ID0geGhyLnN0YXR1c1RleHQ7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBjYXRjaCggZSApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gV2Ugbm9ybWFsaXplIHdpdGggV2Via2l0IGdpdmluZyBhbiBlbXB0eSBzdGF0dXNUZXh0XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YXR1c1RleHQgPSBcIlwiO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIEZpbHRlciBzdGF0dXMgZm9yIG5vbiBzdGFuZGFyZCBiZWhhdmlvcnNcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIElmIHRoZSByZXF1ZXN0IGlzIGxvY2FsIGFuZCB3ZSBoYXZlIGRhdGE6IGFzc3VtZSBhIHN1Y2Nlc3NcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyAoc3VjY2VzcyB3aXRoIG5vIGRhdGEgd29uJ3QgZ2V0IG5vdGlmaWVkLCB0aGF0J3MgdGhlIGJlc3Qgd2VcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBjYW4gZG8gZ2l2ZW4gY3VycmVudCBpbXBsZW1lbnRhdGlvbnMpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCAhc3RhdHVzICYmIHMuaXNMb2NhbCAmJiAhcy5jcm9zc0RvbWFpbiApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhdHVzID0gcmVzcG9uc2VzLnRleHQgPyAyMDAgOiA0MDQ7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIElFIC0gIzE0NTA6IHNvbWV0aW1lcyByZXR1cm5zIDEyMjMgd2hlbiBpdCBzaG91bGQgYmUgMjA0XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmICggc3RhdHVzID09PSAxMjIzICkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGF0dXMgPSAyMDQ7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBjYXRjaCggZmlyZWZveEFjY2Vzc0V4Y2VwdGlvbiApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCAhaXNBYm9ydCApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbXBsZXRlKCAtMSwgZmlyZWZveEFjY2Vzc0V4Y2VwdGlvbiApO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gQ2FsbCBjb21wbGV0ZSBpZiBuZWVkZWRcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIHJlc3BvbnNlcyApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29tcGxldGUoIHN0YXR1cywgc3RhdHVzVGV4dCwgcmVzcG9uc2VzLCByZXNwb25zZUhlYWRlcnMgKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBpZiB3ZSdyZSBpbiBzeW5jIG1vZGUgb3IgaXQncyBpbiBjYWNoZVxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gYW5kIGhhcyBiZWVuIHJldHJpZXZlZCBkaXJlY3RseSAoSUU2ICYgSUU3KVxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gd2UgbmVlZCB0byBtYW51YWxseSBmaXJlIHRoZSBjYWxsYmFja1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCAhcy5hc3luYyB8fCB4aHIucmVhZHlTdGF0ZSA9PT0gNCApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYWxsYmFjaygpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBoYW5kbGUgPSArK3hocklkO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICggeGhyT25VbmxvYWRBYm9ydCApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gQ3JlYXRlIHRoZSBhY3RpdmUgeGhycyBjYWxsYmFja3MgbGlzdCBpZiBuZWVkZWRcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gYW5kIGF0dGFjaCB0aGUgdW5sb2FkIGhhbmRsZXJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCAheGhyQ2FsbGJhY2tzICkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgeGhyQ2FsbGJhY2tzID0ge307XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBqUXVlcnkoIHdpbmRvdyApLnVubG9hZCggeGhyT25VbmxvYWRBYm9ydCApO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIEFkZCB0byBsaXN0IG9mIGFjdGl2ZSB4aHJzIGNhbGxiYWNrc1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB4aHJDYWxsYmFja3NbIGhhbmRsZSBdID0gY2FsbGJhY2s7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHhoci5vbnJlYWR5c3RhdGVjaGFuZ2UgPSBjYWxsYmFjaztcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSxcblxuICAgICAgICAgICAgICAgICAgICBhYm9ydDogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoIGNhbGxiYWNrICkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrKDAsMSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9XG5cblxuXG5cbiAgICB2YXIgZWxlbWRpc3BsYXkgPSB7fSxcbiAgICAgICAgaWZyYW1lLCBpZnJhbWVEb2MsXG4gICAgICAgIHJmeHR5cGVzID0gL14oPzp0b2dnbGV8c2hvd3xoaWRlKSQvLFxuICAgICAgICByZnhudW0gPSAvXihbK1xcLV09KT8oW1xcZCsuXFwtXSspKFthLXolXSopJC9pLFxuICAgICAgICB0aW1lcklkLFxuICAgICAgICBmeEF0dHJzID0gW1xuICAgICAgICAgICAgLy8gaGVpZ2h0IGFuaW1hdGlvbnNcbiAgICAgICAgICAgIFsgXCJoZWlnaHRcIiwgXCJtYXJnaW5Ub3BcIiwgXCJtYXJnaW5Cb3R0b21cIiwgXCJwYWRkaW5nVG9wXCIsIFwicGFkZGluZ0JvdHRvbVwiIF0sXG4gICAgICAgICAgICAvLyB3aWR0aCBhbmltYXRpb25zXG4gICAgICAgICAgICBbIFwid2lkdGhcIiwgXCJtYXJnaW5MZWZ0XCIsIFwibWFyZ2luUmlnaHRcIiwgXCJwYWRkaW5nTGVmdFwiLCBcInBhZGRpbmdSaWdodFwiIF0sXG4gICAgICAgICAgICAvLyBvcGFjaXR5IGFuaW1hdGlvbnNcbiAgICAgICAgICAgIFsgXCJvcGFjaXR5XCIgXVxuICAgICAgICBdLFxuICAgICAgICBmeE5vdztcblxuICAgIGpRdWVyeS5mbi5leHRlbmQoe1xuICAgICAgICBzaG93OiBmdW5jdGlvbiggc3BlZWQsIGVhc2luZywgY2FsbGJhY2sgKSB7XG4gICAgICAgICAgICB2YXIgZWxlbSwgZGlzcGxheTtcblxuICAgICAgICAgICAgaWYgKCBzcGVlZCB8fCBzcGVlZCA9PT0gMCApIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5hbmltYXRlKCBnZW5GeChcInNob3dcIiwgMyksIHNwZWVkLCBlYXNpbmcsIGNhbGxiYWNrICk7XG5cbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgZm9yICggdmFyIGkgPSAwLCBqID0gdGhpcy5sZW5ndGg7IGkgPCBqOyBpKysgKSB7XG4gICAgICAgICAgICAgICAgICAgIGVsZW0gPSB0aGlzWyBpIF07XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKCBlbGVtLnN0eWxlICkge1xuICAgICAgICAgICAgICAgICAgICAgICAgZGlzcGxheSA9IGVsZW0uc3R5bGUuZGlzcGxheTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gUmVzZXQgdGhlIGlubGluZSBkaXNwbGF5IG9mIHRoaXMgZWxlbWVudCB0byBsZWFybiBpZiBpdCBpc1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gYmVpbmcgaGlkZGVuIGJ5IGNhc2NhZGVkIHJ1bGVzIG9yIG5vdFxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCAhalF1ZXJ5Ll9kYXRhKGVsZW0sIFwib2xkZGlzcGxheVwiKSAmJiBkaXNwbGF5ID09PSBcIm5vbmVcIiApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkaXNwbGF5ID0gZWxlbS5zdHlsZS5kaXNwbGF5ID0gXCJcIjtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gU2V0IGVsZW1lbnRzIHdoaWNoIGhhdmUgYmVlbiBvdmVycmlkZGVuIHdpdGggZGlzcGxheTogbm9uZVxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gaW4gYSBzdHlsZXNoZWV0IHRvIHdoYXRldmVyIHRoZSBkZWZhdWx0IGJyb3dzZXIgc3R5bGUgaXNcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIGZvciBzdWNoIGFuIGVsZW1lbnRcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICggZGlzcGxheSA9PT0gXCJcIiAmJiBqUXVlcnkuY3NzKGVsZW0sIFwiZGlzcGxheVwiKSA9PT0gXCJub25lXCIgKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgalF1ZXJ5Ll9kYXRhKCBlbGVtLCBcIm9sZGRpc3BsYXlcIiwgZGVmYXVsdERpc3BsYXkoZWxlbS5ub2RlTmFtZSkgKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIC8vIFNldCB0aGUgZGlzcGxheSBvZiBtb3N0IG9mIHRoZSBlbGVtZW50cyBpbiBhIHNlY29uZCBsb29wXG4gICAgICAgICAgICAgICAgLy8gdG8gYXZvaWQgdGhlIGNvbnN0YW50IHJlZmxvd1xuICAgICAgICAgICAgICAgIGZvciAoIGkgPSAwOyBpIDwgajsgaSsrICkge1xuICAgICAgICAgICAgICAgICAgICBlbGVtID0gdGhpc1sgaSBdO1xuXG4gICAgICAgICAgICAgICAgICAgIGlmICggZWxlbS5zdHlsZSApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGRpc3BsYXkgPSBlbGVtLnN0eWxlLmRpc3BsYXk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICggZGlzcGxheSA9PT0gXCJcIiB8fCBkaXNwbGF5ID09PSBcIm5vbmVcIiApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbGVtLnN0eWxlLmRpc3BsYXkgPSBqUXVlcnkuX2RhdGEoIGVsZW0sIFwib2xkZGlzcGxheVwiICkgfHwgXCJcIjtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIGhpZGU6IGZ1bmN0aW9uKCBzcGVlZCwgZWFzaW5nLCBjYWxsYmFjayApIHtcbiAgICAgICAgICAgIGlmICggc3BlZWQgfHwgc3BlZWQgPT09IDAgKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuYW5pbWF0ZSggZ2VuRngoXCJoaWRlXCIsIDMpLCBzcGVlZCwgZWFzaW5nLCBjYWxsYmFjayk7XG5cbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdmFyIGVsZW0sIGRpc3BsYXksXG4gICAgICAgICAgICAgICAgICAgIGkgPSAwLFxuICAgICAgICAgICAgICAgICAgICBqID0gdGhpcy5sZW5ndGg7XG5cbiAgICAgICAgICAgICAgICBmb3IgKCA7IGkgPCBqOyBpKysgKSB7XG4gICAgICAgICAgICAgICAgICAgIGVsZW0gPSB0aGlzW2ldO1xuICAgICAgICAgICAgICAgICAgICBpZiAoIGVsZW0uc3R5bGUgKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBkaXNwbGF5ID0galF1ZXJ5LmNzcyggZWxlbSwgXCJkaXNwbGF5XCIgKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCBkaXNwbGF5ICE9PSBcIm5vbmVcIiAmJiAhalF1ZXJ5Ll9kYXRhKCBlbGVtLCBcIm9sZGRpc3BsYXlcIiApICkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGpRdWVyeS5fZGF0YSggZWxlbSwgXCJvbGRkaXNwbGF5XCIsIGRpc3BsYXkgKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIC8vIFNldCB0aGUgZGlzcGxheSBvZiB0aGUgZWxlbWVudHMgaW4gYSBzZWNvbmQgbG9vcFxuICAgICAgICAgICAgICAgIC8vIHRvIGF2b2lkIHRoZSBjb25zdGFudCByZWZsb3dcbiAgICAgICAgICAgICAgICBmb3IgKCBpID0gMDsgaSA8IGo7IGkrKyApIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCB0aGlzW2ldLnN0eWxlICkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpc1tpXS5zdHlsZS5kaXNwbGF5ID0gXCJub25lXCI7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcztcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcblxuICAgICAgICAvLyBTYXZlIHRoZSBvbGQgdG9nZ2xlIGZ1bmN0aW9uXG4gICAgICAgIF90b2dnbGU6IGpRdWVyeS5mbi50b2dnbGUsXG5cbiAgICAgICAgdG9nZ2xlOiBmdW5jdGlvbiggZm4sIGZuMiwgY2FsbGJhY2sgKSB7XG4gICAgICAgICAgICB2YXIgYm9vbCA9IHR5cGVvZiBmbiA9PT0gXCJib29sZWFuXCI7XG5cbiAgICAgICAgICAgIGlmICggalF1ZXJ5LmlzRnVuY3Rpb24oZm4pICYmIGpRdWVyeS5pc0Z1bmN0aW9uKGZuMikgKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5fdG9nZ2xlLmFwcGx5KCB0aGlzLCBhcmd1bWVudHMgKTtcblxuICAgICAgICAgICAgfSBlbHNlIGlmICggZm4gPT0gbnVsbCB8fCBib29sICkge1xuICAgICAgICAgICAgICAgIHRoaXMuZWFjaChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIHN0YXRlID0gYm9vbCA/IGZuIDogalF1ZXJ5KHRoaXMpLmlzKFwiOmhpZGRlblwiKTtcbiAgICAgICAgICAgICAgICAgICAgalF1ZXJ5KHRoaXMpWyBzdGF0ZSA/IFwic2hvd1wiIDogXCJoaWRlXCIgXSgpO1xuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHRoaXMuYW5pbWF0ZShnZW5GeChcInRvZ2dsZVwiLCAzKSwgZm4sIGZuMiwgY2FsbGJhY2spO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByZXR1cm4gdGhpcztcbiAgICAgICAgfSxcblxuICAgICAgICBmYWRlVG86IGZ1bmN0aW9uKCBzcGVlZCwgdG8sIGVhc2luZywgY2FsbGJhY2sgKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5maWx0ZXIoXCI6aGlkZGVuXCIpLmNzcyhcIm9wYWNpdHlcIiwgMCkuc2hvdygpLmVuZCgpXG4gICAgICAgICAgICAgICAgLmFuaW1hdGUoe29wYWNpdHk6IHRvfSwgc3BlZWQsIGVhc2luZywgY2FsbGJhY2spO1xuICAgICAgICB9LFxuXG4gICAgICAgIGFuaW1hdGU6IGZ1bmN0aW9uKCBwcm9wLCBzcGVlZCwgZWFzaW5nLCBjYWxsYmFjayApIHtcbiAgICAgICAgICAgIHZhciBvcHRhbGwgPSBqUXVlcnkuc3BlZWQoIHNwZWVkLCBlYXNpbmcsIGNhbGxiYWNrICk7XG5cbiAgICAgICAgICAgIGlmICggalF1ZXJ5LmlzRW1wdHlPYmplY3QoIHByb3AgKSApIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5lYWNoKCBvcHRhbGwuY29tcGxldGUsIFsgZmFsc2UgXSApO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBEbyBub3QgY2hhbmdlIHJlZmVyZW5jZWQgcHJvcGVydGllcyBhcyBwZXItcHJvcGVydHkgZWFzaW5nIHdpbGwgYmUgbG9zdFxuICAgICAgICAgICAgcHJvcCA9IGpRdWVyeS5leHRlbmQoIHt9LCBwcm9wICk7XG5cbiAgICAgICAgICAgIGZ1bmN0aW9uIGRvQW5pbWF0aW9uKCkge1xuICAgICAgICAgICAgICAgIC8vIFhYWCAndGhpcycgZG9lcyBub3QgYWx3YXlzIGhhdmUgYSBub2RlTmFtZSB3aGVuIHJ1bm5pbmcgdGhlXG4gICAgICAgICAgICAgICAgLy8gdGVzdCBzdWl0ZVxuXG4gICAgICAgICAgICAgICAgaWYgKCBvcHRhbGwucXVldWUgPT09IGZhbHNlICkge1xuICAgICAgICAgICAgICAgICAgICBqUXVlcnkuX21hcmsoIHRoaXMgKTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICB2YXIgb3B0ID0galF1ZXJ5LmV4dGVuZCgge30sIG9wdGFsbCApLFxuICAgICAgICAgICAgICAgICAgICBpc0VsZW1lbnQgPSB0aGlzLm5vZGVUeXBlID09PSAxLFxuICAgICAgICAgICAgICAgICAgICBoaWRkZW4gPSBpc0VsZW1lbnQgJiYgalF1ZXJ5KHRoaXMpLmlzKFwiOmhpZGRlblwiKSxcbiAgICAgICAgICAgICAgICAgICAgbmFtZSwgdmFsLCBwLCBlLFxuICAgICAgICAgICAgICAgICAgICBwYXJ0cywgc3RhcnQsIGVuZCwgdW5pdCxcbiAgICAgICAgICAgICAgICAgICAgbWV0aG9kO1xuXG4gICAgICAgICAgICAgICAgLy8gd2lsbCBzdG9yZSBwZXIgcHJvcGVydHkgZWFzaW5nIGFuZCBiZSB1c2VkIHRvIGRldGVybWluZSB3aGVuIGFuIGFuaW1hdGlvbiBpcyBjb21wbGV0ZVxuICAgICAgICAgICAgICAgIG9wdC5hbmltYXRlZFByb3BlcnRpZXMgPSB7fTtcblxuICAgICAgICAgICAgICAgIGZvciAoIHAgaW4gcHJvcCApIHtcblxuICAgICAgICAgICAgICAgICAgICAvLyBwcm9wZXJ0eSBuYW1lIG5vcm1hbGl6YXRpb25cbiAgICAgICAgICAgICAgICAgICAgbmFtZSA9IGpRdWVyeS5jYW1lbENhc2UoIHAgKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCBwICE9PSBuYW1lICkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcHJvcFsgbmFtZSBdID0gcHJvcFsgcCBdO1xuICAgICAgICAgICAgICAgICAgICAgICAgZGVsZXRlIHByb3BbIHAgXTtcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIHZhbCA9IHByb3BbIG5hbWUgXTtcblxuICAgICAgICAgICAgICAgICAgICAvLyBlYXNpbmcgcmVzb2x1dGlvbjogcGVyIHByb3BlcnR5ID4gb3B0LnNwZWNpYWxFYXNpbmcgPiBvcHQuZWFzaW5nID4gJ3N3aW5nJyAoZGVmYXVsdClcbiAgICAgICAgICAgICAgICAgICAgaWYgKCBqUXVlcnkuaXNBcnJheSggdmFsICkgKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBvcHQuYW5pbWF0ZWRQcm9wZXJ0aWVzWyBuYW1lIF0gPSB2YWxbIDEgXTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhbCA9IHByb3BbIG5hbWUgXSA9IHZhbFsgMCBdO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgb3B0LmFuaW1hdGVkUHJvcGVydGllc1sgbmFtZSBdID0gb3B0LnNwZWNpYWxFYXNpbmcgJiYgb3B0LnNwZWNpYWxFYXNpbmdbIG5hbWUgXSB8fCBvcHQuZWFzaW5nIHx8ICdzd2luZyc7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICBpZiAoIHZhbCA9PT0gXCJoaWRlXCIgJiYgaGlkZGVuIHx8IHZhbCA9PT0gXCJzaG93XCIgJiYgIWhpZGRlbiApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBvcHQuY29tcGxldGUuY2FsbCggdGhpcyApO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKCBpc0VsZW1lbnQgJiYgKCBuYW1lID09PSBcImhlaWdodFwiIHx8IG5hbWUgPT09IFwid2lkdGhcIiApICkge1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gTWFrZSBzdXJlIHRoYXQgbm90aGluZyBzbmVha3Mgb3V0XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBSZWNvcmQgYWxsIDMgb3ZlcmZsb3cgYXR0cmlidXRlcyBiZWNhdXNlIElFIGRvZXMgbm90XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBjaGFuZ2UgdGhlIG92ZXJmbG93IGF0dHJpYnV0ZSB3aGVuIG92ZXJmbG93WCBhbmRcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIG92ZXJmbG93WSBhcmUgc2V0IHRvIHRoZSBzYW1lIHZhbHVlXG4gICAgICAgICAgICAgICAgICAgICAgICBvcHQub3ZlcmZsb3cgPSBbIHRoaXMuc3R5bGUub3ZlcmZsb3csIHRoaXMuc3R5bGUub3ZlcmZsb3dYLCB0aGlzLnN0eWxlLm92ZXJmbG93WSBdO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBTZXQgZGlzcGxheSBwcm9wZXJ0eSB0byBpbmxpbmUtYmxvY2sgZm9yIGhlaWdodC93aWR0aFxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gYW5pbWF0aW9ucyBvbiBpbmxpbmUgZWxlbWVudHMgdGhhdCBhcmUgaGF2aW5nIHdpZHRoL2hlaWdodCBhbmltYXRlZFxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCBqUXVlcnkuY3NzKCB0aGlzLCBcImRpc3BsYXlcIiApID09PSBcImlubGluZVwiICYmXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgalF1ZXJ5LmNzcyggdGhpcywgXCJmbG9hdFwiICkgPT09IFwibm9uZVwiICkge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gaW5saW5lLWxldmVsIGVsZW1lbnRzIGFjY2VwdCBpbmxpbmUtYmxvY2s7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gYmxvY2stbGV2ZWwgZWxlbWVudHMgbmVlZCB0byBiZSBpbmxpbmUgd2l0aCBsYXlvdXRcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoICFqUXVlcnkuc3VwcG9ydC5pbmxpbmVCbG9ja05lZWRzTGF5b3V0IHx8IGRlZmF1bHREaXNwbGF5KCB0aGlzLm5vZGVOYW1lICkgPT09IFwiaW5saW5lXCIgKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc3R5bGUuZGlzcGxheSA9IFwiaW5saW5lLWJsb2NrXCI7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnN0eWxlLnpvb20gPSAxO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGlmICggb3B0Lm92ZXJmbG93ICE9IG51bGwgKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc3R5bGUub3ZlcmZsb3cgPSBcImhpZGRlblwiO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGZvciAoIHAgaW4gcHJvcCApIHtcbiAgICAgICAgICAgICAgICAgICAgZSA9IG5ldyBqUXVlcnkuZngoIHRoaXMsIG9wdCwgcCApO1xuICAgICAgICAgICAgICAgICAgICB2YWwgPSBwcm9wWyBwIF07XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKCByZnh0eXBlcy50ZXN0KCB2YWwgKSApIHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gVHJhY2tzIHdoZXRoZXIgdG8gc2hvdyBvciBoaWRlIGJhc2VkIG9uIHByaXZhdGVcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIGRhdGEgYXR0YWNoZWQgdG8gdGhlIGVsZW1lbnRcbiAgICAgICAgICAgICAgICAgICAgICAgIG1ldGhvZCA9IGpRdWVyeS5fZGF0YSggdGhpcywgXCJ0b2dnbGVcIiArIHAgKSB8fCAoIHZhbCA9PT0gXCJ0b2dnbGVcIiA/IGhpZGRlbiA/IFwic2hvd1wiIDogXCJoaWRlXCIgOiAwICk7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoIG1ldGhvZCApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBqUXVlcnkuX2RhdGEoIHRoaXMsIFwidG9nZ2xlXCIgKyBwLCBtZXRob2QgPT09IFwic2hvd1wiID8gXCJoaWRlXCIgOiBcInNob3dcIiApO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVbIG1ldGhvZCBdKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVbIHZhbCBdKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHBhcnRzID0gcmZ4bnVtLmV4ZWMoIHZhbCApO1xuICAgICAgICAgICAgICAgICAgICAgICAgc3RhcnQgPSBlLmN1cigpO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoIHBhcnRzICkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZCA9IHBhcnNlRmxvYXQoIHBhcnRzWzJdICk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdW5pdCA9IHBhcnRzWzNdIHx8ICggalF1ZXJ5LmNzc051bWJlclsgcCBdID8gXCJcIiA6IFwicHhcIiApO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gV2UgbmVlZCB0byBjb21wdXRlIHN0YXJ0aW5nIHZhbHVlXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCB1bml0ICE9PSBcInB4XCIgKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGpRdWVyeS5zdHlsZSggdGhpcywgcCwgKGVuZCB8fCAxKSArIHVuaXQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGFydCA9ICggKGVuZCB8fCAxKSAvIGUuY3VyKCkgKSAqIHN0YXJ0O1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBqUXVlcnkuc3R5bGUoIHRoaXMsIHAsIHN0YXJ0ICsgdW5pdCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gSWYgYSArPS8tPSB0b2tlbiB3YXMgcHJvdmlkZWQsIHdlJ3JlIGRvaW5nIGEgcmVsYXRpdmUgYW5pbWF0aW9uXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCBwYXJ0c1sxXSApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kID0gKCAocGFydHNbIDEgXSA9PT0gXCItPVwiID8gLTEgOiAxKSAqIGVuZCApICsgc3RhcnQ7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZS5jdXN0b20oIHN0YXJ0LCBlbmQsIHVuaXQgKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlLmN1c3RvbSggc3RhcnQsIHZhbCwgXCJcIiApO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgLy8gRm9yIEpTIHN0cmljdCBjb21wbGlhbmNlXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHJldHVybiBvcHRhbGwucXVldWUgPT09IGZhbHNlID9cbiAgICAgICAgICAgICAgICB0aGlzLmVhY2goIGRvQW5pbWF0aW9uICkgOlxuICAgICAgICAgICAgICAgIHRoaXMucXVldWUoIG9wdGFsbC5xdWV1ZSwgZG9BbmltYXRpb24gKTtcbiAgICAgICAgfSxcblxuICAgICAgICBzdG9wOiBmdW5jdGlvbiggdHlwZSwgY2xlYXJRdWV1ZSwgZ290b0VuZCApIHtcbiAgICAgICAgICAgIGlmICggdHlwZW9mIHR5cGUgIT09IFwic3RyaW5nXCIgKSB7XG4gICAgICAgICAgICAgICAgZ290b0VuZCA9IGNsZWFyUXVldWU7XG4gICAgICAgICAgICAgICAgY2xlYXJRdWV1ZSA9IHR5cGU7XG4gICAgICAgICAgICAgICAgdHlwZSA9IHVuZGVmaW5lZDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICggY2xlYXJRdWV1ZSAmJiB0eXBlICE9PSBmYWxzZSApIHtcbiAgICAgICAgICAgICAgICB0aGlzLnF1ZXVlKCB0eXBlIHx8IFwiZnhcIiwgW10gKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICB2YXIgaW5kZXgsXG4gICAgICAgICAgICAgICAgICAgIGhhZFRpbWVycyA9IGZhbHNlLFxuICAgICAgICAgICAgICAgICAgICB0aW1lcnMgPSBqUXVlcnkudGltZXJzLFxuICAgICAgICAgICAgICAgICAgICBkYXRhID0galF1ZXJ5Ll9kYXRhKCB0aGlzICk7XG5cbiAgICAgICAgICAgICAgICAvLyBjbGVhciBtYXJrZXIgY291bnRlcnMgaWYgd2Uga25vdyB0aGV5IHdvbid0IGJlXG4gICAgICAgICAgICAgICAgaWYgKCAhZ290b0VuZCApIHtcbiAgICAgICAgICAgICAgICAgICAgalF1ZXJ5Ll91bm1hcmsoIHRydWUsIHRoaXMgKTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBmdW5jdGlvbiBzdG9wUXVldWUoIGVsZW0sIGRhdGEsIGluZGV4ICkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgaG9va3MgPSBkYXRhWyBpbmRleCBdO1xuICAgICAgICAgICAgICAgICAgICBqUXVlcnkucmVtb3ZlRGF0YSggZWxlbSwgaW5kZXgsIHRydWUgKTtcbiAgICAgICAgICAgICAgICAgICAgaG9va3Muc3RvcCggZ290b0VuZCApO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGlmICggdHlwZSA9PSBudWxsICkge1xuICAgICAgICAgICAgICAgICAgICBmb3IgKCBpbmRleCBpbiBkYXRhICkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCBkYXRhWyBpbmRleCBdICYmIGRhdGFbIGluZGV4IF0uc3RvcCAmJiBpbmRleC5pbmRleE9mKFwiLnJ1blwiKSA9PT0gaW5kZXgubGVuZ3RoIC0gNCApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdG9wUXVldWUoIHRoaXMsIGRhdGEsIGluZGV4ICk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKCBkYXRhWyBpbmRleCA9IHR5cGUgKyBcIi5ydW5cIiBdICYmIGRhdGFbIGluZGV4IF0uc3RvcCApe1xuICAgICAgICAgICAgICAgICAgICBzdG9wUXVldWUoIHRoaXMsIGRhdGEsIGluZGV4ICk7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgZm9yICggaW5kZXggPSB0aW1lcnMubGVuZ3RoOyBpbmRleC0tOyApIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCB0aW1lcnNbIGluZGV4IF0uZWxlbSA9PT0gdGhpcyAmJiAodHlwZSA9PSBudWxsIHx8IHRpbWVyc1sgaW5kZXggXS5xdWV1ZSA9PT0gdHlwZSkgKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoIGdvdG9FbmQgKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBmb3JjZSB0aGUgbmV4dCBzdGVwIHRvIGJlIHRoZSBsYXN0XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGltZXJzWyBpbmRleCBdKCB0cnVlICk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRpbWVyc1sgaW5kZXggXS5zYXZlU3RhdGUoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGhhZFRpbWVycyA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aW1lcnMuc3BsaWNlKCBpbmRleCwgMSApO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgLy8gc3RhcnQgdGhlIG5leHQgaW4gdGhlIHF1ZXVlIGlmIHRoZSBsYXN0IHN0ZXAgd2Fzbid0IGZvcmNlZFxuICAgICAgICAgICAgICAgIC8vIHRpbWVycyBjdXJyZW50bHkgd2lsbCBjYWxsIHRoZWlyIGNvbXBsZXRlIGNhbGxiYWNrcywgd2hpY2ggd2lsbCBkZXF1ZXVlXG4gICAgICAgICAgICAgICAgLy8gYnV0IG9ubHkgaWYgdGhleSB3ZXJlIGdvdG9FbmRcbiAgICAgICAgICAgICAgICBpZiAoICEoIGdvdG9FbmQgJiYgaGFkVGltZXJzICkgKSB7XG4gICAgICAgICAgICAgICAgICAgIGpRdWVyeS5kZXF1ZXVlKCB0aGlzLCB0eXBlICk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cblxuICAgIH0pO1xuXG4vLyBBbmltYXRpb25zIGNyZWF0ZWQgc3luY2hyb25vdXNseSB3aWxsIHJ1biBzeW5jaHJvbm91c2x5XG4gICAgZnVuY3Rpb24gY3JlYXRlRnhOb3coKSB7XG4gICAgICAgIHNldFRpbWVvdXQoIGNsZWFyRnhOb3csIDAgKTtcbiAgICAgICAgcmV0dXJuICggZnhOb3cgPSBqUXVlcnkubm93KCkgKTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBjbGVhckZ4Tm93KCkge1xuICAgICAgICBmeE5vdyA9IHVuZGVmaW5lZDtcbiAgICB9XG5cbi8vIEdlbmVyYXRlIHBhcmFtZXRlcnMgdG8gY3JlYXRlIGEgc3RhbmRhcmQgYW5pbWF0aW9uXG4gICAgZnVuY3Rpb24gZ2VuRngoIHR5cGUsIG51bSApIHtcbiAgICAgICAgdmFyIG9iaiA9IHt9O1xuXG4gICAgICAgIGpRdWVyeS5lYWNoKCBmeEF0dHJzLmNvbmNhdC5hcHBseShbXSwgZnhBdHRycy5zbGljZSggMCwgbnVtICkpLCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIG9ialsgdGhpcyBdID0gdHlwZTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgcmV0dXJuIG9iajtcbiAgICB9XG5cbi8vIEdlbmVyYXRlIHNob3J0Y3V0cyBmb3IgY3VzdG9tIGFuaW1hdGlvbnNcbiAgICBqUXVlcnkuZWFjaCh7XG4gICAgICAgIHNsaWRlRG93bjogZ2VuRngoIFwic2hvd1wiLCAxICksXG4gICAgICAgIHNsaWRlVXA6IGdlbkZ4KCBcImhpZGVcIiwgMSApLFxuICAgICAgICBzbGlkZVRvZ2dsZTogZ2VuRngoIFwidG9nZ2xlXCIsIDEgKSxcbiAgICAgICAgZmFkZUluOiB7IG9wYWNpdHk6IFwic2hvd1wiIH0sXG4gICAgICAgIGZhZGVPdXQ6IHsgb3BhY2l0eTogXCJoaWRlXCIgfSxcbiAgICAgICAgZmFkZVRvZ2dsZTogeyBvcGFjaXR5OiBcInRvZ2dsZVwiIH1cbiAgICB9LCBmdW5jdGlvbiggbmFtZSwgcHJvcHMgKSB7XG4gICAgICAgIGpRdWVyeS5mblsgbmFtZSBdID0gZnVuY3Rpb24oIHNwZWVkLCBlYXNpbmcsIGNhbGxiYWNrICkge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuYW5pbWF0ZSggcHJvcHMsIHNwZWVkLCBlYXNpbmcsIGNhbGxiYWNrICk7XG4gICAgICAgIH07XG4gICAgfSk7XG5cbiAgICBqUXVlcnkuZXh0ZW5kKHtcbiAgICAgICAgc3BlZWQ6IGZ1bmN0aW9uKCBzcGVlZCwgZWFzaW5nLCBmbiApIHtcbiAgICAgICAgICAgIHZhciBvcHQgPSBzcGVlZCAmJiB0eXBlb2Ygc3BlZWQgPT09IFwib2JqZWN0XCIgPyBqUXVlcnkuZXh0ZW5kKCB7fSwgc3BlZWQgKSA6IHtcbiAgICAgICAgICAgICAgICBjb21wbGV0ZTogZm4gfHwgIWZuICYmIGVhc2luZyB8fFxuICAgICAgICAgICAgICAgIGpRdWVyeS5pc0Z1bmN0aW9uKCBzcGVlZCApICYmIHNwZWVkLFxuICAgICAgICAgICAgICAgIGR1cmF0aW9uOiBzcGVlZCxcbiAgICAgICAgICAgICAgICBlYXNpbmc6IGZuICYmIGVhc2luZyB8fCBlYXNpbmcgJiYgIWpRdWVyeS5pc0Z1bmN0aW9uKCBlYXNpbmcgKSAmJiBlYXNpbmdcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIG9wdC5kdXJhdGlvbiA9IGpRdWVyeS5meC5vZmYgPyAwIDogdHlwZW9mIG9wdC5kdXJhdGlvbiA9PT0gXCJudW1iZXJcIiA/IG9wdC5kdXJhdGlvbiA6XG4gICAgICAgICAgICAgICAgb3B0LmR1cmF0aW9uIGluIGpRdWVyeS5meC5zcGVlZHMgPyBqUXVlcnkuZnguc3BlZWRzWyBvcHQuZHVyYXRpb24gXSA6IGpRdWVyeS5meC5zcGVlZHMuX2RlZmF1bHQ7XG5cbiAgICAgICAgICAgIC8vIG5vcm1hbGl6ZSBvcHQucXVldWUgLSB0cnVlL3VuZGVmaW5lZC9udWxsIC0+IFwiZnhcIlxuICAgICAgICAgICAgaWYgKCBvcHQucXVldWUgPT0gbnVsbCB8fCBvcHQucXVldWUgPT09IHRydWUgKSB7XG4gICAgICAgICAgICAgICAgb3B0LnF1ZXVlID0gXCJmeFwiO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBRdWV1ZWluZ1xuICAgICAgICAgICAgb3B0Lm9sZCA9IG9wdC5jb21wbGV0ZTtcblxuICAgICAgICAgICAgb3B0LmNvbXBsZXRlID0gZnVuY3Rpb24oIG5vVW5tYXJrICkge1xuICAgICAgICAgICAgICAgIGlmICggalF1ZXJ5LmlzRnVuY3Rpb24oIG9wdC5vbGQgKSApIHtcbiAgICAgICAgICAgICAgICAgICAgb3B0Lm9sZC5jYWxsKCB0aGlzICk7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgaWYgKCBvcHQucXVldWUgKSB7XG4gICAgICAgICAgICAgICAgICAgIGpRdWVyeS5kZXF1ZXVlKCB0aGlzLCBvcHQucXVldWUgKTtcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKCBub1VubWFyayAhPT0gZmFsc2UgKSB7XG4gICAgICAgICAgICAgICAgICAgIGpRdWVyeS5fdW5tYXJrKCB0aGlzICk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgcmV0dXJuIG9wdDtcbiAgICAgICAgfSxcblxuICAgICAgICBlYXNpbmc6IHtcbiAgICAgICAgICAgIGxpbmVhcjogZnVuY3Rpb24oIHAsIG4sIGZpcnN0TnVtLCBkaWZmICkge1xuICAgICAgICAgICAgICAgIHJldHVybiBmaXJzdE51bSArIGRpZmYgKiBwO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHN3aW5nOiBmdW5jdGlvbiggcCwgbiwgZmlyc3ROdW0sIGRpZmYgKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuICggKCAtTWF0aC5jb3MoIHAqTWF0aC5QSSApIC8gMiApICsgMC41ICkgKiBkaWZmICsgZmlyc3ROdW07XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sXG5cbiAgICAgICAgdGltZXJzOiBbXSxcblxuICAgICAgICBmeDogZnVuY3Rpb24oIGVsZW0sIG9wdGlvbnMsIHByb3AgKSB7XG4gICAgICAgICAgICB0aGlzLm9wdGlvbnMgPSBvcHRpb25zO1xuICAgICAgICAgICAgdGhpcy5lbGVtID0gZWxlbTtcbiAgICAgICAgICAgIHRoaXMucHJvcCA9IHByb3A7XG5cbiAgICAgICAgICAgIG9wdGlvbnMub3JpZyA9IG9wdGlvbnMub3JpZyB8fCB7fTtcbiAgICAgICAgfVxuXG4gICAgfSk7XG5cbiAgICBqUXVlcnkuZngucHJvdG90eXBlID0ge1xuICAgICAgICAvLyBTaW1wbGUgZnVuY3Rpb24gZm9yIHNldHRpbmcgYSBzdHlsZSB2YWx1ZVxuICAgICAgICB1cGRhdGU6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgaWYgKCB0aGlzLm9wdGlvbnMuc3RlcCApIHtcbiAgICAgICAgICAgICAgICB0aGlzLm9wdGlvbnMuc3RlcC5jYWxsKCB0aGlzLmVsZW0sIHRoaXMubm93LCB0aGlzICk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICggalF1ZXJ5LmZ4LnN0ZXBbIHRoaXMucHJvcCBdIHx8IGpRdWVyeS5meC5zdGVwLl9kZWZhdWx0ICkoIHRoaXMgKTtcbiAgICAgICAgfSxcblxuICAgICAgICAvLyBHZXQgdGhlIGN1cnJlbnQgc2l6ZVxuICAgICAgICBjdXI6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgaWYgKCB0aGlzLmVsZW1bIHRoaXMucHJvcCBdICE9IG51bGwgJiYgKCF0aGlzLmVsZW0uc3R5bGUgfHwgdGhpcy5lbGVtLnN0eWxlWyB0aGlzLnByb3AgXSA9PSBudWxsKSApIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5lbGVtWyB0aGlzLnByb3AgXTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdmFyIHBhcnNlZCxcbiAgICAgICAgICAgICAgICByID0galF1ZXJ5LmNzcyggdGhpcy5lbGVtLCB0aGlzLnByb3AgKTtcbiAgICAgICAgICAgIC8vIEVtcHR5IHN0cmluZ3MsIG51bGwsIHVuZGVmaW5lZCBhbmQgXCJhdXRvXCIgYXJlIGNvbnZlcnRlZCB0byAwLFxuICAgICAgICAgICAgLy8gY29tcGxleCB2YWx1ZXMgc3VjaCBhcyBcInJvdGF0ZSgxcmFkKVwiIGFyZSByZXR1cm5lZCBhcyBpcyxcbiAgICAgICAgICAgIC8vIHNpbXBsZSB2YWx1ZXMgc3VjaCBhcyBcIjEwcHhcIiBhcmUgcGFyc2VkIHRvIEZsb2F0LlxuICAgICAgICAgICAgcmV0dXJuIGlzTmFOKCBwYXJzZWQgPSBwYXJzZUZsb2F0KCByICkgKSA/ICFyIHx8IHIgPT09IFwiYXV0b1wiID8gMCA6IHIgOiBwYXJzZWQ7XG4gICAgICAgIH0sXG5cbiAgICAgICAgLy8gU3RhcnQgYW4gYW5pbWF0aW9uIGZyb20gb25lIG51bWJlciB0byBhbm90aGVyXG4gICAgICAgIGN1c3RvbTogZnVuY3Rpb24oIGZyb20sIHRvLCB1bml0ICkge1xuICAgICAgICAgICAgdmFyIHNlbGYgPSB0aGlzLFxuICAgICAgICAgICAgICAgIGZ4ID0galF1ZXJ5LmZ4O1xuXG4gICAgICAgICAgICB0aGlzLnN0YXJ0VGltZSA9IGZ4Tm93IHx8IGNyZWF0ZUZ4Tm93KCk7XG4gICAgICAgICAgICB0aGlzLmVuZCA9IHRvO1xuICAgICAgICAgICAgdGhpcy5ub3cgPSB0aGlzLnN0YXJ0ID0gZnJvbTtcbiAgICAgICAgICAgIHRoaXMucG9zID0gdGhpcy5zdGF0ZSA9IDA7XG4gICAgICAgICAgICB0aGlzLnVuaXQgPSB1bml0IHx8IHRoaXMudW5pdCB8fCAoIGpRdWVyeS5jc3NOdW1iZXJbIHRoaXMucHJvcCBdID8gXCJcIiA6IFwicHhcIiApO1xuXG4gICAgICAgICAgICBmdW5jdGlvbiB0KCBnb3RvRW5kICkge1xuICAgICAgICAgICAgICAgIHJldHVybiBzZWxmLnN0ZXAoIGdvdG9FbmQgKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdC5xdWV1ZSA9IHRoaXMub3B0aW9ucy5xdWV1ZTtcbiAgICAgICAgICAgIHQuZWxlbSA9IHRoaXMuZWxlbTtcbiAgICAgICAgICAgIHQuc2F2ZVN0YXRlID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgaWYgKCBzZWxmLm9wdGlvbnMuaGlkZSAmJiBqUXVlcnkuX2RhdGEoIHNlbGYuZWxlbSwgXCJmeHNob3dcIiArIHNlbGYucHJvcCApID09PSB1bmRlZmluZWQgKSB7XG4gICAgICAgICAgICAgICAgICAgIGpRdWVyeS5fZGF0YSggc2VsZi5lbGVtLCBcImZ4c2hvd1wiICsgc2VsZi5wcm9wLCBzZWxmLnN0YXJ0ICk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgaWYgKCB0KCkgJiYgalF1ZXJ5LnRpbWVycy5wdXNoKHQpICYmICF0aW1lcklkICkge1xuICAgICAgICAgICAgICAgIHRpbWVySWQgPSBzZXRJbnRlcnZhbCggZngudGljaywgZnguaW50ZXJ2YWwgKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcblxuICAgICAgICAvLyBTaW1wbGUgJ3Nob3cnIGZ1bmN0aW9uXG4gICAgICAgIHNob3c6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgdmFyIGRhdGFTaG93ID0galF1ZXJ5Ll9kYXRhKCB0aGlzLmVsZW0sIFwiZnhzaG93XCIgKyB0aGlzLnByb3AgKTtcblxuICAgICAgICAgICAgLy8gUmVtZW1iZXIgd2hlcmUgd2Ugc3RhcnRlZCwgc28gdGhhdCB3ZSBjYW4gZ28gYmFjayB0byBpdCBsYXRlclxuICAgICAgICAgICAgdGhpcy5vcHRpb25zLm9yaWdbIHRoaXMucHJvcCBdID0gZGF0YVNob3cgfHwgalF1ZXJ5LnN0eWxlKCB0aGlzLmVsZW0sIHRoaXMucHJvcCApO1xuICAgICAgICAgICAgdGhpcy5vcHRpb25zLnNob3cgPSB0cnVlO1xuXG4gICAgICAgICAgICAvLyBCZWdpbiB0aGUgYW5pbWF0aW9uXG4gICAgICAgICAgICAvLyBNYWtlIHN1cmUgdGhhdCB3ZSBzdGFydCBhdCBhIHNtYWxsIHdpZHRoL2hlaWdodCB0byBhdm9pZCBhbnkgZmxhc2ggb2YgY29udGVudFxuICAgICAgICAgICAgaWYgKCBkYXRhU2hvdyAhPT0gdW5kZWZpbmVkICkge1xuICAgICAgICAgICAgICAgIC8vIFRoaXMgc2hvdyBpcyBwaWNraW5nIHVwIHdoZXJlIGEgcHJldmlvdXMgaGlkZSBvciBzaG93IGxlZnQgb2ZmXG4gICAgICAgICAgICAgICAgdGhpcy5jdXN0b20oIHRoaXMuY3VyKCksIGRhdGFTaG93ICk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHRoaXMuY3VzdG9tKCB0aGlzLnByb3AgPT09IFwid2lkdGhcIiB8fCB0aGlzLnByb3AgPT09IFwiaGVpZ2h0XCIgPyAxIDogMCwgdGhpcy5jdXIoKSApO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBTdGFydCBieSBzaG93aW5nIHRoZSBlbGVtZW50XG4gICAgICAgICAgICBqUXVlcnkoIHRoaXMuZWxlbSApLnNob3coKTtcbiAgICAgICAgfSxcblxuICAgICAgICAvLyBTaW1wbGUgJ2hpZGUnIGZ1bmN0aW9uXG4gICAgICAgIGhpZGU6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgLy8gUmVtZW1iZXIgd2hlcmUgd2Ugc3RhcnRlZCwgc28gdGhhdCB3ZSBjYW4gZ28gYmFjayB0byBpdCBsYXRlclxuICAgICAgICAgICAgdGhpcy5vcHRpb25zLm9yaWdbIHRoaXMucHJvcCBdID0galF1ZXJ5Ll9kYXRhKCB0aGlzLmVsZW0sIFwiZnhzaG93XCIgKyB0aGlzLnByb3AgKSB8fCBqUXVlcnkuc3R5bGUoIHRoaXMuZWxlbSwgdGhpcy5wcm9wICk7XG4gICAgICAgICAgICB0aGlzLm9wdGlvbnMuaGlkZSA9IHRydWU7XG5cbiAgICAgICAgICAgIC8vIEJlZ2luIHRoZSBhbmltYXRpb25cbiAgICAgICAgICAgIHRoaXMuY3VzdG9tKCB0aGlzLmN1cigpLCAwICk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgLy8gRWFjaCBzdGVwIG9mIGFuIGFuaW1hdGlvblxuICAgICAgICBzdGVwOiBmdW5jdGlvbiggZ290b0VuZCApIHtcbiAgICAgICAgICAgIHZhciBwLCBuLCBjb21wbGV0ZSxcbiAgICAgICAgICAgICAgICB0ID0gZnhOb3cgfHwgY3JlYXRlRnhOb3coKSxcbiAgICAgICAgICAgICAgICBkb25lID0gdHJ1ZSxcbiAgICAgICAgICAgICAgICBlbGVtID0gdGhpcy5lbGVtLFxuICAgICAgICAgICAgICAgIG9wdGlvbnMgPSB0aGlzLm9wdGlvbnM7XG5cbiAgICAgICAgICAgIGlmICggZ290b0VuZCB8fCB0ID49IG9wdGlvbnMuZHVyYXRpb24gKyB0aGlzLnN0YXJ0VGltZSApIHtcbiAgICAgICAgICAgICAgICB0aGlzLm5vdyA9IHRoaXMuZW5kO1xuICAgICAgICAgICAgICAgIHRoaXMucG9zID0gdGhpcy5zdGF0ZSA9IDE7XG4gICAgICAgICAgICAgICAgdGhpcy51cGRhdGUoKTtcblxuICAgICAgICAgICAgICAgIG9wdGlvbnMuYW5pbWF0ZWRQcm9wZXJ0aWVzWyB0aGlzLnByb3AgXSA9IHRydWU7XG5cbiAgICAgICAgICAgICAgICBmb3IgKCBwIGluIG9wdGlvbnMuYW5pbWF0ZWRQcm9wZXJ0aWVzICkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoIG9wdGlvbnMuYW5pbWF0ZWRQcm9wZXJ0aWVzWyBwIF0gIT09IHRydWUgKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBkb25lID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBpZiAoIGRvbmUgKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIFJlc2V0IHRoZSBvdmVyZmxvd1xuICAgICAgICAgICAgICAgICAgICBpZiAoIG9wdGlvbnMub3ZlcmZsb3cgIT0gbnVsbCAmJiAhalF1ZXJ5LnN1cHBvcnQuc2hyaW5rV3JhcEJsb2NrcyApIHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgalF1ZXJ5LmVhY2goIFsgXCJcIiwgXCJYXCIsIFwiWVwiIF0sIGZ1bmN0aW9uKCBpbmRleCwgdmFsdWUgKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxlbS5zdHlsZVsgXCJvdmVyZmxvd1wiICsgdmFsdWUgXSA9IG9wdGlvbnMub3ZlcmZsb3dbIGluZGV4IF07XG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIC8vIEhpZGUgdGhlIGVsZW1lbnQgaWYgdGhlIFwiaGlkZVwiIG9wZXJhdGlvbiB3YXMgZG9uZVxuICAgICAgICAgICAgICAgICAgICBpZiAoIG9wdGlvbnMuaGlkZSApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGpRdWVyeSggZWxlbSApLmhpZGUoKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIC8vIFJlc2V0IHRoZSBwcm9wZXJ0aWVzLCBpZiB0aGUgaXRlbSBoYXMgYmVlbiBoaWRkZW4gb3Igc2hvd25cbiAgICAgICAgICAgICAgICAgICAgaWYgKCBvcHRpb25zLmhpZGUgfHwgb3B0aW9ucy5zaG93ICkge1xuICAgICAgICAgICAgICAgICAgICAgICAgZm9yICggcCBpbiBvcHRpb25zLmFuaW1hdGVkUHJvcGVydGllcyApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBqUXVlcnkuc3R5bGUoIGVsZW0sIHAsIG9wdGlvbnMub3JpZ1sgcCBdICk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgalF1ZXJ5LnJlbW92ZURhdGEoIGVsZW0sIFwiZnhzaG93XCIgKyBwLCB0cnVlICk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gVG9nZ2xlIGRhdGEgaXMgbm8gbG9uZ2VyIG5lZWRlZFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGpRdWVyeS5yZW1vdmVEYXRhKCBlbGVtLCBcInRvZ2dsZVwiICsgcCwgdHJ1ZSApO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgLy8gRXhlY3V0ZSB0aGUgY29tcGxldGUgZnVuY3Rpb25cbiAgICAgICAgICAgICAgICAgICAgLy8gaW4gdGhlIGV2ZW50IHRoYXQgdGhlIGNvbXBsZXRlIGZ1bmN0aW9uIHRocm93cyBhbiBleGNlcHRpb25cbiAgICAgICAgICAgICAgICAgICAgLy8gd2UgbXVzdCBlbnN1cmUgaXQgd29uJ3QgYmUgY2FsbGVkIHR3aWNlLiAjNTY4NFxuXG4gICAgICAgICAgICAgICAgICAgIGNvbXBsZXRlID0gb3B0aW9ucy5jb21wbGV0ZTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCBjb21wbGV0ZSApIHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgb3B0aW9ucy5jb21wbGV0ZSA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICAgICAgY29tcGxldGUuY2FsbCggZWxlbSApO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuXG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIC8vIGNsYXNzaWNhbCBlYXNpbmcgY2Fubm90IGJlIHVzZWQgd2l0aCBhbiBJbmZpbml0eSBkdXJhdGlvblxuICAgICAgICAgICAgICAgIGlmICggb3B0aW9ucy5kdXJhdGlvbiA9PSBJbmZpbml0eSApIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5ub3cgPSB0O1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIG4gPSB0IC0gdGhpcy5zdGFydFRpbWU7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc3RhdGUgPSBuIC8gb3B0aW9ucy5kdXJhdGlvbjtcblxuICAgICAgICAgICAgICAgICAgICAvLyBQZXJmb3JtIHRoZSBlYXNpbmcgZnVuY3Rpb24sIGRlZmF1bHRzIHRvIHN3aW5nXG4gICAgICAgICAgICAgICAgICAgIHRoaXMucG9zID0galF1ZXJ5LmVhc2luZ1sgb3B0aW9ucy5hbmltYXRlZFByb3BlcnRpZXNbdGhpcy5wcm9wXSBdKCB0aGlzLnN0YXRlLCBuLCAwLCAxLCBvcHRpb25zLmR1cmF0aW9uICk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMubm93ID0gdGhpcy5zdGFydCArICggKHRoaXMuZW5kIC0gdGhpcy5zdGFydCkgKiB0aGlzLnBvcyApO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAvLyBQZXJmb3JtIHRoZSBuZXh0IHN0ZXAgb2YgdGhlIGFuaW1hdGlvblxuICAgICAgICAgICAgICAgIHRoaXMudXBkYXRlKCk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9XG4gICAgfTtcblxuICAgIGpRdWVyeS5leHRlbmQoIGpRdWVyeS5meCwge1xuICAgICAgICB0aWNrOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHZhciB0aW1lcixcbiAgICAgICAgICAgICAgICB0aW1lcnMgPSBqUXVlcnkudGltZXJzLFxuICAgICAgICAgICAgICAgIGkgPSAwO1xuXG4gICAgICAgICAgICBmb3IgKCA7IGkgPCB0aW1lcnMubGVuZ3RoOyBpKysgKSB7XG4gICAgICAgICAgICAgICAgdGltZXIgPSB0aW1lcnNbIGkgXTtcbiAgICAgICAgICAgICAgICAvLyBDaGVja3MgdGhlIHRpbWVyIGhhcyBub3QgYWxyZWFkeSBiZWVuIHJlbW92ZWRcbiAgICAgICAgICAgICAgICBpZiAoICF0aW1lcigpICYmIHRpbWVyc1sgaSBdID09PSB0aW1lciApIHtcbiAgICAgICAgICAgICAgICAgICAgdGltZXJzLnNwbGljZSggaS0tLCAxICk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoICF0aW1lcnMubGVuZ3RoICkge1xuICAgICAgICAgICAgICAgIGpRdWVyeS5meC5zdG9wKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sXG5cbiAgICAgICAgaW50ZXJ2YWw6IDEzLFxuXG4gICAgICAgIHN0b3A6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgY2xlYXJJbnRlcnZhbCggdGltZXJJZCApO1xuICAgICAgICAgICAgdGltZXJJZCA9IG51bGw7XG4gICAgICAgIH0sXG5cbiAgICAgICAgc3BlZWRzOiB7XG4gICAgICAgICAgICBzbG93OiA2MDAsXG4gICAgICAgICAgICBmYXN0OiAyMDAsXG4gICAgICAgICAgICAvLyBEZWZhdWx0IHNwZWVkXG4gICAgICAgICAgICBfZGVmYXVsdDogNDAwXG4gICAgICAgIH0sXG5cbiAgICAgICAgc3RlcDoge1xuICAgICAgICAgICAgb3BhY2l0eTogZnVuY3Rpb24oIGZ4ICkge1xuICAgICAgICAgICAgICAgIGpRdWVyeS5zdHlsZSggZnguZWxlbSwgXCJvcGFjaXR5XCIsIGZ4Lm5vdyApO1xuICAgICAgICAgICAgfSxcblxuICAgICAgICAgICAgX2RlZmF1bHQ6IGZ1bmN0aW9uKCBmeCApIHtcbiAgICAgICAgICAgICAgICBpZiAoIGZ4LmVsZW0uc3R5bGUgJiYgZnguZWxlbS5zdHlsZVsgZngucHJvcCBdICE9IG51bGwgKSB7XG4gICAgICAgICAgICAgICAgICAgIGZ4LmVsZW0uc3R5bGVbIGZ4LnByb3AgXSA9IGZ4Lm5vdyArIGZ4LnVuaXQ7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgZnguZWxlbVsgZngucHJvcCBdID0gZngubm93O1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH0pO1xuXG4vLyBBZGRzIHdpZHRoL2hlaWdodCBzdGVwIGZ1bmN0aW9uc1xuLy8gRG8gbm90IHNldCBhbnl0aGluZyBiZWxvdyAwXG4gICAgalF1ZXJ5LmVhY2goWyBcIndpZHRoXCIsIFwiaGVpZ2h0XCIgXSwgZnVuY3Rpb24oIGksIHByb3AgKSB7XG4gICAgICAgIGpRdWVyeS5meC5zdGVwWyBwcm9wIF0gPSBmdW5jdGlvbiggZnggKSB7XG4gICAgICAgICAgICBqUXVlcnkuc3R5bGUoIGZ4LmVsZW0sIHByb3AsIE1hdGgubWF4KDAsIGZ4Lm5vdykgKyBmeC51bml0ICk7XG4gICAgICAgIH07XG4gICAgfSk7XG5cbiAgICBpZiAoIGpRdWVyeS5leHByICYmIGpRdWVyeS5leHByLmZpbHRlcnMgKSB7XG4gICAgICAgIGpRdWVyeS5leHByLmZpbHRlcnMuYW5pbWF0ZWQgPSBmdW5jdGlvbiggZWxlbSApIHtcbiAgICAgICAgICAgIHJldHVybiBqUXVlcnkuZ3JlcChqUXVlcnkudGltZXJzLCBmdW5jdGlvbiggZm4gKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGVsZW0gPT09IGZuLmVsZW07XG4gICAgICAgICAgICB9KS5sZW5ndGg7XG4gICAgICAgIH07XG4gICAgfVxuXG4vLyBUcnkgdG8gcmVzdG9yZSB0aGUgZGVmYXVsdCBkaXNwbGF5IHZhbHVlIG9mIGFuIGVsZW1lbnRcbiAgICBmdW5jdGlvbiBkZWZhdWx0RGlzcGxheSggbm9kZU5hbWUgKSB7XG5cbiAgICAgICAgaWYgKCAhZWxlbWRpc3BsYXlbIG5vZGVOYW1lIF0gKSB7XG5cbiAgICAgICAgICAgIHZhciBib2R5ID0gZG9jdW1lbnQuYm9keSxcbiAgICAgICAgICAgICAgICBlbGVtID0galF1ZXJ5KCBcIjxcIiArIG5vZGVOYW1lICsgXCI+XCIgKS5hcHBlbmRUbyggYm9keSApLFxuICAgICAgICAgICAgICAgIGRpc3BsYXkgPSBlbGVtLmNzcyggXCJkaXNwbGF5XCIgKTtcbiAgICAgICAgICAgIGVsZW0ucmVtb3ZlKCk7XG5cbiAgICAgICAgICAgIC8vIElmIHRoZSBzaW1wbGUgd2F5IGZhaWxzLFxuICAgICAgICAgICAgLy8gZ2V0IGVsZW1lbnQncyByZWFsIGRlZmF1bHQgZGlzcGxheSBieSBhdHRhY2hpbmcgaXQgdG8gYSB0ZW1wIGlmcmFtZVxuICAgICAgICAgICAgaWYgKCBkaXNwbGF5ID09PSBcIm5vbmVcIiB8fCBkaXNwbGF5ID09PSBcIlwiICkge1xuICAgICAgICAgICAgICAgIC8vIE5vIGlmcmFtZSB0byB1c2UgeWV0LCBzbyBjcmVhdGUgaXRcbiAgICAgICAgICAgICAgICBpZiAoICFpZnJhbWUgKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmcmFtZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoIFwiaWZyYW1lXCIgKTtcbiAgICAgICAgICAgICAgICAgICAgaWZyYW1lLmZyYW1lQm9yZGVyID0gaWZyYW1lLndpZHRoID0gaWZyYW1lLmhlaWdodCA9IDA7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgYm9keS5hcHBlbmRDaGlsZCggaWZyYW1lICk7XG5cbiAgICAgICAgICAgICAgICAvLyBDcmVhdGUgYSBjYWNoZWFibGUgY29weSBvZiB0aGUgaWZyYW1lIGRvY3VtZW50IG9uIGZpcnN0IGNhbGwuXG4gICAgICAgICAgICAgICAgLy8gSUUgYW5kIE9wZXJhIHdpbGwgYWxsb3cgdXMgdG8gcmV1c2UgdGhlIGlmcmFtZURvYyB3aXRob3V0IHJlLXdyaXRpbmcgdGhlIGZha2UgSFRNTFxuICAgICAgICAgICAgICAgIC8vIGRvY3VtZW50IHRvIGl0OyBXZWJLaXQgJiBGaXJlZm94IHdvbid0IGFsbG93IHJldXNpbmcgdGhlIGlmcmFtZSBkb2N1bWVudC5cbiAgICAgICAgICAgICAgICBpZiAoICFpZnJhbWVEb2MgfHwgIWlmcmFtZS5jcmVhdGVFbGVtZW50ICkge1xuICAgICAgICAgICAgICAgICAgICBpZnJhbWVEb2MgPSAoIGlmcmFtZS5jb250ZW50V2luZG93IHx8IGlmcmFtZS5jb250ZW50RG9jdW1lbnQgKS5kb2N1bWVudDtcbiAgICAgICAgICAgICAgICAgICAgaWZyYW1lRG9jLndyaXRlKCAoIGRvY3VtZW50LmNvbXBhdE1vZGUgPT09IFwiQ1NTMUNvbXBhdFwiID8gXCI8IWRvY3R5cGUgaHRtbD5cIiA6IFwiXCIgKSArIFwiPGh0bWw+PGJvZHk+XCIgKTtcbiAgICAgICAgICAgICAgICAgICAgaWZyYW1lRG9jLmNsb3NlKCk7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgZWxlbSA9IGlmcmFtZURvYy5jcmVhdGVFbGVtZW50KCBub2RlTmFtZSApO1xuXG4gICAgICAgICAgICAgICAgaWZyYW1lRG9jLmJvZHkuYXBwZW5kQ2hpbGQoIGVsZW0gKTtcblxuICAgICAgICAgICAgICAgIGRpc3BsYXkgPSBqUXVlcnkuY3NzKCBlbGVtLCBcImRpc3BsYXlcIiApO1xuICAgICAgICAgICAgICAgIGJvZHkucmVtb3ZlQ2hpbGQoIGlmcmFtZSApO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBTdG9yZSB0aGUgY29ycmVjdCBkZWZhdWx0IGRpc3BsYXlcbiAgICAgICAgICAgIGVsZW1kaXNwbGF5WyBub2RlTmFtZSBdID0gZGlzcGxheTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBlbGVtZGlzcGxheVsgbm9kZU5hbWUgXTtcbiAgICB9XG5cblxuXG5cbiAgICB2YXIgcnRhYmxlID0gL150KD86YWJsZXxkfGgpJC9pLFxuICAgICAgICBycm9vdCA9IC9eKD86Ym9keXxodG1sKSQvaTtcblxuICAgIGlmICggXCJnZXRCb3VuZGluZ0NsaWVudFJlY3RcIiBpbiBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQgKSB7XG4gICAgICAgIGpRdWVyeS5mbi5vZmZzZXQgPSBmdW5jdGlvbiggb3B0aW9ucyApIHtcbiAgICAgICAgICAgIHZhciBlbGVtID0gdGhpc1swXSwgYm94O1xuXG4gICAgICAgICAgICBpZiAoIG9wdGlvbnMgKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbiggaSApIHtcbiAgICAgICAgICAgICAgICAgICAgalF1ZXJ5Lm9mZnNldC5zZXRPZmZzZXQoIHRoaXMsIG9wdGlvbnMsIGkgKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKCAhZWxlbSB8fCAhZWxlbS5vd25lckRvY3VtZW50ICkge1xuICAgICAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoIGVsZW0gPT09IGVsZW0ub3duZXJEb2N1bWVudC5ib2R5ICkge1xuICAgICAgICAgICAgICAgIHJldHVybiBqUXVlcnkub2Zmc2V0LmJvZHlPZmZzZXQoIGVsZW0gKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICBib3ggPSBlbGVtLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xuICAgICAgICAgICAgfSBjYXRjaChlKSB7fVxuXG4gICAgICAgICAgICB2YXIgZG9jID0gZWxlbS5vd25lckRvY3VtZW50LFxuICAgICAgICAgICAgICAgIGRvY0VsZW0gPSBkb2MuZG9jdW1lbnRFbGVtZW50O1xuXG4gICAgICAgICAgICAvLyBNYWtlIHN1cmUgd2UncmUgbm90IGRlYWxpbmcgd2l0aCBhIGRpc2Nvbm5lY3RlZCBET00gbm9kZVxuICAgICAgICAgICAgaWYgKCAhYm94IHx8ICFqUXVlcnkuY29udGFpbnMoIGRvY0VsZW0sIGVsZW0gKSApIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gYm94ID8geyB0b3A6IGJveC50b3AsIGxlZnQ6IGJveC5sZWZ0IH0gOiB7IHRvcDogMCwgbGVmdDogMCB9O1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB2YXIgYm9keSA9IGRvYy5ib2R5LFxuICAgICAgICAgICAgICAgIHdpbiA9IGdldFdpbmRvdyhkb2MpLFxuICAgICAgICAgICAgICAgIGNsaWVudFRvcCAgPSBkb2NFbGVtLmNsaWVudFRvcCAgfHwgYm9keS5jbGllbnRUb3AgIHx8IDAsXG4gICAgICAgICAgICAgICAgY2xpZW50TGVmdCA9IGRvY0VsZW0uY2xpZW50TGVmdCB8fCBib2R5LmNsaWVudExlZnQgfHwgMCxcbiAgICAgICAgICAgICAgICBzY3JvbGxUb3AgID0gd2luLnBhZ2VZT2Zmc2V0IHx8IGpRdWVyeS5zdXBwb3J0LmJveE1vZGVsICYmIGRvY0VsZW0uc2Nyb2xsVG9wICB8fCBib2R5LnNjcm9sbFRvcCxcbiAgICAgICAgICAgICAgICBzY3JvbGxMZWZ0ID0gd2luLnBhZ2VYT2Zmc2V0IHx8IGpRdWVyeS5zdXBwb3J0LmJveE1vZGVsICYmIGRvY0VsZW0uc2Nyb2xsTGVmdCB8fCBib2R5LnNjcm9sbExlZnQsXG4gICAgICAgICAgICAgICAgdG9wICA9IGJveC50b3AgICsgc2Nyb2xsVG9wICAtIGNsaWVudFRvcCxcbiAgICAgICAgICAgICAgICBsZWZ0ID0gYm94LmxlZnQgKyBzY3JvbGxMZWZ0IC0gY2xpZW50TGVmdDtcblxuICAgICAgICAgICAgcmV0dXJuIHsgdG9wOiB0b3AsIGxlZnQ6IGxlZnQgfTtcbiAgICAgICAgfTtcblxuICAgIH0gZWxzZSB7XG4gICAgICAgIGpRdWVyeS5mbi5vZmZzZXQgPSBmdW5jdGlvbiggb3B0aW9ucyApIHtcbiAgICAgICAgICAgIHZhciBlbGVtID0gdGhpc1swXTtcblxuICAgICAgICAgICAgaWYgKCBvcHRpb25zICkge1xuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oIGkgKSB7XG4gICAgICAgICAgICAgICAgICAgIGpRdWVyeS5vZmZzZXQuc2V0T2Zmc2V0KCB0aGlzLCBvcHRpb25zLCBpICk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmICggIWVsZW0gfHwgIWVsZW0ub3duZXJEb2N1bWVudCApIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKCBlbGVtID09PSBlbGVtLm93bmVyRG9jdW1lbnQuYm9keSApIHtcbiAgICAgICAgICAgICAgICByZXR1cm4galF1ZXJ5Lm9mZnNldC5ib2R5T2Zmc2V0KCBlbGVtICk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHZhciBjb21wdXRlZFN0eWxlLFxuICAgICAgICAgICAgICAgIG9mZnNldFBhcmVudCA9IGVsZW0ub2Zmc2V0UGFyZW50LFxuICAgICAgICAgICAgICAgIHByZXZPZmZzZXRQYXJlbnQgPSBlbGVtLFxuICAgICAgICAgICAgICAgIGRvYyA9IGVsZW0ub3duZXJEb2N1bWVudCxcbiAgICAgICAgICAgICAgICBkb2NFbGVtID0gZG9jLmRvY3VtZW50RWxlbWVudCxcbiAgICAgICAgICAgICAgICBib2R5ID0gZG9jLmJvZHksXG4gICAgICAgICAgICAgICAgZGVmYXVsdFZpZXcgPSBkb2MuZGVmYXVsdFZpZXcsXG4gICAgICAgICAgICAgICAgcHJldkNvbXB1dGVkU3R5bGUgPSBkZWZhdWx0VmlldyA/IGRlZmF1bHRWaWV3LmdldENvbXB1dGVkU3R5bGUoIGVsZW0sIG51bGwgKSA6IGVsZW0uY3VycmVudFN0eWxlLFxuICAgICAgICAgICAgICAgIHRvcCA9IGVsZW0ub2Zmc2V0VG9wLFxuICAgICAgICAgICAgICAgIGxlZnQgPSBlbGVtLm9mZnNldExlZnQ7XG5cbiAgICAgICAgICAgIHdoaWxlICggKGVsZW0gPSBlbGVtLnBhcmVudE5vZGUpICYmIGVsZW0gIT09IGJvZHkgJiYgZWxlbSAhPT0gZG9jRWxlbSApIHtcbiAgICAgICAgICAgICAgICBpZiAoIGpRdWVyeS5zdXBwb3J0LmZpeGVkUG9zaXRpb24gJiYgcHJldkNvbXB1dGVkU3R5bGUucG9zaXRpb24gPT09IFwiZml4ZWRcIiApIHtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgY29tcHV0ZWRTdHlsZSA9IGRlZmF1bHRWaWV3ID8gZGVmYXVsdFZpZXcuZ2V0Q29tcHV0ZWRTdHlsZShlbGVtLCBudWxsKSA6IGVsZW0uY3VycmVudFN0eWxlO1xuICAgICAgICAgICAgICAgIHRvcCAgLT0gZWxlbS5zY3JvbGxUb3A7XG4gICAgICAgICAgICAgICAgbGVmdCAtPSBlbGVtLnNjcm9sbExlZnQ7XG5cbiAgICAgICAgICAgICAgICBpZiAoIGVsZW0gPT09IG9mZnNldFBhcmVudCApIHtcbiAgICAgICAgICAgICAgICAgICAgdG9wICArPSBlbGVtLm9mZnNldFRvcDtcbiAgICAgICAgICAgICAgICAgICAgbGVmdCArPSBlbGVtLm9mZnNldExlZnQ7XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKCBqUXVlcnkuc3VwcG9ydC5kb2VzTm90QWRkQm9yZGVyICYmICEoalF1ZXJ5LnN1cHBvcnQuZG9lc0FkZEJvcmRlckZvclRhYmxlQW5kQ2VsbHMgJiYgcnRhYmxlLnRlc3QoZWxlbS5ub2RlTmFtZSkpICkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdG9wICArPSBwYXJzZUZsb2F0KCBjb21wdXRlZFN0eWxlLmJvcmRlclRvcFdpZHRoICApIHx8IDA7XG4gICAgICAgICAgICAgICAgICAgICAgICBsZWZ0ICs9IHBhcnNlRmxvYXQoIGNvbXB1dGVkU3R5bGUuYm9yZGVyTGVmdFdpZHRoICkgfHwgMDtcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIHByZXZPZmZzZXRQYXJlbnQgPSBvZmZzZXRQYXJlbnQ7XG4gICAgICAgICAgICAgICAgICAgIG9mZnNldFBhcmVudCA9IGVsZW0ub2Zmc2V0UGFyZW50O1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGlmICggalF1ZXJ5LnN1cHBvcnQuc3VidHJhY3RzQm9yZGVyRm9yT3ZlcmZsb3dOb3RWaXNpYmxlICYmIGNvbXB1dGVkU3R5bGUub3ZlcmZsb3cgIT09IFwidmlzaWJsZVwiICkge1xuICAgICAgICAgICAgICAgICAgICB0b3AgICs9IHBhcnNlRmxvYXQoIGNvbXB1dGVkU3R5bGUuYm9yZGVyVG9wV2lkdGggICkgfHwgMDtcbiAgICAgICAgICAgICAgICAgICAgbGVmdCArPSBwYXJzZUZsb2F0KCBjb21wdXRlZFN0eWxlLmJvcmRlckxlZnRXaWR0aCApIHx8IDA7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgcHJldkNvbXB1dGVkU3R5bGUgPSBjb21wdXRlZFN0eWxlO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoIHByZXZDb21wdXRlZFN0eWxlLnBvc2l0aW9uID09PSBcInJlbGF0aXZlXCIgfHwgcHJldkNvbXB1dGVkU3R5bGUucG9zaXRpb24gPT09IFwic3RhdGljXCIgKSB7XG4gICAgICAgICAgICAgICAgdG9wICArPSBib2R5Lm9mZnNldFRvcDtcbiAgICAgICAgICAgICAgICBsZWZ0ICs9IGJvZHkub2Zmc2V0TGVmdDtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKCBqUXVlcnkuc3VwcG9ydC5maXhlZFBvc2l0aW9uICYmIHByZXZDb21wdXRlZFN0eWxlLnBvc2l0aW9uID09PSBcImZpeGVkXCIgKSB7XG4gICAgICAgICAgICAgICAgdG9wICArPSBNYXRoLm1heCggZG9jRWxlbS5zY3JvbGxUb3AsIGJvZHkuc2Nyb2xsVG9wICk7XG4gICAgICAgICAgICAgICAgbGVmdCArPSBNYXRoLm1heCggZG9jRWxlbS5zY3JvbGxMZWZ0LCBib2R5LnNjcm9sbExlZnQgKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgcmV0dXJuIHsgdG9wOiB0b3AsIGxlZnQ6IGxlZnQgfTtcbiAgICAgICAgfTtcbiAgICB9XG5cbiAgICBqUXVlcnkub2Zmc2V0ID0ge1xuXG4gICAgICAgIGJvZHlPZmZzZXQ6IGZ1bmN0aW9uKCBib2R5ICkge1xuICAgICAgICAgICAgdmFyIHRvcCA9IGJvZHkub2Zmc2V0VG9wLFxuICAgICAgICAgICAgICAgIGxlZnQgPSBib2R5Lm9mZnNldExlZnQ7XG5cbiAgICAgICAgICAgIGlmICggalF1ZXJ5LnN1cHBvcnQuZG9lc05vdEluY2x1ZGVNYXJnaW5JbkJvZHlPZmZzZXQgKSB7XG4gICAgICAgICAgICAgICAgdG9wICArPSBwYXJzZUZsb2F0KCBqUXVlcnkuY3NzKGJvZHksIFwibWFyZ2luVG9wXCIpICkgfHwgMDtcbiAgICAgICAgICAgICAgICBsZWZ0ICs9IHBhcnNlRmxvYXQoIGpRdWVyeS5jc3MoYm9keSwgXCJtYXJnaW5MZWZ0XCIpICkgfHwgMDtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgcmV0dXJuIHsgdG9wOiB0b3AsIGxlZnQ6IGxlZnQgfTtcbiAgICAgICAgfSxcblxuICAgICAgICBzZXRPZmZzZXQ6IGZ1bmN0aW9uKCBlbGVtLCBvcHRpb25zLCBpICkge1xuICAgICAgICAgICAgdmFyIHBvc2l0aW9uID0galF1ZXJ5LmNzcyggZWxlbSwgXCJwb3NpdGlvblwiICk7XG5cbiAgICAgICAgICAgIC8vIHNldCBwb3NpdGlvbiBmaXJzdCwgaW4tY2FzZSB0b3AvbGVmdCBhcmUgc2V0IGV2ZW4gb24gc3RhdGljIGVsZW1cbiAgICAgICAgICAgIGlmICggcG9zaXRpb24gPT09IFwic3RhdGljXCIgKSB7XG4gICAgICAgICAgICAgICAgZWxlbS5zdHlsZS5wb3NpdGlvbiA9IFwicmVsYXRpdmVcIjtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdmFyIGN1ckVsZW0gPSBqUXVlcnkoIGVsZW0gKSxcbiAgICAgICAgICAgICAgICBjdXJPZmZzZXQgPSBjdXJFbGVtLm9mZnNldCgpLFxuICAgICAgICAgICAgICAgIGN1ckNTU1RvcCA9IGpRdWVyeS5jc3MoIGVsZW0sIFwidG9wXCIgKSxcbiAgICAgICAgICAgICAgICBjdXJDU1NMZWZ0ID0galF1ZXJ5LmNzcyggZWxlbSwgXCJsZWZ0XCIgKSxcbiAgICAgICAgICAgICAgICBjYWxjdWxhdGVQb3NpdGlvbiA9ICggcG9zaXRpb24gPT09IFwiYWJzb2x1dGVcIiB8fCBwb3NpdGlvbiA9PT0gXCJmaXhlZFwiICkgJiYgalF1ZXJ5LmluQXJyYXkoXCJhdXRvXCIsIFtjdXJDU1NUb3AsIGN1ckNTU0xlZnRdKSA+IC0xLFxuICAgICAgICAgICAgICAgIHByb3BzID0ge30sIGN1clBvc2l0aW9uID0ge30sIGN1clRvcCwgY3VyTGVmdDtcblxuICAgICAgICAgICAgLy8gbmVlZCB0byBiZSBhYmxlIHRvIGNhbGN1bGF0ZSBwb3NpdGlvbiBpZiBlaXRoZXIgdG9wIG9yIGxlZnQgaXMgYXV0byBhbmQgcG9zaXRpb24gaXMgZWl0aGVyIGFic29sdXRlIG9yIGZpeGVkXG4gICAgICAgICAgICBpZiAoIGNhbGN1bGF0ZVBvc2l0aW9uICkge1xuICAgICAgICAgICAgICAgIGN1clBvc2l0aW9uID0gY3VyRWxlbS5wb3NpdGlvbigpO1xuICAgICAgICAgICAgICAgIGN1clRvcCA9IGN1clBvc2l0aW9uLnRvcDtcbiAgICAgICAgICAgICAgICBjdXJMZWZ0ID0gY3VyUG9zaXRpb24ubGVmdDtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgY3VyVG9wID0gcGFyc2VGbG9hdCggY3VyQ1NTVG9wICkgfHwgMDtcbiAgICAgICAgICAgICAgICBjdXJMZWZ0ID0gcGFyc2VGbG9hdCggY3VyQ1NTTGVmdCApIHx8IDA7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmICggalF1ZXJ5LmlzRnVuY3Rpb24oIG9wdGlvbnMgKSApIHtcbiAgICAgICAgICAgICAgICBvcHRpb25zID0gb3B0aW9ucy5jYWxsKCBlbGVtLCBpLCBjdXJPZmZzZXQgKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKCBvcHRpb25zLnRvcCAhPSBudWxsICkge1xuICAgICAgICAgICAgICAgIHByb3BzLnRvcCA9ICggb3B0aW9ucy50b3AgLSBjdXJPZmZzZXQudG9wICkgKyBjdXJUb3A7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoIG9wdGlvbnMubGVmdCAhPSBudWxsICkge1xuICAgICAgICAgICAgICAgIHByb3BzLmxlZnQgPSAoIG9wdGlvbnMubGVmdCAtIGN1ck9mZnNldC5sZWZ0ICkgKyBjdXJMZWZ0O1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoIFwidXNpbmdcIiBpbiBvcHRpb25zICkge1xuICAgICAgICAgICAgICAgIG9wdGlvbnMudXNpbmcuY2FsbCggZWxlbSwgcHJvcHMgKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgY3VyRWxlbS5jc3MoIHByb3BzICk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9O1xuXG5cbiAgICBqUXVlcnkuZm4uZXh0ZW5kKHtcblxuICAgICAgICBwb3NpdGlvbjogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBpZiAoICF0aGlzWzBdICkge1xuICAgICAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB2YXIgZWxlbSA9IHRoaXNbMF0sXG5cbiAgICAgICAgICAgIC8vIEdldCAqcmVhbCogb2Zmc2V0UGFyZW50XG4gICAgICAgICAgICAgICAgb2Zmc2V0UGFyZW50ID0gdGhpcy5vZmZzZXRQYXJlbnQoKSxcblxuICAgICAgICAgICAgLy8gR2V0IGNvcnJlY3Qgb2Zmc2V0c1xuICAgICAgICAgICAgICAgIG9mZnNldCAgICAgICA9IHRoaXMub2Zmc2V0KCksXG4gICAgICAgICAgICAgICAgcGFyZW50T2Zmc2V0ID0gcnJvb3QudGVzdChvZmZzZXRQYXJlbnRbMF0ubm9kZU5hbWUpID8geyB0b3A6IDAsIGxlZnQ6IDAgfSA6IG9mZnNldFBhcmVudC5vZmZzZXQoKTtcblxuICAgICAgICAgICAgLy8gU3VidHJhY3QgZWxlbWVudCBtYXJnaW5zXG4gICAgICAgICAgICAvLyBub3RlOiB3aGVuIGFuIGVsZW1lbnQgaGFzIG1hcmdpbjogYXV0byB0aGUgb2Zmc2V0TGVmdCBhbmQgbWFyZ2luTGVmdFxuICAgICAgICAgICAgLy8gYXJlIHRoZSBzYW1lIGluIFNhZmFyaSBjYXVzaW5nIG9mZnNldC5sZWZ0IHRvIGluY29ycmVjdGx5IGJlIDBcbiAgICAgICAgICAgIG9mZnNldC50b3AgIC09IHBhcnNlRmxvYXQoIGpRdWVyeS5jc3MoZWxlbSwgXCJtYXJnaW5Ub3BcIikgKSB8fCAwO1xuICAgICAgICAgICAgb2Zmc2V0LmxlZnQgLT0gcGFyc2VGbG9hdCggalF1ZXJ5LmNzcyhlbGVtLCBcIm1hcmdpbkxlZnRcIikgKSB8fCAwO1xuXG4gICAgICAgICAgICAvLyBBZGQgb2Zmc2V0UGFyZW50IGJvcmRlcnNcbiAgICAgICAgICAgIHBhcmVudE9mZnNldC50b3AgICs9IHBhcnNlRmxvYXQoIGpRdWVyeS5jc3Mob2Zmc2V0UGFyZW50WzBdLCBcImJvcmRlclRvcFdpZHRoXCIpICkgfHwgMDtcbiAgICAgICAgICAgIHBhcmVudE9mZnNldC5sZWZ0ICs9IHBhcnNlRmxvYXQoIGpRdWVyeS5jc3Mob2Zmc2V0UGFyZW50WzBdLCBcImJvcmRlckxlZnRXaWR0aFwiKSApIHx8IDA7XG5cbiAgICAgICAgICAgIC8vIFN1YnRyYWN0IHRoZSB0d28gb2Zmc2V0c1xuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICB0b3A6ICBvZmZzZXQudG9wICAtIHBhcmVudE9mZnNldC50b3AsXG4gICAgICAgICAgICAgICAgbGVmdDogb2Zmc2V0LmxlZnQgLSBwYXJlbnRPZmZzZXQubGVmdFxuICAgICAgICAgICAgfTtcbiAgICAgICAgfSxcblxuICAgICAgICBvZmZzZXRQYXJlbnQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMubWFwKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIHZhciBvZmZzZXRQYXJlbnQgPSB0aGlzLm9mZnNldFBhcmVudCB8fCBkb2N1bWVudC5ib2R5O1xuICAgICAgICAgICAgICAgIHdoaWxlICggb2Zmc2V0UGFyZW50ICYmICghcnJvb3QudGVzdChvZmZzZXRQYXJlbnQubm9kZU5hbWUpICYmIGpRdWVyeS5jc3Mob2Zmc2V0UGFyZW50LCBcInBvc2l0aW9uXCIpID09PSBcInN0YXRpY1wiKSApIHtcbiAgICAgICAgICAgICAgICAgICAgb2Zmc2V0UGFyZW50ID0gb2Zmc2V0UGFyZW50Lm9mZnNldFBhcmVudDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV0dXJuIG9mZnNldFBhcmVudDtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgfSk7XG5cblxuLy8gQ3JlYXRlIHNjcm9sbExlZnQgYW5kIHNjcm9sbFRvcCBtZXRob2RzXG4gICAgalF1ZXJ5LmVhY2goIFtcIkxlZnRcIiwgXCJUb3BcIl0sIGZ1bmN0aW9uKCBpLCBuYW1lICkge1xuICAgICAgICB2YXIgbWV0aG9kID0gXCJzY3JvbGxcIiArIG5hbWU7XG5cbiAgICAgICAgalF1ZXJ5LmZuWyBtZXRob2QgXSA9IGZ1bmN0aW9uKCB2YWwgKSB7XG4gICAgICAgICAgICB2YXIgZWxlbSwgd2luO1xuXG4gICAgICAgICAgICBpZiAoIHZhbCA9PT0gdW5kZWZpbmVkICkge1xuICAgICAgICAgICAgICAgIGVsZW0gPSB0aGlzWyAwIF07XG5cbiAgICAgICAgICAgICAgICBpZiAoICFlbGVtICkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICB3aW4gPSBnZXRXaW5kb3coIGVsZW0gKTtcblxuICAgICAgICAgICAgICAgIC8vIFJldHVybiB0aGUgc2Nyb2xsIG9mZnNldFxuICAgICAgICAgICAgICAgIHJldHVybiB3aW4gPyAoXCJwYWdlWE9mZnNldFwiIGluIHdpbikgPyB3aW5bIGkgPyBcInBhZ2VZT2Zmc2V0XCIgOiBcInBhZ2VYT2Zmc2V0XCIgXSA6XG4gICAgICAgICAgICAgICAgalF1ZXJ5LnN1cHBvcnQuYm94TW9kZWwgJiYgd2luLmRvY3VtZW50LmRvY3VtZW50RWxlbWVudFsgbWV0aG9kIF0gfHxcbiAgICAgICAgICAgICAgICB3aW4uZG9jdW1lbnQuYm9keVsgbWV0aG9kIF0gOlxuICAgICAgICAgICAgICAgICAgICBlbGVtWyBtZXRob2QgXTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gU2V0IHRoZSBzY3JvbGwgb2Zmc2V0XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIHdpbiA9IGdldFdpbmRvdyggdGhpcyApO1xuXG4gICAgICAgICAgICAgICAgaWYgKCB3aW4gKSB7XG4gICAgICAgICAgICAgICAgICAgIHdpbi5zY3JvbGxUbyhcbiAgICAgICAgICAgICAgICAgICAgICAgICFpID8gdmFsIDogalF1ZXJ5KCB3aW4gKS5zY3JvbGxMZWZ0KCksXG4gICAgICAgICAgICAgICAgICAgICAgICBpID8gdmFsIDogalF1ZXJ5KCB3aW4gKS5zY3JvbGxUb3AoKVxuICAgICAgICAgICAgICAgICAgICApO1xuXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpc1sgbWV0aG9kIF0gPSB2YWw7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH07XG4gICAgfSk7XG5cbiAgICBmdW5jdGlvbiBnZXRXaW5kb3coIGVsZW0gKSB7XG4gICAgICAgIHJldHVybiBqUXVlcnkuaXNXaW5kb3coIGVsZW0gKSA/XG4gICAgICAgICAgICBlbGVtIDpcbiAgICAgICAgICAgIGVsZW0ubm9kZVR5cGUgPT09IDkgP1xuICAgICAgICAgICAgZWxlbS5kZWZhdWx0VmlldyB8fCBlbGVtLnBhcmVudFdpbmRvdyA6XG4gICAgICAgICAgICAgICAgZmFsc2U7XG4gICAgfVxuXG5cblxuXG4vLyBDcmVhdGUgd2lkdGgsIGhlaWdodCwgaW5uZXJIZWlnaHQsIGlubmVyV2lkdGgsIG91dGVySGVpZ2h0IGFuZCBvdXRlcldpZHRoIG1ldGhvZHNcbiAgICBqUXVlcnkuZWFjaChbIFwiSGVpZ2h0XCIsIFwiV2lkdGhcIiBdLCBmdW5jdGlvbiggaSwgbmFtZSApIHtcblxuICAgICAgICB2YXIgdHlwZSA9IG5hbWUudG9Mb3dlckNhc2UoKTtcblxuICAgICAgICAvLyBpbm5lckhlaWdodCBhbmQgaW5uZXJXaWR0aFxuICAgICAgICBqUXVlcnkuZm5bIFwiaW5uZXJcIiArIG5hbWUgXSA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgdmFyIGVsZW0gPSB0aGlzWzBdO1xuICAgICAgICAgICAgcmV0dXJuIGVsZW0gP1xuICAgICAgICAgICAgICAgIGVsZW0uc3R5bGUgP1xuICAgICAgICAgICAgICAgICAgICBwYXJzZUZsb2F0KCBqUXVlcnkuY3NzKCBlbGVtLCB0eXBlLCBcInBhZGRpbmdcIiApICkgOlxuICAgICAgICAgICAgICAgICAgICB0aGlzWyB0eXBlIF0oKSA6XG4gICAgICAgICAgICAgICAgbnVsbDtcbiAgICAgICAgfTtcblxuICAgICAgICAvLyBvdXRlckhlaWdodCBhbmQgb3V0ZXJXaWR0aFxuICAgICAgICBqUXVlcnkuZm5bIFwib3V0ZXJcIiArIG5hbWUgXSA9IGZ1bmN0aW9uKCBtYXJnaW4gKSB7XG4gICAgICAgICAgICB2YXIgZWxlbSA9IHRoaXNbMF07XG4gICAgICAgICAgICByZXR1cm4gZWxlbSA/XG4gICAgICAgICAgICAgICAgZWxlbS5zdHlsZSA/XG4gICAgICAgICAgICAgICAgICAgIHBhcnNlRmxvYXQoIGpRdWVyeS5jc3MoIGVsZW0sIHR5cGUsIG1hcmdpbiA/IFwibWFyZ2luXCIgOiBcImJvcmRlclwiICkgKSA6XG4gICAgICAgICAgICAgICAgICAgIHRoaXNbIHR5cGUgXSgpIDpcbiAgICAgICAgICAgICAgICBudWxsO1xuICAgICAgICB9O1xuXG4gICAgICAgIGpRdWVyeS5mblsgdHlwZSBdID0gZnVuY3Rpb24oIHNpemUgKSB7XG4gICAgICAgICAgICAvLyBHZXQgd2luZG93IHdpZHRoIG9yIGhlaWdodFxuICAgICAgICAgICAgdmFyIGVsZW0gPSB0aGlzWzBdO1xuICAgICAgICAgICAgaWYgKCAhZWxlbSApIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gc2l6ZSA9PSBudWxsID8gbnVsbCA6IHRoaXM7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmICggalF1ZXJ5LmlzRnVuY3Rpb24oIHNpemUgKSApIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKCBpICkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgc2VsZiA9IGpRdWVyeSggdGhpcyApO1xuICAgICAgICAgICAgICAgICAgICBzZWxmWyB0eXBlIF0oIHNpemUuY2FsbCggdGhpcywgaSwgc2VsZlsgdHlwZSBdKCkgKSApO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoIGpRdWVyeS5pc1dpbmRvdyggZWxlbSApICkge1xuICAgICAgICAgICAgICAgIC8vIEV2ZXJ5b25lIGVsc2UgdXNlIGRvY3VtZW50LmRvY3VtZW50RWxlbWVudCBvciBkb2N1bWVudC5ib2R5IGRlcGVuZGluZyBvbiBRdWlya3MgdnMgU3RhbmRhcmRzIG1vZGVcbiAgICAgICAgICAgICAgICAvLyAzcmQgY29uZGl0aW9uIGFsbG93cyBOb2tpYSBzdXBwb3J0LCBhcyBpdCBzdXBwb3J0cyB0aGUgZG9jRWxlbSBwcm9wIGJ1dCBub3QgQ1NTMUNvbXBhdFxuICAgICAgICAgICAgICAgIHZhciBkb2NFbGVtUHJvcCA9IGVsZW0uZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50WyBcImNsaWVudFwiICsgbmFtZSBdLFxuICAgICAgICAgICAgICAgICAgICBib2R5ID0gZWxlbS5kb2N1bWVudC5ib2R5O1xuICAgICAgICAgICAgICAgIHJldHVybiBlbGVtLmRvY3VtZW50LmNvbXBhdE1vZGUgPT09IFwiQ1NTMUNvbXBhdFwiICYmIGRvY0VsZW1Qcm9wIHx8XG4gICAgICAgICAgICAgICAgICAgIGJvZHkgJiYgYm9keVsgXCJjbGllbnRcIiArIG5hbWUgXSB8fCBkb2NFbGVtUHJvcDtcblxuICAgICAgICAgICAgICAgIC8vIEdldCBkb2N1bWVudCB3aWR0aCBvciBoZWlnaHRcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoIGVsZW0ubm9kZVR5cGUgPT09IDkgKSB7XG4gICAgICAgICAgICAgICAgLy8gRWl0aGVyIHNjcm9sbFtXaWR0aC9IZWlnaHRdIG9yIG9mZnNldFtXaWR0aC9IZWlnaHRdLCB3aGljaGV2ZXIgaXMgZ3JlYXRlclxuICAgICAgICAgICAgICAgIHJldHVybiBNYXRoLm1heChcbiAgICAgICAgICAgICAgICAgICAgZWxlbS5kb2N1bWVudEVsZW1lbnRbXCJjbGllbnRcIiArIG5hbWVdLFxuICAgICAgICAgICAgICAgICAgICBlbGVtLmJvZHlbXCJzY3JvbGxcIiArIG5hbWVdLCBlbGVtLmRvY3VtZW50RWxlbWVudFtcInNjcm9sbFwiICsgbmFtZV0sXG4gICAgICAgICAgICAgICAgICAgIGVsZW0uYm9keVtcIm9mZnNldFwiICsgbmFtZV0sIGVsZW0uZG9jdW1lbnRFbGVtZW50W1wib2Zmc2V0XCIgKyBuYW1lXVxuICAgICAgICAgICAgICAgICk7XG5cbiAgICAgICAgICAgICAgICAvLyBHZXQgb3Igc2V0IHdpZHRoIG9yIGhlaWdodCBvbiB0aGUgZWxlbWVudFxuICAgICAgICAgICAgfSBlbHNlIGlmICggc2l6ZSA9PT0gdW5kZWZpbmVkICkge1xuICAgICAgICAgICAgICAgIHZhciBvcmlnID0galF1ZXJ5LmNzcyggZWxlbSwgdHlwZSApLFxuICAgICAgICAgICAgICAgICAgICByZXQgPSBwYXJzZUZsb2F0KCBvcmlnICk7XG5cbiAgICAgICAgICAgICAgICByZXR1cm4galF1ZXJ5LmlzTnVtZXJpYyggcmV0ICkgPyByZXQgOiBvcmlnO1xuXG4gICAgICAgICAgICAgICAgLy8gU2V0IHRoZSB3aWR0aCBvciBoZWlnaHQgb24gdGhlIGVsZW1lbnQgKGRlZmF1bHQgdG8gcGl4ZWxzIGlmIHZhbHVlIGlzIHVuaXRsZXNzKVxuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5jc3MoIHR5cGUsIHR5cGVvZiBzaXplID09PSBcInN0cmluZ1wiID8gc2l6ZSA6IHNpemUgKyBcInB4XCIgKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcblxuICAgIH0pO1xuXG5cblxuXG4vLyBFeHBvc2UgalF1ZXJ5IHRvIHRoZSBnbG9iYWwgb2JqZWN0XG4gICAgd2luZG93LmpRdWVyeSA9IHdpbmRvdy4kID0galF1ZXJ5O1xuXG4vLyBFeHBvc2UgalF1ZXJ5IGFzIGFuIEFNRCBtb2R1bGUsIGJ1dCBvbmx5IGZvciBBTUQgbG9hZGVycyB0aGF0XG4vLyB1bmRlcnN0YW5kIHRoZSBpc3N1ZXMgd2l0aCBsb2FkaW5nIG11bHRpcGxlIHZlcnNpb25zIG9mIGpRdWVyeVxuLy8gaW4gYSBwYWdlIHRoYXQgYWxsIG1pZ2h0IGNhbGwgZGVmaW5lKCkuIFRoZSBsb2FkZXIgd2lsbCBpbmRpY2F0ZVxuLy8gdGhleSBoYXZlIHNwZWNpYWwgYWxsb3dhbmNlcyBmb3IgbXVsdGlwbGUgalF1ZXJ5IHZlcnNpb25zIGJ5XG4vLyBzcGVjaWZ5aW5nIGRlZmluZS5hbWQualF1ZXJ5ID0gdHJ1ZS4gUmVnaXN0ZXIgYXMgYSBuYW1lZCBtb2R1bGUsXG4vLyBzaW5jZSBqUXVlcnkgY2FuIGJlIGNvbmNhdGVuYXRlZCB3aXRoIG90aGVyIGZpbGVzIHRoYXQgbWF5IHVzZSBkZWZpbmUsXG4vLyBidXQgbm90IHVzZSBhIHByb3BlciBjb25jYXRlbmF0aW9uIHNjcmlwdCB0aGF0IHVuZGVyc3RhbmRzIGFub255bW91c1xuLy8gQU1EIG1vZHVsZXMuIEEgbmFtZWQgQU1EIGlzIHNhZmVzdCBhbmQgbW9zdCByb2J1c3Qgd2F5IHRvIHJlZ2lzdGVyLlxuLy8gTG93ZXJjYXNlIGpxdWVyeSBpcyB1c2VkIGJlY2F1c2UgQU1EIG1vZHVsZSBuYW1lcyBhcmUgZGVyaXZlZCBmcm9tXG4vLyBmaWxlIG5hbWVzLCBhbmQgalF1ZXJ5IGlzIG5vcm1hbGx5IGRlbGl2ZXJlZCBpbiBhIGxvd2VyY2FzZSBmaWxlIG5hbWUuXG4vLyBEbyB0aGlzIGFmdGVyIGNyZWF0aW5nIHRoZSBnbG9iYWwgc28gdGhhdCBpZiBhbiBBTUQgbW9kdWxlIHdhbnRzIHRvIGNhbGxcbi8vIG5vQ29uZmxpY3QgdG8gaGlkZSB0aGlzIHZlcnNpb24gb2YgalF1ZXJ5LCBpdCB3aWxsIHdvcmsuXG4gICAgaWYgKCB0eXBlb2YgZGVmaW5lID09PSBcImZ1bmN0aW9uXCIgJiYgZGVmaW5lLmFtZCAmJiBkZWZpbmUuYW1kLmpRdWVyeSApIHtcbiAgICAgICAgZGVmaW5lKCBcImpxdWVyeVwiLCBbXSwgZnVuY3Rpb24gKCkgeyByZXR1cm4galF1ZXJ5OyB9ICk7XG4gICAgfVxuXG5cblxufSkoIHdpbmRvdyApO1xuXG53aW5kb3cualF1ZXJ5Lm5vQ29uZmxpY3QoKTtcbnJldHVybiB3aW5kb3cualF1ZXJ5O1xufVxubW9kdWxlLmV4cG9ydHMgPSBjcmVhdGUoJ3VuZGVmaW5lZCcgPT09IHR5cGVvZiB3aW5kb3cgPyB1bmRlZmluZWQgOiB3aW5kb3cpO1xubW9kdWxlLmV4cG9ydHMuY3JlYXRlID0gY3JlYXRlO1xufSgpKTtcbiIsIi8qXG4gKiBDb3B5cmlnaHQgMjAxMiBTbWFsbCBCYXRjaCwgSW5jLlxuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7IHlvdSBtYXkgbm90XG4gKiB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZlxuICogdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsIFdJVEhPVVRcbiAqIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4gU2VlIHRoZVxuICogTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQgbGltaXRhdGlvbnMgdW5kZXJcbiAqIHRoZSBMaWNlbnNlLlxuICovXG47KGZ1bmN0aW9uKHdpbmRvdyxkb2N1bWVudCx1bmRlZmluZWQpe1xuZnVuY3Rpb24gaShhKXtyZXR1cm4gZnVuY3Rpb24oKXtyZXR1cm4gdGhpc1thXX19dmFyIGo7ZnVuY3Rpb24gbihhLGIpe3ZhciBjPWFyZ3VtZW50cy5sZW5ndGg+Mj9BcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChhcmd1bWVudHMsMik6W107cmV0dXJuIGZ1bmN0aW9uKCl7Yy5wdXNoLmFwcGx5KGMsYXJndW1lbnRzKTtyZXR1cm4gYi5hcHBseShhLGMpfX07ZnVuY3Rpb24gbyhhLGIpe3RoaXMuSz1hO3RoaXMuYz1ifW8ucHJvdG90eXBlLmNyZWF0ZUVsZW1lbnQ9ZnVuY3Rpb24oYSxiLGMpe2E9dGhpcy5LLmNyZWF0ZUVsZW1lbnQoYSk7aWYoYilmb3IodmFyIGQgaW4gYilpZihiLmhhc093blByb3BlcnR5KGQpKWQ9PVwic3R5bGVcIj9xKHRoaXMsYSxiW2RdKTphLnNldEF0dHJpYnV0ZShkLGJbZF0pO2MmJmEuYXBwZW5kQ2hpbGQodGhpcy5LLmNyZWF0ZVRleHROb2RlKGMpKTtyZXR1cm4gYX07ZnVuY3Rpb24gcihhLGIsYyl7YT1hLksuZ2V0RWxlbWVudHNCeVRhZ05hbWUoYilbMF07aWYoIWEpYT1kb2N1bWVudC5kb2N1bWVudEVsZW1lbnQ7aWYoYSYmYS5sYXN0Q2hpbGQpe2EuaW5zZXJ0QmVmb3JlKGMsYS5sYXN0Q2hpbGQpO3JldHVybiB0cnVlfXJldHVybiBmYWxzZX1mdW5jdGlvbiBhYShhLGIpe2Z1bmN0aW9uIGMoKXtkb2N1bWVudC5ib2R5P2IoKTpzZXRUaW1lb3V0KGMsMCl9YygpfVxuZnVuY3Rpb24gcyhhLGIpe2lmKGIucGFyZW50Tm9kZSl7Yi5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKGIpO3JldHVybiB0cnVlfXJldHVybiBmYWxzZX1mdW5jdGlvbiB0KGEsYil7cmV0dXJuIGEuY3JlYXRlRWxlbWVudChcImxpbmtcIix7cmVsOlwic3R5bGVzaGVldFwiLGhyZWY6Yn0pfWZ1bmN0aW9uIHUoYSxiKXtyZXR1cm4gYS5jcmVhdGVFbGVtZW50KFwic2NyaXB0XCIse3NyYzpifSl9ZnVuY3Rpb24gdihhLGIsYyl7YT1iLmNsYXNzTmFtZS5zcGxpdCgvXFxzKy8pO2Zvcih2YXIgZD0wLGU9YS5sZW5ndGg7ZDxlO2QrKylpZihhW2RdPT1jKXJldHVybjthLnB1c2goYyk7Yi5jbGFzc05hbWU9YS5qb2luKFwiIFwiKS5yZXBsYWNlKC9eXFxzKy8sXCJcIil9XG5mdW5jdGlvbiB3KGEsYixjKXthPWIuY2xhc3NOYW1lLnNwbGl0KC9cXHMrLyk7Zm9yKHZhciBkPVtdLGU9MCxmPWEubGVuZ3RoO2U8ZjtlKyspYVtlXSE9YyYmZC5wdXNoKGFbZV0pO2IuY2xhc3NOYW1lPWQuam9pbihcIiBcIikucmVwbGFjZSgvXlxccysvLFwiXCIpLnJlcGxhY2UoL1xccyskLyxcIlwiKX1mdW5jdGlvbiB4KGEsYixjKXthPWIuY2xhc3NOYW1lLnNwbGl0KC9cXHMrLyk7Yj0wO2Zvcih2YXIgZD1hLmxlbmd0aDtiPGQ7YisrKWlmKGFbYl09PWMpcmV0dXJuIHRydWU7cmV0dXJuIGZhbHNlfWZ1bmN0aW9uIHEoYSxiLGMpe2lmKGEuYy5nZXROYW1lKCk9PVwiTVNJRVwiKWIuc3R5bGUuY3NzVGV4dD1jO2Vsc2UgYi5zZXRBdHRyaWJ1dGUoXCJzdHlsZVwiLGMpfTtmdW5jdGlvbiB5KGEsYixjLGQsZSxmLGcsaCl7dGhpcy5CYT1hO3RoaXMuSGE9Yjt0aGlzLm9hPWM7dGhpcy5uYT1kO3RoaXMuRWE9ZTt0aGlzLkRhPWY7dGhpcy5tYT1nO3RoaXMuSWE9aH1qPXkucHJvdG90eXBlO2ouZ2V0TmFtZT1pKFwiQmFcIik7ai54YT1pKFwiSGFcIik7ai5ZPWkoXCJvYVwiKTtqLnVhPWkoXCJuYVwiKTtqLnZhPWkoXCJFYVwiKTtqLndhPWkoXCJEYVwiKTtqLnRhPWkoXCJtYVwiKTtqLnc9aShcIklhXCIpO2Z1bmN0aW9uIHooYSxiKXt0aGlzLmM9YTt0aGlzLms9Yn12YXIgYmE9bmV3IHkoXCJVbmtub3duXCIsXCJVbmtub3duXCIsXCJVbmtub3duXCIsXCJVbmtub3duXCIsXCJVbmtub3duXCIsXCJVbmtub3duXCIsdW5kZWZpbmVkLGZhbHNlKTt6LnByb3RvdHlwZS5wYXJzZT1mdW5jdGlvbigpe3JldHVybiB0aGlzLmMuaW5kZXhPZihcIk1TSUVcIikhPS0xP2NhKHRoaXMpOnRoaXMuYy5pbmRleE9mKFwiT3BlcmFcIikhPS0xP2RhKHRoaXMpOnRoaXMuYy5pbmRleE9mKFwiQXBwbGVXZWJLaXRcIikhPS0xP2VhKHRoaXMpOnRoaXMuYy5pbmRleE9mKFwiR2Vja29cIikhPS0xP2ZhKHRoaXMpOmJhfTtcbmZ1bmN0aW9uIEEoYSl7dmFyIGI9QyhhLGEuYywvKGlQb2R8aVBhZHxpUGhvbmV8QW5kcm9pZCkvLDEpO2lmKGIhPVwiXCIpcmV0dXJuIGI7YT1DKGEsYS5jLC8oTGludXh8TWFjX1Bvd2VyUEN8TWFjaW50b3NofFdpbmRvd3MpLywxKTtpZihhIT1cIlwiKXtpZihhPT1cIk1hY19Qb3dlclBDXCIpYT1cIk1hY2ludG9zaFwiO3JldHVybiBhfXJldHVyblwiVW5rbm93blwifWZ1bmN0aW9uIEQoYSl7dmFyIGI9QyhhLGEuYywvKE9TIFh8V2luZG93cyBOVHxBbmRyb2lkKSAoW147KV0rKS8sMik7aWYoYilyZXR1cm4gYjtpZihiPUMoYSxhLmMsLyhpUGhvbmUgKT9PUyAoW1xcZF9dKykvLDIpKXJldHVybiBiO2lmKGE9QyhhLGEuYywvTGludXggKFtpXFxkXSspLywxKSlyZXR1cm4gYTtyZXR1cm5cIlVua25vd25cIn1cbmZ1bmN0aW9uIGNhKGEpe3ZhciBiPUMoYSxhLmMsLyhNU0lFIFtcXGRcXHdcXC5dKykvLDEpO2lmKGIhPVwiXCIpe3ZhciBjPWIuc3BsaXQoXCIgXCIpO2I9Y1swXTtjPWNbMV07cmV0dXJuIG5ldyB5KGIsYyxiLGMsQShhKSxEKGEpLEUoYSxhLmspLEYoYSxjKT49Nil9cmV0dXJuIG5ldyB5KFwiTVNJRVwiLFwiVW5rbm93blwiLFwiTVNJRVwiLFwiVW5rbm93blwiLEEoYSksRChhKSxFKGEsYS5rKSxmYWxzZSl9XG5mdW5jdGlvbiBkYShhKXt2YXIgYj1cIlVua25vd25cIixjPVwiVW5rbm93blwiLGQ9QyhhLGEuYywvKFByZXN0b1xcL1tcXGRcXHdcXC5dKykvLDEpO2lmKGQhPVwiXCIpe2M9ZC5zcGxpdChcIi9cIik7Yj1jWzBdO2M9Y1sxXX1lbHNle2lmKGEuYy5pbmRleE9mKFwiR2Vja29cIikhPS0xKWI9XCJHZWNrb1wiO2Q9QyhhLGEuYywvcnY6KFteXFwpXSspLywxKTtpZihkIT1cIlwiKWM9ZH1pZihhLmMuaW5kZXhPZihcIlZlcnNpb24vXCIpIT0tMSl7ZD1DKGEsYS5jLC9WZXJzaW9uXFwvKFtcXGRcXC5dKykvLDEpO2lmKGQhPVwiXCIpcmV0dXJuIG5ldyB5KFwiT3BlcmFcIixkLGIsYyxBKGEpLEQoYSksRShhLGEuayksRihhLGQpPj0xMCl9ZD1DKGEsYS5jLC9PcGVyYVtcXC8gXShbXFxkXFwuXSspLywxKTtpZihkIT1cIlwiKXJldHVybiBuZXcgeShcIk9wZXJhXCIsZCxiLGMsQShhKSxEKGEpLEUoYSxhLmspLEYoYSxkKT49MTApO3JldHVybiBuZXcgeShcIk9wZXJhXCIsXCJVbmtub3duXCIsYixjLEEoYSksRChhKSxFKGEsYS5rKSxmYWxzZSl9XG5mdW5jdGlvbiBlYShhKXt2YXIgYj1BKGEpLGM9RChhKSxkPUMoYSxhLmMsL0FwcGxlV2ViS2l0XFwvKFtcXGRcXC5cXCtdKykvLDEpO2lmKGQ9PVwiXCIpZD1cIlVua25vd25cIjt2YXIgZT1cIlVua25vd25cIjtpZihhLmMuaW5kZXhPZihcIkNocm9tZVwiKSE9LTEpZT1cIkNocm9tZVwiO2Vsc2UgaWYoYS5jLmluZGV4T2YoXCJTYWZhcmlcIikhPS0xKWU9XCJTYWZhcmlcIjtlbHNlIGlmKGEuYy5pbmRleE9mKFwiQWRvYmVBSVJcIikhPS0xKWU9XCJBZG9iZUFJUlwiO3ZhciBmPVwiVW5rbm93blwiO2lmKGEuYy5pbmRleE9mKFwiVmVyc2lvbi9cIikhPS0xKWY9QyhhLGEuYywvVmVyc2lvblxcLyhbXFxkXFwuXFx3XSspLywxKTtlbHNlIGlmKGU9PVwiQ2hyb21lXCIpZj1DKGEsYS5jLC9DaHJvbWVcXC8oW1xcZFxcLl0rKS8sMSk7ZWxzZSBpZihlPT1cIkFkb2JlQUlSXCIpZj1DKGEsYS5jLC9BZG9iZUFJUlxcLyhbXFxkXFwuXSspLywxKTt2YXIgZz1mYWxzZTtpZihlPT1cIkFkb2JlQUlSXCIpe2c9QyhhLGYsL1xcZCtcXC4oXFxkKykvLDEpO2c9RihhLGYpPjJ8fFxuRihhLGYpPT0yJiZwYXJzZUludChnLDEwKT49NX1lbHNle2c9QyhhLGQsL1xcZCtcXC4oXFxkKykvLDEpO2c9RihhLGQpPj01MjZ8fEYoYSxkKT49NTI1JiZwYXJzZUludChnLDEwKT49MTN9cmV0dXJuIG5ldyB5KGUsZixcIkFwcGxlV2ViS2l0XCIsZCxiLGMsRShhLGEuayksZyl9XG5mdW5jdGlvbiBmYShhKXt2YXIgYj1cIlVua25vd25cIixjPVwiVW5rbm93blwiLGQ9ZmFsc2U7aWYoYS5jLmluZGV4T2YoXCJGaXJlZm94XCIpIT0tMSl7Yj1cIkZpcmVmb3hcIjt2YXIgZT1DKGEsYS5jLC9GaXJlZm94XFwvKFtcXGRcXHdcXC5dKykvLDEpO2lmKGUhPVwiXCIpe2Q9QyhhLGUsL1xcZCtcXC4oXFxkKykvLDEpO2M9ZTtkPWUhPVwiXCImJkYoYSxlKT49MyYmcGFyc2VJbnQoZCwxMCk+PTV9fWVsc2UgaWYoYS5jLmluZGV4T2YoXCJNb3ppbGxhXCIpIT0tMSliPVwiTW96aWxsYVwiO2U9QyhhLGEuYywvcnY6KFteXFwpXSspLywxKTtpZihlPT1cIlwiKWU9XCJVbmtub3duXCI7ZWxzZSBpZighZCl7ZD1GKGEsZSk7dmFyIGY9cGFyc2VJbnQoQyhhLGUsL1xcZCtcXC4oXFxkKykvLDEpLDEwKSxnPXBhcnNlSW50KEMoYSxlLC9cXGQrXFwuXFxkK1xcLihcXGQrKS8sMSksMTApO2Q9ZD4xfHxkPT0xJiZmPjl8fGQ9PTEmJmY9PTkmJmc+PTJ8fGUubWF0Y2goLzFcXC45XFwuMWJbMTIzXS8pIT1udWxsfHxlLm1hdGNoKC8xXFwuOVxcLjFcXC5bXFxkXFwuXSsvKSE9XG5udWxsfXJldHVybiBuZXcgeShiLGMsXCJHZWNrb1wiLGUsQShhKSxEKGEpLEUoYSxhLmspLGQpfWZ1bmN0aW9uIEYoYSxiKXthPUMoYSxiLC8oXFxkKykvLDEpO2lmKGEhPVwiXCIpcmV0dXJuIHBhcnNlSW50KGEsMTApO3JldHVybi0xfWZ1bmN0aW9uIEMoYSxiLGMsZCl7aWYoKGE9Yi5tYXRjaChjKSkmJmFbZF0pcmV0dXJuIGFbZF07cmV0dXJuXCJcIn1mdW5jdGlvbiBFKGEsYil7aWYoYi5kb2N1bWVudE1vZGUpcmV0dXJuIGIuZG9jdW1lbnRNb2RlfTtmdW5jdGlvbiBnYShhLGIsYyxkKXt0aGlzLmE9YTt0aGlzLmc9Yjt0aGlzLlU9Yzt0aGlzLmo9ZHx8aGE7dGhpcy5oPW5ldyBHKFwiLVwiKX12YXIgaGE9XCJ3ZlwiO2Z1bmN0aW9uIEgoYSl7dihhLmEsYS5nLGEuaC5lKGEuaixcImxvYWRpbmdcIikpO0koYSxcImxvYWRpbmdcIil9ZnVuY3Rpb24gSihhKXt3KGEuYSxhLmcsYS5oLmUoYS5qLFwibG9hZGluZ1wiKSk7eChhLmEsYS5nLGEuaC5lKGEuaixcImFjdGl2ZVwiKSl8fHYoYS5hLGEuZyxhLmguZShhLmosXCJpbmFjdGl2ZVwiKSk7SShhLFwiaW5hY3RpdmVcIil9ZnVuY3Rpb24gaWEoYSl7dyhhLmEsYS5nLGEuaC5lKGEuaixcImxvYWRpbmdcIikpO3coYS5hLGEuZyxhLmguZShhLmosXCJpbmFjdGl2ZVwiKSk7dihhLmEsYS5nLGEuaC5lKGEuaixcImFjdGl2ZVwiKSk7SShhLFwiYWN0aXZlXCIpfWZ1bmN0aW9uIEkoYSxiLGMsZCl7YS5VW2JdJiZhLlVbYl0oYyxkKX07ZnVuY3Rpb24gamEoKXt0aGlzLmZhPXt9fWZ1bmN0aW9uIGthKGEsYil7dmFyIGM9W107Zm9yKHZhciBkIGluIGIpaWYoYi5oYXNPd25Qcm9wZXJ0eShkKSl7dmFyIGU9YS5mYVtkXTtlJiZjLnB1c2goZShiW2RdKSl9cmV0dXJuIGN9O2Z1bmN0aW9uIEwoYSxiLGMsZCxlKXt0aGlzLmE9YTt0aGlzLkE9Yjt0aGlzLm49Yzt0aGlzLnU9ZDt0aGlzLkQ9ZTt0aGlzLlY9MDt0aGlzLmphPXRoaXMuZWE9ZmFsc2V9TC5wcm90b3R5cGUud2F0Y2g9ZnVuY3Rpb24oYSxiLGMsZCxlKXtmb3IodmFyIGY9YS5sZW5ndGgsZz0wO2c8ZjtnKyspe3ZhciBoPWFbZ107YltoXXx8KGJbaF09W1wibjRcIl0pO3RoaXMuVis9YltoXS5sZW5ndGh9aWYoZSl0aGlzLmVhPWU7Zm9yKGc9MDtnPGY7ZysrKXtoPWFbZ107ZT1iW2hdO2Zvcih2YXIgbD1jW2hdLGs9MCxtPWUubGVuZ3RoO2s8bTtrKyspe3ZhciBCPWVba10scD10aGlzLkEsSz1oO3YocC5hLHAuZyxwLmguZShwLmosSyxCLFwibG9hZGluZ1wiKSk7SShwLFwiZm9udGxvYWRpbmdcIixLLEIpO3A9bih0aGlzLHRoaXMucWEpO0s9bih0aGlzLHRoaXMucmEpOyhuZXcgZChwLEssdGhpcy5hLHRoaXMubix0aGlzLnUsdGhpcy5ELGgsQixsKSkuc3RhcnQoKX19fTtcbkwucHJvdG90eXBlLnFhPWZ1bmN0aW9uKGEsYil7dmFyIGM9dGhpcy5BO3coYy5hLGMuZyxjLmguZShjLmosYSxiLFwibG9hZGluZ1wiKSk7dyhjLmEsYy5nLGMuaC5lKGMuaixhLGIsXCJpbmFjdGl2ZVwiKSk7dihjLmEsYy5nLGMuaC5lKGMuaixhLGIsXCJhY3RpdmVcIikpO0koYyxcImZvbnRhY3RpdmVcIixhLGIpO3RoaXMuamE9dHJ1ZTtNKHRoaXMpfTtMLnByb3RvdHlwZS5yYT1mdW5jdGlvbihhLGIpe3ZhciBjPXRoaXMuQTt3KGMuYSxjLmcsYy5oLmUoYy5qLGEsYixcImxvYWRpbmdcIikpO3goYy5hLGMuZyxjLmguZShjLmosYSxiLFwiYWN0aXZlXCIpKXx8dihjLmEsYy5nLGMuaC5lKGMuaixhLGIsXCJpbmFjdGl2ZVwiKSk7SShjLFwiZm9udGluYWN0aXZlXCIsYSxiKTtNKHRoaXMpfTtmdW5jdGlvbiBNKGEpe2lmKC0tYS5WPT0wJiZhLmVhKWEuamE/aWEoYS5BKTpKKGEuQSl9O2Z1bmN0aW9uIE4oYSxiLGMsZCxlLGYsZyxoLGwpe3RoaXMuSD1hO3RoaXMuJD1iO3RoaXMuYT1jO3RoaXMubj1kO3RoaXMudT1lO3RoaXMuRD1mO3RoaXMuQWE9bmV3IGxhO3RoaXMudj1uZXcgTzt0aGlzLkw9Zzt0aGlzLkI9aDt0aGlzLnNhPWx8fG1hO3RoaXMuTz1uYSh0aGlzLG9hKTt0aGlzLlA9bmEodGhpcyxwYSk7dGhpcy5jYT10aGlzLk87dGhpcy5kYT10aGlzLlA7dGhpcy5RPVAodGhpcyxvYSk7dGhpcy5SPVAodGhpcyxwYSl9dmFyIG9hPVwiYXJpYWwsJ1VSVyBHb3RoaWMgTCcsc2Fucy1zZXJpZlwiLHBhPVwiR2VvcmdpYSwnQ2VudHVyeSBTY2hvb2xib29rIEwnLHNlcmlmXCIsbWE9XCJCRVNic3d5XCI7Ti5wcm90b3R5cGUuc3RhcnQ9ZnVuY3Rpb24oKXt0aGlzLmlhPXRoaXMuRCgpO3RoaXMuSigpfTtcbk4ucHJvdG90eXBlLko9ZnVuY3Rpb24oKXt2YXIgYT10aGlzLm4ucCh0aGlzLlEpLGI9dGhpcy5uLnAodGhpcy5SKTtpZigodGhpcy5PIT1hfHx0aGlzLlAhPWIpJiZ0aGlzLmNhPT1hJiZ0aGlzLmRhPT1iKVEodGhpcyx0aGlzLkgpO2Vsc2UgaWYodGhpcy5EKCktdGhpcy5pYT49NUUzKVEodGhpcyx0aGlzLiQpO2Vsc2V7dGhpcy5jYT1hO3RoaXMuZGE9YjtxYSh0aGlzKX19O2Z1bmN0aW9uIHFhKGEpe2EudShmdW5jdGlvbihiLGMpe3JldHVybiBmdW5jdGlvbigpe2MuY2FsbChiKX19KGEsYS5KKSwyNSl9ZnVuY3Rpb24gUShhLGIpe3MoYS5hLGEuUSk7cyhhLmEsYS5SKTtiKGEuTCxhLkIpfWZ1bmN0aW9uIG5hKGEsYil7Yj1QKGEsYix0cnVlKTt2YXIgYz1hLm4ucChiKTtzKGEuYSxiKTtyZXR1cm4gY31mdW5jdGlvbiBQKGEsYixjKXtiPWEuYS5jcmVhdGVFbGVtZW50KFwic3BhblwiLHtzdHlsZTpSKGEsYixhLkIsYyl9LGEuc2EpO3IoYS5hLFwiYm9keVwiLGIpO3JldHVybiBifVxuZnVuY3Rpb24gUihhLGIsYyxkKXtjPWEudi5leHBhbmQoYyk7cmV0dXJuXCJwb3NpdGlvbjphYnNvbHV0ZTt0b3A6LTk5OXB4O2xlZnQ6LTk5OXB4O2ZvbnQtc2l6ZTozMDBweDt3aWR0aDphdXRvO2hlaWdodDphdXRvO2xpbmUtaGVpZ2h0Om5vcm1hbDttYXJnaW46MDtwYWRkaW5nOjA7Zm9udC12YXJpYW50Om5vcm1hbDtmb250LWZhbWlseTpcIisoZD9cIlwiOmEuQWEucXVvdGUoYS5MKStcIixcIikrYitcIjtcIitjfTtmdW5jdGlvbiBTKGEsYixjLGQsZSl7dGhpcy5hPWE7dGhpcy5YPWI7dGhpcy5nPWM7dGhpcy51PWQ7dGhpcy5jPWU7dGhpcy5NPXRoaXMuTj0wfVMucHJvdG90eXBlLnE9ZnVuY3Rpb24oYSxiKXt0aGlzLlguZmFbYV09Yn07Uy5wcm90b3R5cGUubG9hZD1mdW5jdGlvbihhKXt2YXIgYj1uZXcgZ2EodGhpcy5hLHRoaXMuZyxhKTt0aGlzLmMudygpP3JhKHRoaXMsYixhKTpKKGIpfTtTLnByb3RvdHlwZS55YT1mdW5jdGlvbihhLGIsYyxkKXt2YXIgZT1hLlo/YS5aKCk6TjtpZihkKWEubG9hZChuKHRoaXMsdGhpcy5DYSxiLGMsZSkpO2Vsc2V7YT0tLXRoaXMuTj09MDt0aGlzLk0tLTtpZihhKXRoaXMuTT09MD9KKGIpOkgoYik7Yy53YXRjaChbXSx7fSx7fSxlLGEpfX07XG5TLnByb3RvdHlwZS5DYT1mdW5jdGlvbihhLGIsYyxkLGUsZil7dmFyIGc9LS10aGlzLk49PTA7ZyYmSChhKTt0aGlzLnUobih0aGlzLGZ1bmN0aW9uKGgsbCxrLG0sQixwKXtoLndhdGNoKGwsa3x8e30sbXx8e30sQixwKX0sYixkLGUsZixjLGcpKX07ZnVuY3Rpb24gcmEoYSxiLGMpe2M9a2EoYS5YLGMpO2EuTT1hLk49Yy5sZW5ndGg7Zm9yKHZhciBkPW5ldyBMKGEuYSxiLHtwOmZ1bmN0aW9uKGgpe3JldHVybiBoLm9mZnNldFdpZHRofX0sYS51LGZ1bmN0aW9uKCl7cmV0dXJuKG5ldyBEYXRlKS5nZXRUaW1lKCl9KSxlPTAsZj1jLmxlbmd0aDtlPGY7ZSsrKXt2YXIgZz1jW2VdO2cueihhLmMsbihhLGEueWEsZyxiLGQpKX19O2Z1bmN0aW9uIEcoYSl7dGhpcy56YT1hfHxzYX12YXIgc2E9XCItXCI7Ry5wcm90b3R5cGUuZT1mdW5jdGlvbigpe2Zvcih2YXIgYT1bXSxiPTA7Yjxhcmd1bWVudHMubGVuZ3RoO2IrKylhLnB1c2goYXJndW1lbnRzW2JdLnJlcGxhY2UoL1tcXFdfXSsvZyxcIlwiKS50b0xvd2VyQ2FzZSgpKTtyZXR1cm4gYS5qb2luKHRoaXMuemEpfTtmdW5jdGlvbiBsYSgpe3RoaXMuaGE9XCInXCJ9bGEucHJvdG90eXBlLnF1b3RlPWZ1bmN0aW9uKGEpe3ZhciBiPVtdO2E9YS5zcGxpdCgvLFxccyovKTtmb3IodmFyIGM9MDtjPGEubGVuZ3RoO2MrKyl7dmFyIGQ9YVtjXS5yZXBsYWNlKC9bJ1wiXS9nLFwiXCIpO2QuaW5kZXhPZihcIiBcIik9PS0xP2IucHVzaChkKTpiLnB1c2godGhpcy5oYStkK3RoaXMuaGEpfXJldHVybiBiLmpvaW4oXCIsXCIpfTtmdW5jdGlvbiBPKCl7dGhpcy5HPXRhO3RoaXMubz11YX12YXIgdGE9W1wiZm9udC1zdHlsZVwiLFwiZm9udC13ZWlnaHRcIl0sdWE9e1wiZm9udC1zdHlsZVwiOltbXCJuXCIsXCJub3JtYWxcIl0sW1wiaVwiLFwiaXRhbGljXCJdLFtcIm9cIixcIm9ibGlxdWVcIl1dLFwiZm9udC13ZWlnaHRcIjpbW1wiMVwiLFwiMTAwXCJdLFtcIjJcIixcIjIwMFwiXSxbXCIzXCIsXCIzMDBcIl0sW1wiNFwiLFwiNDAwXCJdLFtcIjVcIixcIjUwMFwiXSxbXCI2XCIsXCI2MDBcIl0sW1wiN1wiLFwiNzAwXCJdLFtcIjhcIixcIjgwMFwiXSxbXCI5XCIsXCI5MDBcIl0sW1wiNFwiLFwibm9ybWFsXCJdLFtcIjdcIixcImJvbGRcIl1dfTtmdW5jdGlvbiBUKGEsYixjKXt0aGlzLmFhPWE7dGhpcy5GYT1iO3RoaXMubz1jfVQucHJvdG90eXBlLmNvbXBhY3Q9ZnVuY3Rpb24oYSxiKXtmb3IodmFyIGM9MDtjPHRoaXMuby5sZW5ndGg7YysrKWlmKGI9PXRoaXMub1tjXVsxXSl7YVt0aGlzLmFhXT10aGlzLm9bY11bMF07cmV0dXJufX07XG5ULnByb3RvdHlwZS5leHBhbmQ9ZnVuY3Rpb24oYSxiKXtmb3IodmFyIGM9MDtjPHRoaXMuby5sZW5ndGg7YysrKWlmKGI9PXRoaXMub1tjXVswXSl7YVt0aGlzLmFhXT10aGlzLkZhK1wiOlwiK3RoaXMub1tjXVsxXTtyZXR1cm59fTtPLnByb3RvdHlwZS5jb21wYWN0PWZ1bmN0aW9uKGEpe3ZhciBiPVtcIm5cIixcIjRcIl07YT1hLnNwbGl0KFwiO1wiKTtmb3IodmFyIGM9MCxkPWEubGVuZ3RoO2M8ZDtjKyspe3ZhciBlPWFbY10ucmVwbGFjZSgvXFxzKy9nLFwiXCIpLnNwbGl0KFwiOlwiKTtpZihlLmxlbmd0aD09Mil7dmFyIGY9ZVsxXTthOntlPWVbMF07Zm9yKHZhciBnPTA7Zzx0aGlzLkcubGVuZ3RoO2crKylpZihlPT10aGlzLkdbZ10pe2U9bmV3IFQoZyxlLHRoaXMub1tlXSk7YnJlYWsgYX1lPW51bGx9ZSYmZS5jb21wYWN0KGIsZil9fXJldHVybiBiLmpvaW4oXCJcIil9O1xuTy5wcm90b3R5cGUuZXhwYW5kPWZ1bmN0aW9uKGEpe2lmKGEubGVuZ3RoIT0yKXJldHVybiBudWxsO2Zvcih2YXIgYj1bbnVsbCxudWxsXSxjPTAsZD10aGlzLkcubGVuZ3RoO2M8ZDtjKyspe3ZhciBlPXRoaXMuR1tjXSxmPWEuc3Vic3RyKGMsMSk7KG5ldyBUKGMsZSx0aGlzLm9bZV0pKS5leHBhbmQoYixmKX1yZXR1cm4gYlswXSYmYlsxXT9iLmpvaW4oXCI7XCIpK1wiO1wiOm51bGx9O3dpbmRvdy5XZWJGb250PWZ1bmN0aW9uKCl7dmFyIGE9KG5ldyB6KG5hdmlnYXRvci51c2VyQWdlbnQsZG9jdW1lbnQpKS5wYXJzZSgpO3JldHVybiBuZXcgUyhuZXcgbyhkb2N1bWVudCxhKSxuZXcgamEsZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LGZ1bmN0aW9uKGIsYyl7c2V0VGltZW91dChiLGMpfSxhKX0oKTt3aW5kb3cuV2ViRm9udC5sb2FkPXdpbmRvdy5XZWJGb250LmxvYWQ7d2luZG93LldlYkZvbnQuYWRkTW9kdWxlPXdpbmRvdy5XZWJGb250LnE7eS5wcm90b3R5cGUuZ2V0TmFtZT15LnByb3RvdHlwZS5nZXROYW1lO3kucHJvdG90eXBlLmdldFZlcnNpb249eS5wcm90b3R5cGUueGE7eS5wcm90b3R5cGUuZ2V0RW5naW5lPXkucHJvdG90eXBlLlk7eS5wcm90b3R5cGUuZ2V0RW5naW5lVmVyc2lvbj15LnByb3RvdHlwZS51YTt5LnByb3RvdHlwZS5nZXRQbGF0Zm9ybT15LnByb3RvdHlwZS52YTt5LnByb3RvdHlwZS5nZXRQbGF0Zm9ybVZlcnNpb249eS5wcm90b3R5cGUud2E7XG55LnByb3RvdHlwZS5nZXREb2N1bWVudE1vZGU9eS5wcm90b3R5cGUudGE7eS5wcm90b3R5cGUuaXNTdXBwb3J0aW5nV2ViRm9udD15LnByb3RvdHlwZS53O2Z1bmN0aW9uIFUoYSxiKXt0aGlzLmE9YTt0aGlzLmQ9Yn12YXIgdmE9e3JlZ3VsYXI6XCJuNFwiLGJvbGQ6XCJuN1wiLGl0YWxpYzpcImk0XCIsYm9sZGl0YWxpYzpcImk3XCIscjpcIm40XCIsYjpcIm43XCIsaTpcImk0XCIsYmk6XCJpN1wifTtVLnByb3RvdHlwZS56PWZ1bmN0aW9uKGEsYil7cmV0dXJuIGIoYS53KCkpfTtcblUucHJvdG90eXBlLmxvYWQ9ZnVuY3Rpb24oYSl7cih0aGlzLmEsXCJoZWFkXCIsdCh0aGlzLmEsKFwiaHR0cHM6XCI9PWRvY3VtZW50LmxvY2F0aW9uLnByb3RvY29sP1wiaHR0cHM6XCI6XCJodHRwOlwiKStcIi8vd2ViZm9udHMuZm9udHNsaXZlLmNvbS9jc3MvXCIrdGhpcy5kLmtleStcIi5jc3NcIikpO3ZhciBiO2I9dGhpcy5kLmZhbWlsaWVzO3ZhciBjLGQsZTtjPVtdO2Q9e307Zm9yKHZhciBmPTAsZz1iLmxlbmd0aDtmPGc7ZisrKXtlPXZvaWQgMDt2YXIgaD12b2lkIDA7aD12b2lkIDA7aD1iW2ZdLnNwbGl0KFwiOlwiKTtlPWhbMF07aD1oWzFdP3dhKHRoaXMsaFsxXSk6W1wibjRcIl07ZT17VzplLFQ6aH07Yy5wdXNoKGUuVyk7ZFtlLlddPWUuVH1iPXtwYTpjLFQ6ZH07YShiLnBhLGIuVCl9O1xuZnVuY3Rpb24gd2EoYSxiKXthPWIuc3BsaXQoXCIsXCIpO2I9W107Zm9yKHZhciBjPTAsZD1hLmxlbmd0aDtjPGQ7YysrKXt2YXIgZT1hW2NdO2lmKGUpe3ZhciBmPXZhW2VdO2IucHVzaChmP2Y6ZSl9fXJldHVybiBifXdpbmRvdy5XZWJGb250LnEoXCJhc2NlbmRlclwiLGZ1bmN0aW9uKGEpe3ZhciBiPShuZXcgeihuYXZpZ2F0b3IudXNlckFnZW50LGRvY3VtZW50KSkucGFyc2UoKTtyZXR1cm4gbmV3IFUobmV3IG8oZG9jdW1lbnQsYiksYSl9KTtmdW5jdGlvbiBWKGEsYixjLGQsZSxmLGcsaCxsKXtWLkdhLmNhbGwodGhpcyxhLGIsYyxkLGUsZixnLGgsbCk7YT1bXCJUaW1lcyBOZXcgUm9tYW5cIixcIkx1Y2lkYSBTYW5zIFVuaWNvZGVcIixcIkNvdXJpZXIgTmV3XCIsXCJUYWhvbWFcIixcIkFyaWFsXCIsXCJNaWNyb3NvZnQgU2FucyBTZXJpZlwiLFwiVGltZXNcIixcIkx1Y2lkYSBDb25zb2xlXCIsXCJTYW5zXCIsXCJTZXJpZlwiLFwiTW9ub3NwYWNlXCJdO2I9YS5sZW5ndGg7Yz17fTtkPVAodGhpcyxhWzBdLHRydWUpO2NbdGhpcy5uLnAoZCldPXRydWU7Zm9yKGU9MTtlPGI7ZSsrKXtmPWFbZV07cSh0aGlzLmEsZCxSKHRoaXMsZix0aGlzLkIsdHJ1ZSkpO2NbdGhpcy5uLnAoZCldPXRydWU7aWYodGhpcy5CWzFdIT1cIjRcIil7cSh0aGlzLmEsZCxSKHRoaXMsZix0aGlzLkJbMF0rXCI0XCIsdHJ1ZSkpO2NbdGhpcy5uLnAoZCldPXRydWV9fXModGhpcy5hLGQpO3RoaXMudD1jO3RoaXMubGE9ZmFsc2V9XG4oZnVuY3Rpb24oYSxiKXtmdW5jdGlvbiBjKCl7fWMucHJvdG90eXBlPWEucHJvdG90eXBlO2IucHJvdG90eXBlPW5ldyBjO2IuR2E9YTtiLkphPWEucHJvdG90eXBlfSkoTixWKTt2YXIgeGE9e0FyaW1vOnRydWUsQ291c2luZTp0cnVlLFRpbm9zOnRydWV9O1YucHJvdG90eXBlLko9ZnVuY3Rpb24oKXt2YXIgYT10aGlzLm4ucCh0aGlzLlEpLGI9dGhpcy5uLnAodGhpcy5SKTtpZighdGhpcy5sYSYmYT09YiYmdGhpcy50W2FdKXt0aGlzLnQ9e307dGhpcy5sYT10aGlzLnRbYV09dHJ1ZX1pZigodGhpcy5PIT1hfHx0aGlzLlAhPWIpJiYhdGhpcy50W2FdJiYhdGhpcy50W2JdKVEodGhpcyx0aGlzLkgpO2Vsc2UgaWYodGhpcy5EKCktdGhpcy5pYT49NUUzKXRoaXMudFthXSYmdGhpcy50W2JdJiZ4YVt0aGlzLkxdP1EodGhpcyx0aGlzLkgpOlEodGhpcyx0aGlzLiQpO2Vsc2UgcWEodGhpcyl9O2Z1bmN0aW9uIHlhKGEpe3RoaXMuST1hP2E6KFwiaHR0cHM6XCI9PXdpbmRvdy5sb2NhdGlvbi5wcm90b2NvbD9cImh0dHBzOlwiOlwiaHR0cDpcIikremE7dGhpcy5mPVtdO3RoaXMuUz1bXX12YXIgemE9XCIvL2ZvbnRzLmdvb2dsZWFwaXMuY29tL2Nzc1wiO3lhLnByb3RvdHlwZS5lPWZ1bmN0aW9uKCl7aWYodGhpcy5mLmxlbmd0aD09MCl0aHJvdyBuZXcgRXJyb3IoXCJObyBmb250cyB0byBsb2FkICFcIik7aWYodGhpcy5JLmluZGV4T2YoXCJraXQ9XCIpIT0tMSlyZXR1cm4gdGhpcy5JO2Zvcih2YXIgYT10aGlzLmYubGVuZ3RoLGI9W10sYz0wO2M8YTtjKyspYi5wdXNoKHRoaXMuZltjXS5yZXBsYWNlKC8gL2csXCIrXCIpKTthPXRoaXMuSStcIj9mYW1pbHk9XCIrYi5qb2luKFwiJTdDXCIpO2lmKHRoaXMuUy5sZW5ndGg+MClhKz1cIiZzdWJzZXQ9XCIrdGhpcy5TLmpvaW4oXCIsXCIpO3JldHVybiBhfTtmdW5jdGlvbiBBYShhKXt0aGlzLmY9YTt0aGlzLmdhPVtdO3RoaXMua2E9e307dGhpcy5GPXt9O3RoaXMudj1uZXcgT312YXIgQmE9e3VsdHJhbGlnaHQ6XCJuMlwiLGxpZ2h0OlwibjNcIixyZWd1bGFyOlwibjRcIixib2xkOlwibjdcIixpdGFsaWM6XCJpNFwiLGJvbGRpdGFsaWM6XCJpN1wiLHVsOlwibjJcIixsOlwibjNcIixyOlwibjRcIixiOlwibjdcIixpOlwiaTRcIixiaTpcImk3XCJ9LENhPXtsYXRpbjptYSxjeXJpbGxpYzpcIiYjMTA4MTsmIzExMDM7JiMxMDQ2O1wiLGdyZWVrOlwiJiM5NDU7JiM5NDY7JiM5MzE7XCIsa2htZXI6XCImI3gxNzgwOyYjeDE3ODE7JiN4MTc4MjtcIixIYW51bWFuOlwiJiN4MTc4MDsmI3gxNzgxOyYjeDE3ODI7XCJ9O1xuQWEucHJvdG90eXBlLnBhcnNlPWZ1bmN0aW9uKCl7Zm9yKHZhciBhPXRoaXMuZi5sZW5ndGgsYj0wO2I8YTtiKyspe3ZhciBjPXRoaXMuZltiXS5zcGxpdChcIjpcIiksZD1jWzBdLGU9W1wibjRcIl07aWYoYy5sZW5ndGg+PTIpe3ZhciBmPWNbMV0sZz1bXTtpZihmKXtmPWYuc3BsaXQoXCIsXCIpO2Zvcih2YXIgaD1mLmxlbmd0aCxsPTA7bDxoO2wrKyl7dmFyIGs7az1mW2xdO2lmKGsubWF0Y2goL15bXFx3IF0rJC8pKXt2YXIgbT1CYVtrXTtpZihtKWs9bTtlbHNle209ay5tYXRjaCgvXihcXGQqKShcXHcqKSQvKTtrPW1bMV07bT1tWzJdO2s9KGs9dGhpcy52LmV4cGFuZChbbT9tOlwiblwiLGs/ay5zdWJzdHIoMCwxKTpcIjRcIl0uam9pbihcIlwiKSkpP3RoaXMudi5jb21wYWN0KGspOm51bGx9fWVsc2Ugaz1cIlwiO2smJmcucHVzaChrKX19aWYoZy5sZW5ndGg+MCllPWc7aWYoYy5sZW5ndGg9PTMpe2M9Y1syXTtnPVtdO2M9Yz9jLnNwbGl0KFwiLFwiKTpnO2lmKGMubGVuZ3RoPjApaWYoYz1DYVtjWzBdXSl0aGlzLkZbZF09XG5jfX1pZighdGhpcy5GW2RdKWlmKGM9Q2FbZF0pdGhpcy5GW2RdPWM7dGhpcy5nYS5wdXNoKGQpO3RoaXMua2FbZF09ZX19O2Z1bmN0aW9uIFcoYSxiLGMpe3RoaXMuYz1hO3RoaXMuYT1iO3RoaXMuZD1jfVcucHJvdG90eXBlLno9ZnVuY3Rpb24oYSxiKXtiKGEudygpKX07Vy5wcm90b3R5cGUuWj1mdW5jdGlvbigpe2lmKHRoaXMuYy5ZKCk9PVwiQXBwbGVXZWJLaXRcIilyZXR1cm4gVjtyZXR1cm4gTn07Vy5wcm90b3R5cGUubG9hZD1mdW5jdGlvbihhKXt2YXIgYj10aGlzLmE7dGhpcy5jLmdldE5hbWUoKT09XCJNU0lFXCImJnRoaXMuZC5ibG9ja2luZyE9dHJ1ZT9hYShiLG4odGhpcyx0aGlzLmJhLGEpKTp0aGlzLmJhKGEpfTtcblcucHJvdG90eXBlLmJhPWZ1bmN0aW9uKGEpe2Zvcih2YXIgYj10aGlzLmEsYz1uZXcgeWEodGhpcy5kLmFwaSksZD10aGlzLmQuZmFtaWxpZXMsZT1kLmxlbmd0aCxmPTA7ZjxlO2YrKyl7dmFyIGc9ZFtmXS5zcGxpdChcIjpcIik7Zy5sZW5ndGg9PTMmJmMuUy5wdXNoKGcucG9wKCkpO2MuZi5wdXNoKGcuam9pbihcIjpcIikpfWQ9bmV3IEFhKGQpO2QucGFyc2UoKTtyKGIsXCJoZWFkXCIsdChiLGMuZSgpKSk7YShkLmdhLGQua2EsZC5GKX07d2luZG93LldlYkZvbnQucShcImdvb2dsZVwiLGZ1bmN0aW9uKGEpe3ZhciBiPShuZXcgeihuYXZpZ2F0b3IudXNlckFnZW50LGRvY3VtZW50KSkucGFyc2UoKTtyZXR1cm4gbmV3IFcoYixuZXcgbyhkb2N1bWVudCxiKSxhKX0pO2Z1bmN0aW9uIFgoYSxiKXt0aGlzLmE9YTt0aGlzLmQ9Yn1YLnByb3RvdHlwZS5sb2FkPWZ1bmN0aW9uKGEpe2Zvcih2YXIgYj10aGlzLmQudXJsc3x8W10sYz10aGlzLmQuZmFtaWxpZXN8fFtdLGQ9MCxlPWIubGVuZ3RoO2Q8ZTtkKyspcih0aGlzLmEsXCJoZWFkXCIsdCh0aGlzLmEsYltkXSkpO2EoYyl9O1gucHJvdG90eXBlLno9ZnVuY3Rpb24oYSxiKXtyZXR1cm4gYihhLncoKSl9O3dpbmRvdy5XZWJGb250LnEoXCJjdXN0b21cIixmdW5jdGlvbihhKXt2YXIgYj0obmV3IHoobmF2aWdhdG9yLnVzZXJBZ2VudCxkb2N1bWVudCkpLnBhcnNlKCk7cmV0dXJuIG5ldyBYKG5ldyBvKGRvY3VtZW50LGIpLGEpfSk7ZnVuY3Rpb24gWShhLGIsYyl7dGhpcy5tPWE7dGhpcy5hPWI7dGhpcy5kPWM7dGhpcy5mPVtdO3RoaXMucz17fTt0aGlzLnY9bmV3IE99WS5wcm90b3R5cGUuQz1mdW5jdGlvbihhKXtyZXR1cm4oXCJodHRwczpcIj09dGhpcy5tLmxvY2F0aW9uLnByb3RvY29sP1wiaHR0cHM6XCI6XCJodHRwOlwiKSsodGhpcy5kLmFwaXx8XCIvL2YuZm9udGRlY2suY29tL3MvY3NzL2pzL1wiKSt0aGlzLm0uZG9jdW1lbnQubG9jYXRpb24uaG9zdG5hbWUrXCIvXCIrYStcIi5qc1wifTtcblkucHJvdG90eXBlLno9ZnVuY3Rpb24oYSxiKXthPXRoaXMuZC5pZDt2YXIgYz10aGlzO2lmKGEpe3RoaXMubS5fX3dlYmZvbnRmb250ZGVja21vZHVsZV9ffHwodGhpcy5tLl9fd2ViZm9udGZvbnRkZWNrbW9kdWxlX189e30pO3RoaXMubS5fX3dlYmZvbnRmb250ZGVja21vZHVsZV9fW2FdPWZ1bmN0aW9uKGQsZSl7Zm9yKHZhciBmPTAsZz1lLmZvbnRzLmxlbmd0aDtmPGc7KytmKXt2YXIgaD1lLmZvbnRzW2ZdO2MuZi5wdXNoKGgubmFtZSk7Yy5zW2gubmFtZV09W2Mudi5jb21wYWN0KFwiZm9udC13ZWlnaHQ6XCIraC53ZWlnaHQrXCI7Zm9udC1zdHlsZTpcIitoLnN0eWxlKV19YihkKX07cih0aGlzLmEsXCJoZWFkXCIsdSh0aGlzLmEsdGhpcy5DKGEpKSl9ZWxzZSBiKHRydWUpfTtZLnByb3RvdHlwZS5sb2FkPWZ1bmN0aW9uKGEpe2EodGhpcy5mLHRoaXMucyl9O1xud2luZG93LldlYkZvbnQucShcImZvbnRkZWNrXCIsZnVuY3Rpb24oYSl7dmFyIGI9KG5ldyB6KG5hdmlnYXRvci51c2VyQWdlbnQsZG9jdW1lbnQpKS5wYXJzZSgpO3JldHVybiBuZXcgWSh3aW5kb3csbmV3IG8oZG9jdW1lbnQsYiksYSl9KTtmdW5jdGlvbiBaKGEsYixjLGQsZSl7dGhpcy5tPWE7dGhpcy5jPWI7dGhpcy5hPWM7dGhpcy5rPWQ7dGhpcy5kPWU7dGhpcy5mPVtdO3RoaXMucz17fX1cbloucHJvdG90eXBlLno9ZnVuY3Rpb24oYSxiKXt2YXIgYz10aGlzLGQ9Yy5kLnByb2plY3RJZDtpZihkKXt2YXIgZT11KGMuYSxjLkMoZCkpO2UuaWQ9XCJfX01vbm90eXBlQVBJU2NyaXB0X19cIitkO2Uub25yZWFkeXN0YXRlY2hhbmdlPWZ1bmN0aW9uKGYpe2lmKGUucmVhZHlTdGF0ZT09PVwibG9hZGVkXCJ8fGUucmVhZHlTdGF0ZT09PVwiY29tcGxldGVcIil7ZS5vbnJlYWR5c3RhdGVjaGFuZ2U9bnVsbDtlLm9ubG9hZChmKX19O2Uub25sb2FkPWZ1bmN0aW9uKCl7aWYoYy5tW1wiX19tdGlfZm50THN0XCIrZF0pe3ZhciBmPWMubVtcIl9fbXRpX2ZudExzdFwiK2RdKCk7aWYoZiYmZi5sZW5ndGgpe3ZhciBnO2ZvcihnPTA7ZzxmLmxlbmd0aDtnKyspYy5mLnB1c2goZltnXS5mb250ZmFtaWx5KX19YihhLncoKSl9O3IodGhpcy5hLFwiaGVhZFwiLGUpfWVsc2UgYih0cnVlKX07XG5aLnByb3RvdHlwZS5DPWZ1bmN0aW9uKGEpe3ZhciBiPXRoaXMucHJvdG9jb2woKSxjPSh0aGlzLmQuYXBpfHxcImZhc3QuZm9udHMuY29tL2pzYXBpXCIpLnJlcGxhY2UoL14uKmh0dHAocz8pOihcXC9cXC8pPy8sXCJcIik7cmV0dXJuIGIrXCIvL1wiK2MrXCIvXCIrYStcIi5qc1wifTtaLnByb3RvdHlwZS5sb2FkPWZ1bmN0aW9uKGEpe2EodGhpcy5mLHRoaXMucyl9O1oucHJvdG90eXBlLnByb3RvY29sPWZ1bmN0aW9uKCl7dmFyIGE9W1wiaHR0cDpcIixcImh0dHBzOlwiXSxiPWFbMF07aWYodGhpcy5rJiZ0aGlzLmsubG9jYXRpb24mJnRoaXMuay5sb2NhdGlvbi5wcm90b2NvbCl7dmFyIGM9MDtmb3IoYz0wO2M8YS5sZW5ndGg7YysrKWlmKHRoaXMuay5sb2NhdGlvbi5wcm90b2NvbD09PWFbY10pcmV0dXJuIHRoaXMuay5sb2NhdGlvbi5wcm90b2NvbH1yZXR1cm4gYn07XG53aW5kb3cuV2ViRm9udC5xKFwibW9ub3R5cGVcIixmdW5jdGlvbihhKXt2YXIgYj0obmV3IHoobmF2aWdhdG9yLnVzZXJBZ2VudCxkb2N1bWVudCkpLnBhcnNlKCk7cmV0dXJuIG5ldyBaKHdpbmRvdyxiLG5ldyBvKGRvY3VtZW50LGIpLGRvY3VtZW50LGEpfSk7ZnVuY3Rpb24gJChhLGIsYyl7dGhpcy5tPWE7dGhpcy5hPWI7dGhpcy5kPWM7dGhpcy5mPVtdO3RoaXMucz17fX0kLnByb3RvdHlwZS5DPWZ1bmN0aW9uKGEpe3ZhciBiPVwiaHR0cHM6XCI9PXdpbmRvdy5sb2NhdGlvbi5wcm90b2NvbD9cImh0dHBzOlwiOlwiaHR0cDpcIjtyZXR1cm4odGhpcy5kLmFwaXx8YitcIi8vdXNlLnR5cGVraXQuY29tXCIpK1wiL1wiK2ErXCIuanNcIn07JC5wcm90b3R5cGUuej1mdW5jdGlvbihhLGIpe3ZhciBjPXRoaXMuZC5pZCxkPXRoaXMuZCxlPXRoaXM7aWYoYyl7dGhpcy5tLl9fd2ViZm9udHR5cGVraXRtb2R1bGVfX3x8KHRoaXMubS5fX3dlYmZvbnR0eXBla2l0bW9kdWxlX189e30pO3RoaXMubS5fX3dlYmZvbnR0eXBla2l0bW9kdWxlX19bY109ZnVuY3Rpb24oZil7ZihhLGQsZnVuY3Rpb24oZyxoLGwpe2UuZj1oO2Uucz1sO2IoZyl9KX07cih0aGlzLmEsXCJoZWFkXCIsdSh0aGlzLmEsdGhpcy5DKGMpKSl9ZWxzZSBiKHRydWUpfTtcbiQucHJvdG90eXBlLmxvYWQ9ZnVuY3Rpb24oYSl7YSh0aGlzLmYsdGhpcy5zKX07d2luZG93LldlYkZvbnQucShcInR5cGVraXRcIixmdW5jdGlvbihhKXt2YXIgYj0obmV3IHoobmF2aWdhdG9yLnVzZXJBZ2VudCxkb2N1bWVudCkpLnBhcnNlKCk7cmV0dXJuIG5ldyAkKHdpbmRvdyxuZXcgbyhkb2N1bWVudCxiKSxhKX0pO3dpbmRvdy5XZWJGb250Q29uZmlnJiZ3aW5kb3cuV2ViRm9udC5sb2FkKHdpbmRvdy5XZWJGb250Q29uZmlnKTtcbn0pKHRoaXMsZG9jdW1lbnQpO1xuIiwiLy8gLSotIE1vZGU6IEphdmFTY3JpcHQ7IHRhYi13aWR0aDogMjsgaW5kZW50LXRhYnMtbW9kZTogbmlsOyAtKi1cbi8vIHZpbTpzZXQgZnQ9amF2YXNjcmlwdCB0cz0yIHN3PTIgc3RzPTIgY2luZGVudDpcbnZhciBBamF4ID0gKGZ1bmN0aW9uKCQsIHdpbmRvdywgdW5kZWZpbmVkKSB7XG4gICAgdmFyIEFqYXggPSBmdW5jdGlvbihkaXNwYXRjaGVyKSB7XG4gICAgICB2YXIgdGhhdCA9IHRoaXM7XG4gICAgICB2YXIgcGVuZGluZyA9IDA7XG4gICAgICB2YXIgY291bnQgPSAwO1xuICAgICAgdmFyIHBlbmRpbmdMaXN0ID0ge307XG5cbiAgICAgIC8vIG1lcmdlIGRhdGEgd2lsbCBnZXQgbWVyZ2VkIGludG8gdGhlIHJlc3BvbnNlIGRhdGFcbiAgICAgIC8vIGJlZm9yZSBjYWxsaW5nIHRoZSBjYWxsYmFja1xuICAgICAgdmFyIGFqYXhDYWxsID0gZnVuY3Rpb24oZGF0YSwgY2FsbGJhY2ssIG1lcmdlKSB7XG4gICAgICAgIG1lcmdlID0gbWVyZ2UgfHwge307XG4gICAgICAgIGRpc3BhdGNoZXIucG9zdCgnc3BpbicpO1xuICAgICAgICBwZW5kaW5nKys7XG4gICAgICAgIHZhciBpZCA9IGNvdW50Kys7XG5cbiAgICAgICAgLy8gc3BlY2lhbCB2YWx1ZTogYG1lcmdlLmtlZXAgPSB0cnVlYCBwcmV2ZW50cyBvYnNvbGVzY2VuY2VcbiAgICAgICAgcGVuZGluZ0xpc3RbaWRdID0gbWVyZ2Uua2VlcCB8fCBmYWxzZTtcbiAgICAgICAgZGVsZXRlIG1lcmdlLmtlZXA7XG5cbiAgICAgICAgLy8gSWYgbm8gcHJvdG9jb2wgdmVyc2lvbiBpcyBleHBsaWNpdGx5IHNldCwgc2V0IGl0IHRvIGN1cnJlbnRcbiAgICAgICAgaWYgKGRhdGFbJ3Byb3RvY29sJ10gPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgIC8vIFRPRE86IEV4dHJhY3QgdGhlIHByb3RvY29sIHZlcnNpb24gc29tZXdoZXJlIGdsb2JhbFxuICAgICAgICAgIGRhdGFbJ3Byb3RvY29sJ10gPSAxO1xuICAgICAgICB9XG5cbiAgICAgICAgLy92YXIgdXJsID0gXCJ0ZXN0LWpzb24vXCI7XG4gICAgICAgIHZhciB1cmwgPSBcInRlc3QtanNvbi1zaW1wbGUvXCI7XG4gICAgICAgIHZhciBtZXRob2QgPSBcIkdFVFwiO1xuICAgICAgICBzd2l0Y2goZGF0YS5hY3Rpb24pe1xuICAgICAgICAgIGNhc2UgXCJ3aG9hbWlcIjpcbiAgICAgICAgICAgIHVybCArPSBcInVzZXIuanNvblwiO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgY2FzZSBcImdldERvY3VtZW50XCI6XG4gICAgICAgICAgICB1cmwgKz0gXCJkb2N1bWVudC5qc29uXCI7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgICBjYXNlIFwibG9hZENvbmZcIjpcbiAgICAgICAgICAgIHVybCArPSBcImNvbmZpZy5qc29uXCI7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgICBjYXNlIFwiZ2V0Q29sbGVjdGlvbkluZm9ybWF0aW9uXCI6XG4gICAgICAgICAgICB1cmwgKz0gXCJjb2xsZWN0aW9uLmpzb25cIjtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgIGNhc2UgXCJsb2dpblwiOlxuICAgICAgICAgICAgdXJsICs9IFwibG9naW4uanNvblwiO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgY2FzZSBcImNyZWF0ZUFyY1wiOlxuICAgICAgICAgICAgdXJsICs9IFwiYWRkUmVsYXRpb24uanNvblwiO1xuICAgICAgICAgICAgLy9UT0RPIG1ldGhvZCA9IFwiUE9TVFwiO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgY2FzZSBcImFyY09wZW5EaWFsb2dcIjpcbiAgICAgICAgICAgIHVybCArPSBcImFkZFJlbGF0aW9uMi5qc29uXCI7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgICBjYXNlIFwiY3JlYXRlU3BhblwiOlxuICAgICAgICAgICAgdXJsICs9IFwiY3JlYXRlVG9rZW4uanNvblwiO1xuICAgICAgICAgICAgLy9UT0RPIG1ldGhvZCA9IFwiUE9TVFwiO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgIHVybCArPSBcImVtcHR5Lmpzb25cIjtcbiAgICAgICAgfVxuICAgICAgICAkLmFqYXgoe1xuICAgICAgICAgIC8vUmVtb3ZlZCBieSBSZW5hdWQgb24gMjAxNi0wMy0xMFxuICAgICAgICAgIC8qdXJsOiAnYWpheC5jZ2knLFxuICAgICAgICAgICBkYXRhOiBkYXRhLFxuICAgICAgICAgICB0eXBlOiAnUE9TVCcsKi9cbiAgICAgICAgICAvL1xuICAgICAgICAgIGRhdGE6IGRhdGEsXG4gICAgICAgICAgdXJsOiB1cmwsXG4gICAgICAgICAgdHlwZTogbWV0aG9kLFxuICAgICAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICBwZW5kaW5nLS07XG4gICAgICAgICAgICAvLyBJZiBubyBleGNlcHRpb24gaXMgc2V0LCB2ZXJpZnkgdGhlIHNlcnZlciByZXN1bHRzXG4gICAgICAgICAgICBpZiAocmVzcG9uc2UuZXhjZXB0aW9uID09IHVuZGVmaW5lZCAmJiByZXNwb25zZS5hY3Rpb24gIT09IGRhdGEuYWN0aW9uKSB7XG4gICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ0FjdGlvbiAnICsgZGF0YS5hY3Rpb24gK1xuICAgICAgICAgICAgICAgICcgcmV0dXJuZWQgdGhlIHJlc3VsdHMgb2YgYWN0aW9uICcgKyByZXNwb25zZS5hY3Rpb24pO1xuICAgICAgICAgICAgICByZXNwb25zZS5leGNlcHRpb24gPSB0cnVlO1xuICAgICAgICAgICAgICBkaXNwYXRjaGVyLnBvc3QoJ21lc3NhZ2VzJywgW1tbJ1Byb3RvY29sIGVycm9yOiBBY3Rpb24nICsgZGF0YS5hY3Rpb24gKyAnIHJldHVybmVkIHRoZSByZXN1bHRzIG9mIGFjdGlvbiAnICsgcmVzcG9uc2UuYWN0aW9uICsgJyBtYXliZSB0aGUgc2VydmVyIGlzIHVuYWJsZSB0byBydW4sIHBsZWFzZSBydW4gdG9vbHMvdHJvdWJsZXNob290aW5nLnNoIGZyb20geW91ciBpbnN0YWxsYXRpb24gdG8gZGlhZ25vc2UgaXQnLCAnZXJyb3InLCAtMV1dXSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIElmIHRoZSByZXF1ZXN0IGlzIG9ic29sZXRlLCBkbyBub3RoaW5nOyBpZiBub3QuLi5cbiAgICAgICAgICAgIGlmIChwZW5kaW5nTGlzdC5oYXNPd25Qcm9wZXJ0eShpZCkpIHtcbiAgICAgICAgICAgICAgZGlzcGF0Y2hlci5wb3N0KCdtZXNzYWdlcycsIFtyZXNwb25zZS5tZXNzYWdlc10pO1xuICAgICAgICAgICAgICBpZiAocmVzcG9uc2UuZXhjZXB0aW9uID09ICdjb25maWd1cmF0aW9uRXJyb3InXG4gICAgICAgICAgICAgICAgICB8fCByZXNwb25zZS5leGNlcHRpb24gPT0gJ3Byb3RvY29sVmVyc2lvbk1pc21hdGNoJykge1xuICAgICAgICAgICAgICAgIC8vIHRoaXMgaXMgYSBuby1yZXNjdWUgY3JpdGljYWwgZmFpbHVyZS5cbiAgICAgICAgICAgICAgICAvLyBTdG9wICpldmVyeXRoaW5nKi5cbiAgICAgICAgICAgICAgICBwZW5kaW5nTGlzdCA9IHt9O1xuICAgICAgICAgICAgICAgIGRpc3BhdGNoZXIucG9zdCgnc2NyZWFtaW5nSGFsdCcpO1xuICAgICAgICAgICAgICAgIC8vIElmIHdlIGhhZCBhIHByb3RvY29sIG1pc21hdGNoLCBwcm9tcHQgdGhlIHVzZXIgZm9yIGEgcmVsb2FkXG4gICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLmV4Y2VwdGlvbiA9PSAncHJvdG9jb2xWZXJzaW9uTWlzbWF0Y2gnKSB7XG4gICAgICAgICAgICAgICAgICBpZihjb25maXJtKCdUaGUgc2VydmVyIGlzIHJ1bm5pbmcgYSBkaWZmZXJlbnQgdmVyc2lvbiAnICtcbiAgICAgICAgICAgICAgICAgICAgICAnZnJvbSBicmF0IHRoYW4geW91ciBjbGllbnQsIHBvc3NpYmx5IGR1ZSB0byBhICcgK1xuICAgICAgICAgICAgICAgICAgICAgICdzZXJ2ZXIgdXBncmFkZS4gV291bGQgeW91IGxpa2UgdG8gcmVsb2FkIHRoZSAnICtcbiAgICAgICAgICAgICAgICAgICAgICAnY3VycmVudCBwYWdlIHRvIHVwZGF0ZSB5b3VyIGNsaWVudCB0byB0aGUgbGF0ZXN0ICcgK1xuICAgICAgICAgICAgICAgICAgICAgICd2ZXJzaW9uPycpKSB7XG4gICAgICAgICAgICAgICAgICAgIHdpbmRvdy5sb2NhdGlvbi5yZWxvYWQodHJ1ZSk7XG4gICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBkaXNwYXRjaGVyLnBvc3QoJ21lc3NhZ2VzJywgW1tbJ0ZhdGFsIEVycm9yOiBQcm90b2NvbCAnICtcbiAgICAgICAgICAgICAgICAgICAgICAgICd2ZXJzaW9uIG1pc21hdGNoLCBwbGVhc2UgY29udGFjdCB0aGUgYWRtaW5pc3RyYXRvcicsXG4gICAgICAgICAgICAgICAgICAgICAgICAnZXJyb3InLCAtMV1dXSk7XG4gICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgIGRlbGV0ZSBwZW5kaW5nTGlzdFtpZF07XG5cbiAgICAgICAgICAgICAgLy8gaWYgLmV4Y2VwdGlvbiBpcyBqdXN0IEJvb2xlYW4gdHJ1ZSwgZG8gbm90IHByb2Nlc3NcbiAgICAgICAgICAgICAgLy8gdGhlIGNhbGxiYWNrOyBpZiBpdCBpcyBhbnl0aGluZyBlbHNlLCB0aGVcbiAgICAgICAgICAgICAgLy8gY2FsbGJhY2sgaXMgcmVzcG9uc2libGUgZm9yIGhhbmRsaW5nIGl0XG4gICAgICAgICAgICAgIGlmIChyZXNwb25zZS5leGNlcHRpb24gPT0gdHJ1ZSkge1xuICAgICAgICAgICAgICAgICQoJyN3YWl0ZXInKS5kaWFsb2coJ2Nsb3NlJyk7XG4gICAgICAgICAgICAgIH0gZWxzZSBpZiAoY2FsbGJhY2spIHtcbiAgICAgICAgICAgICAgICAkLmV4dGVuZChyZXNwb25zZSwgbWVyZ2UpO1xuICAgICAgICAgICAgICAgIGRpc3BhdGNoZXIucG9zdCgwLCBjYWxsYmFjaywgW3Jlc3BvbnNlXSk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGRpc3BhdGNoZXIucG9zdCgndW5zcGluJyk7XG4gICAgICAgICAgfSxcbiAgICAgICAgICBlcnJvcjogZnVuY3Rpb24ocmVzcG9uc2UsIHRleHRTdGF0dXMsIGVycm9yVGhyb3duKSB7XG4gICAgICAgICAgICBwZW5kaW5nLS07XG4gICAgICAgICAgICBkaXNwYXRjaGVyLnBvc3QoJ3Vuc3BpbicpO1xuICAgICAgICAgICAgJCgnI3dhaXRlcicpLmRpYWxvZygnY2xvc2UnKTtcbiAgICAgICAgICAgIGRpc3BhdGNoZXIucG9zdCgnbWVzc2FnZXMnLCBbW1snRXJyb3I6IEFjdGlvbicgKyBkYXRhLmFjdGlvbiArICcgZmFpbGVkIG9uIGVycm9yICcgKyByZXNwb25zZS5zdGF0dXNUZXh0LCAnZXJyb3InXV1dKTtcbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IodGV4dFN0YXR1cyArICc6JywgZXJyb3JUaHJvd24sIHJlc3BvbnNlKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm4gaWQ7XG4gICAgICB9O1xuXG4gICAgICB2YXIgaXNSZWxvYWRPa2F5ID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIC8vIGRvIG5vdCByZWxvYWQgd2hpbGUgZGF0YSBpcyBwZW5kaW5nXG4gICAgICAgIHJldHVybiBwZW5kaW5nID09IDA7XG4gICAgICB9O1xuXG4gICAgICB2YXIgbWFrZU9ic29sZXRlID0gZnVuY3Rpb24oYWxsKSB7XG4gICAgICAgIGlmIChhbGwpIHtcbiAgICAgICAgICBwZW5kaW5nTGlzdCA9IHt9O1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICQuZWFjaChwZW5kaW5nTGlzdCwgZnVuY3Rpb24oaWQsIGtlZXApIHtcbiAgICAgICAgICAgIGlmICgha2VlcCkgZGVsZXRlIHBlbmRpbmdMaXN0W2lkXTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICBkaXNwYXRjaGVyLlxuICAgICAgICAgIG9uKCdpc1JlbG9hZE9rYXknLCBpc1JlbG9hZE9rYXkpLlxuICAgICAgICAgIG9uKCdtYWtlQWpheE9ic29sZXRlJywgbWFrZU9ic29sZXRlKS5cbiAgICAgICAgICBvbignYWpheCcsIGFqYXhDYWxsKTtcbiAgICB9O1xuXG4gICAgcmV0dXJuIEFqYXg7XG59KShqUXVlcnksIHdpbmRvdyk7XG5cbm1vZHVsZS5leHBvcnRzID0gQWpheDtcbiIsIi8vIC0qLSBNb2RlOiBKYXZhU2NyaXB0OyB0YWItd2lkdGg6IDI7IGluZGVudC10YWJzLW1vZGU6IG5pbDsgLSotXG4vLyB2aW06c2V0IGZ0PWphdmFzY3JpcHQgdHM9MiBzdz0yIHN0cz0yIGNpbmRlbnQ6XG52YXIgQW5ub3RhdG9yVUkgPSAoZnVuY3Rpb24oJCwgd2luZG93LCB1bmRlZmluZWQpIHtcbiAgICB2YXIgQW5ub3RhdG9yVUkgPSBmdW5jdGlvbihkaXNwYXRjaGVyLCBzdmcpIHtcbiAgICAgIHZhciB0aGF0ID0gdGhpcztcbiAgICAgIHZhciBhcmNEcmFnT3JpZ2luID0gbnVsbDtcbiAgICAgIHZhciBhcmNEcmFnT3JpZ2luQm94ID0gbnVsbDtcbiAgICAgIHZhciBhcmNEcmFnT3JpZ2luR3JvdXAgPSBudWxsO1xuICAgICAgdmFyIGFyY0RyYWdBcmMgPSBudWxsO1xuICAgICAgdmFyIGFyY0RyYWdKdXN0U3RhcnRlZCA9IGZhbHNlO1xuICAgICAgdmFyIHNvdXJjZURhdGEgPSBudWxsO1xuICAgICAgdmFyIGRhdGEgPSBudWxsO1xuICAgICAgdmFyIHNlYXJjaENvbmZpZyA9IG51bGw7XG4gICAgICB2YXIgc3Bhbk9wdGlvbnMgPSBudWxsO1xuICAgICAgdmFyIHJhcGlkU3Bhbk9wdGlvbnMgPSBudWxsO1xuICAgICAgdmFyIGFyY09wdGlvbnMgPSBudWxsO1xuICAgICAgdmFyIHNwYW5LZXltYXAgPSBudWxsO1xuICAgICAgdmFyIGtleW1hcCA9IG51bGw7XG4gICAgICB2YXIgY29sbCA9IG51bGw7XG4gICAgICB2YXIgZG9jID0gbnVsbDtcbiAgICAgIHZhciByZXNlbGVjdGVkU3BhbiA9IG51bGw7XG4gICAgICB2YXIgc2VsZWN0ZWRGcmFnbWVudCA9IG51bGw7XG4gICAgICB2YXIgZWRpdGVkU3BhbiA9IG51bGw7XG4gICAgICB2YXIgZWRpdGVkRnJhZ21lbnQgPSBudWxsO1xuICAgICAgdmFyIHJlcGVhdGluZ0FyY1R5cGVzID0gW107XG4gICAgICB2YXIgc3BhblR5cGVzID0gbnVsbDtcbiAgICAgIHZhciBlbnRpdHlBdHRyaWJ1dGVUeXBlcyA9IG51bGw7XG4gICAgICB2YXIgZXZlbnRBdHRyaWJ1dGVUeXBlcyA9IG51bGw7XG4gICAgICB2YXIgYWxsQXR0cmlidXRlVHlwZXMgPSBudWxsOyAvLyBUT0RPOiB0ZW1wIHdvcmthcm91bmQsIHJlbW92ZVxuICAgICAgdmFyIHJlbGF0aW9uVHlwZXNIYXNoID0gbnVsbDtcbiAgICAgIHZhciBzaG93VmFsaWRBdHRyaWJ1dGVzOyAvLyBjYWxsYmFjayBmdW5jdGlvblxuICAgICAgdmFyIHNob3dWYWxpZE5vcm1hbGl6YXRpb25zOyAvLyBjYWxsYmFjayBmdW5jdGlvblxuICAgICAgdmFyIGRyYWdTdGFydGVkQXQgPSBudWxsO1xuICAgICAgdmFyIHNlbFJlY3QgPSBudWxsO1xuICAgICAgdmFyIGxhc3RTdGFydFJlYyA9IG51bGw7XG4gICAgICB2YXIgbGFzdEVuZFJlYyA9IG51bGw7XG5cbiAgICAgIHZhciBkcmFnZ2VkQXJjSGVpZ2h0ID0gMzA7XG4gICAgICB2YXIgc3BhblR5cGVzVG9TaG93QmVmb3JlQ29sbGFwc2UgPSAzMDtcbiAgICAgIHZhciBtYXhOb3JtU2VhcmNoSGlzdG9yeSA9IDEwO1xuXG4gICAgICAvLyBUT0RPOiB0aGlzIGlzIGFuIHVnbHkgaGFjaywgcmVtb3ZlIChzZWUgY29tbWVudCB3aXRoIGFzc2lnbm1lbnQpXG4gICAgICB2YXIgbGFzdFJhcGlkQW5ub3RhdGlvbkV2ZW50ID0gbnVsbDtcbiAgICAgIC8vIFRPRE86IGFub3RoZXIgYXZvaWRhYmxlIGdsb2JhbDsgdHJ5IHRvIHdvcmsgd2l0aG91dFxuICAgICAgdmFyIHJhcGlkQW5ub3RhdGlvbkRpYWxvZ1Zpc2libGUgPSBmYWxzZTtcblxuICAgICAgLy8gYW1vdW50IGJ5IHdoaWNoIHRvIGxpZ2h0ZW4gKGFkanVzdCBcIkxcIiBpbiBIU0wgc3BhY2UpIHNwYW5cbiAgICAgIC8vIGNvbG9ycyBmb3IgdHlwZSBzZWxlY3Rpb24gYm94IEJHIGRpc3BsYXkuIDA9bm8gbGlnaHRlbmluZyxcbiAgICAgIC8vIDE9d2hpdGUgQkcgKG5vIGNvbG9yKVxuICAgICAgdmFyIHNwYW5Cb3hUZXh0QmdDb2xvckxpZ2h0ZW4gPSAwLjQ7XG5cbiAgICAgIC8vIGZvciBkb3VibGUtY2xpY2sgc2VsZWN0aW9uIHNpbXVsYXRpb24gaGFja1xuICAgICAgdmFyIGxhc3REb3VibGVDbGlja2VkQ2h1bmtJZCA9IG51bGw7XG5cbiAgICAgIC8vIGZvciBub3JtYWxpemF0aW9uOiBVUkxzIGJhc2VzIGJ5IG5vcm0gREIgbmFtZVxuICAgICAgdmFyIG5vcm1EYlVybEJ5RGJOYW1lID0ge307XG4gICAgICB2YXIgbm9ybURiVXJsQmFzZUJ5RGJOYW1lID0ge307XG4gICAgICAvLyBmb3Igbm9ybWFsaXphdGlvbjogYXBwcm9wcmlhdGUgREJzIHBlciB0eXBlXG4gICAgICB2YXIgbm9ybURic0J5VHlwZSA9IHt9O1xuICAgICAgLy8gZm9yIG5vcm1hbGl6YXRpb25cbiAgICAgIHZhciBvbGRTcGFuTm9ybUlkVmFsdWUgPSAnJztcbiAgICAgIHZhciBsYXN0Tm9ybVNlYXJjaGVzID0gW107XG5cbiAgICAgIHRoYXQudXNlciA9IG51bGw7XG4gICAgICB2YXIgc3ZnRWxlbWVudCA9ICQoc3ZnLl9zdmcpO1xuICAgICAgdmFyIHN2Z0lkID0gc3ZnRWxlbWVudC5wYXJlbnQoKS5hdHRyKCdpZCcpO1xuXG4gICAgICB2YXIgc3RyaXBOdW1lcmljU3VmZml4ID0gZnVuY3Rpb24ocykge1xuICAgICAgICAvLyB1dGlsaXR5IGZ1bmN0aW9uLCBvcmlnaW5hbGx5IGZvciBzdHJpcHBpbmcgbnVtZXJpeCBzdWZmaXhlc1xuICAgICAgICAvLyBmcm9tIGFyYyB0eXBlcyAoZS5nLiBcIlRoZW1lMlwiIC0+IFwiVGhlbWVcIikuIEZvciB2YWx1ZXNcbiAgICAgICAgLy8gd2l0aG91dCBzdWZmaXhlcyAoaW5jbHVkaW5nIG5vbi1zdHJpbmdzKSwgcmV0dXJucyBnaXZlbiB2YWx1ZS5cbiAgICAgICAgaWYgKHR5cGVvZihzKSAhPSBcInN0cmluZ1wiKSB7ICAgICAgICAgIFxuICAgICAgICAgIHJldHVybiBzOyAvLyBjYW4ndCBzdHJpcFxuICAgICAgICB9XG4gICAgICAgIHZhciBtID0gcy5tYXRjaCgvXiguKj8pKFxcZCopJC8pO1xuICAgICAgICByZXR1cm4gbVsxXTsgLy8gYWx3YXlzIG1hdGNoZXNcbiAgICAgIH1cblxuICAgICAgdmFyIGhpZGVGb3JtID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIGtleW1hcCA9IG51bGw7XG4gICAgICAgIHJhcGlkQW5ub3RhdGlvbkRpYWxvZ1Zpc2libGUgPSBmYWxzZTtcbiAgICAgIH07XG5cbiAgICAgIHZhciBjbGVhclNlbGVjdGlvbiA9IGZ1bmN0aW9uKCkge1xuICAgICAgICB3aW5kb3cuZ2V0U2VsZWN0aW9uKCkucmVtb3ZlQWxsUmFuZ2VzKCk7XG4gICAgICAgIGlmIChzZWxSZWN0ICE9IG51bGwpIHtcbiAgICAgICAgICBmb3IodmFyIHM9MDsgcyAhPSBzZWxSZWN0Lmxlbmd0aDsgcysrKSB7XG4gICAgICAgICAgICBzZWxSZWN0W3NdLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQoc2VsUmVjdFtzXSk7XG4gICAgICAgICAgfVxuICAgICAgICAgIHNlbFJlY3QgPSBudWxsO1xuICAgICAgICAgIGxhc3RTdGFydFJlYyA9IG51bGw7XG4gICAgICAgICAgbGFzdEVuZFJlYyA9IG51bGw7XG4gICAgICAgIH1cbiAgICAgIH07XG5cbiAgICAgIHZhciBtYWtlU2VsUmVjdCA9IGZ1bmN0aW9uKHJ4LCByeSwgcncsIHJoLCBjb2wpIHtcbiAgICAgICAgdmFyIHNlbFJlY3QgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50TlMoXCJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2Z1wiLCBcInJlY3RcIik7XG4gICAgICAgIHNlbFJlY3Quc2V0QXR0cmlidXRlTlMobnVsbCwgXCJ3aWR0aFwiLCBydyk7XG4gICAgICAgIHNlbFJlY3Quc2V0QXR0cmlidXRlTlMobnVsbCwgXCJoZWlnaHRcIiwgcmgpO1xuICAgICAgICBzZWxSZWN0LnNldEF0dHJpYnV0ZU5TKG51bGwsIFwieFwiLCByeCk7XG4gICAgICAgIHNlbFJlY3Quc2V0QXR0cmlidXRlTlMobnVsbCwgXCJ5XCIsIHJ5KTtcbiAgICAgICAgc2VsUmVjdC5zZXRBdHRyaWJ1dGVOUyhudWxsLCBcImZpbGxcIiwgY29sID09IHVuZGVmaW5lZCA/IFwibGlnaHRibHVlXCIgOiBjb2wpO1xuICAgICAgICByZXR1cm4gc2VsUmVjdDtcbiAgICAgIH07XG5cbiAgICAgIHZhciBvbktleURvd24gPSBmdW5jdGlvbihldnQpIHtcbiAgICAgICAgdmFyIGNvZGUgPSBldnQud2hpY2g7XG5cbiAgICAgICAgaWYgKGNvZGUgPT09ICQudWkua2V5Q29kZS5FU0NBUEUpIHtcbiAgICAgICAgICBzdG9wQXJjRHJhZygpO1xuICAgICAgICAgIGlmIChyZXNlbGVjdGVkU3Bhbikge1xuICAgICAgICAgICAgJChyZXNlbGVjdGVkU3Bhbi5yZWN0KS5yZW1vdmVDbGFzcygncmVzZWxlY3QnKTtcbiAgICAgICAgICAgIHJlc2VsZWN0ZWRTcGFuID0gbnVsbDtcbiAgICAgICAgICAgIHN2Z0VsZW1lbnQucmVtb3ZlQ2xhc3MoJ3Jlc2VsZWN0Jyk7XG4gICAgICAgICAgfVxuICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIGluIHJhcGlkIGFubm90YXRpb24gbW9kZSwgcHJpb3JpdGl6ZSB0aGUga2V5cyAwLi45IGZvciB0aGVcbiAgICAgICAgLy8gb3JkZXJlZCBjaG9pY2VzIGluIHRoZSBxdWljayBhbm5vdGF0aW9uIGRpYWxvZy5cbiAgICAgICAgaWYgKENvbmZpZ3VyYXRpb24ucmFwaWRNb2RlT24gJiYgcmFwaWRBbm5vdGF0aW9uRGlhbG9nVmlzaWJsZSAmJiBcbiAgICAgICAgICAgIFwiMFwiLmNoYXJDb2RlQXQoKSA8PSBjb2RlICYmIGNvZGUgPD0gXCI5XCIuY2hhckNvZGVBdCgpKSB7XG4gICAgICAgICAgdmFyIGlkeCA9IFN0cmluZy5mcm9tQ2hhckNvZGUoY29kZSk7XG4gICAgICAgICAgdmFyICRpbnB1dCA9ICQoJyNyYXBpZF9zcGFuXycraWR4KTtcbiAgICAgICAgICBpZiAoJGlucHV0Lmxlbmd0aCkge1xuICAgICAgICAgICAgJGlucHV0LmNsaWNrKCk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgaWYgKCFrZXltYXApIHJldHVybjtcblxuICAgICAgICAvLyBkaXNhYmxlIHNob3J0Y3V0cyB3aGVuIHdvcmtpbmcgd2l0aCBlbGVtZW50cyB0aGF0IHlvdSBjb3VsZFxuICAgICAgICAvLyBjb25jZWl2YWJseSB0eXBlIGluXG4gICAgICAgIHZhciB0YXJnZXQgPSBldnQudGFyZ2V0O1xuICAgICAgICB2YXIgbm9kZU5hbWUgPSB0YXJnZXQubm9kZU5hbWUudG9Mb3dlckNhc2UoKTtcbiAgICAgICAgdmFyIG5vZGVUeXBlID0gdGFyZ2V0LnR5cGUgJiYgdGFyZ2V0LnR5cGUudG9Mb3dlckNhc2UoKTtcbiAgICAgICAgaWYgKG5vZGVOYW1lID09ICdpbnB1dCcgJiYgKG5vZGVUeXBlID09ICd0ZXh0JyB8fCBub2RlVHlwZSA9PSAncGFzc3dvcmQnKSkgcmV0dXJuO1xuICAgICAgICBpZiAobm9kZU5hbWUgPT0gJ3RleHRhcmVhJyB8fCBub2RlTmFtZSA9PSAnc2VsZWN0JykgcmV0dXJuO1xuXG4gICAgICAgIHZhciBwcmVmaXggPSAnJztcbiAgICAgICAgaWYgKGV2dC5hbHRLZXkpIHtcbiAgICAgICAgICBwcmVmaXggPSBcIkEtXCI7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGV2dC5jdHJsS2V5KSB7XG4gICAgICAgICAgcHJlZml4ID0gXCJDLVwiO1xuICAgICAgICB9XG4gICAgICAgIGlmIChldnQuc2hpZnRLZXkpIHtcbiAgICAgICAgICBwcmVmaXggPSBcIlMtXCI7XG4gICAgICAgIH1cbiAgICAgICAgdmFyIGJpbmRpbmcgPSBrZXltYXBbcHJlZml4ICsgY29kZV07XG4gICAgICAgIGlmICghYmluZGluZykgYmluZGluZyA9IGtleW1hcFtwcmVmaXggKyBTdHJpbmcuZnJvbUNoYXJDb2RlKGNvZGUpXTtcbiAgICAgICAgaWYgKGJpbmRpbmcpIHtcbiAgICAgICAgICB2YXIgYm91bmRJbnB1dCA9ICQoJyMnICsgYmluZGluZylbMF07XG4gICAgICAgICAgaWYgKGJvdW5kSW5wdXQgJiYgIWJvdW5kSW5wdXQuZGlzYWJsZWQpIHtcbiAgICAgICAgICAgIGJvdW5kSW5wdXQuY2xpY2soKTtcbiAgICAgICAgICAgIGV2dC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfTtcblxuICAgICAgdmFyIG9uRGJsQ2xpY2sgPSBmdW5jdGlvbihldnQpIHtcbiAgICAgICAgLy8gbXVzdCBiZSBsb2dnZWQgaW5cbiAgICAgICAgLy9SZW1vdmVkIGJ5IFJlbmF1ZCBvbiAyMDE2LTAzLTEwXG4gICAgICAgIC8vaWYgKHRoYXQudXNlciA9PT0gbnVsbCkgcmV0dXJuO1xuICAgICAgICAvLyBtdXN0IG5vdCBiZSByZXNlbGVjdGluZyBhIHNwYW4gb3IgYW4gYXJjXG4gICAgICAgIGlmIChyZXNlbGVjdGVkU3BhbiB8fCBhcmNEcmFnT3JpZ2luKSByZXR1cm47XG5cbiAgICAgICAgdmFyIHRhcmdldCA9ICQoZXZ0LnRhcmdldCk7XG4gICAgICAgIHZhciBpZDtcblxuICAgICAgICAvLyBkbyB3ZSBlZGl0IGFuIGFyYz9cbiAgICAgICAgaWYgKGlkID0gdGFyZ2V0LmF0dHIoJ2RhdGEtYXJjLXJvbGUnKSkge1xuICAgICAgICAgIC8vIFRPRE9cbiAgICAgICAgICBjbGVhclNlbGVjdGlvbigpO1xuICAgICAgICAgIHZhciBvcmlnaW5TcGFuSWQgPSB0YXJnZXQuYXR0cignZGF0YS1hcmMtb3JpZ2luJyk7XG4gICAgICAgICAgdmFyIHRhcmdldFNwYW5JZCA9IHRhcmdldC5hdHRyKCdkYXRhLWFyYy10YXJnZXQnKTtcbiAgICAgICAgICB2YXIgdHlwZSA9IHRhcmdldC5hdHRyKCdkYXRhLWFyYy1yb2xlJyk7XG4gICAgICAgICAgdmFyIG9yaWdpblNwYW4gPSBkYXRhLnNwYW5zW29yaWdpblNwYW5JZF07XG4gICAgICAgICAgdmFyIHRhcmdldFNwYW4gPSBkYXRhLnNwYW5zW3RhcmdldFNwYW5JZF07XG4gICAgICAgICAgYXJjT3B0aW9ucyA9IHtcbiAgICAgICAgICAgIGFjdGlvbjogJ2NyZWF0ZUFyYycsXG4gICAgICAgICAgICBvcmlnaW46IG9yaWdpblNwYW5JZCxcbiAgICAgICAgICAgIHRhcmdldDogdGFyZ2V0U3BhbklkLFxuICAgICAgICAgICAgb2xkX3RhcmdldDogdGFyZ2V0U3BhbklkLFxuICAgICAgICAgICAgdHlwZTogdHlwZSxcbiAgICAgICAgICAgIG9sZF90eXBlOiB0eXBlLFxuICAgICAgICAgICAgY29sbGVjdGlvbjogY29sbCxcbiAgICAgICAgICAgICdkb2N1bWVudCc6IGRvY1xuICAgICAgICAgIH07XG4gICAgICAgICAgdmFyIGV2ZW50RGVzY0lkID0gdGFyZ2V0LmF0dHIoJ2RhdGEtYXJjLWVkJyk7XG4gICAgICAgICAgaWYgKGV2ZW50RGVzY0lkKSB7XG4gICAgICAgICAgICB2YXIgZXZlbnREZXNjID0gZGF0YS5ldmVudERlc2NzW2V2ZW50RGVzY0lkXTtcbiAgICAgICAgICAgIGlmIChldmVudERlc2MuZXF1aXYpIHtcbiAgICAgICAgICAgICAgYXJjT3B0aW9uc1snbGVmdCddID0gZXZlbnREZXNjLmxlZnRTcGFucy5qb2luKCcsJyk7XG4gICAgICAgICAgICAgIGFyY09wdGlvbnNbJ3JpZ2h0J10gPSBldmVudERlc2MucmlnaHRTcGFucy5qb2luKCcsJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICAgICQoJyNhcmNfb3JpZ2luJykudGV4dChVdGlsLnNwYW5EaXNwbGF5Rm9ybShzcGFuVHlwZXMsIG9yaWdpblNwYW4udHlwZSkgKyAnIChcIicgKyBvcmlnaW5TcGFuLnRleHQgKyAnXCIpJyk7XG4gICAgICAgICAgJCgnI2FyY190YXJnZXQnKS50ZXh0KFV0aWwuc3BhbkRpc3BsYXlGb3JtKHNwYW5UeXBlcywgdGFyZ2V0U3Bhbi50eXBlKSArICcgKFwiJyArIHRhcmdldFNwYW4udGV4dCArICdcIiknKTtcbiAgICAgICAgICB2YXIgYXJjSWQgPSBldmVudERlc2NJZCB8fCBbb3JpZ2luU3BhbklkLCB0eXBlLCB0YXJnZXRTcGFuSWRdO1xuICAgICAgICAgIGZpbGxBcmNUeXBlc0FuZERpc3BsYXlGb3JtKGV2dCwgb3JpZ2luU3Bhbi50eXBlLCB0YXJnZXRTcGFuLnR5cGUsIHR5cGUsIGFyY0lkKTtcbiAgICAgICAgICAvLyBmb3IgcHJlY2lzZSB0aW1pbmcsIGxvZyBkaWFsb2cgZGlzcGxheSB0byB1c2VyLlxuICAgICAgICAgIGRpc3BhdGNoZXIucG9zdCgnbG9nQWN0aW9uJywgWydhcmNFZGl0U2VsZWN0ZWQnXSk7XG5cbiAgICAgICAgLy8gaWYgbm90IGFuIGFyYywgdGhlbiBkbyB3ZSBlZGl0IGEgc3Bhbj9cbiAgICAgICAgfSBlbHNlIGlmIChpZCA9IHRhcmdldC5hdHRyKCdkYXRhLXNwYW4taWQnKSkge1xuICAgICAgICAgIGNsZWFyU2VsZWN0aW9uKCk7XG4gICAgICAgICAgZWRpdGVkU3BhbiA9IGRhdGEuc3BhbnNbaWRdO1xuICAgICAgICAgIGVkaXRlZEZyYWdtZW50ID0gdGFyZ2V0LmF0dHIoJ2RhdGEtZnJhZ21lbnQtaWQnKTtcbiAgICAgICAgICB2YXIgb2Zmc2V0cyA9IFtdO1xuICAgICAgICAgICQuZWFjaChlZGl0ZWRTcGFuLmZyYWdtZW50cywgZnVuY3Rpb24oZnJhZ21lbnRObywgZnJhZ21lbnQpIHtcbiAgICAgICAgICAgIG9mZnNldHMucHVzaChbZnJhZ21lbnQuZnJvbSwgZnJhZ21lbnQudG9dKTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgICBzcGFuT3B0aW9ucyA9IHtcbiAgICAgICAgICAgIGFjdGlvbjogJ2NyZWF0ZVNwYW4nLFxuICAgICAgICAgICAgb2Zmc2V0czogb2Zmc2V0cyxcbiAgICAgICAgICAgIHR5cGU6IGVkaXRlZFNwYW4udHlwZSxcbiAgICAgICAgICAgIGlkOiBpZCxcbiAgICAgICAgICB9O1xuICAgICAgICAgIGZpbGxTcGFuVHlwZXNBbmREaXNwbGF5Rm9ybShldnQsIGVkaXRlZFNwYW4udGV4dCwgZWRpdGVkU3Bhbik7XG4gICAgICAgICAgLy8gZm9yIHByZWNpc2UgdGltaW5nLCBsb2cgYW5ub3RhdGlvbiBkaXNwbGF5IHRvIHVzZXIuXG4gICAgICAgICAgZGlzcGF0Y2hlci5wb3N0KCdsb2dBY3Rpb24nLCBbJ3NwYW5FZGl0U2VsZWN0ZWQnXSk7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBpZiBub3QgYW4gYXJjIG9yIGEgc3BhbiwgaXMgdGhpcyBhIGRvdWJsZS1jbGljayBvbiB0ZXh0P1xuICAgICAgICBlbHNlIGlmIChpZCA9IHRhcmdldC5hdHRyKCdkYXRhLWNodW5rLWlkJykpIHtcbiAgICAgICAgICAvLyByZW1lbWJlciB3aGF0IHdhcyBjbGlja2VkICh0aGlzIGlzIGluIHByZXBhcmF0aW9uIGZvclxuICAgICAgICAgIC8vIHNpbXVsYXRpbmcgZG91YmxlLWNsaWNrIHNlbGVjdGlvbiBvbiBicm93c2VycyB0aGF0IGRvXG4gICAgICAgICAgLy8gbm90IHN1cHBvcnQgaXQuXG4gICAgICAgICAgbGFzdERvdWJsZUNsaWNrZWRDaHVua0lkID0gaWQ7XG4gICAgICAgIH1cbiAgICAgIH07XG5cbiAgICAgIHZhciBzdGFydEFyY0RyYWcgPSBmdW5jdGlvbihvcmlnaW5JZCkge1xuICAgICAgICBjbGVhclNlbGVjdGlvbigpO1xuICAgICAgICBzdmdFbGVtZW50LmFkZENsYXNzKCd1bnNlbGVjdGFibGUnKTtcbiAgICAgICAgc3ZnUG9zaXRpb24gPSBzdmdFbGVtZW50Lm9mZnNldCgpO1xuICAgICAgICBhcmNEcmFnT3JpZ2luID0gb3JpZ2luSWQ7XG4gICAgICAgIGFyY0RyYWdBcmMgPSBzdmcucGF0aChzdmcuY3JlYXRlUGF0aCgpLCB7XG4gICAgICAgICAgbWFya2VyRW5kOiAndXJsKCNkcmFnX2Fycm93KScsXG4gICAgICAgICAgJ2NsYXNzJzogJ2RyYWdfc3Ryb2tlJyxcbiAgICAgICAgICBmaWxsOiAnbm9uZScsXG4gICAgICAgIH0pO1xuICAgICAgICBhcmNEcmFnT3JpZ2luR3JvdXAgPSAkKGRhdGEuc3BhbnNbYXJjRHJhZ09yaWdpbl0uZ3JvdXApO1xuICAgICAgICBhcmNEcmFnT3JpZ2luR3JvdXAuYWRkQ2xhc3MoJ2hpZ2hsaWdodCcpO1xuICAgICAgICBhcmNEcmFnT3JpZ2luQm94ID0gVXRpbC5yZWFsQkJveChkYXRhLnNwYW5zW2FyY0RyYWdPcmlnaW5dLmhlYWRGcmFnbWVudCk7XG4gICAgICAgIGFyY0RyYWdPcmlnaW5Cb3guY2VudGVyID0gYXJjRHJhZ09yaWdpbkJveC54ICsgYXJjRHJhZ09yaWdpbkJveC53aWR0aCAvIDI7XG5cbiAgICAgICAgYXJjRHJhZ0p1c3RTdGFydGVkID0gdHJ1ZTtcbiAgICAgIH07XG5cbiAgICAgIHZhciBnZXRWYWxpZEFyY1R5cGVzRm9yRHJhZyA9IGZ1bmN0aW9uKHRhcmdldElkLCB0YXJnZXRUeXBlKSB7XG4gICAgICAgIHZhciBhcmNUeXBlID0gc3RyaXBOdW1lcmljU3VmZml4KGFyY09wdGlvbnMgJiYgYXJjT3B0aW9ucy50eXBlKTtcbiAgICAgICAgaWYgKCFhcmNEcmFnT3JpZ2luIHx8IHRhcmdldElkID09IGFyY0RyYWdPcmlnaW4pIHJldHVybiBudWxsO1xuXG4gICAgICAgIHZhciBvcmlnaW5UeXBlID0gZGF0YS5zcGFuc1thcmNEcmFnT3JpZ2luXS50eXBlO1xuICAgICAgICB2YXIgc3BhblR5cGUgPSBzcGFuVHlwZXNbb3JpZ2luVHlwZV07XG4gICAgICAgIHZhciByZXN1bHQgPSBbXTtcbiAgICAgICAgaWYgKHNwYW5UeXBlICYmIHNwYW5UeXBlLmFyY3MpIHtcbiAgICAgICAgICAkLmVhY2goc3BhblR5cGUuYXJjcywgZnVuY3Rpb24oYXJjTm8sIGFyYykge1xuICAgICAgICAgICAgaWYgKGFyY1R5cGUgJiYgYXJjVHlwZSAhPSBhcmMudHlwZSkgcmV0dXJuO1xuXG4gICAgICAgICAgICBpZiAoJC5pbkFycmF5KHRhcmdldFR5cGUsIGFyYy50YXJnZXRzKSAhPSAtMSkge1xuICAgICAgICAgICAgICByZXN1bHQucHVzaChhcmMudHlwZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICAgIH07XG5cbiAgICAgIHZhciBvbk1vdXNlRG93biA9IGZ1bmN0aW9uKGV2dCkge1xuICAgICAgICBkcmFnU3RhcnRlZEF0ID0gZXZ0OyAvLyBYWFggZG8gd2UgcmVhbGx5IG5lZWQgdGhlIHdob2xlIGV2dD9cbiAgICAgICAgLy9SZW1vdmVkIGJ5IFJlbmF1ZCBvbiAyMDE2LTAzLTEwXG4gICAgICAgIC8vaWYgKCF0aGF0LnVzZXIgfHwgYXJjRHJhZ09yaWdpbikgcmV0dXJuO1xuICAgICAgICBpZiAoYXJjRHJhZ09yaWdpbikgcmV0dXJuO1xuICAgICAgICB2YXIgdGFyZ2V0ID0gJChldnQudGFyZ2V0KTtcbiAgICAgICAgdmFyIGlkO1xuICAgICAgICAvLyBpcyBpdCBhcmMgZHJhZyBzdGFydD9cbiAgICAgICAgaWYgKGlkID0gdGFyZ2V0LmF0dHIoJ2RhdGEtc3Bhbi1pZCcpKSB7XG4gICAgICAgICAgYXJjT3B0aW9ucyA9IG51bGw7XG4gICAgICAgICAgc3RhcnRBcmNEcmFnKGlkKTtcbiAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgIH07XG5cbiAgICAgIHZhciBvbk1vdXNlTW92ZSA9IGZ1bmN0aW9uKGV2dCkge1xuICAgICAgICBpZiAoYXJjRHJhZ09yaWdpbikge1xuICAgICAgICAgIGlmIChhcmNEcmFnSnVzdFN0YXJ0ZWQpIHtcbiAgICAgICAgICAgIC8vIHNob3cgdGhlIHBvc3NpYmxlIHRhcmdldHNcbiAgICAgICAgICAgIHZhciBzcGFuID0gZGF0YS5zcGFuc1thcmNEcmFnT3JpZ2luXSB8fCB7fTtcbiAgICAgICAgICAgIHZhciBzcGFuRGVzYyA9IHNwYW5UeXBlc1tzcGFuLnR5cGVdIHx8IHt9O1xuXG4gICAgICAgICAgICAvLyBzZXBhcmF0ZSBvdXQgcG9zc2libGUgbnVtZXJpYyBzdWZmaXggZnJvbSB0eXBlIGZvciBoaWdoaWdodFxuICAgICAgICAgICAgLy8gKGluc3RlYWQgb2YgZS5nLiBcIlRoZW1lM1wiLCBuZWVkIHRvIGxvb2sgZm9yIFwiVGhlbWVcIilcbiAgICAgICAgICAgIHZhciBub051bUFyY1R5cGUgPSBzdHJpcE51bWVyaWNTdWZmaXgoYXJjT3B0aW9ucyAmJiBhcmNPcHRpb25zLnR5cGUpO1xuICAgICAgICAgICAgLy8gdmFyIHRhcmdldENsYXNzZXMgPSBbXTtcbiAgICAgICAgICAgIHZhciAkdGFyZ2V0cyA9ICQoKTtcbiAgICAgICAgICAgICQuZWFjaChzcGFuRGVzYy5hcmNzIHx8IFtdLCBmdW5jdGlvbihwb3NzaWJsZUFyY05vLCBwb3NzaWJsZUFyYykge1xuICAgICAgICAgICAgICBpZiAoKGFyY09wdGlvbnMgJiYgcG9zc2libGVBcmMudHlwZSA9PSBub051bUFyY1R5cGUpIHx8ICEoYXJjT3B0aW9ucyAmJiBhcmNPcHRpb25zLm9sZF90YXJnZXQpKSB7XG4gICAgICAgICAgICAgICAgJC5lYWNoKHBvc3NpYmxlQXJjLnRhcmdldHMgfHwgW10sIGZ1bmN0aW9uKHBvc3NpYmxlVGFyZ2V0Tm8sIHBvc3NpYmxlVGFyZ2V0KSB7XG4gICAgICAgICAgICAgICAgICAvLyBzcGVlZHVwIGZvciAjNjQyOiByZWxldmFudCBicm93c2VycyBzaG91bGQgc3VwcG9ydFxuICAgICAgICAgICAgICAgICAgLy8gdGhpcyBmdW5jdGlvbjogaHR0cDovL3d3dy5xdWlya3Ntb2RlLm9yZy9kb20vdzNjX2NvcmUuaHRtbCN0MTFcbiAgICAgICAgICAgICAgICAgIC8vIHNvIHdlIGdldCBvZmYgalF1ZXJ5IGFuZCBnZXQgZG93biB0byB0aGUgbWV0YWw6XG4gICAgICAgICAgICAgICAgICAvLyB0YXJnZXRDbGFzc2VzLnB1c2goJy5zcGFuXycgKyBwb3NzaWJsZVRhcmdldCk7XG4gICAgICAgICAgICAgICAgICAkdGFyZ2V0cyA9ICR0YXJnZXRzLmFkZChzdmdFbGVtZW50WzBdLmdldEVsZW1lbnRzQnlDbGFzc05hbWUoJ3NwYW5fJyArIHBvc3NpYmxlVGFyZ2V0KSk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgLy8kKHRhcmdldENsYXNzZXMuam9pbignLCcpKS5ub3QoJ1tkYXRhLXNwYW4taWQ9XCInICsgYXJjRHJhZ09yaWdpbiArICdcIl0nKS5hZGRDbGFzcygncmVzZWxlY3RUYXJnZXQnKTtcbiAgICAgICAgICAgIC8vVE9ETyBuZXh0IG9uZSBzaG91bGQgYmUgd29ya2luZyBidXQgZG9lc24ndC4gUmVuYXVkIG9uIDIwMTYtMDMtMTBcbiAgICAgICAgICAgICR0YXJnZXRzLm5vdCgnW2RhdGEtc3Bhbi1pZD1cIicgKyBhcmNEcmFnT3JpZ2luICsgJ1wiXScpLmFkZENsYXNzKCdyZXNlbGVjdFRhcmdldCcpO1xuICAgICAgICAgIH1cbiAgICAgICAgICBjbGVhclNlbGVjdGlvbigpO1xuICAgICAgICAgIHZhciBteCA9IGV2dC5wYWdlWCAtIHN2Z1Bvc2l0aW9uLmxlZnQ7XG4gICAgICAgICAgdmFyIG15ID0gZXZ0LnBhZ2VZIC0gc3ZnUG9zaXRpb24udG9wICsgNTsgLy8gVE9ETyBGSVhNRSB3aHkgKzU/IT9cbiAgICAgICAgICB2YXIgeSA9IE1hdGgubWluKGFyY0RyYWdPcmlnaW5Cb3gueSwgbXkpIC0gZHJhZ2dlZEFyY0hlaWdodDtcbiAgICAgICAgICB2YXIgZHggPSAoYXJjRHJhZ09yaWdpbkJveC5jZW50ZXIgLSBteCkgLyA0O1xuICAgICAgICAgIHZhciBwYXRoID0gc3ZnLmNyZWF0ZVBhdGgoKS5cbiAgICAgICAgICAgIG1vdmUoYXJjRHJhZ09yaWdpbkJveC5jZW50ZXIsIGFyY0RyYWdPcmlnaW5Cb3gueSkuXG4gICAgICAgICAgICBjdXJ2ZUMoYXJjRHJhZ09yaWdpbkJveC5jZW50ZXIgLSBkeCwgeSxcbiAgICAgICAgICAgICAgICBteCArIGR4LCB5LFxuICAgICAgICAgICAgICAgIG14LCBteSk7XG4gICAgICAgICAgYXJjRHJhZ0FyYy5zZXRBdHRyaWJ1dGUoJ2QnLCBwYXRoLnBhdGgoKSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgLy8gQS4gU2NlcnJpIEZpcmVGb3ggY2h1bmtcblxuICAgICAgICAgIC8vIGlmIG5vdCwgdGhlbiBpcyBpdCBzcGFuIHNlbGVjdGlvbj8gKGN0cmwga2V5IGNhbmNlbHMpXG4gICAgICAgICAgdmFyIHNlbCA9IHdpbmRvdy5nZXRTZWxlY3Rpb24oKTtcbiAgICAgICAgICB2YXIgY2h1bmtJbmRleEZyb20gPSBzZWwuYW5jaG9yTm9kZSAmJiAkKHNlbC5hbmNob3JOb2RlLnBhcmVudE5vZGUpLmF0dHIoJ2RhdGEtY2h1bmstaWQnKTtcbiAgICAgICAgICB2YXIgY2h1bmtJbmRleFRvID0gc2VsLmZvY3VzTm9kZSAmJiAkKHNlbC5mb2N1c05vZGUucGFyZW50Tm9kZSkuYXR0cignZGF0YS1jaHVuay1pZCcpO1xuICAgICAgICAgIC8vIGZhbGxiYWNrIGZvciBmaXJlZm94IChhdCBsZWFzdCk6XG4gICAgICAgICAgLy8gaXQncyB1bmNsZWFyIHdoeSwgYnV0IGZvciBmaXJlZm94IHRoZSBhbmNob3IgYW5kIGZvY3VzXG4gICAgICAgICAgLy8gbm9kZSBwYXJlbnRzIGFyZSBhbHdheXMgdW5kZWZpbmVkLCB0aGUgdGhlIGFuY2hvciBhbmRcbiAgICAgICAgICAvLyBmb2N1cyBub2RlcyB0aGVtc2VsdmVzIGRvIChvZnRlbikgaGF2ZSB0aGUgbmVjZXNzYXJ5XG4gICAgICAgICAgLy8gY2h1bmsgSUQuIEhvd2V2ZXIsIGFuY2hvciBvZmZzZXRzIGFyZSBhbG1vc3QgYWx3YXlzXG4gICAgICAgICAgLy8gd3JvbmcsIHNvIHdlJ2xsIGp1c3QgbWFrZSBhIGd1ZXNzIGF0IHdoYXQgdGhlIHVzZXIgbWlnaHRcbiAgICAgICAgICAvLyBiZSBpbnRlcmVzdGVkIGluIHRhZ2dpbmcgaW5zdGVhZCBvZiB1c2luZyB3aGF0J3MgZ2l2ZW4uXG4gICAgICAgICAgdmFyIGFuY2hvck9mZnNldCA9IG51bGw7XG4gICAgICAgICAgdmFyIGZvY3VzT2Zmc2V0ID0gbnVsbDtcbiAgICAgICAgICBpZiAoY2h1bmtJbmRleEZyb20gPT09IHVuZGVmaW5lZCAmJiBjaHVua0luZGV4VG8gPT09IHVuZGVmaW5lZCAmJlxuICAgICAgICAgICAgICAkKHNlbC5hbmNob3JOb2RlKS5hdHRyKCdkYXRhLWNodW5rLWlkJykgJiZcbiAgICAgICAgICAgICAgJChzZWwuZm9jdXNOb2RlKS5hdHRyKCdkYXRhLWNodW5rLWlkJykpIHtcbiAgICAgICAgICAgIC8vIExldHMgdGFrZSB0aGUgYWN0dWFsIHNlbGVjdGlvbiByYW5nZSBhbmQgd29yayB3aXRoIHRoYXRcbiAgICAgICAgICAgIC8vIE5vdGUgZm9yIHZpc3VhbCBsaW5lIHVwIGFuZCBtb3JlIGFjY3VyYXRlIHBvc2l0aW9ucyBhIHZlcnRpY2FsIG9mZnNldCBvZiA4IGFuZCBob3Jpem9udGFsIG9mIDIgaGFzIGJlZW4gdXNlZCFcbiAgICAgICAgICAgIHZhciByYW5nZSA9IHNlbC5nZXRSYW5nZUF0KDApO1xuICAgICAgICAgICAgdmFyIHN2Z09mZnNldCA9ICQoc3ZnLl9zdmcpLm9mZnNldCgpO1xuICAgICAgICAgICAgdmFyIGZsaXAgPSBmYWxzZTtcbiAgICAgICAgICAgIHZhciB0cmllcyA9IDA7XG4gICAgICAgICAgICAvLyBGaXJzdCB0cnkgYW5kIG1hdGNoIHRoZSBzdGFydCBvZmZzZXQgd2l0aCBhIHBvc2l0aW9uLCBpZiBub3QgdHJ5IGl0IGFnYWluc3QgdGhlIG90aGVyIGVuZFxuICAgICAgICAgICAgd2hpbGUgKHRyaWVzIDwgMikge1xuICAgICAgICAgICAgICB2YXIgc3AgPSBzdmcuX3N2Zy5jcmVhdGVTVkdQb2ludCgpO1xuICAgICAgICAgICAgICBzcC54ID0gKGZsaXAgPyBldnQucGFnZVggOiBkcmFnU3RhcnRlZEF0LnBhZ2VYKSAtIHN2Z09mZnNldC5sZWZ0O1xuICAgICAgICAgICAgICBzcC55ID0gKGZsaXAgPyBldnQucGFnZVkgOiBkcmFnU3RhcnRlZEF0LnBhZ2VZKSAtIChzdmdPZmZzZXQudG9wICsgOCk7XG4gICAgICAgICAgICAgIHZhciBzdGFydHNBdCA9IHJhbmdlLnN0YXJ0Q29udGFpbmVyO1xuICAgICAgICAgICAgICBhbmNob3JPZmZzZXQgPSBzdGFydHNBdC5nZXRDaGFyTnVtQXRQb3NpdGlvbihzcCk7XG4gICAgICAgICAgICAgIGNodW5rSW5kZXhGcm9tID0gc3RhcnRzQXQgJiYgJChzdGFydHNBdCkuYXR0cignZGF0YS1jaHVuay1pZCcpO1xuICAgICAgICAgICAgICBpZiAoYW5jaG9yT2Zmc2V0ICE9IC0xKSB7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgZmxpcCA9IHRydWU7XG4gICAgICAgICAgICAgIHRyaWVzKys7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIE5vdyBncmFiIHRoZSBlbmQgb2Zmc2V0XG4gICAgICAgICAgICBzcC54ID0gKGZsaXAgPyBkcmFnU3RhcnRlZEF0LnBhZ2VYIDogZXZ0LnBhZ2VYKSAtIHN2Z09mZnNldC5sZWZ0O1xuICAgICAgICAgICAgc3AueSA9IChmbGlwID8gZHJhZ1N0YXJ0ZWRBdC5wYWdlWSA6IGV2dC5wYWdlWSkgLSAoc3ZnT2Zmc2V0LnRvcCArIDgpO1xuICAgICAgICAgICAgdmFyIGVuZHNBdCA9IHJhbmdlLmVuZENvbnRhaW5lcjtcbiAgICAgICAgICAgIGZvY3VzT2Zmc2V0ID0gZW5kc0F0LmdldENoYXJOdW1BdFBvc2l0aW9uKHNwKTtcblxuICAgICAgICAgICAgLy8gSWYgd2UgY2Fubm90IGdldCBhIHN0YXJ0IGFuZCBlbmQgb2Zmc2V0IHN0b3AgaGVyZVxuICAgICAgICAgICAgaWYgKGFuY2hvck9mZnNldCA9PSAtMSB8fCBmb2N1c09mZnNldCA9PSAtMSkge1xuICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvLyBJZiB3ZSBhcmUgaW4gdGhlIHNhbWUgY29udGFpbmVyIGl0IGRvZXMgdGhlIHNlbGVjdGlvbiBiYWNrIHRvIGZyb250IHdoZW4gZHJhZ2dlZCByaWdodCB0byBsZWZ0LCBhY3Jvc3MgZGlmZmVyZW50IGNvbnRhaW5lcnMgdGhlIHN0YXJ0IGlzIHRoZSBzdGFydCBhbmQgdGhlIGVuZCBpZiB0aGUgZW5kIVxuICAgICAgICAgICAgaWYocmFuZ2Uuc3RhcnRDb250YWluZXIgPT0gcmFuZ2UuZW5kQ29udGFpbmVyICYmIGFuY2hvck9mZnNldCA+IGZvY3VzT2Zmc2V0KSB7XG4gICAgICAgICAgICAgIHZhciB0ID0gYW5jaG9yT2Zmc2V0O1xuICAgICAgICAgICAgICBhbmNob3JPZmZzZXQgPSBmb2N1c09mZnNldDtcbiAgICAgICAgICAgICAgZm9jdXNPZmZzZXQgPSB0O1xuICAgICAgICAgICAgICBmbGlwID0gZmFsc2U7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjaHVua0luZGV4VG8gPSBlbmRzQXQgJiYgJChlbmRzQXQpLmF0dHIoJ2RhdGEtY2h1bmstaWQnKTtcblxuICAgICAgICAgICAgLy8gTm93IHRha2UgdGhlIHN0YXJ0IGFuZCBlbmQgY2hhcmFjdGVyIHJlY3RhbmdsZXNcbiAgICAgICAgICAgIHN0YXJ0UmVjID0gc3RhcnRzQXQuZ2V0RXh0ZW50T2ZDaGFyKGFuY2hvck9mZnNldCk7XG4gICAgICAgICAgICBzdGFydFJlYy55ICs9IDI7XG4gICAgICAgICAgICBlbmRSZWMgPSBlbmRzQXQuZ2V0RXh0ZW50T2ZDaGFyKGZvY3VzT2Zmc2V0KTtcbiAgICAgICAgICAgIGVuZFJlYy55ICs9IDI7XG5cbiAgICAgICAgICAgIC8vIElmIG5vdGhpbmcgaGFzIGNoYW5nZWQgdGhlbiBzdG9wIGhlcmVcbiAgICAgICAgICAgIGlmIChsYXN0U3RhcnRSZWMgIT0gbnVsbCAmJiBsYXN0U3RhcnRSZWMueCA9PSBzdGFydFJlYy54ICYmIGxhc3RTdGFydFJlYy55ID09IHN0YXJ0UmVjLnkgJiYgbGFzdEVuZFJlYyAhPSBudWxsICYmIGxhc3RFbmRSZWMueCA9PSBlbmRSZWMueCAmJiBsYXN0RW5kUmVjLnkgPT0gZW5kUmVjLnkpIHtcbiAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoc2VsUmVjdCA9PSBudWxsKSB7XG4gICAgICAgICAgICAgIHZhciByeCA9IHN0YXJ0UmVjLng7XG4gICAgICAgICAgICAgIHZhciByeSA9IHN0YXJ0UmVjLnk7XG4gICAgICAgICAgICAgIHZhciBydyA9IChlbmRSZWMueCArIGVuZFJlYy53aWR0aCkgLSBzdGFydFJlYy54O1xuICAgICAgICAgICAgICBpZiAocncgPCAwKSB7XG4gICAgICAgICAgICAgICAgcnggKz0gcnc7XG4gICAgICAgICAgICAgICAgcncgPSAtcnc7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgdmFyIHJoID0gTWF0aC5tYXgoc3RhcnRSZWMuaGVpZ2h0LCBlbmRSZWMuaGVpZ2h0KTtcblxuICAgICAgICAgICAgICBzZWxSZWN0ID0gbmV3IEFycmF5KCk7XG4gICAgICAgICAgICAgIHZhciBhY3RpdmVTZWxSZWN0ID0gbWFrZVNlbFJlY3QocngsIHJ5LCBydywgcmgpO1xuICAgICAgICAgICAgICBzZWxSZWN0LnB1c2goYWN0aXZlU2VsUmVjdCk7XG4gICAgICAgICAgICAgIHN0YXJ0c0F0LnBhcmVudE5vZGUucGFyZW50Tm9kZS5wYXJlbnROb2RlLmluc2VydEJlZm9yZShhY3RpdmVTZWxSZWN0LCBzdGFydHNBdC5wYXJlbnROb2RlLnBhcmVudE5vZGUpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgaWYgKHN0YXJ0UmVjLnggIT0gbGFzdFN0YXJ0UmVjLnggJiYgZW5kUmVjLnggIT0gbGFzdEVuZFJlYy54ICYmIChzdGFydFJlYy55ICE9IGxhc3RTdGFydFJlYy55IHx8IGVuZFJlYy55ICE9IGxhc3RFbmRSZWMueSkpIHtcbiAgICAgICAgICAgICAgICBpZiAoc3RhcnRSZWMueSA8IGxhc3RTdGFydFJlYy55KSB7XG4gICAgICAgICAgICAgICAgICBzZWxSZWN0WzBdLnNldEF0dHJpYnV0ZU5TKG51bGwsIFwid2lkdGhcIiwgbGFzdFN0YXJ0UmVjLndpZHRoKTtcbiAgICAgICAgICAgICAgICAgIGxhc3RFbmRSZWMgPSBsYXN0U3RhcnRSZWM7XG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmIChlbmRSZWMueSA+IGxhc3RFbmRSZWMueSkge1xuICAgICAgICAgICAgICAgICAgc2VsUmVjdFtzZWxSZWN0Lmxlbmd0aCAtIDFdLnNldEF0dHJpYnV0ZU5TKG51bGwsIFwieFwiLFxuICAgICAgICAgICAgICAgICAgICAgIHBhcnNlRmxvYXQoc2VsUmVjdFtzZWxSZWN0Lmxlbmd0aCAtIDFdLmdldEF0dHJpYnV0ZU5TKG51bGwsIFwieFwiKSlcbiAgICAgICAgICAgICAgICAgICAgICArIHBhcnNlRmxvYXQoc2VsUmVjdFtzZWxSZWN0Lmxlbmd0aCAtIDFdLmdldEF0dHJpYnV0ZU5TKG51bGwsIFwid2lkdGhcIikpXG4gICAgICAgICAgICAgICAgICAgICAgLSBsYXN0RW5kUmVjLndpZHRoKTtcbiAgICAgICAgICAgICAgICAgIHNlbFJlY3Rbc2VsUmVjdC5sZW5ndGggLSAxXS5zZXRBdHRyaWJ1dGVOUyhudWxsLCBcIndpZHRoXCIsIDApO1xuICAgICAgICAgICAgICAgICAgbGFzdFN0YXJ0UmVjPWxhc3RFbmRSZWM7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgLy8gU3RhcnQgaGFzIG1vdmVkXG4gICAgICAgICAgICAgIHZhciBmbGlwID0gIShzdGFydFJlYy54ID09IGxhc3RTdGFydFJlYy54ICYmIHN0YXJ0UmVjLnkgPT0gbGFzdFN0YXJ0UmVjLnkpO1xuICAgICAgICAgICAgICAvLyBJZiB0aGUgaGVpZ2h0IG9mIHRoZSBzdGFydCBvciBlbmQgY2hhbmdlZCB3ZSBuZWVkIHRvIGNoZWNrIHdoZXRoZXJcbiAgICAgICAgICAgICAgLy8gdG8gcmVtb3ZlIG11bHRpIGxpbmUgaGlnaGxpZ2h0cyBubyBsb25nZXIgbmVlZGVkIGlmIHRoZSB1c2VyIHdlbnQgYmFjayB0b3dhcmRzIHRoZWlyIHN0YXJ0IGxpbmVcbiAgICAgICAgICAgICAgLy8gYW5kIHdoZXRoZXIgdG8gY3JlYXRlIG5ldyBvbmVzIGlmIHdlIG1vdmVkIHRvIGEgbmV3bGluZVxuICAgICAgICAgICAgICBpZiAoKChlbmRSZWMueSAhPSBsYXN0RW5kUmVjLnkpKSB8fCAoKHN0YXJ0UmVjLnkgIT0gbGFzdFN0YXJ0UmVjLnkpKSkge1xuICAgICAgICAgICAgICAgIC8vIEZpcnN0IGNoZWNrIGlmIHdlIGhhdmUgdG8gcmVtb3ZlIHRoZSBmaXJzdCBoaWdobGlnaHRzIGJlY2F1c2Ugd2UgYXJlIG1vdmluZyB0b3dhcmRzIHRoZSBlbmQgb24gYSBkaWZmZXJlbnQgbGluZVxuICAgICAgICAgICAgICAgIHZhciBzcyA9IDA7XG4gICAgICAgICAgICAgICAgZm9yICg7IHNzICE9IHNlbFJlY3QubGVuZ3RoOyBzcysrKSB7XG4gICAgICAgICAgICAgICAgICBpZiAoc3RhcnRSZWMueSA8PSBwYXJzZUZsb2F0KHNlbFJlY3Rbc3NdLmdldEF0dHJpYnV0ZU5TKG51bGwsIFwieVwiKSkpIHtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIC8vIE5leHQgY2hlY2sgZm9yIGFueSBlbmQgaGlnaGxpZ2h0cyBpZiB3ZSBhcmUgbW92aW5nIHRvd2FyZHMgdGhlIHN0YXJ0IG9uIGEgZGlmZmVyZW50IGxpbmVcbiAgICAgICAgICAgICAgICB2YXIgZXMgPSBzZWxSZWN0Lmxlbmd0aCAtIDE7XG4gICAgICAgICAgICAgICAgZm9yICg7IGVzICE9IC0xOyBlcy0tKSB7XG4gICAgICAgICAgICAgICAgICBpZiAoZW5kUmVjLnkgPj0gcGFyc2VGbG9hdChzZWxSZWN0W2VzXS5nZXRBdHRyaWJ1dGVOUyhudWxsLCBcInlcIikpKSB7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAvLyBUT0RPIHB1dCB0aGlzIGluIGxvb3BzIGFib3ZlLCBmb3IgZWZmaWNpZW5jeSB0aGUgYXJyYXkgc2xpY2luZyBjb3VsZCBiZSBkb25lIHNlcGFyYXRlIHN0aWxsIGluIHNpbmdsZSBjYWxsXG4gICAgICAgICAgICAgICAgdmFyIHRydW5jID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgaWYgKHNzIDwgc2VsUmVjdC5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICAgIGZvciAodmFyIHMyID0gMDsgczIgIT0gc3M7IHMyKyspIHtcbiAgICAgICAgICAgICAgICAgICAgc2VsUmVjdFtzMl0ucGFyZW50Tm9kZS5yZW1vdmVDaGlsZChzZWxSZWN0W3MyXSk7XG4gICAgICAgICAgICAgICAgICAgIGVzLS07XG4gICAgICAgICAgICAgICAgICAgIHRydW5jID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgIHNlbFJlY3QgPSBzZWxSZWN0LnNsaWNlKHNzKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKGVzID4gLTEpIHtcbiAgICAgICAgICAgICAgICAgIGZvciAodmFyIHMyID0gc2VsUmVjdC5sZW5ndGggLSAxOyBzMiAhPSBlczsgczItLSkge1xuICAgICAgICAgICAgICAgICAgICBzZWxSZWN0W3MyXS5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKHNlbFJlY3RbczJdKTtcbiAgICAgICAgICAgICAgICAgICAgdHJ1bmMgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgc2VsUmVjdCA9IHNlbFJlY3Quc2xpY2UoMCwgZXMgKyAxKTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAvLyBJZiB3ZSBoYXZlIHRydW5jYXRlZCB0aGUgaGlnaGxpZ2h0cyB3ZSBuZWVkIHRvIHJlYWRqdXN0IHRoZSBsYXN0IG9uZVxuICAgICAgICAgICAgICAgIGlmICh0cnVuYykge1xuICAgICAgICAgICAgICAgICAgdmFyIGFjdGl2ZVNlbFJlY3QgPSBmbGlwID8gc2VsUmVjdFswXSA6IHNlbFJlY3Rbc2VsUmVjdC5sZW5ndGggLSAxXTtcbiAgICAgICAgICAgICAgICAgIGlmIChmbGlwKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBydyA9IDA7XG4gICAgICAgICAgICAgICAgICAgIGlmIChzdGFydFJlYy55ID09IGVuZFJlYy55KSB7XG4gICAgICAgICAgICAgICAgICAgICAgcncgPSAoZW5kUmVjLnggKyBlbmRSZWMud2lkdGgpIC0gc3RhcnRSZWMueDtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICBydyA9IChwYXJzZUZsb2F0KGFjdGl2ZVNlbFJlY3QuZ2V0QXR0cmlidXRlTlMobnVsbCwgXCJ4XCIpKVxuICAgICAgICAgICAgICAgICAgICAgICAgICArIHBhcnNlRmxvYXQoYWN0aXZlU2VsUmVjdC5nZXRBdHRyaWJ1dGVOUyhudWxsLCBcIndpZHRoXCIpKSlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgLSBzdGFydFJlYy54O1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGFjdGl2ZVNlbFJlY3Quc2V0QXR0cmlidXRlTlMobnVsbCwgXCJ4XCIsIHN0YXJ0UmVjLngpO1xuICAgICAgICAgICAgICAgICAgICBhY3RpdmVTZWxSZWN0LnNldEF0dHJpYnV0ZU5TKG51bGwsIFwieVwiLCBzdGFydFJlYy55KTtcbiAgICAgICAgICAgICAgICAgICAgYWN0aXZlU2VsUmVjdC5zZXRBdHRyaWJ1dGVOUyhudWxsLCBcIndpZHRoXCIsIHJ3KTtcbiAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBydyA9IChlbmRSZWMueCArIGVuZFJlYy53aWR0aCkgLSBwYXJzZUZsb2F0KGFjdGl2ZVNlbFJlY3QuZ2V0QXR0cmlidXRlTlMobnVsbCwgXCJ4XCIpKTtcbiAgICAgICAgICAgICAgICAgICAgYWN0aXZlU2VsUmVjdC5zZXRBdHRyaWJ1dGVOUyhudWxsLCBcIndpZHRoXCIsIHJ3KTtcbiAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgLy8gV2UgZGlkbnQgdHJ1bmNhdGUgYW55dGhpbmcgYnV0IHdlIGhhdmUgbW92ZWQgdG8gYSBuZXcgbGluZSBzbyB3ZSBuZWVkIHRvIGNyZWF0ZSBhIG5ldyBoaWdobGlnaHRcbiAgICAgICAgICAgICAgICAgIHZhciBsYXN0U2VsID0gZmxpcCA/IHNlbFJlY3RbMF0gOiBzZWxSZWN0W3NlbFJlY3QubGVuZ3RoIC0gMV07XG4gICAgICAgICAgICAgICAgICB2YXIgc3RhcnRCb3ggPSBzdGFydHNBdC5wYXJlbnROb2RlLmdldEJCb3goKTtcbiAgICAgICAgICAgICAgICAgIHZhciBlbmRCb3ggPSBlbmRzQXQucGFyZW50Tm9kZS5nZXRCQm94KCk7XG5cbiAgICAgICAgICAgICAgICAgIGlmIChmbGlwKSB7XG4gICAgICAgICAgICAgICAgICAgIGxhc3RTZWwuc2V0QXR0cmlidXRlTlMobnVsbCwgXCJ3aWR0aFwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgKHBhcnNlRmxvYXQobGFzdFNlbC5nZXRBdHRyaWJ1dGVOUyhudWxsLCBcInhcIikpXG4gICAgICAgICAgICAgICAgICAgICAgICArIHBhcnNlRmxvYXQobGFzdFNlbC5nZXRBdHRyaWJ1dGVOUyhudWxsLCBcIndpZHRoXCIpKSlcbiAgICAgICAgICAgICAgICAgICAgICAgIC0gZW5kQm94LngpO1xuICAgICAgICAgICAgICAgICAgICBsYXN0U2VsLnNldEF0dHJpYnV0ZU5TKG51bGwsIFwieFwiLCBlbmRCb3gueCk7XG4gICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBsYXN0U2VsLnNldEF0dHJpYnV0ZU5TKG51bGwsIFwid2lkdGhcIixcbiAgICAgICAgICAgICAgICAgICAgICAgIChzdGFydEJveC54ICsgc3RhcnRCb3gud2lkdGgpXG4gICAgICAgICAgICAgICAgICAgICAgICAtIHBhcnNlRmxvYXQobGFzdFNlbC5nZXRBdHRyaWJ1dGVOUyhudWxsLCBcInhcIikpKTtcbiAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgIHZhciByeCA9IDA7XG4gICAgICAgICAgICAgICAgICB2YXIgcnkgPSAwO1xuICAgICAgICAgICAgICAgICAgdmFyIHJ3ID0gMDtcbiAgICAgICAgICAgICAgICAgIHZhciByaCA9IDA7XG4gICAgICAgICAgICAgICAgICBpZiAoZmxpcCkge1xuICAgICAgICAgICAgICAgICAgICByeCA9IHN0YXJ0UmVjLng7XG4gICAgICAgICAgICAgICAgICAgIHJ5ID0gc3RhcnRSZWMueTtcbiAgICAgICAgICAgICAgICAgICAgcncgPSAkKHN2Zy5fc3ZnKS53aWR0aCgpIC0gc3RhcnRSZWMueDtcbiAgICAgICAgICAgICAgICAgICAgcmggPSBzdGFydFJlYy5oZWlnaHQ7XG4gICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICByeCA9IGVuZEJveC54O1xuICAgICAgICAgICAgICAgICAgICByeSA9IGVuZFJlYy55O1xuICAgICAgICAgICAgICAgICAgICBydyA9IChlbmRSZWMueCArIGVuZFJlYy53aWR0aCkgLSBlbmRCb3gueDtcbiAgICAgICAgICAgICAgICAgICAgcmggPSBlbmRSZWMuaGVpZ2h0O1xuICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgdmFyIG5ld1JlY3QgPSBtYWtlU2VsUmVjdChyeCwgcnksIHJ3LCByaCk7XG4gICAgICAgICAgICAgICAgICBpZiAoZmxpcCkge1xuICAgICAgICAgICAgICAgICAgICBzZWxSZWN0LnVuc2hpZnQobmV3UmVjdCk7XG4gICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBzZWxSZWN0LnB1c2gobmV3UmVjdCk7XG4gICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgIC8vIFBsYWNlIG5ldyBoaWdobGlnaHQgaW4gYXBwcm9wcmlhdGUgc2xvdCBpbiBTVkcgZ3JhcGhcbiAgICAgICAgICAgICAgICAgIHN0YXJ0c0F0LnBhcmVudE5vZGUucGFyZW50Tm9kZS5wYXJlbnROb2RlLmluc2VydEJlZm9yZShuZXdSZWN0LCBzdGFydHNBdC5wYXJlbnROb2RlLnBhcmVudE5vZGUpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAvLyBUaGUgdXNlciBzaW1wbHkgbW92ZWQgbGVmdCBvciByaWdodCBhbG9uZyB0aGUgc2FtZSBsaW5lIHNvIGp1c3QgYWRqdXN0IHRoZSBjdXJyZW50IGhpZ2hsaWdodFxuICAgICAgICAgICAgICAgIHZhciBhY3RpdmVTZWxSZWN0ID0gZmxpcCA/IHNlbFJlY3RbMF0gOiBzZWxSZWN0W3NlbFJlY3QubGVuZ3RoIC0gMV07XG4gICAgICAgICAgICAgICAgLy8gSWYgdGhlIHN0YXJ0IG1vdmVkIHNoaWZ0IHRoZSBoaWdobGlnaHQgYW5kIGFkanVzdCB3aWR0aFxuICAgICAgICAgICAgICAgIGlmIChmbGlwKSB7XG4gICAgICAgICAgICAgICAgICB2YXIgcncgPSAocGFyc2VGbG9hdChhY3RpdmVTZWxSZWN0LmdldEF0dHJpYnV0ZU5TKG51bGwsIFwieFwiKSlcbiAgICAgICAgICAgICAgICAgICAgICArIHBhcnNlRmxvYXQoYWN0aXZlU2VsUmVjdC5nZXRBdHRyaWJ1dGVOUyhudWxsLCBcIndpZHRoXCIpKSlcbiAgICAgICAgICAgICAgICAgICAgICAtIHN0YXJ0UmVjLng7XG4gICAgICAgICAgICAgICAgICBhY3RpdmVTZWxSZWN0LnNldEF0dHJpYnV0ZU5TKG51bGwsIFwieFwiLCBzdGFydFJlYy54KTtcbiAgICAgICAgICAgICAgICAgIGFjdGl2ZVNlbFJlY3Quc2V0QXR0cmlidXRlTlMobnVsbCwgXCJ5XCIsIHN0YXJ0UmVjLnkpO1xuICAgICAgICAgICAgICAgICAgYWN0aXZlU2VsUmVjdC5zZXRBdHRyaWJ1dGVOUyhudWxsLCBcIndpZHRoXCIsIHJ3KTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgLy8gSWYgdGhlIGVuZCBtb3ZlZCB0aGVuIHNpbXBsZSBjaGFuZ2UgdGhlIHdpZHRoXG4gICAgICAgICAgICAgICAgICB2YXIgcncgPSAoZW5kUmVjLnggKyBlbmRSZWMud2lkdGgpXG4gICAgICAgICAgICAgICAgICAgICAgLSBwYXJzZUZsb2F0KGFjdGl2ZVNlbFJlY3QuZ2V0QXR0cmlidXRlTlMobnVsbCwgXCJ4XCIpKTtcbiAgICAgICAgICAgICAgICAgIGFjdGl2ZVNlbFJlY3Quc2V0QXR0cmlidXRlTlMobnVsbCwgXCJ3aWR0aFwiLCBydyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBsYXN0U3RhcnRSZWMgPSBzdGFydFJlYztcbiAgICAgICAgICAgIGxhc3RFbmRSZWMgPSBlbmRSZWM7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGFyY0RyYWdKdXN0U3RhcnRlZCA9IGZhbHNlO1xuICAgICAgfTtcblxuICAgICAgdmFyIGFkanVzdFRvQ3Vyc29yID0gZnVuY3Rpb24oZXZ0LCBlbGVtZW50LCBjZW50ZXJYLCBjZW50ZXJZKSB7XG4gICAgICAgIHZhciBzY3JlZW5IZWlnaHQgPSAkKHdpbmRvdykuaGVpZ2h0KCkgLSA4OyAvLyBUT0RPIEhBQ0sgLSBubyBpZGVhIHdoeSAtOCBpcyBuZWVkZWRcbiAgICAgICAgdmFyIHNjcmVlbldpZHRoID0gJCh3aW5kb3cpLndpZHRoKCkgLSA4O1xuICAgICAgICB2YXIgZWxlbWVudEhlaWdodCA9IGVsZW1lbnQuaGVpZ2h0KCk7XG4gICAgICAgIHZhciBlbGVtZW50V2lkdGggPSBlbGVtZW50LndpZHRoKCk7XG4gICAgICAgIHZhciBjc3NTZXR0aW5ncyA9IHt9O1xuICAgICAgICB2YXIgZUxlZnQ7XG4gICAgICAgIHZhciBlVG9wO1xuICAgICAgICBpZiAoY2VudGVyWCkge1xuICAgICAgICAgICAgZUxlZnQgPSBldnQuY2xpZW50WCAtIGVsZW1lbnRXaWR0aC8yO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgZUxlZnQgPSBldnQuY2xpZW50WDtcbiAgICAgICAgfVxuICAgICAgICBpZiAoY2VudGVyWSkge1xuICAgICAgICAgICAgZVRvcCA9IGV2dC5jbGllbnRZIC0gZWxlbWVudEhlaWdodC8yO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgZVRvcCA9IGV2dC5jbGllbnRZO1xuICAgICAgICB9XG4gICAgICAgIC8vIFRyeSB0byBtYWtlIHN1cmUgdGhlIGVsZW1lbnQgZG9lc24ndCBnbyBvZmYtc2NyZWVuLlxuICAgICAgICAvLyBJZiB0aGlzIGlzbid0IHBvc3NpYmxlICh0aGUgZWxlbWVudCBpcyBsYXJnZXIgdGhhbiB0aGUgc2NyZWVuKSxcbiAgICAgICAgLy8gYWxpZ2h0IHRvcC1sZWZ0IGNvcm5lciBvZiBzY3JlZW4gYW5kIGRpYWxvZyBhcyBhIGNvbXByb21pc2UuXG4gICAgICAgIGlmIChzY3JlZW5XaWR0aCA+IGVsZW1lbnRXaWR0aCkge1xuICAgICAgICAgICAgZUxlZnQgPSBNYXRoLm1pbihNYXRoLm1heChlTGVmdCwwKSwgc2NyZWVuV2lkdGggLSBlbGVtZW50V2lkdGgpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgZUxlZnQgPSAwO1xuICAgICAgICB9IFxuICAgICAgICBpZiAoc2NyZWVuSGVpZ2h0ID4gZWxlbWVudEhlaWdodCkge1xuICAgICAgICAgICAgZVRvcCAgPSBNYXRoLm1pbihNYXRoLm1heChlVG9wLDApLCBzY3JlZW5IZWlnaHQgLSBlbGVtZW50SGVpZ2h0KTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGVUb3AgID0gMDtcbiAgICAgICAgfVxuICAgICAgICBlbGVtZW50LmNzcyh7IHRvcDogZVRvcCwgbGVmdDogZUxlZnQgfSk7XG4gICAgICB9O1xuXG4gICAgICB2YXIgdXBkYXRlQ2hlY2tib3ggPSBmdW5jdGlvbigkaW5wdXQpIHtcbiAgICAgICAgdmFyICR3aWRnZXQgPSAkaW5wdXQuYnV0dG9uKCd3aWRnZXQnKTtcbiAgICAgICAgdmFyICR0ZXh0c3BhbiA9ICR3aWRnZXQuZmluZCgnLnVpLWJ1dHRvbi10ZXh0Jyk7XG4gICAgICAgICR0ZXh0c3Bhbi5odG1sKCgkaW5wdXRbMF0uY2hlY2tlZCA/ICcmI3gyNjExOyAnIDogJyYjeDI2MTA7ICcpICsgJHdpZGdldC5hdHRyKCdkYXRhLWJhcmUnKSk7XG4gICAgICB9O1xuXG4gICAgICB2YXIgZmlsbFNwYW5UeXBlc0FuZERpc3BsYXlGb3JtID0gZnVuY3Rpb24oZXZ0LCBzcGFuVGV4dCwgc3Bhbikge1xuICAgICAgICBrZXltYXAgPSBzcGFuS2V5bWFwO1xuXG4gICAgICAgIC8vIEZpZ3VyZSBvdXQgd2hldGhlciB3ZSBzaG91bGQgc2hvdyBvciBoaWRlIG9uZSBvZiB0aGUgdHdvXG4gICAgICAgIC8vIG1haW4gaGFsdmVzIG9mIHRoZSBzZWxlY3Rpb24gZnJhbWUgKGVudGl0aWVzIC8gZXZlbnRzKS5cbiAgICAgICAgLy8gVGhpcyBkZXBlbmRzIG9uIHRoZSB0eXBlIG9mIHRoZSBjdXJyZW50IHNwYW4sIGlmIGFueSwgYW5kXG4gICAgICAgIC8vIHRoZSBhdmFpbGFiaWxpdHkgb2YgdHlwZXMgdG8gc2VsZWN0LlxuICAgICAgICB2YXIgaGlkZUZyYW1lO1xuICAgICAgICBpZiAoc3Bhbikge1xuICAgICAgICAgIC8vIGV4aXN0aW5nIHNwYW47IG9ubHkgc2hvdyByZWxldmFudCBoYWxmXG4gICAgICAgICAgaWYgKHNwYW4uZ2VuZXJhbFR5cGUgPT0gJ2VudGl0eScpIHtcbiAgICAgICAgICAgIGhpZGVGcmFtZSA9ICdldmVudCc7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGhpZGVGcmFtZSA9ICdlbnRpdHknO1xuICAgICAgICAgIH1cbiAgICAgICAgICBzcGFuRm9ybS5kaWFsb2coJ29wdGlvbicsIHsgdGl0bGU6ICdFZGl0IEFubm90YXRpb24nIH0pO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIC8vIG5ldyBzcGFuOyBzaG93IGV2ZXJ5dGhpbmcgdGhhdCdzIGF2YWlsYWJsZVxuICAgICAgICAgIGlmICgkKCcjZXZlbnRfdHlwZXMnKS5maW5kKCdpbnB1dCcpLmxlbmd0aCA9PSAwKSB7XG4gICAgICAgICAgICBoaWRlRnJhbWUgPSAnZXZlbnQnO1xuICAgICAgICAgIH0gZWxzZSBpZiAoJCgnI2VudGl0eV90eXBlcycpLmZpbmQoJ2lucHV0JykubGVuZ3RoID09IDApIHtcbiAgICAgICAgICAgIGhpZGVGcmFtZSA9ICdlbnRpdHknO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBoaWRlRnJhbWUgPSAnbm9uZSc7XG4gICAgICAgICAgfVxuICAgICAgICAgIHNwYW5Gb3JtLmRpYWxvZygnb3B0aW9uJywgeyB0aXRsZTogJ05ldyBBbm5vdGF0aW9uJyB9KTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoaGlkZUZyYW1lID09ICdldmVudCcpIHtcbiAgICAgICAgICAkKCcjc3Bhbl9ldmVudF9zZWN0aW9uJykuaGlkZSgpXG4gICAgICAgICAgJCgnI3NwYW5fZW50aXR5X3NlY3Rpb24nKS5zaG93KCkuXG4gICAgICAgICAgICByZW1vdmVDbGFzcygnd3JhcHBlcl9oYWxmX2xlZnQnKS5cbiAgICAgICAgICAgIGFkZENsYXNzKCd3cmFwcGVyX2Z1bGxfd2lkdGgnKTtcbiAgICAgICAgfSBlbHNlIGlmIChoaWRlRnJhbWUgPT0gJ2VudGl0eScpIHtcbiAgICAgICAgICAkKCcjc3Bhbl9lbnRpdHlfc2VjdGlvbicpLmhpZGUoKVxuICAgICAgICAgICQoJyNzcGFuX2V2ZW50X3NlY3Rpb24nKS5zaG93KCkuXG4gICAgICAgICAgICByZW1vdmVDbGFzcygnd3JhcHBlcl9oYWxmX3JpZ2h0JykuXG4gICAgICAgICAgICBhZGRDbGFzcygnd3JhcHBlcl9mdWxsX3dpZHRoJyk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgLy8gc2hvdyBib3RoIGVudGl0eSBhbmQgZXZlbnQgaGFsdmVzXG4gICAgICAgICAgJCgnI3NwYW5fZW50aXR5X3NlY3Rpb24nKS5zaG93KCkuXG4gICAgICAgICAgICByZW1vdmVDbGFzcygnd3JhcHBlcl9mdWxsX3dpZHRoJykuXG4gICAgICAgICAgICBhZGRDbGFzcygnd3JhcHBlcl9oYWxmX2xlZnQnKTtcbiAgICAgICAgICAkKCcjc3Bhbl9ldmVudF9zZWN0aW9uJykuc2hvdygpLlxuICAgICAgICAgICAgcmVtb3ZlQ2xhc3MoJ3dyYXBwZXJfZnVsbF93aWR0aCcpLlxuICAgICAgICAgICAgYWRkQ2xhc3MoJ3dyYXBwZXJfaGFsZl9yaWdodCcpO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gb25seSBzaG93IFwiZGVsZXRlXCIgYnV0dG9uIGlmIHRoZXJlJ3MgYW4gZXhpc3RpbmcgYW5ub3RhdGlvbiB0byBkZWxldGVcbiAgICAgICAgaWYgKHNwYW4pIHtcbiAgICAgICAgICAkKCcjZGVsX3NwYW5fYnV0dG9uJykuc2hvdygpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICQoJyNkZWxfc3Bhbl9idXR0b24nKS5oaWRlKCk7XG4gICAgICAgIH1cblxuICAgICAgICAkKCcjc3Bhbl9zZWxlY3RlZCcpLnRleHQoc3BhblRleHQpO1xuICAgICAgICB2YXIgZW5jb2RlZFRleHQgPSBlbmNvZGVVUklDb21wb25lbnQoc3BhblRleHQpOyAgICAgICBcbiAgICAgICAgJC5lYWNoKHNlYXJjaENvbmZpZywgZnVuY3Rpb24oc2VhcmNoTm8sIHNlYXJjaCkge1xuICAgICAgICAgICQoJyNzcGFuXycrc2VhcmNoWzBdKS5hdHRyKCdocmVmJywgc2VhcmNoWzFdLnJlcGxhY2UoJyVzJywgZW5jb2RlZFRleHQpKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgLy8gZW5hYmxlIGFsbCBpbnB1dHMgYnkgZGVmYXVsdCAoc2VlIHNldFNwYW5UeXBlU2VsZWN0YWJpbGl0eSlcbiAgICAgICAgJCgnI3NwYW5fZm9ybSBpbnB1dDpub3QoW3VudXNlZF0pJykucmVtb3ZlQXR0cignZGlzYWJsZWQnKTtcblxuICAgICAgICAvLyBjbG9zZSBzcGFuIHR5cGVzIGlmIHRoZXJlJ3Mgb3ZlciBzcGFuVHlwZXNUb1Nob3dCZWZvcmVDb2xsYXBzZVxuICAgICAgICBpZiAoJCgnI2VudGl0eV90eXBlcyAuaXRlbScpLmxlbmd0aCA+IHNwYW5UeXBlc1RvU2hvd0JlZm9yZUNvbGxhcHNlKSB7XG4gICAgICAgICAgJCgnI2VudGl0eV90eXBlcyAub3BlbicpLnJlbW92ZUNsYXNzKCdvcGVuJyk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKCQoJyNldmVudF90eXBlcyAuaXRlbScpLmxlbmd0aCA+IHNwYW5UeXBlc1RvU2hvd0JlZm9yZUNvbGxhcHNlKSB7XG4gICAgICAgICAgJCgnI2V2ZW50X3R5cGVzIC5vcGVuJykucmVtb3ZlQ2xhc3MoJ29wZW4nKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHZhciBzaG93QWxsQXR0cmlidXRlcyA9IGZhbHNlO1xuICAgICAgICBpZiAoc3Bhbikge1xuICAgICAgICAgIHZhciBoYXNoID0gbmV3IFVSTEhhc2goY29sbCwgZG9jLCB7IGZvY3VzOiBbW3NwYW4uaWRdXSB9KS5nZXRIYXNoKCk7XG4gICAgICAgICAgJCgnI3NwYW5faGlnaGxpZ2h0X2xpbmsnKS5hdHRyKCdocmVmJywgaGFzaCkuc2hvdygpO1xuICAgICAgICAgIHZhciBlbCA9ICQoJyNzcGFuXycgKyBzcGFuLnR5cGUpO1xuICAgICAgICAgIGlmIChlbC5sZW5ndGgpIHtcbiAgICAgICAgICAgIGVsWzBdLmNoZWNrZWQgPSB0cnVlO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAkKCcjc3Bhbl9mb3JtIGlucHV0OnJhZGlvOmNoZWNrZWQnKS5lYWNoKGZ1bmN0aW9uIChyYWRpb05vLCByYWRpbykge1xuICAgICAgICAgICAgICByYWRpby5jaGVja2VkID0gZmFsc2U7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICAvLyBvcGVuIHRoZSBzcGFuIHR5cGVcbiAgICAgICAgICAkKCcjc3Bhbl8nICsgc3Bhbi50eXBlKS5wYXJlbnRzKCcuY29sbGFwc2libGUnKS5lYWNoKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgdG9nZ2xlQ29sbGFwc2libGUoJCh0aGlzKS5wYXJlbnQoKS5wcmV2KCksIHRydWUpO1xuICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgLy8gY291bnQgdGhlIHJlcGVhdGluZyBhcmMgdHlwZXNcbiAgICAgICAgICB2YXIgYXJjVHlwZUNvdW50ID0ge307XG4gICAgICAgICAgcmVwZWF0aW5nQXJjVHlwZXMgPSBbXTtcbiAgICAgICAgICAkLmVhY2goc3Bhbi5vdXRnb2luZywgZnVuY3Rpb24oYXJjTm8sIGFyYykge1xuICAgICAgICAgICAgLy8gcGFyc2Ugb3V0IHBvc3NpYmxlIG51bWJlciBzdWZmaXhlcyB0byBhbGxvdyBlLmcuIHNwbGl0dGluZ1xuICAgICAgICAgICAgLy8gb24gXCJUaGVtZVwiIGZvciBhcmdzIChcIlRoZW1lMVwiLCBcIlRoZW1lMlwiKS5cbiAgICAgICAgICAgIHZhciBzcGxpdEFyY1R5cGUgPSBhcmMudHlwZS5tYXRjaCgvXiguKj8pKFxcZCopJC8pO1xuICAgICAgICAgICAgdmFyIG5vTnVtQXJjVHlwZSA9IHNwbGl0QXJjVHlwZVsxXTtcbiAgICAgICAgICAgIGlmICgoYXJjVHlwZUNvdW50W25vTnVtQXJjVHlwZV0gPSAoYXJjVHlwZUNvdW50W25vTnVtQXJjVHlwZV0gfHwgMCkgKyAxKSA9PSAyKSB7XG4gICAgICAgICAgICAgIHJlcGVhdGluZ0FyY1R5cGVzLnB1c2gobm9OdW1BcmNUeXBlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9KTtcbiAgICAgICAgICBpZiAocmVwZWF0aW5nQXJjVHlwZXMubGVuZ3RoKSB7XG4gICAgICAgICAgICAkKCcjc3Bhbl9mb3JtX3NwbGl0Jykuc2hvdygpO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAkKCcjc3Bhbl9mb3JtX3NwbGl0JykuaGlkZSgpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAkKCcjc3Bhbl9oaWdobGlnaHRfbGluaycpLmhpZGUoKTtcbiAgICAgICAgICB2YXIgZmlyc3RSYWRpbyA9ICQoJyNzcGFuX2Zvcm0gaW5wdXQ6cmFkaW86bm90KFt1bnVzZWRdKTpmaXJzdCcpWzBdO1xuICAgICAgICAgIGlmIChmaXJzdFJhZGlvKSB7XG4gICAgICAgICAgICBmaXJzdFJhZGlvLmNoZWNrZWQgPSB0cnVlO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBkaXNwYXRjaGVyLnBvc3QoJ2hpZGVGb3JtJyk7XG4gICAgICAgICAgICBkaXNwYXRjaGVyLnBvc3QoJ21lc3NhZ2VzJywgW1tbJ05vIHZhbGlkIHNwYW4gdHlwZXMgZGVmaW5lZCcsICdlcnJvciddXV0pO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgIH1cbiAgICAgICAgICAkKCcjc3Bhbl9mb3JtX3NwbGl0JykuaGlkZSgpO1xuICAgICAgICAgICQoJyNzcGFuX25vdGVzJykudmFsKCcnKTtcbiAgICAgICAgICBzaG93QWxsQXR0cmlidXRlcyA9IHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHNwYW4gJiYgIXJlc2VsZWN0ZWRTcGFuKSB7XG4gICAgICAgICAgJCgnI3NwYW5fZm9ybV9yZXNlbGVjdCwgI3NwYW5fZm9ybV9kZWxldGUsICNzcGFuX2Zvcm1fYWRkX2ZyYWdtZW50Jykuc2hvdygpO1xuICAgICAgICAgIGtleW1hcFskLnVpLmtleUNvZGUuREVMRVRFXSA9ICdzcGFuX2Zvcm1fZGVsZXRlJztcbiAgICAgICAgICBrZXltYXBbJC51aS5rZXlDb2RlLklOU0VSVF0gPSAnc3Bhbl9mb3JtX3Jlc2VsZWN0JztcbiAgICAgICAgICBrZXltYXBbJ1MtJyArICQudWkua2V5Q29kZS5FTlRFUl0gPSAnc3Bhbl9mb3JtX2FkZF9mcmFnbWVudCc7XG4gICAgICAgICAgJCgnI3NwYW5fbm90ZXMnKS52YWwoc3Bhbi5hbm5vdGF0b3JOb3RlcyB8fCAnJyk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgJCgnI3NwYW5fZm9ybV9yZXNlbGVjdCwgI3NwYW5fZm9ybV9kZWxldGUsICNzcGFuX2Zvcm1fYWRkX2ZyYWdtZW50JykuaGlkZSgpO1xuICAgICAgICAgIGtleW1hcFskLnVpLmtleUNvZGUuREVMRVRFXSA9IG51bGw7XG4gICAgICAgICAga2V5bWFwWyQudWkua2V5Q29kZS5JTlNFUlRdID0gbnVsbDtcbiAgICAgICAgICBrZXltYXBbJ1MtJyArICQudWkua2V5Q29kZS5FTlRFUl0gPSBudWxsO1xuICAgICAgICB9XG4gICAgICAgIGlmIChzcGFuICYmICFyZXNlbGVjdGVkU3BhbiAmJiBzcGFuLm9mZnNldHMubGVuZ3RoID4gMSkge1xuICAgICAgICAgICQoJyNzcGFuX2Zvcm1fcmVzZWxlY3RfZnJhZ21lbnQsICNzcGFuX2Zvcm1fZGVsZXRlX2ZyYWdtZW50Jykuc2hvdygpO1xuICAgICAgICAgIGtleW1hcFsnUy0nICsgJC51aS5rZXlDb2RlLkRFTEVURV0gPSAnc3Bhbl9mb3JtX2RlbGV0ZV9mcmFnbWVudCc7XG4gICAgICAgICAga2V5bWFwWydTLScgKyAkLnVpLmtleUNvZGUuSU5TRVJUXSA9ICdzcGFuX2Zvcm1fcmVzZWxlY3RfZnJhZ21lbnQnO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICQoJyNzcGFuX2Zvcm1fcmVzZWxlY3RfZnJhZ21lbnQsICNzcGFuX2Zvcm1fZGVsZXRlX2ZyYWdtZW50JykuaGlkZSgpO1xuICAgICAgICAgIGtleW1hcFsnUy0nICsgJC51aS5rZXlDb2RlLkRFTEVURV0gPSBudWxsO1xuICAgICAgICAgIGtleW1hcFsnUy0nICsgJC51aS5rZXlDb2RlLklOU0VSVF0gPSBudWxsO1xuICAgICAgICB9XG4gICAgICAgIC8vIFRPRE86IGxvdHMgb2YgcmVkdW5kYW5jeSBpbiB0aGUgbmV4dCB0d28gYmxvY2tzLCBjbGVhbiB1cFxuICAgICAgICBpZiAoIXNwYW4pIHtcbiAgICAgICAgICAvLyBubyBleGlzdGluZyBhbm5vdGF0aW9uLCByZXNldCBhdHRyaWJ1dGVzXG4gICAgICAgICAgdmFyIGF0dHJDYXRlZ29yeUFuZFR5cGVzID0gW1snZW50aXR5JywgZW50aXR5QXR0cmlidXRlVHlwZXNdLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBbJ2V2ZW50JywgZXZlbnRBdHRyaWJ1dGVUeXBlc11dO1xuICAgICAgICAgICQuZWFjaChhdHRyQ2F0ZWdvcnlBbmRUeXBlcywgZnVuY3Rpb24oY3RObywgY3QpIHtcbiAgICAgICAgICAgIHZhciBjYXRlZ29yeSA9IGN0WzBdO1xuICAgICAgICAgICAgdmFyIGF0dHJpYnV0ZVR5cGVzID0gY3RbMV07XG4gICAgICAgICAgICAkLmVhY2goYXR0cmlidXRlVHlwZXMsIGZ1bmN0aW9uKGF0dHJObywgYXR0cikge1xuICAgICAgICAgICAgICAkaW5wdXQgPSAkKCcjJytjYXRlZ29yeSsnX2F0dHJfJytVdGlsLmVzY2FwZVF1b3RlcyhhdHRyLnR5cGUpKTtcbiAgICAgICAgICAgICAgaWYgKGF0dHIudW51c2VkKSB7XG4gICAgICAgICAgICAgICAgJGlucHV0LnZhbCgnJyk7XG4gICAgICAgICAgICAgIH0gZWxzZSBpZiAoYXR0ci5ib29sKSB7XG4gICAgICAgICAgICAgICAgJGlucHV0WzBdLmNoZWNrZWQgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICB1cGRhdGVDaGVja2JveCgkaW5wdXQpO1xuICAgICAgICAgICAgICAgICRpbnB1dC5idXR0b24oJ3JlZnJlc2gnKTtcbiAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAkaW5wdXQudmFsKCcnKS5jaGFuZ2UoKTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH0gZWxzZSBpZiAoIXJlc2VsZWN0ZWRTcGFuKSB7XG4gICAgICAgICAgLy8gZXhpc3RpbmcgYW5ub3RhdGlvbiwgZmlsbCBhdHRyaWJ1dGUgdmFsdWVzIGZyb20gc3BhblxuICAgICAgICAgIHZhciBhdHRyaWJ1dGVUeXBlcztcbiAgICAgICAgICB2YXIgY2F0ZWdvcnk7XG4gICAgICAgICAgaWYgKHNwYW4uZ2VuZXJhbFR5cGUgPT0gJ2VudGl0eScpIHtcbiAgICAgICAgICAgIGF0dHJpYnV0ZVR5cGVzID0gZW50aXR5QXR0cmlidXRlVHlwZXM7XG4gICAgICAgICAgICBjYXRlZ29yeSA9ICdlbnRpdHknO1xuICAgICAgICAgIH0gZWxzZSBpZiAoc3Bhbi5nZW5lcmFsVHlwZSA9PSAndHJpZ2dlcicpIHtcbiAgICAgICAgICAgIGF0dHJpYnV0ZVR5cGVzID0gZXZlbnRBdHRyaWJ1dGVUeXBlcztcbiAgICAgICAgICAgIC8vIFRPRE86IHVuaWZ5IGNhdGVnb3J5L2dlbmVyYWxUeXBlIHZhbHVlcyAoJ3RyaWdnZXInIHZzLiAnZXZlbnQnKVxuICAgICAgICAgICAgY2F0ZWdvcnkgPSAnZXZlbnQnO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKCdVbnJlY29nbml6ZWQgZ2VuZXJhbFR5cGU6Jywgc3Bhbi5nZW5lcmFsVHlwZSk7XG4gICAgICAgICAgfVxuICAgICAgICAgICQuZWFjaChhdHRyaWJ1dGVUeXBlcywgZnVuY3Rpb24oYXR0ck5vLCBhdHRyKSB7XG4gICAgICAgICAgICAkaW5wdXQgPSAkKCcjJytjYXRlZ29yeSsnX2F0dHJfJytVdGlsLmVzY2FwZVF1b3RlcyhhdHRyLnR5cGUpKTtcbiAgICAgICAgICAgIHZhciB2YWwgPSBzcGFuLmF0dHJpYnV0ZXNbYXR0ci50eXBlXTtcbiAgICAgICAgICAgIGlmIChhdHRyLnVudXNlZCkge1xuICAgICAgICAgICAgICAkaW5wdXQudmFsKHZhbCB8fCAnJyk7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKGF0dHIuYm9vbCkge1xuICAgICAgICAgICAgICAkaW5wdXRbMF0uY2hlY2tlZCA9IHZhbDtcbiAgICAgICAgICAgICAgdXBkYXRlQ2hlY2tib3goJGlucHV0KTtcbiAgICAgICAgICAgICAgJGlucHV0LmJ1dHRvbigncmVmcmVzaCcpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgJGlucHV0LnZhbCh2YWwgfHwgJycpLmNoYW5nZSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgdmFyIHNob3dWYWxpZE5vcm1hbGl6YXRpb25zRm9yID0gZnVuY3Rpb24odHlwZSkge1xuICAgICAgICAgIC8vIHNldCBEQiBzZWxlY3RvciB0byB0aGUgZmlyc3QgYXBwcm9wcmlhdGUgZm9yIHRoZSB0eXBlLlxuICAgICAgICAgIC8vIFRPRE86IGFjdHVhbGx5IGRpc2FibGUgaW5hcHByb3ByaWF0ZSBvbmVzLlxuICAgICAgICAgIC8vIFRPRE86IHN1cHBvcnQgc3BlY2lmaWMgSURzLCBub3QganVzdCBEQiBzcGVjaWZpZXJzXG4gICAgICAgICAgdmFyIGZpcnN0RGIgPSB0eXBlICYmIG5vcm1EYnNCeVR5cGVbdHlwZV0gPyBub3JtRGJzQnlUeXBlW3R5cGVdWzBdIDogbnVsbDtcbiAgICAgICAgICBpZiAoZmlyc3REYikge1xuICAgICAgICAgICAgJCgnI3NwYW5fbm9ybV9kYicpLnZhbChmaXJzdERiKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBzaG93VmFsaWROb3JtYWxpemF0aW9ucyA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgIC8vIHNldCBub3JtIERCIHNlbGVjdG9yIGFjY29yZGluZyB0byB0aGUgZmlyc3Qgc2VsZWN0ZWQgdHlwZVxuICAgICAgICAgIHZhciBmaXJzdFNlbGVjdGVkID0gJCgnI2VudGl0eV9hbmRfZXZlbnRfd3JhcHBlciBpbnB1dDpyYWRpbzpjaGVja2VkJylbMF07XG4gICAgICAgICAgdmFyIHNlbGVjdGVkVHlwZSA9IGZpcnN0U2VsZWN0ZWQgPyBmaXJzdFNlbGVjdGVkLnZhbHVlIDogbnVsbDtcbiAgICAgICAgICBzaG93VmFsaWROb3JtYWxpemF0aW9uc0ZvcihzZWxlY3RlZFR5cGUpO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gZmlsbCBub3JtYWxpemF0aW9ucyAoaWYgYW55KVxuICAgICAgICBpZiAoIXJlc2VsZWN0ZWRTcGFuKSB7XG4gICAgICAgICAgLy8gY2xlYXIgZmlyc3RcbiAgICAgICAgICBjbGVhck5vcm1hbGl6YXRpb25VSSgpO1xuXG4gICAgICAgICAgdmFyICRub3JtRGIgPSAkKCcjc3Bhbl9ub3JtX2RiJyk7XG4gICAgICAgICAgdmFyICRub3JtSWQgPSAkKCcjc3Bhbl9ub3JtX2lkJyk7XG4gICAgICAgICAgdmFyICRub3JtVGV4dCA9ICQoJyNzcGFuX25vcm1fdHh0Jyk7XG5cbiAgICAgICAgICAvLyBmaWxsIGlmIGZvdW5kIChOT1RFOiBvbmx5IHNob3dzIGxhc3Qgb24gbXVsdGlwbGUpXG4gICAgICAgICAgdmFyIG5vcm1GaWxsZWQgPSBmYWxzZTtcbiAgICAgICAgICAkLmVhY2goc3BhbiA/IHNwYW4ubm9ybWFsaXphdGlvbnMgOiBbXSwgZnVuY3Rpb24obm9ybU5vLCBub3JtKSB7XG4gICAgICAgICAgICB2YXIgcmVmRGIgPSBub3JtWzBdLCByZWZJZCA9IG5vcm1bMV0sIHJlZlRleHQgPSBub3JtWzJdO1xuICAgICAgICAgICAgJG5vcm1EYi52YWwocmVmRGIpO1xuICAgICAgICAgICAgLy8gY291bGQgdGhlIERCIHNlbGVjdG9yIGJlIHNldD8gKGkuZS4gaXMgcmVmRGIgY29uZmlndXJlZD8pXG4gICAgICAgICAgICBpZiAoJG5vcm1EYi52YWwoKSA9PSByZWZEYikge1xuICAgICAgICAgICAgICAvLyBEQiBpcyBPSywgc2V0IHRoZSByZXN0IGFsc29cbiAgICAgICAgICAgICAgJG5vcm1JZC52YWwocmVmSWQpO1xuICAgICAgICAgICAgICBvbGRTcGFuTm9ybUlkVmFsdWUgPSByZWZJZDtcbiAgICAgICAgICAgICAgJG5vcm1UZXh0LnZhbChyZWZUZXh0KTtcbiAgICAgICAgICAgICAgLy8gVE9ETzogY2hlY2sgaWYgSUQgaXMgdmFsaWRcbiAgICAgICAgICAgICAgJG5vcm1JZC5hZGRDbGFzcygndmFsaWRfdmFsdWUnKVxuICAgICAgICAgICAgICBub3JtRmlsbGVkID0gdHJ1ZTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgIC8vIGNhbid0IHNldCB0aGUgREIgc2VsZWN0b3I7IGFzc3VtZSBEQiBpcyBub3QgY29uZmlndXJlZCxcbiAgICAgICAgICAgICAgLy8gd2FybiBhbmQgbGVhdmUgYmxhbmsgKHdpbGwgcmVtb3ZlIG5vcm0gd2hlbiBkaWFsb2cgaXMgT0snZClcbiAgICAgICAgICAgICAgZGlzcGF0Y2hlci5wb3N0KCdtZXNzYWdlcycsIFtbWydXYXJuaW5nOiAnK3JlZkRiKycgbm90IGNvbmZpZ3VyZWQsIHJlbW92aW5nIG5vcm1hbGl6YXRpb24uJywgJ3dhcm5pbmcnXV1dKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9KTtcblxuICAgICAgICAgIC8vIGlmIHRoZXJlIGlzIG5vIGV4aXN0aW5nIG5vcm1hbGl6YXRpb24sIHNob3cgdmFsaWQgb25lc1xuICAgICAgICAgIGlmICghbm9ybUZpbGxlZCkge1xuICAgICAgICAgICAgc2hvd1ZhbGlkTm9ybWFsaXphdGlvbnMoKTtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICAvLyB1cGRhdGUgbGlua3NcbiAgICAgICAgICB1cGRhdGVOb3JtYWxpemF0aW9uUmVmTGluaygpO1xuICAgICAgICAgIHVwZGF0ZU5vcm1hbGl6YXRpb25EYkxpbmsoKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHZhciBzaG93QXR0cmlidXRlc0ZvciA9IGZ1bmN0aW9uKGF0dHJUeXBlcywgY2F0ZWdvcnksIHR5cGUpIHtcbiAgICAgICAgICB2YXIgdmFsaWRBdHRycyA9IHR5cGUgPyBzcGFuVHlwZXNbdHlwZV0uYXR0cmlidXRlcyA6IFtdO1xuICAgICAgICAgIHZhciBzaG93bkNvdW50ID0gMDtcbiAgICAgICAgICAkLmVhY2goYXR0clR5cGVzLCBmdW5jdGlvbihhdHRyTm8sIGF0dHIpIHtcbiAgICAgICAgICAgIHZhciAkaW5wdXQgPSAkKCcjJytjYXRlZ29yeSsnX2F0dHJfJytVdGlsLmVzY2FwZVF1b3RlcyhhdHRyLnR5cGUpKTtcbiAgICAgICAgICAgIHZhciBzaG93QXR0ciA9IHNob3dBbGxBdHRyaWJ1dGVzIHx8ICQuaW5BcnJheShhdHRyLnR5cGUsIHZhbGlkQXR0cnMpICE9IC0xO1xuICAgICAgICAgICAgaWYgKHNob3dBdHRyKSB7XG4gICAgICAgICAgICAgICRpbnB1dC5idXR0b24oJ3dpZGdldCcpLnNob3coKTtcbiAgICAgICAgICAgICAgc2hvd25Db3VudCsrO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgJGlucHV0LmJ1dHRvbignd2lkZ2V0JykuaGlkZSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0pO1xuICAgICAgICAgIHJldHVybiBzaG93bkNvdW50O1xuICAgICAgICB9XG5cbiAgICAgICAgc2hvd1ZhbGlkQXR0cmlidXRlcyA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgIHZhciB0eXBlID0gJCgnI3NwYW5fZm9ybSBpbnB1dDpyYWRpbzpjaGVja2VkJykudmFsKCk7XG4gICAgICAgICAgdmFyIGVudGl0eUF0dHJDb3VudCA9IHNob3dBdHRyaWJ1dGVzRm9yKGVudGl0eUF0dHJpYnV0ZVR5cGVzLCAnZW50aXR5JywgdHlwZSk7XG4gICAgICAgICAgdmFyIGV2ZW50QXR0ckNvdW50ID0gc2hvd0F0dHJpYnV0ZXNGb3IoZXZlbnRBdHRyaWJ1dGVUeXBlcywgJ2V2ZW50JywgdHlwZSk7XG4gICAgICAgICAgXG4gICAgICAgICAgc2hvd0FsbEF0dHJpYnV0ZXMgPSBmYWxzZTtcbiAgICAgICAgICAvLyBzaG93IGF0dHJpYnV0ZSBmcmFtZXMgb25seSBpZiBhdCBsZWFzdCBvbmUgYXR0cmlidXRlIGlzXG4gICAgICAgICAgLy8gc2hvd24sIGFuZCBzZXQgc2l6ZSBjbGFzc2VzIGFwcHJvcHJpYXRlbHlcbiAgICAgICAgICBpZiAoZXZlbnRBdHRyQ291bnQgPiAwKSB7XG4gICAgICAgICAgICAkKCcjZXZlbnRfYXR0cmlidXRlcycpLnNob3coKTtcbiAgICAgICAgICAgICQoJyNldmVudF9hdHRyaWJ1dGVfbGFiZWwnKS5zaG93KCk7XG4gICAgICAgICAgICAkKCcjZXZlbnRfdHlwZXMnKS5cbiAgICAgICAgICAgICAgcmVtb3ZlQ2xhc3MoJ3Njcm9sbF93cmFwcGVyX2Z1bGwnKS5cbiAgICAgICAgICAgICAgYWRkQ2xhc3MoJ3Njcm9sbF93cmFwcGVyX3VwcGVyJyk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICQoJyNldmVudF9hdHRyaWJ1dGVzJykuaGlkZSgpO1xuICAgICAgICAgICAgJCgnI2V2ZW50X2F0dHJpYnV0ZV9sYWJlbCcpLmhpZGUoKTtcbiAgICAgICAgICAgICQoJyNldmVudF90eXBlcycpLlxuICAgICAgICAgICAgICByZW1vdmVDbGFzcygnc2Nyb2xsX3dyYXBwZXJfdXBwZXInKS5cbiAgICAgICAgICAgICAgYWRkQ2xhc3MoJ3Njcm9sbF93cmFwcGVyX2Z1bGwnKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgaWYgKGVudGl0eUF0dHJDb3VudCA+IDApIHtcbiAgICAgICAgICAgICQoJyNlbnRpdHlfYXR0cmlidXRlcycpLnNob3coKTtcbiAgICAgICAgICAgICQoJyNlbnRpdHlfYXR0cmlidXRlX2xhYmVsJykuc2hvdygpO1xuICAgICAgICAgICAgJCgnI2VudGl0eV90eXBlcycpLlxuICAgICAgICAgICAgICByZW1vdmVDbGFzcygnc2Nyb2xsX3dyYXBwZXJfZnVsbCcpLlxuICAgICAgICAgICAgICBhZGRDbGFzcygnc2Nyb2xsX3dyYXBwZXJfdXBwZXInKTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgJCgnI2VudGl0eV9hdHRyaWJ1dGVzJykuaGlkZSgpO1xuICAgICAgICAgICAgJCgnI2VudGl0eV9hdHRyaWJ1dGVfbGFiZWwnKS5oaWRlKCk7XG4gICAgICAgICAgICAkKCcjZW50aXR5X3R5cGVzJykuXG4gICAgICAgICAgICAgIHJlbW92ZUNsYXNzKCdzY3JvbGxfd3JhcHBlcl91cHBlcicpLlxuICAgICAgICAgICAgICBhZGRDbGFzcygnc2Nyb2xsX3dyYXBwZXJfZnVsbCcpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBzaG93VmFsaWRBdHRyaWJ1dGVzKCk7XG5cbiAgICAgICAgLy8gVE9ETyBYWFg6IGlmIHNlZW1lZCBxdWl0ZSB1bmV4cGVjdGVkL3VuaW50dWl0aXZlIHRoYXQgdGhlXG4gICAgICAgIC8vIGZvcm0gd2FzIHJlLWRpc3BsYXllZCB3aGlsZSB0aGUgZG9jdW1lbnQgc3RpbGwgc2hvd3MgdGhlXG4gICAgICAgIC8vIGFubm90YXRpb24gaW4gaXRzIG9sZCBsb2NhdGlvbiBpbiB0aGUgYmFja2dyb3VuZCAoY2hlY2sgaXQpLlxuICAgICAgICAvLyBUaGUgZml4IG9mIHNraXBwaW5nIGNvbmZpcm0gaXMgbm90IHJlYWxseSBnb29kIGVpdGhlciwgdGhvdWdoLlxuICAgICAgICBpZiAocmVzZWxlY3RlZFNwYW4pIHsgLy8gJiYgIUNvbmZpZ3VyYXRpb24uY29uZmlybU1vZGVPbikge1xuICAgICAgICAgIHN1Ym1pdFJlc2VsZWN0KCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgZGlzcGF0Y2hlci5wb3N0KCdzaG93Rm9ybScsIFtzcGFuRm9ybSwgc3Bhbk9wdGlvbnNdKTtcbiAgICAgICAgICAkKCcjc3Bhbl9mb3JtLW9rJykuZm9jdXMoKTtcbiAgICAgICAgICBhZGp1c3RUb0N1cnNvcihldnQsIHNwYW5Gb3JtLnBhcmVudCgpKTtcbiAgICAgICAgfVxuICAgICAgfTtcblxuICAgICAgdmFyIHN1Ym1pdFJlc2VsZWN0ID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICQocmVzZWxlY3RlZFNwYW4ucmVjdCkucmVtb3ZlQ2xhc3MoJ3Jlc2VsZWN0Jyk7XG4gICAgICAgIHJlc2VsZWN0ZWRTcGFuID0gbnVsbDtcbiAgICAgICAgc3BhbkZvcm0uc3VibWl0KCk7XG4gICAgICB9O1xuXG4gICAgICB2YXIgcmFwaWRGaWxsU3BhblR5cGVzQW5kRGlzcGxheUZvcm0gPSBmdW5jdGlvbihzdGFydCwgZW5kLCB0ZXh0LCB0eXBlcykge1xuICAgICAgICAvLyB2YXJpYW50IG9mIGZpbGxTcGFuVHlwZXNBbmREaXNwbGF5Rm9ybSBmb3IgcmFwaWQgYW5ub3RhdGlvbiBtb2RlXG4gICAgICAgIGtleW1hcCA9IHNwYW5LZXltYXA7XG4gICAgICAgICQoJyNyYXBpZF9zcGFuX3NlbGVjdGVkJykudGV4dCh0ZXh0KTtcblxuICAgICAgICAvLyBmaWxsIHR5cGVzXG4gICAgICAgIHZhciAkc3BhblR5cGVEaXYgPSAkKCcjcmFwaWRfc3Bhbl90eXBlc19kaXYnKTtcbiAgICAgICAgLy8gcmVtb3ZlIHByZXZpb3VzbHkgZmlsbGVkLCBpZiBhbnlcbiAgICAgICAgJHNwYW5UeXBlRGl2LmVtcHR5KCk7XG4gICAgICAgICQuZWFjaCh0eXBlcywgZnVuY3Rpb24odHlwZU5vLCB0eXBlQW5kUHJvYikge1xuICAgICAgICAgIC8vIFRPRE86IHRoaXMgZHVwbGljYXRlcyBhIHBhcnQgb2YgYWRkU3BhblR5cGVzVG9EaXZJbm5lciwgdW5pZnlcbiAgICAgICAgICB2YXIgdHlwZSA9IHR5cGVBbmRQcm9iWzBdO1xuICAgICAgICAgIHZhciBwcm9iID0gdHlwZUFuZFByb2JbMV07XG4gICAgICAgICAgdmFyICRudW1sYWJlbCA9ICQoJzxzcGFuIGNsYXNzPVwiYWNjZXNza2V5XCI+JysodHlwZU5vKzEpKyc8L3NwYW4+PHNwYW4+Ojwvc3Bhbj4nKTtcbiAgICAgICAgICB2YXIgJGlucHV0ID0gJCgnPGlucHV0IHR5cGU9XCJyYWRpb1wiIG5hbWU9XCJyYXBpZF9zcGFuX3R5cGVcIi8+JykuXG4gICAgICAgICAgICAgIGF0dHIoJ2lkJywgJ3JhcGlkX3NwYW5fJyArICh0eXBlTm8rMSkpLlxuICAgICAgICAgICAgICBhdHRyKCd2YWx1ZScsIHR5cGUpO1xuICAgICAgICAgIHZhciBzcGFuQmdDb2xvciA9IHNwYW5UeXBlc1t0eXBlXSAmJiBzcGFuVHlwZXNbdHlwZV0uYmdDb2xvciB8fCAnI2ZmZmZmZic7XG4gICAgICAgICAgc3BhbkJnQ29sb3IgPSBVdGlsLmFkanVzdENvbG9yTGlnaHRuZXNzKHNwYW5CZ0NvbG9yLCBzcGFuQm94VGV4dEJnQ29sb3JMaWdodGVuKTtcbiAgICAgICAgICAvLyB1c2UgcHJlZmVycmVkIGxhYmVsIGluc3RlYWQgb2YgdHlwZSBuYW1lIGlmIGF2YWlsYWJsZVxuICAgICAgICAgIHZhciBuYW1lID0gc3BhblR5cGVzW3R5cGVdICYmIHNwYW5UeXBlc1t0eXBlXS5uYW1lIHx8IHR5cGU7XG4gICAgICAgICAgdmFyICRsYWJlbCA9ICQoJzxsYWJlbCBjbGFzcz1cInNwYW5fdHlwZV9sYWJlbFwiLz4nKS5cbiAgICAgICAgICAgIGF0dHIoJ2ZvcicsICdyYXBpZF9zcGFuXycgKyAodHlwZU5vKzEpKS5cbiAgICAgICAgICAgIHRleHQobmFtZSsnICgnICsgKDEwMC4wICogcHJvYikudG9GaXhlZCgxKSArICclKScpO1xuICAgICAgICAgICRsYWJlbC5jc3MoJ2JhY2tncm91bmQtY29sb3InLCBzcGFuQmdDb2xvcik7ICAgICAgICAgIFxuICAgICAgICAgIC8vIFRPRE86IGNoZWNrIGZvciB1bm5lY2Vzc2FyeSBleHRyYSB3cmFwcGluZyBoZXJlXG4gICAgICAgICAgdmFyICRjb250ZW50ID0gJCgnPGRpdiBjbGFzcz1cIml0ZW1fY29udGVudFwiLz4nKS5cbiAgICAgICAgICAgIGFwcGVuZCgkbnVtbGFiZWwpLlxuICAgICAgICAgICAgYXBwZW5kKCRpbnB1dCkuXG4gICAgICAgICAgICBhcHBlbmQoJGxhYmVsKTtcbiAgICAgICAgICAkc3BhblR5cGVEaXYuYXBwZW5kKCRjb250ZW50KTtcbiAgICAgICAgICAvLyBoaWdobGlnaHQgY29uZmlndXJlZCBob3RrZXkgKGlmIGFueSkgaW4gdGV4dC5cbiAgICAgICAgICAvLyBOT1RFOiB0aGlzIGJpdCBkb2Vzbid0IGFjdHVhbGx5IHNldCB1cCB0aGUgaG90a2V5LlxuICAgICAgICAgIHZhciBob3RrZXlUeXBlID0gJ3NwYW5fJyArIHR5cGU7XG4gICAgICAgICAgLy8gVE9ETzogdGhpcyBpcyBjbHVtc3k7IHRoZXJlIHNob3VsZCBiZSBhIGJldHRlciB3YXlcbiAgICAgICAgICB2YXIgdHlwZUhvdGtleSA9IG51bGw7XG4gICAgICAgICAgJC5lYWNoKGtleW1hcCwgZnVuY3Rpb24oa2V5LCBrZXlUeXBlKSB7XG4gICAgICAgICAgICBpZiAoa2V5VHlwZSA9PSBob3RrZXlUeXBlKSB7XG4gICAgICAgICAgICAgIHR5cGVIb3RrZXkgPSBrZXk7XG4gICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9KTtcbiAgICAgICAgICBpZiAodHlwZUhvdGtleSkge1xuICAgICAgICAgICAgdmFyIG5hbWUgPSAkbGFiZWwuaHRtbCgpO1xuICAgICAgICAgICAgdmFyIHJlcGxhY2UgPSB0cnVlO1xuICAgICAgICAgICAgbmFtZSA9IG5hbWUucmVwbGFjZShuZXcgUmVnRXhwKFwiKCZbXjtdKj8pPyhcIiArIHR5cGVIb3RrZXkgKyBcIilcIiwgJ2dpJyksXG4gICAgICAgICAgICAgIGZ1bmN0aW9uKGFsbCwgZW50aXR5LCBsZXR0ZXIpIHtcbiAgICAgICAgICAgICAgICBpZiAocmVwbGFjZSAmJiAhZW50aXR5KSB7XG4gICAgICAgICAgICAgICAgICByZXBsYWNlID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICB2YXIgaG90a2V5ID0gdHlwZUhvdGtleS50b0xvd2VyQ2FzZSgpID09IGxldHRlclxuICAgICAgICAgICAgICAgICAgICAgID8gdHlwZUhvdGtleS50b0xvd2VyQ2FzZSgpXG4gICAgICAgICAgICAgICAgICAgICAgOiB0eXBlSG90a2V5LnRvVXBwZXJDYXNlKCk7XG4gICAgICAgICAgICAgICAgICByZXR1cm4gJzxzcGFuIGNsYXNzPVwiYWNjZXNza2V5XCI+JyArIFV0aWwuZXNjYXBlSFRNTChob3RrZXkpICsgJzwvc3Bhbj4nO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm4gYWxsO1xuICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICRsYWJlbC5odG1sKG5hbWUpO1xuICAgICAgICAgIH1cbiAgICAgICAgICAvLyBMaW1pdCB0aGUgbnVtYmVyIG9mIHN1Z2dlc3Rpb25zIHRvIHRoZSBudW1iZXIgb2YgbnVtZXJpYyBrZXlzXG4gICAgICAgICAgaWYgKHR5cGVObyA+PSA4KSB7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgLy8gZmlsbCBpbiBzb21lIHNwYWNlIGFuZCB0aGUgc3BlY2lhbCBcIk90aGVyXCIgb3B0aW9uLCB3aXRoIGtleSBcIjBcIiAoemVybylcbiAgICAgICAgJHNwYW5UeXBlRGl2LmFwcGVuZCgkKCc8ZGl2IGNsYXNzPVwiaXRlbV9jb250ZW50XCI+JiMxNjA7PC9kaXY+JykpOyAvLyBub24tYnJlYWtpbmcgc3BhY2VcbiAgICAgICAgdmFyICRudW1sYWJlbCA9ICQoJzxzcGFuIGNsYXNzPVwiYWNjZXNza2V5XCI+MDwvc3Bhbj48c3Bhbj46PC9zcGFuPicpOyAgICAgICAgXG4gICAgICAgIHZhciAkaW5wdXQgPSAkKCc8aW5wdXQgdHlwZT1cInJhZGlvXCIgbmFtZT1cInJhcGlkX3NwYW5fdHlwZVwiIGlkPVwicmFwaWRfc3Bhbl8wXCIgdmFsdWU9XCJcIi8+Jyk7XG4gICAgICAgIHZhciAkbGFiZWwgPSAkKCc8bGFiZWwgY2xhc3M9XCJzcGFuX3R5cGVfbGFiZWxcIiBmb3I9XCJyYXBpZF9zcGFuXzBcIiBzdHlsZT1cImJhY2tncm91bmQtY29sb3I6bGlnaHRncmF5XCI+T3RoZXIuLi48L2xhYmVsPicpO1xuICAgICAgICB2YXIgJGNvbnRlbnQgPSAkKCc8ZGl2IGNsYXNzPVwiaXRlbV9jb250ZW50XCIvPicpLlxuICAgICAgICAgIGFwcGVuZCgkbnVtbGFiZWwpLlxuICAgICAgICAgIGFwcGVuZCgkaW5wdXQpLlxuICAgICAgICAgIGFwcGVuZCgkbGFiZWwpO1xuICAgICAgICAkc3BhblR5cGVEaXYuYXBwZW5kKCRjb250ZW50KTtcblxuICAgICAgICAvLyBzZXQgdXAgY2xpY2sgZXZlbnQgaGFuZGxlcnNcbiAgICAgICAgcmFwaWRTcGFuRm9ybS5maW5kKCcjcmFwaWRfc3Bhbl90eXBlcyBpbnB1dDpyYWRpbycpLmNsaWNrKHJhcGlkU3BhbkZvcm1TdWJtaXRSYWRpbyk7XG5cbiAgICAgICAgdmFyIGZpcnN0UmFkaW8gPSAkKCcjcmFwaWRfc3Bhbl9mb3JtIGlucHV0OnJhZGlvOmZpcnN0JylbMF07XG4gICAgICAgIGlmIChmaXJzdFJhZGlvKSB7XG4gICAgICAgICAgZmlyc3RSYWRpby5jaGVja2VkID0gdHJ1ZTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBkaXNwYXRjaGVyLnBvc3QoJ2hpZGVGb3JtJyk7XG4gICAgICAgICAgZGlzcGF0Y2hlci5wb3N0KCdtZXNzYWdlcycsIFtbWydObyB2YWxpZCBzcGFuIHR5cGVzIGRlZmluZWQnLCAnZXJyb3InXV1dKTtcbiAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgZGlzcGF0Y2hlci5wb3N0KCdzaG93Rm9ybScsIFtyYXBpZFNwYW5Gb3JtXSk7XG4gICAgICAgIHJhcGlkQW5ub3RhdGlvbkRpYWxvZ1Zpc2libGUgPSB0cnVlO1xuICAgICAgICAkKCcjcmFwaWRfc3Bhbl9mb3JtLW9rJykuZm9jdXMoKTtcbiAgICAgICAgLy8gVE9ETzogYXZvaWQgdXNpbmcgZ2xvYmFsIGZvciBzdG9yZWQgY2xpY2sgZXZlbnRcbi8vICAgICAgICAgYWRqdXN0VG9DdXJzb3IobGFzdFJhcGlkQW5ub3RhdGlvbkV2ZW50LCByYXBpZFNwYW5Gb3JtLnBhcmVudCgpLFxuLy8gICAgICAgICAgICAgICAgICAgICAgICB0cnVlLCB0cnVlKTtcbiAgICAgICAgLy8gVE9ETzogYXZvaWQgY29vcmRpbmF0ZSBoYWNrIHRvIHBvc2l0aW9uIHJvdWdobHkgYXQgZmlyc3RcbiAgICAgICAgLy8gYXZhaWxhYmxlIHNlbGVjdGlvblxuICAgICAgICBsYXN0UmFwaWRBbm5vdGF0aW9uRXZlbnQuY2xpZW50WCAtPSA1NTtcbiAgICAgICAgbGFzdFJhcGlkQW5ub3RhdGlvbkV2ZW50LmNsaWVudFkgLT0gMTE1O1xuICAgICAgICBhZGp1c3RUb0N1cnNvcihsYXN0UmFwaWRBbm5vdGF0aW9uRXZlbnQsIHJhcGlkU3BhbkZvcm0ucGFyZW50KCksXG4gICAgICAgICAgICAgICAgICAgICAgIGZhbHNlLCBmYWxzZSk7XG4gICAgICB9O1xuXG4gICAgICB2YXIgY2xlYXJTcGFuTm90ZXMgPSBmdW5jdGlvbihldnQpIHtcbiAgICAgICAgJCgnI3NwYW5fbm90ZXMnKS52YWwoJycpO1xuICAgICAgfVxuICAgICAgJCgnI2NsZWFyX25vdGVzX2J1dHRvbicpLmJ1dHRvbigpO1xuICAgICAgJCgnI2NsZWFyX25vdGVzX2J1dHRvbicpLmNsaWNrKGNsZWFyU3Bhbk5vdGVzKTtcblxuICAgICAgdmFyIGNsZWFyU3Bhbk5vcm0gPSBmdW5jdGlvbihldnQpIHtcbiAgICAgICAgY2xlYXJOb3JtYWxpemF0aW9uVUkoKTtcbiAgICAgIH1cbiAgICAgICQoJyNjbGVhcl9ub3JtX2J1dHRvbicpLmJ1dHRvbigpO1xuICAgICAgJCgnI2NsZWFyX25vcm1fYnV0dG9uJykuY2xpY2soY2xlYXJTcGFuTm9ybSk7XG5cbiAgICAgIC8vIGludm9rZWQgb24gcmVzcG9uc2UgdG8gYWpheCByZXF1ZXN0IGZvciBpZCBsb29rdXBcbiAgICAgIHZhciBzZXRTcGFuTm9ybVRleHQgPSBmdW5jdGlvbihyZXNwb25zZSkge1xuICAgICAgICBpZiAocmVzcG9uc2UuZXhjZXB0aW9uKSB7XG4gICAgICAgICAgLy8gVE9ETzogYmV0dGVyIHJlc3BvbnNlIHRvIGZhaWx1cmVcbiAgICAgICAgICBkaXNwYXRjaGVyLnBvc3QoJ21lc3NhZ2VzJywgW1tbJ0xvb2t1cCBlcnJvcicsICd3YXJuaW5nJywgLTFdXV0pO1xuICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfSAgICAgICAgXG4gICAgICAgIC8vIHNldCBpbnB1dCBzdHlsZSBhY2NvcmRpbmcgdG8gd2hldGhlciB3ZSBoYXZlIGEgdmFsaWQgdmFsdWVcbiAgICAgICAgdmFyICRpZGlucHV0ID0gJCgnI3NwYW5fbm9ybV9pZCcpO1xuICAgICAgICAvLyBUT0RPOiBtYWtlIHN1cmUgdGhlIGtleSBlY2hvIGluIHRoZSByZXNwb25zZSBtYXRjaGVzIHRoZVxuICAgICAgICAvLyBjdXJyZW50IHZhbHVlIG9mIHRoZSAkaWRpbnB1dFxuICAgICAgICAkaWRpbnB1dC5yZW1vdmVDbGFzcygndmFsaWRfdmFsdWUnKS5yZW1vdmVDbGFzcygnaW52YWxpZF92YWx1ZScpO1xuICAgICAgICBpZiAocmVzcG9uc2UudmFsdWUgPT09IG51bGwpIHtcbiAgICAgICAgICAkaWRpbnB1dC5hZGRDbGFzcygnaW52YWxpZF92YWx1ZScpO1xuICAgICAgICAgIGhpZGVOb3JtYWxpemF0aW9uUmVmTGluaygpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICRpZGlucHV0LmFkZENsYXNzKCd2YWxpZF92YWx1ZScpO1xuICAgICAgICAgIHVwZGF0ZU5vcm1hbGl6YXRpb25SZWZMaW5rKCk7XG4gICAgICAgIH1cbiAgICAgICAgJCgnI3NwYW5fbm9ybV90eHQnKS52YWwocmVzcG9uc2UudmFsdWUpO1xuICAgICAgfVxuXG4gICAgICAvLyBvbiBhbnkgY2hhbmdlIHRvIHRoZSBub3JtYWxpemF0aW9uIERCLCBjbGVhciBldmVyeXRoaW5nIGFuZFxuICAgICAgLy8gdXBkYXRlIGxpbmtcbiAgICAgIHZhciBzcGFuTm9ybURiVXBkYXRlID0gZnVuY3Rpb24oZXZ0KSB7XG4gICAgICAgIGNsZWFyTm9ybWFsaXphdGlvblVJKCk7XG4gICAgICAgIHVwZGF0ZU5vcm1hbGl6YXRpb25EYkxpbmsoKTtcbiAgICAgIH1cbiAgICAgICQoJyNzcGFuX25vcm1fZGInKS5jaGFuZ2Uoc3Bhbk5vcm1EYlVwZGF0ZSk7XG5cbiAgICAgIC8vIG9uIGFueSBjaGFuZ2UgdG8gdGhlIG5vcm1hbGl6YXRpb24gSUQsIHVwZGF0ZSB0aGUgdGV4dCBvZiB0aGVcbiAgICAgIC8vIHJlZmVyZW5jZVxuICAgICAgdmFyIHNwYW5Ob3JtSWRVcGRhdGUgPSBmdW5jdGlvbihldnQpIHtcbiAgICAgICAgdmFyIGtleSA9ICQodGhpcykudmFsKCk7XG4gICAgICAgIHZhciBkYiA9ICQoJyNzcGFuX25vcm1fZGInKS52YWwoKTtcbiAgICAgICAgaWYgKGtleSAhPSBvbGRTcGFuTm9ybUlkVmFsdWUpIHtcbiAgICAgICAgICBpZiAoa2V5Lm1hdGNoKC9eXFxzKiQvKSkge1xuICAgICAgICAgICAgLy8gZG9uJ3QgcXVlcnkgZW1wdGllcywganVzdCBjbGVhciBpbnN0ZWFkXG4gICAgICAgICAgICBjbGVhck5vcm1hbGl6YXRpb25VSSgpO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBkaXNwYXRjaGVyLnBvc3QoJ2FqYXgnLCBbIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhY3Rpb246ICdub3JtR2V0TmFtZScsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YWJhc2U6IGRiLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGtleToga2V5LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbGxlY3Rpb246IGNvbGx9LCAnbm9ybUdldE5hbWVSZXN1bHQnXSk7XG4gICAgICAgICAgfVxuICAgICAgICAgIG9sZFNwYW5Ob3JtSWRWYWx1ZSA9IGtleTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgLy8gc2VlIGh0dHA6Ly9zdGFja292ZXJmbG93LmNvbS9xdWVzdGlvbnMvMTk0ODMzMi9kZXRlY3QtYWxsLWNoYW5nZXMtdG8tYS1pbnB1dC10eXBlLXRleHQtaW1tZWRpYXRlbHktdXNpbmctanF1ZXJ5XG4gICAgICAkKCcjc3Bhbl9ub3JtX2lkJykuYmluZCgncHJvcGVydHljaGFuZ2Uga2V5dXAgaW5wdXQgcGFzdGUnLCBzcGFuTm9ybUlkVXBkYXRlKTtcbiAgICAgIC8vIG5pY2UtbG9va2luZyBzZWxlY3QgZm9yIG5vcm1hbGl6YXRpb25cbiAgICAgICQoJyNzcGFuX25vcm1fZGInKS5hZGRDbGFzcygndWktd2lkZ2V0IHVpLXN0YXRlLWRlZmF1bHQgdWktYnV0dG9uLXRleHQnKTtcblxuICAgICAgdmFyIG5vcm1TZWFyY2hEaWFsb2cgPSAkKCcjbm9ybV9zZWFyY2hfZGlhbG9nJyk7XG4gICAgICBpbml0Rm9ybShub3JtU2VhcmNoRGlhbG9nLCB7XG4gICAgICAgICAgd2lkdGg6IDgwMCxcbiAgICAgICAgICB3aWR0aDogNjAwLFxuICAgICAgICAgIHJlc2l6YWJsZTogdHJ1ZSxcbiAgICAgICAgICBhbHNvUmVzaXplOiAnI25vcm1fc2VhcmNoX3Jlc3VsdF9zZWxlY3QnLFxuICAgICAgICAgIG9wZW46IGZ1bmN0aW9uKGV2dCkge1xuICAgICAgICAgICAga2V5bWFwID0ge307XG4gICAgICAgICAgfSxcbiAgICAgICAgICBjbG9zZTogZnVuY3Rpb24oZXZ0KSB7XG4gICAgICAgICAgICAvLyBhc3N1bWUgdGhhdCB3ZSBhbHdheXMgd2FudCB0byByZXR1cm4gdG8gdGhlIHNwYW4gZGlhbG9nXG4gICAgICAgICAgICAvLyBvbiBub3JtYWxpemF0aW9uIGRpYWxvZyBjbG9zZVxuICAgICAgICAgICAgZGlzcGF0Y2hlci5wb3N0KCdzaG93Rm9ybScsIFtzcGFuRm9ybV0pO1xuICAgICAgICAgIH0sXG4gICAgICB9KTtcblxuLy8gQlJBVCBTVEFORCBBTE9ORSBMSUJSQVJZIEJFR0lOXG4vKlxuICAgICAgJCgnI25vcm1fc2VhcmNoX3F1ZXJ5JykuYXV0b2NvbXBsZXRlKHtcbiAgICAgICAgc291cmNlOiBmdW5jdGlvbihyZXF1ZXN0LCBjYWxsYmFjaykge1xuICAgICAgICAgIHZhciBxdWVyeSA9ICQudWkuYXV0b2NvbXBsZXRlLmVzY2FwZVJlZ2V4KHJlcXVlc3QudGVybSk7XG4gICAgICAgICAgdmFyIHBhdHRlcm4gPSBuZXcgUmVnRXhwKCdcXFxcYicgKyBxdWVyeSwgJ2knKTtcbiAgICAgICAgICBjYWxsYmFjaygkLmdyZXAobGFzdE5vcm1TZWFyY2hlcywgZnVuY3Rpb24oc2VhcmNoKSB7XG4gICAgICAgICAgICByZXR1cm4gcGF0dGVybi50ZXN0KHNlYXJjaC52YWx1ZSkgfHwgcGF0dGVybi50ZXN0KHNlYXJjaC5pZCk7XG4gICAgICAgICAgfSkpO1xuICAgICAgICB9LFxuICAgICAgICBtaW5MZW5ndGg6IDAsXG4gICAgICAgIHNlbGVjdDogZnVuY3Rpb24oZXZ0LCB1aSkge1xuICAgICAgICAgIGV2dC5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgICAgICBub3JtU3VibWl0KHVpLml0ZW0uaWQsIHVpLml0ZW0udmFsdWUpO1xuICAgICAgICB9LFxuICAgICAgICBmb2N1czogZnVuY3Rpb24oZXZ0LCB1aSkge1xuICAgICAgICAgIC8vIGRvIG5vdGhpbmdcbiAgICAgICAgfSxcbiAgICAgIH0pLmRhdGEoJ2F1dG9jb21wbGV0ZScpLl9yZW5kZXJJdGVtID0gZnVuY3Rpb24oJHVsLCBpdGVtKSB7XG4gICAgICAgIHJldHVybiAkKCc8bGk+PC9saT4nKS5cbiAgICAgICAgICBkYXRhKCdpdGVtLmF1dG9jb21wbGV0ZScsIGl0ZW0pLlxuICAgICAgICAgIGFwcGVuZCgnPGE+JyArIFV0aWwuZXNjYXBlSFRNTChpdGVtLnZhbHVlKSArICc8ZGl2IGNsYXNzPVwiYXV0b2NvbXBsZXRlLWlkXCI+JyArIFV0aWwuZXNjYXBlSFRNTChpdGVtLmlkKSArIFwiPC9kaXY+PC9hPlwiKS5cbiAgICAgICAgICBhcHBlbmRUbygkdWwpO1xuICAgICAgfTtcbiovXG4vLyBCUkFUIFNUQU5EIEFMT05FIExJQlJBUlkgRU5EXG5cbiAgICAgIHZhciBub3JtU3VibWl0ID0gZnVuY3Rpb24oc2VsZWN0ZWRJZCwgc2VsZWN0ZWRUeHQpIHtcbiAgICAgICAgLy8gd2UgZ290IGEgdmFsdWU7IGFjdCBpZiBpdCB3YXMgYSBzdWJtaXRcbiAgICAgICAgJCgnI3NwYW5fbm9ybV9pZCcpLnZhbChzZWxlY3RlZElkKTtcbiAgICAgICAgLy8gZG9uJ3QgZm9yZ2V0IHRvIHVwZGF0ZSB0aGlzIHJlZmVyZW5jZSB2YWx1ZVxuICAgICAgICBvbGRTcGFuTm9ybUlkVmFsdWUgPSBzZWxlY3RlZElkO1xuICAgICAgICAkKCcjc3Bhbl9ub3JtX3R4dCcpLnZhbChzZWxlY3RlZFR4dCk7XG4gICAgICAgIHVwZGF0ZU5vcm1hbGl6YXRpb25SZWZMaW5rKCk7XG4gICAgICAgIC8vIHVwZGF0ZSBoaXN0b3J5XG4gICAgICAgIHZhciBuZXh0TGFzdE5vcm1TZWFyY2hlcyA9IFtcbiAgICAgICAgICB7XG4gICAgICAgICAgICB2YWx1ZTogc2VsZWN0ZWRUeHQsXG4gICAgICAgICAgICBpZDogc2VsZWN0ZWRJZCxcbiAgICAgICAgICB9LFxuICAgICAgICBdO1xuICAgICAgICAkLmVhY2gobGFzdE5vcm1TZWFyY2hlcywgZnVuY3Rpb24oc2VhcmNoTm8sIHNlYXJjaCkge1xuICAgICAgICAgIGlmIChzZWFyY2guaWQgIT0gc2VsZWN0ZWRJZCB8fCBzZWFyY2gudmFsdWUgIT0gc2VsZWN0ZWRUeHQpIHtcbiAgICAgICAgICAgIG5leHRMYXN0Tm9ybVNlYXJjaGVzLnB1c2goc2VhcmNoKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICBsYXN0Tm9ybVNlYXJjaGVzID0gbmV4dExhc3ROb3JtU2VhcmNoZXM7XG4gICAgICAgIGxhc3ROb3JtU2VhcmNoZXMuc2xpY2UoMCwgbWF4Tm9ybVNlYXJjaEhpc3RvcnkpO1xuICAgICAgICAvLyBTd2l0Y2ggZGlhbG9ncy4gTk9URTogYXNzdW1pbmcgd2UgY2xvc2VkIHRoZSBzcGFuRm9ybSB3aGVuXG4gICAgICAgIC8vIGJyaW5naW5nIHVwIHRoZSBub3JtU2VhcmNoRGlhbG9nLlxuICAgICAgICBub3JtU2VhcmNoRGlhbG9nLmRpYWxvZygnY2xvc2UnKTtcbiAgICAgIH07XG4gICAgICB2YXIgbm9ybVNlYXJjaFN1Ym1pdCA9IGZ1bmN0aW9uKGV2dCkge1xuICAgICAgICBpZiAobm9ybVNlYXJjaFN1Ym1pdHRhYmxlKSB7XG4gICAgICAgICAgdmFyIHNlbGVjdGVkSWQgPSAkKCcjbm9ybV9zZWFyY2hfaWQnKS52YWwoKTsgXG4gICAgICAgICAgdmFyIHNlbGVjdGVkVHh0ID0gJCgnI25vcm1fc2VhcmNoX3F1ZXJ5JykudmFsKCk7XG5cbiAgICAgICAgICBub3JtU3VibWl0KHNlbGVjdGVkSWQsIHNlbGVjdGVkVHh0KTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBwZXJmb3JtTm9ybVNlYXJjaCgpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgIH1cbiAgICAgIHZhciBub3JtU2VhcmNoU3VibWl0dGFibGUgPSBmYWxzZTtcbiAgICAgIHZhciBzZXROb3JtU2VhcmNoU3VibWl0ID0gZnVuY3Rpb24oZW5hYmxlKSB7XG4gICAgICAgICQoJyNub3JtX3NlYXJjaF9kaWFsb2ctb2snKS5idXR0b24oZW5hYmxlID8gJ2VuYWJsZScgOiAnZGlzYWJsZScpO1xuICAgICAgICBub3JtU2VhcmNoU3VibWl0dGFibGUgPSBlbmFibGU7XG4gICAgICB9O1xuICAgICAgbm9ybVNlYXJjaERpYWxvZy5zdWJtaXQobm9ybVNlYXJjaFN1Ym1pdCk7XG4gICAgICB2YXIgY2hvb3NlTm9ybUlkID0gZnVuY3Rpb24oZXZ0KSB7XG4gICAgICAgIHZhciAkZWxlbWVudCA9ICQoZXZ0LnRhcmdldCkuY2xvc2VzdCgndHInKTtcbiAgICAgICAgJCgnI25vcm1fc2VhcmNoX3Jlc3VsdF9zZWxlY3QgdHInKS5yZW1vdmVDbGFzcygnc2VsZWN0ZWQnKTtcbiAgICAgICAgJGVsZW1lbnQuYWRkQ2xhc3MoJ3NlbGVjdGVkJyk7XG4gICAgICAgICQoJyNub3JtX3NlYXJjaF9xdWVyeScpLnZhbCgkZWxlbWVudC5hdHRyKCdkYXRhLXR4dCcpKTtcbiAgICAgICAgJCgnI25vcm1fc2VhcmNoX2lkJykudmFsKCRlbGVtZW50LmF0dHIoJ2RhdGEtaWQnKSk7XG4gICAgICAgIHNldE5vcm1TZWFyY2hTdWJtaXQodHJ1ZSk7XG4gICAgICB9XG4gICAgICB2YXIgY2hvb3NlTm9ybUlkQW5kU3VibWl0ID0gZnVuY3Rpb24oZXZ0KSB7XG4gICAgICAgIGNob29zZU5vcm1JZChldnQpO1xuICAgICAgICBub3JtU2VhcmNoU3VibWl0KGV2dCk7XG4gICAgICB9XG4gICAgICB2YXIgc2V0U3Bhbk5vcm1TZWFyY2hSZXN1bHRzID0gZnVuY3Rpb24ocmVzcG9uc2UpIHtcbiAgICAgICAgaWYgKHJlc3BvbnNlLmV4Y2VwdGlvbikge1xuICAgICAgICAgIC8vIFRPRE86IGJldHRlciByZXNwb25zZSB0byBmYWlsdXJlXG4gICAgICAgICAgZGlzcGF0Y2hlci5wb3N0KCdtZXNzYWdlcycsIFtbWydMb29rdXAgZXJyb3InLCAnd2FybmluZycsIC0xXV1dKTtcbiAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAocmVzcG9uc2UuaXRlbXMubGVuZ3RoID09IDApIHtcbiAgICAgICAgICAvLyBubyByZXN1bHRzXG4gICAgICAgICAgJCgnI25vcm1fc2VhcmNoX3Jlc3VsdF9zZWxlY3QgdGhlYWQnKS5lbXB0eSgpO1xuICAgICAgICAgICQoJyNub3JtX3NlYXJjaF9yZXN1bHRfc2VsZWN0IHRib2R5JykuZW1wdHkoKTtcbiAgICAgICAgICBkaXNwYXRjaGVyLnBvc3QoJ21lc3NhZ2VzJywgW1tbJ05vIG1hdGNoZXMgdG8gc2VhcmNoLicsICdjb21tZW50J11dXSk7XG4gICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gVE9ETzogYXZvaWQgY29kZSBkdXBsaWNhdGlvbiB3aXRoIHNob3dGaWxlQnJvd3NlcigpXG5cbiAgICAgICAgdmFyIGh0bWwgPSBbJzx0cj4nXTtcbiAgICAgICAgJC5lYWNoKHJlc3BvbnNlLmhlYWRlciwgZnVuY3Rpb24oaGVhZE5vLCBoZWFkKSB7XG4gICAgICAgICAgaHRtbC5wdXNoKCc8dGg+JyArIFV0aWwuZXNjYXBlSFRNTChoZWFkWzBdKSArICc8L3RoPicpO1xuICAgICAgICB9KTtcbiAgICAgICAgaHRtbC5wdXNoKCc8L3RyPicpO1xuICAgICAgICAkKCcjbm9ybV9zZWFyY2hfcmVzdWx0X3NlbGVjdCB0aGVhZCcpLmh0bWwoaHRtbC5qb2luKCcnKSk7XG5cbiAgICAgICAgaHRtbCA9IFtdO1xuICAgICAgICB2YXIgbGVuID0gcmVzcG9uc2UuaGVhZGVyLmxlbmd0aDtcbiAgICAgICAgJC5lYWNoKHJlc3BvbnNlLml0ZW1zLCBmdW5jdGlvbihpdGVtTm8sIGl0ZW0pIHtcbiAgICAgICAgICAvLyBOT1RFOiBhc3N1bWluZyBJRCBpcyBhbHdheXMgdGhlIGZpcnN0IGRhdHVtIGluIHRoZSBpdGVtXG4gICAgICAgICAgLy8gYW5kIHRoYXQgdGhlIHByZWZlcnJlZCB0ZXh0IGlzIGFsd2F5cyB0aGUgc2Vjb25kXG4gICAgICAgICAgLy8gVE9ETzogVXRpbC5lc2NhcGVRdW90ZXMgd291bGQgYmUgZXhwZWN0ZWQgdG8gYmVcbiAgICAgICAgICAvLyBzdWZmaWNpZW50IGhlcmUsIGJ1dCB0aGF0IGFwcGVhcnMgdG8gZ2l2ZSBcIkRPTSBFeGNlcHRpb25cbiAgICAgICAgICAvLyAxMVwiIGluIGNhc2VzICh0cnkgZS5nLiAkeC5odG1sKCc8cCBhPVwiQSZCXCIvPicpLiBXaHk/IElzXG4gICAgICAgICAgLy8gdGhpcyB3b3JrYXJvdW5kIE9LP1xuICAgICAgICAgIGh0bWwucHVzaCgnPHRyJytcbiAgICAgICAgICAgICAgICAgICAgJyBkYXRhLWlkPVwiJytVdGlsLmVzY2FwZUhUTUxhbmRRdW90ZXMoaXRlbVswXSkrJ1wiJytcbiAgICAgICAgICAgICAgICAgICAgJyBkYXRhLXR4dD1cIicrVXRpbC5lc2NhcGVIVE1MYW5kUXVvdGVzKGl0ZW1bMV0pKydcIicrXG4gICAgICAgICAgICAgICAgICAgICc+Jyk7XG4gICAgICAgICAgZm9yICh2YXIgaT0wOyBpPGxlbjsgaSsrKSB7XG4gICAgICAgICAgICBodG1sLnB1c2goJzx0ZD4nICsgVXRpbC5lc2NhcGVIVE1MKGl0ZW1baV0pICsgJzwvdGQ+Jyk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGh0bWwucHVzaCgnPC90cj4nKTtcbiAgICAgICAgfSk7XG4gICAgICAgICQoJyNub3JtX3NlYXJjaF9yZXN1bHRfc2VsZWN0IHRib2R5JykuaHRtbChodG1sLmpvaW4oJycpKTtcblxuICAgICAgICAkKCcjbm9ybV9zZWFyY2hfcmVzdWx0X3NlbGVjdCB0Ym9keScpLmZpbmQoJ3RyJykuXG4gICAgICAgICAgICBjbGljayhjaG9vc2VOb3JtSWQpLlxuICAgICAgICAgICAgZGJsY2xpY2soY2hvb3NlTm9ybUlkQW5kU3VibWl0KTtcblxuICAgICAgICAvLyBUT0RPOiBzb3J0aW5nIG9uIGNsaWNrIG9uIGhlYWRlciAoc2VlIHNob3dGaWxlQnJvd3NlcigpKVxuICAgICAgfVxuICAgICAgdmFyIHBlcmZvcm1Ob3JtU2VhcmNoID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIHZhciB2YWwgPSAkKCcjbm9ybV9zZWFyY2hfcXVlcnknKS52YWwoKTtcbiAgICAgICAgdmFyIGRiID0gJCgnI3NwYW5fbm9ybV9kYicpLnZhbCgpO1xuICAgICAgICBkaXNwYXRjaGVyLnBvc3QoJ2FqYXgnLCBbIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGFjdGlvbjogJ25vcm1TZWFyY2gnLFxuICAgICAgICAgICAgICAgICAgICAgICAgZGF0YWJhc2U6IGRiLFxuICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogdmFsLFxuICAgICAgICAgICAgICAgICAgICAgICAgY29sbGVjdGlvbjogY29sbH0sICdub3JtU2VhcmNoUmVzdWx0J10pO1xuICAgICAgfVxuICAgICAgJCgnI25vcm1fc2VhcmNoX2J1dHRvbicpLmNsaWNrKHBlcmZvcm1Ob3JtU2VhcmNoKTtcbiAgICAgICQoJyNub3JtX3NlYXJjaF9xdWVyeScpLmZvY3VzKGZ1bmN0aW9uKCkge1xuICAgICAgICBzZXROb3JtU2VhcmNoU3VibWl0KGZhbHNlKTtcbiAgICAgIH0pO1xuICAgICAgdmFyIHNob3dOb3JtU2VhcmNoRGlhbG9nID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIC8vIGlmIHdlIGFscmVhZHkgaGF2ZSBub24tZW1wdHkgSUQgYW5kIG5vcm1hbGl6ZWQgc3RyaW5nLFxuICAgICAgICAvLyB1c2UgdGhlc2UgYXMgZGVmYXVsdDsgb3RoZXJ3aXNlIHRha2UgZGVmYXVsdCBzZWFyY2ggc3RyaW5nXG4gICAgICAgIC8vIGZyb20gYW5ub3RhdGVkIHNwYW4gYW5kIGNsZWFyIElEIGVudHJ5XG4gICAgICAgIGlmICghJCgnI3NwYW5fbm9ybV9pZCcpLnZhbCgpLm1hdGNoKC9eXFxzKiQvKSAmJlxuICAgICAgICAgICAgISQoJyNzcGFuX25vcm1fdHh0JykudmFsKCkubWF0Y2goL15cXHMqJC8pKSB7XG4gICAgICAgICAgJCgnI25vcm1fc2VhcmNoX2lkJykudmFsKCQoJyNzcGFuX25vcm1faWQnKS52YWwoKSk7XG4gICAgICAgICAgJCgnI25vcm1fc2VhcmNoX3F1ZXJ5JykudmFsKCQoJyNzcGFuX25vcm1fdHh0JykudmFsKCkpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICQoJyNub3JtX3NlYXJjaF9pZCcpLnZhbCgnJyk7XG4gICAgICAgICAgJCgnI25vcm1fc2VhcmNoX3F1ZXJ5JykudmFsKCQoJyNzcGFuX3NlbGVjdGVkJykudGV4dCgpKTtcbiAgICAgICAgfVxuICAgICAgICAvLyBibGFuayB0aGUgdGFibGVcbiAgICAgICAgJCgnI25vcm1fc2VhcmNoX3Jlc3VsdF9zZWxlY3QgdGhlYWQnKS5lbXB0eSgpO1xuICAgICAgICAkKCcjbm9ybV9zZWFyY2hfcmVzdWx0X3NlbGVjdCB0Ym9keScpLmVtcHR5KCk7ICAgICAgICBcbiAgICAgICAgLy8gVE9ETzogc3VwcG9ydCBmb3IgdHdvIChvciBtb3JlKSBkaWFsb2dzIG9wZW4gYXQgdGhlIHNhbWUgdGltZVxuICAgICAgICAvLyBzbyB3ZSBkb24ndCBuZWVkIHRvIGhpZGUgdGhpcyBiZWZvcmUgc2hvd2luZyBub3JtU2VhcmNoRGlhbG9nXG4gICAgICAgIGRpc3BhdGNoZXIucG9zdCgnaGlkZUZvcm0nKTtcbiAgICAgICAgJCgnI25vcm1fc2VhcmNoX2J1dHRvbicpLnZhbCgnU2VhcmNoICcgKyAkKCcjc3Bhbl9ub3JtX2RiJykudmFsKCkpO1xuICAgICAgICBzZXROb3JtU2VhcmNoU3VibWl0KGZhbHNlKTtcbiAgICAgICAgZGlzcGF0Y2hlci5wb3N0KCdzaG93Rm9ybScsIFtub3JtU2VhcmNoRGlhbG9nXSk7XG4gICAgICAgICQoJyNub3JtX3NlYXJjaF9xdWVyeScpLmZvY3VzKCkuc2VsZWN0KCk7XG4gICAgICB9XG4gICAgICAkKCcjc3Bhbl9ub3JtX3R4dCcpLmNsaWNrKHNob3dOb3JtU2VhcmNoRGlhbG9nKTtcbiAgICAgICQoJyNub3JtX3NlYXJjaF9idXR0b24nKS5idXR0b24oKTtcblxuICAgICAgdmFyIGFyY0Zvcm1TdWJtaXRSYWRpbyA9IGZ1bmN0aW9uKGV2dCkge1xuICAgICAgICAvLyBUT0RPOiBjaGVjayBmb3IgY29uZmlybV9tb2RlP1xuICAgICAgICBhcmNGb3JtU3VibWl0KGV2dCwgJChldnQudGFyZ2V0KSk7XG4gICAgICB9XG5cbiAgICAgIHZhciBhcmNGb3JtU3VibWl0ID0gZnVuY3Rpb24oZXZ0LCB0eXBlUmFkaW8pIHtcbiAgICAgICAgdHlwZVJhZGlvID0gdHlwZVJhZGlvIHx8ICQoJyNhcmNfZm9ybSBpbnB1dDpyYWRpbzpjaGVja2VkJyk7XG4gICAgICAgIHZhciB0eXBlID0gdHlwZVJhZGlvLnZhbCgpO1xuICAgICAgICBkaXNwYXRjaGVyLnBvc3QoJ2hpZGVGb3JtJywgW2FyY0Zvcm1dKTtcblxuICAgICAgICBhcmNPcHRpb25zLnR5cGUgPSB0eXBlO1xuICAgICAgICBhcmNPcHRpb25zLmNvbW1lbnQgPSAkKCcjYXJjX25vdGVzJykudmFsKCk7XG4gICAgICAgIGRpc3BhdGNoZXIucG9zdCgnYWpheCcsIFthcmNPcHRpb25zLCAnZWRpdGVkJ10pO1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICB9O1xuXG4gICAgICB2YXIgZmlsbEFyY1R5cGVzQW5kRGlzcGxheUZvcm0gPSBmdW5jdGlvbihldnQsIG9yaWdpblR5cGUsIHRhcmdldFR5cGUsIGFyY1R5cGUsIGFyY0lkKSB7XG4gICAgICAgIHZhciBub0FyY3MgPSB0cnVlO1xuICAgICAgICBrZXltYXAgPSB7fTtcblxuICAgICAgICAvLyBzZXBhcmF0ZSBvdXQgcG9zc2libGUgbnVtZXJpYyBzdWZmaXggZnJvbSB0eXBlXG4gICAgICAgIHZhciBub051bUFyY1R5cGU7XG4gICAgICAgIGlmIChhcmNUeXBlKSB7XG4gICAgICAgICAgICB2YXIgc3BsaXRUeXBlID0gYXJjVHlwZS5tYXRjaCgvXiguKj8pKFxcZCopJC8pO1xuICAgICAgICAgICAgbm9OdW1BcmNUeXBlID0gc3BsaXRUeXBlWzFdO1xuICAgICAgICB9XG5cbiAgICAgICAgdmFyIGlzRXF1aXYgPVxuICAgICAgICAgIHJlbGF0aW9uVHlwZXNIYXNoICYmXG4gICAgICAgICAgcmVsYXRpb25UeXBlc0hhc2hbbm9OdW1BcmNUeXBlXSAmJlxuICAgICAgICAgIHJlbGF0aW9uVHlwZXNIYXNoW25vTnVtQXJjVHlwZV0ucHJvcGVydGllcyAmJlxuICAgICAgICAgIHJlbGF0aW9uVHlwZXNIYXNoW25vTnVtQXJjVHlwZV0ucHJvcGVydGllcy5zeW1tZXRyaWMgJiZcbiAgICAgICAgICByZWxhdGlvblR5cGVzSGFzaFtub051bUFyY1R5cGVdLnByb3BlcnRpZXMudHJhbnNpdGl2ZTtcblxuICAgICAgICB2YXIgJHNjcm9sbGVyID0gJCgpO1xuICAgICAgICBpZiAoc3BhblR5cGVzW29yaWdpblR5cGVdKSB7XG4gICAgICAgICAgdmFyIGFyY1R5cGVzID0gc3BhblR5cGVzW29yaWdpblR5cGVdLmFyY3M7XG4gICAgICAgICAgJHNjcm9sbGVyID0gJCgnI2FyY19yb2xlcyAuc2Nyb2xsZXInKS5lbXB0eSgpO1xuXG4gICAgICAgICAgLy8gbGF5IHRoZW0gb3V0IGludG8gdGhlIGZvcm1cbiAgICAgICAgICAkLmVhY2goYXJjVHlwZXMgfHwgW10sIGZ1bmN0aW9uKGFyY1R5cGVObywgYXJjRGVzYykge1xuICAgICAgICAgICAgaWYgKGFyY0Rlc2MudGFyZ2V0cyAmJiBhcmNEZXNjLnRhcmdldHMuaW5kZXhPZih0YXJnZXRUeXBlKSAhPSAtMSkge1xuICAgICAgICAgICAgICB2YXIgYXJjVHlwZU5hbWUgPSBhcmNEZXNjLnR5cGU7XG5cbiAgICAgICAgICAgICAgdmFyIGlzVGhpc0VxdWl2ID1cbiAgICAgICAgICAgICAgICByZWxhdGlvblR5cGVzSGFzaCAmJlxuICAgICAgICAgICAgICAgIHJlbGF0aW9uVHlwZXNIYXNoW2FyY1R5cGVOYW1lXSAmJlxuICAgICAgICAgICAgICAgIHJlbGF0aW9uVHlwZXNIYXNoW2FyY1R5cGVOYW1lXS5wcm9wZXJ0aWVzICYmXG4gICAgICAgICAgICAgICAgcmVsYXRpb25UeXBlc0hhc2hbYXJjVHlwZU5hbWVdLnByb3BlcnRpZXMuc3ltbWV0cmljICYmXG4gICAgICAgICAgICAgICAgcmVsYXRpb25UeXBlc0hhc2hbYXJjVHlwZU5hbWVdLnByb3BlcnRpZXMudHJhbnNpdGl2ZTtcblxuICAgICAgICAgICAgICAvLyBkbyBub3QgYWxsb3cgZXF1aXY8LT5ub24tZXF1aXYgY2hhbmdlIG9wdGlvbnNcbiAgICAgICAgICAgICAgaWYgKGFyY1R5cGUgJiYgaXNFcXVpdiAhPSBpc1RoaXNFcXVpdikgcmV0dXJuO1xuXG4gICAgICAgICAgICAgIHZhciBkaXNwbGF5TmFtZSA9ICgoYXJjRGVzYy5sYWJlbHMgJiYgYXJjRGVzYy5sYWJlbHNbMF0pIHx8IFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXJjVHlwZU5hbWUpO1xuICAgICAgICAgICAgICB2YXIgJGNoZWNrYm94ID0gJCgnPGlucHV0IGlkPVwiYXJjXycgKyBhcmNUeXBlTmFtZSArICdcIiB0eXBlPVwicmFkaW9cIiBuYW1lPVwiYXJjX3R5cGVcIiB2YWx1ZT1cIicgKyBhcmNUeXBlTmFtZSArICdcIi8+Jyk7XG4gICAgICAgICAgICAgIHZhciAkbGFiZWwgPSAkKCc8bGFiZWwgY2xhc3M9XCJhcmNfdHlwZV9sYWJlbFwiIGZvcj1cImFyY18nICsgYXJjVHlwZU5hbWUgKyAnXCIvPicpLnRleHQoZGlzcGxheU5hbWUpO1xuICAgICAgICAgICAgICB2YXIgJGRpdiA9ICQoJzxkaXYvPicpLmFwcGVuZCgkY2hlY2tib3gpLmFwcGVuZCgkbGFiZWwpO1xuICAgICAgICAgICAgICAkc2Nyb2xsZXIuYXBwZW5kKCRkaXYpO1xuICAgICAgICAgICAgICBpZiAoYXJjRGVzYy5ob3RrZXkpIHtcbiAgICAgICAgICAgICAgICBrZXltYXBbYXJjRGVzYy5ob3RrZXldID0gJyNhcmNfJyArIGFyY1R5cGVOYW1lO1xuICAgICAgICAgICAgICAgIHZhciBuYW1lID0gJGxhYmVsLmh0bWwoKTtcbiAgICAgICAgICAgICAgICB2YXIgcmVwbGFjZSA9IHRydWU7XG4gICAgICAgICAgICAgICAgbmFtZSA9IG5hbWUucmVwbGFjZShuZXcgUmVnRXhwKFwiKCZbXjtdKj8pPyhcIiArIGFyY0Rlc2MuaG90a2V5ICsgXCIpXCIsICdnaScpLFxuICAgICAgICAgICAgICAgICAgZnVuY3Rpb24oYWxsLCBlbnRpdHksIGxldHRlcikge1xuICAgICAgICAgICAgICAgICAgICBpZiAocmVwbGFjZSAmJiAhZW50aXR5KSB7XG4gICAgICAgICAgICAgICAgICAgICAgcmVwbGFjZSA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICAgIHZhciBob3RrZXkgPSBhcmNEZXNjLmhvdGtleS50b0xvd2VyQ2FzZSgpID09IGxldHRlclxuICAgICAgICAgICAgICAgICAgICAgICAgICA/IGFyY0Rlc2MuaG90a2V5LnRvTG93ZXJDYXNlKClcbiAgICAgICAgICAgICAgICAgICAgICAgICAgOiBhcmNEZXNjLmhvdGtleS50b1VwcGVyQ2FzZSgpO1xuICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAnPHNwYW4gY2xhc3M9XCJhY2Nlc3NrZXlcIj4nICsgVXRpbC5lc2NhcGVIVE1MKGhvdGtleSkgKyAnPC9zcGFuPic7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGFsbDtcbiAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICRsYWJlbC5odG1sKG5hbWUpO1xuICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgbm9BcmNzID0gZmFsc2U7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAobm9BcmNzKSB7XG4gICAgICAgICAgaWYgKGFyY0lkKSB7XG4gICAgICAgICAgICAvLyBsZXQgdGhlIHVzZXIgZGVsZXRlIG9yIHdoYXRldmVyLCBldmVuIG9uIGJhZCBjb25maWdcbiAgICAgICAgICAgIC8vIChub3RlIHRoYXQgd2hhdCdzIHNob3duIHRvIHRoZSB1c2VyIGlzIHcvbyBwb3NzaWJsZSBudW0gc3VmZml4KVxuICAgICAgICAgICAgdmFyICRjaGVja2JveCA9ICQoJzxpbnB1dCBpZD1cImFyY18nICsgYXJjVHlwZSArICdcIiB0eXBlPVwiaGlkZGVuXCIgbmFtZT1cImFyY190eXBlXCIgdmFsdWU9XCInICsgbm9OdW1BcmNUeXBlICsgJ1wiLz4nKTtcbiAgICAgICAgICAgICRzY3JvbGxlci5hcHBlbmQoJGNoZWNrYm94KTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgLy8gY2FuJ3QgbWFrZSBhIG5ldyBhcmNcbiAgICAgICAgICAgIGRpc3BhdGNoZXIucG9zdCgnbWVzc2FnZXMnLFxuICAgICAgICAgICAgICBbW1tcIk5vIGNob2ljZXMgZm9yIFwiICtcbiAgICAgICAgICAgICAgICAgVXRpbC5zcGFuRGlzcGxheUZvcm0oc3BhblR5cGVzLCBvcmlnaW5UeXBlKSArXG4gICAgICAgICAgICAgICAgIFwiIC0+IFwiICtcbiAgICAgICAgICAgICAgICAgVXRpbC5zcGFuRGlzcGxheUZvcm0oc3BhblR5cGVzLCB0YXJnZXRUeXBlKSxcbiAgICAgICAgICAgICAgICAgJ3dhcm5pbmcnXV1dKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICB2YXIgcmV2ZXJzYWxQb3NzaWJsZSA9IGZhbHNlO1xuICAgICAgICBpZiAoYXJjSWQpIHtcbiAgICAgICAgICAvLyBzb21ldGhpbmcgd2FzIHNlbGVjdGVkXG4gICAgICAgICAgdmFyIGZvY3VzID0gYXJjSWQgaW5zdGFuY2VvZiBBcnJheSA/IGFyY0lkIDogW2FyY0lkXTtcbiAgICAgICAgICB2YXIgaGFzaCA9IG5ldyBVUkxIYXNoKGNvbGwsIGRvYywgeyBmb2N1czogW2ZvY3VzXSB9KS5nZXRIYXNoKCk7XG4gICAgICAgICAgJCgnI2FyY19oaWdobGlnaHRfbGluaycpLmF0dHIoJ2hyZWYnLCBoYXNoKS5zaG93KCk7IC8vIFRPRE8gaW5jb3JyZWN0XG4gICAgICAgICAgdmFyIGVsID0gJCgnI2FyY18nICsgYXJjVHlwZSlbMF07XG4gICAgICAgICAgaWYgKGVsKSB7XG4gICAgICAgICAgICBlbC5jaGVja2VkID0gdHJ1ZTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAvLyB0cnkgdy9vIG51bWVyaWMgc3VmZml4XG4gICAgICAgICAgICAgIGVsID0gJCgnI2FyY18nICsgbm9OdW1BcmNUeXBlKVswXTtcbiAgICAgICAgICAgICAgaWYgKGVsKSB7XG4gICAgICAgICAgICAgICAgICBlbC5jaGVja2VkID0gdHJ1ZTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgIH1cblxuICAgICAgICAgICQoJyNhcmNfZm9ybV9yZXNlbGVjdCwgI2FyY19mb3JtX2RlbGV0ZScpLnNob3coKTtcbiAgICAgICAgICBrZXltYXBbJC51aS5rZXlDb2RlLkRFTEVURV0gPSAnYXJjX2Zvcm1fZGVsZXRlJztcbiAgICAgICAgICBrZXltYXBbJC51aS5rZXlDb2RlLklOU0VSVF0gPSAnYXJjX2Zvcm1fcmVzZWxlY3QnO1xuXG4gICAgICAgICAgdmFyIGJhY2tUYXJnZXRUeXBlID0gc3BhblR5cGVzW3RhcmdldFR5cGVdO1xuICAgICAgICAgIGlmIChiYWNrVGFyZ2V0VHlwZSkge1xuICAgICAgICAgICAgJC5lYWNoKGJhY2tUYXJnZXRUeXBlLmFyY3MgfHwgW10sIGZ1bmN0aW9uKGJhY2tBcmNUeXBlTm8sIGJhY2tBcmNEZXNjKSB7XG4gICAgICAgICAgICAgIGlmICgkLmluQXJyYXkob3JpZ2luVHlwZSwgYmFja0FyY0Rlc2MudGFyZ2V0cyB8fCBbXSkgIT0gLTEpIHtcbiAgICAgICAgICAgICAgICByZXZlcnNhbFBvc3NpYmxlID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7IC8vIHRlcm1pbmF0ZSB0aGUgbG9vcFxuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICBhcmNGb3JtLmRpYWxvZygnb3B0aW9uJywgeyB0aXRsZTogJ0VkaXQgQW5ub3RhdGlvbicgfSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgLy8gbmV3IGFyY1xuICAgICAgICAgICQoJyNhcmNfaGlnaGxpZ2h0X2xpbmsnKS5oaWRlKCk7XG4gICAgICAgICAgZWwgPSAkKCcjYXJjX2Zvcm0gaW5wdXQ6cmFkaW86Zmlyc3QnKVswXTtcbiAgICAgICAgICBpZiAoZWwpIHtcbiAgICAgICAgICAgIGVsLmNoZWNrZWQgPSB0cnVlO1xuICAgICAgICAgIH1cblxuICAgICAgICAgICQoJyNhcmNfZm9ybV9yZXNlbGVjdCwgI2FyY19mb3JtX2RlbGV0ZSwgI2FyY19mb3JtX3JldmVyc2UnKS5oaWRlKCk7XG5cbiAgICAgICAgICBhcmNGb3JtLmRpYWxvZygnb3B0aW9uJywgeyB0aXRsZTogJ05ldyBBbm5vdGF0aW9uJyB9KTtcbiAgICAgICAgfVxuICAgICAgICBpZiAocmV2ZXJzYWxQb3NzaWJsZSkge1xuICAgICAgICAgICQoJyNhcmNfZm9ybV9yZXZlcnNlJykuc2hvdygpO1xuICAgICAgICAgIGtleW1hcFsnUy0nICsgJC51aS5rZXlDb2RlLklOU0VSVF0gPSAnYXJjX2Zvcm1fcmV2ZXJzZSc7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgJCgnI2FyY19mb3JtX3JldmVyc2UnKS5oaWRlKCk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoIUNvbmZpZ3VyYXRpb24uY29uZmlybU1vZGVPbikge1xuICAgICAgICAgIGFyY0Zvcm0uZmluZCgnI2FyY19yb2xlcyBpbnB1dDpyYWRpbycpLmNsaWNrKGFyY0Zvcm1TdWJtaXRSYWRpbyk7XG4gICAgICAgIH1cblxuICAgICAgICB2YXIgYXJjQW5ub3RhdG9yTm90ZXM7XG4gICAgICAgIHZhciBpc0JpbmFyeVJlbGF0aW9uID0gYXJjSWQgJiYgIShhcmNJZCBpbnN0YW5jZW9mIEFycmF5KTtcbiAgICAgICAgaWYgKGlzQmluYXJ5UmVsYXRpb24pIHtcbiAgICAgICAgICAvLyBvbmx5IGZvciByZWxhdGlvbiBhcmNzXG4gICAgICAgICAgdmFyIGVkID0gZGF0YS5ldmVudERlc2NzW2FyY0lkXTtcbiAgICAgICAgICBhcmNBbm5vdGF0b3JOb3RlcyA9IGVkICYmIGVkLmFubm90YXRvck5vdGVzO1xuICAgICAgICB9XG4gICAgICAgIGlmIChhcmNBbm5vdGF0b3JOb3Rlcykge1xuICAgICAgICAgICQoJyNhcmNfbm90ZXMnKS52YWwoYXJjQW5ub3RhdG9yTm90ZXMpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICQoJyNhcmNfbm90ZXMnKS52YWwoJycpO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gZGlzYWJsZSBub3RlcyBmb3IgYXJjIHR5cGVzIHRoYXQgZG9uJ3Qgc3VwcG9ydCBzdG9yYWdlICgjOTQ1KVxuICAgICAgICBpZighaXNCaW5hcnlSZWxhdGlvbiB8fCBpc0VxdWl2KSB7XG4gICAgICAgICAgLy8gZGlzYWJsZSB0aGUgYWN0dWFsIGlucHV0XG4gICAgICAgICAgJCgnI2FyY19ub3RlcycpLmF0dHIoJ2Rpc2FibGVkJywgJ2Rpc2FibGVkJyk7XG4gICAgICAgICAgLy8gYWRkIHRvIGZpZWxkc2V0IGZvciBzdHlsZVxuICAgICAgICAgICQoJyNhcmNfbm90ZXNfZmllbGRzZXQnKS5hdHRyKCdkaXNhYmxlZCcsICdkaXNhYmxlZCcpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICQoJyNhcmNfbm90ZXMnKS5yZW1vdmVBdHRyKCdkaXNhYmxlZCcpXG4gICAgICAgICAgJCgnI2FyY19ub3Rlc19maWVsZHNldCcpLnJlbW92ZUF0dHIoJ2Rpc2FibGVkJylcbiAgICAgICAgfVxuXG4gICAgICAgIGRpc3BhdGNoZXIucG9zdCgnc2hvd0Zvcm0nLCBbYXJjRm9ybV0pO1xuICAgICAgICAkKCcjYXJjX2Zvcm0tb2snKS5mb2N1cygpO1xuICAgICAgICBhZGp1c3RUb0N1cnNvcihldnQsIGFyY0Zvcm0ucGFyZW50KCkpO1xuICAgICAgfTtcblxuICAgICAgdmFyIHJldmVyc2VBcmMgPSBmdW5jdGlvbihldnQpIHtcbiAgICAgICAgdmFyIGV2ZW50RGF0YUlkID0gJChldnQudGFyZ2V0KS5hdHRyKCdkYXRhLWFyYy1lZCcpO1xuICAgICAgICBkaXNwYXRjaGVyLnBvc3QoJ2hpZGVGb3JtJyk7XG4gICAgICAgIGFyY09wdGlvbnMuYWN0aW9uID0gJ3JldmVyc2VBcmMnO1xuICAgICAgICBkZWxldGUgYXJjT3B0aW9ucy5vbGRfdGFyZ2V0O1xuICAgICAgICBkZWxldGUgYXJjT3B0aW9ucy5vbGRfdHlwZTtcbiAgICAgICAgZGlzcGF0Y2hlci5wb3N0KCdhamF4JywgW2FyY09wdGlvbnMsICdlZGl0ZWQnXSk7XG4gICAgICB9O1xuXG4gICAgICB2YXIgZGVsZXRlQXJjID0gZnVuY3Rpb24oZXZ0KSB7XG4gICAgICAgIGlmIChDb25maWd1cmF0aW9uLmNvbmZpcm1Nb2RlT24gJiYgIWNvbmZpcm0oXCJBcmUgeW91IHN1cmUgeW91IHdhbnQgdG8gZGVsZXRlIHRoaXMgYW5ub3RhdGlvbj9cIikpIHtcbiAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgdmFyIGV2ZW50RGF0YUlkID0gJChldnQudGFyZ2V0KS5hdHRyKCdkYXRhLWFyYy1lZCcpO1xuICAgICAgICBkaXNwYXRjaGVyLnBvc3QoJ2hpZGVGb3JtJyk7XG4gICAgICAgIGFyY09wdGlvbnMuYWN0aW9uID0gJ2RlbGV0ZUFyYyc7XG4gICAgICAgIGRpc3BhdGNoZXIucG9zdCgnYWpheCcsIFthcmNPcHRpb25zLCAnZWRpdGVkJ10pO1xuICAgICAgfTtcblxuICAgICAgdmFyIHJlc2VsZWN0QXJjID0gZnVuY3Rpb24oZXZ0KSB7XG4gICAgICAgIGRpc3BhdGNoZXIucG9zdCgnaGlkZUZvcm0nKTtcbiAgICAgICAgc3ZnRWxlbWVudC5hZGRDbGFzcygncmVzZWxlY3QnKTtcbiAgICAgICAgJCgnZ1tkYXRhLWZyb209XCInICsgYXJjT3B0aW9ucy5vcmlnaW4gKyAnXCJdW2RhdGEtdG89XCInICsgYXJjT3B0aW9ucy50YXJnZXQgKyAnXCJdJykuYWRkQ2xhc3MoJ3Jlc2VsZWN0Jyk7XG4gICAgICAgIHN0YXJ0QXJjRHJhZyhhcmNPcHRpb25zLm9yaWdpbik7XG4gICAgICB9O1xuXG4gICAgICB2YXIgYXJjRm9ybSA9ICQoJyNhcmNfZm9ybScpO1xuICAgICAgZGlzcGF0Y2hlci5wb3N0KCdpbml0Rm9ybScsIFthcmNGb3JtLCB7XG4gICAgICAgICAgd2lkdGg6IDUwMCxcbiAgICAgICAgICBidXR0b25zOiBbe1xuICAgICAgICAgICAgICBpZDogJ2FyY19mb3JtX3JldmVyc2UnLFxuICAgICAgICAgICAgICB0ZXh0OiBcIlJldmVyc2VcIixcbiAgICAgICAgICAgICAgY2xpY2s6IHJldmVyc2VBcmNcbiAgICAgICAgICAgIH0sIHtcbiAgICAgICAgICAgICAgaWQ6ICdhcmNfZm9ybV9kZWxldGUnLFxuICAgICAgICAgICAgICB0ZXh0OiBcIkRlbGV0ZVwiLFxuICAgICAgICAgICAgICBjbGljazogZGVsZXRlQXJjXG4gICAgICAgICAgICB9LCB7XG4gICAgICAgICAgICAgIGlkOiAnYXJjX2Zvcm1fcmVzZWxlY3QnLFxuICAgICAgICAgICAgICB0ZXh0OiAnUmVzZWxlY3QnLFxuICAgICAgICAgICAgICBjbGljazogcmVzZWxlY3RBcmNcbiAgICAgICAgICAgIH1dLFxuICAgICAgICAgIGFsc29SZXNpemU6ICcjYXJjX3JvbGVzJyxcbiAgICAgICAgICBjbG9zZTogZnVuY3Rpb24oZXZ0KSB7XG4gICAgICAgICAgICBrZXltYXAgPSBudWxsO1xuICAgICAgICAgIH1cbiAgICAgICAgfV0pO1xuICAgICAgYXJjRm9ybS5zdWJtaXQoYXJjRm9ybVN1Ym1pdCk7XG4gICAgICAvLyBzZXQgYnV0dG9uIHRvb2x0aXBzIChAYW1hZGFubWF0aDogY2FuIHRoaXMgYmUgZG9uZSBpbiBpbml0PylcbiAgICAgICQoJyNhcmNfZm9ybV9yZXNlbGVjdCcpLmF0dHIoJ3RpdGxlJywgJ1JlLXNlbGVjdCB0aGUgYW5ub3RhdGlvbiB0aGlzIGNvbm5lY3RzIGludG8uJyk7XG4gICAgICAkKCcjYXJjX2Zvcm1fZGVsZXRlJykuYXR0cigndGl0bGUnLCAnRGVsZXRlIHRoaXMgYW5ub3RhdGlvbi4nKTtcblxuICAgICAgdmFyIHN0b3BBcmNEcmFnID0gZnVuY3Rpb24odGFyZ2V0KSB7XG4gICAgICAgIGlmIChhcmNEcmFnT3JpZ2luKSB7XG4gICAgICAgICAgaWYgKCF0YXJnZXQpIHtcbiAgICAgICAgICAgIHRhcmdldCA9ICQoJy5iYWRUYXJnZXQnKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgdGFyZ2V0LnJlbW92ZUNsYXNzKCdiYWRUYXJnZXQnKTtcbiAgICAgICAgICBhcmNEcmFnT3JpZ2luR3JvdXAucmVtb3ZlQ2xhc3MoJ2hpZ2hsaWdodCcpO1xuICAgICAgICAgIGlmICh0YXJnZXQpIHtcbiAgICAgICAgICAgIHRhcmdldC5wYXJlbnQoKS5yZW1vdmVDbGFzcygnaGlnaGxpZ2h0Jyk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGlmIChhcmNEcmFnQXJjKSB7XG4gICAgICAgICAgICBzdmcucmVtb3ZlKGFyY0RyYWdBcmMpO1xuICAgICAgICAgICAgYXJjRHJhZyA9IG51bGw7XG4gICAgICAgICAgfVxuICAgICAgICAgIGFyY0RyYWdPcmlnaW4gPSBudWxsO1xuICAgICAgICAgIGlmIChhcmNPcHRpb25zKSB7XG4gICAgICAgICAgICAgICQoJ2dbZGF0YS1mcm9tPVwiJyArIGFyY09wdGlvbnMub3JpZ2luICsgJ1wiXVtkYXRhLXRvPVwiJyArIGFyY09wdGlvbnMudGFyZ2V0ICsgJ1wiXScpLnJlbW92ZUNsYXNzKCdyZXNlbGVjdCcpO1xuICAgICAgICAgIH1cbiAgICAgICAgICBzdmdFbGVtZW50LnJlbW92ZUNsYXNzKCdyZXNlbGVjdCcpO1xuICAgICAgICB9XG4gICAgICAgIHN2Z0VsZW1lbnQucmVtb3ZlQ2xhc3MoJ3Vuc2VsZWN0YWJsZScpO1xuICAgICAgICAkKCcucmVzZWxlY3RUYXJnZXQnKS5yZW1vdmVDbGFzcygncmVzZWxlY3RUYXJnZXQnKTtcbiAgICAgIH07XG5cbiAgICAgIHZhciBvbk1vdXNlVXAgPSBmdW5jdGlvbihldnQpIHtcbiAgICAgICAgLy9SZW1vdmVkIGJ5IFJlbmF1ZCBvbiAyMDE2LTAzLTEwXG4gICAgICAgIC8vaWYgKHRoYXQudXNlciA9PT0gbnVsbCkgcmV0dXJuO1xuXG4gICAgICAgIHZhciB0YXJnZXQgPSAkKGV2dC50YXJnZXQpO1xuXG4gICAgICAgIC8vIHRocmVlIHRoaW5ncyB0aGF0IGFyZSBjbGlja2FibGUgaW4gU1ZHXG4gICAgICAgIHZhciB0YXJnZXRTcGFuSWQgPSB0YXJnZXQuZGF0YSgnc3Bhbi1pZCcpO1xuICAgICAgICB2YXIgdGFyZ2V0Q2h1bmtJZCA9IHRhcmdldC5kYXRhKCdjaHVuay1pZCcpO1xuICAgICAgICB2YXIgdGFyZ2V0QXJjUm9sZSA9IHRhcmdldC5kYXRhKCdhcmMtcm9sZScpO1xuICAgICAgICBpZiAoISh0YXJnZXRTcGFuSWQgIT09IHVuZGVmaW5lZCB8fCB0YXJnZXRDaHVua0lkICE9PSB1bmRlZmluZWQgfHwgdGFyZ2V0QXJjUm9sZSAhPT0gdW5kZWZpbmVkKSkge1xuICAgICAgICAgIC8vIG1pc2NsaWNrXG4gICAgICAgICAgY2xlYXJTZWxlY3Rpb24oKTtcbiAgICAgICAgICBzdG9wQXJjRHJhZyh0YXJnZXQpO1xuICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIGlzIGl0IGFyYyBkcmFnIGVuZD9cbiAgICAgICAgaWYgKGFyY0RyYWdPcmlnaW4pIHtcbiAgICAgICAgICB2YXIgb3JpZ2luID0gYXJjRHJhZ09yaWdpbjtcbiAgICAgICAgICB2YXIgdGFyZ2V0VmFsaWQgPSB0YXJnZXQuaGFzQ2xhc3MoJ3Jlc2VsZWN0VGFyZ2V0Jyk7XG4gICAgICAgICAgc3RvcEFyY0RyYWcodGFyZ2V0KTtcbiAgICAgICAgICBpZiAoKGlkID0gdGFyZ2V0LmF0dHIoJ2RhdGEtc3Bhbi1pZCcpKSAmJiBvcmlnaW4gIT0gaWQgJiYgdGFyZ2V0VmFsaWQpIHtcbiAgICAgICAgICAgIHZhciBvcmlnaW5TcGFuID0gZGF0YS5zcGFuc1tvcmlnaW5dO1xuICAgICAgICAgICAgdmFyIHRhcmdldFNwYW4gPSBkYXRhLnNwYW5zW2lkXTtcbiAgICAgICAgICAgIGlmIChhcmNPcHRpb25zICYmIGFyY09wdGlvbnMub2xkX3RhcmdldCkge1xuICAgICAgICAgICAgICBhcmNPcHRpb25zLnRhcmdldCA9IHRhcmdldFNwYW4uaWQ7XG4gICAgICAgICAgICAgIGRpc3BhdGNoZXIucG9zdCgnYWpheCcsIFthcmNPcHRpb25zLCAnZWRpdGVkJ10pO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgYXJjT3B0aW9ucyA9IHtcbiAgICAgICAgICAgICAgICBhY3Rpb246ICdjcmVhdGVBcmMnLFxuICAgICAgICAgICAgICAgIG9yaWdpbjogb3JpZ2luU3Bhbi5pZCxcbiAgICAgICAgICAgICAgICB0YXJnZXQ6IHRhcmdldFNwYW4uaWQsXG4gICAgICAgICAgICAgICAgY29sbGVjdGlvbjogY29sbCxcbiAgICAgICAgICAgICAgICAnZG9jdW1lbnQnOiBkb2NcbiAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgJCgnI2FyY19vcmlnaW4nKS50ZXh0KFV0aWwuc3BhbkRpc3BsYXlGb3JtKHNwYW5UeXBlcywgb3JpZ2luU3Bhbi50eXBlKSsnIChcIicrb3JpZ2luU3Bhbi50ZXh0KydcIiknKTtcbiAgICAgICAgICAgICAgJCgnI2FyY190YXJnZXQnKS50ZXh0KFV0aWwuc3BhbkRpc3BsYXlGb3JtKHNwYW5UeXBlcywgdGFyZ2V0U3Bhbi50eXBlKSsnIChcIicrdGFyZ2V0U3Bhbi50ZXh0KydcIiknKTtcbiAgICAgICAgICAgICAgZmlsbEFyY1R5cGVzQW5kRGlzcGxheUZvcm0oZXZ0LCBvcmlnaW5TcGFuLnR5cGUsIHRhcmdldFNwYW4udHlwZSk7XG4gICAgICAgICAgICAgIC8vIGZvciBwcmVjaXNlIHRpbWluZywgbG9nIGRpYWxvZyBkaXNwbGF5IHRvIHVzZXIuXG4gICAgICAgICAgICAgIGRpc3BhdGNoZXIucG9zdCgnbG9nQWN0aW9uJywgWydhcmNTZWxlY3RlZCddKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSBpZiAoIWV2dC5jdHJsS2V5KSB7XG4gICAgICAgICAgLy8gaWYgbm90LCB0aGVuIGlzIGl0IHNwYW4gc2VsZWN0aW9uPyAoY3RybCBrZXkgY2FuY2VscylcbiAgICAgICAgICB2YXIgc2VsID0gd2luZG93LmdldFNlbGVjdGlvbigpO1xuICAgICAgICAgIHZhciBjaHVua0luZGV4RnJvbSA9IHNlbC5hbmNob3JOb2RlICYmICQoc2VsLmFuY2hvck5vZGUucGFyZW50Tm9kZSkuYXR0cignZGF0YS1jaHVuay1pZCcpO1xuICAgICAgICAgIHZhciBjaHVua0luZGV4VG8gPSBzZWwuZm9jdXNOb2RlICYmICQoc2VsLmZvY3VzTm9kZS5wYXJlbnROb2RlKS5hdHRyKCdkYXRhLWNodW5rLWlkJyk7XG5cbiAgICAgICAgICAvLyBmYWxsYmFjayBmb3IgZmlyZWZveCAoYXQgbGVhc3QpOlxuICAgICAgICAgIC8vIGl0J3MgdW5jbGVhciB3aHksIGJ1dCBmb3IgZmlyZWZveCB0aGUgYW5jaG9yIGFuZCBmb2N1c1xuICAgICAgICAgIC8vIG5vZGUgcGFyZW50cyBhcmUgYWx3YXlzIHVuZGVmaW5lZCwgdGhlIHRoZSBhbmNob3IgYW5kXG4gICAgICAgICAgLy8gZm9jdXMgbm9kZXMgdGhlbXNlbHZlcyBkbyAob2Z0ZW4pIGhhdmUgdGhlIG5lY2Vzc2FyeVxuICAgICAgICAgIC8vIGNodW5rIElELiBIb3dldmVyLCBhbmNob3Igb2Zmc2V0cyBhcmUgYWxtb3N0IGFsd2F5c1xuICAgICAgICAgIC8vIHdyb25nLCBzbyB3ZSdsbCBqdXN0IG1ha2UgYSBndWVzcyBhdCB3aGF0IHRoZSB1c2VyIG1pZ2h0XG4gICAgICAgICAgLy8gYmUgaW50ZXJlc3RlZCBpbiB0YWdnaW5nIGluc3RlYWQgb2YgdXNpbmcgd2hhdCdzIGdpdmVuLlxuICAgICAgICAgIHZhciBhbmNob3JPZmZzZXQgPSBudWxsO1xuICAgICAgICAgIHZhciBmb2N1c09mZnNldCA9IG51bGw7XG4gICAgICAgICAgaWYgKGNodW5rSW5kZXhGcm9tID09PSB1bmRlZmluZWQgJiYgY2h1bmtJbmRleFRvID09PSB1bmRlZmluZWQgJiZcbiAgICAgICAgICAgICAgJChzZWwuYW5jaG9yTm9kZSkuYXR0cignZGF0YS1jaHVuay1pZCcpICYmXG4gICAgICAgICAgICAgICQoc2VsLmZvY3VzTm9kZSkuYXR0cignZGF0YS1jaHVuay1pZCcpKSB7XG4gICAgICAgICAgICAvLyBBLiBTY2VycmkgRmlyZUZveCBjaHVua1xuXG4gICAgICAgICAgICB2YXIgcmFuZ2UgPSBzZWwuZ2V0UmFuZ2VBdCgwKTtcbiAgICAgICAgICAgIHZhciBzdmdPZmZzZXQgPSAkKHN2Zy5fc3ZnKS5vZmZzZXQoKTtcbiAgICAgICAgICAgIHZhciBmbGlwID0gZmFsc2U7XG4gICAgICAgICAgICB2YXIgdHJpZXMgPSAwO1xuICAgICAgICAgICAgd2hpbGUgKHRyaWVzIDwgMikge1xuICAgICAgICAgICAgICB2YXIgc3AgPSBzdmcuX3N2Zy5jcmVhdGVTVkdQb2ludCgpO1xuICAgICAgICAgICAgICBzcC54ID0gKGZsaXAgPyBldnQucGFnZVggOiBkcmFnU3RhcnRlZEF0LnBhZ2VYKSAtIHN2Z09mZnNldC5sZWZ0O1xuICAgICAgICAgICAgICBzcC55ID0gKGZsaXAgPyBldnQucGFnZVkgOiBkcmFnU3RhcnRlZEF0LnBhZ2VZKSAtIChzdmdPZmZzZXQudG9wICsgOCk7XG4gICAgICAgICAgICAgIHZhciBzdGFydHNBdCA9IHJhbmdlLnN0YXJ0Q29udGFpbmVyO1xuICAgICAgICAgICAgICBhbmNob3JPZmZzZXQgPSBzdGFydHNBdC5nZXRDaGFyTnVtQXRQb3NpdGlvbihzcCk7XG4gICAgICAgICAgICAgIGNodW5rSW5kZXhGcm9tID0gc3RhcnRzQXQgJiYgJChzdGFydHNBdCkuYXR0cignZGF0YS1jaHVuay1pZCcpO1xuICAgICAgICAgICAgICBpZiAoYW5jaG9yT2Zmc2V0ICE9IC0xKSB7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgZmxpcCA9IHRydWU7XG4gICAgICAgICAgICAgIHRyaWVzKys7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBzcC54ID0gKGZsaXAgPyBkcmFnU3RhcnRlZEF0LnBhZ2VYIDogZXZ0LnBhZ2VYKSAtIHN2Z09mZnNldC5sZWZ0O1xuICAgICAgICAgICAgc3AueSA9IChmbGlwID8gZHJhZ1N0YXJ0ZWRBdC5wYWdlWSA6IGV2dC5wYWdlWSkgLSAoc3ZnT2Zmc2V0LnRvcCArIDgpO1xuICAgICAgICAgICAgdmFyIGVuZHNBdCA9IHJhbmdlLmVuZENvbnRhaW5lcjtcbiAgICAgICAgICAgIGZvY3VzT2Zmc2V0ID0gZW5kc0F0LmdldENoYXJOdW1BdFBvc2l0aW9uKHNwKTtcblxuICAgICAgICAgICAgaWYgKHJhbmdlLnN0YXJ0Q29udGFpbmVyID09IHJhbmdlLmVuZENvbnRhaW5lciAmJiBhbmNob3JPZmZzZXQgPiBmb2N1c09mZnNldCkge1xuICAgICAgICAgICAgICB2YXIgdCA9IGFuY2hvck9mZnNldDtcbiAgICAgICAgICAgICAgYW5jaG9yT2Zmc2V0ID0gZm9jdXNPZmZzZXQ7XG4gICAgICAgICAgICAgIGZvY3VzT2Zmc2V0ID0gdDtcbiAgICAgICAgICAgICAgZmxpcCA9IGZhbHNlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGZvY3VzT2Zmc2V0ICE9IC0xKSB7XG4gICAgICAgICAgICAgIGZvY3VzT2Zmc2V0Kys7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjaHVua0luZGV4VG8gPSBlbmRzQXQgJiYgJChlbmRzQXQpLmF0dHIoJ2RhdGEtY2h1bmstaWQnKTtcblxuICAgICAgICAgICAgLy9jb25zb2xlLmxvZygnZmFsbGJhY2sgZnJvbScsIGRhdGEuY2h1bmtzW2NodW5rSW5kZXhGcm9tXSwgYW5jaG9yT2Zmc2V0KTtcbiAgICAgICAgICAgIC8vY29uc29sZS5sb2coJ2ZhbGxiYWNrIHRvJywgZGF0YS5jaHVua3NbY2h1bmtJbmRleFRvXSwgZm9jdXNPZmZzZXQpO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAvLyBub3JtYWwgY2FzZSwgYXNzdW1lIHRoZSBleGFjdCBvZmZzZXRzIGFyZSB1c2FibGVcbiAgICAgICAgICAgIGFuY2hvck9mZnNldCA9IHNlbC5hbmNob3JPZmZzZXQ7XG4gICAgICAgICAgICBmb2N1c09mZnNldCA9IHNlbC5mb2N1c09mZnNldDtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICBpZiAoY2h1bmtJbmRleEZyb20gIT09IHVuZGVmaW5lZCAmJiBjaHVua0luZGV4VG8gIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgdmFyIGNodW5rRnJvbSA9IGRhdGEuY2h1bmtzW2NodW5rSW5kZXhGcm9tXTtcbiAgICAgICAgICAgIHZhciBjaHVua1RvID0gZGF0YS5jaHVua3NbY2h1bmtJbmRleFRvXTtcbiAgICAgICAgICAgIHZhciBzZWxlY3RlZEZyb20gPSBjaHVua0Zyb20uZnJvbSArIGFuY2hvck9mZnNldDtcbiAgICAgICAgICAgIHZhciBzZWxlY3RlZFRvID0gY2h1bmtUby5mcm9tICsgZm9jdXNPZmZzZXQ7XG4gICAgICAgICAgICBzZWwucmVtb3ZlQWxsUmFuZ2VzKCk7XG5cbiAgICAgICAgICAgIGlmIChzZWxlY3RlZEZyb20gPiBzZWxlY3RlZFRvKSB7XG4gICAgICAgICAgICAgIHZhciB0bXAgPSBzZWxlY3RlZEZyb207IHNlbGVjdGVkRnJvbSA9IHNlbGVjdGVkVG87IHNlbGVjdGVkVG8gPSB0bXA7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvLyB0cmltXG4gICAgICAgICAgICB3aGlsZSAoc2VsZWN0ZWRGcm9tIDwgc2VsZWN0ZWRUbyAmJiBcIiBcXG5cXHRcIi5pbmRleE9mKGRhdGEudGV4dC5zdWJzdHIoc2VsZWN0ZWRGcm9tLCAxKSkgIT09IC0xKSBzZWxlY3RlZEZyb20rKztcbiAgICAgICAgICAgIHdoaWxlIChzZWxlY3RlZEZyb20gPCBzZWxlY3RlZFRvICYmIFwiIFxcblxcdFwiLmluZGV4T2YoZGF0YS50ZXh0LnN1YnN0cihzZWxlY3RlZFRvIC0gMSwgMSkpICE9PSAtMSkgc2VsZWN0ZWRUby0tO1xuXG4gICAgICAgICAgICAvLyBzaGlmdCtjbGljayBhbGxvd3MgemVyby13aWR0aCBzcGFuc1xuICAgICAgICAgICAgaWYgKHNlbGVjdGVkRnJvbSA9PT0gc2VsZWN0ZWRUbyAmJiAhZXZ0LnNoaWZ0S2V5KSB7XG4gICAgICAgICAgICAgIC8vIHNpbXBsZSBjbGljayAoemVyby13aWR0aCBzcGFuKVxuICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHZhciBuZXdPZmZzZXQgPSBbc2VsZWN0ZWRGcm9tLCBzZWxlY3RlZFRvXTtcbiAgICAgICAgICAgIGlmIChyZXNlbGVjdGVkU3Bhbikge1xuICAgICAgICAgICAgICB2YXIgbmV3T2Zmc2V0cyA9IHJlc2VsZWN0ZWRTcGFuLm9mZnNldHMuc2xpY2UoMCk7IC8vIGNsb25lXG4gICAgICAgICAgICAgIHNwYW5PcHRpb25zLm9sZF9vZmZzZXRzID0gSlNPTi5zdHJpbmdpZnkocmVzZWxlY3RlZFNwYW4ub2Zmc2V0cyk7XG4gICAgICAgICAgICAgIGlmIChzZWxlY3RlZEZyYWdtZW50ICE9PSBudWxsKSB7XG4gICAgICAgICAgICAgICAgaWYgKHNlbGVjdGVkRnJhZ21lbnQgIT09IGZhbHNlKSB7XG4gICAgICAgICAgICAgICAgICBuZXdPZmZzZXRzLnNwbGljZShzZWxlY3RlZEZyYWdtZW50LCAxKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgbmV3T2Zmc2V0cy5wdXNoKG5ld09mZnNldCk7XG4gICAgICAgICAgICAgICAgbmV3T2Zmc2V0cy5zb3J0KFV0aWwuY21wQXJyYXlPbkZpcnN0RWxlbWVudCk7XG4gICAgICAgICAgICAgICAgc3Bhbk9wdGlvbnMub2Zmc2V0cyA9IG5ld09mZnNldHM7XG4gICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgc3Bhbk9wdGlvbnMub2Zmc2V0cyA9IFtuZXdPZmZzZXRdO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICBzcGFuT3B0aW9ucyA9IHtcbiAgICAgICAgICAgICAgICBhY3Rpb246ICdjcmVhdGVTcGFuJyxcbiAgICAgICAgICAgICAgICBvZmZzZXRzOiBbbmV3T2Zmc2V0XVxuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbi8qIEluIHJlbGF0aW9uIHRvICM3ODYsIHJlbW92ZWQgdGhlIGNyb3NzLXNlbnRlbmNlIGNoZWNraW5nIGNvZGVcbiAgICAgICAgICAgIHZhciBjcm9zc1NlbnRlbmNlID0gdHJ1ZTtcbiAgICAgICAgICAgICQuZWFjaChzb3VyY2VEYXRhLnNlbnRlbmNlX29mZnNldHMsIGZ1bmN0aW9uKHNlbnRObywgc3RhcnRFbmQpIHtcbiAgICAgICAgICAgICAgaWYgKHNlbGVjdGVkVG8gPD0gc3RhcnRFbmRbMV0pIHtcbiAgICAgICAgICAgICAgICAvLyB0aGlzIGlzIHRoZSBzZW50ZW5jZVxuXG4gICAgICAgICAgICAgICAgaWYgKHNlbGVjdGVkRnJvbSA+PSBzdGFydEVuZFswXSkge1xuICAgICAgICAgICAgICAgICAgY3Jvc3NTZW50ZW5jZSA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBpZiAoY3Jvc3NTZW50ZW5jZSkge1xuICAgICAgICAgICAgICAvLyBhdHRlbXB0IHRvIGFubm90YXRlIGFjcm9zcyBzZW50ZW5jZSBib3VuZGFyaWVzOyBub3Qgc3VwcG9ydGVkXG4gICAgICAgICAgICAgIGRpc3BhdGNoZXIucG9zdCgnbWVzc2FnZXMnLCBbW1snRXJyb3I6IGNhbm5vdCBhbm5vdGF0ZSBhY3Jvc3MgYSBzZW50ZW5jZSBicmVhaycsICdlcnJvciddXV0pO1xuICAgICAgICAgICAgICBpZiAocmVzZWxlY3RlZFNwYW4pIHtcbiAgICAgICAgICAgICAgICAkKHJlc2VsZWN0ZWRTcGFuLnJlY3QpLnJlbW92ZUNsYXNzKCdyZXNlbGVjdCcpO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIHJlc2VsZWN0ZWRTcGFuID0gbnVsbDtcbiAgICAgICAgICAgICAgc3ZnRWxlbWVudC5yZW1vdmVDbGFzcygncmVzZWxlY3QnKTtcbiAgICAgICAgICAgIH0gZWxzZVxuKi9cbiAgICAgICAgICAgIGlmICghQ29uZmlndXJhdGlvbi5yYXBpZE1vZGVPbiB8fCByZXNlbGVjdGVkU3BhbiAhPSBudWxsKSB7XG4gICAgICAgICAgICAgIC8vIG5vcm1hbCBzcGFuIHNlbGVjdCBpbiBzdGFuZGFyZCBhbm5vdGF0aW9uIG1vZGVcbiAgICAgICAgICAgICAgLy8gb3IgcmVzZWxlY3Q6IHNob3cgc2VsZWN0b3JcbiAgICAgICAgICAgICAgdmFyIHNwYW5UZXh0ID0gZGF0YS50ZXh0LnN1YnN0cmluZyhzZWxlY3RlZEZyb20sIHNlbGVjdGVkVG8pO1xuICAgICAgICAgICAgICBmaWxsU3BhblR5cGVzQW5kRGlzcGxheUZvcm0oZXZ0LCBzcGFuVGV4dCwgcmVzZWxlY3RlZFNwYW4pO1xuICAgICAgICAgICAgICAvLyBmb3IgcHJlY2lzZSB0aW1pbmcsIGxvZyBhbm5vdGF0aW9uIGRpc3BsYXkgdG8gdXNlci5cbiAgICAgICAgICAgICAgZGlzcGF0Y2hlci5wb3N0KCdsb2dBY3Rpb24nLCBbJ3NwYW5TZWxlY3RlZCddKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgIC8vIG5vcm1hbCBzcGFuIHNlbGVjdCBpbiByYXBpZCBhbm5vdGF0aW9uIG1vZGU6IGNhbGxcbiAgICAgICAgICAgICAgLy8gc2VydmVyIGZvciBzcGFuIHR5cGUgY2FuZGlkYXRlc1xuICAgICAgICAgICAgICB2YXIgc3BhblRleHQgPSBkYXRhLnRleHQuc3Vic3RyaW5nKHNlbGVjdGVkRnJvbSwgc2VsZWN0ZWRUbyk7XG4gICAgICAgICAgICAgIC8vIFRPRE86IHdlJ3JlIGN1cnJlbnRseSBzdG9yaW5nIHRoZSBldmVudCB0byBwb3NpdGlvbiB0aGVcbiAgICAgICAgICAgICAgLy8gc3BhbiBmb3JtIHVzaW5nIGFkanVzdFRvQ3Vyc29yKCkgKHdoaWNoIHRha2VzIGFuIGV2ZW50KSxcbiAgICAgICAgICAgICAgLy8gYnV0IHRoaXMgaXMgY2x1bXN5IGFuZCBzdWJvcHRpbWFsICh1c2VyIG1heSBoYXZlIHNjcm9sbGVkXG4gICAgICAgICAgICAgIC8vIGR1cmluZyB0aGUgYWpheCBpbnZvY2F0aW9uKTsgdGhpbmsgb2YgYSBiZXR0ZXIgd2F5LlxuICAgICAgICAgICAgICBsYXN0UmFwaWRBbm5vdGF0aW9uRXZlbnQgPSBldnQ7XG4gICAgICAgICAgICAgIGRpc3BhdGNoZXIucG9zdCgnYWpheCcsIFsgeyBcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFjdGlvbjogJ3N1Z2dlc3RTcGFuVHlwZXMnLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29sbGVjdGlvbjogY29sbCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdkb2N1bWVudCc6IGRvYyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YXJ0OiBzZWxlY3RlZEZyb20sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQ6IHNlbGVjdGVkVG8sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0ZXh0OiBzcGFuVGV4dCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1vZGVsOiAkKCcjcmFwaWRfbW9kZWwnKS52YWwoKSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sICdzdWdnZXN0ZWRTcGFuVHlwZXMnXSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9O1xuXG4gICAgICB2YXIgcmVjZWl2ZWRTdWdnZXN0ZWRTcGFuVHlwZXMgPSBmdW5jdGlvbihzdWdnKSB7XG4gICAgICAgIGlmIChzdWdnLmV4Y2VwdGlvbikge1xuICAgICAgICAgIC8vIGZhaWxlZCBpbiBvbmUgd2F5IG9yIGFub3RoZXI7IGFzc3VtZSByYXBpZCBtb2RlIGNhbm5vdCBiZVxuICAgICAgICAgIC8vIHVzZWQuXG4gICAgICAgICAgZGlzcGF0Y2hlci5wb3N0KCdtZXNzYWdlcycsIFtbWydSYXBpZCBhbm5vdGF0aW9uIG1vZGUgZXJyb3I7IHJldHVybmluZyB0byBub3JtYWwgbW9kZS4nLCAnd2FybmluZycsIC0xXV1dKTtcbiAgICAgICAgICBzZXRBbm5vdGF0aW9uU3BlZWQoMik7XG4gICAgICAgICAgZGlzcGF0Y2hlci5wb3N0KCdjb25maWd1cmF0aW9uVXBkYXRlZCcpO1xuICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIG1ha2Ugc3VyZSB0aGUgc3VnZ2VzdGlvbnMgYXJlIGZvciB0aGUgY3VycmVudCBjb2xsZWN0aW9uIGFuZCBkb2N1bWVudFxuICAgICAgICBpZiAoc3VnZy5jb2xsZWN0aW9uICE9IGNvbGwgfHwgc3VnZy5kb2N1bWVudCAhPSBkb2MpIHtcbiAgICAgICAgICBkaXNwYXRjaGVyLnBvc3QoJ21lc3NhZ2VzJywgW1tbJ0Vycm9yOiBjb2xsZWN0aW9uL2RvY3VtZW50IG1pc21hdGNoIGZvciBzcGFuIHN1Z2dlc3Rpb25zJywgJ2Vycm9yJ11dXSk7XG4gICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgICAgIC8vIGluaXRpYWxpemUgZm9yIHN1Ym1pc3Npb25cbiAgICAgICAgLy8gVE9ETzogaXMgdGhpcyBhIHJlYXNvbmFibGUgcGxhY2UgdG8gZG8gdGhpcz9cbiAgICAgICAgcmFwaWRTcGFuT3B0aW9ucyA9IHtcbiAgICAgICAgICBvZmZzZXRzOiBbW3N1Z2cuc3RhcnQsIHN1Z2cuZW5kXV0sXG4gICAgICAgIH07XG4gICAgICAgIHJhcGlkRmlsbFNwYW5UeXBlc0FuZERpc3BsYXlGb3JtKHN1Z2cuc3RhcnQsIHN1Z2cuZW5kLCBzdWdnLnRleHQsIHN1Z2cudHlwZXMpO1xuICAgICAgfTtcblxuICAgICAgdmFyIHRvZ2dsZUNvbGxhcHNpYmxlID0gZnVuY3Rpb24oJGVsLCBzdGF0ZSkge1xuICAgICAgICB2YXIgb3BlbmluZyA9IHN0YXRlICE9PSB1bmRlZmluZWQgPyBzdGF0ZSA6ICEkZWwuaGFzQ2xhc3MoJ29wZW4nKTtcbiAgICAgICAgdmFyICRjb2xsYXBzaWJsZSA9ICRlbC5wYXJlbnQoKS5maW5kKCcuY29sbGFwc2libGU6Zmlyc3QnKTtcbiAgICAgICAgaWYgKG9wZW5pbmcpIHtcbiAgICAgICAgICAkY29sbGFwc2libGUuYWRkQ2xhc3MoJ29wZW4nKTtcbiAgICAgICAgICAkZWwuYWRkQ2xhc3MoJ29wZW4nKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAkY29sbGFwc2libGUucmVtb3ZlQ2xhc3MoJ29wZW4nKTtcbiAgICAgICAgICAkZWwucmVtb3ZlQ2xhc3MoJ29wZW4nKTtcbiAgICAgICAgfVxuICAgICAgfTtcblxuICAgICAgdmFyIGNvbGxhcHNlSGFuZGxlciA9IGZ1bmN0aW9uKGV2dCkge1xuICAgICAgICB0b2dnbGVDb2xsYXBzaWJsZSgkKGV2dC50YXJnZXQpKTtcbiAgICAgIH1cblxuICAgICAgdmFyIHNwYW5Gb3JtU3VibWl0UmFkaW8gPSBmdW5jdGlvbihldnQpIHtcbiAgICAgICAgaWYgKENvbmZpZ3VyYXRpb24uY29uZmlybU1vZGVPbikge1xuICAgICAgICAgIHNob3dWYWxpZEF0dHJpYnV0ZXMoKTtcbiAgICAgICAgICBzaG93VmFsaWROb3JtYWxpemF0aW9ucygpO1xuICAgICAgICAgICQoJyNzcGFuX2Zvcm0tb2snKS5mb2N1cygpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHNwYW5Gb3JtU3VibWl0KGV2dCwgJChldnQudGFyZ2V0KSk7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgdmFyIHJhcGlkU3BhbkZvcm1TdWJtaXRSYWRpbyA9IGZ1bmN0aW9uKGV2dCkge1xuICAgICAgICByYXBpZFNwYW5Gb3JtU3VibWl0KGV2dCwgJChldnQudGFyZ2V0KSk7XG4gICAgICB9XG5cbiAgICAgIHZhciByZW1lbWJlckRhdGEgPSBmdW5jdGlvbihfZGF0YSkge1xuICAgICAgICBpZiAoX2RhdGEgJiYgIV9kYXRhLmV4Y2VwdGlvbikge1xuICAgICAgICAgIGRhdGEgPSBfZGF0YTtcbiAgICAgICAgfVxuICAgICAgfTtcblxuICAgICAgdmFyIGFkZFNwYW5UeXBlc1RvRGl2SW5uZXIgPSBmdW5jdGlvbigkcGFyZW50LCB0eXBlcywgY2F0ZWdvcnkpIHtcbiAgICAgICAgaWYgKCF0eXBlcykgcmV0dXJuO1xuXG4gICAgICAgICQuZWFjaCh0eXBlcywgZnVuY3Rpb24odHlwZU5vLCB0eXBlKSB7XG4gICAgICAgICAgaWYgKHR5cGUgPT09IG51bGwpIHtcbiAgICAgICAgICAgICRwYXJlbnQuYXBwZW5kKCc8aHIvPicpO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB2YXIgbmFtZSA9IHR5cGUubmFtZTtcbiAgICAgICAgICAgIHZhciAkaW5wdXQgPSAkKCc8aW5wdXQgdHlwZT1cInJhZGlvXCIgbmFtZT1cInNwYW5fdHlwZVwiLz4nKS5cbiAgICAgICAgICAgICAgYXR0cignaWQnLCAnc3Bhbl8nICsgdHlwZS50eXBlKS5cbiAgICAgICAgICAgICAgYXR0cigndmFsdWUnLCB0eXBlLnR5cGUpO1xuICAgICAgICAgICAgaWYgKGNhdGVnb3J5KSB7XG4gICAgICAgICAgICAgICRpbnB1dC5hdHRyKCdjYXRlZ29yeScsIGNhdGVnb3J5KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8vIHVzZSBhIGxpZ2h0IHZlcnNpb24gb2YgdGhlIHNwYW4gY29sb3IgYXMgQkdcbiAgICAgICAgICAgIHZhciBzcGFuQmdDb2xvciA9IHNwYW5UeXBlc1t0eXBlLnR5cGVdICYmIHNwYW5UeXBlc1t0eXBlLnR5cGVdLmJnQ29sb3IgfHwgJyNmZmZmZmYnO1xuICAgICAgICAgICAgc3BhbkJnQ29sb3IgPSBVdGlsLmFkanVzdENvbG9yTGlnaHRuZXNzKHNwYW5CZ0NvbG9yLCBzcGFuQm94VGV4dEJnQ29sb3JMaWdodGVuKTtcbiAgICAgICAgICAgIHZhciAkbGFiZWwgPSAkKCc8bGFiZWwgY2xhc3M9XCJzcGFuX3R5cGVfbGFiZWxcIi8+JykuXG4gICAgICAgICAgICAgIGF0dHIoJ2ZvcicsICdzcGFuXycgKyB0eXBlLnR5cGUpLlxuICAgICAgICAgICAgICB0ZXh0KG5hbWUpO1xuICAgICAgICAgICAgaWYgKHR5cGUudW51c2VkKSB7XG4gICAgICAgICAgICAgICRpbnB1dC5hdHRyKHtcbiAgICAgICAgICAgICAgICBkaXNhYmxlZDogJ2Rpc2FibGVkJyxcbiAgICAgICAgICAgICAgICB1bnVzZWQ6ICd1bnVzZWQnXG4gICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAkbGFiZWwuY3NzKCdmb250LXdlaWdodCcsICdib2xkJyk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAkbGFiZWwuY3NzKCdiYWNrZ3JvdW5kLWNvbG9yJywgc3BhbkJnQ29sb3IpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdmFyICRjb2xsYXBzaWJsZSA9ICQoJzxkaXYgY2xhc3M9XCJjb2xsYXBzaWJsZSBvcGVuXCIvPicpO1xuICAgICAgICAgICAgdmFyICRjb250ZW50ID0gJCgnPGRpdiBjbGFzcz1cIml0ZW1fY29udGVudFwiLz4nKS5cbiAgICAgICAgICAgICAgYXBwZW5kKCRpbnB1dCkuXG4gICAgICAgICAgICAgIGFwcGVuZCgkbGFiZWwpLlxuICAgICAgICAgICAgICBhcHBlbmQoJGNvbGxhcHNpYmxlKTtcbiAgICAgICAgICAgIHZhciAkY29sbGFwc2VyID0gJCgnPGRpdiBjbGFzcz1cImNvbGxhcHNlciBvcGVuXCIvPicpO1xuICAgICAgICAgICAgdmFyICRkaXYgPSAkKCc8ZGl2IGNsYXNzPVwiaXRlbVwiLz4nKTtcbiAgICAgICAgICAgIGlmICh0eXBlLmNoaWxkcmVuLmxlbmd0aCkge1xuICAgICAgICAgICAgICAkZGl2LmFwcGVuZCgkY29sbGFwc2VyKVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgJGRpdi5hcHBlbmQoJGNvbnRlbnQpO1xuICAgICAgICAgICAgYWRkU3BhblR5cGVzVG9EaXZJbm5lcigkY29sbGFwc2libGUsIHR5cGUuY2hpbGRyZW4sIGNhdGVnb3J5KTtcbiAgICAgICAgICAgICRwYXJlbnQuYXBwZW5kKCRkaXYpO1xuICAgICAgICAgICAgaWYgKHR5cGUuaG90a2V5KSB7XG4gICAgICAgICAgICAgIHNwYW5LZXltYXBbdHlwZS5ob3RrZXldID0gJ3NwYW5fJyArIHR5cGUudHlwZTtcbiAgICAgICAgICAgICAgdmFyIG5hbWUgPSAkbGFiZWwuaHRtbCgpO1xuICAgICAgICAgICAgICB2YXIgcmVwbGFjZSA9IHRydWU7XG4gICAgICAgICAgICAgIG5hbWUgPSBuYW1lLnJlcGxhY2UobmV3IFJlZ0V4cChcIigmW147XSo/KT8oXCIgKyB0eXBlLmhvdGtleSArIFwiKVwiLCAnZ2knKSxcbiAgICAgICAgICAgICAgICBmdW5jdGlvbihhbGwsIGVudGl0eSwgbGV0dGVyKSB7XG4gICAgICAgICAgICAgICAgICBpZiAocmVwbGFjZSAmJiAhZW50aXR5KSB7XG4gICAgICAgICAgICAgICAgICAgIHJlcGxhY2UgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGhvdGtleSA9IHR5cGUuaG90a2V5LnRvTG93ZXJDYXNlKCkgPT0gbGV0dGVyXG4gICAgICAgICAgICAgICAgICAgICAgICA/IHR5cGUuaG90a2V5LnRvTG93ZXJDYXNlKClcbiAgICAgICAgICAgICAgICAgICAgICAgIDogdHlwZS5ob3RrZXkudG9VcHBlckNhc2UoKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICc8c3BhbiBjbGFzcz1cImFjY2Vzc2tleVwiPicgKyBVdGlsLmVzY2FwZUhUTUwoaG90a2V5KSArICc8L3NwYW4+JztcbiAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgIHJldHVybiBhbGw7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICRsYWJlbC5odG1sKG5hbWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICB9O1xuICAgICAgdmFyIGFkZFNwYW5UeXBlc1RvRGl2ID0gZnVuY3Rpb24oJHRvcCwgdHlwZXMsIGhlYWRpbmcpIHtcbiAgICAgICAgJHNjcm9sbGVyID0gJCgnPGRpdiBjbGFzcz1cInNjcm9sbGVyXCIvPicpO1xuICAgICAgICAkbGVnZW5kID0gJCgnPGxlZ2VuZC8+JykudGV4dChoZWFkaW5nKTtcbiAgICAgICAgJGZpZWxkc2V0ID0gJCgnPGZpZWxkc2V0Lz4nKS5hcHBlbmQoJGxlZ2VuZCkuYXBwZW5kKCRzY3JvbGxlcik7XG4gICAgICAgICR0b3AuYXBwZW5kKCRmaWVsZHNldCk7XG4gICAgICAgIGFkZFNwYW5UeXBlc1RvRGl2SW5uZXIoJHNjcm9sbGVyLCB0eXBlcyk7XG4gICAgICB9O1xuICAgICAgdmFyIGFkZEF0dHJpYnV0ZVR5cGVzVG9EaXYgPSBmdW5jdGlvbigkdG9wLCB0eXBlcywgY2F0ZWdvcnkpIHtcbiAgICAgICAgJC5lYWNoKHR5cGVzLCBmdW5jdGlvbihhdHRyTm8sIGF0dHIpIHtcbiAgICAgICAgICB2YXIgZXNjYXBlZFR5cGUgPSBVdGlsLmVzY2FwZVF1b3RlcyhhdHRyLnR5cGUpO1xuICAgICAgICAgIHZhciBhdHRySWQgPSBjYXRlZ29yeSsnX2F0dHJfJytlc2NhcGVkVHlwZTtcbiAgICAgICAgICBpZiAoYXR0ci51bnVzZWQpIHtcbiAgICAgICAgICAgIHZhciAkaW5wdXQgPSAkKCc8aW5wdXQgdHlwZT1cImhpZGRlblwiIGlkPVwiJythdHRySWQrJ1wiIHZhbHVlPVwiXCIvPicpO1xuICAgICAgICAgICAgJHRvcC5hcHBlbmQoJGlucHV0KTtcbiAgICAgICAgICB9IGVsc2UgaWYgKGF0dHIuYm9vbCkge1xuICAgICAgICAgICAgdmFyIGVzY2FwZWROYW1lID0gVXRpbC5lc2NhcGVRdW90ZXMoYXR0ci5uYW1lKTtcbiAgICAgICAgICAgIHZhciAkaW5wdXQgPSAkKCc8aW5wdXQgdHlwZT1cImNoZWNrYm94XCIgaWQ9XCInK2F0dHJJZCtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICdcIiB2YWx1ZT1cIicgKyBlc2NhcGVkVHlwZSArIFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgJ1wiIGNhdGVnb3J5PVwiJyArIGNhdGVnb3J5ICsgJ1wiLz4nKTtcbiAgICAgICAgICAgIHZhciAkbGFiZWwgPSAkKCc8bGFiZWwgY2xhc3M9XCJhdHRyaWJ1dGVfdHlwZV9sYWJlbFwiIGZvcj1cIicrYXR0cklkK1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgJ1wiIGRhdGEtYmFyZT1cIicgKyBlc2NhcGVkTmFtZSArICdcIj4mI3gyNjEwOyAnICsgXG4gICAgICAgICAgICAgICAgICAgICAgICAgICBlc2NhcGVkTmFtZSArICc8L2xhYmVsPicpO1xuICAgICAgICAgICAgJHRvcC5hcHBlbmQoJGlucHV0KS5hcHBlbmQoJGxhYmVsKTtcbiAgICAgICAgICAgICRpbnB1dC5idXR0b24oKTtcbiAgICAgICAgICAgICRpbnB1dC5jaGFuZ2Uob25Cb29sZWFuQXR0ckNoYW5nZSk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHZhciAkZGl2ID0gJCgnPGRpdiBjbGFzcz1cInVpLWJ1dHRvbiB1aS1idXR0b24tdGV4dC1vbmx5IGF0dHJpYnV0ZV90eXBlX2xhYmVsXCIvPicpO1xuICAgICAgICAgICAgdmFyICRzZWxlY3QgPSAkKCc8c2VsZWN0IGlkPVwiJythdHRySWQrJ1wiIGNsYXNzPVwidWktd2lkZ2V0IHVpLXN0YXRlLWRlZmF1bHQgdWktYnV0dG9uLXRleHRcIiBjYXRlZ29yeT1cIicgKyBjYXRlZ29yeSArICdcIi8+Jyk7XG4gICAgICAgICAgICB2YXIgJG9wdGlvbiA9ICQoJzxvcHRpb24gY2xhc3M9XCJ1aS1zdGF0ZS1kZWZhdWx0XCIgdmFsdWU9XCJcIi8+JykudGV4dChhdHRyLm5hbWUgKyAnOiA/Jyk7XG4gICAgICAgICAgICAkc2VsZWN0LmFwcGVuZCgkb3B0aW9uKTtcbiAgICAgICAgICAgICQuZWFjaChhdHRyLnZhbHVlcywgZnVuY3Rpb24odmFsVHlwZSwgdmFsdWUpIHtcbiAgICAgICAgICAgICAgJG9wdGlvbiA9ICQoJzxvcHRpb24gY2xhc3M9XCJ1aS1zdGF0ZS1hY3RpdmVcIiB2YWx1ZT1cIicgKyBVdGlsLmVzY2FwZVF1b3Rlcyh2YWxUeXBlKSArICdcIi8+JykudGV4dChhdHRyLm5hbWUgKyAnOiAnICsgKHZhbHVlLm5hbWUgfHwgdmFsVHlwZSkpO1xuICAgICAgICAgICAgICAkc2VsZWN0LmFwcGVuZCgkb3B0aW9uKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgJGRpdi5hcHBlbmQoJHNlbGVjdCk7XG4gICAgICAgICAgICAkdG9wLmFwcGVuZCgkZGl2KTtcbiAgICAgICAgICAgICRzZWxlY3QuY2hhbmdlKG9uTXVsdGlBdHRyQ2hhbmdlKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgfVxuXG4gICAgICB2YXIgc2V0U3BhblR5cGVTZWxlY3RhYmlsaXR5ID0gZnVuY3Rpb24oY2F0ZWdvcnkpIHtcbiAgICAgICAgLy8gVE9ETzogdGhpcyBpbXBsZW1lbnRhdGlvbiBpcyBpbmNvbXBsZXRlOiB3ZSBzaG91bGQgaWRlYWxseVxuICAgICAgICAvLyBkaXNhYmxlIG5vdCBvbmx5IGNhdGVnb3JpZXMgb2YgdHlwZXMgKGV2ZW50cyBvciBlbnRpdGllcyksXG4gICAgICAgIC8vIGJ1dCB0aGUgc3BlY2lmaWMgc2V0IG9mIHR5cGVzIHRoYXQgYXJlIGluY29tcGF0aWJsZSB3aXRoXG4gICAgICAgIC8vIHRoZSBjdXJyZW50IGF0dHJpYnV0ZSBzZXR0aW5ncy5cbiAgICAgICAgXG4gICAgICAgIC8vIGp1c3QgYXNzdW1lIGFsbCBhdHRyaWJ1dGVzIGFyZSBldmVudCBhdHRyaWJ1dGVzXG4gICAgICAgIC8vIFRPRE86IHN1cHBvcnQgZm9yIGVudGl0eSBhdHRyaWJ1dGVzXG4gICAgICAgIC8vIFRPRE8yOiB0aGUgYWJvdmUgY29tbWVudCBpcyBhbG1vc3QgY2VydGFpbmx5IGZhbHNlLCBjaGVjayBhbmQgcmVtb3ZlXG4gICAgICAgICQoJyNzcGFuX2Zvcm0gaW5wdXQ6bm90KFt1bnVzZWRdKScpLnJlbW92ZUF0dHIoJ2Rpc2FibGVkJyk7XG4gICAgICAgIHZhciAkdG9EaXNhYmxlO1xuICAgICAgICBpZiAoY2F0ZWdvcnkgPT0gXCJldmVudFwiKSB7XG4gICAgICAgICAgJHRvRGlzYWJsZSA9ICQoJyNzcGFuX2Zvcm0gaW5wdXRbY2F0ZWdvcnk9XCJlbnRpdHlcIl0nKTtcbiAgICAgICAgfSBlbHNlIGlmIChjYXRlZ29yeSA9PSBcImVudGl0eVwiKSB7XG4gICAgICAgICAgJHRvRGlzYWJsZSA9ICQoJyNzcGFuX2Zvcm0gaW5wdXRbY2F0ZWdvcnk9XCJldmVudFwiXScpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ1VucmVjb2duaXplZCBhdHRyaWJ1dGUgY2F0ZWdvcnk6JywgY2F0ZWdvcnkpO1xuICAgICAgICAgICR0b0Rpc2FibGUgPSAkKCk7XG4gICAgICAgIH1cbiAgICAgICAgdmFyICRjaGVja2VkVG9EaXNhYmxlID0gJHRvRGlzYWJsZS5maWx0ZXIoJzpjaGVja2VkJyk7XG4gICAgICAgICR0b0Rpc2FibGUuYXR0cignZGlzYWJsZWQnLCB0cnVlKTtcbiAgICAgICAgLy8gdGhlIGRpc2FibGUgbWF5IGxlYXZlIHRoZSBkaWFsb2cgaW4gYSBzdGF0ZSB3aGVyZSBub3RoaW5nXG4gICAgICAgIC8vIGlzIGNoZWNrZWQsIHdoaWNoIHdvdWxkIGNhdXNlIGVycm9yIG9uIFwiT0tcIi4gSW4gdGhpcyBjYXNlLFxuICAgICAgICAvLyBjaGVjayB0aGUgZmlyc3QgdmFsaWQgY2hvaWNlLlxuICAgICAgICBpZiAoJGNoZWNrZWRUb0Rpc2FibGUubGVuZ3RoKSB7XG4gICAgICAgICAgdmFyICR0b0NoZWNrID0gJCgnI3NwYW5fZm9ybSBpbnB1dFtjYXRlZ29yeT1cIicgKyBjYXRlZ29yeSArICdcIl06Zmlyc3QnKTtcbiAgICAgICAgICAvLyBzbyB3ZWlyZCwgYXR0cignY2hlY2tlZCcsICdjaGVja2VkJykgZmFpbHMgc29tZXRpbWVzLCBzb1xuICAgICAgICAgIC8vIHJlcGxhY2VkIHdpdGggbW9yZSBcIm1ldGFsXCIgdmVyc2lvblxuICAgICAgICAgICR0b0NoZWNrWzBdLmNoZWNrZWQgPSB0cnVlXG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgdmFyIG9uTXVsdGlBdHRyQ2hhbmdlID0gZnVuY3Rpb24oZXZ0KSB7XG4gICAgICAgIGlmICgkKHRoaXMpLnZhbCgpID09ICcnKSB7XG4gICAgICAgICAgJCgnI3NwYW5fZm9ybSBpbnB1dDpub3QoW3VudXNlZF0pJykucmVtb3ZlQXR0cignZGlzYWJsZWQnKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICB2YXIgYXR0ckNhdGVnb3J5ID0gZXZ0LnRhcmdldC5nZXRBdHRyaWJ1dGUoJ2NhdGVnb3J5Jyk7XG4gICAgICAgICAgc2V0U3BhblR5cGVTZWxlY3RhYmlsaXR5KGF0dHJDYXRlZ29yeSk7XG4gICAgICAgICAgaWYgKGV2dC50YXJnZXQuc2VsZWN0ZWRJbmRleCkge1xuICAgICAgICAgICAgJChldnQudGFyZ2V0KS5hZGRDbGFzcygndWktc3RhdGUtYWN0aXZlJyk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICQoZXZ0LnRhcmdldCkucmVtb3ZlQ2xhc3MoJ3VpLXN0YXRlLWFjdGl2ZScpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICB2YXIgb25Cb29sZWFuQXR0ckNoYW5nZSA9IGZ1bmN0aW9uKGV2dCkge1xuICAgICAgICB2YXIgYXR0ckNhdGVnb3J5ID0gZXZ0LnRhcmdldC5nZXRBdHRyaWJ1dGUoJ2NhdGVnb3J5Jyk7XG4gICAgICAgIHNldFNwYW5UeXBlU2VsZWN0YWJpbGl0eShhdHRyQ2F0ZWdvcnkpO1xuICAgICAgICB1cGRhdGVDaGVja2JveCgkKGV2dC50YXJnZXQpKTtcbiAgICAgIH07XG5cbiAgICAgIHZhciByZW1lbWJlclNwYW5TZXR0aW5ncyA9IGZ1bmN0aW9uKHJlc3BvbnNlKSB7XG4gICAgICAgIHNwYW5LZXltYXAgPSB7fTtcblxuICAgICAgICAvLyBUT0RPOiBjaGVjayBmb3IgZXhjZXB0aW9ucyBpbiByZXNwb25zZVxuXG4gICAgICAgIC8vIGZpbGwgaW4gZW50aXR5IGFuZCBldmVudCB0eXBlc1xuICAgICAgICB2YXIgJGVudGl0eVNjcm9sbGVyID0gJCgnI2VudGl0eV90eXBlcyBkaXYuc2Nyb2xsZXInKS5lbXB0eSgpO1xuICAgICAgICBhZGRTcGFuVHlwZXNUb0RpdklubmVyKCRlbnRpdHlTY3JvbGxlciwgcmVzcG9uc2UuZW50aXR5X3R5cGVzLCAnZW50aXR5Jyk7XG4gICAgICAgIHZhciAkZXZlbnRTY3JvbGxlciA9ICQoJyNldmVudF90eXBlcyBkaXYuc2Nyb2xsZXInKS5lbXB0eSgpO1xuICAgICAgICBhZGRTcGFuVHlwZXNUb0RpdklubmVyKCRldmVudFNjcm9sbGVyLCByZXNwb25zZS5ldmVudF90eXBlcywgJ2V2ZW50Jyk7XG5cbiAgICAgICAgLy8gZmlsbCBpbiBhdHRyaWJ1dGVzXG4gICAgICAgIHZhciAkZW50YXR0cnMgPSAkKCcjZW50aXR5X2F0dHJpYnV0ZXMgZGl2LnNjcm9sbGVyJykuZW1wdHkoKTtcbiAgICAgICAgYWRkQXR0cmlidXRlVHlwZXNUb0RpdigkZW50YXR0cnMsIGVudGl0eUF0dHJpYnV0ZVR5cGVzLCAnZW50aXR5Jyk7XG5cbiAgICAgICAgdmFyICRldmVhdHRycyA9ICQoJyNldmVudF9hdHRyaWJ1dGVzIGRpdi5zY3JvbGxlcicpLmVtcHR5KCk7XG4gICAgICAgIGFkZEF0dHJpYnV0ZVR5cGVzVG9EaXYoJGV2ZWF0dHJzLCBldmVudEF0dHJpYnV0ZVR5cGVzLCAnZXZlbnQnKTtcblxuICAgICAgICAvLyBmaWxsIHNlYXJjaCBvcHRpb25zIGluIHNwYW4gZGlhbG9nXG4gICAgICAgIHNlYXJjaENvbmZpZyA9IHJlc3BvbnNlLnNlYXJjaF9jb25maWc7XG4gICAgICAgIHZhciAkc2VhcmNobGlua3MgID0gJCgnI3NwYW5fc2VhcmNoX2xpbmtzJykuZW1wdHkoKTtcbiAgICAgICAgdmFyICRzZWFyY2hsaW5rczIgPSAkKCcjdmlld3NwYW5fc2VhcmNoX2xpbmtzJykuZW1wdHkoKTtcbiAgICAgICAgdmFyIGZpcnN0TGluaz10cnVlO1xuICAgICAgICB2YXIgbGlua0ZpbGxlZD1mYWxzZTtcbiAgICAgICAgaWYgKHNlYXJjaENvbmZpZykge1xuICAgICAgICAgICQuZWFjaChzZWFyY2hDb25maWcsIGZ1bmN0aW9uKHNlYXJjaE5vLCBzZWFyY2gpIHtcbiAgICAgICAgICAgIGlmICghZmlyc3RMaW5rKSB7XG4gICAgICAgICAgICAgICRzZWFyY2hsaW5rcy5hcHBlbmQoJyxcXG4nKVxuICAgICAgICAgICAgICAkc2VhcmNobGlua3MyLmFwcGVuZCgnLFxcbicpXG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBmaXJzdExpbms9ZmFsc2U7XG4gICAgICAgICAgICAkc2VhcmNobGlua3MuYXBwZW5kKCc8YSB0YXJnZXQ9XCJfYmxhbmtcIiBpZD1cInNwYW5fJytzZWFyY2hbMF0rJ1wiIGhyZWY9XCIjXCI+JytzZWFyY2hbMF0rJzwvYT4nKTtcbiAgICAgICAgICAgICRzZWFyY2hsaW5rczIuYXBwZW5kKCc8YSB0YXJnZXQ9XCJfYmxhbmtcIiBpZD1cInZpZXdzcGFuXycrc2VhcmNoWzBdKydcIiBocmVmPVwiI1wiPicrc2VhcmNoWzBdKyc8L2E+Jyk7XG4gICAgICAgICAgICBsaW5rRmlsbGVkPXRydWU7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGxpbmtGaWxsZWQpIHtcbiAgICAgICAgICAkKCcjc3Bhbl9zZWFyY2hfZmllbGRzZXQnKS5zaG93KCk7XG4gICAgICAgICAgJCgnI3ZpZXdzcGFuX3NlYXJjaF9maWVsZHNldCcpLnNob3coKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAkKCcjc3Bhbl9zZWFyY2hfZmllbGRzZXQnKS5oaWRlKCk7XG4gICAgICAgICAgJCgnI3ZpZXdzcGFuX3NlYXJjaF9maWVsZHNldCcpLmhpZGUoKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHNwYW5Gb3JtLmZpbmQoJyNlbnRpdHlfdHlwZXMgaW5wdXQ6cmFkaW8nKS5jbGljayhzcGFuRm9ybVN1Ym1pdFJhZGlvKTtcbiAgICAgICAgc3BhbkZvcm0uZmluZCgnI2V2ZW50X3R5cGVzIGlucHV0OnJhZGlvJykuY2xpY2soc3BhbkZvcm1TdWJtaXRSYWRpbyk7XG4gICAgICAgIHNwYW5Gb3JtLmZpbmQoJy5jb2xsYXBzZXInKS5jbGljayhjb2xsYXBzZUhhbmRsZXIpO1xuICAgICAgfTtcblxuICAgICAgdmFyIHRhZ0N1cnJlbnREb2N1bWVudCA9IGZ1bmN0aW9uKHRhZ2dlcklkKSB7XG4gICAgICAgIHZhciB0YWdPcHRpb25zID0ge1xuICAgICAgICAgIGFjdGlvbjogJ3RhZycsXG4gICAgICAgICAgY29sbGVjdGlvbjogY29sbCxcbiAgICAgICAgICAnZG9jdW1lbnQnOiBkb2MsXG4gICAgICAgICAgdGFnZ2VyOiB0YWdnZXJJZCxcbiAgICAgICAgfTtcbiAgICAgICAgZGlzcGF0Y2hlci5wb3N0KCdhamF4JywgW3RhZ09wdGlvbnMsICdlZGl0ZWQnXSk7XG4gICAgICB9XG5cbiAgICAgIHZhciBzZXR1cFRhZ2dlclVJID0gZnVuY3Rpb24ocmVzcG9uc2UpIHtcbiAgICAgICAgdmFyIHRhZ2dlcnMgPSByZXNwb25zZS5uZXJfdGFnZ2VycyB8fCBbXTtcbiAgICAgICAgJHRhZ2dlckJ1dHRvbnMgPSAkKCcjdGFnZ2VyX2J1dHRvbnMnKS5lbXB0eSgpO1xuICAgICAgICAkLmVhY2godGFnZ2VycywgZnVuY3Rpb24odGFnZ2VyTm8sIHRhZ2dlcikge1xuICAgICAgICAgIC8vIGV4cGVjdCBhIHR1cGxlIHdpdGggSUQsIG5hbWUsIG1vZGVsLCBhbmQgVVJMXG4gICAgICAgICAgdmFyIHRhZ2dlcklkID0gdGFnZ2VyWzBdO1xuICAgICAgICAgIHZhciB0YWdnZXJOYW1lID0gdGFnZ2VyWzFdO1xuICAgICAgICAgIHZhciB0YWdnZXJNb2RlbCA9IHRhZ2dlclsyXTtcbiAgICAgICAgICBpZiAoIXRhZ2dlcklkIHx8ICF0YWdnZXJOYW1lIHx8ICF0YWdnZXJNb2RlbCkge1xuICAgICAgICAgICAgZGlzcGF0Y2hlci5wb3N0KCdtZXNzYWdlcycsIFtbWydJbnZhbGlkIHRhZ2dlciBzcGVjaWZpY2F0aW9uIHJlY2VpdmVkIGZyb20gc2VydmVyJywgJ2Vycm9yJ11dXSk7XG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTsgLy8gY29udGludWVcbiAgICAgICAgICB9XG4gICAgICAgICAgdmFyICRyb3cgPSAkKCc8ZGl2IGNsYXNzPVwib3B0aW9uUm93XCIvPicpO1xuICAgICAgICAgIHZhciAkbGFiZWwgPSAkKCc8c3BhbiBjbGFzcz1cIm9wdGlvbkxhYmVsXCI+JytVdGlsLmVzY2FwZUhUTUwodGFnZ2VyTmFtZSkrJzwvc3Bhbj4nKTtcbiAgICAgICAgICB2YXIgJGJ1dHRvbiA9ICQoJzxpbnB1dCBpZD1cInRhZ18nK1V0aWwuZXNjYXBlSFRNTCh0YWdnZXJJZCkrJ19idXR0b25cIiB0eXBlPVwiYnV0dG9uXCIgdmFsdWU9XCInK1V0aWwuZXNjYXBlSFRNTCh0YWdnZXJNb2RlbCkrJ1wiIHRhYmluZGV4PVwiLTFcIiB0aXRsZT1cIkF1dG9tYXRpY2FsbHkgdGFnIHRoZSBjdXJyZW50IGRvY3VtZW50LlwiLz4nKTtcbiAgICAgICAgICAkcm93LmFwcGVuZCgkbGFiZWwpLmFwcGVuZCgkYnV0dG9uKTtcbiAgICAgICAgICAkdGFnZ2VyQnV0dG9ucy5hcHBlbmQoJHJvdyk7XG4gICAgICAgICAgJGJ1dHRvbi5jbGljayhmdW5jdGlvbihldnQpIHtcbiAgICAgICAgICAgIHRhZ0N1cnJlbnREb2N1bWVudCh0YWdnZXJJZCk7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgICAgICAkdGFnZ2VyQnV0dG9ucy5maW5kKCdpbnB1dCcpLmJ1dHRvbigpO1xuICAgICAgICAvLyBpZiBub3RoaW5nIHdhcyBzZXQgdXAsIGhpZGUgdGhlIHdob2xlIGZpZWxkc2V0IGFuZCBzaG93XG4gICAgICAgIC8vIGEgbWVzc2FnZSB0byB0aGlzIGVmZmVjdCwgZWxzZSB0aGUgb3RoZXIgd2F5IGFyb3VuZFxuICAgICAgICBpZiAoJHRhZ2dlckJ1dHRvbnMuZmluZCgnaW5wdXQnKS5sZW5ndGggPT0gMCkge1xuICAgICAgICAgICQoJyNhdXRvX3RhZ2dpbmdfZmllbGRzZXQnKS5oaWRlKCk7XG4gICAgICAgICAgJCgnI25vX3RhZ2dlcl9tZXNzYWdlJykuc2hvdygpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICQoJyNhdXRvX3RhZ2dpbmdfZmllbGRzZXQnKS5zaG93KCk7XG4gICAgICAgICAgJCgnI25vX3RhZ2dlcl9tZXNzYWdlJykuaGlkZSgpO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIC8vIHJlY3Vyc2l2ZWx5IHRyYXZlcnNlcyB0eXBlIGhpZXJhcmNoeSAoZW50aXR5X3R5cGVzIG9yXG4gICAgICAvLyBldmVudF90eXBlcykgYW5kIHN0b3JlcyBub3JtYWxpemF0aW9ucyBpbiBub3JtRGJzQnlUeXBlLlxuICAgICAgdmFyIHJlbWVtYmVyTm9ybURic0ZvclR5cGUgPSBmdW5jdGlvbih0eXBlcykge1xuICAgICAgICBpZiAoIXR5cGVzKSByZXR1cm47XG5cbiAgICAgICAgJC5lYWNoKHR5cGVzLCBmdW5jdGlvbih0eXBlTm8sIHR5cGUpIHtcbiAgICAgICAgICBpZiAodHlwZSA9PT0gbnVsbCkge1xuICAgICAgICAgICAgLy8gc3BhY2VyLCBuby1vcFxuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBub3JtRGJzQnlUeXBlW3R5cGUudHlwZV0gPSB0eXBlLm5vcm1hbGl6YXRpb25zIHx8IFtdO1xuICAgICAgICAgICAgaWYgKHR5cGUuY2hpbGRyZW4ubGVuZ3RoKSB7XG4gICAgICAgICAgICAgIHJlbWVtYmVyTm9ybURic0ZvclR5cGUodHlwZS5jaGlsZHJlbik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgIH07XG5cbiAgICAgIHZhciBzZXR1cE5vcm1hbGl6YXRpb25VSSA9IGZ1bmN0aW9uKHJlc3BvbnNlKSB7XG4gICAgICAgIHZhciBub3JtX3Jlc291cmNlcyA9IHJlc3BvbnNlLm5vcm1hbGl6YXRpb25fY29uZmlnIHx8IFtdO1xuICAgICAgICB2YXIgJG5vcm1fc2VsZWN0ID0gJCgnI3NwYW5fbm9ybV9kYicpO1xuICAgICAgICAvLyBjbGVhciBwb3NzaWJsZSBleGlzdGluZ1xuICAgICAgICAkbm9ybV9zZWxlY3QuZW1wdHkoKTtcbiAgICAgICAgLy8gZmlsbCBpbiBuZXdcbiAgICAgICAgaHRtbCA9IFtdO1xuICAgICAgICAkLmVhY2gobm9ybV9yZXNvdXJjZXMsIGZ1bmN0aW9uKG5vcm1Obywgbm9ybSkge1xuICAgICAgICAgIHZhciBub3JtTmFtZSA9IG5vcm1bMF0sIG5vcm1VcmwgPSBub3JtWzFdLCBub3JtVXJsQmFzZSA9IG5vcm1bMl07XG4gICAgICAgICAgdmFyIHNlcnZlckRiID0gbm9ybVszXTtcbiAgICAgICAgICBodG1sLnB1c2goJzxvcHRpb24gdmFsdWU9XCInK1V0aWwuZXNjYXBlSFRNTChub3JtTmFtZSkrJ1wiPicrXG4gICAgICAgICAgICAgICAgICAgIFV0aWwuZXNjYXBlSFRNTChub3JtTmFtZSkrJzwvb3B0aW9uPicpO1xuICAgICAgICAgIC8vIHJlbWVtYmVyIHRoZSB1cmxzIGZvciB1cGRhdGVzXG4gICAgICAgICAgbm9ybURiVXJsQnlEYk5hbWVbbm9ybU5hbWVdID0gbm9ybVVybDtcbiAgICAgICAgICBub3JtRGJVcmxCYXNlQnlEYk5hbWVbbm9ybU5hbWVdID0gbm9ybVVybEJhc2U7XG4gICAgICAgIH0pO1xuICAgICAgICAvLyByZW1lbWJlciBwZXItdHlwZSBhcHByb3ByaWF0ZSBEQnNcbiAgICAgICAgbm9ybURic0J5VHlwZSA9IHt9O1xuICAgICAgICByZW1lbWJlck5vcm1EYnNGb3JUeXBlKHJlc3BvbnNlLmVudGl0eV90eXBlcyk7XG4gICAgICAgIHJlbWVtYmVyTm9ybURic0ZvclR5cGUocmVzcG9uc2UuZXZlbnRfdHlwZXMpO1xuICAgICAgICAvLyBzZXQgdXAgSFRNTFxuICAgICAgICAkbm9ybV9zZWxlY3QuaHRtbChodG1sLmpvaW4oJycpKTtcbiAgICAgICAgLy8gaWYgd2UgaGF2ZSBub3RoaW5nLCBqdXN0IGhpZGUgdGhlIHdob2xlIHRoaW5nXG4gICAgICAgIGlmICghbm9ybV9yZXNvdXJjZXMubGVuZ3RoKSB7XG4gICAgICAgICAgJCgnI25vcm1fZmllbGRzZXQnKS5oaWRlKCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgJCgnI25vcm1fZmllbGRzZXQnKS5zaG93KCk7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgLy8gaGlkZXMgdGhlIHJlZmVyZW5jZSBsaW5rIGluIHRoZSBub3JtYWxpemF0aW9uIFVJXG4gICAgICB2YXIgaGlkZU5vcm1hbGl6YXRpb25SZWZMaW5rID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICQoJyNzcGFuX25vcm1fcmVmX2xpbmsnKS5oaWRlKCk7XG4gICAgICB9XG5cbiAgICAgIC8vIHVwZGF0ZXMgdGhlIHJlZmVyZW5jZSBsaW5rIGluIHRoZSBub3JtYWxpemF0aW9uIFVJIGFjY29yZGluZ1xuICAgICAgLy8gdG8gdGhlIGN1cnJlbnQgdmFsdWUgb2YgdGhlIG5vcm1hbGl6YXRpb24gREIgYW5kIElELlxuICAgICAgdmFyIHVwZGF0ZU5vcm1hbGl6YXRpb25SZWZMaW5rID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIHZhciAkbm9ybUlkID0gJCgnI3NwYW5fbm9ybV9pZCcpO1xuICAgICAgICB2YXIgJG5vcm1MaW5rID0gJCgnI3NwYW5fbm9ybV9yZWZfbGluaycpO1xuICAgICAgICB2YXIgbm9ybUlkID0gJG5vcm1JZC52YWwoKTtcbiAgICAgICAgdmFyICRub3JtRGIgPSAkKCcjc3Bhbl9ub3JtX2RiJyk7XG4gICAgICAgIHZhciBub3JtRGIgPSAkbm9ybURiLnZhbCgpO1xuICAgICAgICBpZiAoIW5vcm1JZCB8fCAhbm9ybURiIHx8IG5vcm1JZC5tYXRjaCgvXlxccyokLykpIHtcbiAgICAgICAgICAkbm9ybUxpbmsuaGlkZSgpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHZhciBiYXNlID0gbm9ybURiVXJsQmFzZUJ5RGJOYW1lW25vcm1EYl07XG4gICAgICAgICAgLy8gYXNzdW1lIGhpZGRlbiB1bmxlc3MgZXZlcnl0aGluZyBnb2VzIHRocm91Z2hcbiAgICAgICAgICAkbm9ybUxpbmsuaGlkZSgpO1xuICAgICAgICAgIGlmICghYmFzZSkge1xuICAgICAgICAgICAgLy8gYmFzZSBVUkwgaXMgbm93IG9wdGlvbmFsLCBqdXN0IHNraXAgbGluayBnZW5lcmF0aW9uIGlmIG5vdCBzZXRcbiAgICAgICAgICAgIDtcbiAgICAgICAgICB9IGVsc2UgaWYgKGJhc2UuaW5kZXhPZignJXMnKSA9PSAtMSkge1xuICAgICAgICAgICAgZGlzcGF0Y2hlci5wb3N0KCdtZXNzYWdlcycsIFtbWydCYXNlIFVSTCBcIicrYmFzZSsnXCIgZm9yICcrbm9ybURiKycgZG9lcyBub3QgY29udGFpbiBcIiVzXCInLCAnZXJyb3InXV1dKTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgLy8gVE9ETzogcHJvdGVjdCBhZ2FpbnN0IHN0cmFuZ2UgY2hhcnMgaW4gSURcbiAgICAgICAgICAgIGxpbmsgPSBiYXNlLnJlcGxhY2UoJyVzJywgbm9ybUlkKTtcbiAgICAgICAgICAgICRub3JtTGluay5hdHRyKCdocmVmJywgbGluayk7XG4gICAgICAgICAgICAkbm9ybUxpbmsuc2hvdygpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICAvLyB1cGRhdGVzIHRoZSBEQiBzZWFyY2ggbGluayBpbiB0aGUgbm9ybWFsaXphdGlvbiBVSSBhY2NvcmRpbmdcbiAgICAgIC8vIHRvIHRoZSBjdXJyZW50IHZhbHVlIG9mIHRoZSBub3JtYWxpemF0aW9uIERCLlxuICAgICAgdmFyIHVwZGF0ZU5vcm1hbGl6YXRpb25EYkxpbmsgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgdmFyICRkYkxpbmsgPSAkKCcjc3Bhbl9ub3JtX2RiX2xpbmsnKTtcbiAgICAgICAgdmFyICRub3JtRGIgPSAkKCcjc3Bhbl9ub3JtX2RiJyk7XG4gICAgICAgIHZhciBub3JtRGIgPSAkbm9ybURiLnZhbCgpO1xuICAgICAgICBpZiAoIW5vcm1EYikgcmV0dXJuOyAvLyBubyBub3JtYWxpc2F0aW9uIGNvbmZpZ3VyZWRcbiAgICAgICAgdmFyIGxpbmsgPSBub3JtRGJVcmxCeURiTmFtZVtub3JtRGJdO1xuICAgICAgICBpZiAoIWxpbmsgfHwgbGluay5tYXRjaCgvXlxccyokLykpIHtcbiAgICAgICAgICBkaXNwYXRjaGVyLnBvc3QoJ21lc3NhZ2VzJywgW1tbJ05vIFVSTCBmb3IgJytub3JtRGIsICdlcnJvciddXV0pO1xuICAgICAgICAgICRkYkxpbmsuaGlkZSgpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIC8vIFRPRE86IHByb3RlY3QgYWdhaW5zdCB3ZWlyZG5lc3MgaW4gREIgbGlua1xuICAgICAgICAgICRkYkxpbmsuYXR0cignaHJlZicsIGxpbmspO1xuICAgICAgICAgICRkYkxpbmsuc2hvdygpO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIC8vIHJlc2V0cyB1c2VyLXNldHRhYmxlIG5vcm1hbGl6YXRpb24tcmVsYXRlZCBVSSBlbGVtZW50cyB0byBhXG4gICAgICAvLyBibGFuayBzdGF0ZSAoZG9lcyBub3QgYmxhbmsgI3NwYW5fbm9ybV9kYiA8c2VsZWN0PikuXG4gICAgICB2YXIgY2xlYXJOb3JtYWxpemF0aW9uVUkgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgdmFyICRub3JtSWQgPSAkKCcjc3Bhbl9ub3JtX2lkJyk7XG4gICAgICAgIHZhciAkbm9ybVRleHQgPSAkKCcjc3Bhbl9ub3JtX3R4dCcpO1xuICAgICAgICAkbm9ybUlkLnZhbCgnJyk7XG4gICAgICAgIG9sZFNwYW5Ob3JtSWRWYWx1ZSA9ICcnO1xuICAgICAgICAkbm9ybUlkLnJlbW92ZUNsYXNzKCd2YWxpZF92YWx1ZScpLnJlbW92ZUNsYXNzKCdpbnZhbGlkX3ZhbHVlJyk7XG4gICAgICAgICRub3JtVGV4dC52YWwoJycpO1xuICAgICAgICB1cGRhdGVOb3JtYWxpemF0aW9uUmVmTGluaygpO1xuICAgICAgfVxuXG4gICAgICAvLyByZXR1cm5zIHRoZSBub3JtYWxpemF0aW9ucyBjdXJyZW50bHkgZmlsbGVkIGluIHRoZSBzcGFuXG4gICAgICAvLyBkaWFsb2csIG9yIGVtcHR5IGxpc3QgaWYgdGhlcmUgYXJlIG5vbmVcbiAgICAgIHZhciBzcGFuTm9ybWFsaXphdGlvbnMgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgLy8gTm90ZSB0aGF0IG9ubHkgbm8gb3Igb25lIG5vcm1hbGl6YXRpb24gaXMgc3VwcG9ydGVkIGluIHRoZVxuICAgICAgICAvLyBVSSBhdCB0aGUgbW9tZW50LlxuICAgICAgICB2YXIgbm9ybWFsaXphdGlvbnMgPSBbXTtcbiAgICAgICAgdmFyIG5vcm1EYiA9ICQoJyNzcGFuX25vcm1fZGInKS52YWwoKTtcbiAgICAgICAgdmFyIG5vcm1JZCA9ICQoJyNzcGFuX25vcm1faWQnKS52YWwoKTtcbiAgICAgICAgdmFyIG5vcm1UZXh0ID0gJCgnI3NwYW5fbm9ybV90eHQnKS52YWwoKTtcbiAgICAgICAgLy8gZW1wdHkgSUQgLT4gbm8gbm9ybWFsaXphdGlvblxuICAgICAgICBpZiAoIW5vcm1JZC5tYXRjaCgvXlxccyokLykpIHtcbiAgICAgICAgICBub3JtYWxpemF0aW9ucy5wdXNoKFtub3JtRGIsIG5vcm1JZCwgbm9ybVRleHRdKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gbm9ybWFsaXphdGlvbnM7XG4gICAgICB9XG5cbiAgICAgIC8vIHJldHVybnMgYXR0cmlidXRlcyB0aGF0IGFyZSB2YWxpZCBmb3IgdGhlIHNlbGVjdGVkIHR5cGUgaW5cbiAgICAgIC8vIHRoZSBzcGFuIGRpYWxvZ1xuICAgICAgdmFyIHNwYW5BdHRyaWJ1dGVzID0gZnVuY3Rpb24odHlwZVJhZGlvKSB7XG4gICAgICAgIHR5cGVSYWRpbyA9IHR5cGVSYWRpbyB8fCAkKCcjc3Bhbl9mb3JtIGlucHV0OnJhZGlvOmNoZWNrZWQnKTtcbiAgICAgICAgdmFyIGF0dHJpYnV0ZXMgPSB7fTtcbiAgICAgICAgdmFyIGF0dHJpYnV0ZVR5cGVzO1xuICAgICAgICB2YXIgY2F0ZWdvcnkgPSB0eXBlUmFkaW8uYXR0cignY2F0ZWdvcnknKTtcbiAgICAgICAgaWYgKGNhdGVnb3J5ID09ICdlbnRpdHknKSB7XG4gICAgICAgICAgYXR0cmlidXRlVHlwZXMgPSBlbnRpdHlBdHRyaWJ1dGVUeXBlcztcbiAgICAgICAgfSBlbHNlIGlmIChjYXRlZ29yeSA9PSAnZXZlbnQnKSB7XG4gICAgICAgICAgYXR0cmlidXRlVHlwZXMgPSBldmVudEF0dHJpYnV0ZVR5cGVzO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ1VucmVjb2duaXplZCB0eXBlIGNhdGVnb3J5OicsIGNhdGVnb3J5KTtcbiAgICAgICAgfVxuICAgICAgICAkLmVhY2goYXR0cmlidXRlVHlwZXMsIGZ1bmN0aW9uKGF0dHJObywgYXR0cikge1xuICAgICAgICAgIHZhciAkaW5wdXQgPSAkKCcjJytjYXRlZ29yeSsnX2F0dHJfJytVdGlsLmVzY2FwZVF1b3RlcyhhdHRyLnR5cGUpKTtcbiAgICAgICAgICBpZiAoYXR0ci5ib29sKSB7XG4gICAgICAgICAgICBhdHRyaWJ1dGVzW2F0dHIudHlwZV0gPSAkaW5wdXRbMF0uY2hlY2tlZDtcbiAgICAgICAgICB9IGVsc2UgaWYgKCRpbnB1dFswXS5zZWxlY3RlZEluZGV4KSB7XG4gICAgICAgICAgICBhdHRyaWJ1dGVzW2F0dHIudHlwZV0gPSAkaW5wdXQudmFsKCk7XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuIGF0dHJpYnV0ZXM7XG4gICAgICB9XG5cbiAgICAgIHZhciBzcGFuQW5kQXR0cmlidXRlVHlwZXNMb2FkZWQgPSBmdW5jdGlvbihfc3BhblR5cGVzLCBcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfZW50aXR5QXR0cmlidXRlVHlwZXMsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX2V2ZW50QXR0cmlidXRlVHlwZXMsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX3JlbGF0aW9uVHlwZXNIYXNoKSB7XG4gICAgICAgIHNwYW5UeXBlcyA9IF9zcGFuVHlwZXM7XG4gICAgICAgIGVudGl0eUF0dHJpYnV0ZVR5cGVzID0gX2VudGl0eUF0dHJpYnV0ZVR5cGVzO1xuICAgICAgICBldmVudEF0dHJpYnV0ZVR5cGVzID0gX2V2ZW50QXR0cmlidXRlVHlwZXM7XG4gICAgICAgIHJlbGF0aW9uVHlwZXNIYXNoID0gX3JlbGF0aW9uVHlwZXNIYXNoO1xuICAgICAgICAvLyBmb3IgZWFzaWVyIGFjY2Vzc1xuICAgICAgICBhbGxBdHRyaWJ1dGVUeXBlcyA9ICQuZXh0ZW5kKHt9LCBcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbnRpdHlBdHRyaWJ1dGVUeXBlcywgXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXZlbnRBdHRyaWJ1dGVUeXBlcyk7XG4gICAgICB9O1xuXG4gICAgICB2YXIgZ290Q3VycmVudCA9IGZ1bmN0aW9uKF9jb2xsLCBfZG9jLCBfYXJncykge1xuICAgICAgICBjb2xsID0gX2NvbGw7XG4gICAgICAgIGRvYyA9IF9kb2M7XG4gICAgICAgIGFyZ3MgPSBfYXJncztcbiAgICAgIH07XG5cbiAgICAgIHZhciB1bmRvU3RhY2sgPSBbXTtcbiAgICAgIHZhciBlZGl0ZWQgPSBmdW5jdGlvbihyZXNwb25zZSkge1xuICAgICAgICB2YXIgeCA9IHJlc3BvbnNlLmV4Y2VwdGlvbjtcbiAgICAgICAgaWYgKHgpIHtcbiAgICAgICAgICBpZiAoeCA9PSAnYW5ub3RhdGlvbklzUmVhZE9ubHknKSB7XG4gICAgICAgICAgICBkaXNwYXRjaGVyLnBvc3QoJ21lc3NhZ2VzJywgW1tbXCJUaGlzIGRvY3VtZW50IGlzIHJlYWQtb25seSBhbmQgY2FuJ3QgYmUgZWRpdGVkLlwiLCAnZXJyb3InXV1dKTtcbiAgICAgICAgICB9IGVsc2UgaWYgKHggPT0gJ3NwYW5PZmZzZXRPdmVybGFwRXJyb3InKSB7XG4gICAgICAgICAgICAvLyBjcmVhdGVTcGFuIHdpdGggb3ZlcmxhcHBpbmcgZnJhZyBvZmZzZXRzOyByZXNldCBvZmZzZXRzXG4gICAgICAgICAgICAvLyBAYW1hZGFubWF0aDogd2hvIGhvbGRzIHRoZSBsaXN0IG9mIG9mZnNldHMgZm9yIGEgc3Bhbj9cbiAgICAgICAgICAgIC8vIGhvdyB0byByZXNldCB0aGlzP1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBkaXNwYXRjaGVyLnBvc3QoJ21lc3NhZ2VzJywgW1tbJ1Vua25vd24gZXJyb3IgJyt4LCAnZXJyb3InXV1dKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgaWYgKHJlc2VsZWN0ZWRTcGFuKSB7XG4gICAgICAgICAgICAkKHJlc2VsZWN0ZWRTcGFuLnJlY3QpLnJlbW92ZUNsYXNzKCdyZXNlbGVjdCcpO1xuICAgICAgICAgICAgcmVzZWxlY3RlZFNwYW4gPSBudWxsO1xuICAgICAgICAgIH1cbiAgICAgICAgICBzdmdFbGVtZW50LnJlbW92ZUNsYXNzKCdyZXNlbGVjdCcpO1xuICAgICAgICAgICQoJyN3YWl0ZXInKS5kaWFsb2coJ2Nsb3NlJyk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgaWYgKHJlc3BvbnNlLmVkaXRlZCA9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIGNvbnNvbGUud2FybignV2FybmluZzogc2VydmVyIHJlc3BvbnNlIHRvIGVkaXQgaGFzJywgcmVzcG9uc2UuZWRpdGVkLCAndmFsdWUgZm9yIFwiZWRpdGVkXCInKTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgYXJncy5lZGl0ZWQgPSByZXNwb25zZS5lZGl0ZWQ7XG4gICAgICAgICAgfVxuICAgICAgICAgIHZhciBzb3VyY2VEYXRhID0gcmVzcG9uc2UuYW5ub3RhdGlvbnM7XG4gICAgICAgICAgc291cmNlRGF0YS5kb2N1bWVudCA9IGRvYztcbiAgICAgICAgICBzb3VyY2VEYXRhLmNvbGxlY3Rpb24gPSBjb2xsO1xuICAgICAgICAgIC8vIHRoaXMgXCJwcmV2ZW50XCIgaXMgdG8gcHJvdGVjdCBhZ2FpbnN0IHJlbG9hZGluZyAoZnJvbSB0aGVcbiAgICAgICAgICAvLyBzZXJ2ZXIpIHRoZSB2ZXJ5IGRhdGEgdGhhdCB3ZSBqdXN0IHJlY2VpdmVkIGFzIHBhcnQgb2YgdGhlXG4gICAgICAgICAgLy8gcmVzcG9uc2UgdG8gdGhlIGVkaXQuXG4gICAgICAgICAgaWYgKHJlc3BvbnNlLnVuZG8gIT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICB1bmRvU3RhY2sucHVzaChbY29sbCwgc291cmNlRGF0YS5kb2N1bWVudCwgcmVzcG9uc2UudW5kb10pO1xuICAgICAgICAgIH1cbiAgICAgICAgICBkaXNwYXRjaGVyLnBvc3QoJ3ByZXZlbnRSZWxvYWRCeVVSTCcpO1xuICAgICAgICAgIGRpc3BhdGNoZXIucG9zdCgnc2V0QXJndW1lbnRzJywgW2FyZ3NdKTtcbiAgICAgICAgICBkaXNwYXRjaGVyLnBvc3QoJ3JlbmRlckRhdGEnLCBbc291cmNlRGF0YV0pO1xuICAgICAgICB9XG4gICAgICB9O1xuXG5cbiAgICAgIC8vIFRPRE86IHdoeSBhcmUgdGhlc2UgZ2xvYmFscyBkZWZpbmVkIGhlcmUgaW5zdGVhZCBvZiBhdCB0aGUgdG9wP1xuICAgICAgdmFyIHNwYW5Gb3JtID0gJCgnI3NwYW5fZm9ybScpO1xuICAgICAgdmFyIHJhcGlkU3BhbkZvcm0gPSAkKCcjcmFwaWRfc3Bhbl9mb3JtJyk7XG4gICAgXG4gICAgICB2YXIgZGVsZXRlU3BhbiA9IGZ1bmN0aW9uKCkge1xuICAgICAgICBpZiAoQ29uZmlndXJhdGlvbi5jb25maXJtTW9kZU9uICYmICFjb25maXJtKFwiQXJlIHlvdSBzdXJlIHlvdSB3YW50IHRvIGRlbGV0ZSB0aGlzIGFubm90YXRpb24/XCIpKSB7XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgICQuZXh0ZW5kKHNwYW5PcHRpb25zLCB7XG4gICAgICAgICAgYWN0aW9uOiAnZGVsZXRlU3BhbicsXG4gICAgICAgICAgY29sbGVjdGlvbjogY29sbCxcbiAgICAgICAgICAnZG9jdW1lbnQnOiBkb2MsXG4gICAgICAgIH0pO1xuICAgICAgICBzcGFuT3B0aW9ucy5vZmZzZXRzID0gSlNPTi5zdHJpbmdpZnkoc3Bhbk9wdGlvbnMub2Zmc2V0cyk7XG4gICAgICAgIGRpc3BhdGNoZXIucG9zdCgnYWpheCcsIFtzcGFuT3B0aW9ucywgJ2VkaXRlZCddKTtcbiAgICAgICAgZGlzcGF0Y2hlci5wb3N0KCdoaWRlRm9ybScpO1xuICAgICAgICAkKCcjd2FpdGVyJykuZGlhbG9nKCdvcGVuJyk7XG4gICAgICB9O1xuXG4gICAgICB2YXIgcmVzZWxlY3RTcGFuID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIGRpc3BhdGNoZXIucG9zdCgnaGlkZUZvcm0nKTtcbiAgICAgICAgc3ZnRWxlbWVudC5hZGRDbGFzcygncmVzZWxlY3QnKTtcbiAgICAgICAgJChlZGl0ZWRTcGFuLnJlY3QpLmFkZENsYXNzKCdyZXNlbGVjdCcpO1xuICAgICAgICByZXNlbGVjdGVkU3BhbiA9IGVkaXRlZFNwYW47XG4gICAgICAgIHNlbGVjdGVkRnJhZ21lbnQgPSBudWxsO1xuICAgICAgfTtcblxuICAgICAgdmFyIHNwbGl0Rm9ybSA9ICQoJyNzcGxpdF9mb3JtJyk7XG4gICAgICBzcGxpdEZvcm0uc3VibWl0KGZ1bmN0aW9uKGV2dCkge1xuICAgICAgICB2YXIgc3BsaXRSb2xlcyA9IFtdO1xuICAgICAgICAkKCcjc3BsaXRfcm9sZXMgaW5wdXQ6Y2hlY2tlZCcpLmVhY2goZnVuY3Rpb24oKSB7XG4gICAgICAgICAgc3BsaXRSb2xlcy5wdXNoKCQodGhpcykudmFsKCkpO1xuICAgICAgICB9KTtcbiAgICAgICAgJC5leHRlbmQoc3Bhbk9wdGlvbnMsIHtcbiAgICAgICAgICAgIGFjdGlvbjogJ3NwbGl0U3BhbicsXG4gICAgICAgICAgICAnYXJncyc6ICQudG9KU09OKHNwbGl0Um9sZXMpLFxuICAgICAgICAgICAgY29sbGVjdGlvbjogY29sbCxcbiAgICAgICAgICAgICdkb2N1bWVudCc6IGRvYyxcbiAgICAgICAgICB9KTtcbiAgICAgICAgc3Bhbk9wdGlvbnMub2Zmc2V0cyA9IEpTT04uc3RyaW5naWZ5KHNwYW5PcHRpb25zLm9mZnNldHMpO1xuICAgICAgICBkaXNwYXRjaGVyLnBvc3QoJ2hpZGVGb3JtJyk7XG4gICAgICAgIGRpc3BhdGNoZXIucG9zdCgnYWpheCcsIFtzcGFuT3B0aW9ucywgJ2VkaXRlZCddKTtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgfSk7XG4gICAgICBkaXNwYXRjaGVyLnBvc3QoJ2luaXRGb3JtJywgW3NwbGl0Rm9ybSwge1xuICAgICAgICAgIGFsc29SZXNpemU6ICcuc2Nyb2xsX2ZzZXQnLFxuICAgICAgICAgIHdpZHRoOiA0MDBcbiAgICAgICAgfV0pO1xuICAgICAgdmFyIHNwbGl0U3BhbiA9IGZ1bmN0aW9uKCkge1xuICAgICAgICBkaXNwYXRjaGVyLnBvc3QoJ2hpZGVGb3JtJyk7XG4gICAgICAgIHZhciAkcm9sZXMgPSAkKCcjc3BsaXRfcm9sZXMnKS5lbXB0eSgpO1xuICAgICAgICB2YXIgbnVtUm9sZXMgPSByZXBlYXRpbmdBcmNUeXBlcy5sZW5ndGg7XG4gICAgICAgIHZhciByb2xlcyA9ICQuZWFjaChyZXBlYXRpbmdBcmNUeXBlcywgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgdmFyICRyb2xlID0gJCgnPGlucHV0IGlkPVwic3BsaXRfb25fJyArIFV0aWwuZXNjYXBlUXVvdGVzKHRoaXMpICtcbiAgICAgICAgICAgICdcIiB0eXBlPVwiY2hlY2tib3hcIiBuYW1lPVwiJyArIFV0aWwuZXNjYXBlUXVvdGVzKHRoaXMpICtcbiAgICAgICAgICAgICdcIiB2YWx1ZT1cIicgKyBVdGlsLmVzY2FwZVF1b3Rlcyh0aGlzKSArICdcIi8+Jyk7XG4gICAgICAgICAgaWYgKG51bVJvbGVzID09IDEpIHtcbiAgICAgICAgICAgIC8vIGEgc2luZ2xlIHJvbGUgd2lsbCBiZSBzZWxlY3RlZCBhdXRvbWF0aWNhbGx5XG4gICAgICAgICAgICAkcm9sZS5jbGljaygpO1xuICAgICAgICAgIH1cbiAgICAgICAgICB2YXIgJGxhYmVsID0gJCgnPGxhYmVsIGZvcj1cInNwbGl0X29uXycgKyBVdGlsLmVzY2FwZVF1b3Rlcyh0aGlzKSArXG4gICAgICAgICAgICAnXCI+JyArIFV0aWwuZXNjYXBlUXVvdGVzKHRoaXMpICsgJzwvbGFiZWw+Jyk7XG4gICAgICAgICAgJHJvbGVzLmFwcGVuZCgkcm9sZSkuYXBwZW5kKCRsYWJlbCk7XG4gICAgICAgIH0pO1xuICAgICAgICB2YXIgJHJvbGVCdXR0b25zID0gJHJvbGVzLmZpbmQoJ2lucHV0JykuYnV0dG9uKCk7XG4gICAgICAgIFxuICAgICAgICBkaXNwYXRjaGVyLnBvc3QoJ3Nob3dGb3JtJywgW3NwbGl0Rm9ybV0pO1xuICAgICAgfTtcblxuICAgICAgdmFyIGFkZEZyYWdtZW50ID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIGRpc3BhdGNoZXIucG9zdCgnaGlkZUZvcm0nKTtcbiAgICAgICAgc3ZnRWxlbWVudC5hZGRDbGFzcygncmVzZWxlY3QnKTtcbiAgICAgICAgJChlZGl0ZWRTcGFuLnJlY3QpLmFkZENsYXNzKCdyZXNlbGVjdCcpO1xuICAgICAgICByZXNlbGVjdGVkU3BhbiA9IGVkaXRlZFNwYW47XG4gICAgICAgIHNlbGVjdGVkRnJhZ21lbnQgPSBmYWxzZTtcbiAgICAgIH07XG5cbiAgICAgIHZhciByZXNlbGVjdEZyYWdtZW50ID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIGFkZEZyYWdtZW50KCk7XG4gICAgICAgIHNlbGVjdGVkRnJhZ21lbnQgPSBlZGl0ZWRGcmFnbWVudDtcbiAgICAgIH07XG5cbiAgICAgIHZhciBkZWxldGVGcmFnbWVudCA9IGZ1bmN0aW9uKCkge1xuICAgICAgICBpZiAoQ29uZmlndXJhdGlvbi5jb25maXJtTW9kZU9uICYmICFjb25maXJtKFwiQXJlIHlvdSBzdXJlIHlvdSB3YW50IHRvIGRlbGV0ZSB0aGlzIGZyYWdtZW50P1wiKSkge1xuICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICB2YXIgb2Zmc2V0cyA9IGVkaXRlZFNwYW4ub2Zmc2V0cztcbiAgICAgICAgc3Bhbk9wdGlvbnMub2xkX29mZnNldHMgPSBKU09OLnN0cmluZ2lmeShvZmZzZXRzKTtcbiAgICAgICAgb2Zmc2V0cy5zcGxpY2UoZWRpdGVkRnJhZ21lbnQsIDEpO1xuXG4gICAgICAgICQuZXh0ZW5kKHNwYW5PcHRpb25zLCB7XG4gICAgICAgICAgY29sbGVjdGlvbjogY29sbCxcbiAgICAgICAgICAnZG9jdW1lbnQnOiBkb2MsXG4gICAgICAgICAgb2Zmc2V0czogSlNPTi5zdHJpbmdpZnkob2Zmc2V0cyksXG4gICAgICAgIH0pO1xuXG4gICAgICAgIHNwYW5PcHRpb25zLmF0dHJpYnV0ZXMgPSAkLnRvSlNPTihzcGFuQXR0cmlidXRlcygpKTtcblxuICAgICAgICBzcGFuT3B0aW9ucy5ub3JtYWxpemF0aW9ucyA9ICQudG9KU09OKHNwYW5Ob3JtYWxpemF0aW9ucygpKTtcblxuICAgICAgICBkaXNwYXRjaGVyLnBvc3QoJ2FqYXgnLCBbc3Bhbk9wdGlvbnMsICdlZGl0ZWQnXSk7XG4gICAgICAgIGRpc3BhdGNoZXIucG9zdCgnaGlkZUZvcm0nKTtcbiAgICAgICAgJCgnI3dhaXRlcicpLmRpYWxvZygnb3BlbicpO1xuICAgICAgfTtcblxuICAgICAgZGlzcGF0Y2hlci5wb3N0KCdpbml0Rm9ybScsIFtzcGFuRm9ybSwge1xuICAgICAgICAgIGFsc29SZXNpemU6ICcjZW50aXR5X2FuZF9ldmVudF93cmFwcGVyJyxcbiAgICAgICAgICB3aWR0aDogNzYwLFxuICAgICAgICAgIGJ1dHRvbnM6IFt7XG4gICAgICAgICAgICAgIGlkOiAnc3Bhbl9mb3JtX2FkZF9mcmFnbWVudCcsXG4gICAgICAgICAgICAgIHRleHQ6IFwiQWRkIEZyYWcuXCIsXG4gICAgICAgICAgICAgIGNsaWNrOiBhZGRGcmFnbWVudFxuICAgICAgICAgICAgfSwge1xuICAgICAgICAgICAgICBpZDogJ3NwYW5fZm9ybV9kZWxldGUnLFxuICAgICAgICAgICAgICB0ZXh0OiBcIkRlbGV0ZVwiLFxuICAgICAgICAgICAgICBjbGljazogZGVsZXRlU3BhblxuICAgICAgICAgICAgfSwge1xuICAgICAgICAgICAgICBpZDogJ3NwYW5fZm9ybV9kZWxldGVfZnJhZ21lbnQnLFxuICAgICAgICAgICAgICB0ZXh0OiBcIkRlbGV0ZSBGcmFnLlwiLFxuICAgICAgICAgICAgICBjbGljazogZGVsZXRlRnJhZ21lbnRcbiAgICAgICAgICAgIH0sIHtcbiAgICAgICAgICAgICAgaWQ6ICdzcGFuX2Zvcm1fcmVzZWxlY3QnLFxuICAgICAgICAgICAgICB0ZXh0OiAnTW92ZScsXG4gICAgICAgICAgICAgIGNsaWNrOiByZXNlbGVjdFNwYW5cbiAgICAgICAgICAgIH0sIHtcbiAgICAgICAgICAgICAgaWQ6ICdzcGFuX2Zvcm1fcmVzZWxlY3RfZnJhZ21lbnQnLFxuICAgICAgICAgICAgICB0ZXh0OiAnTW92ZSBGcmFnLicsXG4gICAgICAgICAgICAgIGNsaWNrOiByZXNlbGVjdEZyYWdtZW50XG4gICAgICAgICAgICB9LCB7XG4gICAgICAgICAgICAgIGlkOiAnc3Bhbl9mb3JtX3NwbGl0JyxcbiAgICAgICAgICAgICAgdGV4dDogJ1NwbGl0JyxcbiAgICAgICAgICAgICAgY2xpY2s6IHNwbGl0U3BhblxuICAgICAgICAgICAgfVxuICAgICAgICAgIF0sXG4gICAgICAgICAgY2xvc2U6IGZ1bmN0aW9uKGV2dCkge1xuICAgICAgICAgICAga2V5bWFwID0gbnVsbDtcbiAgICAgICAgICAgIGlmIChyZXNlbGVjdGVkU3Bhbikge1xuICAgICAgICAgICAgICAkKHJlc2VsZWN0ZWRTcGFuLnJlY3QpLnJlbW92ZUNsYXNzKCdyZXNlbGVjdCcpO1xuICAgICAgICAgICAgICByZXNlbGVjdGVkU3BhbiA9IG51bGw7XG4gICAgICAgICAgICAgIHN2Z0VsZW1lbnQucmVtb3ZlQ2xhc3MoJ3Jlc2VsZWN0Jyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9XSk7XG4gICAgICAvLyBzZXQgYnV0dG9uIHRvb2x0aXBzIChAYW1hZGFubWF0aDogY2FuIHRoaXMgYmUgZG9uZSBpbiBpbml0PylcbiAgICAgICQoJyNzcGFuX2Zvcm1fcmVzZWxlY3QnKS5hdHRyKCd0aXRsZScsICdSZS1zZWxlY3QgdGhlIHRleHQgc3BhbiB0aGF0IHRoaXMgYW5ub3RhdGlvbiBtYXJrcy4nKTtcbiAgICAgICQoJyNzcGFuX2Zvcm1fZGVsZXRlJykuYXR0cigndGl0bGUnLCAnRGVsZXRlIHRoaXMgYW5ub3RhdGlvbi4nKTtcbiAgICAgICQoJyNzcGFuX2Zvcm1fc3BsaXQnKS5hdHRyKCd0aXRsZScsICdTcGxpdCB0aGlzIGFubm90YXRpb24gaW50byBtdWx0aXBsZSBzaW1pbGFyIGFubm90YXRpb25zLCBkaXN0cmlidXRpbmcgaXRzIGFyZ3VtZW50cy4nKTtcblxuICAgICAgZGlzcGF0Y2hlci5wb3N0KCdpbml0Rm9ybScsIFtyYXBpZFNwYW5Gb3JtLCB7XG4gICAgICAgICAgYWxzb1Jlc2l6ZTogJyNyYXBpZF9zcGFuX3R5cGVzJyxcbiAgICAgICAgICB3aWR0aDogNDAwLCAgICAgICAgICAgICBcbiAgICAgICAgICBjbG9zZTogZnVuY3Rpb24oZXZ0KSB7XG4gICAgICAgICAgICBrZXltYXAgPSBudWxsO1xuICAgICAgICAgIH1cbiAgICAgICAgfV0pO1xuXG4gICAgICB2YXIgc3BhbkZvcm1TdWJtaXQgPSBmdW5jdGlvbihldnQsIHR5cGVSYWRpbykge1xuICAgICAgICB0eXBlUmFkaW8gPSB0eXBlUmFkaW8gfHwgJCgnI3NwYW5fZm9ybSBpbnB1dDpyYWRpbzpjaGVja2VkJyk7XG4gICAgICAgIHZhciB0eXBlID0gdHlwZVJhZGlvLnZhbCgpO1xuICAgICAgICAkKCcjc3Bhbl9mb3JtLW9rJykuYmx1cigpO1xuICAgICAgICBkaXNwYXRjaGVyLnBvc3QoJ2hpZGVGb3JtJyk7XG4gICAgICAgICQuZXh0ZW5kKHNwYW5PcHRpb25zLCB7XG4gICAgICAgICAgYWN0aW9uOiAnY3JlYXRlU3BhbicsXG4gICAgICAgICAgY29sbGVjdGlvbjogY29sbCxcbiAgICAgICAgICAnZG9jdW1lbnQnOiBkb2MsXG4gICAgICAgICAgdHlwZTogdHlwZSxcbiAgICAgICAgICBjb21tZW50OiAkKCcjc3Bhbl9ub3RlcycpLnZhbCgpXG4gICAgICAgIH0pO1xuXG4gICAgICAgIHNwYW5PcHRpb25zLmF0dHJpYnV0ZXMgPSAkLnRvSlNPTihzcGFuQXR0cmlidXRlcygpKTtcblxuICAgICAgICBzcGFuT3B0aW9ucy5ub3JtYWxpemF0aW9ucyA9ICQudG9KU09OKHNwYW5Ob3JtYWxpemF0aW9ucygpKTtcblxuICAgICAgICBpZiAoc3Bhbk9wdGlvbnMub2Zmc2V0cykge1xuICAgICAgICAgIHNwYW5PcHRpb25zLm9mZnNldHMgPSAkLnRvSlNPTihzcGFuT3B0aW9ucy5vZmZzZXRzKTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIHVuZm9jdXMgYWxsIGVsZW1lbnRzIHRvIHByZXZlbnQgZm9jdXMgYmVpbmcga2VwdCBhZnRlclxuICAgICAgICAvLyBoaWRpbmcgdGhlbVxuICAgICAgICBzcGFuRm9ybS5wYXJlbnQoKS5maW5kKCcqJykuYmx1cigpO1xuXG4gICAgICAgICQoJyN3YWl0ZXInKS5kaWFsb2coJ29wZW4nKTtcbiAgICAgICAgZGlzcGF0Y2hlci5wb3N0KCdhamF4JywgW3NwYW5PcHRpb25zLCAnZWRpdGVkJ10pO1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICB9O1xuICAgICAgJCgnI3NwYW5fbm90ZXMnKS5mb2N1cyhmdW5jdGlvbiAoKSB7XG4gICAgICAgICAga2V5bWFwID0gbnVsbDtcbiAgICAgICAgfSkuYmx1cihmdW5jdGlvbiAoKSB7XG4gICAgICAgICAga2V5bWFwID0gc3BhbktleW1hcDtcbiAgICAgICAgfSk7XG4gICAgICBzcGFuRm9ybS5zdWJtaXQoc3BhbkZvcm1TdWJtaXQpO1xuXG4gICAgICB2YXIgcmFwaWRTcGFuRm9ybVN1Ym1pdCA9IGZ1bmN0aW9uKGV2dCwgdHlwZVJhZGlvKSB7XG4gICAgICAgIHR5cGVSYWRpbyA9IHR5cGVSYWRpbyB8fCAkKCcjcmFwaWRfc3Bhbl9mb3JtIGlucHV0OnJhZGlvOmNoZWNrZWQnKTtcbiAgICAgICAgdmFyIHR5cGUgPSB0eXBlUmFkaW8udmFsKCk7XG5cbiAgICAgICAgLy8gdW5mb2N1cyBhbGwgZWxlbWVudHMgdG8gcHJldmVudCBmb2N1cyBiZWluZyBrZXB0IGFmdGVyXG4gICAgICAgIC8vIGhpZGluZyB0aGVtXG4gICAgICAgIHJhcGlkU3BhbkZvcm0ucGFyZW50KCkuZmluZCgnKicpLmJsdXIoKTtcbiAgICAgICAgZGlzcGF0Y2hlci5wb3N0KCdoaWRlRm9ybScpO1xuXG4gICAgICAgIGlmICh0eXBlID09IFwiXCIpIHtcbiAgICAgICAgICAvLyBlbXB0eSB0eXBlIHZhbHVlIHNpZ25hbHMgdGhlIHNwZWNpYWwgY2FzZSB3aGVyZSB0aGUgdXNlclxuICAgICAgICAgIC8vIHNlbGVjdGVkIFwibm9uZSBvZiB0aGUgYWJvdmVcIiBvZiB0aGUgcHJvcG9zZWQgdHlwZXMgYW5kXG4gICAgICAgICAgLy8gdGhlIG5vcm1hbCBkaWFsb2cgc2hvdWxkIGJlIGJyb3VnaHQgdXAgZm9yIHRoZSBzYW1lIHNwYW4uXG4gICAgICAgICAgc3Bhbk9wdGlvbnMgPSB7XG4gICAgICAgICAgICBhY3Rpb246ICdjcmVhdGVTcGFuJyxcbiAgICAgICAgICAgIG9mZnNldHM6IHJhcGlkU3Bhbk9wdGlvbnMub2Zmc2V0cyxcbiAgICAgICAgICB9O1xuICAgICAgICAgIC8vIFRPRE86IGF2b2lkIHVzaW5nIHRoZSBzdG9yZWQgbW91c2UgZXZlbnRcbiAgICAgICAgICBmaWxsU3BhblR5cGVzQW5kRGlzcGxheUZvcm0obGFzdFJhcGlkQW5ub3RhdGlvbkV2ZW50LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKCcjcmFwaWRfc3Bhbl9zZWxlY3RlZCcpLnRleHQoKSk7XG4gICAgICAgICAgZGlzcGF0Y2hlci5wb3N0KCdsb2dBY3Rpb24nLCBbJ25vcm1hbFNwYW5TZWxlY3RlZCddKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAvLyBub3JtYWwgdHlwZSBzZWxlY3Rpb247IHN1Ym1pdCBjcmVhdGVTcGFuIHdpdGggdGhlIHNlbGVjdGVkIHR5cGUuXG4gICAgICAgICAgJC5leHRlbmQocmFwaWRTcGFuT3B0aW9ucywge1xuICAgICAgICAgICAgYWN0aW9uOiAnY3JlYXRlU3BhbicsXG4gICAgICAgICAgICBjb2xsZWN0aW9uOiBjb2xsLFxuICAgICAgICAgICAgJ2RvY3VtZW50JzogZG9jLFxuICAgICAgICAgICAgdHlwZTogdHlwZSxcbiAgICAgICAgICB9KTtcbiAgICAgICAgICAkKCcjd2FpdGVyJykuZGlhbG9nKCdvcGVuJyk7XG4gICAgICAgICAgcmFwaWRTcGFuT3B0aW9ucy5vZmZzZXRzID0gSlNPTi5zdHJpbmdpZnkocmFwaWRTcGFuT3B0aW9ucy5vZmZzZXRzKTtcbiAgICAgICAgICBkaXNwYXRjaGVyLnBvc3QoJ2FqYXgnLCBbcmFwaWRTcGFuT3B0aW9ucywgJ2VkaXRlZCddKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICB9O1xuICAgICAgcmFwaWRTcGFuRm9ybS5zdWJtaXQocmFwaWRTcGFuRm9ybVN1Ym1pdCk7XG5cbiAgICAgIHZhciBpbXBvcnRGb3JtID0gJCgnI2ltcG9ydF9mb3JtJyk7XG4gICAgICB2YXIgaW1wb3J0Rm9ybVN1Ym1pdCA9IGZ1bmN0aW9uKGV2dCkge1xuICAgICAgICB2YXIgX2RvY2lkID0gJCgnI2ltcG9ydF9kb2NpZCcpLnZhbCgpO1xuICAgICAgICB2YXIgX2RvY3RpdGxlID0gJCgnI2ltcG9ydF90aXRsZScpLnZhbCgpO1xuICAgICAgICB2YXIgX2RvY3RleHQgPSAkKCcjaW1wb3J0X3RleHQnKS52YWwoKTtcbiAgICAgICAgdmFyIG9wdHMgPSB7XG4gICAgICAgICAgYWN0aW9uIDogJ2ltcG9ydERvY3VtZW50JyxcbiAgICAgICAgICBjb2xsZWN0aW9uIDogY29sbCxcbiAgICAgICAgICBkb2NpZCAgOiBfZG9jaWQsXG4gICAgICAgICAgdGl0bGUgOiBfZG9jdGl0bGUsXG4gICAgICAgICAgdGV4dCAgOiBfZG9jdGV4dCxcbiAgICAgICAgfTtcbiAgICAgICAgZGlzcGF0Y2hlci5wb3N0KCdhamF4JywgW29wdHMsIGZ1bmN0aW9uKHJlc3BvbnNlKSB7XG4gICAgICAgICAgdmFyIHggPSByZXNwb25zZS5leGNlcHRpb247XG4gICAgICAgICAgaWYgKHgpIHtcbiAgICAgICAgICAgIGlmICh4ID09ICdmaWxlRXhpc3RzRXJyb3InKSB7XG4gICAgICAgICAgICAgIGRpc3BhdGNoZXIucG9zdCgnbWVzc2FnZXMnLCBbW1tcIkEgZmlsZSB3aXRoIHRoZSBnaXZlbiBuYW1lIGV4aXN0cy4gUGxlYXNlIGdpdmUgYSBkaWZmZXJlbnQgbmFtZSB0byB0aGUgZmlsZSB0byBpbXBvcnQuXCIsICdlcnJvciddXV0pO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgZGlzcGF0Y2hlci5wb3N0KCdtZXNzYWdlcycsIFtbWydVbmtub3duIGVycm9yOiAnICsgcmVzcG9uc2UuZXhjZXB0aW9uLCAnZXJyb3InXV1dKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgZGlzcGF0Y2hlci5wb3N0KCdoaWRlRm9ybScpO1xuICAgICAgICAgICAgZGlzcGF0Y2hlci5wb3N0KCdzZXREb2N1bWVudCcsIFtyZXNwb25zZS5kb2N1bWVudF0pO1xuICAgICAgICAgIH1cbiAgICAgICAgfV0pO1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICB9O1xuICAgICAgaW1wb3J0Rm9ybS5zdWJtaXQoaW1wb3J0Rm9ybVN1Ym1pdCk7XG4gICAgICBkaXNwYXRjaGVyLnBvc3QoJ2luaXRGb3JtJywgW2ltcG9ydEZvcm0sIHtcbiAgICAgICAgICB3aWR0aDogNTAwLFxuICAgICAgICAgIGFsc29SZXNpemU6ICcjaW1wb3J0X3RleHQnLFxuICAgICAgICAgIG9wZW46IGZ1bmN0aW9uKGV2dCkge1xuICAgICAgICAgICAga2V5bWFwID0ge307XG4gICAgICAgICAgfSxcbiAgICAgICAgfV0pO1xuICAgICAgJCgnI2ltcG9ydF9idXR0b24nKS5jbGljayhmdW5jdGlvbigpIHtcbiAgICAgICAgZGlzcGF0Y2hlci5wb3N0KCdoaWRlRm9ybScpO1xuICAgICAgICBkaXNwYXRjaGVyLnBvc3QoJ3Nob3dGb3JtJywgW2ltcG9ydEZvcm1dKTtcbiAgICAgICAgaW1wb3J0Rm9ybS5maW5kKCdpbnB1dCwgdGV4dGFyZWEnKS52YWwoJycpO1xuICAgICAgfSk7XG5cbiAgICAgIC8qIEJFR0lOIGRlbGV0ZSBidXR0b24gLSByZWxhdGVkICovXG5cbiAgICAgICQoJyNkZWxldGVfZG9jdW1lbnRfYnV0dG9uJykuY2xpY2soZnVuY3Rpb24oKSB7XG4gICAgICAgIGlmICghZG9jKSB7XG4gICAgICAgICAgZGlzcGF0Y2hlci5wb3N0KCdtZXNzYWdlcycsIFtbWydObyBkb2N1bWVudCBzZWxlY3RlZCcsICdlcnJvciddXV0pO1xuICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoIWNvbmZpcm0oJ0FyZSB5b3Ugc3VyZSB5b3Ugd2FudCB0byBwZXJtYW5lbnRseSByZW1vdmUgdGhpcyBkb2N1bWVudCBhbmQgaXRzIGFubm90YXRpb25zIGZyb20gdGhlIGNvbGxlY3Rpb24/IFRoaXMgYWN0aW9uIGNhbm5vdCBiZSB1bmRvbmUuJykpIHtcbiAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgdmFyIGRlbE9wdGlvbnMgPSB7XG4gICAgICAgICAgYWN0aW9uOiAnZGVsZXRlRG9jdW1lbnQnLFxuICAgICAgICAgIGNvbGxlY3Rpb246IGNvbGwsXG4gICAgICAgICAgJ2RvY3VtZW50JzogZG9jXG4gICAgICAgIH1cbiAgICAgICAgZGlzcGF0Y2hlci5wb3N0KCdhamF4JywgW2RlbE9wdGlvbnMsICdkb2NEZWxldGVkJ10pO1xuICAgICAgfSk7XG5cbiAgICAgICQoJyNkZWxldGVfY29sbGVjdGlvbl9idXR0b24nKS5jbGljayhmdW5jdGlvbigpIHtcbiAgICAgICAgaWYgKCFjb2xsKSB7XG4gICAgICAgICAgZGlzcGF0Y2hlci5wb3N0KCdtZXNzYWdlcycsIFtbWydObyBjb2xsZWN0aW9uIHNlbGVjdGVkJywgJ2Vycm9yJ11dXSk7XG4gICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgICAgIGlmICghY29uZmlybSgnQXJlIHlvdSBzdXJlIHlvdSB3YW50IHRvIHBlcm1hbmVudGx5IFJFTU9WRSB0aGUgRU5USVJFIENPTExFQ1RJT04gJytjb2xsKycsIGluY2x1ZGluZyBhbGwgaXRzIGRvY3VtZW50cyBhbmQgdGhlaXIgYW5ub3RhdGlvbnM/ICBUaGlzIGFjdGlvbiBDQU5OT1QgQkUgVU5ET05FLicpKSB7XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIHZhciBkZWxPcHRpb25zID0ge1xuICAgICAgICAgIGFjdGlvbjogJ2RlbGV0ZUNvbGxlY3Rpb24nLFxuICAgICAgICAgIGNvbGxlY3Rpb246IGNvbGwsXG4gICAgICAgIH1cbiAgICAgICAgZGlzcGF0Y2hlci5wb3N0KCdhamF4JywgW2RlbE9wdGlvbnMsICdjb2xsRGVsZXRlZCddKTtcbiAgICAgIH0pO1xuXG4gICAgICAvKiBFTkQgZGVsZXRlIGJ1dHRvbiAtIHJlbGF0ZWQgKi9cblxuICAgICAgJCgnI3VuZG9fYnV0dG9uJykuY2xpY2soZnVuY3Rpb24oKSB7XG4gICAgICAgIGlmIChjb2xsICYmIGRvYykge1xuICAgICAgICAgIGlmICh1bmRvU3RhY2subGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgdmFyIHN0b3JlZFVuZG8gPSB1bmRvU3RhY2sucG9wKCk7XG4gICAgICAgICAgICB2YXIgY29sbGVjdGlvbiA9IHN0b3JlZFVuZG9bMF07XG4gICAgICAgICAgICB2YXIgZG9rID0gc3RvcmVkVW5kb1sxXTtcbiAgICAgICAgICAgIHZhciB0b2tlbiA9IHN0b3JlZFVuZG9bMl07XG4gICAgICAgICAgICB2YXIgb3B0aW9ucyA9IHtcbiAgICAgICAgICAgICAgJ2FjdGlvbic6ICd1bmRvJyxcbiAgICAgICAgICAgICAgJ2NvbGxlY3Rpb24nOiBjb2xsZWN0aW9uLFxuICAgICAgICAgICAgICAnZG9jdW1lbnQnOiBkb2ssXG4gICAgICAgICAgICAgICd0b2tlbic6IHRva2VuXG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBkaXNwYXRjaGVyLnBvc3QoJ2FqYXgnLCBbb3B0aW9ucywgJ2VkaXRlZCddKTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgZGlzcGF0Y2hlci5wb3N0KCdtZXNzYWdlcycsIFtbWydObyBhY3Rpb24gdG8gYmUgdW5kb25lJywgJ2Vycm9yJ11dXSk7XG4gICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGRpc3BhdGNoZXIucG9zdCgnbWVzc2FnZXMnLCBbW1snTm8gZG9jdW1lbnQgbG9hZGVkLCBjYW4gbm90IHVuZG8gY2hhbmdlcycsICdlcnJvciddXV0pO1xuICAgICAgICB9XG4gICAgICB9KTtcblxuXG4gICAgICB2YXIgcHJldmVudERlZmF1bHQgPSBmdW5jdGlvbihldnQpIHtcbiAgICAgICAgZXZ0LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICB9XG5cbiAgICAgIHZhciAkd2FpdGVyID0gJCgnI3dhaXRlcicpO1xuICAgICAgJHdhaXRlci5kaWFsb2coe1xuICAgICAgICBjbG9zZU9uRXNjYXBlOiBmYWxzZSxcbiAgICAgICAgYnV0dG9uczoge30sXG4gICAgICAgIG1vZGFsOiB0cnVlLFxuICAgICAgICBvcGVuOiBmdW5jdGlvbihldnQsIHVpKSB7XG4gICAgICAgICAgJChldnQudGFyZ2V0KS5wYXJlbnQoKS5maW5kKFwiLnVpLWRpYWxvZy10aXRsZWJhci1jbG9zZVwiKS5oaWRlKCk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgICAgLy8gaGlkZSB0aGUgd2FpdGVyIChTYW1wbyBzYWlkIGl0J3MgYW5ub3lpbmcpXG4gICAgICAvLyB3ZSBkb24ndCBlbGxpbWluYXRlIGl0IGFsdG9nZXRoZXIgYmVjYXVzZSBpdCBzdGlsbCBwcm92aWRlcyB0aGVcbiAgICAgIC8vIG92ZXJsYXkgdG8gcHJldmVudCBpbnRlcmFjdGlvblxuICAgICAgLy8gJHdhaXRlci5wYXJlbnQoKS5jc3MoJ29wYWNpdHknLCAnMCcpO1xuXG4gICAgICB2YXIgaXNSZWxvYWRPa2F5ID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIC8vIGRvIG5vdCByZWxvYWQgd2hpbGUgdGhlIHVzZXIgaXMgaW4gdGhlIG1pZGRsZSBvZiBlZGl0aW5nXG4gICAgICAgIHJldHVybiBhcmNEcmFnT3JpZ2luID09IG51bGwgJiYgcmVzZWxlY3RlZFNwYW4gPT0gbnVsbDtcbiAgICAgIH07XG5cbiAgICAgIHZhciB1c2VyUmVjZWl2ZWQgPSBmdW5jdGlvbihfdXNlcikge1xuICAgICAgICB0aGF0LnVzZXIgPSBfdXNlcjtcbiAgICAgIH1cblxuICAgICAgdmFyIHNldEFubm90YXRpb25TcGVlZCA9IGZ1bmN0aW9uKHNwZWVkKSB7XG4gICAgICAgIGlmIChzcGVlZCA9PSAxKSB7XG4gICAgICAgICAgQ29uZmlndXJhdGlvbi5jb25maXJtTW9kZU9uID0gdHJ1ZTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBDb25maWd1cmF0aW9uLmNvbmZpcm1Nb2RlT24gPSBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoc3BlZWQgPT0gMykge1xuICAgICAgICAgIENvbmZpZ3VyYXRpb24ucmFwaWRNb2RlT24gPSB0cnVlO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIENvbmZpZ3VyYXRpb24ucmFwaWRNb2RlT24gPSBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgICBkaXNwYXRjaGVyLnBvc3QoJ2NvbmZpZ3VyYXRpb25DaGFuZ2VkJyk7XG4gICAgICB9O1xuXG4gICAgICB2YXIgb25OZXdTb3VyY2VEYXRhID0gZnVuY3Rpb24oX3NvdXJjZURhdGEpIHtcbiAgICAgICAgc291cmNlRGF0YSA9IF9zb3VyY2VEYXRhO1xuICAgICAgfVxuXG4gICAgICB2YXIgaW5pdCA9IGZ1bmN0aW9uKCkge1xuICAgICAgICBkaXNwYXRjaGVyLnBvc3QoJ2Fubm90YXRpb25Jc0F2YWlsYWJsZScpO1xuICAgICAgfTtcblxuICAgICAgdmFyIGNvbGxlY3Rpb25Mb2FkZWQgPSBmdW5jdGlvbihjb2xsRGF0YSl7XG4gICAgICAgIGNvbGwgPSBjb2xsRGF0YTtcbiAgICAgIH07XG5cbiAgICAgIHZhciByZXF1ZXN0UmVuZGVyRGF0YSA9IGZ1bmN0aW9uKGRvY0RhdGEpIHtcbiAgICAgICAgZG9jID0gZG9jRGF0YTtcbiAgICAgIH07XG5cbiAgICAgIGRpc3BhdGNoZXIuXG4gICAgICAgICAgb24oJ2luaXQnLCBpbml0KS5cbiAgICAgICAgICBvbignZ2V0VmFsaWRBcmNUeXBlc0ZvckRyYWcnLCBnZXRWYWxpZEFyY1R5cGVzRm9yRHJhZykuXG4gICAgICAgICAgb24oJ2RhdGFSZWFkeScsIHJlbWVtYmVyRGF0YSkuXG4gICAgICAgICAgb24oJ3JlcXVlc3RSZW5kZXJEYXRhJywgcmVxdWVzdFJlbmRlckRhdGEpLlxuICAgICAgICAgIG9uKCdjb2xsZWN0aW9uTG9hZGVkJywgY29sbGVjdGlvbkxvYWRlZCkuXG4gICAgICAgICAgb24oJ2NvbGxlY3Rpb25Mb2FkZWQnLCByZW1lbWJlclNwYW5TZXR0aW5ncykuXG4gICAgICAgICAgb24oJ2NvbGxlY3Rpb25Mb2FkZWQnLCBzZXR1cFRhZ2dlclVJKS5cbiAgICAgICAgICBvbignY29sbGVjdGlvbkxvYWRlZCcsIHNldHVwTm9ybWFsaXphdGlvblVJKS5cbiAgICAgICAgICBvbignc3BhbkFuZEF0dHJpYnV0ZVR5cGVzTG9hZGVkJywgc3BhbkFuZEF0dHJpYnV0ZVR5cGVzTG9hZGVkKS5cbiAgICAgICAgICBvbignbmV3U291cmNlRGF0YScsIG9uTmV3U291cmNlRGF0YSkuXG4gICAgICAgICAgb24oJ2hpZGVGb3JtJywgaGlkZUZvcm0pLlxuICAgICAgICAgIG9uKCd1c2VyJywgdXNlclJlY2VpdmVkKS5cbiAgICAgICAgICBvbignZWRpdGVkJywgZWRpdGVkKS5cbiAgICAgICAgICBvbignY3VycmVudCcsIGdvdEN1cnJlbnQpLlxuICAgICAgICAgIG9uKCdpc1JlbG9hZE9rYXknLCBpc1JlbG9hZE9rYXkpLlxuICAgICAgICAgIG9uKCdrZXlkb3duJywgb25LZXlEb3duKS5cbiAgICAgICAgICBvbignZGJsY2xpY2snLCBvbkRibENsaWNrKS5cbiAgICAgICAgICBvbignZHJhZ3N0YXJ0JywgcHJldmVudERlZmF1bHQpLlxuICAgICAgICAgIG9uKCdtb3VzZWRvd24nLCBvbk1vdXNlRG93bikuXG4gICAgICAgICAgb24oJ21vdXNldXAnLCBvbk1vdXNlVXApLlxuICAgICAgICAgIG9uKCdtb3VzZW1vdmUnLCBvbk1vdXNlTW92ZSkuXG4gICAgICAgICAgb24oJ2Fubm90YXRpb25TcGVlZCcsIHNldEFubm90YXRpb25TcGVlZCkuXG4gICAgICAgICAgb24oJ3N1Z2dlc3RlZFNwYW5UeXBlcycsIHJlY2VpdmVkU3VnZ2VzdGVkU3BhblR5cGVzKS5cbiAgICAgICAgICBvbignbm9ybUdldE5hbWVSZXN1bHQnLCBzZXRTcGFuTm9ybVRleHQpLlxuICAgICAgICAgIG9uKCdub3JtU2VhcmNoUmVzdWx0Jywgc2V0U3Bhbk5vcm1TZWFyY2hSZXN1bHRzKTtcbiAgICB9O1xuXG4gICAgcmV0dXJuIEFubm90YXRvclVJO1xufSkoalF1ZXJ5LCB3aW5kb3cpO1xuXG4vLyBCUkFUIFNUQU5EQUxPTkUgTElCUkFSWSBCRUdJTlxuLy8gQnJvd3NlcmlmeSBleHBvcnRcbm1vZHVsZS5leHBvcnRzID0gQW5ub3RhdG9yVUk7XG4vLyBCUkFUIFNUQU5EQUxPTkUgTElCUkFSWSBFTkRcbiIsIi8vIC0qLSBNb2RlOiBKYXZhU2NyaXB0OyB0YWItd2lkdGg6IDI7IGluZGVudC10YWJzLW1vZGU6IG5pbDsgLSotXG4vLyB2aW06c2V0IGZ0PWphdmFzY3JpcHQgdHM9MiBzdz0yIHN0cz0yIGNpbmRlbnQ6XG52YXIgQ29uZmlndXJhdGlvbiA9IChmdW5jdGlvbih3aW5kb3csIHVuZGVmaW5lZCkge1xuICAgIHZhciBDb25maWd1cmF0aW9uID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIHZhciB0aGF0ID0gdGhpcztcbiAgICAgICAgdGhhdC5hYmJyZXZzT24gPSB0cnVlO1xuICAgICAgICB0aGF0LnRleHRCYWNrZ3JvdW5kcyA9IFwic3RyaXBlZFwiO1xuICAgICAgICB0aGF0LnN2Z1dpZHRoID0gJzEwMCUnO1xuICAgICAgICB0aGF0LnJhcGlkTW9kZU9uID0gZmFsc2U7XG4gICAgICAgIHRoYXQuY29uZmlybU1vZGVPbiA9IHRydWU7XG4gICAgICAgIHRoYXQuYXV0b3JlZnJlc2hPbiA9IGZhbHNlO1xuICAgICAgICB0aGF0LnZpc3VhbCA9IHtcbiAgICAgICAgICAgIG1hcmdpbjogeyB4OiAyLCB5OiAxIH0sXG4gICAgICAgICAgICBhcmNUZXh0TWFyZ2luOiAxLFxuICAgICAgICAgICAgYm94U3BhY2luZzogMSxcbiAgICAgICAgICAgIGN1cmx5SGVpZ2h0OiA0LFxuICAgICAgICAgICAgYXJjU3BhY2luZzogOSwgLy8xMDtcbiAgICAgICAgICAgIGFyY1N0YXJ0SGVpZ2h0OiAxOSwgLy8yMzsgLy8yNTtcbiAgICAgICAgfTtcbiAgICB9O1xuXG4gICAgcmV0dXJuIENvbmZpZ3VyYXRpb247XG59KSh3aW5kb3cpO1xuXG4vLyBCUkFUIFNUQU5EQUxPTkUgTElCUkFSWSBCRUdJTlxuLy8gQnJvd3NlcmlmeSBleHBvcnRcbm1vZHVsZS5leHBvcnRzID0gQ29uZmlndXJhdGlvbjtcbi8vIEJSQVQgU1RBTkRBTE9ORSBMSUJSQVJZIEVORCIsIi8vIC0qLSBNb2RlOiBKYXZhU2NyaXB0OyB0YWItd2lkdGg6IDI7IGluZGVudC10YWJzLW1vZGU6IG5pbDsgLSotXG4vLyB2aW06c2V0IGZ0PWphdmFzY3JpcHQgdHM9MiBzdz0yIHN0cz0yIGNpbmRlbnQ6XG4vLyBUT0RPOiBkb2VzICdhcmd1bWVudHMuY2FsbGVlLmNhbGxlcicgd29yaz9cblxudmFyIERpc3BhdGNoZXIgPSAoZnVuY3Rpb24oJCwgd2luZG93LCB1bmRlZmluZWQpIHtcbiAgICB2YXIgRGlzcGF0Y2hlciA9IGZ1bmN0aW9uKCkge1xuICAgICAgdmFyIHRoYXQgPSB0aGlzO1xuXG4gICAgICB2YXIgdGFibGUgPSB7fTtcblxuICAgICAgdmFyIG9uID0gZnVuY3Rpb24obWVzc2FnZSwgaG9zdCwgaGFuZGxlcikge1xuICAgICAgICBpZiAoaGFuZGxlciA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgaGFuZGxlciA9IGhvc3Q7XG4gICAgICAgICAgaG9zdCA9IGFyZ3VtZW50cy5jYWxsZWUuY2FsbGVyO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0YWJsZVttZXNzYWdlXSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgdGFibGVbbWVzc2FnZV0gPSBbXTtcbiAgICAgICAgfVxuICAgICAgICB0YWJsZVttZXNzYWdlXS5wdXNoKFtob3N0LCBoYW5kbGVyXSk7XG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgICAgfTtcblxuICAgICAgLy8gTm90aWZ5IGxpc3RlbmVycyB0aGF0IHdlIGVuY291bnRlcmVkIGFuIGVycm9yIGluIGFuIGFzeW5jaCBjYWxsXG4gICAgICB2YXIgaW5Bc3luY2hFcnJvciA9IGZhbHNlOyAvLyBUbyBhdm9pZCBlcnJvciBhdmFsYW5jaGVzXG4gICAgICB2YXIgaGFuZGxlQXN5bmNoRXJyb3IgPSBmdW5jdGlvbihlKSB7XG4gICAgICAgIGlmICghaW5Bc3luY2hFcnJvcikge1xuICAgICAgICAgIGluQXN5bmNoRXJyb3IgPSB0cnVlO1xuICAgICAgICAgIC8vIFRPRE86IEhvb2sgcHJpbnRvdXQgaW50byBkaXNwYXRjaCBlbHNld2hlcmU/XG4gICAgICAgICAgY29uc29sZS53YXJuKCdIYW5kbGVkIGFzeW5jIGVycm9yOicsIGUpO1xuICAgICAgICAgIHRoYXQucG9zdCgnZGlzcGF0Y2hBc3luY2hFcnJvcicsIFtlXSk7XG4gICAgICAgICAgaW5Bc3luY2hFcnJvciA9IGZhbHNlO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGNvbnNvbGUud2FybignRHJvcHBlZCBhc3luY2ggZXJyb3I6JywgZSk7XG4gICAgICAgIH1cbiAgICAgIH07XG5cbiAgICAgIHZhciBwb3N0ID0gZnVuY3Rpb24oYXN5bmNoLCBtZXNzYWdlLCBhcmdzLCByZXR1cm5UeXBlKSB7XG4gICAgICAgIGlmICh0eXBlb2YoYXN5bmNoKSAhPT0gJ251bWJlcicpIHtcbiAgICAgICAgICAvLyBubyBhc3luY2ggcGFyYW1ldGVyXG4gICAgICAgICAgcmV0dXJuVHlwZSA9IGFyZ3M7XG4gICAgICAgICAgYXJncyA9IG1lc3NhZ2U7XG4gICAgICAgICAgbWVzc2FnZSA9IGFzeW5jaDtcbiAgICAgICAgICBhc3luY2ggPSBudWxsO1xuICAgICAgICB9XG4gICAgICAgIGlmIChhcmdzID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICBhcmdzID0gW107XG4gICAgICAgIH1cbiAgICAgICAgdmFyIHJlc3VsdHMgPSBbXTtcbiAgICAgICAgLy8gREVCVUc6IGlmICh0eXBlb2YobWVzc2FnZSkgIT0gXCJzdHJpbmdcIiB8fCAhKG1lc3NhZ2UubWF0Y2goL21vdXNlLykgfHwgbWVzc2FnZSA9PSBcImhpZGVDb21tZW50XCIpKSBjb25zb2xlLmxvZyhtZXNzYWdlLCBhcmdzKTtcblxuICAgICAgICBpZiAodHlwZW9mKG1lc3NhZ2UpID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgICAgLy8gc29tZW9uZSB3YXMgbGF6eSBhbmQgc2VudCBhIHNpbXBsZSBmdW5jdGlvblxuICAgICAgICAgIHZhciBob3N0ID0gYXJndW1lbnRzLmNhbGxlZS5jYWxsZXI7XG4gICAgICAgICAgaWYgKGFzeW5jaCAhPT0gbnVsbCkge1xuICAgICAgICAgICAgcmVzdWx0ID0gc2V0VGltZW91dChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgLyp0cnkgeyovXG4gICAgICAgICAgICAgICAgbWVzc2FnZS5hcHBseShob3N0LCBhcmdzKTtcbiAgICAgICAgICAgICAgLyp9IGNhdGNoKGUpIHtcbiAgICAgICAgICAgICAgICB0aGF0LmhhbmRsZUFzeW5jaEVycm9yKGUpO1xuICAgICAgICAgICAgICB9Ki9cbiAgICAgICAgICAgIH0sIGFzeW5jaCk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHJlc3VsdCA9IG1lc3NhZ2UuYXBwbHkoaG9zdCwgYXJncyk7XG4gICAgICAgICAgfVxuICAgICAgICAgIHJlc3VsdHMucHVzaChyZXN1bHQpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIC8vIGEgcHJvcGVyIG1lc3NhZ2UsIHByb3BhZ2F0ZSB0byBhbGwgaW50ZXJlc3RlZCBwYXJ0aWVzXG4gICAgICAgICAgdmFyIHRvZG8gPSB0YWJsZVttZXNzYWdlXTtcbiAgICAgICAgICBpZiAodG9kbyAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAkLmVhY2godG9kbywgZnVuY3Rpb24oaXRlbU5vLCBpdGVtKSB7XG4gICAgICAgICAgICAgIHZhciByZXN1bHQ7XG4gICAgICAgICAgICAgIGlmIChhc3luY2ggIT09IG51bGwpIHtcbiAgICAgICAgICAgICAgICByZXN1bHQgPSBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgLyp0cnkgeyovXG4gICAgICAgICAgICAgICAgICAgIGl0ZW1bMV0uYXBwbHkoaXRlbVswXSwgYXJncyk7XG4gICAgICAgICAgICAgICAgICAvKn0gY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhhdC5oYW5kbGVBc3luY2hFcnJvcihlKTtcbiAgICAgICAgICAgICAgICAgIH0qL1xuICAgICAgICAgICAgICAgIH0sIGFzeW5jaCk7XG4gICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgcmVzdWx0ID0gaXRlbVsxXS5hcHBseShpdGVtWzBdLCBhcmdzKTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICByZXN1bHRzLnB1c2gocmVzdWx0KTtcbiAgICAgICAgICAgIH0pO1xuLyogREVCVUdcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgY29uc29sZS53YXJuKCdNZXNzYWdlICcgKyBtZXNzYWdlICsgJyBoYXMgbm8gc3Vic2NyaWJlcnMuJyk7IC8vIERFQlVHXG4qL1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBpZiAocmV0dXJuVHlwZSA9PSAnYW55Jykge1xuICAgICAgICAgIHZhciBpID0gcmVzdWx0cy5sZW5ndGg7XG4gICAgICAgICAgd2hpbGUgKGktLSkge1xuICAgICAgICAgICAgaWYgKHJlc3VsdHNbaV0gIT09IGZhbHNlKSByZXR1cm4gcmVzdWx0c1tpXTtcbiAgICAgICAgICB9XG4gICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgICAgIGlmIChyZXR1cm5UeXBlID09ICdhbGwnKSB7XG4gICAgICAgICAgdmFyIGkgPSByZXN1bHRzLmxlbmd0aDtcbiAgICAgICAgICB3aGlsZSAoaS0tKSB7XG4gICAgICAgICAgICBpZiAocmVzdWx0c1tpXSA9PT0gZmFsc2UpIHJldHVybiByZXN1bHRzW2ldO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gcmVzdWx0cztcbiAgICAgIH07XG5cbiAgICAgIHZhciBwcm94eSA9IGZ1bmN0aW9uKGRlc3RpbmF0aW9uLCBtZXNzYWdlKSB7XG4gICAgICAgIHRoaXMub24obWVzc2FnZSwgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgZGVzdGluYXRpb24ucG9zdChtZXNzYWdlLCBBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChhcmd1bWVudHMpKTtcbiAgICAgICAgfSk7XG4gICAgICB9O1xuXG4gICAgICB2YXIgZGlzcGF0Y2hlciA9IHtcbiAgICAgICAgb246IG9uLFxuICAgICAgICBwb3N0OiBwb3N0LFxuICAgICAgICBwcm94eTogcHJveHksXG4gICAgICB9O1xuICAgICAgRGlzcGF0Y2hlci5kaXNwYXRjaGVycy5wdXNoKGRpc3BhdGNoZXIpO1xuICAgICAgcmV0dXJuIGRpc3BhdGNoZXI7XG4gICAgfTtcblxuICAgIERpc3BhdGNoZXIuZGlzcGF0Y2hlcnMgPSBbXTtcbiAgICBEaXNwYXRjaGVyLnBvc3QgPSBmdW5jdGlvbihhc3luY2gsIG1lc3NhZ2UsIGFyZ3MsIHJldHVyblR5cGUpIHtcbiAgICAgICQuZWFjaChEaXNwYXRjaGVyLmRpc3BhdGNoZXJzLCBmdW5jdGlvbihkaXNwYXRjaGVyTm8sIGRpc3BhdGNoZXIpIHtcbiAgICAgICAgZGlzcGF0Y2hlci5wb3N0KGFzeW5jaCwgbWVzc2FnZSwgYXJncywgcmV0dXJuVHlwZSk7XG4gICAgICB9KTtcbiAgICB9O1xuXG4gICAgcmV0dXJuIERpc3BhdGNoZXI7XG59KShqUXVlcnksIHdpbmRvdyk7XG5cbi8vIEJSQVQgU1RBTkRBTE9ORSBMSUJSQVJZIEJFR0lOXG4vLyBCcm93c2VyaWZ5IGV4cG9ydFxubW9kdWxlLmV4cG9ydHMgPSBEaXNwYXRjaGVyO1xuLy8gQlJBVCBTVEFOREFMT05FIExJQlJBUlkgRU5EXG4iLCJ2YXIgTG9jYWxBamF4ID0gKGZ1bmN0aW9uKCQsIHdpbmRvdywgdW5kZWZpbmVkKSB7XG4gICAgdmFyIExvY2FsQWpheCA9IGZ1bmN0aW9uKGRpc3BhdGNoZXIsIG1heEZyYWdtZW50TGVuZ3RoKSB7XG4gICAgICAgIHZhciB0aGF0ID0gdGhpcztcblxuICAgICAgICB2YXIgZmluZFR5cGUgPSBmdW5jdGlvbiAoZW50aXR5VHlwZXMsIHR5cGUpIHtcbiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgZW50aXR5VHlwZXMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgICAgICB2YXIgZW50aXR5VHlwZSA9IGVudGl0eVR5cGVzW2ldO1xuICAgICAgICAgICAgICAgIGlmIChlbnRpdHlUeXBlLnR5cGUgPT09IHR5cGUpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGVudGl0eVR5cGU7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGVudGl0eVR5cGUuY2hpbGRyZW4gJiYgZW50aXR5VHlwZS5jaGlsZHJlbi5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciByZXN1bHQgPSBmaW5kVHlwZShlbnRpdHlUeXBlLmNoaWxkcmVuLCB0eXBlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZXN1bHQgIT09IG51bGwpe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgfTtcblxuICAgICAgICB2YXIgY3JlYXRlQW5ub3RhdGlvbiA9IGZ1bmN0aW9uKGRhdGEpe1xuICAgICAgICAgICAgdmFyIGF0dHJzID0gSlNPTi5wYXJzZShkYXRhLmF0dHJpYnV0ZXMpLFxuICAgICAgICAgICAgICAgIG9mZnNldHMgPSBKU09OLnBhcnNlKGRhdGEub2Zmc2V0cyksXG4gICAgICAgICAgICAgICAgZV90eXBlID0gZmluZFR5cGUoZGF0YS5jb2xsZWN0aW9uLmVudGl0eV90eXBlcywgZGF0YS50eXBlKTtcbiAgICAgICAgICAgICAgICBlX2lkID0gXCJcIjsvL0VudGl0eSBvciBUcmlnZ2VyXG4gICAgICAgICAgICBpZighZV90eXBlKXtcbiAgICAgICAgICAgICAgICAvL1RyaWdnZXJcbiAgICAgICAgICAgICAgICBlX3R5cGUgPSBkYXRhLmNvbGxlY3Rpb24uZXZlbnRfdHlwZXMuZmluZCggeCA9PiB4LnR5cGUgPT09IGRhdGEudHlwZSApO1xuICAgICAgICAgICAgICAgIGlmKGVfdHlwZSl7XG4gICAgICAgICAgICAgICAgICAgIHZhciB0cmlnZ2VyX2lkID0gXCJUXCIgKyAodGhhdC5kb2N1bWVudC50cmlnZ2Vycy5sZW5ndGggKyAxKTsgLy9UT0RPOiBtdXN0IGFic29sdXRlbHkgYmUgdW5pcXVlXG4gICAgICAgICAgICAgICAgICAgIGVfaWQgPSBcIkVcIiArICh0aGF0LmRvY3VtZW50LnRyaWdnZXJzLmxlbmd0aCArIDEpOyAvL1RPRE86IG11c3QgYWJzb2x1dGVseSBiZSB1bmlxdWVcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5kb2N1bWVudC50cmlnZ2Vycy5wdXNoKFtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRyaWdnZXJfaWQsXG4gICAgICAgICAgICAgICAgICAgICAgICBkYXRhLnR5cGUsXG4gICAgICAgICAgICAgICAgICAgICAgICBvZmZzZXRzXG4gICAgICAgICAgICAgICAgICAgIF0pO1xuICAgICAgICAgICAgICAgICAgICBkYXRhLmRvY3VtZW50LmV2ZW50cy5wdXNoKFtcbiAgICAgICAgICAgICAgICAgICAgICAgIGVfaWQsXG4gICAgICAgICAgICAgICAgICAgICAgICB0cmlnZ2VyX2lkLFxuICAgICAgICAgICAgICAgICAgICAgICAgW11cbiAgICAgICAgICAgICAgICAgICAgXSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfWVsc2V7XG4gICAgICAgICAgICAgICAgdmFyIGVfaWQgPSBcIk5cIiArICh0aGF0LmRvY3VtZW50LmVudGl0aWVzLmxlbmd0aCArIDEpLCAvL1RPRE86IG11c3QgYWJzb2x1dGVseSBiZSB1bmlxdWVcbiAgICAgICAgICAgICAgICAgICAgbmV3X29mZnNldHMgPSBzcGxpdFRvb0xvbmdGcmFnbWVudChvZmZzZXRzLCBkYXRhLCBlX2lkKTtcblxuICAgICAgICAgICAgICAgIC8vRW50aXR5XG4gICAgICAgICAgICAgICAgZGF0YS5kb2N1bWVudC5lbnRpdGllcy5wdXNoKFtcbiAgICAgICAgICAgICAgICAgICAgZV9pZCxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS50eXBlLFxuICAgICAgICAgICAgICAgICAgICBuZXdfb2Zmc2V0c1xuICAgICAgICAgICAgICAgIF0pO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBmb3IgKHZhciBrZXkgaW4gYXR0cnMpIHtcbiAgICAgICAgICAgICAgICBpZihhdHRycy5oYXNPd25Qcm9wZXJ0eShrZXkpICYmIGF0dHJzW2tleV0pe1xuICAgICAgICAgICAgICAgICAgICBkYXRhLmRvY3VtZW50LmF0dHJpYnV0ZXMucHVzaChbXG4gICAgICAgICAgICAgICAgICAgICAgICBcIkFcIiArICh0aGF0LmRvY3VtZW50LmF0dHJpYnV0ZXMubGVuZ3RoICsgMSksIC8vVE9ETzogbXVzdCBhYnNvbHV0ZWx5IGJlIHVuaXF1ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGtleSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGVfaWQsXG4gICAgICAgICAgICAgICAgICAgICAgICBhdHRyc1trZXldXG4gICAgICAgICAgICAgICAgICAgIF0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmKGRhdGEuY29tbWVudC5sZW5ndGgpe1xuICAgICAgICAgICAgICAgIGRhdGEuZG9jdW1lbnQuY29tbWVudHMucHVzaChbXG4gICAgICAgICAgICAgICAgICAgIGVfaWQsXG4gICAgICAgICAgICAgICAgICAgIFwiQW5ub3RhdG9yTm90ZXNcIixcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5jb21tZW50XG4gICAgICAgICAgICAgICAgXSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIGRhdGE6IGRhdGEsXG4gICAgICAgICAgICAgICAgYWN0aW9uOiBkYXRhLmFjdGlvbixcbiAgICAgICAgICAgICAgICBhbm5vdGF0aW9uczoge1xuICAgICAgICAgICAgICAgICAgICBcInNvdXJjZV9maWxlc1wiOiBkYXRhLmRvY3VtZW50LnNvdXJjZV9maWxlcyxcbiAgICAgICAgICAgICAgICAgICAgXCJtb2RpZmljYXRpb25zXCI6IGRhdGEuZG9jdW1lbnQubW9kaWZpY2F0aW9ucyxcbiAgICAgICAgICAgICAgICAgICAgXCJub3JtYWxpemF0aW9uc1wiOiBkYXRhLmRvY3VtZW50Lm5vcm1hbGl6YXRpb25zLFxuICAgICAgICAgICAgICAgICAgICBcInRleHRcIjogZGF0YS5kb2N1bWVudC50ZXh0LFxuICAgICAgICAgICAgICAgICAgICBcImVudGl0aWVzXCIgOiBkYXRhLmRvY3VtZW50LmVudGl0aWVzLFxuICAgICAgICAgICAgICAgICAgICBcImF0dHJpYnV0ZXNcIjogZGF0YS5kb2N1bWVudC5hdHRyaWJ1dGVzLFxuICAgICAgICAgICAgICAgICAgICBcInJlbGF0aW9uc1wiOiBkYXRhLmRvY3VtZW50LnJlbGF0aW9ucyxcbiAgICAgICAgICAgICAgICAgICAgXCJ0cmlnZ2Vyc1wiOiBkYXRhLmRvY3VtZW50LnRyaWdnZXJzLFxuICAgICAgICAgICAgICAgICAgICBcImV2ZW50c1wiOiBkYXRhLmRvY3VtZW50LmV2ZW50cyxcbiAgICAgICAgICAgICAgICAgICAgXCJjb21tZW50c1wiOiBkYXRhLmRvY3VtZW50LmNvbW1lbnRzXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBlZGl0ZWQ6IFtbZV9pZF1dLFxuICAgICAgICAgICAgICAgIG1lc3NhZ2VzOiBbXSxcbiAgICAgICAgICAgICAgICBwcm90b2NvbDogMVxuICAgICAgICAgICAgfTtcbiAgICAgICAgfTtcblxuICAgICAgICAvLyBWYWxpZGF0ZSBtYXggZnJhZ21lbnQgbGVuZ3RoIGJhc2VkIG9uIG9wdGlvbnMubWF4RnJhZ21lbnRMZW5ndGhcbiAgICAgICAgLy8gVXNlIGRpc2NvbnRpbmd1aXR5IHRvIGZpeCBsb25nIGFubm90YXRpb25zIGdsaXRjaGVzIGJlZm9yZSBjYWxsaW5nIEJSQVQgcmVuZGVyaW5nIGVuZ2luZS5cbiAgICAgICAgdmFyIHNwbGl0VG9vTG9uZ0ZyYWdtZW50ID0gZnVuY3Rpb24ob2Zmc2V0cywgZGF0YSwgZV9pZCl7XG4gICAgICAgICAgICB2YXIgbmV3X29mZnNldHMgPSBbXTtcblxuICAgICAgICAgICAgaWYobWF4RnJhZ21lbnRMZW5ndGggPiAwICYmIG9mZnNldHMuZmluZCggeCA9PiAoeFsxXSAtIHhbMF0pID4gbWF4RnJhZ21lbnRMZW5ndGgpKXtcbiAgICAgICAgICAgICAgICBvZmZzZXRzLmZvckVhY2goZnVuY3Rpb24oZnJhZ21lbnQpe1xuICAgICAgICAgICAgICAgICAgICB2YXIgZnJvbSA9IGZyYWdtZW50WzBdLFxuICAgICAgICAgICAgICAgICAgICAgICAgdG8gPSBmcmFnbWVudFsxXSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHN1YnRleHQgPSBkYXRhLmRvY3VtZW50LnRleHQuc3Vic3RyaW5nKGZyb20sIHRvKTtcblxuICAgICAgICAgICAgICAgICAgICBpZih0byAtIGZyb20gPiBtYXhGcmFnbWVudExlbmd0aCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGZyb21fZW5kID0gZnJvbSArIChzdWJ0ZXh0LmluZGV4T2YoJyAnKSksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9fc3RhcnQgPSB0byAtIChzdWJ0ZXh0Lmxlbmd0aCAtIChzdWJ0ZXh0Lmxhc3RJbmRleE9mKCcgJykgKyAxKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBuZXdfb2Zmc2V0cy5wdXNoKFtmcm9tLCBmcm9tX2VuZCBdKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIG5ld19vZmZzZXRzLnB1c2goW3RvX3N0YXJ0LCB0b10pO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBBZGQgc3BlY2lhbCBhdHRyaWJ1dGUgZm9yIHN5bWJvbGljIHJlcHJlc2VudGF0aW9uXG4gICAgICAgICAgICAgICAgICAgICAgICBkYXRhLmRvY3VtZW50LmF0dHJpYnV0ZXMucHVzaChbXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJBXCIgKyAodGhhdC5kb2N1bWVudC5hdHRyaWJ1dGVzLmxlbmd0aCArIDEpLCAvL1RPRE86IG11c3QgYWJzb2x1dGVseSBiZSB1bmlxdWUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgTE9OR19BTk5PVEFUSU9OX0NPTlNULFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVfaWQsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgW2Zyb20sdG9dXG4gICAgICAgICAgICAgICAgICAgICAgICBdKTtcbiAgICAgICAgICAgICAgICAgICAgfWVsc2V7XG4gICAgICAgICAgICAgICAgICAgICAgICBuZXdfb2Zmc2V0cy5wdXNoKFtmcm9tLCB0byBdKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfWVsc2V7XG4gICAgICAgICAgICAgICAgbmV3X29mZnNldHMgPSBvZmZzZXRzO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIG5ld19vZmZzZXRzO1xuICAgICAgICB9O1xuXG4gICAgICAgIHZhciBlZGl0QW5ub3RhdGlvbiA9IGZ1bmN0aW9uKGRhdGEpe1xuICAgICAgICAgICAgdmFyIGVfdHlwZSA9IHt9LCAvL0VudGl0eSBvciBUcmlnZ2VyXG4gICAgICAgICAgICAgICAgYXR0cnMgPSBKU09OLnBhcnNlKGRhdGEuYXR0cmlidXRlcyksXG4gICAgICAgICAgICAgICAgb2Zmc2V0cyA9IEpTT04ucGFyc2UoZGF0YS5vZmZzZXRzKTtcblxuICAgICAgICAgICAgLy9FZGl0IGFubm90YXRpb24gVE9ETzogVmFsaWRhdGlvbiBpcyBiYXNlZCBvbiBpZCwgZml4IHRoaXNcbiAgICAgICAgICAgIGlmKGRhdGEuaWQuc3Vic3RyaW5nKDAsIDEpID09IFwiRVwiKXtcbiAgICAgICAgICAgICAgICAvL0V2ZW50IGFubm90YXRpb25cbiAgICAgICAgICAgICAgICAvL2RhdGEubm9ybWFsaXNhdGlvbnMgPz9cbiAgICAgICAgICAgICAgICB2YXIgYW5ub3RhdGlvbiA9IGRhdGEuZG9jdW1lbnQuZXZlbnRzLmZpbmQoIHggPT4geFswXSA9PT0gZGF0YS5pZCApO1xuICAgICAgICAgICAgICAgIHZhciB0cmlnZ2VyX2lkID0gYW5ub3RhdGlvblsxXTtcbiAgICAgICAgICAgICAgICB2YXIgdHJpZ2dlciA9IGRhdGEuZG9jdW1lbnQudHJpZ2dlcnMuZmluZCggeCA9PiB4WzBdID09PSB0cmlnZ2VyX2lkICk7XG4gICAgICAgICAgICAgICAgdHJpZ2dlclsxXSA9IGRhdGEudHlwZTtcbiAgICAgICAgICAgICAgICB0cmlnZ2VyWzJdID0gb2Zmc2V0cztcbiAgICAgICAgICAgICAgICBlX3R5cGUgPSBkYXRhLmNvbGxlY3Rpb24uZXZlbnRfdHlwZXMuZmluZCggeCA9PiB4LnR5cGUgPT09IGRhdGEudHlwZSApO1xuICAgICAgICAgICAgfWVsc2UgaWYoZGF0YS5pZC5zdWJzdHJpbmcoMCwgMSkgPT0gXCJOXCIpe1xuICAgICAgICAgICAgICAgIC8vRW50aXR5IGFubm90YXRpb25cbiAgICAgICAgICAgICAgICB2YXIgZW50aXR5ID0gZGF0YS5kb2N1bWVudC5lbnRpdGllcy5maW5kKCB4ID0+IHhbMF0gPT09IGRhdGEuaWQgKTtcbiAgICAgICAgICAgICAgICBlbnRpdHlbMV0gPSBkYXRhLnR5cGU7XG4gICAgICAgICAgICAgICAgZW50aXR5WzJdID0gc3BsaXRUb29Mb25nRnJhZ21lbnQob2Zmc2V0cywgZGF0YSwgZGF0YS5pZCk7XG4gICAgICAgICAgICAgICAgZV90eXBlID0gZmluZFR5cGUoZGF0YS5jb2xsZWN0aW9uLmVudGl0eV90eXBlcywgZGF0YS50eXBlKTtcblxuICAgICAgICAgICAgfWVsc2V7XG4gICAgICAgICAgICAgICAgLy9UT0RPOiBFcnJvclxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYoZV90eXBlKXtcbiAgICAgICAgICAgICAgICAvL1JlbW92ZWQgYWxsIGF0dHJpYnV0ZXMgZm9yIHRoaXMgcGFydGljdWxhciBhbm5vdGF0aW9uIGlkXG4gICAgICAgICAgICAgICAgdmFyIGV4aXN0aW5nX2F0dHJzID0gZGF0YS5kb2N1bWVudC5hdHRyaWJ1dGVzLmZpbHRlciggeCA9PiB4WzJdID09PSBkYXRhLmlkKTtcbiAgICAgICAgICAgICAgICBleGlzdGluZ19hdHRycy5mb3JFYWNoKGZ1bmN0aW9uKGF0dHIpe1xuICAgICAgICAgICAgICAgICAgICB2YXIgaW5kZXggPSBkYXRhLmRvY3VtZW50LmF0dHJpYnV0ZXMuaW5kZXhPZiggeCA9PiB4WzBdID09PSBhdHRyWzBdKTsgLy9UT0RPOiB0aGlzIGFsd2F5cyByZXR1cm5zIC0xXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuZG9jdW1lbnQuYXR0cmlidXRlcy5zcGxpY2UoaW5kZXgsIDEpO1xuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgLy9SZS1hZGQgYWxsIGF0dHJpYnV0ZXNcbiAgICAgICAgICAgICAgICBmb3IgKHZhciBrZXkgaW4gYXR0cnMpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYoYXR0cnMuaGFzT3duUHJvcGVydHkoa2V5KSAmJiBhdHRyc1trZXldKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBleGlzdGluZ19hdHRycy5maW5kKHggPT4geFsxXSA9PT0ga2V5KTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgZGF0YS5kb2N1bWVudC5hdHRyaWJ1dGVzLnB1c2goW1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiQVwiICsgKHRoYXQuZG9jdW1lbnQuYXR0cmlidXRlcy5sZW5ndGggKyAxKSwgLy9UT0RPOiBtdXN0IGFic29sdXRlbHkgYmUgdW5pcXVlLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGtleSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhLmlkLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGF0dHJzW2tleV1cbiAgICAgICAgICAgICAgICAgICAgICAgIF0pO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgLy9BZGQvRWRpdCBjb21tZW50IGNvbnRlbnRcbiAgICAgICAgICAgICAgICBpZihkYXRhLmNvbW1lbnQubGVuZ3RoKXtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGNvbW1lbnQgPSBkYXRhLmRvY3VtZW50LmNvbW1lbnRzLmZpbmQoIHggPT4geFswXSA9PT0gZGF0YS5pZCk7XG4gICAgICAgICAgICAgICAgICAgIGlmKGNvbW1lbnQpe1xuICAgICAgICAgICAgICAgICAgICAgICAgLy9FZGl0XG4gICAgICAgICAgICAgICAgICAgICAgICBjb21tZW50WzJdID0gZGF0YS5jb21tZW50O1xuICAgICAgICAgICAgICAgICAgICB9ZWxzZXtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vQWRkXG4gICAgICAgICAgICAgICAgICAgICAgICBkYXRhLmRvY3VtZW50LmNvbW1lbnRzLnB1c2goW1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGEuaWQsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJBbm5vdGF0b3JOb3Rlc1wiLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGEuY29tbWVudFxuICAgICAgICAgICAgICAgICAgICAgICAgXSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgLy9Db21tZW50cyAmJiBBdHRyaWJ1dGVzIGFyZSBkZWFjdGl2YXRlZCBmb3IgcmVsYXRpb25zIGF0IHRoaXMgcG9pbnRcblxuICAgICAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgICAgIGRhdGE6IGRhdGEsXG4gICAgICAgICAgICAgICAgICAgIGFjdGlvbjogZGF0YS5hY3Rpb24sXG4gICAgICAgICAgICAgICAgICAgIGFubm90YXRpb25zOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBcInNvdXJjZV9maWxlc1wiOiBkYXRhLmRvY3VtZW50LnNvdXJjZV9maWxlcyxcbiAgICAgICAgICAgICAgICAgICAgICAgIFwibW9kaWZpY2F0aW9uc1wiOiBkYXRhLmRvY3VtZW50Lm1vZGlmaWNhdGlvbnMsXG4gICAgICAgICAgICAgICAgICAgICAgICBcIm5vcm1hbGl6YXRpb25zXCI6IGRhdGEuZG9jdW1lbnQubm9ybWFsaXphdGlvbnMsXG4gICAgICAgICAgICAgICAgICAgICAgICBcInRleHRcIjogZGF0YS5kb2N1bWVudC50ZXh0LFxuICAgICAgICAgICAgICAgICAgICAgICAgXCJlbnRpdGllc1wiIDogZGF0YS5kb2N1bWVudC5lbnRpdGllcyxcbiAgICAgICAgICAgICAgICAgICAgICAgIFwiYXR0cmlidXRlc1wiOiBkYXRhLmRvY3VtZW50LmF0dHJpYnV0ZXMsXG4gICAgICAgICAgICAgICAgICAgICAgICBcInJlbGF0aW9uc1wiOiBkYXRhLmRvY3VtZW50LnJlbGF0aW9ucyxcbiAgICAgICAgICAgICAgICAgICAgICAgIFwidHJpZ2dlcnNcIjogZGF0YS5kb2N1bWVudC50cmlnZ2VycyxcbiAgICAgICAgICAgICAgICAgICAgICAgIFwiZXZlbnRzXCI6IGRhdGEuZG9jdW1lbnQuZXZlbnRzLFxuICAgICAgICAgICAgICAgICAgICAgICAgXCJjb21tZW50c1wiOiBkYXRhLmRvY3VtZW50LmNvbW1lbnRzXG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIGVkaXRlZDogW1tkYXRhLmlkXV0sXG4gICAgICAgICAgICAgICAgICAgIG1lc3NhZ2VzOiBbXSxcbiAgICAgICAgICAgICAgICAgICAgcHJvdG9jb2w6IDFcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgfWVsc2V7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHt9OyAvL1RPRE86IEVycm9yIGhhbmRsaW5nXG4gICAgICAgICAgICB9XG5cbiAgICAgICAgfTtcblxuICAgICAgICB2YXIgZGVsZXRlQW5ub3RhdGlvbiA9IGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICAvLyBkZWxldGUgdGhlIGVudGl0eS4gVE9ETzogYWxzbyBkZWxldGUgZXZlbnRzIGV0Y1xuICAgICAgICAgICAgdmFyIGVudGl0aWVzID0gZGF0YS5kb2N1bWVudC5lbnRpdGllcztcbiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgZW50aXRpZXMubGVuZ3RoOyBpKyspe1xuICAgICAgICAgICAgICAgIGlmIChlbnRpdGllc1tpXVswXSA9PT0gZGF0YS5pZCl7ICAvLyBlbnRpdHkgZm9ybWF0IFtpZCwgdHlwZSwgb2Zmc2V0c10sIGUuZy4gW1wiTjFcIiwgXCJQZXJzb25cIiwgQXJyYXlbMl1dXG4gICAgICAgICAgICAgICAgICAgIGVudGl0aWVzLnNwbGljZShpLCAxKTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLy8gZGVsZXRlIHJlbGF0aW9ucyBjb250YWluaW5nIHRoZSBlbnRpdHkgVE9ETzogYXR0cmlidXRlcyBldGM/XG4gICAgICAgICAgICB2YXIgcmVsYXRpb25zID0gZGF0YS5kb2N1bWVudC5yZWxhdGlvbnM7XG4gICAgICAgICAgICBmb3IgKHZhciBpID0gcmVsYXRpb25zLmxlbmd0aCAtIDE7IGkgPj0gMDsgaS0tKXtcbiAgICAgICAgICAgICAgICAvLyByZWxhdGlvbiBmb3JtYXQ6IFtcIlIxXCIsIFwiRnJpZW5kXCIsIEFycmF5WzJdXVxuICAgICAgICAgICAgICAgIHZhciByZWxhdGlvbiA9IHJlbGF0aW9uc1tpXVsyXTsgIC8vIGUuZy4gW1snRnJvbScsIFwiTjFcIl0sIFsnVG8nLCAnTjInXV1cbiAgICAgICAgICAgICAgICBpZiAocmVsYXRpb25bMF1bMV0gPT09IGRhdGEuaWQgfHwgcmVsYXRpb25bMV1bMV0gPT09IGRhdGEuaWQpe1xuICAgICAgICAgICAgICAgICAgICByZWxhdGlvbnMuc3BsaWNlKGksIDEpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICAgICAgYWN0aW9uOiBkYXRhLmFjdGlvbixcbiAgICAgICAgICAgICAgICAgICAgYW5ub3RhdGlvbnM6IGRhdGEuZG9jdW1lbnQsXG4gICAgICAgICAgICAgICAgICAgIGVkaXRlZDogW10sXG4gICAgICAgICAgICAgICAgICAgIG1lc3NhZ2VzOiBbXSxcbiAgICAgICAgICAgICAgICAgICAgcHJvdG9jb2w6IDFcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICB9O1xuXG4gICAgICAgIHZhciBjcmVhdGVSZWxhdGlvbiA9IGZ1bmN0aW9uKGRhdGEpe1xuICAgICAgICAgICAgdmFyIGVfdHlwZSA9IGRhdGEuY29sbGVjdGlvbi5yZWxhdGlvbl90eXBlcy5maW5kKCB4ID0+IHgudHlwZSA9PT0gZGF0YS50eXBlICk7IC8vRW50aXR5IG9yIEV2ZW50XG5cbiAgICAgICAgICAgIGlmKCFlX3R5cGUpe1xuICAgICAgICAgICAgICAgIC8vRXZlbnQgcmVsYXRpb25cbiAgICAgICAgICAgICAgICAvKmRhdGEuY29sbGVjdGlvbi5ldmVudF90eXBlcy5mb3JFYWNoKGZ1bmN0aW9uKGV2ZW50KXtcbiAgICAgICAgICAgICAgICAgICAgZXZlbnQuYXJjcy5mb3JFYWNoKGZ1bmN0aW9uKGVSZWxhdGlvbil7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZihlUmVsYXRpb24udHlwZSA9PT0gZGF0YS50eXBlKXtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlX3R5cGUgPSBldmVudDtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL1RPRE86IEV4aXQgbG9vcFxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgIH0pOyovXG4gICAgICAgICAgICAgICAgZV90eXBlID0gZGF0YS5kb2N1bWVudC5ldmVudHMuZmluZCggeCA9PiB4WzBdID09PSBkYXRhLm9yaWdpbiApO1xuICAgICAgICAgICAgICAgIGlmKGVfdHlwZSl7XG4gICAgICAgICAgICAgICAgICAgIGVfdHlwZVsyXS5wdXNoKFtcbiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGEudHlwZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGEudGFyZ2V0XG4gICAgICAgICAgICAgICAgICAgIF0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1lbHNle1xuICAgICAgICAgICAgICAgIC8vRW50aXR5IHJlbGF0aW9uXG4gICAgICAgICAgICAgICAgdmFyIG9iaiA9XG4gICAgICAgICAgICAgICAgW1xuICAgICAgICAgICAgICAgICAgICBcIlJcIiArICh0aGF0LmRvY3VtZW50LnJlbGF0aW9ucy5sZW5ndGggKyAxKSwgLy9UT0RPOiBtdXN0IGFic29sdXRlbHkgbWUgdW5pcXVlXG4gICAgICAgICAgICAgICAgICAgIGRhdGEudHlwZSxcbiAgICAgICAgICAgICAgICAgICAgW1xuICAgICAgICAgICAgICAgICAgICAgICAgW2VfdHlwZS5hcmdzWzBdLnJvbGUsIGRhdGEub3JpZ2luXSxcbiAgICAgICAgICAgICAgICAgICAgICAgIFtlX3R5cGUuYXJnc1sxXS5yb2xlLCBkYXRhLnRhcmdldF1dXG4gICAgICAgICAgICAgICAgXTtcbiAgICAgICAgICAgICAgICBkYXRhLmRvY3VtZW50LnJlbGF0aW9ucy5wdXNoKG9iaik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIGFjdGlvbjogZGF0YS5hY3Rpb24sXG4gICAgICAgICAgICAgICAgYW5ub3RhdGlvbnM6IHtcbiAgICAgICAgICAgICAgICAgICAgXCJzb3VyY2VfZmlsZXNcIjogZGF0YS5kb2N1bWVudC5zb3VyY2VfZmlsZXMsXG4gICAgICAgICAgICAgICAgICAgIFwibW9kaWZpY2F0aW9uc1wiOiBkYXRhLmRvY3VtZW50Lm1vZGlmaWNhdGlvbnMsXG4gICAgICAgICAgICAgICAgICAgIFwibm9ybWFsaXphdGlvbnNcIjogZGF0YS5kb2N1bWVudC5ub3JtYWxpemF0aW9ucyxcbiAgICAgICAgICAgICAgICAgICAgXCJ0ZXh0XCI6IGRhdGEuZG9jdW1lbnQudGV4dCxcbiAgICAgICAgICAgICAgICAgICAgXCJlbnRpdGllc1wiIDogZGF0YS5kb2N1bWVudC5lbnRpdGllcyxcbiAgICAgICAgICAgICAgICAgICAgXCJhdHRyaWJ1dGVzXCI6IGRhdGEuZG9jdW1lbnQuYXR0cmlidXRlcyxcbiAgICAgICAgICAgICAgICAgICAgXCJyZWxhdGlvbnNcIjogZGF0YS5kb2N1bWVudC5yZWxhdGlvbnMsXG4gICAgICAgICAgICAgICAgICAgIFwidHJpZ2dlcnNcIjogZGF0YS5kb2N1bWVudC50cmlnZ2VycyxcbiAgICAgICAgICAgICAgICAgICAgXCJldmVudHNcIjogZGF0YS5kb2N1bWVudC5ldmVudHNcbiAgICAgICAgICAgICAgICAgICAgLy9cImN0aW1lXCI6IDEuMCxcbiAgICAgICAgICAgICAgICAgICAgLy9cImNvbGxlY3Rpb25cIjogXCJcIixcbiAgICAgICAgICAgICAgICAgICAgLy9cImRvY3VtZW50XCI6IFwiXCIsXG4gICAgICAgICAgICAgICAgICAgIC8vXCJlcXVpdnNcIjogW10sXG4gICAgICAgICAgICAgICAgICAgIC8vXCJtdGltZVwiOiAxLjAsXG4gICAgICAgICAgICAgICAgICAgIC8vXCJzZW50ZW5jZXNfb2Zmc2V0c1wiOiBbXSxcbiAgICAgICAgICAgICAgICAgICAgLy9cInRva2VuX29mZnNldHNcIjogW10sXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBlZGl0ZWQ6IFtbZGF0YS5vcmlnaW5dLCBbZGF0YS50YXJnZXRdXSxcbiAgICAgICAgICAgICAgICBtZXNzYWdlczogW10sXG4gICAgICAgICAgICAgICAgcHJvdG9jb2w6IDFcbiAgICAgICAgICAgIH07XG4gICAgICAgIH07XG5cbiAgICAgICAgdmFyIGVkaXRSZWxhdGlvbiA9IGZ1bmN0aW9uKGRhdGEpe1xuICAgICAgICAgICAgdmFyIGVfdHlwZSA9IGRhdGEuY29sbGVjdGlvbi5yZWxhdGlvbl90eXBlcy5maW5kKCB4ID0+IHgudHlwZSA9PT0gZGF0YS50eXBlICk7IC8vRW50aXR5IG9yIEV2ZW50XG5cbiAgICAgICAgICAgIGlmKCFlX3R5cGUpe1xuICAgICAgICAgICAgICAgIC8vRXZlbnQgcmVsYXRpb25cbiAgICAgICAgICAgICAgICBlX3R5cGUgPSBkYXRhLmRvY3VtZW50LmV2ZW50cy5maW5kKCB4ID0+IHhbMF0gPT09IGRhdGEub3JpZ2luICk7XG4gICAgICAgICAgICAgICAgaWYoZV90eXBlKXtcblxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1lbHNle1xuICAgICAgICAgICAgICAgIC8vRW50aXR5IHJlbGF0aW9uXG4gICAgICAgICAgICAgICAgdmFyIHJlbGF0aW9uID0gZGF0YS5kb2N1bWVudC5yZWxhdGlvbnMuZmluZCggeCA9PiB4WzFdID09PSBkYXRhLm9sZF90eXBlICYmIHhbMl1bMF1bMV0gPT09IGRhdGEub3JpZ2luICYmIHhbMl1bMV1bMV0gPT09IGRhdGEub2xkX3RhcmdldCApO1xuICAgICAgICAgICAgICAgIHJlbGF0aW9uWzFdID0gZGF0YS50eXBlO1xuICAgICAgICAgICAgICAgIHJlbGF0aW9uWzJdID0gW1xuICAgICAgICAgICAgICAgICAgICBbZV90eXBlLmFyZ3NbMF0ucm9sZSwgZGF0YS5vcmlnaW5dLFxuICAgICAgICAgICAgICAgICAgICBbZV90eXBlLmFyZ3NbMV0ucm9sZSwgZGF0YS50YXJnZXRdXG4gICAgICAgICAgICAgICAgXTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICBhY3Rpb246IGRhdGEuYWN0aW9uLFxuICAgICAgICAgICAgICAgIGFubm90YXRpb25zOiB7XG4gICAgICAgICAgICAgICAgICAgIFwic291cmNlX2ZpbGVzXCI6IGRhdGEuZG9jdW1lbnQuc291cmNlX2ZpbGVzLFxuICAgICAgICAgICAgICAgICAgICBcIm1vZGlmaWNhdGlvbnNcIjogZGF0YS5kb2N1bWVudC5tb2RpZmljYXRpb25zLFxuICAgICAgICAgICAgICAgICAgICBcIm5vcm1hbGl6YXRpb25zXCI6IGRhdGEuZG9jdW1lbnQubm9ybWFsaXphdGlvbnMsXG4gICAgICAgICAgICAgICAgICAgIFwidGV4dFwiOiBkYXRhLmRvY3VtZW50LnRleHQsXG4gICAgICAgICAgICAgICAgICAgIFwiZW50aXRpZXNcIiA6IGRhdGEuZG9jdW1lbnQuZW50aXRpZXMsXG4gICAgICAgICAgICAgICAgICAgIFwiYXR0cmlidXRlc1wiOiBkYXRhLmRvY3VtZW50LmF0dHJpYnV0ZXMsXG4gICAgICAgICAgICAgICAgICAgIFwicmVsYXRpb25zXCI6IGRhdGEuZG9jdW1lbnQucmVsYXRpb25zLFxuICAgICAgICAgICAgICAgICAgICBcInRyaWdnZXJzXCI6IGRhdGEuZG9jdW1lbnQudHJpZ2dlcnMsXG4gICAgICAgICAgICAgICAgICAgIFwiZXZlbnRzXCI6IGRhdGEuZG9jdW1lbnQuZXZlbnRzLFxuICAgICAgICAgICAgICAgICAgICBcImNvbW1lbnRzXCI6IGRhdGEuZG9jdW1lbnQuY29tbWVudHNcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIGVkaXRlZDogW1tkYXRhLm9yaWdpbl0sIFtkYXRhLnRhcmdldF1dLFxuICAgICAgICAgICAgICAgIG1lc3NhZ2VzOiBbXSxcbiAgICAgICAgICAgICAgICBwcm90b2NvbDogMVxuICAgICAgICAgICAgfTtcblxuICAgICAgICB9O1xuXG4gICAgICAgIHZhciBsb2NhbEV4ZWN1dGlvbiA9IGZ1bmN0aW9uKGRhdGEsIGNhbGxiYWNrLCBtZXJnZSkge1xuICAgICAgICAgICAgZGlzcGF0Y2hlci5wb3N0KCdzcGluJyk7XG4gICAgICAgICAgICBkaXNwYXRjaGVyLnBvc3QoJ2xvY2FsLWFqYXgtYmVnaW4nLCBbZGF0YV0pO1xuICAgICAgICAgICAgdGhhdC5jb2xsZWN0aW9uID0gZGF0YS5jb2xsZWN0aW9uO1xuICAgICAgICAgICAgdGhhdC5kb2N1bWVudCA9IGRhdGEuZG9jdW1lbnQ7XG4gICAgICAgICAgICB2YXIgcmVzcG9uc2UgPSB7fTtcblxuICAgICAgICAgICAgc3dpdGNoKGRhdGEuYWN0aW9uKXtcbiAgICAgICAgICAgICAgICBjYXNlIFwiZ2V0RG9jdW1lbnRcIjpcbiAgICAgICAgICAgICAgICAgICAgLy9UT0RPXG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgXCJsb2FkQ29uZlwiOlxuICAgICAgICAgICAgICAgICAgICAvL1RPRE9cbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSBcImdldENvbGxlY3Rpb25JbmZvcm1hdGlvblwiOlxuICAgICAgICAgICAgICAgICAgICAvL1RPRE9cbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSBcImNyZWF0ZUFyY1wiOlxuICAgICAgICAgICAgICAgICAgICAvL1RPRE86IFZhbGlkYXRlIG1vZGVsIHdpdGggaW5wdXRzXG4gICAgICAgICAgICAgICAgICAgIGlmKGRhdGEub2xkX3RhcmdldCB8fCBkYXRhLm9sZF90eXBlKXtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3BvbnNlID0gZWRpdFJlbGF0aW9uKGRhdGEpO1xuICAgICAgICAgICAgICAgICAgICB9ZWxzZXtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3BvbnNlID0gY3JlYXRlUmVsYXRpb24oZGF0YSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSBcImRlbGV0ZUFyY1wiOlxuICAgICAgICAgICAgICAgICAgICAvL1RPRE9cbiAgICAgICAgICAgICAgICBjYXNlIFwicmV2ZXJzZUFyY1wiOlxuICAgICAgICAgICAgICAgICAgICAvL1RPRE9cbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSBcImNyZWF0ZVNwYW5cIjpcbiAgICAgICAgICAgICAgICAgICAgLy9FZGl0IGFuZCBDcmVhdGVkIGFjdGlvbnMgb24gRW50aXRpZXMgYXMgd2VsbCBhcyBUcmlnZ2VycyhFdmVudHMpXG4gICAgICAgICAgICAgICAgICAgIC8vVE9ETzogVmFsaWRhdGUgbW9kZWwgd2l0aCBpbnB1dHNcbiAgICAgICAgICAgICAgICAgICAgaWYoZGF0YS5pZCl7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXNwb25zZSA9IGVkaXRBbm5vdGF0aW9uKGRhdGEpO1xuICAgICAgICAgICAgICAgICAgICB9ZWxzZXtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3BvbnNlID0gY3JlYXRlQW5ub3RhdGlvbihkYXRhKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlIFwiZGVsZXRlU3BhblwiOlxuICAgICAgICAgICAgICAgICAgICByZXNwb25zZSA9IGRlbGV0ZUFubm90YXRpb24oZGF0YSk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgXCJkZWxldGVGcmFnbWVudHh5ej9cIjpcbiAgICAgICAgICAgICAgICAgICAgLy9UT0RPXG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgXCJzcGxpdFNwYW5cIjpcbiAgICAgICAgICAgICAgICAgICAgLy9UT0RPXG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgXCJ0YWdcIjpcbiAgICAgICAgICAgICAgICAgICAgLy9UT0RPID8/XG4gICAgICAgICAgICAgICAgICAgIHZhciBvYmogPSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb2xsZWN0aW9uOiBkYXRhLmNvbGxlY3Rpb24sXG4gICAgICAgICAgICAgICAgICAgICAgICBkb2N1bWVudDogZGF0YS5kb2N1bWVudCxcbiAgICAgICAgICAgICAgICAgICAgICAgIHRhZ2dlcjogZGF0YS50YWdnZXJcbiAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICBjYXNlIFwibG9naW5cIjpcbiAgICAgICAgICAgICAgICBjYXNlIFwibG9nb3V0XCI6XG4gICAgICAgICAgICAgICAgY2FzZSBcIndob2FtaVwiOlxuICAgICAgICAgICAgICAgIGNhc2UgXCJub3JtR2V0TmFtZVwiOlxuICAgICAgICAgICAgICAgIGNhc2UgXCJub3JtU2VhcmNoXCI6XG4gICAgICAgICAgICAgICAgY2FzZSBcInN1Z2dlc3RTcGFuVHlwZXNcIjpcbiAgICAgICAgICAgICAgICBjYXNlIFwiaW1wb3J0RG9jdW1lbnRcIjpcbiAgICAgICAgICAgICAgICBjYXNlIFwiZGVsZXRlRG9jdW1lbnRcIjpcbiAgICAgICAgICAgICAgICBjYXNlIFwiZGVsZXRlQ29sbGVjdGlvblwiOlxuICAgICAgICAgICAgICAgIGNhc2UgXCJ1bmRvXCI6XG4gICAgICAgICAgICAgICAgY2FzZSBcIm5vcm1EYXRhXCI6XG4gICAgICAgICAgICAgICAgY2FzZSBcIkluRG9jdW1lbnRcIjpcbiAgICAgICAgICAgICAgICBjYXNlIFwiSW5Db2xsZWN0aW9uXCI6XG4gICAgICAgICAgICAgICAgY2FzZSBcInN0b3JlU1ZHXCI6XG4gICAgICAgICAgICAgICAgY2FzZSBcImdldERvY3VtZW50VGltZXN0YW1wXCI6XG4gICAgICAgICAgICAgICAgY2FzZSBcInNhdmVDb25mXCI6XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgICAgIC8vVE9ET1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgZGlzcGF0Y2hlci5wb3N0KDAsIGNhbGxiYWNrLCBbcmVzcG9uc2VdKTtcbiAgICAgICAgICAgIGRpc3BhdGNoZXIucG9zdCgnbG9jYWwtYWpheC1kb25lJywgW3Jlc3BvbnNlXSk7XG4gICAgICAgICAgICBkaXNwYXRjaGVyLnBvc3QoJ3Vuc3BpbicpO1xuICAgICAgICB9O1xuXG4gICAgICAgIGRpc3BhdGNoZXIuXG4gICAgICAgIG9uKCdhamF4JywgbG9jYWxFeGVjdXRpb24pO1xuICAgIH07XG5cbiAgICByZXR1cm4gTG9jYWxBamF4O1xufSkoalF1ZXJ5LCB3aW5kb3cpO1xuXG4vLyBCUkFUIFNUQU5EQUxPTkUgTElCUkFSWSBCRUdJTlxuLy8gQnJvd3NlcmlmeSBleHBvcnRcbm1vZHVsZS5leHBvcnRzID0gTG9jYWxBamF4O1xuLy8gQlJBVCBTVEFOREFMT05FIExJQlJBUlkgRU5EXG4iLCIvLyAtKi0gTW9kZTogSmF2YVNjcmlwdDsgdGFiLXdpZHRoOiAyOyBpbmRlbnQtdGFicy1tb2RlOiBuaWw7IC0qLVxuLy8gdmltOnNldCBmdD1qYXZhc2NyaXB0IHRzPTIgc3c9MiBzdHM9MiBjaW5kZW50OlxudmFyIFNwaW5uZXIgPSAoZnVuY3Rpb24oJCwgd2luZG93LCB1bmRlZmluZWQpIHtcbiAgICB2YXIgU3Bpbm5lciA9IGZ1bmN0aW9uKGRpc3BhdGNoZXIsIHNwaW5FbGVtZW50KSB7XG4gICAgICB2YXIgdGhhdCA9IHRoaXM7XG4gICAgICB2YXIgc3BpbkVsZW1lbnQgPSAkKHNwaW5FbGVtZW50KTtcblxuICAgICAgdmFyIGNvdW50ID0gMDtcbiAgICAgIHZhciBzcGluID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIGlmIChjb3VudCA9PT0gMCkge1xuICAgICAgICAgIHNwaW5FbGVtZW50LmNzcygnZGlzcGxheScsICdibG9jaycpO1xuICAgICAgICB9XG4gICAgICAgIGNvdW50Kys7XG4gICAgICB9O1xuICAgICAgdmFyIHVuc3BpbiA9IGZ1bmN0aW9uKCkge1xuICAgICAgICBjb3VudC0tO1xuICAgICAgICBpZiAoY291bnQgPT09IDApIHtcbiAgICAgICAgICBzcGluRWxlbWVudC5jc3MoJ2Rpc3BsYXknLCAnbm9uZScpO1xuICAgICAgICB9XG4gICAgICB9O1xuXG4gICAgICBkaXNwYXRjaGVyLlxuICAgICAgICAgIG9uKCdzcGluJywgc3BpbikuXG4gICAgICAgICAgb24oJ3Vuc3BpbicsIHVuc3Bpbik7XG4gICAgfTtcblxuICAgIHJldHVybiBTcGlubmVyO1xufSkoalF1ZXJ5LCB3aW5kb3cpO1xuXG4vLyBCUkFUIFNUQU5EQUxPTkUgTElCUkFSWSBCRUdJTlxuLy8gQnJvd3NlcmlmeSBleHBvcnRcbm1vZHVsZS5leHBvcnRzID0gU3Bpbm5lcjtcbi8vIEJSQVQgU1RBTkRBTE9ORSBMSUJSQVJZIEVORFxuIiwidmFyIFVSTEhhc2ggPSAoZnVuY3Rpb24oJCwgd2luZG93LCB1bmRlZmluZWQpIHtcbiAgICB2YXIgVVJMSGFzaCA9IGZ1bmN0aW9uKGNvbGxlY3Rpb24sIF9kb2N1bWVudCwgX2FyZ3VtZW50cykge1xuICAgICAgICB2YXIgdGhhdCA9IHRoaXM7XG4gICAgICAgIHRoYXQuY29sbGVjdGlvbiA9IGNvbGxlY3Rpb247XG4gICAgICAgIHRoYXQuZG9jdW1lbnQgPSBfZG9jdW1lbnQgfHwgJyc7XG4gICAgICAgIHRoYXQuYXJndW1lbnRzID0gX2FyZ3VtZW50cyB8fCB7fTtcbiAgICAgICAgdGhhdC5jYWxjQXJncygpO1xuICAgIH1cblxuICAgIFVSTEhhc2gucHJvdG90eXBlID0ge1xuICAgICAgICBjYWxjQXJnczogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICB2YXIgYXJncyA9IFVSTEhhc2guc3BsaXRBcmdzKHRoaXMuYXJndW1lbnRzKTtcbiAgICAgICAgICAgIHRoaXMuaW50QXJndW1lbnRzID0gYXJnc1swXTtcbiAgICAgICAgICAgIHRoaXMuZXh0QXJndW1lbnRzID0gYXJnc1sxXTtcbiAgICAgICAgfSxcblxuICAgICAgICBzZXRBcmd1bWVudDogZnVuY3Rpb24oYXJndW1lbnQsIHZhbHVlKSB7XG4gICAgICAgICAgICBpZiAoIXRoaXMuYXJndW1lbnRzKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5hcmd1bWVudHMgPSB7fTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoaXMuYXJndW1lbnRzW2FyZ3VtZW50XSA9IHZhbHVlO1xuICAgICAgICAgICAgdGhpcy5jYWxjQXJncygpO1xuICAgICAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgICAgIH0sXG5cbiAgICAgICAgc2V0QXJndW1lbnRzOiBmdW5jdGlvbihfYXJndW1lbnRzKSB7XG4gICAgICAgICAgICAvLyB0aGUgJC5leHRlbmQgaGVyZSBiYXNpY2FsbHkgdGFrZXMgYSBjb3B5OyByYXcgYXNzaWdubWVudFxuICAgICAgICAgICAgLy8gd291bGQgYWxsb3cgY2hhbmdlcyBvZiB0aGUgYXJncyB0byBhbHRlciBvcmlnaW5hbCwgd2hpY2hcbiAgICAgICAgICAgIC8vIGNvdWxkIGJlIGUuZy4gdGhlIFwiYXJnc1wiIG9mIHNlYXJjaCByZXN1bHRzXG4gICAgICAgICAgICB0aGlzLmFyZ3VtZW50cyA9ICQuZXh0ZW5kKHt9LCBfYXJndW1lbnRzIHx8IHt9KTtcbiAgICAgICAgICAgIHRoaXMuY2FsY0FyZ3MoKTtcbiAgICAgICAgICAgIHJldHVybiB0aGlzO1xuICAgICAgICB9LFxuXG4gICAgICAgIHNldERvY3VtZW50OiBmdW5jdGlvbihfZG9jdW1lbnQpIHtcbiAgICAgICAgICAgIHRoaXMuZG9jdW1lbnQgPSBfZG9jdW1lbnQ7XG4gICAgICAgICAgICByZXR1cm4gdGhpcztcbiAgICAgICAgfSxcblxuICAgICAgICBzZXRDb2xsZWN0aW9uOiBmdW5jdGlvbihjb2xsZWN0aW9uKSB7XG4gICAgICAgICAgICB0aGlzLmNvbGxlY3Rpb24gPSBjb2xsZWN0aW9uO1xuICAgICAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgICAgIH0sXG5cbiAgICAgICAgZ2V0SGFzaDogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICB2YXIgdXJsX2hhc2ggPSB0aGlzLmNvbGxlY3Rpb24gKyB0aGlzLmRvY3VtZW50O1xuXG4gICAgICAgICAgICB2YXIgdXJsX2FyZ3MgPSBVdGlsLnBhcmFtKHRoaXMuZXh0QXJndW1lbnRzKTtcblxuICAgICAgICAgICAgaWYgKHVybF9hcmdzLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgIHVybF9oYXNoICs9ICc/JyArIHVybF9hcmdzO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAodXJsX2hhc2gubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgdXJsX2hhc2ggPSAnIycgKyB1cmxfaGFzaDtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgcmV0dXJuIHVybF9oYXNoO1xuICAgICAgICB9LFxuICAgIH07XG5cbiAgICAvLyBhcmd1bWVudHMgdGhhdCBkbyBub3QgYXBwZWFyIGluIHRoZSBVUkxcbiAgICB2YXIgSU5UX0FSR1MgPSBbJ21hdGNoJywgJ21hdGNoZm9jdXMnLCAnZWRpdGVkJ107XG5cbiAgICBVUkxIYXNoLnNwbGl0QXJncyA9IGZ1bmN0aW9uKGFyZ3MpIHtcbiAgICAgICAgdmFyIGludEFyZ3MgPSB7fTtcbiAgICAgICAgdmFyIGV4dEFyZ3MgPSAkLmV4dGVuZCh7fSwgYXJncyk7XG4gICAgICAgIHZhciBpbnRBcmdOYW1lTGVuID0gSU5UX0FSR1MubGVuZ3RoO1xuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGludEFyZ05hbWVMZW47IGkrKykge1xuICAgICAgICAgICAgaW50QXJnc1tJTlRfQVJHU1tpXV0gPSBleHRBcmdzW0lOVF9BUkdTW2ldXTtcbiAgICAgICAgICAgIGRlbGV0ZSBleHRBcmdzW0lOVF9BUkdTW2ldXTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gW2ludEFyZ3MsIGV4dEFyZ3NdO1xuICAgIH07XG5cbiAgICAvLyBUT0RPOiBEb2N1bWVudCBhbmQgY29uZm9ybSB2YXJpYWJsZXMgdG8gdGhlIHJlc3Qgb2YgdGhlIG9iamVjdFxuICAgIFVSTEhhc2gucGFyc2UgPSBmdW5jdGlvbihoYXNoKSB7XG4gICAgICAgIGlmIChoYXNoLmxlbmd0aCkge1xuICAgICAgICAgICAgLy8gUmVtb3ZlIHRoZSBsZWFkaW5nIGhhc2ggKCMpXG4gICAgICAgICAgICBoYXNoID0gaGFzaC5zdWJzdHIoMSk7XG4gICAgICAgIH1cblxuICAgICAgICB2YXIgcGF0aEFuZEFyZ3MgPSBoYXNoLnNwbGl0KCc/Jyk7XG4gICAgICAgIHZhciBwYXRoID0gcGF0aEFuZEFyZ3NbMF0gfHwgJyc7XG4gICAgICAgIHZhciBhcmdzU3RyID0gcGF0aEFuZEFyZ3NbMV0gfHwgJyc7XG4gICAgICAgIHZhciBjb2xsO1xuICAgICAgICB2YXIgc2xhc2hQb3MgPSBwYXRoLmxhc3RJbmRleE9mKCcvJyk7XG4gICAgICAgIGlmIChzbGFzaFBvcyA9PT0gLTEpIHtcbiAgICAgICAgICAgIGNvbGwgPSAnLyc7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBjb2xsID0gcGF0aC5zdWJzdHIoMCwgc2xhc2hQb3MgKyAxKTtcbiAgICAgICAgICAgIGlmIChjb2xsW2NvbGwubGVuZ3RoIC0gMV0gIT09ICcvJykge1xuICAgICAgICAgICAgICAgIGNvbGwgKz0gJy8nO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGNvbGxbMF0gIT09ICcvJykge1xuICAgICAgICAgICAgICAgIGNvbGwgPSAnLycgKyBjb2xsO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHZhciBkb2MgPSBwYXRoLnN1YnN0cihzbGFzaFBvcyArIDEpO1xuICAgICAgICB2YXIgYXJncyA9IFV0aWwuZGVwYXJhbShhcmdzU3RyKTtcbiAgICAgICAgcmV0dXJuIG5ldyBVUkxIYXNoKGNvbGwsIGRvYywgYXJncyk7XG4gICAgfTtcblxuICAgIHJldHVybiBVUkxIYXNoO1xufSkoalF1ZXJ5LCB3aW5kb3cpO1xuXG4vLyBCUkFUIFNUQU5EQUxPTkUgTElCUkFSWSBCRUdJTlxuLy8gQnJvd3NlcmlmeSBleHBvcnRcbm1vZHVsZS5leHBvcnRzID0gVVJMSGFzaDtcbi8vIEJSQVQgU1RBTkRBTE9ORSBMSUJSQVJZIEVORFxuIiwiLy8gLSotIE1vZGU6IEphdmFTY3JpcHQ7IHRhYi13aWR0aDogMjsgaW5kZW50LXRhYnMtbW9kZTogbmlsOyAtKi1cbi8vIHZpbTpzZXQgZnQ9amF2YXNjcmlwdCB0cz0yIHN3PTIgc3RzPTIgY2luZGVudDpcbnZhciBVdGlsID0gKGZ1bmN0aW9uKHdpbmRvdywgdW5kZWZpbmVkKSB7XG5cbiAgICB2YXIgbW9udGhOYW1lcyA9IFsnSmFuJywgJ0ZlYicsICdNYXInLCAnQXByJywgJ01heScsICdKdW4nLCAnSnVsJywgJ0F1ZycsICdTZXAnLCAnT2N0JywgJ05vdicsICdEZWMnXTtcblxuICAgIHZhciBjbXAgPSBmdW5jdGlvbihhLGIpIHtcbiAgICAgIHJldHVybiBhIDwgYiA/IC0xIDogYSA+IGIgPyAxIDogMDtcbiAgICB9XG5cbiAgICB2YXIgY21wQXJyYXlPbkZpcnN0RWxlbWVudCA9IGZ1bmN0aW9uKGEsYikge1xuICAgICAgYSA9IGFbMF07XG4gICAgICBiID0gYlswXTtcbiAgICAgIHJldHVybiBhIDwgYiA/IC0xIDogYSA+IGIgPyAxIDogMDtcbiAgICB9XG5cbiAgICB2YXIgdW5pdEFnbyA9IGZ1bmN0aW9uKG4sIHVuaXQpIHtcbiAgICAgIGlmIChuID09IDEpIHJldHVybiBcIlwiICsgbiArIFwiIFwiICsgdW5pdCArIFwiIGFnb1wiO1xuICAgICAgcmV0dXJuIFwiXCIgKyBuICsgXCIgXCIgKyB1bml0ICsgXCJzIGFnb1wiO1xuICAgIH07XG5cbiAgICB2YXIgZm9ybWF0VGltZUFnbyA9IGZ1bmN0aW9uKHRpbWUpIHtcbiAgICAgIGlmICh0aW1lID09IC0xMDAwKSB7XG4gICAgICAgIHJldHVybiBcIm5ldmVyXCI7IC8vIEZJWE1FIG1ha2UgdGhlIHNlcnZlciByZXR1cm4gdGhlIHNlcnZlciB0aW1lIVxuICAgICAgfVxuXG4gICAgICB2YXIgbm93RGF0ZSA9IG5ldyBEYXRlKCk7XG4gICAgICB2YXIgbm93ID0gbm93RGF0ZS5nZXRUaW1lKCk7XG4gICAgICB2YXIgZGlmZiA9IE1hdGguZmxvb3IoKG5vdyAtIHRpbWUpIC8gMTAwMCk7XG4gICAgICBpZiAoIWRpZmYpIHJldHVybiBcImp1c3Qgbm93XCI7XG4gICAgICBpZiAoZGlmZiA8IDYwKSByZXR1cm4gdW5pdEFnbyhkaWZmLCBcInNlY29uZFwiKTtcbiAgICAgIGRpZmYgPSBNYXRoLmZsb29yKGRpZmYgLyA2MCk7XG4gICAgICBpZiAoZGlmZiA8IDYwKSByZXR1cm4gdW5pdEFnbyhkaWZmLCBcIm1pbnV0ZVwiKTtcbiAgICAgIGRpZmYgPSBNYXRoLmZsb29yKGRpZmYgLyA2MCk7XG4gICAgICBpZiAoZGlmZiA8IDI0KSByZXR1cm4gdW5pdEFnbyhkaWZmLCBcImhvdXJcIik7XG4gICAgICBkaWZmID0gTWF0aC5mbG9vcihkaWZmIC8gMjQpO1xuICAgICAgaWYgKGRpZmYgPCA3KSByZXR1cm4gdW5pdEFnbyhkaWZmLCBcImRheVwiKTtcbiAgICAgIGlmIChkaWZmIDwgMjgpIHJldHVybiB1bml0QWdvKE1hdGguZmxvb3IoZGlmZiAvIDcpLCBcIndlZWtcIik7XG4gICAgICB2YXIgdGhlbkRhdGUgPSBuZXcgRGF0ZSh0aW1lKTtcbiAgICAgIHZhciByZXN1bHQgPSB0aGVuRGF0ZS5nZXREYXRlKCkgKyAnICcgKyBtb250aE5hbWVzW3RoZW5EYXRlLmdldE1vbnRoKCldO1xuICAgICAgaWYgKHRoZW5EYXRlLmdldFllYXIoKSAhPSBub3dEYXRlLmdldFllYXIoKSkge1xuICAgICAgICByZXN1bHQgKz0gJyAnICsgdGhlbkRhdGUuZ2V0RnVsbFllYXIoKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgfVxuXG4gICAgdmFyIHJlYWxCQm94ID0gZnVuY3Rpb24oc3Bhbikge1xuICAgICAgdmFyIGJveCA9IHNwYW4ucmVjdC5nZXRCQm94KCk7XG4gICAgICB2YXIgY2h1bmtUcmFuc2xhdGlvbiA9IHNwYW4uY2h1bmsudHJhbnNsYXRpb247XG4gICAgICB2YXIgcm93VHJhbnNsYXRpb24gPSBzcGFuLmNodW5rLnJvdy50cmFuc2xhdGlvbjtcbiAgICAgIGJveC54ICs9IGNodW5rVHJhbnNsYXRpb24ueCArIHJvd1RyYW5zbGF0aW9uLng7XG4gICAgICBib3gueSArPSBjaHVua1RyYW5zbGF0aW9uLnkgKyByb3dUcmFuc2xhdGlvbi55O1xuICAgICAgcmV0dXJuIGJveDtcbiAgICB9XG5cbiAgICB2YXIgZXNjYXBlSFRNTCA9IGZ1bmN0aW9uKHN0cikge1xuICAgICAgcmV0dXJuIHN0ci5yZXBsYWNlKC8mL2csJyZhbXA7JykucmVwbGFjZSgvPC9nLCcmbHQ7JykucmVwbGFjZSgvPi9nLCcmZ3Q7Jyk7XG4gICAgfVxuXG4gICAgdmFyIGVzY2FwZUhUTUxhbmRRdW90ZXMgPSBmdW5jdGlvbihzdHIpIHtcbiAgICAgIHJldHVybiBzdHIucmVwbGFjZSgvJi9nLCcmYW1wOycpLnJlcGxhY2UoLzwvZywnJmx0OycpLnJlcGxhY2UoLz4vZywnJmd0OycpLnJlcGxhY2UoL1xcXCIvZywnJnF1b3Q7Jyk7XG4gICAgfVxuXG4gICAgdmFyIGVzY2FwZUhUTUx3aXRoTmV3bGluZXMgPSBmdW5jdGlvbihzdHIpIHtcbiAgICAgIHJldHVybiBzdHIucmVwbGFjZSgvJi9nLCcmYW1wOycpLnJlcGxhY2UoLzwvZywnJmx0OycpLnJlcGxhY2UoLz4vZywnJmd0OycpLnJlcGxhY2UoL1xcbi9nLCc8YnIvPicpO1xuICAgIH1cblxuICAgIHZhciBlc2NhcGVRdW90ZXMgPSBmdW5jdGlvbihzdHIpIHtcbiAgICAgIC8vIHdlIG9ubHkgdXNlIGRvdWJsZSBxdW90ZXMgZm9yIEhUTUwgYXR0cmlidXRlc1xuICAgICAgcmV0dXJuIHN0ci5yZXBsYWNlKC9cXFwiL2csJyZxdW90OycpO1xuICAgIH1cblxuICAgIHZhciBnZXRTcGFuTGFiZWxzID0gZnVuY3Rpb24oc3BhblR5cGVzLCBzcGFuVHlwZSkge1xuICAgICAgdmFyIHR5cGUgPSBzcGFuVHlwZXNbc3BhblR5cGVdO1xuICAgICAgcmV0dXJuIHR5cGUgJiYgdHlwZS5sYWJlbHMgfHwgW107XG4gICAgfVxuXG4gICAgdmFyIHNwYW5EaXNwbGF5Rm9ybSA9IGZ1bmN0aW9uKHNwYW5UeXBlcywgc3BhblR5cGUpIHtcbiAgICAgIHZhciBsYWJlbHMgPSBnZXRTcGFuTGFiZWxzKHNwYW5UeXBlcywgc3BhblR5cGUpO1xuICAgICAgcmV0dXJuIGxhYmVsc1swXSB8fCBzcGFuVHlwZTtcbiAgICB9XG5cbiAgICB2YXIgZ2V0QXJjTGFiZWxzID0gZnVuY3Rpb24oc3BhblR5cGVzLCBzcGFuVHlwZSwgYXJjVHlwZSwgcmVsYXRpb25UeXBlc0hhc2gpIHtcbiAgICAgIHZhciB0eXBlID0gc3BhblR5cGVzW3NwYW5UeXBlXTtcbiAgICAgIHZhciBhcmNUeXBlcyA9IHR5cGUgJiYgdHlwZS5hcmNzIHx8IFtdO1xuICAgICAgdmFyIGFyY0Rlc2MgPSBudWxsO1xuICAgICAgLy8gYWxzbyBjb25zaWRlciBtYXRjaGVzIHdpdGhvdXQgc3VmZml4IG51bWJlciwgaWYgYW55XG4gICAgICB2YXIgbm9OdW1BcmNUeXBlO1xuICAgICAgaWYgKGFyY1R5cGUpIHtcbiAgICAgICAgICB2YXIgc3BsaXRUeXBlID0gYXJjVHlwZS5tYXRjaCgvXiguKj8pKFxcZCopJC8pO1xuICAgICAgICAgIG5vTnVtQXJjVHlwZSA9IHNwbGl0VHlwZVsxXTtcbiAgICAgIH1cbiAgICAgICQuZWFjaChhcmNUeXBlcywgZnVuY3Rpb24oYXJjbm8sIGFyY0Rlc2NJKSB7XG4gICAgICAgIGlmIChhcmNEZXNjSS50eXBlID09IGFyY1R5cGUgfHwgYXJjRGVzY0kudHlwZSA9PSBub051bUFyY1R5cGUpIHtcbiAgICAgICAgICBhcmNEZXNjID0gYXJjRGVzY0k7XG4gICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICAgIC8vIGZhbGwgYmFjayB0byByZWxhdGlvbiB0eXBlcyBmb3IgdW5jb25maWd1cmVkIG9yIG1pc3NpbmcgZGVmXG4gICAgICBpZiAoIWFyY0Rlc2MpIHtcbiAgICAgICAgYXJjRGVzYyA9ICQuZXh0ZW5kKHt9LCByZWxhdGlvblR5cGVzSGFzaFthcmNUeXBlXSB8fCByZWxhdGlvblR5cGVzSGFzaFtub051bUFyY1R5cGVdKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBhcmNEZXNjICYmIGFyY0Rlc2MubGFiZWxzIHx8IFtdO1xuICAgIH1cblxuICAgIHZhciBhcmNEaXNwbGF5Rm9ybSA9IGZ1bmN0aW9uKHNwYW5UeXBlcywgc3BhblR5cGUsIGFyY1R5cGUsIHJlbGF0aW9uVHlwZXNIYXNoKSB7XG4gICAgICB2YXIgbGFiZWxzID0gZ2V0QXJjTGFiZWxzKHNwYW5UeXBlcywgc3BhblR5cGUsIGFyY1R5cGUsIHJlbGF0aW9uVHlwZXNIYXNoKTtcbiAgICAgIHJldHVybiBsYWJlbHNbMF0gfHwgYXJjVHlwZTtcbiAgICB9XG5cbiAgICAvLyBUT0RPOiBzd2l0Y2hpbmcgdG8gdXNlIG9mICQucGFyYW0oKSwgdGhpcyBmdW5jdGlvbiBzaG91bGRcbiAgICAvLyBiZSBkZXByZWNhdGVkIGFuZCByZW1vdmVkLlxuICAgIHZhciBvYmplY3RUb1VybFN0ciA9IGZ1bmN0aW9uKG8pIHtcbiAgICAgIGEgPSBbXTtcbiAgICAgICQuZWFjaChvLCBmdW5jdGlvbihrZXksdmFsdWUpIHtcbiAgICAgICAgYS5wdXNoKGtleStcIj1cIitlbmNvZGVVUklDb21wb25lbnQodmFsdWUpKTtcbiAgICAgIH0pO1xuICAgICAgcmV0dXJuIGEuam9pbihcIiZcIik7XG4gICAgfVxuXG4gICAgLy8gY29sb3IgbmFtZSBSR0IgbGlzdCwgY29udmVydGVkIGZyb21cbiAgICAvLyBodHRwOi8vd3d3Lnczc2Nob29scy5jb20vaHRtbC9odG1sX2NvbG9ybmFtZXMuYXNwXG4gICAgLy8gd2l0aCBwZXJsIGFzXG4gICAgLy8gICAgIHBlcmwgLWUgJ3ByaW50IFwidmFyIGNvbG9ycyA9IHtcXG5cIjsgd2hpbGUoPD4pIHsgLyhcXFMrKVxccytcXCMoWzAtOWEtel17Mn0pKFswLTlhLXpdezJ9KShbMC05YS16XXsyfSlcXHMqL2kgb3IgZGllIFwiRmFpbGVkIHRvIHBhcnNlICRfXCI7ICgkciwkZywkYik9KGhleCgkMiksaGV4KCQzKSxoZXgoJDQpKTsgcHJpbnQgXCIgICAgJ1xcJydcIixsYygkMSksXCInXFwnJzpcXFskciwkZywkYlxcXSxcXG5cIiB9IHByaW50IFwifTtcXG5cIiAnXG4gICAgdmFyIGNvbG9ycyA9IHtcbiAgICAgICAgJ2FsaWNlYmx1ZSc6WzI0MCwyNDgsMjU1XSxcbiAgICAgICAgJ2FudGlxdWV3aGl0ZSc6WzI1MCwyMzUsMjE1XSxcbiAgICAgICAgJ2FxdWEnOlswLDI1NSwyNTVdLFxuICAgICAgICAnYXF1YW1hcmluZSc6WzEyNywyNTUsMjEyXSxcbiAgICAgICAgJ2F6dXJlJzpbMjQwLDI1NSwyNTVdLFxuICAgICAgICAnYmVpZ2UnOlsyNDUsMjQ1LDIyMF0sXG4gICAgICAgICdiaXNxdWUnOlsyNTUsMjI4LDE5Nl0sXG4gICAgICAgICdibGFjayc6WzAsMCwwXSxcbiAgICAgICAgJ2JsYW5jaGVkYWxtb25kJzpbMjU1LDIzNSwyMDVdLFxuICAgICAgICAnYmx1ZSc6WzAsMCwyNTVdLFxuICAgICAgICAnYmx1ZXZpb2xldCc6WzEzOCw0MywyMjZdLFxuICAgICAgICAnYnJvd24nOlsxNjUsNDIsNDJdLFxuICAgICAgICAnYnVybHl3b29kJzpbMjIyLDE4NCwxMzVdLFxuICAgICAgICAnY2FkZXRibHVlJzpbOTUsMTU4LDE2MF0sXG4gICAgICAgICdjaGFydHJldXNlJzpbMTI3LDI1NSwwXSxcbiAgICAgICAgJ2Nob2NvbGF0ZSc6WzIxMCwxMDUsMzBdLFxuICAgICAgICAnY29yYWwnOlsyNTUsMTI3LDgwXSxcbiAgICAgICAgJ2Nvcm5mbG93ZXJibHVlJzpbMTAwLDE0OSwyMzddLFxuICAgICAgICAnY29ybnNpbGsnOlsyNTUsMjQ4LDIyMF0sXG4gICAgICAgICdjcmltc29uJzpbMjIwLDIwLDYwXSxcbiAgICAgICAgJ2N5YW4nOlswLDI1NSwyNTVdLFxuICAgICAgICAnZGFya2JsdWUnOlswLDAsMTM5XSxcbiAgICAgICAgJ2RhcmtjeWFuJzpbMCwxMzksMTM5XSxcbiAgICAgICAgJ2Rhcmtnb2xkZW5yb2QnOlsxODQsMTM0LDExXSxcbiAgICAgICAgJ2RhcmtncmF5JzpbMTY5LDE2OSwxNjldLFxuICAgICAgICAnZGFya2dyZXknOlsxNjksMTY5LDE2OV0sXG4gICAgICAgICdkYXJrZ3JlZW4nOlswLDEwMCwwXSxcbiAgICAgICAgJ2RhcmtraGFraSc6WzE4OSwxODMsMTA3XSxcbiAgICAgICAgJ2RhcmttYWdlbnRhJzpbMTM5LDAsMTM5XSxcbiAgICAgICAgJ2RhcmtvbGl2ZWdyZWVuJzpbODUsMTA3LDQ3XSxcbiAgICAgICAgJ2RhcmtvcmFuZ2UnOlsyNTUsMTQwLDBdLFxuICAgICAgICAnZGFya29yY2hpZCc6WzE1Myw1MCwyMDRdLFxuICAgICAgICAnZGFya3JlZCc6WzEzOSwwLDBdLFxuICAgICAgICAnZGFya3NhbG1vbic6WzIzMywxNTAsMTIyXSxcbiAgICAgICAgJ2RhcmtzZWFncmVlbic6WzE0MywxODgsMTQzXSxcbiAgICAgICAgJ2RhcmtzbGF0ZWJsdWUnOls3Miw2MSwxMzldLFxuICAgICAgICAnZGFya3NsYXRlZ3JheSc6WzQ3LDc5LDc5XSxcbiAgICAgICAgJ2RhcmtzbGF0ZWdyZXknOls0Nyw3OSw3OV0sXG4gICAgICAgICdkYXJrdHVycXVvaXNlJzpbMCwyMDYsMjA5XSxcbiAgICAgICAgJ2Rhcmt2aW9sZXQnOlsxNDgsMCwyMTFdLFxuICAgICAgICAnZGVlcHBpbmsnOlsyNTUsMjAsMTQ3XSxcbiAgICAgICAgJ2RlZXBza3libHVlJzpbMCwxOTEsMjU1XSxcbiAgICAgICAgJ2RpbWdyYXknOlsxMDUsMTA1LDEwNV0sXG4gICAgICAgICdkaW1ncmV5JzpbMTA1LDEwNSwxMDVdLFxuICAgICAgICAnZG9kZ2VyYmx1ZSc6WzMwLDE0NCwyNTVdLFxuICAgICAgICAnZmlyZWJyaWNrJzpbMTc4LDM0LDM0XSxcbiAgICAgICAgJ2Zsb3JhbHdoaXRlJzpbMjU1LDI1MCwyNDBdLFxuICAgICAgICAnZm9yZXN0Z3JlZW4nOlszNCwxMzksMzRdLFxuICAgICAgICAnZnVjaHNpYSc6WzI1NSwwLDI1NV0sXG4gICAgICAgICdnYWluc2Jvcm8nOlsyMjAsMjIwLDIyMF0sXG4gICAgICAgICdnaG9zdHdoaXRlJzpbMjQ4LDI0OCwyNTVdLFxuICAgICAgICAnZ29sZCc6WzI1NSwyMTUsMF0sXG4gICAgICAgICdnb2xkZW5yb2QnOlsyMTgsMTY1LDMyXSxcbiAgICAgICAgJ2dyYXknOlsxMjgsMTI4LDEyOF0sXG4gICAgICAgICdncmV5JzpbMTI4LDEyOCwxMjhdLFxuICAgICAgICAnZ3JlZW4nOlswLDEyOCwwXSxcbiAgICAgICAgJ2dyZWVueWVsbG93JzpbMTczLDI1NSw0N10sXG4gICAgICAgICdob25leWRldyc6WzI0MCwyNTUsMjQwXSxcbiAgICAgICAgJ2hvdHBpbmsnOlsyNTUsMTA1LDE4MF0sXG4gICAgICAgICdpbmRpYW5yZWQnOlsyMDUsOTIsOTJdLFxuICAgICAgICAnaW5kaWdvJzpbNzUsMCwxMzBdLFxuICAgICAgICAnaXZvcnknOlsyNTUsMjU1LDI0MF0sXG4gICAgICAgICdraGFraSc6WzI0MCwyMzAsMTQwXSxcbiAgICAgICAgJ2xhdmVuZGVyJzpbMjMwLDIzMCwyNTBdLFxuICAgICAgICAnbGF2ZW5kZXJibHVzaCc6WzI1NSwyNDAsMjQ1XSxcbiAgICAgICAgJ2xhd25ncmVlbic6WzEyNCwyNTIsMF0sXG4gICAgICAgICdsZW1vbmNoaWZmb24nOlsyNTUsMjUwLDIwNV0sXG4gICAgICAgICdsaWdodGJsdWUnOlsxNzMsMjE2LDIzMF0sXG4gICAgICAgICdsaWdodGNvcmFsJzpbMjQwLDEyOCwxMjhdLFxuICAgICAgICAnbGlnaHRjeWFuJzpbMjI0LDI1NSwyNTVdLFxuICAgICAgICAnbGlnaHRnb2xkZW5yb2R5ZWxsb3cnOlsyNTAsMjUwLDIxMF0sXG4gICAgICAgICdsaWdodGdyYXknOlsyMTEsMjExLDIxMV0sXG4gICAgICAgICdsaWdodGdyZXknOlsyMTEsMjExLDIxMV0sXG4gICAgICAgICdsaWdodGdyZWVuJzpbMTQ0LDIzOCwxNDRdLFxuICAgICAgICAnbGlnaHRwaW5rJzpbMjU1LDE4MiwxOTNdLFxuICAgICAgICAnbGlnaHRzYWxtb24nOlsyNTUsMTYwLDEyMl0sXG4gICAgICAgICdsaWdodHNlYWdyZWVuJzpbMzIsMTc4LDE3MF0sXG4gICAgICAgICdsaWdodHNreWJsdWUnOlsxMzUsMjA2LDI1MF0sXG4gICAgICAgICdsaWdodHNsYXRlZ3JheSc6WzExOSwxMzYsMTUzXSxcbiAgICAgICAgJ2xpZ2h0c2xhdGVncmV5JzpbMTE5LDEzNiwxNTNdLFxuICAgICAgICAnbGlnaHRzdGVlbGJsdWUnOlsxNzYsMTk2LDIyMl0sXG4gICAgICAgICdsaWdodHllbGxvdyc6WzI1NSwyNTUsMjI0XSxcbiAgICAgICAgJ2xpbWUnOlswLDI1NSwwXSxcbiAgICAgICAgJ2xpbWVncmVlbic6WzUwLDIwNSw1MF0sXG4gICAgICAgICdsaW5lbic6WzI1MCwyNDAsMjMwXSxcbiAgICAgICAgJ21hZ2VudGEnOlsyNTUsMCwyNTVdLFxuICAgICAgICAnbWFyb29uJzpbMTI4LDAsMF0sXG4gICAgICAgICdtZWRpdW1hcXVhbWFyaW5lJzpbMTAyLDIwNSwxNzBdLFxuICAgICAgICAnbWVkaXVtYmx1ZSc6WzAsMCwyMDVdLFxuICAgICAgICAnbWVkaXVtb3JjaGlkJzpbMTg2LDg1LDIxMV0sXG4gICAgICAgICdtZWRpdW1wdXJwbGUnOlsxNDcsMTEyLDIxNl0sXG4gICAgICAgICdtZWRpdW1zZWFncmVlbic6WzYwLDE3OSwxMTNdLFxuICAgICAgICAnbWVkaXVtc2xhdGVibHVlJzpbMTIzLDEwNCwyMzhdLFxuICAgICAgICAnbWVkaXVtc3ByaW5nZ3JlZW4nOlswLDI1MCwxNTRdLFxuICAgICAgICAnbWVkaXVtdHVycXVvaXNlJzpbNzIsMjA5LDIwNF0sXG4gICAgICAgICdtZWRpdW12aW9sZXRyZWQnOlsxOTksMjEsMTMzXSxcbiAgICAgICAgJ21pZG5pZ2h0Ymx1ZSc6WzI1LDI1LDExMl0sXG4gICAgICAgICdtaW50Y3JlYW0nOlsyNDUsMjU1LDI1MF0sXG4gICAgICAgICdtaXN0eXJvc2UnOlsyNTUsMjI4LDIyNV0sXG4gICAgICAgICdtb2NjYXNpbic6WzI1NSwyMjgsMTgxXSxcbiAgICAgICAgJ25hdmFqb3doaXRlJzpbMjU1LDIyMiwxNzNdLFxuICAgICAgICAnbmF2eSc6WzAsMCwxMjhdLFxuICAgICAgICAnb2xkbGFjZSc6WzI1MywyNDUsMjMwXSxcbiAgICAgICAgJ29saXZlJzpbMTI4LDEyOCwwXSxcbiAgICAgICAgJ29saXZlZHJhYic6WzEwNywxNDIsMzVdLFxuICAgICAgICAnb3JhbmdlJzpbMjU1LDE2NSwwXSxcbiAgICAgICAgJ29yYW5nZXJlZCc6WzI1NSw2OSwwXSxcbiAgICAgICAgJ29yY2hpZCc6WzIxOCwxMTIsMjE0XSxcbiAgICAgICAgJ3BhbGVnb2xkZW5yb2QnOlsyMzgsMjMyLDE3MF0sXG4gICAgICAgICdwYWxlZ3JlZW4nOlsxNTIsMjUxLDE1Ml0sXG4gICAgICAgICdwYWxldHVycXVvaXNlJzpbMTc1LDIzOCwyMzhdLFxuICAgICAgICAncGFsZXZpb2xldHJlZCc6WzIxNiwxMTIsMTQ3XSxcbiAgICAgICAgJ3BhcGF5YXdoaXAnOlsyNTUsMjM5LDIxM10sXG4gICAgICAgICdwZWFjaHB1ZmYnOlsyNTUsMjE4LDE4NV0sXG4gICAgICAgICdwZXJ1JzpbMjA1LDEzMyw2M10sXG4gICAgICAgICdwaW5rJzpbMjU1LDE5MiwyMDNdLFxuICAgICAgICAncGx1bSc6WzIyMSwxNjAsMjIxXSxcbiAgICAgICAgJ3Bvd2RlcmJsdWUnOlsxNzYsMjI0LDIzMF0sXG4gICAgICAgICdwdXJwbGUnOlsxMjgsMCwxMjhdLFxuICAgICAgICAncmVkJzpbMjU1LDAsMF0sXG4gICAgICAgICdyb3N5YnJvd24nOlsxODgsMTQzLDE0M10sXG4gICAgICAgICdyb3lhbGJsdWUnOls2NSwxMDUsMjI1XSxcbiAgICAgICAgJ3NhZGRsZWJyb3duJzpbMTM5LDY5LDE5XSxcbiAgICAgICAgJ3NhbG1vbic6WzI1MCwxMjgsMTE0XSxcbiAgICAgICAgJ3NhbmR5YnJvd24nOlsyNDQsMTY0LDk2XSxcbiAgICAgICAgJ3NlYWdyZWVuJzpbNDYsMTM5LDg3XSxcbiAgICAgICAgJ3NlYXNoZWxsJzpbMjU1LDI0NSwyMzhdLFxuICAgICAgICAnc2llbm5hJzpbMTYwLDgyLDQ1XSxcbiAgICAgICAgJ3NpbHZlcic6WzE5MiwxOTIsMTkyXSxcbiAgICAgICAgJ3NreWJsdWUnOlsxMzUsMjA2LDIzNV0sXG4gICAgICAgICdzbGF0ZWJsdWUnOlsxMDYsOTAsMjA1XSxcbiAgICAgICAgJ3NsYXRlZ3JheSc6WzExMiwxMjgsMTQ0XSxcbiAgICAgICAgJ3NsYXRlZ3JleSc6WzExMiwxMjgsMTQ0XSxcbiAgICAgICAgJ3Nub3cnOlsyNTUsMjUwLDI1MF0sXG4gICAgICAgICdzcHJpbmdncmVlbic6WzAsMjU1LDEyN10sXG4gICAgICAgICdzdGVlbGJsdWUnOls3MCwxMzAsMTgwXSxcbiAgICAgICAgJ3Rhbic6WzIxMCwxODAsMTQwXSxcbiAgICAgICAgJ3RlYWwnOlswLDEyOCwxMjhdLFxuICAgICAgICAndGhpc3RsZSc6WzIxNiwxOTEsMjE2XSxcbiAgICAgICAgJ3RvbWF0byc6WzI1NSw5OSw3MV0sXG4gICAgICAgICd0dXJxdW9pc2UnOls2NCwyMjQsMjA4XSxcbiAgICAgICAgJ3Zpb2xldCc6WzIzOCwxMzAsMjM4XSxcbiAgICAgICAgJ3doZWF0JzpbMjQ1LDIyMiwxNzldLFxuICAgICAgICAnd2hpdGUnOlsyNTUsMjU1LDI1NV0sXG4gICAgICAgICd3aGl0ZXNtb2tlJzpbMjQ1LDI0NSwyNDVdLFxuICAgICAgICAneWVsbG93JzpbMjU1LDI1NSwwXSxcbiAgICAgICAgJ3llbGxvd2dyZWVuJzpbMTU0LDIwNSw1MF0sXG4gICAgfTtcblxuICAgIC8vIGNvbG9yIHBhcnNpbmcgZnVuY3Rpb24gb3JpZ2luYWxseSBmcm9tXG4gICAgLy8gaHR0cDovL3BsdWdpbnMuanF1ZXJ5LmNvbS9maWxlcy9qcXVlcnkuY29sb3IuanMudHh0XG4gICAgLy8gKHdpdGggc2xpZ2h0IG1vZGlmaWNhdGlvbnMpXG5cbiAgICAvLyBQYXJzZSBzdHJpbmdzIGxvb2tpbmcgZm9yIGNvbG9yIHR1cGxlcyBbMjU1LDI1NSwyNTVdXG4gICAgdmFyIHJnYk51bVJFID0gL3JnYlxcKFxccyooWzAtOV17MSwzfSlcXHMqLFxccyooWzAtOV17MSwzfSlcXHMqLFxccyooWzAtOV17MSwzfSlcXHMqXFwpLztcbiAgICB2YXIgcmdiUGVyY1JFID0gL3JnYlxcKFxccyooWzAtOV0rKD86XFwuWzAtOV0rKT8pXFwlXFxzKixcXHMqKFswLTldKyg/OlxcLlswLTldKyk/KVxcJVxccyosXFxzKihbMC05XSsoPzpcXC5bMC05XSspPylcXCVcXHMqXFwpLztcbiAgICB2YXIgcmdiSGFzaDZSRSA9IC8jKFthLWZBLUYwLTldezJ9KShbYS1mQS1GMC05XXsyfSkoW2EtZkEtRjAtOV17Mn0pLztcbiAgICB2YXIgcmdiSGFzaDNSRSA9IC8jKFthLWZBLUYwLTldKShbYS1mQS1GMC05XSkoW2EtZkEtRjAtOV0pLztcblxuICAgIHZhciBzdHJUb1JnYiA9IGZ1bmN0aW9uKGNvbG9yKSB7XG4gICAgICB2YXIgcmVzdWx0O1xuXG4gICAgICAvLyBDaGVjayBpZiB3ZSdyZSBhbHJlYWR5IGRlYWxpbmcgd2l0aCBhbiBhcnJheSBvZiBjb2xvcnNcbi8vICAgICAgICAgaWYgKCBjb2xvciAmJiBjb2xvci5jb25zdHJ1Y3RvciA9PSBBcnJheSAmJiBjb2xvci5sZW5ndGggPT0gMyApXG4vLyAgICAgICAgICAgICByZXR1cm4gY29sb3I7XG4gICAgICBcbiAgICAgIC8vIExvb2sgZm9yIHJnYihudW0sbnVtLG51bSlcbiAgICAgIGlmIChyZXN1bHQgPSByZ2JOdW1SRS5leGVjKGNvbG9yKSlcbiAgICAgICAgcmV0dXJuIFtwYXJzZUludChyZXN1bHRbMV0pLCBwYXJzZUludChyZXN1bHRbMl0pLCBwYXJzZUludChyZXN1bHRbM10pXTtcbiAgICAgIFxuICAgICAgLy8gTG9vayBmb3IgcmdiKG51bSUsbnVtJSxudW0lKVxuICAgICAgaWYgKHJlc3VsdCA9IHJnYlBlcmNSRS5leGVjKGNvbG9yKSlcbiAgICAgICAgcmV0dXJuIFtwYXJzZUZsb2F0KHJlc3VsdFsxXSkqMi41NSwgcGFyc2VGbG9hdChyZXN1bHRbMl0pKjIuNTUsIHBhcnNlRmxvYXQocmVzdWx0WzNdKSoyLjU1XTtcbiAgICAgIFxuICAgICAgLy8gTG9vayBmb3IgI2EwYjFjMlxuICAgICAgaWYgKHJlc3VsdCA9IHJnYkhhc2g2UkUuZXhlYyhjb2xvcikpXG4gICAgICAgIHJldHVybiBbcGFyc2VJbnQocmVzdWx0WzFdLDE2KSwgcGFyc2VJbnQocmVzdWx0WzJdLDE2KSwgcGFyc2VJbnQocmVzdWx0WzNdLDE2KV07XG4gICAgICBcbiAgICAgIC8vIExvb2sgZm9yICNmZmZcbiAgICAgIGlmIChyZXN1bHQgPSByZ2JIYXNoM1JFLmV4ZWMoY29sb3IpKVxuICAgICAgICByZXR1cm4gW3BhcnNlSW50KHJlc3VsdFsxXStyZXN1bHRbMV0sMTYpLCBwYXJzZUludChyZXN1bHRbMl0rcmVzdWx0WzJdLDE2KSwgcGFyc2VJbnQocmVzdWx0WzNdK3Jlc3VsdFszXSwxNildO1xuICAgICAgXG4gICAgICAvLyBPdGhlcndpc2UsIHdlJ3JlIG1vc3QgbGlrZWx5IGRlYWxpbmcgd2l0aCBhIG5hbWVkIGNvbG9yXG4gICAgICByZXR1cm4gY29sb3JzWyQudHJpbShjb2xvcikudG9Mb3dlckNhc2UoKV07XG4gICAgfVxuXG4gICAgdmFyIHJnYlRvU3RyID0gZnVuY3Rpb24ocmdiKSB7XG4gICAgICAvLyBUT0RPOiB0aGVyZSBoYXMgdG8gYmUgYSBiZXR0ZXIgd2F5LCBldmVuIGluIEpTXG4gICAgICB2YXIgciA9IE1hdGguZmxvb3IocmdiWzBdKS50b1N0cmluZygxNik7XG4gICAgICB2YXIgZyA9IE1hdGguZmxvb3IocmdiWzFdKS50b1N0cmluZygxNik7XG4gICAgICB2YXIgYiA9IE1hdGguZmxvb3IocmdiWzJdKS50b1N0cmluZygxNik7XG4gICAgICAvLyBwYWRcbiAgICAgIHIgPSByLmxlbmd0aCA8IDIgPyAnMCcgKyByIDogcjtcbiAgICAgIGcgPSBnLmxlbmd0aCA8IDIgPyAnMCcgKyBnIDogZztcbiAgICAgIGIgPSBiLmxlbmd0aCA8IDIgPyAnMCcgKyBiIDogYjsgICAgICAgIFxuICAgICAgcmV0dXJuICgnIycrcitnK2IpO1xuICAgIH1cbiAgICBcbiAgICAvLyBGdW5jdGlvbnMgcmdiVG9Ic2wgYW5kIGhzbFRvUmdiIG9yaWdpbmFsbHkgZnJvbSBcbiAgICAvLyBodHRwOi8vbWppamFja3Nvbi5jb20vMjAwOC8wMi9yZ2ItdG8taHNsLWFuZC1yZ2ItdG8taHN2LWNvbG9yLW1vZGVsLWNvbnZlcnNpb24tYWxnb3JpdGhtcy1pbi1qYXZhc2NyaXB0XG4gICAgLy8gaW1wbGVtZW50YXRpb24gb2YgZnVuY3Rpb25zIGluIFdpa2lwZWRpYVxuICAgIC8vICh3aXRoIHNsaWdodCBtb2RpZmljYXRpb25zKVxuXG4gICAgLy8gUkdCIHRvIEhTTCBjb2xvciBjb252ZXJzaW9uXG4gICAgdmFyIHJnYlRvSHNsID0gZnVuY3Rpb24ocmdiKSB7XG4gICAgICB2YXIgciA9IHJnYlswXS8yNTUsIGcgPSByZ2JbMV0vMjU1LCBiID0gcmdiWzJdLzI1NTtcbiAgICAgIHZhciBtYXggPSBNYXRoLm1heChyLCBnLCBiKSwgbWluID0gTWF0aC5taW4ociwgZywgYik7XG4gICAgICB2YXIgaCwgcywgbCA9IChtYXggKyBtaW4pIC8gMjtcblxuICAgICAgaWYgKG1heCA9PSBtaW4pIHtcbiAgICAgICAgaCA9IHMgPSAwOyAvLyBhY2hyb21hdGljXG4gICAgICB9IGVsc2Uge1xuICAgICAgICB2YXIgZCA9IG1heCAtIG1pbjtcbiAgICAgICAgcyA9IGwgPiAwLjUgPyBkIC8gKDIgLSBtYXggLSBtaW4pIDogZCAvIChtYXggKyBtaW4pO1xuICAgICAgICBzd2l0Y2ggKG1heCkge1xuICAgICAgICAgIGNhc2UgcjogaCA9IChnIC0gYikgLyBkICsgKGcgPCBiID8gNiA6IDApOyBicmVhaztcbiAgICAgICAgICBjYXNlIGc6IGggPSAoYiAtIHIpIC8gZCArIDI7IGJyZWFrO1xuICAgICAgICAgIGNhc2UgYjogaCA9IChyIC0gZykgLyBkICsgNDsgYnJlYWs7XG4gICAgICAgIH1cbiAgICAgICAgaCAvPSA2O1xuICAgICAgfVxuICAgICAgXG4gICAgICByZXR1cm4gW2gsIHMsIGxdO1xuICAgIH1cblxuICAgIHZhciBodWUycmdiID0gZnVuY3Rpb24ocCwgcSwgdCkge1xuICAgICAgaWYgKHQgPCAwKSB0ICs9IDE7XG4gICAgICBpZiAodCA+IDEpIHQgLT0gMTtcbiAgICAgIGlmICh0IDwgMS82KSByZXR1cm4gcCArIChxIC0gcCkgKiA2ICogdDtcbiAgICAgIGlmICh0IDwgMS8yKSByZXR1cm4gcTtcbiAgICAgIGlmICh0IDwgMi8zKSByZXR1cm4gcCArIChxIC0gcCkgKiAoMi8zIC0gdCkgKiA2O1xuICAgICAgcmV0dXJuIHA7XG4gICAgfVxuXG4gICAgdmFyIGhzbFRvUmdiID0gZnVuY3Rpb24oaHNsKSB7XG4gICAgICB2YXIgaCA9IGhzbFswXSwgcyA9IGhzbFsxXSwgbCA9IGhzbFsyXTtcblxuICAgICAgdmFyIHIsIGcsIGI7XG5cbiAgICAgIGlmIChzID09IDApIHtcbiAgICAgICAgciA9IGcgPSBiID0gbDsgLy8gYWNocm9tYXRpY1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdmFyIHEgPSBsIDwgMC41ID8gbCAqICgxICsgcykgOiBsICsgcyAtIGwgKiBzO1xuICAgICAgICB2YXIgcCA9IDIgKiBsIC0gcTtcbiAgICAgICAgciA9IGh1ZTJyZ2IocCwgcSwgaCArIDEvMyk7XG4gICAgICAgIGcgPSBodWUycmdiKHAsIHEsIGgpO1xuICAgICAgICBiID0gaHVlMnJnYihwLCBxLCBoIC0gMS8zKTtcbiAgICAgIH1cbiAgICAgIFxuICAgICAgcmV0dXJuIFtyICogMjU1LCBnICogMjU1LCBiICogMjU1XTtcbiAgICB9XG5cbiAgICB2YXIgYWRqdXN0TGlnaHRuZXNzQ2FjaGUgPSB7fTtcblxuICAgIC8vIGdpdmVuIGNvbG9yIHN0cmluZyBhbmQgLTE8PWFkanVzdDw9MSwgcmV0dXJucyBjb2xvciBzdHJpbmdcbiAgICAvLyB3aGVyZSBsaWdodG5lc3MgKGluIHRoZSBIU0wgc2Vuc2UpIGlzIGFkanVzdGVkIGJ5IHRoZSBnaXZlblxuICAgIC8vIGFtb3VudCwgdGhlIGxhcmdlciB0aGUgbGlnaHRlcjogLTEgZ2l2ZXMgYmxhY2ssIDEgd2hpdGUsIGFuZCAwXG4gICAgLy8gdGhlIGdpdmVuIGNvbG9yLlxuICAgIHZhciBhZGp1c3RDb2xvckxpZ2h0bmVzcyA9IGZ1bmN0aW9uKGNvbG9yc3RyLCBhZGp1c3QpIHtcbiAgICAgIGlmICghKGNvbG9yc3RyIGluIGFkanVzdExpZ2h0bmVzc0NhY2hlKSkge1xuICAgICAgICBhZGp1c3RMaWdodG5lc3NDYWNoZVtjb2xvcnN0cl0gPSB7fVxuICAgICAgfVxuICAgICAgaWYgKCEoYWRqdXN0IGluIGFkanVzdExpZ2h0bmVzc0NhY2hlW2NvbG9yc3RyXSkpIHtcbiAgICAgICAgdmFyIHJnYiA9IHN0clRvUmdiKGNvbG9yc3RyKTtcbiAgICAgICAgaWYgKHJnYiA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgLy8gZmFpbGVkIGNvbG9yIHN0cmluZyBjb252ZXJzaW9uOyBqdXN0IHJldHVybiB0aGUgaW5wdXRcbiAgICAgICAgICBhZGp1c3RMaWdodG5lc3NDYWNoZVtjb2xvcnN0cl1bYWRqdXN0XSA9IGNvbG9yc3RyO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHZhciBoc2wgPSByZ2JUb0hzbChyZ2IpO1xuICAgICAgICAgIGlmIChhZGp1c3QgPiAwLjApIHtcbiAgICAgICAgICAgIGhzbFsyXSA9IDEuMCAtICgoMS4wLWhzbFsyXSkqKDEuMC1hZGp1c3QpKTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgaHNsWzJdID0gKDEuMCthZGp1c3QpKmhzbFsyXTtcbiAgICAgICAgICB9XG4gICAgICAgICAgdmFyIGxpZ2h0UmdiID0gaHNsVG9SZ2IoaHNsKTtcbiAgICAgICAgICBhZGp1c3RMaWdodG5lc3NDYWNoZVtjb2xvcnN0cl1bYWRqdXN0XSA9IHJnYlRvU3RyKGxpZ2h0UmdiKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgcmV0dXJuIGFkanVzdExpZ2h0bmVzc0NhY2hlW2NvbG9yc3RyXVthZGp1c3RdO1xuICAgIH1cblxuICAgIC8vIFBhcnRpYWxseSBzdG9sZW4gZnJvbTogaHR0cDovL2RvY3VtZW50Y2xvdWQuZ2l0aHViLmNvbS91bmRlcnNjb3JlL1xuICAgIC8vIE1JVC1MaWNlbnNlXG4gICAgLy8gVE9ETzogTWVudGlvbiBpbiBMSUNFTlNFLm1kXG4gICAgdmFyIGlzRXF1YWwgPSBmdW5jdGlvbihhLCBiKSB7XG4gICAgICAvLyBDaGVjayBvYmplY3QgaWRlbnRpdHkuXG4gICAgICBpZiAoYSA9PT0gYikgcmV0dXJuIHRydWU7XG4gICAgICAvLyBEaWZmZXJlbnQgdHlwZXM/XG4gICAgICB2YXIgYXR5cGUgPSB0eXBlb2YoYSksIGJ0eXBlID0gdHlwZW9mKGIpO1xuICAgICAgaWYgKGF0eXBlICE9IGJ0eXBlKSByZXR1cm4gZmFsc2U7XG4gICAgICAvLyBCYXNpYyBlcXVhbGl0eSB0ZXN0ICh3YXRjaCBvdXQgZm9yIGNvZXJjaW9ucykuXG4gICAgICBpZiAoYSA9PSBiKSByZXR1cm4gdHJ1ZTtcbiAgICAgIC8vIE9uZSBpcyBmYWxzeSBhbmQgdGhlIG90aGVyIHRydXRoeS5cbiAgICAgIGlmICgoIWEgJiYgYikgfHwgKGEgJiYgIWIpKSByZXR1cm4gZmFsc2U7XG4gICAgICAvLyBJZiBhIGlzIG5vdCBhbiBvYmplY3QgYnkgdGhpcyBwb2ludCwgd2UgY2FuJ3QgaGFuZGxlIGl0LlxuICAgICAgaWYgKGF0eXBlICE9PSAnb2JqZWN0JykgcmV0dXJuIGZhbHNlO1xuICAgICAgLy8gQ2hlY2sgZm9yIGRpZmZlcmVudCBhcnJheSBsZW5ndGhzIGJlZm9yZSBjb21wYXJpbmcgY29udGVudHMuXG4gICAgICBpZiAoYS5sZW5ndGggJiYgKGEubGVuZ3RoICE9PSBiLmxlbmd0aCkpIHJldHVybiBmYWxzZTtcbiAgICAgIC8vIE5vdGhpbmcgZWxzZSB3b3JrZWQsIGRlZXAgY29tcGFyZSB0aGUgY29udGVudHMuXG4gICAgICBmb3IgKHZhciBrZXkgaW4gYikgaWYgKCEoa2V5IGluIGEpKSByZXR1cm4gZmFsc2U7XG4gICAgICAvLyBSZWN1cnNpdmUgY29tcGFyaXNvbiBvZiBjb250ZW50cy5cbiAgICAgIGZvciAodmFyIGtleSBpbiBhKSBpZiAoIShrZXkgaW4gYikgfHwgIWlzRXF1YWwoYVtrZXldLCBiW2tleV0pKSByZXR1cm4gZmFsc2U7XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9O1xuXG4gICAgdmFyIGtleVZhbFJFID0gL14oW149XSspPSguKikkLzsgLy8ga2V5PXZhbHVlXG4gICAgdmFyIGlzRGlnaXRzUkUgPSAvXlswLTldKyQvO1xuXG4gICAgdmFyIGRlcGFyYW0gPSBmdW5jdGlvbihzdHIpIHtcbiAgICAgIHZhciBhcmdzID0gc3RyLnNwbGl0KCcmJyk7XG4gICAgICB2YXIgbGVuID0gYXJncy5sZW5ndGg7XG4gICAgICBpZiAoIWxlbikgcmV0dXJuIG51bGw7XG4gICAgICB2YXIgcmVzdWx0ID0ge307XG4gICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGxlbjsgaSsrKSB7XG4gICAgICAgIHZhciBwYXJ0cyA9IGFyZ3NbaV0ubWF0Y2goa2V5VmFsUkUpO1xuICAgICAgICBpZiAoIXBhcnRzIHx8IHBhcnRzLmxlbmd0aCAhPSAzKSBicmVhaztcbiAgICAgICAgdmFyIHZhbCA9IFtdO1xuICAgICAgICB2YXIgYXJyID0gcGFydHNbMl0uc3BsaXQoJywnKTtcbiAgICAgICAgdmFyIHN1YmxlbiA9IGFyci5sZW5ndGg7XG4gICAgICAgIGZvciAodmFyIGogPSAwOyBqIDwgc3VibGVuOyBqKyspIHtcbiAgICAgICAgICB2YXIgaW5uZXJtb3N0ID0gW107XG4gICAgICAgICAgLy8gbWFwIGVtcHR5IGFyZ3VtZW50cyAoXCJcIiBpbiBVUkwpIHRvIGVtcHR5IGFycmF5c1xuICAgICAgICAgIC8vIChpbm5lcm1vc3QgcmVtYWlucyBbXSlcbiAgICAgICAgICBpZiAoYXJyW2pdLmxlbmd0aCkge1xuICAgICAgICAgICAgdmFyIGFycnNwbGl0ID0gYXJyW2pdLnNwbGl0KCd+Jyk7XG4gICAgICAgICAgICB2YXIgc3Vic3VibGVuID0gYXJyc3BsaXQubGVuZ3RoO1xuICAgICAgICAgICAgZm9yICh2YXIgayA9IDA7IGsgPCBzdWJzdWJsZW47IGsrKykge1xuICAgICAgICAgICAgICBpZihhcnJzcGxpdFtrXS5tYXRjaChpc0RpZ2l0c1JFKSkge1xuICAgICAgICAgICAgICAgIC8vIGNvbnZlcnQgZGlnaXRzIGludG8gaW50cyAuLi5cbiAgICAgICAgICAgICAgICBpbm5lcm1vc3QucHVzaChwYXJzZUludChhcnJzcGxpdFtrXSwgMTApKTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAvLyAuLi4gYW55dGhpbmcgZWxzZSByZW1haW5zIGEgc3RyaW5nLlxuICAgICAgICAgICAgICAgIGlubmVybW9zdC5wdXNoKGFycnNwbGl0W2tdKTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgICB2YWwucHVzaChpbm5lcm1vc3QpO1xuICAgICAgICB9XG4gICAgICAgIHJlc3VsdFtwYXJ0c1sxXV0gPSB2YWw7XG4gICAgICB9XG4gICAgICByZXR1cm4gcmVzdWx0O1xuICAgIH07XG5cbiAgICB2YXIgcGFyYW1BcnJheSA9IGZ1bmN0aW9uKHZhbCkge1xuICAgICAgdmFsID0gdmFsIHx8IFtdO1xuICAgICAgdmFyIGxlbiA9IHZhbC5sZW5ndGg7XG4gICAgICB2YXIgYXJyID0gW107XG4gICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGxlbjsgaSsrKSB7XG4gICAgICAgIGlmICgkLmlzQXJyYXkodmFsW2ldKSkge1xuICAgICAgICAgIGFyci5wdXNoKHZhbFtpXS5qb2luKCd+JykpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIC8vIG5vbi1hcnJheSBhcmd1bWVudDsgdGhpcyBpcyBhbiBlcnJvciBmcm9tIHRoZSBjYWxsZXJcbiAgICAgICAgICBjb25zb2xlLmVycm9yKCdwYXJhbTogRXJyb3I6IHJlY2VpdmVkIG5vbi1hcnJheS1pbi1hcnJheSBhcmd1bWVudCBbJywgaSwgJ10nLCAnOicsIHZhbFtpXSwgJyhmaXggY2FsbGVyKScpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICByZXR1cm4gYXJyO1xuICAgIH07XG5cbiAgICB2YXIgcGFyYW0gPSBmdW5jdGlvbihhcmdzKSB7XG4gICAgICBpZiAoIWFyZ3MpIHJldHVybiAnJztcbiAgICAgIHZhciB2YWxzID0gW107XG4gICAgICBmb3IgKHZhciBrZXkgaW4gYXJncykge1xuICAgICAgICBpZiAoYXJncy5oYXNPd25Qcm9wZXJ0eShrZXkpKSB7XG4gICAgICAgICAgdmFyIHZhbCA9IGFyZ3Nba2V5XTtcbiAgICAgICAgICBpZiAodmFsID09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgY29uc29sZS5lcnJvcignRXJyb3I6IHJlY2VpdmVkIGFyZ3VtZW50Jywga2V5LCAnd2l0aCB2YWx1ZScsIHZhbCk7XG4gICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgICB9XG4gICAgICAgICAgLy8gdmFsdWVzIG5vcm1hbGx5IGV4cGVjdGVkIHRvIGJlIGFycmF5cywgYnV0IHNvbWUgY2FsbGVycyBzY3Jld1xuICAgICAgICAgIC8vIHVwLCBzbyBjaGVja1xuICAgICAgICAgIGlmICgkLmlzQXJyYXkodmFsKSkge1xuICAgICAgICAgICAgdmFyIGFyciA9IHBhcmFtQXJyYXkodmFsKTtcbiAgICAgICAgICAgIHZhbHMucHVzaChrZXkgKyAnPScgKyBhcnIuam9pbignLCcpKTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgLy8gbm9uLWFycmF5IGFyZ3VtZW50OyB0aGlzIGlzIGFuIGVycm9yIGZyb20gdGhlIGNhbGxlclxuICAgICAgICAgICAgY29uc29sZS5lcnJvcigncGFyYW06IEVycm9yOiByZWNlaXZlZCBub24tYXJyYXkgYXJndW1lbnQnLCBrZXksICc6JywgdmFsLCAnKGZpeCBjYWxsZXIpJyk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgICByZXR1cm4gdmFscy5qb2luKCcmJyk7XG4gICAgfTtcblxuICAgIHZhciBwcm9maWxlcyA9IHt9O1xuICAgIHZhciBwcm9maWxlU3RhcnRzID0ge307XG4gICAgdmFyIHByb2ZpbGVPbiA9IGZhbHNlO1xuICAgIHZhciBwcm9maWxlRW5hYmxlID0gZnVuY3Rpb24ob24pIHtcbiAgICAgIGlmIChvbiA9PT0gdW5kZWZpbmVkKSBvbiA9IHRydWU7XG4gICAgICBwcm9maWxlT24gPSBvbjtcbiAgICB9OyAvLyBwcm9maWxlRW5hYmxlXG4gICAgdmFyIHByb2ZpbGVDbGVhciA9IGZ1bmN0aW9uKCkge1xuICAgICAgaWYgKCFwcm9maWxlT24pIHJldHVybjtcbiAgICAgIHByb2ZpbGVzID0ge307XG4gICAgICBwcm9maWxlU3RhcnRzID0ge307XG4gICAgfTsgLy8gcHJvZmlsZUNsZWFyXG4gICAgdmFyIHByb2ZpbGVTdGFydCA9IGZ1bmN0aW9uKGxhYmVsKSB7XG4gICAgICBpZiAoIXByb2ZpbGVPbikgcmV0dXJuO1xuICAgICAgcHJvZmlsZVN0YXJ0c1tsYWJlbF0gPSBuZXcgRGF0ZSgpO1xuICAgIH07IC8vIHByb2ZpbGVTdGFydFxuICAgIHZhciBwcm9maWxlRW5kID0gZnVuY3Rpb24obGFiZWwpIHtcbiAgICAgIGlmICghcHJvZmlsZU9uKSByZXR1cm47XG4gICAgICB2YXIgcHJvZmlsZUVsYXBzZWQgPSBuZXcgRGF0ZSgpIC0gcHJvZmlsZVN0YXJ0c1tsYWJlbF1cbiAgICAgIGlmICghcHJvZmlsZXNbbGFiZWxdKSBwcm9maWxlc1tsYWJlbF0gPSAwO1xuICAgICAgcHJvZmlsZXNbbGFiZWxdICs9IHByb2ZpbGVFbGFwc2VkO1xuICAgIH07IC8vIHByb2ZpbGVFbmRcbiAgICB2YXIgcHJvZmlsZVJlcG9ydCA9IGZ1bmN0aW9uKCkge1xuICAgICAgaWYgKCFwcm9maWxlT24pIHJldHVybjtcbiAgICAgIGlmICh3aW5kb3cuY29uc29sZSkge1xuICAgICAgICAkLmVhY2gocHJvZmlsZXMsIGZ1bmN0aW9uKGxhYmVsLCB0aW1lKSB7XG4gICAgICAgICAgY29uc29sZS5sb2coXCJwcm9maWxlIFwiICsgbGFiZWwsIHRpbWUpO1xuICAgICAgICB9KTtcbiAgICAgICAgY29uc29sZS5sb2coXCItLS0tLS0tXCIpO1xuICAgICAgfVxuICAgIH07IC8vIHByb2ZpbGVSZXBvcnRcblxuICAgIC8vIGNvbnRhaW5lcjogSUQgb3IgalF1ZXJ5IGVsZW1lbnRcbiAgICAvLyBjb2xsRGF0YTogdGhlIGNvbGxlY3Rpb24gZGF0YSAoaW4gdGhlIGZvcm1hdCBvZiB0aGUgcmVzdWx0IG9mXG4gICAgLy8gICBodHRwOi8vLi4uL2JyYXQvYWpheC5jZ2k/YWN0aW9uPWdldENvbGxlY3Rpb25JbmZvcm1hdGlvbiZjb2xsZWN0aW9uPS4uLlxuICAgIC8vIGRvY0RhdGE6IHRoZSBkb2N1bWVudCBkYXRhIChpbiB0aGUgZm9ybWF0IG9mIHRoZSByZXN1bHQgb2ZcbiAgICAvLyAgIGh0dHA6Ly8uLi4vYnJhdC9hamF4LmNnaT9hY3Rpb249Z2V0RG9jdW1lbnQmY29sbGVjdGlvbj0uLi4mZG9jdW1lbnQ9Li4uXG4gICAgLy8gcmV0dXJucyB0aGUgZW1iZWRkZWQgdmlzdWFsaXplcidzIGRpc3BhdGNoZXIgb2JqZWN0XG4gICAgdmFyIGVtYmVkID0gZnVuY3Rpb24oY29udGFpbmVyLCBjb2xsRGF0YSwgZG9jRGF0YSwgd2ViRm9udFVSTHMpIHtcbiAgICAgIHZhciBkaXNwYXRjaGVyID0gbmV3IERpc3BhdGNoZXIoKTtcbiAgICAgIHZhciB2aXN1YWxpemVyID0gbmV3IFZpc3VhbGl6ZXIoZGlzcGF0Y2hlciwgY29udGFpbmVyLCB3ZWJGb250VVJMcyk7XG4gICAgICBkb2NEYXRhLmNvbGxlY3Rpb24gPSBudWxsO1xuICAgICAgZGlzcGF0Y2hlci5wb3N0KCdjb2xsZWN0aW9uTG9hZGVkJywgW2NvbGxEYXRhXSk7XG4gICAgICBkaXNwYXRjaGVyLnBvc3QoJ3JlcXVlc3RSZW5kZXJEYXRhJywgW2RvY0RhdGFdKTtcbiAgICAgIHJldHVybiBkaXNwYXRjaGVyO1xuICAgIH07XG5cbiAgICAvLyBjb250YWluZXI6IElEIG9yIGpRdWVyeSBlbGVtZW50XG4gICAgLy8gY29sbERhdGFVUkw6IHRoZSBVUkwgb2YgdGhlIGNvbGxlY3Rpb24gZGF0YSwgb3IgY29sbGVjdGlvbiBkYXRhXG4gICAgLy8gICBvYmplY3QgKGlmIHByZS1mZXRjaGVkKVxuICAgIC8vIGRvY0RhdGFVUkw6IHRoZSB1cmwgb2YgdGhlIGRvY3VtZW50IGRhdGEgKGlmIHByZS1mZXRjaGVkLCB1c2VcbiAgICAvLyAgIHNpbXBsZSBgZW1iZWRgIGluc3RlYWQpXG4gICAgLy8gY2FsbGJhY2s6IG9wdGlvbmFsOyB0aGUgY2FsbGJhY2sgdG8gY2FsbCBhZnRlcndhcmRzOyBpdCB3aWxsIGJlXG4gICAgLy8gICBwYXNzZWQgdGhlIGVtYmVkZGVkIHZpc3VhbGl6ZXIncyBkaXNwYXRjaGVyIG9iamVjdFxuICAgIHZhciBlbWJlZEJ5VVJMID0gZnVuY3Rpb24oY29udGFpbmVyLCBjb2xsRGF0YVVSTCwgZG9jRGF0YVVSTCwgY2FsbGJhY2spIHtcbiAgICAgIHZhciBjb2xsRGF0YSwgZG9jRGF0YTtcbiAgICAgIHZhciBoYW5kbGVyID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIGlmIChjb2xsRGF0YSAmJiBkb2NEYXRhKSB7XG4gICAgICAgICAgdmFyIGRpc3BhdGNoZXIgPSBlbWJlZChjb250YWluZXIsIGNvbGxEYXRhLCBkb2NEYXRhKTtcbiAgICAgICAgICBpZiAoY2FsbGJhY2spIGNhbGxiYWNrKGRpc3BhdGNoZXIpO1xuICAgICAgICB9XG4gICAgICB9O1xuICAgICAgaWYgKHR5cGVvZihjb250YWluZXIpID09ICdzdHJpbmcnKSB7XG4gICAgICAgICQuZ2V0SlNPTihjb2xsRGF0YVVSTCwgZnVuY3Rpb24oZGF0YSkgeyBjb2xsRGF0YSA9IGRhdGE7IGhhbmRsZXIoKTsgfSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBjb2xsRGF0YSA9IGNvbGxEYXRhVVJMO1xuICAgICAgfVxuICAgICAgJC5nZXRKU09OKGRvY0RhdGFVUkwsIGZ1bmN0aW9uKGRhdGEpIHsgZG9jRGF0YSA9IGRhdGE7IGhhbmRsZXIoKTsgfSk7XG4gICAgfTtcblxuXG4gICAgcmV0dXJuIHtcbiAgICAgIHByb2ZpbGVFbmFibGU6IHByb2ZpbGVFbmFibGUsXG4gICAgICBwcm9maWxlQ2xlYXI6IHByb2ZpbGVDbGVhcixcbiAgICAgIHByb2ZpbGVTdGFydDogcHJvZmlsZVN0YXJ0LFxuICAgICAgcHJvZmlsZUVuZDogcHJvZmlsZUVuZCxcbiAgICAgIHByb2ZpbGVSZXBvcnQ6IHByb2ZpbGVSZXBvcnQsXG4gICAgICBmb3JtYXRUaW1lQWdvOiBmb3JtYXRUaW1lQWdvLFxuICAgICAgcmVhbEJCb3g6IHJlYWxCQm94LFxuICAgICAgZ2V0U3BhbkxhYmVsczogZ2V0U3BhbkxhYmVscyxcbiAgICAgIHNwYW5EaXNwbGF5Rm9ybTogc3BhbkRpc3BsYXlGb3JtLFxuICAgICAgZ2V0QXJjTGFiZWxzOiBnZXRBcmNMYWJlbHMsXG4gICAgICBhcmNEaXNwbGF5Rm9ybTogYXJjRGlzcGxheUZvcm0sXG4gICAgICBlc2NhcGVRdW90ZXM6IGVzY2FwZVF1b3RlcyxcbiAgICAgIGVzY2FwZUhUTUw6IGVzY2FwZUhUTUwsXG4gICAgICBlc2NhcGVIVE1MYW5kUXVvdGVzOiBlc2NhcGVIVE1MYW5kUXVvdGVzLFxuICAgICAgZXNjYXBlSFRNTHdpdGhOZXdsaW5lczogZXNjYXBlSFRNTHdpdGhOZXdsaW5lcyxcbiAgICAgIGNtcDogY21wLFxuICAgICAgcmdiVG9Ic2w6IHJnYlRvSHNsLFxuICAgICAgaHNsVG9SZ2I6IGhzbFRvUmdiLFxuICAgICAgYWRqdXN0Q29sb3JMaWdodG5lc3M6IGFkanVzdENvbG9yTGlnaHRuZXNzLFxuICAgICAgb2JqZWN0VG9VcmxTdHI6IG9iamVjdFRvVXJsU3RyLFxuICAgICAgaXNFcXVhbDogaXNFcXVhbCxcbiAgICAgIHBhcmFtQXJyYXk6IHBhcmFtQXJyYXksXG4gICAgICBwYXJhbTogcGFyYW0sXG4gICAgICBkZXBhcmFtOiBkZXBhcmFtLFxuICAgICAgZW1iZWQ6IGVtYmVkLFxuICAgICAgZW1iZWRCeVVSTDogZW1iZWRCeVVSTCxcbiAgICB9O1xuXG59KSh3aW5kb3cpO1xuXG4vLyBCUkFUIFNUQU5EQUxPTkUgTElCUkFSWSBCRUdJTlxuLy8gQnJvd3NlcmlmeSBleHBvcnRcbm1vZHVsZS5leHBvcnRzID0gVXRpbDtcbi8vIEJSQVQgU1RBTkRBTE9ORSBMSUJSQVJZIEVORFxuIiwiLy8gLSotIE1vZGU6IEphdmFTY3JpcHQ7IHRhYi13aWR0aDogMjsgaW5kZW50LXRhYnMtbW9kZTogbmlsOyAtKi1cbi8vIHZpbTpzZXQgZnQ9amF2YXNjcmlwdCB0cz0yIHN3PTIgc3RzPTIgY2luZGVudDpcblxudmFyIFZpc3VhbGl6ZXIgPSAoZnVuY3Rpb24oJCwgd2luZG93LCB1bmRlZmluZWQpIHtcbiAgICB2YXIgZm9udExvYWRUaW1lb3V0ID0gNTAwMDsgLy8gNSBzZWNvbmRzXG4gIFxuICAgIHZhciBEb2N1bWVudERhdGEgPSBmdW5jdGlvbih0ZXh0KSB7XG4gICAgICB0aGlzLnRleHQgPSB0ZXh0O1xuICAgICAgdGhpcy5jaHVua3MgPSBbXTtcbiAgICAgIHRoaXMuc3BhbnMgPSB7fTtcbiAgICAgIHRoaXMuZXZlbnREZXNjcyA9IHt9O1xuICAgICAgdGhpcy5zZW50Q29tbWVudCA9IHt9O1xuICAgICAgdGhpcy5hcmNzID0gW107XG4gICAgICB0aGlzLmFyY0J5SWQgPSB7fTtcbiAgICAgIHRoaXMubWFya2VkU2VudCA9IHt9O1xuICAgICAgdGhpcy5zcGFuQW5uVGV4dHMgPSB7fTtcbiAgICAgIHRoaXMudG93ZXJzID0ge307XG4gICAgICAvLyB0aGlzLnNpemVzID0ge307XG4gICAgfTtcblxuICAgIHZhciBGcmFnbWVudCA9IGZ1bmN0aW9uKGlkLCBzcGFuLCBmcm9tLCB0bykge1xuICAgICAgdGhpcy5pZCA9IGlkO1xuICAgICAgdGhpcy5zcGFuID0gc3BhbjtcbiAgICAgIHRoaXMuZnJvbSA9IGZyb207XG4gICAgICB0aGlzLnRvID0gdG87XG4gICAgICAvLyB0aGlzLnRvd2VySWQgPSB1bmRlZmluZWQ7XG4gICAgICAvLyB0aGlzLmRyYXdPcmRlciA9IHVuZGVmaW5lZDtcbiAgICB9O1xuXG4gICAgdmFyIFNwYW4gPSBmdW5jdGlvbihpZCwgdHlwZSwgb2Zmc2V0cywgZ2VuZXJhbFR5cGUpIHtcbiAgICAgIHRoaXMuaWQgPSBpZDtcbiAgICAgIHRoaXMudHlwZSA9IHR5cGU7XG4gICAgICB0aGlzLnRvdGFsRGlzdCA9IDA7XG4gICAgICB0aGlzLm51bUFyY3MgPSAwO1xuICAgICAgdGhpcy5nZW5lcmFsVHlwZSA9IGdlbmVyYWxUeXBlO1xuICAgICAgdGhpcy5vZmZzZXRzID0gb2Zmc2V0cztcbiAgICAgIHRoaXMuaGVhZEZyYWdtZW50ID0gbnVsbDtcbiAgICAgIC8vIHRoaXMuZnJvbSA9IHVuZGVmaW5lZDtcbiAgICAgIC8vIHRoaXMudG8gPSB1bmRlZmluZWQ7XG4gICAgICAvLyB0aGlzLndob2xlRnJvbSA9IHVuZGVmaW5lZDtcbiAgICAgIC8vIHRoaXMud2hvbGVUbyA9IHVuZGVmaW5lZDtcbiAgICAgIC8vIHRoaXMuaGVhZEZyYWdtZW50ID0gdW5kZWZpbmVkO1xuICAgICAgLy8gdGhpcy5jaHVuayA9IHVuZGVmaW5lZDtcbiAgICAgIC8vIHRoaXMubWFya2VkID0gdW5kZWZpbmVkO1xuICAgICAgLy8gdGhpcy5hdmdEaXN0ID0gdW5kZWZpbmVkO1xuICAgICAgLy8gdGhpcy5jdXJseSA9IHVuZGVmaW5lZDtcbiAgICAgIC8vIHRoaXMuY29tbWVudCA9IHVuZGVmaW5lZDsgLy8geyB0eXBlOiB1bmRlZmluZWQsIHRleHQ6IHVuZGVmaW5lZCB9O1xuICAgICAgLy8gdGhpcy5hbm5vdGF0b3JOb3RlcyA9IHVuZGVmaW5lZDtcbiAgICAgIC8vIHRoaXMuZHJhd0N1cmx5ID0gdW5kZWZpbmVkO1xuICAgICAgLy8gdGhpcy5nbHlwaGVkTGFiZWxUZXh0ID0gdW5kZWZpbmVkO1xuICAgICAgLy8gdGhpcy5ncm91cCA9IHVuZGVmaW5lZDtcbiAgICAgIC8vIHRoaXMuaGVpZ2h0ID0gdW5kZWZpbmVkO1xuICAgICAgLy8gdGhpcy5oaWdobGlnaHRQb3MgPSB1bmRlZmluZWQ7XG4gICAgICAvLyB0aGlzLmluZGV4TnVtYmVyID0gdW5kZWZpbmVkO1xuICAgICAgLy8gdGhpcy5sYWJlbFRleHQgPSB1bmRlZmluZWQ7XG4gICAgICAvLyB0aGlzLm5lc3RpbmdEZXB0aCA9IHVuZGVmaW5lZDtcbiAgICAgIC8vIHRoaXMubmVzdGluZ0RlcHRoTFIgPSB1bmRlZmluZWQ7XG4gICAgICAvLyB0aGlzLm5lc3RpbmdEZXB0aFJMID0gdW5kZWZpbmVkO1xuICAgICAgLy8gdGhpcy5uZXN0aW5nSGVpZ2h0ID0gdW5kZWZpbmVkO1xuICAgICAgLy8gdGhpcy5uZXN0aW5nSGVpZ2h0TFIgPSB1bmRlZmluZWQ7XG4gICAgICAvLyB0aGlzLm5lc3RpbmdIZWlnaHRSTCA9IHVuZGVmaW5lZDtcbiAgICAgIC8vIHRoaXMucmVjdCA9IHVuZGVmaW5lZDtcbiAgICAgIC8vIHRoaXMucmVjdEJveCA9IHVuZGVmaW5lZDtcbiAgICAgIC8vIHRoaXMucmVmZWRJbmRleFN1bSA9IHVuZGVmaW5lZDtcbiAgICAgIC8vIHRoaXMucmlnaHQgPSB1bmRlZmluZWQ7XG4gICAgICAvLyB0aGlzLnRvdGFsZGlzdCA9IHVuZGVmaW5lZDtcbiAgICAgIC8vIHRoaXMud2lkdGggPSB1bmRlZmluZWQ7XG4gICAgICB0aGlzLmluaXRDb250YWluZXJzKG9mZnNldHMpO1xuICAgIH07XG5cbiAgICBTcGFuLnByb3RvdHlwZS5pbml0Q29udGFpbmVycyA9IGZ1bmN0aW9uKCkge1xuICAgICAgdGhpcy5pbmNvbWluZyA9IFtdO1xuICAgICAgdGhpcy5vdXRnb2luZyA9IFtdO1xuICAgICAgdGhpcy5hdHRyaWJ1dGVzID0ge307XG4gICAgICB0aGlzLmF0dHJpYnV0ZVRleHQgPSBbXTtcbiAgICAgIHRoaXMuYXR0cmlidXRlQ3VlcyA9IHt9O1xuICAgICAgdGhpcy5hdHRyaWJ1dGVDdWVGb3IgPSB7fTtcbiAgICAgIHRoaXMuYXR0cmlidXRlTWVyZ2UgPSB7fTsgLy8gZm9yIGJveCwgY3Jvc3MsIGV0Yy4gdGhhdCBhcmUgc3Bhbi1nbG9iYWxcbiAgICAgIHRoaXMuZnJhZ21lbnRzID0gW107XG4gICAgICB0aGlzLm5vcm1hbGl6YXRpb25zID0gW107XG4gICAgfTtcblxuICAgIFNwYW4ucHJvdG90eXBlLmNvcHkgPSBmdW5jdGlvbihpZCkge1xuICAgICAgdmFyIHNwYW4gPSAkLmV4dGVuZChuZXcgU3BhbigpLCB0aGlzKTsgLy8gY2xvbmVcbiAgICAgIHNwYW4uaWQgPSBpZDtcbiAgICAgIHNwYW4uaW5pdENvbnRhaW5lcnMoKTsgLy8gcHJvdGVjdCBmcm9tIHNoYWxsb3cgY29weVxuICAgICAgcmV0dXJuIHNwYW47XG4gICAgfTtcblxuICAgIHZhciBFdmVudERlc2MgPSBmdW5jdGlvbihpZCwgdHJpZ2dlcklkLCByb2xlcywga2xhc3MpIHtcbiAgICAgIHRoaXMuaWQgPSBpZDtcbiAgICAgIHRoaXMudHJpZ2dlcklkID0gdHJpZ2dlcklkO1xuICAgICAgdmFyIHJvbGVMaXN0ID0gdGhpcy5yb2xlcyA9IFtdO1xuICAgICAgJC5lYWNoKHJvbGVzLCBmdW5jdGlvbihyb2xlTm8sIHJvbGUpIHtcbiAgICAgICAgcm9sZUxpc3QucHVzaCh7IHR5cGU6IHJvbGVbMF0sIHRhcmdldElkOiByb2xlWzFdIH0pO1xuICAgICAgfSk7XG4gICAgICBpZiAoa2xhc3MgPT0gXCJlcXVpdlwiKSB7XG4gICAgICAgIHRoaXMuZXF1aXYgPSB0cnVlO1xuICAgICAgfSBlbHNlIGlmIChrbGFzcyA9PSBcInJlbGF0aW9uXCIpIHtcbiAgICAgICAgdGhpcy5yZWxhdGlvbiA9IHRydWU7XG4gICAgICB9XG4gICAgICAvLyB0aGlzLmxlZnRTcGFucyA9IHVuZGVmaW5lZDtcbiAgICAgIC8vIHRoaXMucmlnaHRTcGFucyA9IHVuZGVmaW5lZDtcbiAgICAgIC8vIHRoaXMuYW5ub3RhdG9yTm90ZXMgPSB1bmRlZmluZWQ7XG4gICAgfTtcblxuICAgIHZhciBDaHVuayA9IGZ1bmN0aW9uKGluZGV4LCB0ZXh0LCBmcm9tLCB0bywgc3BhY2UsIHNwYW5zKSB7XG4gICAgICB0aGlzLmluZGV4ID0gaW5kZXg7XG4gICAgICB0aGlzLnRleHQgPSB0ZXh0O1xuICAgICAgdGhpcy5mcm9tID0gZnJvbTtcbiAgICAgIHRoaXMudG8gPSB0bztcbiAgICAgIHRoaXMuc3BhY2UgPSBzcGFjZTtcbiAgICAgIHRoaXMuZnJhZ21lbnRzID0gW107XG4gICAgICAvLyB0aGlzLnNlbnRlbmNlID0gdW5kZWZpbmVkO1xuICAgICAgLy8gdGhpcy5ncm91cCA9IHVuZGVmaW5lZDtcbiAgICAgIC8vIHRoaXMuaGlnaGxpZ2h0R3JvdXAgPSB1bmRlZmluZWQ7XG4gICAgICAvLyB0aGlzLm1hcmtlZFRleHRTdGFydCA9IHVuZGVmaW5lZDtcbiAgICAgIC8vIHRoaXMubWFya2VkVGV4dEVuZCA9IHVuZGVmaW5lZDtcbiAgICAgIC8vIHRoaXMubmV4dFNwYWNlID0gdW5kZWZpbmVkO1xuICAgICAgLy8gdGhpcy5yaWdodCA9IHVuZGVmaW5lZDtcbiAgICAgIC8vIHRoaXMucm93ID0gdW5kZWZpbmVkO1xuICAgICAgLy8gdGhpcy50ZXh0WCA9IHVuZGVmaW5lZDtcbiAgICAgIC8vIHRoaXMudHJhbnNsYXRpb24gPSB1bmRlZmluZWQ7XG4gICAgfVxuXG4gICAgdmFyIEFyYyA9IGZ1bmN0aW9uKGV2ZW50RGVzYywgcm9sZSwgZGlzdCwgZXZlbnRObykge1xuICAgICAgdGhpcy5vcmlnaW4gPSBldmVudERlc2MuaWQ7XG4gICAgICB0aGlzLnRhcmdldCA9IHJvbGUudGFyZ2V0SWQ7XG4gICAgICB0aGlzLmRpc3QgPSBkaXN0O1xuICAgICAgdGhpcy50eXBlID0gcm9sZS50eXBlO1xuICAgICAgdGhpcy5zaGFkb3dDbGFzcyA9IGV2ZW50RGVzYy5zaGFkb3dDbGFzcztcbiAgICAgIHRoaXMuanVtcEhlaWdodCA9IDA7XG4gICAgICBpZiAoZXZlbnREZXNjLmVxdWl2KSB7XG4gICAgICAgIHRoaXMuZXF1aXYgPSB0cnVlO1xuICAgICAgICB0aGlzLmV2ZW50RGVzY0lkID0gZXZlbnRObztcbiAgICAgICAgZXZlbnREZXNjLmVxdWl2QXJjID0gdGhpcztcbiAgICAgIH0gZWxzZSBpZiAoZXZlbnREZXNjLnJlbGF0aW9uKSB7XG4gICAgICAgIHRoaXMucmVsYXRpb24gPSB0cnVlO1xuICAgICAgICB0aGlzLmV2ZW50RGVzY0lkID0gZXZlbnRObztcbiAgICAgIH1cbiAgICAgIC8vIHRoaXMubWFya2VkID0gdW5kZWZpbmVkO1xuICAgIH07XG5cbiAgICB2YXIgUm93ID0gZnVuY3Rpb24oc3ZnKSB7XG4gICAgICB0aGlzLmdyb3VwID0gc3ZnLmdyb3VwKCk7XG4gICAgICB0aGlzLmJhY2tncm91bmQgPSBzdmcuZ3JvdXAodGhpcy5ncm91cCk7XG4gICAgICB0aGlzLmNodW5rcyA9IFtdO1xuICAgICAgdGhpcy5oYXNBbm5vdGF0aW9ucyA9IGZhbHNlO1xuICAgICAgdGhpcy5tYXhBcmNIZWlnaHQgPSAwO1xuICAgICAgdGhpcy5tYXhTcGFuSGVpZ2h0ID0gMDtcbiAgICB9O1xuXG4gICAgdmFyIE1lYXN1cmVtZW50cyA9IGZ1bmN0aW9uKHdpZHRocywgaGVpZ2h0LCB5KSB7XG4gICAgICB0aGlzLndpZHRocyA9IHdpZHRocztcbiAgICAgIHRoaXMuaGVpZ2h0ID0gaGVpZ2h0O1xuICAgICAgdGhpcy55ID0geTtcbiAgICB9O1xuXG4gICAgLy8gQSBuYWl2ZSB3aGl0ZXNwYWNlIHRva2VuaXNlclxuICAgIHZhciB0b2tlbmlzZSA9IGZ1bmN0aW9uKHRleHQpIHtcbiAgICAgIHZhciB0b2tlbk9mZnNldHMgPSBbXTtcbiAgICAgIHZhciB0b2tlblN0YXJ0ID0gbnVsbDtcbiAgICAgIHZhciBsYXN0Q2hhclBvcyA9IG51bGw7XG5cbiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGV4dC5sZW5ndGg7IGkrKykge1xuICAgICAgICB2YXIgYyA9IHRleHRbaV07XG4gICAgICAgIC8vIEhhdmUgd2UgZm91bmQgdGhlIHN0YXJ0IG9mIGEgdG9rZW4/XG4gICAgICAgIGlmICh0b2tlblN0YXJ0ID09IG51bGwgJiYgIS9cXHMvLnRlc3QoYykpIHtcbiAgICAgICAgICB0b2tlblN0YXJ0ID0gaTtcbiAgICAgICAgICBsYXN0Q2hhclBvcyA9IGk7XG4gICAgICAgIC8vIEhhdmUgd2UgZm91bmQgdGhlIGVuZCBvZiBhIHRva2VuP1xuICAgICAgICB9IGVsc2UgaWYgKC9cXHMvLnRlc3QoYykgJiYgdG9rZW5TdGFydCAhPSBudWxsKSB7XG4gICAgICAgICAgdG9rZW5PZmZzZXRzLnB1c2goW3Rva2VuU3RhcnQsIGldKTtcbiAgICAgICAgICB0b2tlblN0YXJ0ID0gbnVsbDtcbiAgICAgICAgLy8gSXMgaXQgYSBub24td2hpdGVzcGFjZSBjaGFyYWN0ZXI/XG4gICAgICAgIH0gZWxzZSBpZiAoIS9cXHMvLnRlc3QoYykpIHtcbiAgICAgICAgICBsYXN0Q2hhclBvcyA9IGk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIC8vIERvIHdlIGhhdmUgYSB0cmFpbGluZyB0b2tlbj9cbiAgICAgIGlmICh0b2tlblN0YXJ0ICE9IG51bGwpIHtcbiAgICAgICAgdG9rZW5PZmZzZXRzLnB1c2goW3Rva2VuU3RhcnQsIGxhc3RDaGFyUG9zICsgMV0pO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gdG9rZW5PZmZzZXRzO1xuICAgIH07XG5cbiAgICAvLyBBIG5haXZlIG5ld2xpbmUgc2VudGVuY2Ugc3BsaXR0ZXJcbiAgICB2YXIgc2VudGVuY2VTcGxpdCA9IGZ1bmN0aW9uKHRleHQpIHtcbiAgICAgIHZhciBzZW50ZW5jZU9mZnNldHMgPSBbXTtcbiAgICAgIHZhciBzZW50U3RhcnQgPSBudWxsO1xuICAgICAgdmFyIGxhc3RDaGFyUG9zID0gbnVsbDtcblxuICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0ZXh0Lmxlbmd0aDsgaSsrKSB7XG4gICAgICAgIHZhciBjID0gdGV4dFtpXTtcbiAgICAgICAgLy8gSGF2ZSB3ZSBmb3VuZCB0aGUgc3RhcnQgb2YgYSBzZW50ZW5jZT9cbiAgICAgICAgaWYgKHNlbnRTdGFydCA9PSBudWxsICYmICEvXFxzLy50ZXN0KGMpKSB7XG4gICAgICAgICAgc2VudFN0YXJ0ID0gaTtcbiAgICAgICAgICBsYXN0Q2hhclBvcyA9IGk7XG4gICAgICAgIC8vIEhhdmUgd2UgZm91bmQgdGhlIGVuZCBvZiBhIHNlbnRlbmNlP1xuICAgICAgICB9IGVsc2UgaWYgKGMgPT0gJ1xcbicgJiYgc2VudFN0YXJ0ICE9IG51bGwpIHtcbiAgICAgICAgICBzZW50ZW5jZU9mZnNldHMucHVzaChbc2VudFN0YXJ0LCBpXSk7XG4gICAgICAgICAgc2VudFN0YXJ0ID0gbnVsbDtcbiAgICAgICAgLy8gSXMgaXQgYSBub24td2hpdGVzcGFjZSBjaGFyYWN0ZXI/XG4gICAgICAgIH0gZWxzZSBpZiAoIS9cXHMvLnRlc3QoYykpIHtcbiAgICAgICAgICBsYXN0Q2hhclBvcyA9IGk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIC8vIERvIHdlIGhhdmUgYSB0cmFpbGluZyBzZW50ZW5jZSB3aXRob3V0IGEgY2xvc2luZyBuZXdsaW5lP1xuICAgICAgaWYgKHNlbnRTdGFydCAhPSBudWxsKSB7XG4gICAgICAgIHNlbnRlbmNlT2Zmc2V0cy5wdXNoKFtzZW50U3RhcnQsIGxhc3RDaGFyUG9zICsgMV0pO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gc2VudGVuY2VPZmZzZXRzO1xuICAgIH07XG5cbiAgICAvLyBTZXRzIGRlZmF1bHQgdmFsdWVzIGZvciBhIHdpZGUgcmFuZ2Ugb2Ygb3B0aW9uYWwgYXR0cmlidXRlc1xuICAgIHZhciBzZXRTb3VyY2VEYXRhRGVmYXVsdHMgPSBmdW5jdGlvbihzb3VyY2VEYXRhKSB7XG4gICAgICAvLyBUaGUgZm9sbG93aW5nIGFyZSBlbXB0eSBsaXN0cyBpZiBub3Qgc2V0XG4gICAgICAkLmVhY2goW1xuICAgICAgICAgICdhdHRyaWJ1dGVzJyxcbiAgICAgICAgICAnY29tbWVudHMnLFxuICAgICAgICAgICdlbnRpdGllcycsXG4gICAgICAgICAgJ2VxdWl2cycsXG4gICAgICAgICAgJ2V2ZW50cycsXG4gICAgICAgICAgJ21vZGlmaWNhdGlvbnMnLFxuICAgICAgICAgICdub3JtYWxpemF0aW9ucycsXG4gICAgICAgICAgJ3JlbGF0aW9ucycsXG4gICAgICAgICAgJ3RyaWdnZXJzJyxcbiAgICAgICAgICBdLCBmdW5jdGlvbihhdHRyTm8sIGF0dHIpIHtcbiAgICAgICAgaWYgKHNvdXJjZURhdGFbYXR0cl0gPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgIHNvdXJjZURhdGFbYXR0cl0gPSBbXTtcbiAgICAgICAgfVxuICAgICAgfSk7XG5cbiAgICAgIC8vIElmIHdlIGxhY2sgc2VudGVuY2Ugb2Zmc2V0cyB3ZSBmYWxsIGJhY2sgb24gbmFpdmUgc2VudGVuY2Ugc3BsaXR0aW5nXG4gICAgICBpZiAoc291cmNlRGF0YS5zZW50ZW5jZV9vZmZzZXRzID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgc291cmNlRGF0YS5zZW50ZW5jZV9vZmZzZXRzID0gc2VudGVuY2VTcGxpdChzb3VyY2VEYXRhLnRleHQpO1xuICAgICAgfVxuICAgICAgLy8gU2ltaWxhcmlseSB3ZSBmYWxsIGJhY2sgb24gd2hpdGVzcGFjZSB0b2tlbmlzYXRpb25cbiAgICAgIGlmIChzb3VyY2VEYXRhLnRva2VuX29mZnNldHMgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICBzb3VyY2VEYXRhLnRva2VuX29mZnNldHMgPSB0b2tlbmlzZShzb3VyY2VEYXRhLnRleHQpO1xuICAgICAgfVxuICAgIH07XG5cbiAgICAvLyBTZXQgZGVmYXVsdCB2YWx1ZXMgZm9yIGEgdmFyaWV0eSBvZiBjb2xsZWN0aW9uIGF0dHJpYnV0ZXNcbiAgICB2YXIgc2V0Q29sbGVjdGlvbkRlZmF1bHRzID0gZnVuY3Rpb24oY29sbGVjdGlvbkRhdGEpIHtcbiAgICAgIC8vIFRoZSBmb2xsb3dpbmcgYXJlIGVtcHR5IGxpc3RzIGlmIG5vdCBzZXRcbiAgICAgICQuZWFjaChbXG4gICAgICAgICAgJ2VudGl0eV9hdHRyaWJ1dGVfdHlwZXMnLFxuICAgICAgICAgICdlbnRpdHlfdHlwZXMnLFxuICAgICAgICAgICdldmVudF9hdHRyaWJ1dGVfdHlwZXMnLFxuICAgICAgICAgICdldmVudF90eXBlcycsXG4gICAgICAgICAgJ3JlbGF0aW9uX2F0dHJpYnV0ZV90eXBlcycsXG4gICAgICAgICAgJ3JlbGF0aW9uX3R5cGVzJyxcbiAgICAgICAgICAndW5jb25maWd1cmVkX3R5cGVzJyxcbiAgICAgICAgICBdLCBmdW5jdGlvbihhdHRyTm8sIGF0dHIpIHtcbiAgICAgICAgaWYgKGNvbGxlY3Rpb25EYXRhW2F0dHJdID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICBjb2xsZWN0aW9uRGF0YVthdHRyXSA9IFtdO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9O1xuXG4gICAgdmFyIFZpc3VhbGl6ZXIgPSBmdW5jdGlvbihkaXNwYXRjaGVyLCBzdmdJZCwgd2ViRm9udFVSTHMpIHtcbiAgICAgIHZhciAkc3ZnRGl2ID0gJCgnIycgKyBzdmdJZCk7XG4gICAgICBpZiAoISRzdmdEaXYubGVuZ3RoKSB7XG4gICAgICAgIHRocm93IEVycm9yKCdDb3VsZCBub3QgZmluZCBjb250YWluZXIgd2l0aCBpZD1cIicgKyBzdmdJZCArICdcIicpO1xuICAgICAgfVxuICAgICAgdmFyIHRoYXQgPSB0aGlzO1xuXG4gICAgICAvLyBPUFRJT05TXG4gICAgICB2YXIgcm91bmRDb29yZGluYXRlcyA9IHRydWU7IC8vIHRyeSB0byBoYXZlIGV4YWN0IHBpeGVsIG9mZnNldHNcbiAgICAgIHZhciBib3hUZXh0TWFyZ2luID0geyB4OiAwLCB5OiAxLjUgfTsgLy8gZWZmZWN0IGlzIGludmVyc2Ugb2YgXCJtYXJnaW5cIiBmb3Igc29tZSByZWFzb25cbiAgICAgIHZhciBoaWdobGlnaHRSb3VuZGluZyA9IHsgeDogMywgeTozIH07IC8vIHJ4LCByeSBmb3IgaGlnaGxpZ2h0IGJveGVzXG4gICAgICB2YXIgc3BhY2VXaWR0aHMgPSB7XG4gICAgICAgICcgJzogNCxcbiAgICAgICAgJ1xcdTAwYTAnOiA0LFxuICAgICAgICAnXFx1MjAwYic6IDAsXG4gICAgICAgICdcXHUzMDAwJzogOCxcbiAgICAgICAgJ1xcdTAwMDknOiAxMiwgLy9Vbmljb2RlIHRhYnVsYXRpb25cbiAgICAgICAgJ1xcbic6IDRcbiAgICAgIH07XG4gICAgICB2YXIgY29sb3JlZEN1cmxpZXMgPSB0cnVlOyAvLyBjb2xvciBjdXJsaWVzIGJ5IGJveCBCR1xuICAgICAgdmFyIGFyY1NsYW50ID0gMTU7IC8vMTA7XG4gICAgICB2YXIgbWluQXJjU2xhbnQgPSA4O1xuICAgICAgdmFyIGFyY0hvcml6b250YWxTcGFjaW5nID0gMTA7IC8vIG1pbiBzcGFjZSBib3hlcyB3aXRoIGNvbm5lY3RpbmcgYXJjXG4gICAgICB2YXIgcm93U3BhY2luZyA9IC01OyAgICAgICAgICAvLyBmb3Igc29tZSBmdW5ueSByZWFzb24gYXBwcm94LiAtMTAgZ2l2ZXMgXCJ0aWdodFwiIHBhY2tpbmcuXG4gICAgICB2YXIgc2VudE51bU1hcmdpbiA9IDUwO1xuICAgICAgdmFyIHNtb290aEFyY0N1cnZlcyA9IHRydWU7ICAgLy8gd2hldGhlciB0byB1c2UgY3VydmVzICh2cyBsaW5lcykgaW4gYXJjc1xuICAgICAgdmFyIHNtb290aEFyY1N0ZWVwbmVzcyA9IDAuNTsgLy8gc3RlZXBuZXNzIG9mIHNtb290aCBjdXJ2ZXMgKGNvbnRyb2wgcG9pbnQpXG4gICAgICB2YXIgcmV2ZXJzZUFyY0NvbnRyb2x4ID0gNTsgICAvLyBjb250cm9sIHBvaW50IGRpc3RhbmNlIGZvciBcIlVGTyBjYXRjaGVyc1wiXG5cbiAgICAgIC8vIFwic2hhZG93XCIgZWZmZWN0IHNldHRpbmdzIChub3RlLCBlcnJvciwgaW5jb21wZWxldGUpXG4gICAgICB2YXIgcmVjdFNoYWRvd1NpemUgPSAzO1xuICAgICAgdmFyIHJlY3RTaGFkb3dSb3VuZGluZyA9IDIuNTtcbiAgICAgIHZhciBhcmNMYWJlbFNoYWRvd1NpemUgPSAxO1xuICAgICAgdmFyIGFyY0xhYmVsU2hhZG93Um91bmRpbmcgPSA1O1xuICAgICAgdmFyIHNoYWRvd1N0cm9rZSA9IDIuNTsgLy8gVE9ETyBYWFg6IHRoaXMgZG9lc24ndCBhZmZlY3QgYW55dGhpbmcuLj9cblxuICAgICAgLy8gXCJtYXJrZWRcIiBlZmZlY3Qgc2V0dGluZ3MgKGVkaXRlZCwgZm9jdXMsIG1hdGNoKVxuICAgICAgdmFyIG1hcmtlZFNwYW5TaXplID0gNjtcbiAgICAgIHZhciBtYXJrZWRBcmNTaXplID0gMjtcbiAgICAgIHZhciBtYXJrZWRBcmNTdHJva2UgPSA3OyAvLyBUT0RPIFhYWDogdGhpcyBkb2Vzbid0IHNlZW0gdG8gZG8gYW55dGhpbmcuLj9cblxuICAgICAgdmFyIHJvd1BhZGRpbmcgPSAyO1xuICAgICAgdmFyIG5lc3RpbmdBZGp1c3RZU3RlcFNpemUgPSAyOyAvLyBzaXplIG9mIGhlaWdodCBhZGp1c3QgZm9yIG5lc3RlZC9uZXN0aW5nIHNwYW5zXG4gICAgICB2YXIgbmVzdGluZ0FkanVzdFhTdGVwU2l6ZSA9IDE7IC8vIHNpemUgb2YgaGVpZ2h0IGFkanVzdCBmb3IgbmVzdGVkL25lc3Rpbmcgc3BhbnNcblxuICAgICAgdmFyIGhpZ2hsaWdodFNlcXVlbmNlID0gJyNGRjk2MzI7I0ZGQ0MwMDsjRkY5NjMyJzsgLy8geWVsbG93IC0gZGVlcCBvcmFuZ2VcbiAgICAgIC8vdmFyIGhpZ2hsaWdodFNlcXVlbmNlID0gJyNGRkZDNjk7I0ZGQ0MwMDsjRkZGQzY5JzsgLy8gYSBiaXQgdG9uZWQgdG93blxuICAgICAgdmFyIGhpZ2hsaWdodFNwYW5TZXF1ZW5jZSA9IGhpZ2hsaWdodFNlcXVlbmNlO1xuICAgICAgdmFyIGhpZ2hsaWdodEFyY1NlcXVlbmNlID0gIGhpZ2hsaWdodFNlcXVlbmNlO1xuICAgICAgdmFyIGhpZ2hsaWdodFRleHRTZXF1ZW5jZSA9IGhpZ2hsaWdodFNlcXVlbmNlO1xuICAgICAgdmFyIGhpZ2hsaWdodER1cmF0aW9uID0gJzJzJztcbiAgICAgIC8vIGRpZmZlcmVudCBzZXF1ZW5jZSBmb3IgXCJtZXJlXCIgbWF0Y2hlcyAoYXMgb3Bwb3NlZCB0byBcImZvY3VzXCIgYW5kXG4gICAgICAvLyBcImVkaXRlZFwiIGhpZ2hsaWdodHMpXG4gICAgICB2YXIgaGlnaGxpZ2h0TWF0Y2hTZXF1ZW5jZSA9ICcjRkZGRjAwJzsgLy8gcGxhaW4geWVsbG93XG5cbiAgICAgIHZhciBmcmFnbWVudENvbm5lY3RvckRhc2hBcnJheSA9ICcxLDMsMywzJztcbiAgICAgIHZhciBmcmFnbWVudENvbm5lY3RvckNvbG9yID0gJyMwMDAwMDAnO1xuXG4gICAgICAvLyBFTkQgT1BUSU9OU1xuXG5cbiAgICAgIHZhciBzdmc7XG4gICAgICB2YXIgJHN2ZztcbiAgICAgIHZhciBkYXRhID0gbnVsbDtcbiAgICAgIHZhciBzb3VyY2VEYXRhID0gbnVsbDtcbiAgICAgIHZhciByZXF1ZXN0ZWREYXRhID0gbnVsbDtcbiAgICAgIHZhciBjb2xsLCBkb2MsIGFyZ3M7XG4gICAgICB2YXIgcmVsYXRpb25UeXBlc0hhc2g7XG4gICAgICB2YXIgaXNSZW5kZXJSZXF1ZXN0ZWQ7XG4gICAgICB2YXIgaXNDb2xsZWN0aW9uTG9hZGVkID0gZmFsc2U7XG4gICAgICB2YXIgZW50aXR5QXR0cmlidXRlVHlwZXMgPSBudWxsO1xuICAgICAgdmFyIGV2ZW50QXR0cmlidXRlVHlwZXMgPSBudWxsO1xuICAgICAgdmFyIHNwYW5UeXBlcyA9IG51bGw7XG4gICAgICB2YXIgaGlnaGxpZ2h0R3JvdXA7XG5cbiAgICAgIC8vIHZhciBjb21tZW50UHJpb0xldmVscyA9IFsnVW5jb25maXJtZWQnLCAnSW5jb21wbGV0ZScsICdXYXJuaW5nJywgJ0Vycm9yJywgJ0Fubm90YXRvck5vdGVzJ107XG4gICAgICAvLyBYWFggTWlnaHQgbmVlZCB0byBiZSB0d2Vha2VkIC0gaW5zZXJ0ZWQgZGlmZiBsZXZlbHNcbiAgICAgIHZhciBjb21tZW50UHJpb0xldmVscyA9IFtcbiAgICAgICAgJ1VuY29uZmlybWVkJywgJ0luY29tcGxldGUnLCAnV2FybmluZycsICdFcnJvcicsICdBbm5vdGF0b3JOb3RlcycsXG4gICAgICAgICdBZGRlZEFubm90YXRpb24nLCAnTWlzc2luZ0Fubm90YXRpb24nLCAnQ2hhbmdlZEFubm90YXRpb24nXTtcblxuICAgICAgdGhpcy5hcmNEcmFnT3JpZ2luID0gbnVsbDsgLy8gVE9ET1xuXG4gICAgICAvLyBkdWUgdG8gc2lsbHkgQ2hyb21lIGJ1ZywgSSBoYXZlIHRvIG1ha2UgaXQgcGF5IGF0dGVudGlvblxuICAgICAgdmFyIGZvcmNlUmVkcmF3ID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIGlmICghJC5icm93c2VyLmNocm9tZSkgcmV0dXJuOyAvLyBub3QgbmVlZGVkXG4gICAgICAgICRzdmcuY3NzKCdtYXJnaW4tYm90dG9tJywgMSk7XG4gICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7ICRzdmcuY3NzKCdtYXJnaW4tYm90dG9tJywgMCk7IH0sIDApO1xuICAgICAgfVxuXG4gICAgICB2YXIgcm93QkJveCA9IGZ1bmN0aW9uKHNwYW4pIHtcbiAgICAgICAgdmFyIGJveCA9ICQuZXh0ZW5kKHt9LCBzcGFuLnJlY3RCb3gpOyAvLyBjbG9uZVxuICAgICAgICB2YXIgY2h1bmtUcmFuc2xhdGlvbiA9IHNwYW4uY2h1bmsudHJhbnNsYXRpb247XG4gICAgICAgIGJveC54ICs9IGNodW5rVHJhbnNsYXRpb24ueDtcbiAgICAgICAgYm94LnkgKz0gY2h1bmtUcmFuc2xhdGlvbi55O1xuICAgICAgICByZXR1cm4gYm94O1xuICAgICAgfTtcblxuICAgICAgdmFyIGNvbW1lbnRQcmlvcml0eSA9IGZ1bmN0aW9uKGNvbW1lbnRDbGFzcykge1xuICAgICAgICBpZiAoY29tbWVudENsYXNzID09PSB1bmRlZmluZWQpIHJldHVybiAtMTtcbiAgICAgICAgdmFyIGxlbiA9IGNvbW1lbnRQcmlvTGV2ZWxzLmxlbmd0aDtcbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBsZW47IGkrKykge1xuICAgICAgICAgIGlmIChjb21tZW50Q2xhc3MuaW5kZXhPZihjb21tZW50UHJpb0xldmVsc1tpXSkgIT0gLTEpIHJldHVybiBpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiAwO1xuICAgICAgfTtcblxuICAgICAgdmFyIGNsZWFyU1ZHID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIGRhdGEgPSBudWxsO1xuICAgICAgICBzb3VyY2VEYXRhID0gbnVsbDtcbiAgICAgICAgc3ZnLmNsZWFyKCk7XG4gICAgICAgICRzdmdEaXYuaGlkZSgpO1xuICAgICAgfTtcblxuICAgICAgdmFyIHNldE1hcmtlZCA9IGZ1bmN0aW9uKG1hcmtlZFR5cGUpIHtcbiAgICAgICAgJC5lYWNoKGFyZ3NbbWFya2VkVHlwZV0gfHwgW10sIGZ1bmN0aW9uKG1hcmtlZE5vLCBtYXJrZWQpIHtcbiAgICAgICAgICBpZiAobWFya2VkWzBdID09ICdzZW50Jykge1xuICAgICAgICAgICAgZGF0YS5tYXJrZWRTZW50W21hcmtlZFsxXV0gPSB0cnVlO1xuICAgICAgICAgIH0gZWxzZSBpZiAobWFya2VkWzBdID09ICdlcXVpdicpIHsgLy8gW2VxdWl2LCBFcXVpdiwgVDFdXG4gICAgICAgICAgICAkLmVhY2goc291cmNlRGF0YS5lcXVpdnMsIGZ1bmN0aW9uKGVxdWl2Tm8sIGVxdWl2KSB7XG4gICAgICAgICAgICAgIGlmIChlcXVpdlsxXSA9PSBtYXJrZWRbMV0pIHtcbiAgICAgICAgICAgICAgICB2YXIgbGVuID0gZXF1aXYubGVuZ3RoO1xuICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAyOyBpIDwgbGVuOyBpKyspIHtcbiAgICAgICAgICAgICAgICAgIGlmIChlcXVpdltpXSA9PSBtYXJrZWRbMl0pIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gZm91bmQgaXRcbiAgICAgICAgICAgICAgICAgICAgbGVuIC09IDM7XG4gICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAxOyBpIDw9IGxlbjsgaSsrKSB7XG4gICAgICAgICAgICAgICAgICAgICAgdmFyIGFyYyA9IGRhdGEuZXZlbnREZXNjc1tlcXVpdlswXSArIFwiKlwiICsgaV0uZXF1aXZBcmM7XG4gICAgICAgICAgICAgICAgICAgICAgYXJjLm1hcmtlZCA9IG1hcmtlZFR5cGU7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuOyAvLyBuZXh0IGVxdWl2XG4gICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICB9IGVsc2UgaWYgKG1hcmtlZC5sZW5ndGggPT0gMikge1xuICAgICAgICAgICAgbWFya2VkVGV4dC5wdXNoKFtwYXJzZUludChtYXJrZWRbMF0sIDEwKSwgcGFyc2VJbnQobWFya2VkWzFdLCAxMCksIG1hcmtlZFR5cGVdKTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdmFyIHNwYW4gPSBkYXRhLnNwYW5zW21hcmtlZFswXV07XG4gICAgICAgICAgICBpZiAoc3Bhbikge1xuICAgICAgICAgICAgICBpZiAobWFya2VkLmxlbmd0aCA9PSAzKSB7IC8vIGFyY1xuICAgICAgICAgICAgICAgICQuZWFjaChzcGFuLm91dGdvaW5nLCBmdW5jdGlvbihhcmNObywgYXJjKSB7XG4gICAgICAgICAgICAgICAgICBpZiAoYXJjLnRhcmdldCA9PSBtYXJrZWRbMl0gJiYgYXJjLnR5cGUgPT0gbWFya2VkWzFdKSB7XG4gICAgICAgICAgICAgICAgICAgIGFyYy5tYXJrZWQgPSBtYXJrZWRUeXBlO1xuICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICB9IGVsc2UgeyAvLyBzcGFuXG4gICAgICAgICAgICAgICAgc3Bhbi5tYXJrZWQgPSBtYXJrZWRUeXBlO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICB2YXIgZXZlbnREZXNjID0gZGF0YS5ldmVudERlc2NzW21hcmtlZFswXV07XG4gICAgICAgICAgICAgIGlmIChldmVudERlc2MpIHsgLy8gcmVsYXRpb25cbiAgICAgICAgICAgICAgICB2YXIgcmVsQXJjID0gZXZlbnREZXNjLnJvbGVzWzBdO1xuICAgICAgICAgICAgICAgICQuZWFjaChkYXRhLnNwYW5zW2V2ZW50RGVzYy50cmlnZ2VySWRdLm91dGdvaW5nLCBmdW5jdGlvbihhcmNObywgYXJjKSB7XG4gICAgICAgICAgICAgICAgICBpZiAoYXJjLnRhcmdldCA9PSByZWxBcmMudGFyZ2V0SWQgJiYgYXJjLnR5cGUgPT0gcmVsQXJjLnR5cGUpIHtcbiAgICAgICAgICAgICAgICAgICAgYXJjLm1hcmtlZCA9IG1hcmtlZFR5cGU7XG4gICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgIH0gZWxzZSB7IC8vIHRyeSBmb3IgdHJpZ2dlclxuICAgICAgICAgICAgICAgICQuZWFjaChkYXRhLmV2ZW50RGVzY3MsIGZ1bmN0aW9uKGV2ZW50RGVzY05vLCBldmVudERlc2MpIHtcbiAgICAgICAgICAgICAgICAgIGlmIChldmVudERlc2MudHJpZ2dlcklkID09IG1hcmtlZFswXSkge1xuICAgICAgICAgICAgICAgICAgICBkYXRhLnNwYW5zW2V2ZW50RGVzYy5pZF0ubWFya2VkID0gbWFya2VkVHlwZTtcbiAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICB9O1xuXG4gICAgICB2YXIgZnJhZ21lbnRDb21wYXJhdG9yID0gZnVuY3Rpb24oYSwgYikge1xuICAgICAgICB2YXIgdG1wO1xuICAgICAgICB2YXIgYVNwYW4gPSBhLnNwYW47XG4gICAgICAgIHZhciBiU3BhbiA9IGIuc3BhbjtcblxuICAgICAgICAvLyBzcGFucyB3aXRoIG1vcmUgZnJhZ21lbnRzIGdvIGZpcnN0XG4gICAgICAgIHRtcCA9IGFTcGFuLmZyYWdtZW50cy5sZW5ndGggLSBiU3Bhbi5mcmFnbWVudHMubGVuZ3RoO1xuICAgICAgICBpZiAodG1wKSB7XG4gICAgICAgICAgcmV0dXJuIHRtcCA8IDAgPyAxIDogLTE7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBsb25nZXIgYXJjIGRpc3RhbmNlcyBnbyBsYXN0XG4gICAgICAgIHRtcCA9IGFTcGFuLmF2Z0Rpc3QgLSBiU3Bhbi5hdmdEaXN0O1xuICAgICAgICBpZiAodG1wKSB7XG4gICAgICAgICAgcmV0dXJuIHRtcCA8IDAgPyAtMSA6IDE7XG4gICAgICAgIH1cbiAgICAgICAgLy8gc3BhbnMgd2l0aCBtb3JlIGFyY3MgZ28gbGFzdFxuICAgICAgICB0bXAgPSBhU3Bhbi5udW1BcmNzIC0gYlNwYW4ubnVtQXJjcztcbiAgICAgICAgaWYgKHRtcCkge1xuICAgICAgICAgIHJldHVybiB0bXAgPCAwID8gLTEgOiAxO1xuICAgICAgICB9XG4gICAgICAgIC8vIGNvbXBhcmUgdGhlIHNwYW4gd2lkdGhzLFxuICAgICAgICAvLyBwdXQgd2lkZXIgb24gYm90dG9tIHNvIHRoZXkgZG9uJ3QgbWVzcyB3aXRoIGFyY3MsIG9yIHNob3J0ZXJcbiAgICAgICAgLy8gb24gYm90dG9tIGlmIHRoZXJlIGFyZSBubyBhcmNzLlxuICAgICAgICB2YXIgYWQgPSBhLnRvIC0gYS5mcm9tO1xuICAgICAgICB2YXIgYmQgPSBiLnRvIC0gYi5mcm9tO1xuICAgICAgICB0bXAgPSBhZCAtIGJkO1xuICAgICAgICBpZiAoYVNwYW4ubnVtQXJjcyA9PSAwICYmIGJTcGFuLm51bUFyY3MgPT0gMCkge1xuICAgICAgICAgIHRtcCA9IC10bXA7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRtcCkge1xuICAgICAgICAgIHJldHVybiB0bXAgPCAwID8gMSA6IC0xO1xuICAgICAgICB9XG4gICAgICAgIHRtcCA9IGFTcGFuLnJlZmVkSW5kZXhTdW0gLSBiU3Bhbi5yZWZlZEluZGV4U3VtO1xuICAgICAgICBpZiAodG1wKSB7XG4gICAgICAgICAgcmV0dXJuIHRtcCA8IDAgPyAtMSA6IDE7XG4gICAgICAgIH1cbiAgICAgICAgLy8gaWYgbm8gb3RoZXIgY3JpdGVyaW9uIGlzIGZvdW5kLCBzb3J0IGJ5IHR5cGUgdG8gbWFpbnRhaW5cbiAgICAgICAgLy8gY29uc2lzdGVuY3lcbiAgICAgICAgLy8gVE9ETzogaXNuJ3QgdGhlcmUgYSBjbXAoKSBpbiBKUz9cbiAgICAgICAgaWYgKGFTcGFuLnR5cGUgPCBiU3Bhbi50eXBlKSB7XG4gICAgICAgICAgcmV0dXJuIC0xO1xuICAgICAgICB9IGVsc2UgaWYgKGFTcGFuLnR5cGUgPiBiU3Bhbi50eXBlKSB7XG4gICAgICAgICAgcmV0dXJuIDE7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gMDtcbiAgICAgIH07XG5cblxuICAgICAgdmFyIHNldERhdGEgPSBmdW5jdGlvbihfc291cmNlRGF0YSkge1xuICAgICAgICBpZiAoIWFyZ3MpIGFyZ3MgPSB7fTtcbiAgICAgICAgc291cmNlRGF0YSA9IF9zb3VyY2VEYXRhO1xuICAgICAgICBkaXNwYXRjaGVyLnBvc3QoJ25ld1NvdXJjZURhdGEnLCBbc291cmNlRGF0YV0pO1xuICAgICAgICBkYXRhID0gbmV3IERvY3VtZW50RGF0YShzb3VyY2VEYXRhLnRleHQpO1xuXG4gICAgICAgIC8vIGNvbGxlY3QgYW5ub3RhdGlvbiBkYXRhXG4gICAgICAgICQuZWFjaChzb3VyY2VEYXRhLmVudGl0aWVzLCBmdW5jdGlvbihlbnRpdHlObywgZW50aXR5KSB7XG4gICAgICAgICAgLy8gb2Zmc2V0cyBnaXZlbiBhcyBhcnJheSBvZiAoc3RhcnQsIGVuZCkgcGFpcnNcbiAgICAgICAgICB2YXIgc3BhbiA9XG4gICAgICAgICAgICAgIC8vICAgICAgKGlkLCAgICAgICAgdHlwZSwgICAgICBvZmZzZXRzLCAgIGdlbmVyYWxUeXBlKVxuICAgICAgICAgICAgICBuZXcgU3BhbihlbnRpdHlbMF0sIGVudGl0eVsxXSwgZW50aXR5WzJdLCAnZW50aXR5Jyk7XG4gICAgICAgICAgZGF0YS5zcGFuc1tlbnRpdHlbMF1dID0gc3BhbjtcbiAgICAgICAgfSk7XG4gICAgICAgIHZhciB0cmlnZ2VySGFzaCA9IHt9O1xuICAgICAgICAkLmVhY2goc291cmNlRGF0YS50cmlnZ2VycywgZnVuY3Rpb24odHJpZ2dlck5vLCB0cmlnZ2VyKSB7XG4gICAgICAgICAgdHJpZ2dlckhhc2hbdHJpZ2dlclswXV0gPVxuICAgICAgICAgICAgICAvLyAgICAgICAoaWQsICAgICAgICAgdHlwZSwgICAgICAgb2Zmc2V0cywgICAgZ2VuZXJhbFR5cGUpLCBldmVudExpc3RcbiAgICAgICAgICAgICAgW25ldyBTcGFuKHRyaWdnZXJbMF0sIHRyaWdnZXJbMV0sIHRyaWdnZXJbMl0sICd0cmlnZ2VyJyksIFtdXTtcbiAgICAgICAgfSk7XG4gICAgICAgICQuZWFjaChzb3VyY2VEYXRhLmV2ZW50cywgZnVuY3Rpb24oZXZlbnRObywgZXZlbnRSb3cpIHtcbiAgICAgICAgICB2YXIgZXZlbnREZXNjID0gZGF0YS5ldmVudERlc2NzW2V2ZW50Um93WzBdXSA9XG4gICAgICAgICAgICAgIC8vICAgICAgICAgICAoaWQsICAgICAgICAgIHRyaWdnZXJJZCwgICByb2xlcywgICAgICAgIGtsYXNzKVxuICAgICAgICAgICAgICBuZXcgRXZlbnREZXNjKGV2ZW50Um93WzBdLCBldmVudFJvd1sxXSwgZXZlbnRSb3dbMl0pO1xuICAgICAgICAgIHZhciB0cmlnZ2VyID0gdHJpZ2dlckhhc2hbZXZlbnREZXNjLnRyaWdnZXJJZF07XG4gICAgICAgICAgdmFyIHNwYW4gPSB0cmlnZ2VyWzBdLmNvcHkoZXZlbnREZXNjLmlkKTtcbiAgICAgICAgICB0cmlnZ2VyWzFdLnB1c2goc3Bhbik7XG4gICAgICAgICAgZGF0YS5zcGFuc1tldmVudERlc2MuaWRdID0gc3BhbjtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgLy8gWFhYIG1vZGlmaWNhdGlvbnM6IGRlbGV0ZSBsYXRlclxuICAgICAgICAkLmVhY2goc291cmNlRGF0YS5tb2RpZmljYXRpb25zLCBmdW5jdGlvbihtb2RObywgbW9kKSB7XG4gICAgICAgICAgLy8gbW9kOiBbaWQsIHNwYW5JZCwgbW9kaWZpY2F0aW9uXVxuICAgICAgICAgIGlmICghZGF0YS5zcGFuc1ttb2RbMl1dKSB7XG4gICAgICAgICAgICBkaXNwYXRjaGVyLnBvc3QoJ21lc3NhZ2VzJywgW1tbJzxzdHJvbmc+RVJST1I8L3N0cm9uZz48YnIvPkV2ZW50ICcgKyBtb2RbMl0gKyAnIChyZWZlcmVuY2VkIGZyb20gbW9kaWZpY2F0aW9uICcgKyBtb2RbMF0gKyAnKSBkb2VzIG5vdCBvY2N1ciBpbiBkb2N1bWVudCAnICsgZGF0YS5kb2N1bWVudCArICc8YnIvPihwbGVhc2UgY29ycmVjdCB0aGUgc291cmNlIGRhdGEpJywgJ2Vycm9yJywgNV1dXSk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgfVxuICAgICAgICAgIGRhdGEuc3BhbnNbbW9kWzJdXVttb2RbMV1dID0gdHJ1ZTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgdmFyIG1pZHBvaW50Q29tcGFyYXRvciA9IGZ1bmN0aW9uKGEsIGIpIHtcbiAgICAgICAgICB2YXIgdG1wID0gYS5mcm9tICsgYS50byAtIGIuZnJvbSAtIGIudG87XG4gICAgICAgICAgaWYgKCF0bXApIHJldHVybiAwO1xuICAgICAgICAgIHJldHVybiB0bXAgPCAwID8gLTEgOiAxO1xuICAgICAgICB9O1xuICAgICAgICAvLyBzcGxpdCBzcGFucyBpbnRvIHNwYW4gZnJhZ21lbnRzIChmb3IgZGlzY29udGludW91cyBzcGFucylcbiAgICAgICAgJC5lYWNoKGRhdGEuc3BhbnMsIGZ1bmN0aW9uKHNwYW5Obywgc3Bhbikge1xuICAgICAgICAgICQuZWFjaChzcGFuLm9mZnNldHMsIGZ1bmN0aW9uKG9mZnNldHNObywgb2Zmc2V0cykge1xuICAgICAgICAgICAgdmFyIGZyb20gPSBwYXJzZUludChvZmZzZXRzWzBdLCAxMCk7XG4gICAgICAgICAgICB2YXIgdG8gPSBwYXJzZUludChvZmZzZXRzWzFdLCAxMCk7XG4gICAgICAgICAgICB2YXIgZnJhZ21lbnQgPSBuZXcgRnJhZ21lbnQob2Zmc2V0c05vLCBzcGFuLCBmcm9tLCB0byk7XG4gICAgICAgICAgICBzcGFuLmZyYWdtZW50cy5wdXNoKGZyYWdtZW50KTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgICAvLyBlbnN1cmUgYXNjZW5kaW5nIG9yZGVyXG4gICAgICAgICAgc3Bhbi5mcmFnbWVudHMuc29ydChtaWRwb2ludENvbXBhcmF0b3IpO1xuICAgICAgICAgIHNwYW4ud2hvbGVGcm9tID0gc3Bhbi5mcmFnbWVudHNbMF0uZnJvbTtcbiAgICAgICAgICBzcGFuLndob2xlVG8gPSBzcGFuLmZyYWdtZW50c1tzcGFuLmZyYWdtZW50cy5sZW5ndGggLSAxXS50bztcbiAgICAgICAgICBzcGFuLmhlYWRGcmFnbWVudCA9IHNwYW4uZnJhZ21lbnRzWyh0cnVlKSA/IHNwYW4uZnJhZ21lbnRzLmxlbmd0aCAtIDEgOiAwXTsgLy8gVE9ETyBjb25maWd1cmFibGUhXG4gICAgICAgIH0pO1xuXG4gICAgICAgIHZhciBzcGFuQ29tcGFyYXRvciA9IGZ1bmN0aW9uKGEsIGIpIHtcbiAgICAgICAgICB2YXIgYVNwYW4gPSBkYXRhLnNwYW5zW2FdO1xuICAgICAgICAgIHZhciBiU3BhbiA9IGRhdGEuc3BhbnNbYl07XG4gICAgICAgICAgdmFyIHRtcCA9IGFTcGFuLmhlYWRGcmFnbWVudC5mcm9tICsgYVNwYW4uaGVhZEZyYWdtZW50LnRvIC0gYlNwYW4uaGVhZEZyYWdtZW50LmZyb20gLSBiU3Bhbi5oZWFkRnJhZ21lbnQudG87XG4gICAgICAgICAgaWYgKHRtcCkge1xuICAgICAgICAgICAgcmV0dXJuIHRtcCA8IDAgPyAtMSA6IDE7XG4gICAgICAgICAgfVxuICAgICAgICAgIHJldHVybiAwO1xuICAgICAgICB9O1xuICAgICAgICAkLmVhY2goc291cmNlRGF0YS5lcXVpdnMsIGZ1bmN0aW9uKGVxdWl2Tm8sIGVxdWl2KSB7XG4gICAgICAgICAgLy8gZXF1aXY6IFsnKicsICdFcXVpdicsIHNwYW5JZC4uLl1cbiAgICAgICAgICBlcXVpdlswXSA9IFwiKlwiICsgZXF1aXZObztcbiAgICAgICAgICB2YXIgZXF1aXZTcGFucyA9IGVxdWl2LnNsaWNlKDIpO1xuICAgICAgICAgIHZhciBva0VxdWl2U3BhbnMgPSBbXTtcbiAgICAgICAgICAvLyBjb2xsZWN0IHRoZSBlcXVpdiBzcGFucyBpbiBhbiBhcnJheVxuICAgICAgICAgICQuZWFjaChlcXVpdlNwYW5zLCBmdW5jdGlvbihlcXVpdlNwYW5ObywgZXF1aXZTcGFuKSB7XG4gICAgICAgICAgICBpZiAoZGF0YS5zcGFuc1tlcXVpdlNwYW5dKSBva0VxdWl2U3BhbnMucHVzaChlcXVpdlNwYW4pO1xuICAgICAgICAgICAgLy8gVE9ETzogIzQwNCwgaW5mb3JtIHRoZSB1c2VyIHdpdGggYSBtZXNzYWdlP1xuICAgICAgICAgIH0pO1xuICAgICAgICAgIC8vIHNvcnQgc3BhbnMgaW4gdGhlIGVxdWl2IGJ5IHRoZWlyIG1pZHBvaW50XG4gICAgICAgICAgb2tFcXVpdlNwYW5zLnNvcnQoc3BhbkNvbXBhcmF0b3IpO1xuICAgICAgICAgIC8vIGdlbmVyYXRlIHRoZSBhcmNzXG4gICAgICAgICAgdmFyIGxlbiA9IG9rRXF1aXZTcGFucy5sZW5ndGg7XG4gICAgICAgICAgZm9yICh2YXIgaSA9IDE7IGkgPCBsZW47IGkrKykge1xuICAgICAgICAgICAgdmFyIGV2ZW50RGVzYyA9IGRhdGEuZXZlbnREZXNjc1tlcXVpdlswXSArICcqJyArIGldID1cbiAgICAgICAgICAgICAgICAvLyAgICAgICAgICAgKGlkLCAgICAgICAgICAgICAgICAgIHRyaWdnZXJJZCwgICAgICAgICAgIHJvbGVzLCAgICAgICAgICAgICAgICAgICAgICAgICBrbGFzcylcbiAgICAgICAgICAgICAgICBuZXcgRXZlbnREZXNjKG9rRXF1aXZTcGFuc1tpIC0gMV0sIG9rRXF1aXZTcGFuc1tpIC0gMV0sIFtbZXF1aXZbMV0sIG9rRXF1aXZTcGFuc1tpXV1dLCAnZXF1aXYnKTtcbiAgICAgICAgICAgIGV2ZW50RGVzYy5sZWZ0U3BhbnMgPSBva0VxdWl2U3BhbnMuc2xpY2UoMCwgaSk7XG4gICAgICAgICAgICBldmVudERlc2MucmlnaHRTcGFucyA9IG9rRXF1aXZTcGFucy5zbGljZShpKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICAkLmVhY2goc291cmNlRGF0YS5yZWxhdGlvbnMsIGZ1bmN0aW9uKHJlbE5vLCByZWwpIHtcbiAgICAgICAgICAvLyByZWxbMl0gaXMgYXJncywgcmVsWzJdW2FdWzBdIGlzIHJvbGUgYW5kIHJlbFsyXVthXVsxXSBpcyB2YWx1ZSBmb3IgYSBpbiAoMCwxKVxuICAgICAgICAgIHZhciBhcmdzRGVzYyA9IHJlbGF0aW9uVHlwZXNIYXNoW3JlbFsxXV07XG4gICAgICAgICAgYXJnc0Rlc2MgPSBhcmdzRGVzYyAmJiBhcmdzRGVzYy5hcmdzO1xuICAgICAgICAgIHZhciB0MSwgdDI7XG4gICAgICAgICAgaWYgKGFyZ3NEZXNjKSB7XG4gICAgICAgICAgICAvLyBzb3J0IHRoZSBhcmd1bWVudHMgYWNjb3JkaW5nIHRvIHRoZSBjb25maWdcbiAgICAgICAgICAgIHZhciBhcmdzID0ge31cbiAgICAgICAgICAgIGFyZ3NbcmVsWzJdWzBdWzBdXSA9IHJlbFsyXVswXVsxXTtcbiAgICAgICAgICAgIGFyZ3NbcmVsWzJdWzFdWzBdXSA9IHJlbFsyXVsxXVsxXTtcbiAgICAgICAgICAgIHQxID0gYXJnc1thcmdzRGVzY1swXS5yb2xlXTtcbiAgICAgICAgICAgIHQyID0gYXJnc1thcmdzRGVzY1sxXS5yb2xlXTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgLy8gKG9yIGxlYXZlIGFzLWlzIGluIGl0cyBhYnNlbmNlKVxuICAgICAgICAgICAgdDEgPSByZWxbMl1bMF1bMV07XG4gICAgICAgICAgICB0MiA9IHJlbFsyXVsxXVsxXTtcbiAgICAgICAgICB9XG4gICAgICAgICAgZGF0YS5ldmVudERlc2NzW3JlbFswXV0gPVxuICAgICAgICAgICAgICAvLyAgICAgICAgICAgKGlkLCB0cmlnZ2VySWQsIHJvbGVzLCAgICAgICAgICBrbGFzcylcbiAgICAgICAgICAgICAgbmV3IEV2ZW50RGVzYyh0MSwgdDEsICAgICAgICBbW3JlbFsxXSwgdDJdXSwgJ3JlbGF0aW9uJyk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8vIGF0dHJpYnV0ZXNcbiAgICAgICAgJC5lYWNoKHNvdXJjZURhdGEuYXR0cmlidXRlcywgZnVuY3Rpb24oYXR0ck5vLCBhdHRyKSB7XG4gICAgICAgICAgLy8gYXR0cjogW2lkLCBuYW1lLCBzcGFuSWQsIHZhbHVlLCBjdWVTcGFuSWRcblxuICAgICAgICAgIC8vIFRPRE86IG1pZ2h0IHdpc2ggdG8gY2hlY2sgd2hhdCdzIGFwcHJvcHJpYXRlIGZvciB0aGUgdHlwZVxuICAgICAgICAgIC8vIGluc3RlYWQgb2YgdXNpbmcgdGhlIGZpcnN0IGF0dHJpYnV0ZSBkZWYgZm91bmRcbiAgICAgICAgICB2YXIgYXR0clR5cGUgPSAoZXZlbnRBdHRyaWJ1dGVUeXBlc1thdHRyWzFdXSB8fFxuICAgICAgICAgICAgICAgICAgICAgICAgICBlbnRpdHlBdHRyaWJ1dGVUeXBlc1thdHRyWzFdXSk7XG4gICAgICAgICAgdmFyIGF0dHJWYWx1ZSA9IGF0dHJUeXBlICYmIGF0dHJUeXBlLnZhbHVlc1thdHRyVHlwZS5ib29sIHx8IGF0dHJbM11dO1xuICAgICAgICAgIHZhciBzcGFuID0gZGF0YS5zcGFuc1thdHRyWzJdXTtcbiAgICAgICAgICBpZiAoIXNwYW4pIHtcbiAgICAgICAgICAgIGRpc3BhdGNoZXIucG9zdCgnbWVzc2FnZXMnLCBbW1snQW5ub3RhdGlvbiAnICsgYXR0clsyXSArICcsIHJlZmVyZW5jZWQgZnJvbSBhdHRyaWJ1dGUgJyArIGF0dHJbMF0gKyAnLCBkb2VzIG5vdCBleGlzdC4nLCAnZXJyb3InXV1dKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICB9XG4gICAgICAgICAgdmFyIHZhbFRleHQgPSAoYXR0clZhbHVlICYmIGF0dHJWYWx1ZS5uYW1lKSB8fCBhdHRyWzNdO1xuICAgICAgICAgIHZhciBhdHRyVGV4dCA9IGF0dHJUeXBlXG4gICAgICAgICAgICA/IChhdHRyVHlwZS5ib29sID8gYXR0clR5cGUubmFtZSA6IChhdHRyVHlwZS5uYW1lICsgJzogJyArIHZhbFRleHQpKVxuICAgICAgICAgICAgOiAoYXR0clszXSA9PSB0cnVlID8gYXR0clsxXSA6IGF0dHJbMV0gKyAnOiAnICsgYXR0clszXSk7XG4gICAgICAgICAgc3Bhbi5hdHRyaWJ1dGVUZXh0LnB1c2goYXR0clRleHQpO1xuICAgICAgICAgIHNwYW4uYXR0cmlidXRlc1thdHRyWzFdXSA9IGF0dHJbM107XG4gICAgICAgICAgaWYgKGF0dHJbNF0pIHsgLy8gY3VlXG4gICAgICAgICAgICBzcGFuLmF0dHJpYnV0ZUN1ZXNbYXR0clsxXV0gPSBhdHRyWzRdO1xuICAgICAgICAgICAgdmFyIGN1ZVNwYW4gPSBkYXRhLnNwYW5zW2F0dHJbNF1dO1xuICAgICAgICAgICAgY3VlU3Bhbi5hdHRyaWJ1dGVDdWVGb3JbZGF0YS5zcGFuc1sxXV0gPSBhdHRyWzJdO1xuICAgICAgICAgICAgY3VlU3Bhbi5jdWUgPSAnQ1VFJzsgLy8gc3BlY2lhbCBjc3MgdHlwZVxuICAgICAgICAgIH1cbiAgICAgICAgICAkLmV4dGVuZChzcGFuLmF0dHJpYnV0ZU1lcmdlLCBhdHRyVmFsdWUpO1xuICAgICAgICB9KTtcblxuICAgICAgICAvLyBjb21tZW50c1xuICAgICAgICAkLmVhY2goc291cmNlRGF0YS5jb21tZW50cywgZnVuY3Rpb24oY29tbWVudE5vLCBjb21tZW50KSB7XG4gICAgICAgICAgLy8gY29tbWVudDogW2VudGl0eUlkLCB0eXBlLCB0ZXh0XVxuXG4gICAgICAgICAgLy8gVE9ETyBlcnJvciBoYW5kbGluZ1xuXG4gICAgICAgICAgLy8gc2VudGVuY2UgaWQ6IFsnc2VudCcsIHNlbnRJZF1cbiAgICAgICAgICBpZiAoY29tbWVudFswXSBpbnN0YW5jZW9mIEFycmF5ICYmIGNvbW1lbnRbMF1bMF0gPT0gJ3NlbnQnKSB7XG4gICAgICAgICAgICAvLyBzZW50ZW5jZSBjb21tZW50XG4gICAgICAgICAgICB2YXIgc2VudCA9IGNvbW1lbnRbMF1bMV07XG4gICAgICAgICAgICB2YXIgdGV4dCA9IGNvbW1lbnRbMl07XG4gICAgICAgICAgICBpZiAoZGF0YS5zZW50Q29tbWVudFtzZW50XSkge1xuICAgICAgICAgICAgICB0ZXh0ID0gZGF0YS5zZW50Q29tbWVudFtzZW50XS50ZXh0ICsgJzxici8+JyArIHRleHQ7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBkYXRhLnNlbnRDb21tZW50W3NlbnRdID0geyB0eXBlOiBjb21tZW50WzFdLCB0ZXh0OiB0ZXh0IH07XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHZhciBpZCA9IGNvbW1lbnRbMF07XG4gICAgICAgICAgICB2YXIgdHJpZ2dlciA9IHRyaWdnZXJIYXNoW2lkXTtcbiAgICAgICAgICAgIHZhciBldmVudERlc2MgPSBkYXRhLmV2ZW50RGVzY3NbaWRdO1xuICAgICAgICAgICAgdmFyIGNvbW1lbnRFbnRpdGllcyA9XG4gICAgICAgICAgICAgICAgdHJpZ2dlclxuICAgICAgICAgICAgICAgID8gdHJpZ2dlclsxXSAvLyB0cmlnZ2VyOiBbc3BhbiwgLi4uXVxuICAgICAgICAgICAgICAgIDogaWQgaW4gZGF0YS5zcGFuc1xuICAgICAgICAgICAgICAgICAgPyBbZGF0YS5zcGFuc1tpZF1dIC8vIHNwYW46IFtzcGFuXVxuICAgICAgICAgICAgICAgICAgOiBpZCBpbiBkYXRhLmV2ZW50RGVzY3NcbiAgICAgICAgICAgICAgICAgICAgPyBbZGF0YS5ldmVudERlc2NzW2lkXV0gLy8gYXJjOiBbZXZlbnREZXNjXVxuICAgICAgICAgICAgICAgICAgICA6IFtdO1xuICAgICAgICAgICAgJC5lYWNoKGNvbW1lbnRFbnRpdGllcywgZnVuY3Rpb24oZW50aXR5SWQsIGVudGl0eSkge1xuICAgICAgICAgICAgICAvLyBpZiBkdXBsaWNhdGUgY29tbWVudCBmb3IgZW50aXR5OlxuICAgICAgICAgICAgICAvLyBvdmVyd3JpdGUgdHlwZSwgY29uY2F0ZW5hdGUgY29tbWVudCB3aXRoIGEgbmV3bGluZVxuICAgICAgICAgICAgICBpZiAoIWVudGl0eS5jb21tZW50KSB7XG4gICAgICAgICAgICAgICAgZW50aXR5LmNvbW1lbnQgPSB7IHR5cGU6IGNvbW1lbnRbMV0sIHRleHQ6IGNvbW1lbnRbMl0gfTtcbiAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBlbnRpdHkuY29tbWVudC50eXBlID0gY29tbWVudFsxXTtcbiAgICAgICAgICAgICAgICBlbnRpdHkuY29tbWVudC50ZXh0ICs9IFwiXFxuXCIgKyBjb21tZW50WzJdO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIC8vIHBhcnRpYWxseSBkdXBsaWNhdGUgbWFya2luZyBvZiBhbm5vdGF0b3Igbm90ZSBjb21tZW50c1xuICAgICAgICAgICAgICBpZiAoY29tbWVudFsxXSA9PSBcIkFubm90YXRvck5vdGVzXCIpIHtcbiAgICAgICAgICAgICAgICBlbnRpdHkuYW5ub3RhdG9yTm90ZXMgPSBjb21tZW50WzJdO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIC8vIHByaW9yaXRpemUgdHlwZSBzZXR0aW5nIHdoZW4gbXVsdGlwbGUgY29tbWVudHMgYXJlIHByZXNlbnRcbiAgICAgICAgICAgICAgaWYgKGNvbW1lbnRQcmlvcml0eShjb21tZW50WzFdKSA+IGNvbW1lbnRQcmlvcml0eShlbnRpdHkuc2hhZG93Q2xhc3MpKSB7XG4gICAgICAgICAgICAgICAgZW50aXR5LnNoYWRvd0NsYXNzID0gY29tbWVudFsxXTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgICAgICAvLyBub3JtYWxpemF0aW9uc1xuICAgICAgICAkLmVhY2goc291cmNlRGF0YS5ub3JtYWxpemF0aW9ucywgZnVuY3Rpb24obm9ybU5vLCBub3JtKSB7XG4gICAgICAgICAgdmFyIGlkID0gbm9ybVswXTtcbiAgICAgICAgICB2YXIgbm9ybVR5cGUgPSBub3JtWzFdO1xuICAgICAgICAgIHZhciB0YXJnZXQgPSBub3JtWzJdO1xuICAgICAgICAgIHZhciByZWZkYiA9IG5vcm1bM107XG4gICAgICAgICAgdmFyIHJlZmlkID0gbm9ybVs0XTtcbiAgICAgICAgICB2YXIgcmVmdGV4dCA9IG5vcm1bNV07XG5cbiAgICAgICAgICAvLyBncmFiIGVudGl0eSAvIGV2ZW50IHRoZSBub3JtYWxpemF0aW9uIGFwcGxpZXMgdG9cbiAgICAgICAgICB2YXIgc3BhbiA9IGRhdGEuc3BhbnNbdGFyZ2V0XTtcbiAgICAgICAgICBpZiAoIXNwYW4pIHtcbiAgICAgICAgICAgIGRpc3BhdGNoZXIucG9zdCgnbWVzc2FnZXMnLCBbW1snQW5ub3RhdGlvbiAnICsgdGFyZ2V0ICsgJywgcmVmZXJlbmNlZCBmcm9tIG5vcm1hbGl6YXRpb24gJyArIGlkICsgJywgZG9lcyBub3QgZXhpc3QuJywgJ2Vycm9yJ11dXSk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgLy8gVE9ETzogZG8gd2UgaGF2ZSBhbnkgcG9zc2libGUgdXNlIGZvciB0aGUgbm9ybVR5cGU/XG4gICAgICAgICAgc3Bhbi5ub3JtYWxpemF0aW9ucy5wdXNoKFtyZWZkYiwgcmVmaWQsIHJlZnRleHRdKTtcblxuICAgICAgICAgIC8vIHF1aWNrIGhhY2sgZm9yIHNwYW4gYm94IHZpc3VhbCBzdHlsZVxuICAgICAgICAgIHNwYW4ubm9ybWFsaXplZCA9ICdOb3JtYWxpemVkJztcbiAgICAgICAgfSk7XG5cbiAgICAgICAgLy8gcHJlcGFyZSBzcGFuIGJvdW5kYXJpZXMgZm9yIHRva2VuIGNvbnRhaW5tZW50IHRlc3RpbmdcbiAgICAgICAgdmFyIHNvcnRlZEZyYWdtZW50cyA9IFtdO1xuICAgICAgICAkLmVhY2goZGF0YS5zcGFucywgZnVuY3Rpb24oc3Bhbk5vLCBzcGFuKSB7XG4gICAgICAgICAgJC5lYWNoKHNwYW4uZnJhZ21lbnRzLCBmdW5jdGlvbihmcmFnbWVudE5vLCBmcmFnbWVudCkge1xuICAgICAgICAgICAgc29ydGVkRnJhZ21lbnRzLnB1c2goZnJhZ21lbnQpO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICAgICAgLy8gc29ydCBmcmFnbWVudHMgYnkgYmVnaW5uaW5nLCB0aGVuIGJ5IGVuZFxuICAgICAgICBzb3J0ZWRGcmFnbWVudHMuc29ydChmdW5jdGlvbihhLCBiKSB7XG4gICAgICAgICAgdmFyIHggPSBhLmZyb207XG4gICAgICAgICAgdmFyIHkgPSBiLmZyb207XG4gICAgICAgICAgaWYgKHggPT0geSkge1xuICAgICAgICAgICAgeCA9IGEudG87XG4gICAgICAgICAgICB5ID0gYi50bztcbiAgICAgICAgICB9XG4gICAgICAgICAgcmV0dXJuICgoeCA8IHkpID8gLTEgOiAoKHggPiB5KSA/IDEgOiAwKSk7XG4gICAgICAgIH0pO1xuICAgICAgICB2YXIgY3VycmVudEZyYWdtZW50SWQgPSAwO1xuICAgICAgICB2YXIgc3RhcnRGcmFnbWVudElkID0gMDtcbiAgICAgICAgdmFyIG51bUZyYWdtZW50cyA9IHNvcnRlZEZyYWdtZW50cy5sZW5ndGg7XG4gICAgICAgIHZhciBsYXN0VG8gPSAwO1xuICAgICAgICB2YXIgZmlyc3RGcm9tID0gbnVsbDtcbiAgICAgICAgdmFyIGNodW5rTm8gPSAwO1xuICAgICAgICB2YXIgc3BhY2U7XG4gICAgICAgIHZhciBjaHVuayA9IG51bGw7XG4gICAgICAgIC8vIHRva2VuIGNvbnRhaW5tZW50IHRlc3RpbmcgKGNodW5rIHJlY29nbml0aW9uKVxuICAgICAgICAkLmVhY2goc291cmNlRGF0YS50b2tlbl9vZmZzZXRzLCBmdW5jdGlvbigpIHtcbiAgICAgICAgICB2YXIgZnJvbSA9IHRoaXNbMF07XG4gICAgICAgICAgdmFyIHRvID0gdGhpc1sxXTtcbiAgICAgICAgICBpZiAoZmlyc3RGcm9tID09PSBudWxsKSBmaXJzdEZyb20gPSBmcm9tO1xuXG4gICAgICAgICAgLy8gUmVwbGFjZWQgZm9yIHNwZWVkdXA7IFRPRE8gY2hlY2sgY29ycmVjdG5lc3NcbiAgICAgICAgICAvLyBpblNwYW4gPSBmYWxzZTtcbiAgICAgICAgICAvLyAkLmVhY2goZGF0YS5zcGFucywgZnVuY3Rpb24oc3Bhbk5vLCBzcGFuKSB7XG4gICAgICAgICAgLy8gICBpZiAoc3Bhbi5mcm9tIDwgdG8gJiYgdG8gPCBzcGFuLnRvKSB7XG4gICAgICAgICAgLy8gICAgIC8vIGl0IGRvZXM7IG5vIHdvcmQgYnJlYWtcbiAgICAgICAgICAvLyAgICAgaW5TcGFuID0gdHJ1ZTtcbiAgICAgICAgICAvLyAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgIC8vICAgfVxuICAgICAgICAgIC8vIH0pO1xuXG4gICAgICAgICAgLy8gSXMgdGhlIHRva2VuIGVuZCBpbnNpZGUgYSBzcGFuP1xuICAgICAgICAgIGlmIChzdGFydEZyYWdtZW50SWQgJiYgdG8gPiBzb3J0ZWRGcmFnbWVudHNbc3RhcnRGcmFnbWVudElkIC0gMV0udG8pIHtcbiAgICAgICAgICAgIHdoaWxlIChzdGFydEZyYWdtZW50SWQgPCBudW1GcmFnbWVudHMgJiYgdG8gPiBzb3J0ZWRGcmFnbWVudHNbc3RhcnRGcmFnbWVudElkXS5mcm9tKSB7XG4gICAgICAgICAgICAgIHN0YXJ0RnJhZ21lbnRJZCsrO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgICBjdXJyZW50RnJhZ21lbnRJZCA9IHN0YXJ0RnJhZ21lbnRJZDtcbiAgICAgICAgICB3aGlsZSAoY3VycmVudEZyYWdtZW50SWQgPCBudW1GcmFnbWVudHMgJiYgdG8gPj0gc29ydGVkRnJhZ21lbnRzW2N1cnJlbnRGcmFnbWVudElkXS50bykge1xuICAgICAgICAgICAgY3VycmVudEZyYWdtZW50SWQrKztcbiAgICAgICAgICB9XG4gICAgICAgICAgLy8gaWYgeWVzLCB0aGUgbmV4dCB0b2tlbiBpcyBpbiB0aGUgc2FtZSBjaHVua1xuICAgICAgICAgIGlmIChjdXJyZW50RnJhZ21lbnRJZCA8IG51bUZyYWdtZW50cyAmJiB0byA+IHNvcnRlZEZyYWdtZW50c1tjdXJyZW50RnJhZ21lbnRJZF0uZnJvbSkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIC8vUmVuYXVkIHRlc3QgY2h1bmsgbXVzdCBub3QgYmUgbG9uZ2VyIHRoYW4gblxuICAgICAgICAgIC8qdmFyIG4gPSA4MDtcbiAgICAgICAgICB2YXIgbG9vcCA9IDM7XG4gICAgICAgICAgaWYodG8gLSBmaXJzdEZyb20gPiBuKXsgLy8xMDNcbiAgICAgICAgICAgIC8vY3JlYXRlIDMgY2h1bmtzXG4gICAgICAgICAgICBmb3IodmFyIGkgPSAwOyBpIDwgbG9vcDsgKytpKXtcbiAgICAgICAgICAgICAgdmFyIGxlbmd0aCA9IE1hdGguZmxvb3IoKHRvIC0gZmlyc3RGcm9tKS9sb29wKTtcbiAgICAgICAgICAgICAgdmFyIHRvMiA9IGZpcnN0RnJvbSArIChsZW5ndGggKiAoaSArIDEpKTtcbiAgICAgICAgICAgICAgdmFyIGZpcnN0RnJvbTIgPSAoZmlyc3RGcm9tICsgKGxlbmd0aCAqIGkpKSArIDE7XG5cbiAgICAgICAgICAgICAgLy8gb3RoZXJ3aXNlLCBjcmVhdGUgdGhlIGNodW5rIGZvdW5kIHNvIGZhclxuICAgICAgICAgICAgICBzcGFjZSA9IGRhdGEudGV4dC5zdWJzdHJpbmcodG8yLCBmaXJzdEZyb20yKTtcbiAgICAgICAgICAgICAgdmFyIHRleHQgPSBkYXRhLnRleHQuc3Vic3RyaW5nKGZpcnN0RnJvbTIsIHRvMik7XG4gICAgICAgICAgICAgIGlmIChjaHVuaykgY2h1bmsubmV4dFNwYWNlID0gc3BhY2U7XG4gICAgICAgICAgICAgIGNodW5rID0gbmV3IENodW5rKGNodW5rTm8rKywgdGV4dCwgZmlyc3RGcm9tMiwgdG8yLCBzcGFjZSk7XG4gICAgICAgICAgICAgIGRhdGEuY2h1bmtzLnB1c2goY2h1bmspO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgfWVsc2V7Ki9cbiAgICAgICAgICAgIC8vIG90aGVyd2lzZSwgY3JlYXRlIHRoZSBjaHVuayBmb3VuZCBzbyBmYXJcbiAgICAgICAgICAgIHNwYWNlID0gZGF0YS50ZXh0LnN1YnN0cmluZyhsYXN0VG8sIGZpcnN0RnJvbSk7XG4gICAgICAgICAgICB2YXIgdGV4dCA9IGRhdGEudGV4dC5zdWJzdHJpbmcoZmlyc3RGcm9tLCB0byk7XG4gICAgICAgICAgICBpZiAoY2h1bmspIGNodW5rLm5leHRTcGFjZSA9IHNwYWNlO1xuICAgICAgICAgICAgLy8gICAgICAgICAgICAgICAoaW5kZXgsICAgICB0ZXh0LCBmcm9tLCAgICAgIHRvLCBzcGFjZSkge1xuICAgICAgICAgICAgY2h1bmsgPSBuZXcgQ2h1bmsoY2h1bmtObysrLCB0ZXh0LCBmaXJzdEZyb20sIHRvLCBzcGFjZSk7XG4gICAgICAgICAgICBkYXRhLmNodW5rcy5wdXNoKGNodW5rKTtcbiAgICAgICAgICAvKn0qL1xuICAgICAgICAgIGxhc3RUbyA9IHRvO1xuICAgICAgICAgIGZpcnN0RnJvbSA9IG51bGw7XG4gICAgICAgIH0pO1xuICAgICAgICB2YXIgbnVtQ2h1bmtzID0gY2h1bmtObztcblxuICAgICAgICAvLyBmaW5kIHNlbnRlbmNlIGJvdW5kYXJpZXMgaW4gcmVsYXRpb24gdG8gY2h1bmtzXG4gICAgICAgIGNodW5rTm8gPSAwO1xuICAgICAgICB2YXIgc2VudGVuY2VObyA9IDA7XG4gICAgICAgIHZhciBwYXN0Rmlyc3QgPSBmYWxzZTtcbiAgICAgICAgJC5lYWNoKHNvdXJjZURhdGEuc2VudGVuY2Vfb2Zmc2V0cywgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgdmFyIGZyb20gPSB0aGlzWzBdO1xuICAgICAgICAgIGlmIChjaHVua05vID49IG51bUNodW5rcykgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgIGlmIChkYXRhLmNodW5rc1tjaHVua05vXS5mcm9tID4gZnJvbSkgcmV0dXJuO1xuICAgICAgICAgIHZhciBjaHVuaztcbiAgICAgICAgICB3aGlsZSAoY2h1bmtObyA8IG51bUNodW5rcyAmJiAoY2h1bmsgPSBkYXRhLmNodW5rc1tjaHVua05vXSkuZnJvbSA8IGZyb20pIHtcbiAgICAgICAgICAgIGNodW5rTm8rKztcbiAgICAgICAgICB9XG4gICAgICAgICAgY2h1bmtObysrO1xuICAgICAgICAgIGlmIChwYXN0Rmlyc3QgJiYgZnJvbSA8PSBjaHVuay5mcm9tKSB7XG4gICAgICAgICAgICB2YXIgbnVtTkwgPSBjaHVuay5zcGFjZS5zcGxpdChcIlxcblwiKS5sZW5ndGggLSAxO1xuICAgICAgICAgICAgaWYgKCFudW1OTCkgbnVtTkwgPSAxO1xuICAgICAgICAgICAgc2VudGVuY2VObyArPSBudW1OTDtcbiAgICAgICAgICAgIGNodW5rLnNlbnRlbmNlID0gc2VudGVuY2VObztcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcGFzdEZpcnN0ID0gdHJ1ZTtcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8vIGFzc2lnbiBmcmFnbWVudHMgdG8gYXBwcm9wcmlhdGUgY2h1bmtzXG4gICAgICAgIHZhciBjdXJyZW50Q2h1bmtJZCA9IDA7XG4gICAgICAgIHZhciBjaHVuaztcbiAgICAgICAgJC5lYWNoKHNvcnRlZEZyYWdtZW50cywgZnVuY3Rpb24oZnJhZ21lbnRJZCwgZnJhZ21lbnQpIHtcbiAgICAgICAgICB3aGlsZSAoZnJhZ21lbnQudG8gPiAoY2h1bmsgPSBkYXRhLmNodW5rc1tjdXJyZW50Q2h1bmtJZF0pLnRvKSBjdXJyZW50Q2h1bmtJZCsrO1xuICAgICAgICAgIGNodW5rLmZyYWdtZW50cy5wdXNoKGZyYWdtZW50KTtcbiAgICAgICAgICBmcmFnbWVudC50ZXh0ID0gY2h1bmsudGV4dC5zdWJzdHJpbmcoZnJhZ21lbnQuZnJvbSAtIGNodW5rLmZyb20sIGZyYWdtZW50LnRvIC0gY2h1bmsuZnJvbSk7XG4gICAgICAgICAgZnJhZ21lbnQuY2h1bmsgPSBjaHVuaztcbiAgICAgICAgfSk7XG5cbiAgICAgICAgLy8gYXNzaWduIGFyY3MgdG8gc3BhbnM7IGNhbGN1bGF0ZSBhcmMgZGlzdGFuY2VzXG4gICAgICAgICQuZWFjaChkYXRhLmV2ZW50RGVzY3MsIGZ1bmN0aW9uKGV2ZW50Tm8sIGV2ZW50RGVzYykge1xuICAgICAgICAgIHZhciBkaXN0ID0gMDtcbiAgICAgICAgICB2YXIgb3JpZ2luID0gZGF0YS5zcGFuc1tldmVudERlc2MuaWRdO1xuICAgICAgICAgIGlmICghb3JpZ2luKSB7XG4gICAgICAgICAgICAvLyBUT0RPOiBpbmNsdWRlIG1pc3NpbmcgdHJpZ2dlciBJRCBpbiBlcnJvciBtZXNzYWdlXG4gICAgICAgICAgICBkaXNwYXRjaGVyLnBvc3QoJ21lc3NhZ2VzJywgW1tbJzxzdHJvbmc+RVJST1I8L3N0cm9uZz48YnIvPlRyaWdnZXIgZm9yIGV2ZW50IFwiJyArIGV2ZW50RGVzYy5pZCArICdcIiBub3QgZm91bmQgaW4gJyArIGRhdGEuZG9jdW1lbnQgKyAnPGJyLz4ocGxlYXNlIGNvcnJlY3QgdGhlIHNvdXJjZSBkYXRhKScsICdlcnJvcicsIDVdXV0pO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgIH1cbiAgICAgICAgICB2YXIgaGVyZSA9IG9yaWdpbi5oZWFkRnJhZ21lbnQuZnJvbSArIG9yaWdpbi5oZWFkRnJhZ21lbnQudG87XG4gICAgICAgICAgJC5lYWNoKGV2ZW50RGVzYy5yb2xlcywgZnVuY3Rpb24ocm9sZU5vLCByb2xlKSB7XG4gICAgICAgICAgICB2YXIgdGFyZ2V0ID0gZGF0YS5zcGFuc1tyb2xlLnRhcmdldElkXTtcbiAgICAgICAgICAgIGlmICghdGFyZ2V0KSB7XG4gICAgICAgICAgICAgIGRpc3BhdGNoZXIucG9zdCgnbWVzc2FnZXMnLCBbW1snPHN0cm9uZz5FUlJPUjwvc3Ryb25nPjxici8+XCInICsgcm9sZS50YXJnZXRJZCArICdcIiAocmVmZXJlbmNlZCBmcm9tIFwiJyArIGV2ZW50RGVzYy5pZCArICdcIikgbm90IGZvdW5kIGluICcgKyBkYXRhLmRvY3VtZW50ICsgJzxici8+KHBsZWFzZSBjb3JyZWN0IHRoZSBzb3VyY2UgZGF0YSknLCAnZXJyb3InLCA1XV1dKTtcbiAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdmFyIHRoZXJlID0gdGFyZ2V0LmhlYWRGcmFnbWVudC5mcm9tICsgdGFyZ2V0LmhlYWRGcmFnbWVudC50bztcbiAgICAgICAgICAgIHZhciBkaXN0ID0gTWF0aC5hYnMoaGVyZSAtIHRoZXJlKTtcbiAgICAgICAgICAgIHZhciBhcmMgPSBuZXcgQXJjKGV2ZW50RGVzYywgcm9sZSwgZGlzdCwgZXZlbnRObyk7XG4gICAgICAgICAgICBvcmlnaW4udG90YWxEaXN0ICs9IGRpc3Q7XG4gICAgICAgICAgICBvcmlnaW4ubnVtQXJjcysrO1xuICAgICAgICAgICAgdGFyZ2V0LnRvdGFsRGlzdCArPSBkaXN0O1xuICAgICAgICAgICAgdGFyZ2V0Lm51bUFyY3MrKztcbiAgICAgICAgICAgIGRhdGEuYXJjcy5wdXNoKGFyYyk7XG4gICAgICAgICAgICB0YXJnZXQuaW5jb21pbmcucHVzaChhcmMpO1xuICAgICAgICAgICAgb3JpZ2luLm91dGdvaW5nLnB1c2goYXJjKTtcbiAgICAgICAgICAgIC8vIElEIGRpY3QgZm9yIGVhc3kgYWNjZXNzLiBUT0RPOiBoYXZlIGEgZnVuY3Rpb24gZGVmaW5pbmcgdGhlXG4gICAgICAgICAgICAvLyAob3JpZ2luLHR5cGUsdGFyZ2V0KS0+aWQgbWFwcGluZyAoc2VlIGFsc28gYW5ub3RhdG9yX3VpLmpzKVxuICAgICAgICAgICAgdmFyIGFyY0lkID0gb3JpZ2luLmlkICsgJy0tJyArIHJvbGUudHlwZSArICctLScgKyB0YXJnZXQuaWQ7XG4gICAgICAgICAgICBkYXRhLmFyY0J5SWRbYXJjSWRdID0gYXJjO1xuICAgICAgICAgIH0pOyAvLyByb2xlc1xuICAgICAgICB9KTsgLy8gZXZlbnREZXNjc1xuXG4gICAgICAgIC8vIGhpZ2hsaWdodGluZ1xuICAgICAgICBtYXJrZWRUZXh0ID0gW107XG4gICAgICAgIHNldE1hcmtlZCgnZWRpdGVkJyk7IC8vIHNldCBieSBlZGl0aW5nIHByb2Nlc3NcbiAgICAgICAgc2V0TWFya2VkKCdmb2N1cycpOyAvLyBzZXQgYnkgVVJMXG4gICAgICAgIHNldE1hcmtlZCgnbWF0Y2hmb2N1cycpOyAvLyBzZXQgYnkgc2VhcmNoIHByb2Nlc3MsIGZvY3VzZWQgbWF0Y2hcbiAgICAgICAgc2V0TWFya2VkKCdtYXRjaCcpOyAvLyBzZXQgYnkgc2VhcmNoIHByb2Nlc3MsIG90aGVyIChub24tZm9jdXNlZCkgbWF0Y2hcblxuICAgICAgICAkLmVhY2goZGF0YS5zcGFucywgZnVuY3Rpb24oc3BhbklkLCBzcGFuKSB7XG4gICAgICAgICAgLy8gY2FsY3VsYXRlIGF2ZXJhZ2UgYXJjIGRpc3RhbmNlc1xuICAgICAgICAgIC8vIGF2ZXJhZ2UgZGlzdGFuY2Ugb2YgYXJjcyAoMCBmb3Igbm8gYXJjcylcbiAgICAgICAgICBzcGFuLmF2Z0Rpc3QgPSBzcGFuLm51bUFyY3MgPyBzcGFuLnRvdGFsRGlzdCAvIHNwYW4ubnVtQXJjcyA6IDA7XG4gICAgICAgICAgbGFzdFNwYW4gPSBzcGFuO1xuXG4gICAgICAgICAgLy8gY29sbGVjdCBmcmFnbWVudCB0ZXh0cyBpbnRvIHNwYW4gdGV4dHNcbiAgICAgICAgICB2YXIgZnJhZ21lbnRUZXh0cyA9IFtdO1xuICAgICAgICAgICQuZWFjaChzcGFuLmZyYWdtZW50cywgZnVuY3Rpb24oZnJhZ21lbnRObywgZnJhZ21lbnQpIHtcbiAgICAgICAgICAgIC8vIFRPRE8gaGV1cmlzdGljc1xuICAgICAgICAgICAgZnJhZ21lbnRUZXh0cy5wdXNoKGZyYWdtZW50LnRleHQpO1xuICAgICAgICAgIH0pO1xuICAgICAgICAgIHNwYW4udGV4dCA9IGZyYWdtZW50VGV4dHMuam9pbignJyk7XG4gICAgICAgIH0pOyAvLyBkYXRhLnNwYW5zXG5cbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCAyOyBpKyspIHtcbiAgICAgICAgICAvLyBwcmVsaW1pbmFyeSBzb3J0IHRvIGFzc2lnbiBoZWlnaHRzIGZvciBiYXNpYyBjYXNlc1xuICAgICAgICAgIC8vIChmaXJzdCByb3VuZCkgYW5kIGNhc2VzIHJlc29sdmVkIGluIHRoZSBwcmV2aW91c1xuICAgICAgICAgIC8vIHJvdW5kKHMpLlxuICAgICAgICAgICQuZWFjaChkYXRhLmNodW5rcywgZnVuY3Rpb24oY2h1bmtObywgY2h1bmspIHtcbiAgICAgICAgICAgIC8vIHNvcnRcbiAgICAgICAgICAgIGNodW5rLmZyYWdtZW50cy5zb3J0KGZyYWdtZW50Q29tcGFyYXRvcik7XG4gICAgICAgICAgICAvLyByZW51bWJlclxuICAgICAgICAgICAgJC5lYWNoKGNodW5rLmZyYWdtZW50cywgZnVuY3Rpb24oZnJhZ21lbnRObywgZnJhZ21lbnQpIHtcbiAgICAgICAgICAgICAgZnJhZ21lbnQuaW5kZXhOdW1iZXIgPSBmcmFnbWVudE5vO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfSk7XG4gICAgICAgICAgLy8gbml4IHRoZSBzdW1zLCBzbyB3ZSBjYW4gc3VtIGFnYWluXG4gICAgICAgICAgJC5lYWNoKGRhdGEuc3BhbnMsIGZ1bmN0aW9uKHNwYW5Obywgc3Bhbikge1xuICAgICAgICAgICAgc3Bhbi5yZWZlZEluZGV4U3VtID0gMDtcbiAgICAgICAgICB9KTtcbiAgICAgICAgICAvLyByZXNvbHZlZCBjYXNlcyB3aWxsIG5vdyBoYXZlIGluZGV4TnVtYmVyIHNldFxuICAgICAgICAgIC8vIHRvIGluZGljYXRlIHRoZWlyIHJlbGF0aXZlIG9yZGVyLiBTdW0gdGhvc2UgZm9yIHJlZmVyZW5jaW5nIGNhc2VzXG4gICAgICAgICAgLy8gZm9yIHVzZSBpbiBpdGVyYXRpdmUgcmVzb3J0aW5nXG4gICAgICAgICAgJC5lYWNoKGRhdGEuYXJjcywgZnVuY3Rpb24oYXJjTm8sIGFyYykge1xuICAgICAgICAgICAgZGF0YS5zcGFuc1thcmMub3JpZ2luXS5yZWZlZEluZGV4U3VtICs9IGRhdGEuc3BhbnNbYXJjLnRhcmdldF0uaGVhZEZyYWdtZW50LmluZGV4TnVtYmVyO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gRmluYWwgc29ydCBvZiBmcmFnbWVudHMgaW4gY2h1bmtzIGZvciBkcmF3aW5nIHB1cnBvc2VzXG4gICAgICAgIC8vIEFsc28gaWRlbnRpZnkgdGhlIG1hcmtlZCB0ZXh0IGJvdW5kYXJpZXMgcmVnYXJkaW5nIGNodW5rc1xuICAgICAgICAkLmVhY2goZGF0YS5jaHVua3MsIGZ1bmN0aW9uKGNodW5rTm8sIGNodW5rKSB7XG4gICAgICAgICAgLy8gYW5kIG1ha2UgdGhlIG5leHQgc29ydCB0YWtlIHRoaXMgaW50byBhY2NvdW50LiBOb3RlIHRoYXQgdGhpcyB3aWxsXG4gICAgICAgICAgLy8gbm93IHJlc29sdmUgZmlyc3Qtb3JkZXIgZGVwZW5kZW5jaWVzIGJldHdlZW4gc29ydCBvcmRlcnMgYnV0IG5vdFxuICAgICAgICAgIC8vIHNlY29uZC1vcmRlciBvciBoaWdoZXIuXG4gICAgICAgICAgY2h1bmsuZnJhZ21lbnRzLnNvcnQoZnJhZ21lbnRDb21wYXJhdG9yKTtcbiAgICAgICAgICAkLmVhY2goY2h1bmsuZnJhZ21lbnRzLCBmdW5jdGlvbihmcmFnbWVudE5vLCBmcmFnbWVudCkge1xuICAgICAgICAgICAgZnJhZ21lbnQuZHJhd09yZGVyID0gZnJhZ21lbnRObztcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgZGF0YS5zcGFuRHJhd09yZGVyUGVybXV0YXRpb24gPSBPYmplY3Qua2V5cyhkYXRhLnNwYW5zKTtcbiAgICAgICAgZGF0YS5zcGFuRHJhd09yZGVyUGVybXV0YXRpb24uc29ydChmdW5jdGlvbihhLCBiKSB7XG4gICAgICAgICAgdmFyIHNwYW5BID0gZGF0YS5zcGFuc1thXTtcbiAgICAgICAgICB2YXIgc3BhbkIgPSBkYXRhLnNwYW5zW2JdO1xuXG4gICAgICAgICAgLy8gV2UncmUganVtcGluZyBhbGwgb3ZlciB0aGUgY2h1bmtzLCBidXQgaXQncyBlbm91Z2ggdGhhdFxuICAgICAgICAgIC8vIHdlJ3JlIGRvaW5nIGV2ZXJ5dGhpbmcgaW5zaWRlIGVhY2ggY2h1bmsgaW4gdGhlIHJpZ2h0XG4gICAgICAgICAgLy8gb3JkZXIuIHNob3VsZCBpdCBiZWNvbWUgbmVjZXNzYXJ5IHRvIGFjdHVhbGx5IGRvIHRoZXNlIGluXG4gICAgICAgICAgLy8gbGluZWFyIG9yZGVyLCBwdXQgaW4gYSBzaW1pbGFyIGNvbmRpdGlvbiBmb3JcbiAgICAgICAgICAvLyBzcGFuWC5oZWFkRnJhZ21lbnQuY2h1bmsuaW5kZXg7IGJ1dCBpdCBzaG91bGQgbm90IGJlXG4gICAgICAgICAgLy8gbmVlZGVkLlxuXG4gICAgICAgICAgdmFyIHRtcCA9IHNwYW5BLmhlYWRGcmFnbWVudC5kcmF3T3JkZXIgLSBzcGFuQi5oZWFkRnJhZ21lbnQuZHJhd09yZGVyO1xuICAgICAgICAgIGlmICh0bXApIHJldHVybiB0bXAgPCAwID8gLTEgOiAxO1xuXG4gICAgICAgICAgcmV0dXJuIDA7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8vIHJlc29ydCB0aGUgc3BhbnMgZm9yIGxpbmVhciBvcmRlciBieSBjZW50ZXJcbiAgICAgICAgc29ydGVkRnJhZ21lbnRzLnNvcnQobWlkcG9pbnRDb21wYXJhdG9yKTtcblxuICAgICAgICAvLyBzb3J0IGZyYWdtZW50cyBpbnRvIHRvd2VycywgY2FsY3VsYXRlIGF2ZXJhZ2UgYXJjIGRpc3RhbmNlc1xuICAgICAgICB2YXIgbGFzdEZyYWdtZW50ID0gbnVsbDtcbiAgICAgICAgdmFyIHRvd2VySWQgPSAtMTtcbiAgICAgICAgJC5lYWNoKHNvcnRlZEZyYWdtZW50cywgZnVuY3Rpb24oaSwgZnJhZ21lbnQpIHtcbiAgICAgICAgICBpZiAoIWxhc3RGcmFnbWVudCB8fCAobGFzdEZyYWdtZW50LmZyb20gIT0gZnJhZ21lbnQuZnJvbSB8fCBsYXN0RnJhZ21lbnQudG8gIT0gZnJhZ21lbnQudG8pKSB7XG4gICAgICAgICAgICB0b3dlcklkKys7XG4gICAgICAgICAgfVxuICAgICAgICAgIGZyYWdtZW50LnRvd2VySWQgPSB0b3dlcklkO1xuICAgICAgICAgIGxhc3RGcmFnbWVudCA9IGZyYWdtZW50O1xuICAgICAgICB9KTsgLy8gc29ydGVkRnJhZ21lbnRzXG5cbiAgICAgICAgLy8gZmluZCBjdXJsaWVzIChvbmx5IHRoZSBmaXJzdCBmcmFnbWVudCBkcmF3biBpbiBhIHRvd2VyKVxuICAgICAgICAkLmVhY2goZGF0YS5zcGFuRHJhd09yZGVyUGVybXV0YXRpb24sIGZ1bmN0aW9uKHNwYW5JZE5vLCBzcGFuSWQpIHtcbiAgICAgICAgICB2YXIgc3BhbiA9IGRhdGEuc3BhbnNbc3BhbklkXTtcblxuICAgICAgICAgICQuZWFjaChzcGFuLmZyYWdtZW50cywgZnVuY3Rpb24oZnJhZ21lbnRObywgZnJhZ21lbnQpIHtcbiAgICAgICAgICAgIGlmICghZGF0YS50b3dlcnNbZnJhZ21lbnQudG93ZXJJZF0pIHtcbiAgICAgICAgICAgICAgZGF0YS50b3dlcnNbZnJhZ21lbnQudG93ZXJJZF0gPSBbXTtcbiAgICAgICAgICAgICAgZnJhZ21lbnQuZHJhd0N1cmx5ID0gdHJ1ZTtcbiAgICAgICAgICAgICAgZnJhZ21lbnQuc3Bhbi5kcmF3Q3VybHkgPSB0cnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZGF0YS50b3dlcnNbZnJhZ21lbnQudG93ZXJJZF0ucHVzaChmcmFnbWVudCk7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIHZhciBzcGFuQW5uVGV4dHMgPSB7fTtcbiAgICAgICAgJC5lYWNoKGRhdGEuY2h1bmtzLCBmdW5jdGlvbihjaHVua05vLCBjaHVuaykge1xuICAgICAgICAgIGNodW5rLm1hcmtlZFRleHRTdGFydCA9IFtdO1xuICAgICAgICAgIGNodW5rLm1hcmtlZFRleHRFbmQgPSBbXTtcblxuICAgICAgICAgICQuZWFjaChjaHVuay5mcmFnbWVudHMsIGZ1bmN0aW9uKGZyYWdtZW50Tm8sIGZyYWdtZW50KSB7XG4gICAgICAgICAgICBpZiAoY2h1bmsuZmlyc3RGcmFnbWVudEluZGV4ID09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICBjaHVuay5maXJzdEZyYWdtZW50SW5kZXggPSBmcmFnbWVudC50b3dlcklkO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY2h1bmsubGFzdEZyYWdtZW50SW5kZXggPSBmcmFnbWVudC50b3dlcklkO1xuXG4gICAgICAgICAgICB2YXIgc3BhbkxhYmVscyA9IFV0aWwuZ2V0U3BhbkxhYmVscyhzcGFuVHlwZXMsIGZyYWdtZW50LnNwYW4udHlwZSk7XG4gICAgICAgICAgICBmcmFnbWVudC5sYWJlbFRleHQgPSBVdGlsLnNwYW5EaXNwbGF5Rm9ybShzcGFuVHlwZXMsIGZyYWdtZW50LnNwYW4udHlwZSk7XG4gICAgICAgICAgICAvLyBGaW5kIHRoZSBtb3N0IGFwcHJvcHJpYXRlIGxhYmVsIGFjY29yZGluZyB0byB0ZXh0IHdpZHRoXG4gICAgICAgICAgICBpZiAoQ29uZmlndXJhdGlvbi5hYmJyZXZzT24gJiYgc3BhbkxhYmVscykge1xuICAgICAgICAgICAgICB2YXIgbGFiZWxJZHggPSAxOyAvLyBmaXJzdCBhYmJyZXZcbiAgICAgICAgICAgICAgdmFyIG1heExlbmd0aCA9IChmcmFnbWVudC50byAtIGZyYWdtZW50LmZyb20pIC8gMC44O1xuICAgICAgICAgICAgICB3aGlsZSAoZnJhZ21lbnQubGFiZWxUZXh0Lmxlbmd0aCA+IG1heExlbmd0aCAmJlxuICAgICAgICAgICAgICAgICAgc3BhbkxhYmVsc1tsYWJlbElkeF0pIHtcbiAgICAgICAgICAgICAgICBmcmFnbWVudC5sYWJlbFRleHQgPSBzcGFuTGFiZWxzW2xhYmVsSWR4XTtcbiAgICAgICAgICAgICAgICBsYWJlbElkeCsrO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHZhciBzdmd0ZXh0ID0gc3ZnLmNyZWF0ZVRleHQoKTsgLy8gb25lIFwidGV4dFwiIGVsZW1lbnQgcGVyIHJvd1xuICAgICAgICAgICAgdmFyIHBvc3RmaXhBcnJheSA9IFtdO1xuICAgICAgICAgICAgdmFyIHByZWZpeCA9ICcnO1xuICAgICAgICAgICAgdmFyIHBvc3RmaXggPSAnJztcbiAgICAgICAgICAgIHZhciB3YXJuaW5nID0gZmFsc2U7XG4gICAgICAgICAgICAkLmVhY2goZnJhZ21lbnQuc3Bhbi5hdHRyaWJ1dGVzLCBmdW5jdGlvbihhdHRyVHlwZSwgdmFsVHlwZSkge1xuICAgICAgICAgICAgICAvLyBUT0RPOiBtaWdodCB3aXNoIHRvIGNoZWNrIHdoYXQncyBhcHByb3ByaWF0ZSBmb3IgdGhlIHR5cGVcbiAgICAgICAgICAgICAgLy8gaW5zdGVhZCBvZiB1c2luZyB0aGUgZmlyc3QgYXR0cmlidXRlIGRlZiBmb3VuZFxuICAgICAgICAgICAgICB2YXIgYXR0ciA9IChldmVudEF0dHJpYnV0ZVR5cGVzW2F0dHJUeXBlXSB8fFxuICAgICAgICAgICAgICAgICAgICAgICAgICBlbnRpdHlBdHRyaWJ1dGVUeXBlc1thdHRyVHlwZV0pO1xuICAgICAgICAgICAgICBpZiAoIWF0dHIpIHtcbiAgICAgICAgICAgICAgICAvLyBub24tZXhpc3RlbnQgdHlwZVxuICAgICAgICAgICAgICAgIHdhcm5pbmcgPSB0cnVlO1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICB2YXIgdmFsID0gYXR0ci52YWx1ZXNbYXR0ci5ib29sIHx8IHZhbFR5cGVdO1xuICAgICAgICAgICAgICBpZiAoIXZhbCkge1xuICAgICAgICAgICAgICAgIC8vIG5vbi1leGlzdGVudCB2YWx1ZVxuICAgICAgICAgICAgICAgIHdhcm5pbmcgPSB0cnVlO1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICBpZiAoJC5pc0VtcHR5T2JqZWN0KHZhbCkpIHtcbiAgICAgICAgICAgICAgICAvLyBkZWZpbmVkLCBidXQgbGFja3MgYW55IHZpc3VhbCBwcmVzZW50YXRpb25cbiAgICAgICAgICAgICAgICB3YXJuaW5nID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgaWYgKHZhbC5nbHlwaCkge1xuICAgICAgICAgICAgICAgIGlmICh2YWwucG9zaXRpb24gPT0gXCJsZWZ0XCIpIHtcbiAgICAgICAgICAgICAgICAgIHByZWZpeCA9IHZhbC5nbHlwaCArIHByZWZpeDtcbiAgICAgICAgICAgICAgICAgIHZhciBjc3MgPSAnZ2x5cGgnO1xuICAgICAgICAgICAgICAgICAgaWYgKGF0dHIuY3NzKSBjc3MgKz0gJyBnbHlwaF8nICsgVXRpbC5lc2NhcGVRdW90ZXMoYXR0ci5jc3MpO1xuICAgICAgICAgICAgICAgICAgc3ZndGV4dC5zcGFuKHZhbC5nbHlwaCwgeyAnY2xhc3MnOiBjc3MgfSk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHsgLy8gWFhYIHJpZ2h0IGlzIGltcGxpZWQgLSBtYXliZSBjaGFuZ2VcbiAgICAgICAgICAgICAgICAgIHBvc3RmaXhBcnJheS5wdXNoKFthdHRyLCB2YWxdKTtcbiAgICAgICAgICAgICAgICAgIHBvc3RmaXggKz0gdmFsLmdseXBoO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB2YXIgdGV4dCA9IGZyYWdtZW50LmxhYmVsVGV4dDtcbiAgICAgICAgICAgIGlmIChwcmVmaXggIT09ICcnKSB7XG4gICAgICAgICAgICAgIHRleHQgPSBwcmVmaXggKyAnICcgKyB0ZXh0O1xuICAgICAgICAgICAgICBzdmd0ZXh0LnN0cmluZygnICcpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgc3ZndGV4dC5zdHJpbmcoZnJhZ21lbnQubGFiZWxUZXh0KTtcbiAgICAgICAgICAgIGlmIChwb3N0Zml4QXJyYXkubGVuZ3RoKSB7XG4gICAgICAgICAgICAgIHRleHQgKz0gJyAnICsgcG9zdGZpeDtcbiAgICAgICAgICAgICAgc3ZndGV4dC5zdHJpbmcoJyAnKTtcbiAgICAgICAgICAgICAgJC5lYWNoKHBvc3RmaXhBcnJheSwgZnVuY3Rpb24oZWxObywgZWwpIHtcbiAgICAgICAgICAgICAgICB2YXIgY3NzID0gJ2dseXBoJztcbiAgICAgICAgICAgICAgICBpZiAoZWxbMF0uY3NzKSBjc3MgKz0gJyBnbHlwaF8nICsgVXRpbC5lc2NhcGVRdW90ZXMoZWxbMF0uY3NzKTtcbiAgICAgICAgICAgICAgICBzdmd0ZXh0LnNwYW4oZWxbMV0uZ2x5cGgsIHsgJ2NsYXNzJzogY3NzIH0pO1xuICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICh3YXJuaW5nKSB7XG4gICAgICAgICAgICAgIHN2Z3RleHQuc3BhbihcIiNcIiwgeyAnY2xhc3MnOiAnZ2x5cGggYXR0cmlidXRlX3dhcm5pbmcnIH0pO1xuICAgICAgICAgICAgICB0ZXh0ICs9ICcgIyc7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBmcmFnbWVudC5nbHlwaGVkTGFiZWxUZXh0ID0gdGV4dDtcblxuICAgICAgICAgICAgaWYgKCFzcGFuQW5uVGV4dHNbdGV4dF0pIHtcbiAgICAgICAgICAgICAgc3BhbkFublRleHRzW3RleHRdID0gdHJ1ZTtcbiAgICAgICAgICAgICAgZGF0YS5zcGFuQW5uVGV4dHNbdGV4dF0gPSBzdmd0ZXh0O1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0pOyAvLyBjaHVuay5mcmFnbWVudHNcbiAgICAgICAgfSk7IC8vIGNodW5rc1xuXG4gICAgICAgIHZhciBudW1DaHVua3MgPSBkYXRhLmNodW5rcy5sZW5ndGg7XG4gICAgICAgIC8vIG5vdGUgdGhlIGxvY2F0aW9uIG9mIG1hcmtlZCB0ZXh0IHdpdGggcmVzcGVjdCB0byBjaHVua3NcbiAgICAgICAgdmFyIHN0YXJ0Q2h1bmsgPSAwO1xuICAgICAgICB2YXIgY3VycmVudENodW5rO1xuICAgICAgICAvLyBzb3J0IGJ5IFwiZnJvbVwiOyB3ZSBkb24ndCBuZWVkIHRvIHNvcnQgYnkgXCJ0b1wiIGFzIHdlbGwsXG4gICAgICAgIC8vIGJlY2F1c2UgdW5saWtlIHNwYW5zLCBjaHVua3MgYXJlIGRpc2p1bmN0XG4gICAgICAgIG1hcmtlZFRleHQuc29ydChmdW5jdGlvbihhLCBiKSB7XG4gICAgICAgICAgcmV0dXJuIFV0aWwuY21wKGFbMF0sIGJbMF0pO1xuICAgICAgICB9KTtcbiAgICAgICAgJC5lYWNoKG1hcmtlZFRleHQsIGZ1bmN0aW9uKHRleHRObywgdGV4dFBvcykge1xuICAgICAgICAgIHZhciBmcm9tID0gdGV4dFBvc1swXTtcbiAgICAgICAgICB2YXIgdG8gPSB0ZXh0UG9zWzFdO1xuICAgICAgICAgIHZhciBtYXJrZWRUeXBlID0gdGV4dFBvc1syXTtcbiAgICAgICAgICBpZiAoZnJvbSA8IDApIGZyb20gPSAwO1xuICAgICAgICAgIGlmICh0byA8IDApIHRvID0gMDtcbiAgICAgICAgICBpZiAodG8gPj0gZGF0YS50ZXh0Lmxlbmd0aCkgdG8gPSBkYXRhLnRleHQubGVuZ3RoIC0gMTtcbiAgICAgICAgICBpZiAoZnJvbSA+IHRvKSBmcm9tID0gdG87XG4gICAgICAgICAgd2hpbGUgKHN0YXJ0Q2h1bmsgPCBudW1DaHVua3MpIHtcbiAgICAgICAgICAgIHZhciBjaHVuayA9IGRhdGEuY2h1bmtzW3N0YXJ0Q2h1bmtdO1xuICAgICAgICAgICAgaWYgKGZyb20gPD0gY2h1bmsudG8pIHtcbiAgICAgICAgICAgICAgY2h1bmsubWFya2VkVGV4dFN0YXJ0LnB1c2goW3RleHRObywgdHJ1ZSwgZnJvbSAtIGNodW5rLmZyb20sIG51bGwsIG1hcmtlZFR5cGVdKTtcbiAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBzdGFydENodW5rKys7XG4gICAgICAgICAgfVxuICAgICAgICAgIGlmIChzdGFydENodW5rID09IG51bUNodW5rcykge1xuICAgICAgICAgICAgZGlzcGF0Y2hlci5wb3N0KCdtZXNzYWdlcycsIFtbWydXcm9uZyB0ZXh0IG9mZnNldCcsICdlcnJvciddXV0pO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgIH1cbiAgICAgICAgICBjdXJyZW50Q2h1bmsgPSBzdGFydENodW5rO1xuICAgICAgICAgIHdoaWxlIChjdXJyZW50Q2h1bmsgPCBudW1DaHVua3MpIHtcbiAgICAgICAgICAgIHZhciBjaHVuayA9IGRhdGEuY2h1bmtzW2N1cnJlbnRDaHVua107XG4gICAgICAgICAgICBpZiAodG8gPD0gY2h1bmsudG8pIHtcbiAgICAgICAgICAgICAgY2h1bmsubWFya2VkVGV4dEVuZC5wdXNoKFt0ZXh0Tm8sIGZhbHNlLCB0byAtIGNodW5rLmZyb21dKTtcbiAgICAgICAgICAgICAgYnJlYWtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGN1cnJlbnRDaHVuaysrO1xuICAgICAgICAgIH1cbiAgICAgICAgICBpZiAoY3VycmVudENodW5rID09IG51bUNodW5rcykge1xuICAgICAgICAgICAgZGlzcGF0Y2hlci5wb3N0KCdtZXNzYWdlcycsIFtbWydXcm9uZyB0ZXh0IG9mZnNldCcsICdlcnJvciddXV0pO1xuICAgICAgICAgICAgdmFyIGNodW5rID0gZGF0YS5jaHVua3NbZGF0YS5jaHVua3MubGVuZ3RoIC0gMV07XG4gICAgICAgICAgICBjaHVuay5tYXJrZWRUZXh0RW5kLnB1c2goW3RleHRObywgZmFsc2UsIGNodW5rLnRleHQubGVuZ3RoXSk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgfVxuICAgICAgICB9KTsgLy8gbWFya2VkVGV4dFxuXG4gICAgICAgIGRpc3BhdGNoZXIucG9zdCgnZGF0YVJlYWR5JywgW2RhdGFdKTtcbiAgICAgIH07XG5cbiAgICAgIHZhciByZXNldERhdGEgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgc2V0RGF0YShzb3VyY2VEYXRhKTtcbiAgICAgICAgcmVuZGVyRGF0YSgpO1xuICAgICAgfVxuXG4gICAgICB2YXIgdHJhbnNsYXRlID0gZnVuY3Rpb24oZWxlbWVudCwgeCwgeSkge1xuICAgICAgICAkKGVsZW1lbnQuZ3JvdXApLmF0dHIoJ3RyYW5zZm9ybScsICd0cmFuc2xhdGUoJyArIHggKyAnLCAnICsgeSArICcpJyk7XG4gICAgICAgIGVsZW1lbnQudHJhbnNsYXRpb24gPSB7IHg6IHgsIHk6IHkgfTtcbiAgICAgIH07XG5cbiAgICAgIHZhciBzaG93TXRpbWUgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgaWYgKGRhdGEubXRpbWUpIHtcbiAgICAgICAgICAgIC8vIHdlJ3JlIGdldHRpbmcgc2Vjb25kcyBhbmQgbmVlZCBtaWxsaXNlY29uZHNcbiAgICAgICAgICAgIC8vJCgnI2RvY3VtZW50X2N0aW1lJykudGV4dChcIkNyZWF0ZWQ6IFwiICsgQW5ub3RhdG9yLmZvcm1hdFRpbWUoMTAwMCAqIGRhdGEuY3RpbWUpKS5jc3MoXCJkaXNwbGF5XCIsIFwiaW5saW5lXCIpO1xuICAgICAgICAgICAgJCgnI2RvY3VtZW50X210aW1lJykudGV4dChcIkxhc3QgbW9kaWZpZWQ6IFwiICsgVXRpbC5mb3JtYXRUaW1lQWdvKDEwMDAgKiBkYXRhLm10aW1lKSkuY3NzKFwiZGlzcGxheVwiLCBcImlubGluZVwiKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIC8vJCgnI2RvY3VtZW50X2N0aW1lJykuY3NzKFwiZGlzcGxheVwiLCBcIm5vbmVcIik7XG4gICAgICAgICAgICAkKCcjZG9jdW1lbnRfbXRpbWUnKS5jc3MoXCJkaXNwbGF5XCIsIFwibm9uZVwiKTtcbiAgICAgICAgfVxuICAgICAgfTtcblxuICAgICAgdmFyIGFkZEhlYWRlckFuZERlZnMgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgdmFyIGNvbW1lbnROYW1lID0gKGNvbGwgKyAnLycgKyBkb2MpLnJlcGxhY2UoJy0tJywgJy1cXFxcLScpO1xuICAgICAgICAkc3ZnLmFwcGVuZCgnPCEtLSBkb2N1bWVudDogJyArIGNvbW1lbnROYW1lICsgJyAtLT4nKTtcbiAgICAgICAgdmFyIGRlZnMgPSBzdmcuZGVmcygpO1xuICAgICAgICB2YXIgJGJsdXJGaWx0ZXIgPSAkKCc8ZmlsdGVyIGlkPVwiR2F1c3NpYW5fQmx1clwiPjxmZUdhdXNzaWFuQmx1ciBpbj1cIlNvdXJjZUdyYXBoaWNcIiBzdGREZXZpYXRpb249XCIyXCIgLz48L2ZpbHRlcj4nKTtcbiAgICAgICAgc3ZnLmFkZChkZWZzLCAkYmx1ckZpbHRlcik7XG4gICAgICAgIHJldHVybiBkZWZzO1xuICAgICAgfVxuXG4gICAgICB2YXIgZ2V0VGV4dE1lYXN1cmVtZW50cyA9IGZ1bmN0aW9uKHRleHRzSGFzaCwgb3B0aW9ucywgY2FsbGJhY2spIHtcbiAgICAgICAgLy8gbWFrZSBzb21lIHRleHQgZWxlbWVudHMsIGZpbmQgb3V0IHRoZSBkaW1lbnNpb25zXG4gICAgICAgIHZhciB0ZXh0TWVhc3VyZUdyb3VwID0gc3ZnLmdyb3VwKG9wdGlvbnMpO1xuXG4gICAgICAgIC8vIGNoYW5nZWQgZnJvbSAkLmVhY2ggYmVjYXVzZSBvZiAjMjY0ICgnbGVuZ3RoJyBjYW4gYXBwZWFyKVxuICAgICAgICBmb3IgKHZhciB0ZXh0IGluIHRleHRzSGFzaCkge1xuICAgICAgICAgIGlmICh0ZXh0c0hhc2guaGFzT3duUHJvcGVydHkodGV4dCkpIHtcbiAgICAgICAgICAgIHN2Zy50ZXh0KHRleHRNZWFzdXJlR3JvdXAsIDAsIDAsIHRleHQpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIC8vIG1lYXN1cmluZyBnb2VzIG9uIGhlcmVcbiAgICAgICAgdmFyIHdpZHRocyA9IHt9O1xuICAgICAgICAkKHRleHRNZWFzdXJlR3JvdXApLmZpbmQoJ3RleHQnKS5lYWNoKGZ1bmN0aW9uKHN2Z1RleHRObywgc3ZnVGV4dCkge1xuICAgICAgICAgIHZhciB0ZXh0ID0gJChzdmdUZXh0KS50ZXh0KCk7XG4gICAgICAgICAgd2lkdGhzW3RleHRdID0gdGhpcy5nZXRDb21wdXRlZFRleHRMZW5ndGgoKTtcblxuICAgICAgICAgIGlmIChjYWxsYmFjaykge1xuICAgICAgICAgICAgJC5lYWNoKHRleHRzSGFzaFt0ZXh0XSwgZnVuY3Rpb24odGV4dCwgb2JqZWN0KSB7XG4gICAgICAgICAgICAgIGNhbGxiYWNrKG9iamVjdCwgc3ZnVGV4dCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICB2YXIgYmJveCA9IHRleHRNZWFzdXJlR3JvdXAuZ2V0QkJveCgpO1xuICAgICAgICBzdmcucmVtb3ZlKHRleHRNZWFzdXJlR3JvdXApO1xuXG4gICAgICAgIHJldHVybiBuZXcgTWVhc3VyZW1lbnRzKHdpZHRocywgYmJveC5oZWlnaHQsIGJib3gueSk7XG4gICAgICB9O1xuXG4gICAgICB2YXIgZ2V0VGV4dEFuZFNwYW5UZXh0TWVhc3VyZW1lbnRzID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIC8vIGdldCB0aGUgc3BhbiB0ZXh0IHNpemVzXG4gICAgICAgIHZhciBjaHVua1RleHRzID0ge307IC8vIHNldCBvZiBzcGFuIHRleHRzXG4gICAgICAgICQuZWFjaChkYXRhLmNodW5rcywgZnVuY3Rpb24oY2h1bmtObywgY2h1bmspIHtcbiAgICAgICAgICBjaHVuay5yb3cgPSB1bmRlZmluZWQ7IC8vIHJlc2V0XG4gICAgICAgICAgaWYgKCEoY2h1bmsudGV4dCBpbiBjaHVua1RleHRzKSkgY2h1bmtUZXh0c1tjaHVuay50ZXh0XSA9IFtdXG4gICAgICAgICAgdmFyIGNodW5rVGV4dCA9IGNodW5rVGV4dHNbY2h1bmsudGV4dF07XG5cbiAgICAgICAgICAvLyBoZXJlIHdlIGFsc28gbmVlZCBhbGwgdGhlIHNwYW5zIHRoYXQgYXJlIGNvbnRhaW5lZCBpblxuICAgICAgICAgIC8vIGNodW5rcyB3aXRoIHRoaXMgdGV4dCwgYmVjYXVzZSB3ZSBuZWVkIHRvIGtub3cgdGhlIHBvc2l0aW9uXG4gICAgICAgICAgLy8gb2YgdGhlIHNwYW4gdGV4dCB3aXRoaW4gdGhlIHJlc3BlY3RpdmUgY2h1bmsgdGV4dFxuICAgICAgICAgIGNodW5rVGV4dC5wdXNoLmFwcGx5KGNodW5rVGV4dCwgY2h1bmsuZnJhZ21lbnRzKTtcbiAgICAgICAgICAvLyBhbmQgYWxzbyB0aGUgbWFya2VkVGV4dCBib3VuZGFyaWVzXG4gICAgICAgICAgY2h1bmtUZXh0LnB1c2guYXBwbHkoY2h1bmtUZXh0LCBjaHVuay5tYXJrZWRUZXh0U3RhcnQpO1xuICAgICAgICAgIGNodW5rVGV4dC5wdXNoLmFwcGx5KGNodW5rVGV4dCwgY2h1bmsubWFya2VkVGV4dEVuZCk7XG4gICAgICAgIH0pO1xuICAgICAgICB2YXIgdGV4dFNpemVzID0gZ2V0VGV4dE1lYXN1cmVtZW50cyhcbiAgICAgICAgICBjaHVua1RleHRzLFxuICAgICAgICAgIHVuZGVmaW5lZCxcbiAgICAgICAgICBmdW5jdGlvbihmcmFnbWVudCwgdGV4dCkge1xuICAgICAgICAgICAgaWYgKGZyYWdtZW50IGluc3RhbmNlb2YgRnJhZ21lbnQpIHsgLy8gaXQncyBhIGZyYWdtZW50IVxuICAgICAgICAgICAgICAvLyBtZWFzdXJlIHRoZSBmcmFnbWVudCB0ZXh0IHBvc2l0aW9uIGluIHBpeGVsc1xuICAgICAgICAgICAgICB2YXIgZmlyc3RDaGFyID0gZnJhZ21lbnQuZnJvbSAtIGZyYWdtZW50LmNodW5rLmZyb207XG4gICAgICAgICAgICAgIGlmIChmaXJzdENoYXIgPCAwKSB7XG4gICAgICAgICAgICAgICAgZmlyc3RDaGFyID0gMDtcbiAgICAgICAgICAgICAgICBkaXNwYXRjaGVyLnBvc3QoJ21lc3NhZ2VzJywgW1tbJzxzdHJvbmc+V0FSTklORzwvc3Ryb25nPicgK1xuICAgICAgICAgICAgICAgICAgJzxici8+ICcgK1xuICAgICAgICAgICAgICAgICAgJ1RoZSBmcmFnbWVudCBbJyArIGZyYWdtZW50LmZyb20gKyAnLCAnICsgZnJhZ21lbnQudG8gKyAnXSAoJyArIGZyYWdtZW50LnRleHQgKyAnKSBpcyBub3QgJyArXG4gICAgICAgICAgICAgICAgICAnY29udGFpbmVkIGluIGl0cyBkZXNpZ25hdGVkIGNodW5rIFsnICtcbiAgICAgICAgICAgICAgICAgIGZyYWdtZW50LmNodW5rLmZyb20gKyAnLCAnICsgZnJhZ21lbnQuY2h1bmsudG8gKyAnXSBtb3N0IGxpa2VseSAnICtcbiAgICAgICAgICAgICAgICAgICdkdWUgdG8gdGhlIGZyYWdtZW50IHN0YXJ0aW5nIG9yIGVuZGluZyB3aXRoIGEgc3BhY2UsIHBsZWFzZSAnICtcbiAgICAgICAgICAgICAgICAgICd2ZXJpZnkgdGhlIHNhbml0eSBvZiB5b3VyIGRhdGEgc2luY2Ugd2UgYXJlIHVuYWJsZSB0byAnICtcbiAgICAgICAgICAgICAgICAgICd2aXN1YWxpc2UgdGhpcyBmcmFnbWVudCBjb3JyZWN0bHkgYW5kIHdpbGwgZHJvcCBsZWFkaW5nICcgK1xuICAgICAgICAgICAgICAgICAgJ3NwYWNlIGNoYXJhY3RlcnMnXG4gICAgICAgICAgICAgICAgICAsICd3YXJuaW5nJywgMTVdXV0pO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIHZhciBzdGFydFBvcyA9IHRleHQuZ2V0U3RhcnRQb3NpdGlvbk9mQ2hhcihmaXJzdENoYXIpLng7XG4gICAgICAgICAgICAgIHZhciBsYXN0Q2hhciA9IGZyYWdtZW50LnRvIC0gZnJhZ21lbnQuY2h1bmsuZnJvbSAtIDE7XG4gICAgICAgICAgICAgIHZhciBlbmRQb3MgPSAobGFzdENoYXIgPCAwKVxuICAgICAgICAgICAgICAgID8gc3RhcnRQb3NcbiAgICAgICAgICAgICAgICA6IHRleHQuZ2V0RW5kUG9zaXRpb25PZkNoYXIobGFzdENoYXIpLng7XG4gICAgICAgICAgICAgIGZyYWdtZW50LmN1cmx5ID0ge1xuICAgICAgICAgICAgICAgIGZyb206IHN0YXJ0UG9zLFxuICAgICAgICAgICAgICAgIHRvOiBlbmRQb3NcbiAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIH0gZWxzZSB7IC8vIGl0J3MgbWFya2VkVGV4dCBbaWQsIHN0YXJ0PywgY2hhciMsIG9mZnNldF1cbiAgICAgICAgICAgICAgaWYgKGZyYWdtZW50WzJdIDwgMCkgZnJhZ21lbnRbMl0gPSAwO1xuICAgICAgICAgICAgICBpZiAoIWZyYWdtZW50WzJdKSB7IC8vIHN0YXJ0XG4gICAgICAgICAgICAgICAgZnJhZ21lbnRbM10gPSB0ZXh0LmdldFN0YXJ0UG9zaXRpb25PZkNoYXIoZnJhZ21lbnRbMl0pLng7XG4gICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgZnJhZ21lbnRbM10gPSB0ZXh0LmdldEVuZFBvc2l0aW9uT2ZDaGFyKGZyYWdtZW50WzJdIC0gMSkueCArIDE7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9KTtcblxuICAgICAgICAvLyBnZXQgdGhlIGZyYWdtZW50IGFubm90YXRpb24gdGV4dCBzaXplc1xuICAgICAgICB2YXIgZnJhZ21lbnRUZXh0cyA9IHt9O1xuICAgICAgICB2YXIgbm9TcGFucyA9IHRydWU7XG4gICAgICAgICQuZWFjaChkYXRhLnNwYW5zLCBmdW5jdGlvbihzcGFuTm8sIHNwYW4pIHtcbiAgICAgICAgICAkLmVhY2goc3Bhbi5mcmFnbWVudHMsIGZ1bmN0aW9uKGZyYWdtZW50Tm8sIGZyYWdtZW50KSB7XG4gICAgICAgICAgICBmcmFnbWVudFRleHRzW2ZyYWdtZW50LmdseXBoZWRMYWJlbFRleHRdID0gdHJ1ZTtcbiAgICAgICAgICAgIG5vU3BhbnMgPSBmYWxzZTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgICAgIGlmIChub1NwYW5zKSBmcmFnbWVudFRleHRzLiQgPSB0cnVlOyAvLyBkdW1teSBzbyB3ZSBjYW4gYXQgbGVhc3QgZ2V0IHRoZSBoZWlnaHRcbiAgICAgICAgdmFyIGZyYWdtZW50U2l6ZXMgPSBnZXRUZXh0TWVhc3VyZW1lbnRzKGZyYWdtZW50VGV4dHMsIHsnY2xhc3MnOiAnc3Bhbid9KTtcblxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIHRleHRzOiB0ZXh0U2l6ZXMsXG4gICAgICAgICAgZnJhZ21lbnRzOiBmcmFnbWVudFNpemVzXG4gICAgICAgIH07XG4gICAgICB9O1xuXG4gICAgICB2YXIgYWRkQXJjVGV4dE1lYXN1cmVtZW50cyA9IGZ1bmN0aW9uKHNpemVzKSB7XG4gICAgICAgIC8vIGdldCB0aGUgYXJjIGFubm90YXRpb24gdGV4dCBzaXplcyAoZm9yIGFsbCBsYWJlbHMpXG4gICAgICAgIHZhciBhcmNUZXh0cyA9IHt9O1xuICAgICAgICAkLmVhY2goZGF0YS5hcmNzLCBmdW5jdGlvbihhcmNObywgYXJjKSB7XG4gICAgICAgICAgdmFyIGxhYmVscyA9IFV0aWwuZ2V0QXJjTGFiZWxzKHNwYW5UeXBlcywgZGF0YS5zcGFuc1thcmMub3JpZ2luXS50eXBlLCBhcmMudHlwZSwgcmVsYXRpb25UeXBlc0hhc2gpO1xuICAgICAgICAgIGlmICghbGFiZWxzLmxlbmd0aCkgbGFiZWxzID0gW2FyYy50eXBlXTtcbiAgICAgICAgICAkLmVhY2gobGFiZWxzLCBmdW5jdGlvbihsYWJlbE5vLCBsYWJlbCkge1xuICAgICAgICAgICAgYXJjVGV4dHNbbGFiZWxdID0gdHJ1ZTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgICAgIHZhciBhcmNTaXplcyA9IGdldFRleHRNZWFzdXJlbWVudHMoYXJjVGV4dHMsIHsnY2xhc3MnOiAnYXJjcyd9KTtcbiAgICAgICAgc2l6ZXMuYXJjcyA9IGFyY1NpemVzO1xuICAgICAgfTtcblxuICAgICAgdmFyIGFkanVzdFRvd2VyQW5ub3RhdGlvblNpemVzID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIC8vIGZpbmQgYmlnZ2VzdCBhbm5vdGF0aW9uIGluIGVhY2ggdG93ZXJcbiAgICAgICAgJC5lYWNoKGRhdGEudG93ZXJzLCBmdW5jdGlvbih0b3dlck5vLCB0b3dlcikge1xuICAgICAgICAgIHZhciBtYXhXaWR0aCA9IDA7XG4gICAgICAgICAgJC5lYWNoKHRvd2VyLCBmdW5jdGlvbihmcmFnbWVudE5vLCBmcmFnbWVudCkge1xuICAgICAgICAgICAgdmFyIHdpZHRoID0gZGF0YS5zaXplcy5mcmFnbWVudHMud2lkdGhzW2ZyYWdtZW50LmdseXBoZWRMYWJlbFRleHRdO1xuICAgICAgICAgICAgaWYgKHdpZHRoID4gbWF4V2lkdGgpIG1heFdpZHRoID0gd2lkdGg7XG4gICAgICAgICAgfSk7IC8vIHRvd2VyXG4gICAgICAgICAgJC5lYWNoKHRvd2VyLCBmdW5jdGlvbihmcmFnbWVudE5vLCBmcmFnbWVudCkge1xuICAgICAgICAgICAgZnJhZ21lbnQud2lkdGggPSBtYXhXaWR0aDtcbiAgICAgICAgICB9KTsgLy8gdG93ZXJcbiAgICAgICAgfSk7IC8vIGRhdGEudG93ZXJzXG4gICAgICB9O1xuXG4gICAgICB2YXIgbWFrZUFycm93ID0gZnVuY3Rpb24oZGVmcywgc3BlYykge1xuICAgICAgICB2YXIgcGFyc2VkU3BlYyA9IHNwZWMuc3BsaXQoJywnKTtcbiAgICAgICAgdmFyIHR5cGUgPSBwYXJzZWRTcGVjWzBdO1xuICAgICAgICBpZiAodHlwZSA9PSAnbm9uZScpIHJldHVybjtcblxuICAgICAgICB2YXIgd2lkdGggPSA1O1xuICAgICAgICB2YXIgaGVpZ2h0ID0gNTtcbiAgICAgICAgdmFyIGNvbG9yID0gXCJibGFja1wiO1xuICAgICAgICBpZiAoJC5pc051bWVyaWMocGFyc2VkU3BlY1sxXSkgJiYgcGFyc2VkU3BlY1syXSkge1xuICAgICAgICAgIGlmICgkLmlzTnVtZXJpYyhwYXJzZWRTcGVjWzJdKSAmJiBwYXJzZWRTcGVjWzNdKSB7XG4gICAgICAgICAgICAvLyAzIGFyZ3MsIDIgbnVtZXJpYzogYXNzdW1lIHdpZHRoLCBoZWlnaHQsIGNvbG9yXG4gICAgICAgICAgICB3aWR0aCA9IHBhcnNlZFNwZWNbMV07XG4gICAgICAgICAgICBoZWlnaHQgPSBwYXJzZWRTcGVjWzJdO1xuICAgICAgICAgICAgY29sb3IgPSBwYXJzZWRTcGVjWzNdIHx8ICdibGFjayc7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIC8vIDIgYXJncywgMSBudW1lcmljOiBhc3N1bWUgd2lkdGgvaGVpZ2h0LCBjb2xvclxuICAgICAgICAgICAgd2lkdGggPSBoZWlnaHQgPSBwYXJzZWRTcGVjWzFdO1xuICAgICAgICAgICAgY29sb3IgPSBwYXJzZWRTcGVjWzJdIHx8ICdibGFjayc7XG4gICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIC8vIG90aGVyOiBhc3N1bWUgY29sb3Igb25seVxuICAgICAgICAgIHdpZHRoID0gaGVpZ2h0ID0gNTtcbiAgICAgICAgICBjb2xvciA9IHBhcnNlZFNwZWNbMV0gfHwgJ2JsYWNrJztcbiAgICAgICAgfVxuICAgICAgICAvLyBoYXNoIG5lZWRzIHRvIGJlIHJlcGxhY2VkIGFzIElEcyBkb24ndCBwZXJtaXQgaXQuXG4gICAgICAgIHZhciBhcnJvd0lkID0gJ2Fycm93XycgKyBzcGVjLnJlcGxhY2UoLyMvZywgJycpLnJlcGxhY2UoLywvZywgJ18nKTtcblxuICAgICAgICB2YXIgYXJyb3c7XG4gICAgICAgIGlmICh0eXBlID09ICd0cmlhbmdsZScpIHtcbiAgICAgICAgICBhcnJvdyA9IHN2Zy5tYXJrZXIoZGVmcywgYXJyb3dJZCxcbiAgICAgICAgICAgIHdpZHRoLCBoZWlnaHQgLyAyLCB3aWR0aCwgaGVpZ2h0LCAnYXV0bycsXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgIG1hcmtlclVuaXRzOiAnc3Ryb2tlV2lkdGgnLFxuICAgICAgICAgICAgICAnZmlsbCc6IGNvbG9yLFxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgc3ZnLnBvbHlsaW5lKGFycm93LCBbWzAsIDBdLCBbd2lkdGgsIGhlaWdodCAvIDJdLCBbMCwgaGVpZ2h0XSwgW3dpZHRoIC8gMTIsIGhlaWdodCAvIDJdXSk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGFycm93SWQ7XG4gICAgICB9XG5cblxuICAgICAgdmFyIGRyYXdpbmcgPSBmYWxzZTtcbiAgICAgIHZhciByZWRyYXcgPSBmYWxzZTtcblxuICAgICAgdmFyIHJlbmRlckRhdGFSZWFsID0gZnVuY3Rpb24oc291cmNlRGF0YSkge1xuXG5cblV0aWwucHJvZmlsZUVuZCgnYmVmb3JlIHJlbmRlcicpO1xuVXRpbC5wcm9maWxlU3RhcnQoJ3JlbmRlcicpO1xuVXRpbC5wcm9maWxlU3RhcnQoJ2luaXQnKTtcblxuICAgICAgICBpZiAoIXNvdXJjZURhdGEgJiYgIWRhdGEpIHtcbiAgICAgICAgICBkaXNwYXRjaGVyLnBvc3QoJ2RvbmVSZW5kZXJpbmcnLCBbY29sbCwgZG9jLCBhcmdzXSk7XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgICRzdmdEaXYuc2hvdygpO1xuICAgICAgICBpZiAoKHNvdXJjZURhdGEgJiYgc291cmNlRGF0YS5jb2xsZWN0aW9uICYmIChzb3VyY2VEYXRhLmRvY3VtZW50ICE9PSBkb2MgfHwgc291cmNlRGF0YS5jb2xsZWN0aW9uICE9PSBjb2xsKSkgfHwgZHJhd2luZykge1xuICAgICAgICAgIHJlZHJhdyA9IHRydWU7XG4gICAgICAgICAgZGlzcGF0Y2hlci5wb3N0KCdkb25lUmVuZGVyaW5nJywgW2NvbGwsIGRvYywgYXJnc10pO1xuICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICByZWRyYXcgPSBmYWxzZTtcbiAgICAgICAgZHJhd2luZyA9IHRydWU7XG5cbiAgICAgICAgaWYgKHNvdXJjZURhdGEpIHNldERhdGEoc291cmNlRGF0YSk7XG4gICAgICAgIHNob3dNdGltZSgpO1xuXG4gICAgICAgIC8vIGNsZWFyIHRoZSBTVkdcbiAgICAgICAgc3ZnLmNsZWFyKHRydWUpO1xuICAgICAgICBpZiAoIWRhdGEgfHwgZGF0YS5sZW5ndGggPT0gMCkgcmV0dXJuO1xuXG4gICAgICAgIC8vIGVzdGFibGlzaCB0aGUgd2lkdGggYWNjb3JkaW5nIHRvIHRoZSBlbmNsb3NpbmcgZWxlbWVudFxuICAgICAgICBjYW52YXNXaWR0aCA9IHRoYXQuZm9yY2VXaWR0aCB8fCAkc3ZnRGl2LndpZHRoKCk7XG5cbiAgICAgICAgdmFyIGRlZnMgPSBhZGRIZWFkZXJBbmREZWZzKCk7XG5cbiAgICAgICAgdmFyIGJhY2tncm91bmRHcm91cCA9IHN2Zy5ncm91cCh7ICdjbGFzcyc6ICdiYWNrZ3JvdW5kJyB9KTtcbiAgICAgICAgdmFyIGdsb3dHcm91cCA9IHN2Zy5ncm91cCh7ICdjbGFzcyc6ICdnbG93JyB9KTtcbiAgICAgICAgaGlnaGxpZ2h0R3JvdXAgPSBzdmcuZ3JvdXAoeyAnY2xhc3MnOiAnaGlnaGxpZ2h0JyB9KTtcbiAgICAgICAgdmFyIHRleHRHcm91cCA9IHN2Zy5ncm91cCh7ICdjbGFzcyc6ICd0ZXh0JyB9KTtcblxuVXRpbC5wcm9maWxlRW5kKCdpbml0Jyk7XG5VdGlsLnByb2ZpbGVTdGFydCgnbWVhc3VyZXMnKTtcblxuICAgICAgICB2YXIgc2l6ZXMgPSBnZXRUZXh0QW5kU3BhblRleHRNZWFzdXJlbWVudHMoKTtcbiAgICAgICAgZGF0YS5zaXplcyA9IHNpemVzO1xuXG4gICAgICAgIGFkanVzdFRvd2VyQW5ub3RhdGlvblNpemVzKCk7XG4gICAgICAgIHZhciBtYXhUZXh0V2lkdGggPSAwO1xuICAgICAgICBmb3IgKHZhciB0ZXh0IGluIHNpemVzLnRleHRzLndpZHRocykge1xuICAgICAgICAgIGlmIChzaXplcy50ZXh0cy53aWR0aHMuaGFzT3duUHJvcGVydHkodGV4dCkpIHtcbiAgICAgICAgICAgIHZhciB3aWR0aCA9IHNpemVzLnRleHRzLndpZHRoc1t0ZXh0XVxuICAgICAgICAgICAgaWYgKHdpZHRoID4gbWF4VGV4dFdpZHRoKSBtYXhUZXh0V2lkdGggPSB3aWR0aDtcbiAgICAgICAgICB9XG4gICAgICAgIH1cblxuVXRpbC5wcm9maWxlRW5kKCdtZWFzdXJlcycpO1xuVXRpbC5wcm9maWxlU3RhcnQoJ2NodW5rcycpO1xuXG4gICAgICAgIHZhciBjdXJyZW50WCA9IENvbmZpZ3VyYXRpb24udmlzdWFsLm1hcmdpbi54ICsgc2VudE51bU1hcmdpbiArIHJvd1BhZGRpbmc7XG4gICAgICAgIHZhciByb3dzID0gW107XG4gICAgICAgIHZhciBmcmFnbWVudEhlaWdodHMgPSBbXTtcbiAgICAgICAgdmFyIHNlbnRlbmNlVG9nZ2xlID0gMDtcbiAgICAgICAgdmFyIHNlbnRlbmNlTnVtYmVyID0gMDtcbiAgICAgICAgdmFyIHJvdyA9IG5ldyBSb3coc3ZnKTtcbiAgICAgICAgcm93LnNlbnRlbmNlID0gKytzZW50ZW5jZU51bWJlcjtcbiAgICAgICAgcm93LmJhY2tncm91bmRJbmRleCA9IHNlbnRlbmNlVG9nZ2xlO1xuICAgICAgICByb3cuaW5kZXggPSAwO1xuICAgICAgICB2YXIgcm93SW5kZXggPSAwO1xuICAgICAgICB2YXIgdHdvQmFyV2lkdGhzOyAvLyBIQUNLIHRvIGF2b2lkIG1lYXN1cmluZyBzcGFjZSdzIHdpZHRoXG4gICAgICAgIHZhciBvcGVuVGV4dEhpZ2hsaWdodHMgPSB7fTtcbiAgICAgICAgdmFyIHRleHRNYXJrZWRSb3dzID0gW107XG5cbiAgICAgICAgYWRkQXJjVGV4dE1lYXN1cmVtZW50cyhzaXplcyk7XG5cbiAgICAgICAgLy8gcmVzZXJ2ZSBwbGFjZXMgZm9yIHNwYW5zXG4gICAgICAgIHZhciBmbG9vcnMgPSBbXTtcbiAgICAgICAgdmFyIHJlc2VydmF0aW9ucyA9IFtdOyAvLyByZXNlcnZhdGlvbnNbY2h1bmtdW2Zsb29yXSA9IFtbZnJvbSwgdG8sIGhlYWRyb29tXS4uLl1cbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPD0gZGF0YS5sYXN0RnJhZ21lbnRJbmRleDsgaSsrKSB7XG4gICAgICAgICAgcmVzZXJ2YXRpb25baV0gPSB7fTtcbiAgICAgICAgfVxuICAgICAgICB2YXIgaW5mID0gMS4wLzAuMDtcblxuICAgICAgICAkLmVhY2goZGF0YS5zcGFuRHJhd09yZGVyUGVybXV0YXRpb24sIGZ1bmN0aW9uKHNwYW5JZE5vLCBzcGFuSWQpIHtcbiAgICAgICAgICB2YXIgc3BhbiA9IGRhdGEuc3BhbnNbc3BhbklkXTtcblxuICAgICAgICAgIHZhciBmMSA9IHNwYW4uZnJhZ21lbnRzWzBdO1xuICAgICAgICAgIHZhciBmMiA9IHNwYW4uZnJhZ21lbnRzW3NwYW4uZnJhZ21lbnRzLmxlbmd0aCAtIDFdO1xuXG4gICAgICAgICAgdmFyIHgxID0gKGYxLmN1cmx5LmZyb20gKyBmMS5jdXJseS50byAtIGYxLndpZHRoKSAvIDIgLVxuICAgICAgICAgICAgICBDb25maWd1cmF0aW9uLnZpc3VhbC5tYXJnaW4ueDtcbiAgICAgICAgICB2YXIgaTEgPSBmMS5jaHVuay5pbmRleDtcblxuICAgICAgICAgIHZhciB4MiA9IChmMi5jdXJseS5mcm9tICsgZjIuY3VybHkudG8gKyBmMi53aWR0aCkgLyAyICtcbiAgICAgICAgICAgICAgQ29uZmlndXJhdGlvbi52aXN1YWwubWFyZ2luLng7XG4gICAgICAgICAgdmFyIGkyID0gZjIuY2h1bmsuaW5kZXg7XG5cbiAgICAgICAgICAvLyBTdGFydCBmcm9tIHRoZSBncm91bmQgbGV2ZWwsIGdvaW5nIHVwIGZsb29yIGJ5IGZsb29yLlxuICAgICAgICAgIC8vIElmIG5vIG1vcmUgZmxvb3JzLCBtYWtlIGEgbmV3IGF2YWlsYWJsZSBvbmUuXG4gICAgICAgICAgLy8gSWYgYSBmbG9vciBpcyBhdmFpbGFibGUgYW5kIHRoZXJlIGlzIG5vIGNhcnBldCwgbWFyayBpdCBhcyBjYXJwZXQuXG4gICAgICAgICAgLy8gSWYgYSBmbG9vciBpcyBhdmFpbGFibGUgYW5kIHRoZXJlIGlzIGNhcnBldCBhbmQgaGVpZ2h0XG4gICAgICAgICAgLy8gICBkaWZmZXJlbmNlIGlzIGF0IGxlYXN0IGZyYWdtZW50IGhlaWdodCArIGN1cmx5LCBPSy5cbiAgICAgICAgICAvLyBJZiBhIGZsb29yIGlzIG5vdCBhdmFpbGFibGUsIGZvcmdldCBhYm91dCBjYXJwZXQuXG4gICAgICAgICAgLy8gLS1cbiAgICAgICAgICAvLyBXaGVuIE9LLCBjYWxjdWxhdGUgZXhhY3QgY2VpbGluZy5cbiAgICAgICAgICAvLyBJZiB0aGVyZSBpc24ndCBvbmUsIG1ha2UgYSBuZXcgZmxvb3IsIGNvcHkgcmVzZXJ2YXRpb25zXG4gICAgICAgICAgLy8gICBmcm9tIGZsb29yIGJlbG93ICh3aXRoIGRlY3JlYXNlZCBjZWlsaW5nKVxuICAgICAgICAgIC8vIE1ha2UgdGhlIHJlc2VydmF0aW9uIGZyb20gdGhlIGNhcnBldCB0byBqdXN0IGJlbG93IHRoZVxuICAgICAgICAgIC8vICAgY3VycmVudCBmbG9vci5cbiAgICAgICAgICAvL1xuICAgICAgICAgIC8vIFRPRE8gZHJhd0N1cmx5IGFuZCBoZWlnaHQgY291bGQgYmUgcHJldHRpZmllZCB0byBvbmx5IGNoZWNrXG4gICAgICAgICAgLy8gYWN0dWFsIHBvc2l0aW9ucyBvZiBjdXJsaWVzXG4gICAgICAgICAgdmFyIGNhcnBldCA9IDA7XG4gICAgICAgICAgdmFyIG91dHNpZGUgPSB0cnVlO1xuICAgICAgICAgIHZhciB0aGlzQ3VybHlIZWlnaHQgPSBzcGFuLmRyYXdDdXJseSA/IENvbmZpZ3VyYXRpb24udmlzdWFsLmN1cmx5SGVpZ2h0IDogMDtcbiAgICAgICAgICB2YXIgaGVpZ2h0ID0gc2l6ZXMuZnJhZ21lbnRzLmhlaWdodCArIHRoaXNDdXJseUhlaWdodCArIENvbmZpZ3VyYXRpb24udmlzdWFsLmJveFNwYWNpbmcgK1xuICAgICAgICAgICAgICAyICogQ29uZmlndXJhdGlvbi52aXN1YWwubWFyZ2luLnkgLSAzO1xuICAgICAgICAgICQuZWFjaChmbG9vcnMsIGZ1bmN0aW9uKGZsb29yTm8sIGZsb29yKSB7XG4gICAgICAgICAgICB2YXIgZmxvb3JBdmFpbGFibGUgPSB0cnVlO1xuICAgICAgICAgICAgZm9yICh2YXIgaSA9IGkxOyBpIDw9IGkyOyBpKyspIHtcbiAgICAgICAgICAgICAgaWYgKCEocmVzZXJ2YXRpb25zW2ldICYmIHJlc2VydmF0aW9uc1tpXVtmbG9vcl0pKSBjb250aW51ZTtcbiAgICAgICAgICAgICAgdmFyIGZyb20gPSAoaSA9PSBpMSkgPyB4MSA6IC1pbmY7XG4gICAgICAgICAgICAgIHZhciB0byA9IChpID09IGkyKSA/IHgyIDogaW5mO1xuICAgICAgICAgICAgICAkLmVhY2gocmVzZXJ2YXRpb25zW2ldW2Zsb29yXSwgZnVuY3Rpb24ocmVzTm8sIHJlcykge1xuICAgICAgICAgICAgICAgIGlmIChyZXNbMF0gPCB0byAmJiBmcm9tIDwgcmVzWzFdKSB7XG4gICAgICAgICAgICAgICAgICBmbG9vckF2YWlsYWJsZSA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoZmxvb3JBdmFpbGFibGUpIHtcbiAgICAgICAgICAgICAgaWYgKGNhcnBldCA9PT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIGNhcnBldCA9IGZsb29yO1xuICAgICAgICAgICAgICB9IGVsc2UgaWYgKGhlaWdodCArIGNhcnBldCA8PSBmbG9vcikge1xuICAgICAgICAgICAgICAgIC8vIGZvdW5kIG91ciBmbG9vciFcbiAgICAgICAgICAgICAgICBvdXRzaWRlID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICBjYXJwZXQgPSBudWxsO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0pO1xuICAgICAgICAgIHZhciByZXNsZW4gPSByZXNlcnZhdGlvbnMubGVuZ3RoO1xuICAgICAgICAgIHZhciBtYWtlTmV3Rmxvb3JJZk5lZWRlZCA9IGZ1bmN0aW9uKGZsb29yKSB7XG4gICAgICAgICAgICB2YXIgZmxvb3JObyA9ICQuaW5BcnJheShmbG9vciwgZmxvb3JzKTtcbiAgICAgICAgICAgIGlmIChmbG9vck5vID09IC0xKSB7XG4gICAgICAgICAgICAgIGZsb29ycy5wdXNoKGZsb29yKTtcbiAgICAgICAgICAgICAgZmxvb3JzLnNvcnQoVXRpbC5jbXApO1xuICAgICAgICAgICAgICBmbG9vck5vID0gJC5pbkFycmF5KGZsb29yLCBmbG9vcnMpO1xuICAgICAgICAgICAgICBpZiAoZmxvb3JObyAhPSAwKSB7XG4gICAgICAgICAgICAgICAgLy8gY29weSByZXNlcnZhdGlvbnMgZnJvbSB0aGUgZmxvb3IgYmVsb3dcbiAgICAgICAgICAgICAgICB2YXIgcGFycXVldCA9IGZsb29yc1tmbG9vck5vIC0gMV07XG4gICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPD0gcmVzbGVuOyBpKyspIHtcbiAgICAgICAgICAgICAgICAgIGlmIChyZXNlcnZhdGlvbnNbaV0pIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFyZXNlcnZhdGlvbnNbaV1bcGFycXVldF0pIHtcbiAgICAgICAgICAgICAgICAgICAgICByZXNlcnZhdGlvbnNbaV1bcGFycXVldF0gPSBbXTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB2YXIgZm9vdHJvb20gPSBmbG9vciAtIHBhcnF1ZXQ7XG4gICAgICAgICAgICAgICAgICAgICQuZWFjaChyZXNlcnZhdGlvbnNbaV1bcGFycXVldF0sIGZ1bmN0aW9uKHJlc05vLCByZXMpIHtcbiAgICAgICAgICAgICAgICAgICAgICBpZiAocmVzWzJdID4gZm9vdHJvb20pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghcmVzZXJ2YXRpb25zW2ldW2Zsb29yXSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICByZXNlcnZhdGlvbnNbaV1bZmxvb3JdID0gW107XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICByZXNlcnZhdGlvbnNbaV1bZmxvb3JdLnB1c2goW3Jlc1swXSwgcmVzWzFdLCByZXNbMl0gLSBmb290cm9vbV0pO1xuICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gZmxvb3JObztcbiAgICAgICAgICB9XG4gICAgICAgICAgdmFyIGNlaWxpbmcgPSBjYXJwZXQgKyBoZWlnaHQ7XG4gICAgICAgICAgdmFyIGNlaWxpbmdObyA9IG1ha2VOZXdGbG9vcklmTmVlZGVkKGNlaWxpbmcpO1xuICAgICAgICAgIHZhciBjYXJwZXRObyA9IG1ha2VOZXdGbG9vcklmTmVlZGVkKGNhcnBldCk7XG4gICAgICAgICAgLy8gbWFrZSB0aGUgcmVzZXJ2YXRpb25cbiAgICAgICAgICB2YXIgZmxvb3IsIGZsb29yTm87XG4gICAgICAgICAgZm9yIChmbG9vck5vID0gY2FycGV0Tm87XG4gICAgICAgICAgICAgIChmbG9vciA9IGZsb29yc1tmbG9vck5vXSkgIT09IHVuZGVmaW5lZCAmJiBmbG9vciA8IGNlaWxpbmc7XG4gICAgICAgICAgICAgIGZsb29yTm8rKykge1xuICAgICAgICAgICAgdmFyIGhlYWRyb29tID0gY2VpbGluZyAtIGZsb29yO1xuICAgICAgICAgICAgZm9yICh2YXIgaSA9IGkxOyBpIDw9IGkyOyBpKyspIHtcbiAgICAgICAgICAgICAgdmFyIGZyb20gPSAoaSA9PSBpMSkgPyB4MSA6IDA7XG4gICAgICAgICAgICAgIHZhciB0byA9IChpID09IGkyKSA/IHgyIDogaW5mO1xuICAgICAgICAgICAgICBpZiAoIXJlc2VydmF0aW9uc1tpXSkgcmVzZXJ2YXRpb25zW2ldID0ge307XG4gICAgICAgICAgICAgIGlmICghcmVzZXJ2YXRpb25zW2ldW2Zsb29yXSkgcmVzZXJ2YXRpb25zW2ldW2Zsb29yXSA9IFtdO1xuICAgICAgICAgICAgICByZXNlcnZhdGlvbnNbaV1bZmxvb3JdLnB1c2goW2Zyb20sIHRvLCBoZWFkcm9vbV0pOyAvLyBYWFggbWF5YmUgYWRkIGZyYWdtZW50OyBwcm9iYWJseSB1bm5lY2Vzc2FyeVxuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgICBzcGFuLmZsb29yID0gY2FycGV0ICsgdGhpc0N1cmx5SGVpZ2h0O1xuICAgICAgICB9KTtcblxuICAgICAgICAkLmVhY2goZGF0YS5jaHVua3MsIGZ1bmN0aW9uKGNodW5rTm8sIGNodW5rKSB7XG4gICAgICAgICAgcmVzZXJ2YXRpb25zID0gbmV3IEFycmF5KCk7XG4gICAgICAgICAgY2h1bmsuZ3JvdXAgPSBzdmcuZ3JvdXAocm93Lmdyb3VwKTtcbiAgICAgICAgICBjaHVuay5oaWdobGlnaHRHcm91cCA9IHN2Zy5ncm91cChjaHVuay5ncm91cCk7XG5cbiAgICAgICAgICB2YXIgeSA9IDA7XG4gICAgICAgICAgdmFyIG1pbkFyY0Rpc3Q7XG4gICAgICAgICAgdmFyIGhhc0xlZnRBcmNzLCBoYXNSaWdodEFyY3MsIGhhc0ludGVybmFsQXJjcztcbiAgICAgICAgICB2YXIgaGFzQW5ub3RhdGlvbnM7XG4gICAgICAgICAgdmFyIGNodW5rRnJvbSA9IEluZmluaXR5O1xuICAgICAgICAgIHZhciBjaHVua1RvID0gMDtcbiAgICAgICAgICB2YXIgY2h1bmtIZWlnaHQgPSAwO1xuICAgICAgICAgIHZhciBzcGFjaW5nID0gMDtcbiAgICAgICAgICB2YXIgc3BhY2luZ0NodW5rSWQgPSBudWxsO1xuICAgICAgICAgIHZhciBzcGFjaW5nUm93QnJlYWsgPSAwO1xuXG4gICAgICAgICAgJC5lYWNoKGNodW5rLmZyYWdtZW50cywgZnVuY3Rpb24oZnJhZ21lbnRObywgZnJhZ21lbnQpIHtcbiAgICAgICAgICAgIHZhciBzcGFuID0gZnJhZ21lbnQuc3BhbjtcbiAgICAgICAgICAgIHZhciBzcGFuRGVzYyA9IHNwYW5UeXBlc1tzcGFuLnR5cGVdO1xuICAgICAgICAgICAgdmFyIGJnQ29sb3IgPSAoKHNwYW5EZXNjICYmIHNwYW5EZXNjLmJnQ29sb3IpIHx8XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAoc3BhblR5cGVzLlNQQU5fREVGQVVMVCAmJlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNwYW5UeXBlcy5TUEFOX0RFRkFVTFQuYmdDb2xvcikgfHwgJyNmZmZmZmYnKTtcbiAgICAgICAgICAgIHZhciBmZ0NvbG9yID0gKChzcGFuRGVzYyAmJiBzcGFuRGVzYy5mZ0NvbG9yKSB8fFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgKHNwYW5UeXBlcy5TUEFOX0RFRkFVTFQgJiZcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzcGFuVHlwZXMuU1BBTl9ERUZBVUxULmZnQ29sb3IpIHx8ICcjMDAwMDAwJyk7XG4gICAgICAgICAgICB2YXIgYm9yZGVyQ29sb3IgPSAoKHNwYW5EZXNjICYmIHNwYW5EZXNjLmJvcmRlckNvbG9yKSB8fFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIChzcGFuVHlwZXMuU1BBTl9ERUZBVUxUICYmXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNwYW5UeXBlcy5TUEFOX0RFRkFVTFQuYm9yZGVyQ29sb3IpIHx8ICcjMDAwMDAwJyk7XG5cbiAgICAgICAgICAgIC8vIHNwZWNpYWwgY2FzZTogaWYgdGhlIGJvcmRlciAnY29sb3InIHZhbHVlIGlzICdkYXJrZW4nLFxuICAgICAgICAgICAgLy8gdGhlbiBqdXN0IGRhcmtlbiB0aGUgQkcgY29sb3IgYSBiaXQgZm9yIHRoZSBib3JkZXIuXG4gICAgICAgICAgICBpZiAoYm9yZGVyQ29sb3IgPT0gJ2RhcmtlbicpIHtcbiAgICAgICAgICAgICAgICBib3JkZXJDb2xvciA9IFV0aWwuYWRqdXN0Q29sb3JMaWdodG5lc3MoYmdDb2xvciwgLTAuNik7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGZyYWdtZW50Lmdyb3VwID0gc3ZnLmdyb3VwKGNodW5rLmdyb3VwLCB7XG4gICAgICAgICAgICAgICdjbGFzcyc6ICdzcGFuJyxcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICB2YXIgZnJhZ21lbnRIZWlnaHQgPSAwO1xuXG4gICAgICAgICAgICBpZiAoIXkpIHkgPSAtc2l6ZXMudGV4dHMuaGVpZ2h0O1xuICAgICAgICAgICAgdmFyIHggPSAoZnJhZ21lbnQuY3VybHkuZnJvbSArIGZyYWdtZW50LmN1cmx5LnRvKSAvIDI7XG5cbiAgICAgICAgICAgIC8vIFhYWCBpcyBpdCBtYXliZSBzaXplcy50ZXh0cz9cbiAgICAgICAgICAgIHZhciB5eSA9IHkgKyBzaXplcy5mcmFnbWVudHMueTtcbiAgICAgICAgICAgIHZhciBoaCA9IHNpemVzLmZyYWdtZW50cy5oZWlnaHQ7XG4gICAgICAgICAgICB2YXIgd3cgPSBmcmFnbWVudC53aWR0aDtcbiAgICAgICAgICAgIHZhciB4eCA9IHggLSB3dyAvIDI7XG5cbiAgICAgICAgICAgIC8vIHRleHQgbWFyZ2luIGZpbmUtdHVuaW5nXG4gICAgICAgICAgICB5eSArPSBib3hUZXh0TWFyZ2luLnk7XG4gICAgICAgICAgICBoaCAtPSAyKmJveFRleHRNYXJnaW4ueTtcbiAgICAgICAgICAgIHh4ICs9IGJveFRleHRNYXJnaW4ueDtcbiAgICAgICAgICAgIHd3IC09IDIqYm94VGV4dE1hcmdpbi54O1xuICAgICAgICAgICAgdmFyIHJlY3RDbGFzcyA9ICdzcGFuXycgKyAoc3Bhbi5jdWUgfHwgc3Bhbi50eXBlKSArICcgc3Bhbl9kZWZhdWx0JzsgLy8gVE9ETyBYWFggZmlyc3QgcGFydCB1bm5lZWRlZCBJIHRoaW5rOyByZW1vdmVcblxuICAgICAgICAgICAgLy8gYXR0YWNoIGUuZy4gXCJGYWxzZV9wb3NpdGl2ZVwiIGludG8gdGhlIHR5cGVcbiAgICAgICAgICAgIGlmIChzcGFuLmNvbW1lbnQgJiYgc3Bhbi5jb21tZW50LnR5cGUpIHsgcmVjdENsYXNzICs9ICcgJytzcGFuLmNvbW1lbnQudHlwZTsgfVxuICAgICAgICAgICAgdmFyIGJ4ID0geHggLSBDb25maWd1cmF0aW9uLnZpc3VhbC5tYXJnaW4ueCAtIGJveFRleHRNYXJnaW4ueDtcbiAgICAgICAgICAgIHZhciBieSA9IHl5IC0gQ29uZmlndXJhdGlvbi52aXN1YWwubWFyZ2luLnk7XG4gICAgICAgICAgICB2YXIgYncgPSB3dyArIDIgKiBDb25maWd1cmF0aW9uLnZpc3VhbC5tYXJnaW4ueDtcbiAgICAgICAgICAgIHZhciBiaCA9IGhoICsgMiAqIENvbmZpZ3VyYXRpb24udmlzdWFsLm1hcmdpbi55O1xuXG4gICAgICAgICAgICBpZiAocm91bmRDb29yZGluYXRlcykge1xuICAgICAgICAgICAgICB4ICA9ICh4fDApKzAuNTtcbiAgICAgICAgICAgICAgYnggPSAoYnh8MCkrMC41O1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB2YXIgc2hhZG93UmVjdDtcbiAgICAgICAgICAgIHZhciBtYXJrZWRSZWN0O1xuICAgICAgICAgICAgaWYgKHNwYW4ubWFya2VkKSB7XG4gICAgICAgICAgICAgIG1hcmtlZFJlY3QgPSBzdmcucmVjdChjaHVuay5oaWdobGlnaHRHcm91cCxcbiAgICAgICAgICAgICAgICAgIGJ4IC0gbWFya2VkU3BhblNpemUsIGJ5IC0gbWFya2VkU3BhblNpemUsXG4gICAgICAgICAgICAgICAgICBidyArIDIgKiBtYXJrZWRTcGFuU2l6ZSwgYmggKyAyICogbWFya2VkU3BhblNpemUsIHtcblxuICAgICAgICAgICAgICAgICAgLy8gZmlsdGVyOiAndXJsKCNHYXVzc2lhbl9CbHVyKScsXG4gICAgICAgICAgICAgICAgICAnY2xhc3MnOiBcInNoYWRvd19FZGl0SGlnaGxpZ2h0XCIsXG4gICAgICAgICAgICAgICAgICByeDogbWFya2VkU3BhblNpemUsXG4gICAgICAgICAgICAgICAgICByeTogbWFya2VkU3BhblNpemUsXG4gICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICBzdmcub3RoZXIobWFya2VkUmVjdCwgJ2FuaW1hdGUnLCB7XG4gICAgICAgICAgICAgICAgJ2RhdGEtdHlwZSc6IHNwYW4ubWFya2VkLFxuICAgICAgICAgICAgICAgIGF0dHJpYnV0ZU5hbWU6ICdmaWxsJyxcbiAgICAgICAgICAgICAgICB2YWx1ZXM6IChzcGFuLm1hcmtlZCA9PSAnbWF0Y2gnPyBoaWdobGlnaHRNYXRjaFNlcXVlbmNlXG4gICAgICAgICAgICAgICAgICAgICAgICAgOiBoaWdobGlnaHRTcGFuU2VxdWVuY2UpLFxuICAgICAgICAgICAgICAgIGR1cjogaGlnaGxpZ2h0RHVyYXRpb24sXG4gICAgICAgICAgICAgICAgcmVwZWF0Q291bnQ6ICdpbmRlZmluaXRlJyxcbiAgICAgICAgICAgICAgICBiZWdpbjogJ2luZGVmaW5pdGUnXG4gICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICBjaHVua0Zyb20gPSBNYXRoLm1pbihieCAtIG1hcmtlZFNwYW5TaXplLCBjaHVua0Zyb20pO1xuICAgICAgICAgICAgICBjaHVua1RvID0gTWF0aC5tYXgoYnggKyBidyArIG1hcmtlZFNwYW5TaXplLCBjaHVua1RvKTtcbiAgICAgICAgICAgICAgZnJhZ21lbnRIZWlnaHQgPSBNYXRoLm1heChiaCArIDIgKiBtYXJrZWRTcGFuU2l6ZSwgZnJhZ21lbnRIZWlnaHQpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLy8gLm1hdGNoKCkgcmVtb3ZlcyB1bmNvbmZpZ3VyZWQgc2hhZG93cywgd2hpY2ggd2VyZVxuICAgICAgICAgICAgLy8gYWx3YXlzIHNob3dpbmcgdXAgYXMgYmxhY2suXG4gICAgICAgICAgICAvLyBUT0RPOiBkb24ndCBoYXJkLWNvZGUgY29uZmlndXJlZCBzaGFkb3djbGFzc2VzLlxuICAgICAgICAgICAgaWYgKHNwYW4uc2hhZG93Q2xhc3MgJiZcbiAgICAgICAgICAgICAgICBzcGFuLnNoYWRvd0NsYXNzLm1hdGNoKCdUcnVlX3Bvc2l0aXZlfEZhbHNlX3Bvc2l0aXZlfEZhbHNlX25lZ2F0aXZlfEFubm90YXRpb25FcnJvcnxBbm5vdGF0aW9uV2FybmluZ3xBbm5vdGF0b3JOb3Rlc3xOb3JtYWxpemVkfEFubm90YXRpb25JbmNvbXBsZXRlfEFubm90YXRpb25VbmNvbmZpcm1lZHxyZWN0RWRpdEhpZ2hsaWdodHxFZGl0SGlnaGxpZ2h0X2FyY3xNaXNzaW5nQW5ub3RhdGlvbnxDaGFuZ2VkQW5ub3RhdGlvbiAnKSkge1xuICAgICAgICAgICAgICBzaGFkb3dSZWN0ID0gc3ZnLnJlY3QoZnJhZ21lbnQuZ3JvdXAsXG4gICAgICAgICAgICAgICAgICBieCAtIHJlY3RTaGFkb3dTaXplLCBieSAtIHJlY3RTaGFkb3dTaXplLFxuICAgICAgICAgICAgICAgICAgYncgKyAyICogcmVjdFNoYWRvd1NpemUsIGJoICsgMiAqIHJlY3RTaGFkb3dTaXplLCB7XG4gICAgICAgICAgICAgICAgICAnY2xhc3MnOiAnc2hhZG93XycgKyBzcGFuLnNoYWRvd0NsYXNzLFxuICAgICAgICAgICAgICAgICAgZmlsdGVyOiAndXJsKCNHYXVzc2lhbl9CbHVyKScsXG4gICAgICAgICAgICAgICAgICByeDogcmVjdFNoYWRvd1JvdW5kaW5nLFxuICAgICAgICAgICAgICAgICAgcnk6IHJlY3RTaGFkb3dSb3VuZGluZyxcbiAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgIGNodW5rRnJvbSA9IE1hdGgubWluKGJ4IC0gcmVjdFNoYWRvd1NpemUsIGNodW5rRnJvbSk7XG4gICAgICAgICAgICAgIGNodW5rVG8gPSBNYXRoLm1heChieCArIGJ3ICsgcmVjdFNoYWRvd1NpemUsIGNodW5rVG8pO1xuICAgICAgICAgICAgICBmcmFnbWVudEhlaWdodCA9IE1hdGgubWF4KGJoICsgMiAqIHJlY3RTaGFkb3dTaXplLCBmcmFnbWVudEhlaWdodCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBmcmFnbWVudC5yZWN0ID0gc3ZnLnJlY3QoZnJhZ21lbnQuZ3JvdXAsXG4gICAgICAgICAgICAgICAgYngsIGJ5LCBidywgYmgsIHtcblxuICAgICAgICAgICAgICAgICdjbGFzcyc6IHJlY3RDbGFzcyxcbiAgICAgICAgICAgICAgICBmaWxsOiBiZ0NvbG9yLFxuICAgICAgICAgICAgICAgIHN0cm9rZTogYm9yZGVyQ29sb3IsXG4gICAgICAgICAgICAgICAgcng6IENvbmZpZ3VyYXRpb24udmlzdWFsLm1hcmdpbi54LFxuICAgICAgICAgICAgICAgIHJ5OiBDb25maWd1cmF0aW9uLnZpc3VhbC5tYXJnaW4ueSxcbiAgICAgICAgICAgICAgICAnZGF0YS1zcGFuLWlkJzogc3Bhbi5pZCxcbiAgICAgICAgICAgICAgICAnZGF0YS1mcmFnbWVudC1pZCc6IGZyYWdtZW50LmlkLFxuICAgICAgICAgICAgICAgICdzdHJva2VEYXNoQXJyYXknOiBzcGFuLmF0dHJpYnV0ZU1lcmdlLmRhc2hBcnJheSxcbiAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIC8vIFRPRE8gWFhYOiBxdWljayBuYXN0eSBoYWNrIHRvIGFsbG93IG5vcm1hbGl6YXRpb25zXG4gICAgICAgICAgICAvLyB0byBiZSBtYXJrZWQgdmlzdWFsbHk7IGRvIHNvbWV0aGluZyBjbGVhbmVyIVxuICAgICAgICAgICAgaWYgKHNwYW4ubm9ybWFsaXplZCkge1xuICAgICAgICAgICAgICAkKGZyYWdtZW50LnJlY3QpLmFkZENsYXNzKHNwYW4ubm9ybWFsaXplZCk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGZyYWdtZW50LnJpZ2h0ID0gYnggKyBidzsgLy8gVE9ETyBwdXQgaXQgc29tZXdoZXJlIG5pY2VyP1xuICAgICAgICAgICAgaWYgKCEoc3Bhbi5zaGFkb3dDbGFzcyB8fCBzcGFuLm1hcmtlZCkpIHtcbiAgICAgICAgICAgICAgY2h1bmtGcm9tID0gTWF0aC5taW4oYngsIGNodW5rRnJvbSk7XG4gICAgICAgICAgICAgIGNodW5rVG8gPSBNYXRoLm1heChieCArIGJ3LCBjaHVua1RvKTtcbiAgICAgICAgICAgICAgZnJhZ21lbnRIZWlnaHQgPSBNYXRoLm1heChiaCwgZnJhZ21lbnRIZWlnaHQpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBmcmFnbWVudC5yZWN0Qm94ID0geyB4OiBieCwgeTogYnkgLSBzcGFuLmZsb29yLCB3aWR0aDogYncsIGhlaWdodDogYmggfTtcbiAgICAgICAgICAgIGZyYWdtZW50LmhlaWdodCA9IHNwYW4uZmxvb3IgKyBoaCArIDMgKiBDb25maWd1cmF0aW9uLnZpc3VhbC5tYXJnaW4ueSArIENvbmZpZ3VyYXRpb24udmlzdWFsLmN1cmx5SGVpZ2h0ICsgQ29uZmlndXJhdGlvbi52aXN1YWwuYXJjU3BhY2luZztcbiAgICAgICAgICAgIHZhciBzcGFjZWRUb3dlcklkID0gZnJhZ21lbnQudG93ZXJJZCAqIDI7XG4gICAgICAgICAgICBpZiAoIWZyYWdtZW50SGVpZ2h0c1tzcGFjZWRUb3dlcklkXSB8fCBmcmFnbWVudEhlaWdodHNbc3BhY2VkVG93ZXJJZF0gPCBmcmFnbWVudC5oZWlnaHQpIHtcbiAgICAgICAgICAgICAgZnJhZ21lbnRIZWlnaHRzW3NwYWNlZFRvd2VySWRdID0gZnJhZ21lbnQuaGVpZ2h0O1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgJChmcmFnbWVudC5yZWN0KS5hdHRyKCd5JywgeXkgLSBDb25maWd1cmF0aW9uLnZpc3VhbC5tYXJnaW4ueSAtIHNwYW4uZmxvb3IpO1xuICAgICAgICAgICAgaWYgKHNoYWRvd1JlY3QpIHtcbiAgICAgICAgICAgICAgJChzaGFkb3dSZWN0KS5hdHRyKCd5JywgeXkgLSByZWN0U2hhZG93U2l6ZSAtIENvbmZpZ3VyYXRpb24udmlzdWFsLm1hcmdpbi55IC0gc3Bhbi5mbG9vcik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAobWFya2VkUmVjdCkge1xuICAgICAgICAgICAgICAkKG1hcmtlZFJlY3QpLmF0dHIoJ3knLCB5eSAtIG1hcmtlZFNwYW5TaXplIC0gQ29uZmlndXJhdGlvbi52aXN1YWwubWFyZ2luLnkgLSBzcGFuLmZsb29yKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChzcGFuLmF0dHJpYnV0ZU1lcmdlLmJveCA9PT0gXCJjcm9zc2VkXCIpIHtcbiAgICAgICAgICAgICAgc3ZnLnBhdGgoZnJhZ21lbnQuZ3JvdXAsIHN2Zy5jcmVhdGVQYXRoKCkuXG4gICAgICAgICAgICAgICAgICBtb3ZlKHh4LCB5eSAtIENvbmZpZ3VyYXRpb24udmlzdWFsLm1hcmdpbi55IC0gc3Bhbi5mbG9vcikuXG4gICAgICAgICAgICAgICAgICBsaW5lKHh4ICsgZnJhZ21lbnQud2lkdGgsXG4gICAgICAgICAgICAgICAgICAgIHl5ICsgaGggKyBDb25maWd1cmF0aW9uLnZpc3VhbC5tYXJnaW4ueSAtIHNwYW4uZmxvb3IpLFxuICAgICAgICAgICAgICAgICAgeyAnY2xhc3MnOiAnYm94Y3Jvc3MnIH0pO1xuICAgICAgICAgICAgICBzdmcucGF0aChmcmFnbWVudC5ncm91cCwgc3ZnLmNyZWF0ZVBhdGgoKS5cbiAgICAgICAgICAgICAgICAgIG1vdmUoeHggKyBmcmFnbWVudC53aWR0aCwgeXkgLSBDb25maWd1cmF0aW9uLnZpc3VhbC5tYXJnaW4ueSAtIHNwYW4uZmxvb3IpLlxuICAgICAgICAgICAgICAgICAgbGluZSh4eCwgeXkgKyBoaCArIENvbmZpZ3VyYXRpb24udmlzdWFsLm1hcmdpbi55IC0gc3Bhbi5mbG9vciksXG4gICAgICAgICAgICAgICAgICB7ICdjbGFzcyc6ICdib3hjcm9zcycgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB2YXIgZnJhZ21lbnRUZXh0ID0gc3ZnLnRleHQoZnJhZ21lbnQuZ3JvdXAsIHgsIHkgLSBzcGFuLmZsb29yLCBkYXRhLnNwYW5Bbm5UZXh0c1tmcmFnbWVudC5nbHlwaGVkTGFiZWxUZXh0XSwgeyBmaWxsOiBmZ0NvbG9yIH0pO1xuXG4gICAgICAgICAgICAvLyBNYWtlIGN1cmxpZXMgdG8gc2hvdyB0aGUgZnJhZ21lbnRcbiAgICAgICAgICAgIGlmIChmcmFnbWVudC5kcmF3Q3VybHkpIHtcbiAgICAgICAgICAgICAgdmFyIGN1cmx5Q29sb3IgPSAnZ3JleSc7XG4gICAgICAgICAgICAgIGlmIChjb2xvcmVkQ3VybGllcykge1xuICAgICAgICAgICAgICAgIHZhciBzcGFuRGVzYyA9IHNwYW5UeXBlc1tzcGFuLnR5cGVdO1xuICAgICAgICAgICAgICAgIHZhciBiZ0NvbG9yID0gKChzcGFuRGVzYyAmJiBzcGFuRGVzYy5iZ0NvbG9yKSB8fFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIChzcGFuVHlwZXMuU1BBTl9ERUZBVUxUICYmXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNwYW5UeXBlcy5TUEFOX0RFRkFVTFQuZmdDb2xvcikgfHxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnIzAwMDAwMCcpO1xuICAgICAgICAgICAgICAgIGN1cmx5Q29sb3IgPSBVdGlsLmFkanVzdENvbG9yTGlnaHRuZXNzKGJnQ29sb3IsIC0wLjYpO1xuICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgdmFyIGJvdHRvbSA9IHl5ICsgaGggKyBDb25maWd1cmF0aW9uLnZpc3VhbC5tYXJnaW4ueSAtIHNwYW4uZmxvb3IgKyAxO1xuICAgICAgICAgICAgICBzdmcucGF0aChmcmFnbWVudC5ncm91cCwgc3ZnLmNyZWF0ZVBhdGgoKVxuICAgICAgICAgICAgICAgICAgLm1vdmUoZnJhZ21lbnQuY3VybHkuZnJvbSwgYm90dG9tICsgQ29uZmlndXJhdGlvbi52aXN1YWwuY3VybHlIZWlnaHQpXG4gICAgICAgICAgICAgICAgICAuY3VydmVDKGZyYWdtZW50LmN1cmx5LmZyb20sIGJvdHRvbSxcbiAgICAgICAgICAgICAgICAgICAgeCwgYm90dG9tICsgQ29uZmlndXJhdGlvbi52aXN1YWwuY3VybHlIZWlnaHQsXG4gICAgICAgICAgICAgICAgICAgIHgsIGJvdHRvbSlcbiAgICAgICAgICAgICAgICAgIC5jdXJ2ZUMoeCwgYm90dG9tICsgQ29uZmlndXJhdGlvbi52aXN1YWwuY3VybHlIZWlnaHQsXG4gICAgICAgICAgICAgICAgICAgIGZyYWdtZW50LmN1cmx5LnRvLCBib3R0b20sXG4gICAgICAgICAgICAgICAgICAgIGZyYWdtZW50LmN1cmx5LnRvLCBib3R0b20gKyBDb25maWd1cmF0aW9uLnZpc3VhbC5jdXJseUhlaWdodCksXG4gICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgJ2NsYXNzJzogJ2N1cmx5JyxcbiAgICAgICAgICAgICAgICAgICdzdHJva2UnOiBjdXJseUNvbG9yLFxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICBjaHVua0Zyb20gPSBNYXRoLm1pbihmcmFnbWVudC5jdXJseS5mcm9tLCBjaHVua0Zyb20pO1xuICAgICAgICAgICAgICBjaHVua1RvID0gTWF0aC5tYXgoZnJhZ21lbnQuY3VybHkudG8sIGNodW5rVG8pO1xuICAgICAgICAgICAgICBmcmFnbWVudEhlaWdodCA9IE1hdGgubWF4KENvbmZpZ3VyYXRpb24udmlzdWFsLmN1cmx5SGVpZ2h0LCBmcmFnbWVudEhlaWdodCk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmIChmcmFnbWVudCA9PSBzcGFuLmhlYWRGcmFnbWVudCkge1xuICAgICAgICAgICAgICAvLyBmaW5kIHRoZSBnYXAgdG8gZml0IHRoZSBiYWNrd2FyZHMgYXJjcywgYnV0IG9ubHkgb25cbiAgICAgICAgICAgICAgLy8gaGVhZCBmcmFnbWVudCAtIG90aGVyIGZyYWdtZW50cyBkb24ndCBoYXZlIGFyY3NcbiAgICAgICAgICAgICAgJC5lYWNoKHNwYW4uaW5jb21pbmcsIGZ1bmN0aW9uKGFyY0lkLCBhcmMpIHtcbiAgICAgICAgICAgICAgICB2YXIgbGVmdFNwYW4gPSBkYXRhLnNwYW5zW2FyYy5vcmlnaW5dO1xuICAgICAgICAgICAgICAgIHZhciBvcmlnaW4gPSBsZWZ0U3Bhbi5oZWFkRnJhZ21lbnQuY2h1bms7XG4gICAgICAgICAgICAgICAgdmFyIGJvcmRlcjtcbiAgICAgICAgICAgICAgICBpZiAoY2h1bmsuaW5kZXggPT0gb3JpZ2luLmluZGV4KSB7XG4gICAgICAgICAgICAgICAgICBoYXNJbnRlcm5hbEFyY3MgPSB0cnVlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAob3JpZ2luLnJvdykge1xuICAgICAgICAgICAgICAgICAgdmFyIGxhYmVscyA9IFV0aWwuZ2V0QXJjTGFiZWxzKHNwYW5UeXBlcywgbGVmdFNwYW4udHlwZSwgYXJjLnR5cGUsIHJlbGF0aW9uVHlwZXNIYXNoKTtcbiAgICAgICAgICAgICAgICAgIGlmICghbGFiZWxzLmxlbmd0aCkgbGFiZWxzID0gW2FyYy50eXBlXTtcbiAgICAgICAgICAgICAgICAgIGlmIChvcmlnaW4ucm93LmluZGV4ID09IHJvd0luZGV4KSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIHNhbWUgcm93LCBidXQgYmVmb3JlIHRoaXNcbiAgICAgICAgICAgICAgICAgICAgYm9yZGVyID0gb3JpZ2luLnRyYW5zbGF0aW9uLnggKyBsZWZ0U3Bhbi5mcmFnbWVudHNbbGVmdFNwYW4uZnJhZ21lbnRzLmxlbmd0aCAtIDFdLnJpZ2h0O1xuICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgYm9yZGVyID0gQ29uZmlndXJhdGlvbi52aXN1YWwubWFyZ2luLnggKyBzZW50TnVtTWFyZ2luICsgcm93UGFkZGluZztcbiAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgIHZhciBsYWJlbE5vID0gQ29uZmlndXJhdGlvbi5hYmJyZXZzT24gPyBsYWJlbHMubGVuZ3RoIC0gMSA6IDA7XG4gICAgICAgICAgICAgICAgICB2YXIgc21hbGxlc3RMYWJlbFdpZHRoID0gc2l6ZXMuYXJjcy53aWR0aHNbbGFiZWxzW2xhYmVsTm9dXSArIDIgKiBtaW5BcmNTbGFudDtcbiAgICAgICAgICAgICAgICAgIHZhciBnYXAgPSBjdXJyZW50WCArIGJ4IC0gYm9yZGVyO1xuICAgICAgICAgICAgICAgICAgdmFyIGFyY1NwYWNpbmcgPSBzbWFsbGVzdExhYmVsV2lkdGggLSBnYXA7XG4gICAgICAgICAgICAgICAgICBpZiAoIWhhc0xlZnRBcmNzIHx8IHNwYWNpbmcgPCBhcmNTcGFjaW5nKSB7XG4gICAgICAgICAgICAgICAgICAgIHNwYWNpbmcgPSBhcmNTcGFjaW5nO1xuICAgICAgICAgICAgICAgICAgICBzcGFjaW5nQ2h1bmtJZCA9IG9yaWdpbi5pbmRleCArIDE7XG4gICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICBhcmNTcGFjaW5nID0gc21hbGxlc3RMYWJlbFdpZHRoIC0gYng7XG4gICAgICAgICAgICAgICAgICBpZiAoIWhhc0xlZnRBcmNzIHx8IHNwYWNpbmdSb3dCcmVhayA8IGFyY1NwYWNpbmcpIHtcbiAgICAgICAgICAgICAgICAgICAgc3BhY2luZ1Jvd0JyZWFrID0gYXJjU3BhY2luZztcbiAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgIGhhc0xlZnRBcmNzID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgaGFzUmlnaHRBcmNzID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAkLmVhY2goc3Bhbi5vdXRnb2luZywgZnVuY3Rpb24oYXJjSWQsIGFyYykge1xuICAgICAgICAgICAgICAgIHZhciBsZWZ0U3BhbiA9IGRhdGEuc3BhbnNbYXJjLnRhcmdldF07XG4gICAgICAgICAgICAgICAgdmFyIHRhcmdldCA9IGxlZnRTcGFuLmhlYWRGcmFnbWVudC5jaHVuaztcbiAgICAgICAgICAgICAgICB2YXIgYm9yZGVyO1xuICAgICAgICAgICAgICAgIGlmICh0YXJnZXQucm93KSB7XG4gICAgICAgICAgICAgICAgICB2YXIgbGFiZWxzID0gVXRpbC5nZXRBcmNMYWJlbHMoc3BhblR5cGVzLCBzcGFuLnR5cGUsIGFyYy50eXBlLCByZWxhdGlvblR5cGVzSGFzaCk7XG4gICAgICAgICAgICAgICAgICBpZiAoIWxhYmVscy5sZW5ndGgpIGxhYmVscyA9IFthcmMudHlwZV07XG4gICAgICAgICAgICAgICAgICBpZiAodGFyZ2V0LnJvdy5pbmRleCA9PSByb3dJbmRleCkge1xuICAgICAgICAgICAgICAgICAgICAvLyBzYW1lIHJvdywgYnV0IGJlZm9yZSB0aGlzXG4gICAgICAgICAgICAgICAgICAgIGJvcmRlciA9IHRhcmdldC50cmFuc2xhdGlvbi54ICsgbGVmdFNwYW4uZnJhZ21lbnRzW2xlZnRTcGFuLmZyYWdtZW50cy5sZW5ndGggLSAxXS5yaWdodDtcbiAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGJvcmRlciA9IENvbmZpZ3VyYXRpb24udmlzdWFsLm1hcmdpbi54ICsgc2VudE51bU1hcmdpbiArIHJvd1BhZGRpbmc7XG4gICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICB2YXIgbGFiZWxObyA9IENvbmZpZ3VyYXRpb24uYWJicmV2c09uID8gbGFiZWxzLmxlbmd0aCAtIDEgOiAwO1xuICAgICAgICAgICAgICAgICAgdmFyIHNtYWxsZXN0TGFiZWxXaWR0aCA9IHNpemVzLmFyY3Mud2lkdGhzW2xhYmVsc1tsYWJlbE5vXV0gKyAyICogbWluQXJjU2xhbnQ7XG4gICAgICAgICAgICAgICAgICB2YXIgZ2FwID0gY3VycmVudFggKyBieCAtIGJvcmRlcjtcbiAgICAgICAgICAgICAgICAgIHZhciBhcmNTcGFjaW5nID0gc21hbGxlc3RMYWJlbFdpZHRoIC0gZ2FwO1xuICAgICAgICAgICAgICAgICAgaWYgKCFoYXNMZWZ0QXJjcyB8fCBzcGFjaW5nIDwgYXJjU3BhY2luZykge1xuICAgICAgICAgICAgICAgICAgICBzcGFjaW5nID0gYXJjU3BhY2luZztcbiAgICAgICAgICAgICAgICAgICAgc3BhY2luZ0NodW5rSWQgPSB0YXJnZXQuaW5kZXggKyAxO1xuICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgYXJjU3BhY2luZyA9IHNtYWxsZXN0TGFiZWxXaWR0aCAtIGJ4O1xuICAgICAgICAgICAgICAgICAgaWYgKCFoYXNMZWZ0QXJjcyB8fCBzcGFjaW5nUm93QnJlYWsgPCBhcmNTcGFjaW5nKSB7XG4gICAgICAgICAgICAgICAgICAgIHNwYWNpbmdSb3dCcmVhayA9IGFyY1NwYWNpbmc7XG4gICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICBoYXNMZWZ0QXJjcyA9IHRydWU7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgIGhhc1JpZ2h0QXJjcyA9IHRydWU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGZyYWdtZW50SGVpZ2h0ICs9IHNwYW4uZmxvb3IgfHwgQ29uZmlndXJhdGlvbi52aXN1YWwuY3VybHlIZWlnaHQ7XG4gICAgICAgICAgICBpZiAoZnJhZ21lbnRIZWlnaHQgPiBjaHVua0hlaWdodCkgY2h1bmtIZWlnaHQgPSBmcmFnbWVudEhlaWdodDtcbiAgICAgICAgICAgIGhhc0Fubm90YXRpb25zID0gdHJ1ZTtcbiAgICAgICAgICB9KTsgLy8gZnJhZ21lbnRzXG5cbiAgICAgICAgICAvLyBwb3NpdGlvbmluZyBvZiB0aGUgY2h1bmtcbiAgICAgICAgICBjaHVuay5yaWdodCA9IGNodW5rVG87XG4gICAgICAgICAgdmFyIHRleHRXaWR0aCA9IHNpemVzLnRleHRzLndpZHRoc1tjaHVuay50ZXh0XTtcbiAgICAgICAgICBjaHVua0hlaWdodCArPSBzaXplcy50ZXh0cy5oZWlnaHQ7XG4gICAgICAgICAgdmFyIGJveFggPSAtTWF0aC5taW4oY2h1bmtGcm9tLCAwKTtcbiAgICAgICAgICB2YXIgYm94V2lkdGggPVxuICAgICAgICAgICAgICBNYXRoLm1heCh0ZXh0V2lkdGgsIGNodW5rVG8pIC1cbiAgICAgICAgICAgICAgTWF0aC5taW4oMCwgY2h1bmtGcm9tKTtcbiAgICAgICAgICAvLyBpZiAoaGFzTGVmdEFyY3MpIHtcbiAgICAgICAgICAgIC8vIFRPRE8gY2hhbmdlIHRoaXMgd2l0aCBzbWFsbGVzdExlZnRBcmNcbiAgICAgICAgICAgIC8vIHZhciBzcGFjaW5nID0gYXJjSG9yaXpvbnRhbFNwYWNpbmcgLSAoY3VycmVudFggLSBsYXN0QXJjQm9yZGVyKTtcbiAgICAgICAgICAgIC8vIGFyYyB0b28gc21hbGw/XG4gICAgICAgICAgaWYgKHNwYWNpbmcgPiAwKSBjdXJyZW50WCArPSBzcGFjaW5nO1xuICAgICAgICAgIC8vIH1cbiAgICAgICAgICB2YXIgcmlnaHRCb3JkZXJGb3JBcmNzID0gaGFzUmlnaHRBcmNzID8gYXJjSG9yaXpvbnRhbFNwYWNpbmcgOiAoaGFzSW50ZXJuYWxBcmNzID8gYXJjU2xhbnQgOiAwKTtcblxuICAgICAgICAgIHZhciBsYXN0WCA9IGN1cnJlbnRYO1xuICAgICAgICAgIHZhciBsYXN0Um93ID0gcm93O1xuXG4gICAgICAgICAgaWYgKGNodW5rLnNlbnRlbmNlKSB7XG4gICAgICAgICAgICB3aGlsZSAoc2VudGVuY2VOdW1iZXIgPCBjaHVuay5zZW50ZW5jZSkge1xuICAgICAgICAgICAgICBzZW50ZW5jZU51bWJlcisrO1xuICAgICAgICAgICAgICByb3cuYXJjcyA9IHN2Zy5ncm91cChyb3cuZ3JvdXAsIHsgJ2NsYXNzJzogJ2FyY3MnIH0pO1xuICAgICAgICAgICAgICByb3dzLnB1c2gocm93KTtcbiAgICAgICAgICAgICAgcm93ID0gbmV3IFJvdyhzdmcpO1xuICAgICAgICAgICAgICBzZW50ZW5jZVRvZ2dsZSA9IDEgLSBzZW50ZW5jZVRvZ2dsZTtcbiAgICAgICAgICAgICAgcm93LmJhY2tncm91bmRJbmRleCA9IHNlbnRlbmNlVG9nZ2xlO1xuICAgICAgICAgICAgICByb3cuaW5kZXggPSArK3Jvd0luZGV4O1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgc2VudGVuY2VUb2dnbGUgPSAxIC0gc2VudGVuY2VUb2dnbGU7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgaWYgKGNodW5rLnNlbnRlbmNlIHx8XG4gICAgICAgICAgICAgIGN1cnJlbnRYICsgYm94V2lkdGggKyByaWdodEJvcmRlckZvckFyY3MgPj0gY2FudmFzV2lkdGggLSAyICogQ29uZmlndXJhdGlvbi52aXN1YWwubWFyZ2luLngpIHtcbiAgICAgICAgICAgIC8vIHRoZSBjaHVuayBkb2VzIG5vdCBmaXRcbiAgICAgICAgICAgIHJvdy5hcmNzID0gc3ZnLmdyb3VwKHJvdy5ncm91cCwgeyAnY2xhc3MnOiAnYXJjcycgfSk7XG4gICAgICAgICAgICAvLyBUT0RPOiByZWxhdGVkIHRvIGlzc3VlICM1NzFcbiAgICAgICAgICAgIC8vIHJlcGxhY2UgYXJjSG9yaXpvbnRhbFNwYWNpbmcgd2l0aCBhIGNhbGN1bGF0ZWQgdmFsdWVcbiAgICAgICAgICAgIGN1cnJlbnRYID0gQ29uZmlndXJhdGlvbi52aXN1YWwubWFyZ2luLnggKyBzZW50TnVtTWFyZ2luICsgcm93UGFkZGluZyArXG4gICAgICAgICAgICAgICAgKGhhc0xlZnRBcmNzID8gYXJjSG9yaXpvbnRhbFNwYWNpbmcgOiAoaGFzSW50ZXJuYWxBcmNzID8gYXJjU2xhbnQgOiAwKSk7XG4gICAgICAgICAgICBpZiAoaGFzTGVmdEFyY3MpIHtcbiAgICAgICAgICAgICAgdmFyIGFkanVzdGVkQ3VyVGV4dFdpZHRoID0gc2l6ZXMudGV4dHMud2lkdGhzW2NodW5rLnRleHRdICsgYXJjSG9yaXpvbnRhbFNwYWNpbmc7XG4gICAgICAgICAgICAgIGlmIChhZGp1c3RlZEN1clRleHRXaWR0aCA+IG1heFRleHRXaWR0aCkge1xuICAgICAgICAgICAgICAgIG1heFRleHRXaWR0aCA9IGFkanVzdGVkQ3VyVGV4dFdpZHRoO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoc3BhY2luZ1Jvd0JyZWFrID4gMCkge1xuICAgICAgICAgICAgICBjdXJyZW50WCArPSBzcGFjaW5nUm93QnJlYWs7XG4gICAgICAgICAgICAgIHNwYWNpbmcgPSAwOyAvLyBkbyBub3QgY2VudGVyIGludGVydmVuaW5nIGVsZW1lbnRzXG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIG5ldyByb3dcbiAgICAgICAgICAgIHJvd3MucHVzaChyb3cpO1xuXG4gICAgICAgICAgICBzdmcucmVtb3ZlKGNodW5rLmdyb3VwKTtcbiAgICAgICAgICAgIHJvdyA9IG5ldyBSb3coc3ZnKTtcbiAgICAgICAgICAgIHJvdy5iYWNrZ3JvdW5kSW5kZXggPSBzZW50ZW5jZVRvZ2dsZTtcbiAgICAgICAgICAgIHJvdy5pbmRleCA9ICsrcm93SW5kZXg7XG4gICAgICAgICAgICBzdmcuYWRkKHJvdy5ncm91cCwgY2h1bmsuZ3JvdXApO1xuICAgICAgICAgICAgY2h1bmsuZ3JvdXAgPSByb3cuZ3JvdXAubGFzdEVsZW1lbnRDaGlsZDtcbiAgICAgICAgICAgICQoY2h1bmsuZ3JvdXApLmNoaWxkcmVuKFwiZ1tjbGFzcz0nc3BhbiddXCIpLlxuICAgICAgICAgICAgICBlYWNoKGZ1bmN0aW9uKGluZGV4LCBlbGVtZW50KSB7XG4gICAgICAgICAgICAgICAgICBjaHVuay5mcmFnbWVudHNbaW5kZXhdLmdyb3VwID0gZWxlbWVudDtcbiAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAkKGNodW5rLmdyb3VwKS5maW5kKFwicmVjdFtkYXRhLXNwYW4taWRdXCIpLlxuICAgICAgICAgICAgICBlYWNoKGZ1bmN0aW9uKGluZGV4LCBlbGVtZW50KSB7XG4gICAgICAgICAgICAgICAgICBjaHVuay5mcmFnbWVudHNbaW5kZXhdLnJlY3QgPSBlbGVtZW50O1xuICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICAvLyBicmVhayB0aGUgdGV4dCBoaWdobGlnaHRzIHdoZW4gdGhlIHJvdyBicmVha3NcbiAgICAgICAgICBpZiAocm93LmluZGV4ICE9PSBsYXN0Um93LmluZGV4KSB7XG4gICAgICAgICAgICAkLmVhY2gob3BlblRleHRIaWdobGlnaHRzLCBmdW5jdGlvbih0ZXh0SWQsIHRleHREZXNjKSB7XG4gICAgICAgICAgICAgIGlmICh0ZXh0RGVzY1szXSAhPSBsYXN0WCkge1xuICAgICAgICAgICAgICAgIHZhciBuZXdEZXNjID0gW2xhc3RSb3csIHRleHREZXNjWzNdLCBsYXN0WCArIGJveFgsIHRleHREZXNjWzRdXTtcbiAgICAgICAgICAgICAgICB0ZXh0TWFya2VkUm93cy5wdXNoKG5ld0Rlc2MpO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIHRleHREZXNjWzNdID0gY3VycmVudFg7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICAvLyBvcGVuIHRleHQgaGlnaGxpZ2h0c1xuICAgICAgICAgICQuZWFjaChjaHVuay5tYXJrZWRUZXh0U3RhcnQsIGZ1bmN0aW9uKHRleHRObywgdGV4dERlc2MpIHtcbiAgICAgICAgICAgIHRleHREZXNjWzNdICs9IGN1cnJlbnRYICsgYm94WDtcbiAgICAgICAgICAgIG9wZW5UZXh0SGlnaGxpZ2h0c1t0ZXh0RGVzY1swXV0gPSB0ZXh0RGVzYztcbiAgICAgICAgICB9KTtcblxuICAgICAgICAgIC8vIGNsb3NlIHRleHQgaGlnaGxpZ2h0c1xuICAgICAgICAgICQuZWFjaChjaHVuay5tYXJrZWRUZXh0RW5kLCBmdW5jdGlvbih0ZXh0Tm8sIHRleHREZXNjKSB7XG4gICAgICAgICAgICB0ZXh0RGVzY1szXSArPSBjdXJyZW50WCArIGJveFg7XG4gICAgICAgICAgICB2YXIgc3RhcnREZXNjID0gb3BlblRleHRIaWdobGlnaHRzW3RleHREZXNjWzBdXTtcbiAgICAgICAgICAgIGRlbGV0ZSBvcGVuVGV4dEhpZ2hsaWdodHNbdGV4dERlc2NbMF1dO1xuICAgICAgICAgICAgbWFya2VkUm93ID0gW3Jvdywgc3RhcnREZXNjWzNdLCB0ZXh0RGVzY1szXSwgc3RhcnREZXNjWzRdXTtcbiAgICAgICAgICAgIHRleHRNYXJrZWRSb3dzLnB1c2gobWFya2VkUm93KTtcbiAgICAgICAgICB9KTtcblxuICAgICAgICAgIC8vIFhYWCBjaGVjayB0aGlzIC0gaXMgaXQgdXNlZD8gc2hvdWxkIGl0IGJlIGxhc3RSb3c/XG4gICAgICAgICAgaWYgKGhhc0Fubm90YXRpb25zKSByb3cuaGFzQW5ub3RhdGlvbnMgPSB0cnVlO1xuXG4gICAgICAgICAgaWYgKGNodW5rLnNlbnRlbmNlKSB7XG4gICAgICAgICAgICByb3cuc2VudGVuY2UgPSArK3NlbnRlbmNlTnVtYmVyO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIGlmIChzcGFjaW5nID4gMCkge1xuICAgICAgICAgICAgLy8gaWYgd2UgYWRkZWQgYSBnYXAsIGNlbnRlciB0aGUgaW50ZXJ2ZW5pbmcgZWxlbWVudHNcbiAgICAgICAgICAgIHNwYWNpbmcgLz0gMjtcbiAgICAgICAgICAgIHZhciBmaXJzdENodW5rSW5Sb3cgPSByb3cuY2h1bmtzW3Jvdy5jaHVua3MubGVuZ3RoIC0gMV07XG4gICAgICAgICAgICBpZiAoc3BhY2luZ0NodW5rSWQgPCBmaXJzdENodW5rSW5Sb3cuaW5kZXgpIHtcbiAgICAgICAgICAgICAgc3BhY2luZ0NodW5rSWQgPSBmaXJzdENodW5rSW5Sb3cuaW5kZXggKyAxO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZm9yICh2YXIgY2h1bmtJbmRleCA9IHNwYWNpbmdDaHVua0lkOyBjaHVua0luZGV4IDwgY2h1bmsuaW5kZXg7IGNodW5rSW5kZXgrKykge1xuICAgICAgICAgICAgICB2YXIgbW92ZWRDaHVuayA9IGRhdGEuY2h1bmtzW2NodW5rSW5kZXhdO1xuICAgICAgICAgICAgICB0cmFuc2xhdGUobW92ZWRDaHVuaywgbW92ZWRDaHVuay50cmFuc2xhdGlvbi54ICsgc3BhY2luZywgMCk7XG4gICAgICAgICAgICAgIG1vdmVkQ2h1bmsudGV4dFggKz0gc3BhY2luZztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG5cbiAgICAgICAgICByb3cuY2h1bmtzLnB1c2goY2h1bmspO1xuICAgICAgICAgIGNodW5rLnJvdyA9IHJvdztcblxuICAgICAgICAgIHRyYW5zbGF0ZShjaHVuaywgY3VycmVudFggKyBib3hYLCAwKTtcbiAgICAgICAgICBjaHVuay50ZXh0WCA9IGN1cnJlbnRYICsgYm94WDtcblxuICAgICAgICAgIHZhciBzcGFjZVdpZHRoID0gMDtcbiAgICAgICAgICB2YXIgc3BhY2VMZW4gPSBjaHVuay5uZXh0U3BhY2UgJiYgY2h1bmsubmV4dFNwYWNlLmxlbmd0aCB8fCAwO1xuICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgc3BhY2VMZW47IGkrKykgc3BhY2VXaWR0aCArPSBzcGFjZVdpZHRoc1tjaHVuay5uZXh0U3BhY2VbaV1dIHx8IDA7XG4gICAgICAgICAgY3VycmVudFggKz0gc3BhY2VXaWR0aCArIGJveFdpZHRoO1xuICAgICAgICB9KTsgLy8gY2h1bmtzXG5cbiAgICAgICAgLy8gZmluaXNoIHRoZSBsYXN0IHJvd1xuICAgICAgICByb3cuYXJjcyA9IHN2Zy5ncm91cChyb3cuZ3JvdXAsIHsgJ2NsYXNzJzogJ2FyY3MnIH0pO1xuICAgICAgICByb3dzLnB1c2gocm93KTtcblxuVXRpbC5wcm9maWxlRW5kKCdjaHVua3MnKTtcblV0aWwucHJvZmlsZVN0YXJ0KCdhcmNzUHJlcCcpO1xuXG4gICAgICAgIHZhciBhcnJvd3MgPSB7fTtcbiAgICAgICAgdmFyIGFycm93ID0gbWFrZUFycm93KGRlZnMsICdub25lJyk7XG4gICAgICAgIGlmIChhcnJvdykgYXJyb3dzWydub25lJ10gPSBhcnJvdztcblxuICAgICAgICB2YXIgbGVuID0gZnJhZ21lbnRIZWlnaHRzLmxlbmd0aDtcbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBsZW47IGkrKykge1xuICAgICAgICAgIGlmICghZnJhZ21lbnRIZWlnaHRzW2ldIHx8IGZyYWdtZW50SGVpZ2h0c1tpXSA8IENvbmZpZ3VyYXRpb24udmlzdWFsLmFyY1N0YXJ0SGVpZ2h0KSB7XG4gICAgICAgICAgICBmcmFnbWVudEhlaWdodHNbaV0gPSBDb25maWd1cmF0aW9uLnZpc3VhbC5hcmNTdGFydEhlaWdodDtcbiAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICAvLyBmaW5kIG91dCBob3cgaGlnaCB0aGUgYXJjcyBoYXZlIHRvIGdvXG4gICAgICAgICQuZWFjaChkYXRhLmFyY3MsIGZ1bmN0aW9uKGFyY05vLCBhcmMpIHtcbiAgICAgICAgICBhcmMuanVtcEhlaWdodCA9IDA7XG4gICAgICAgICAgdmFyIGZyb21GcmFnbWVudCA9IGRhdGEuc3BhbnNbYXJjLm9yaWdpbl0uaGVhZEZyYWdtZW50O1xuICAgICAgICAgIHZhciB0b0ZyYWdtZW50ID0gZGF0YS5zcGFuc1thcmMudGFyZ2V0XS5oZWFkRnJhZ21lbnQ7XG4gICAgICAgICAgaWYgKGZyb21GcmFnbWVudC50b3dlcklkID4gdG9GcmFnbWVudC50b3dlcklkKSB7XG4gICAgICAgICAgICB2YXIgdG1wID0gZnJvbUZyYWdtZW50OyBmcm9tRnJhZ21lbnQgPSB0b0ZyYWdtZW50OyB0b0ZyYWdtZW50ID0gdG1wO1xuICAgICAgICAgIH1cbiAgICAgICAgICB2YXIgZnJvbSwgdG87XG4gICAgICAgICAgaWYgKGZyb21GcmFnbWVudC5jaHVuay5pbmRleCA9PSB0b0ZyYWdtZW50LmNodW5rLmluZGV4KSB7XG4gICAgICAgICAgICBmcm9tID0gZnJvbUZyYWdtZW50LnRvd2VySWQ7XG4gICAgICAgICAgICB0byA9IHRvRnJhZ21lbnQudG93ZXJJZDtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgZnJvbSA9IGZyb21GcmFnbWVudC50b3dlcklkICsgMTtcbiAgICAgICAgICAgIHRvID0gdG9GcmFnbWVudC50b3dlcklkIC0gMTtcbiAgICAgICAgICB9XG4gICAgICAgICAgZm9yICh2YXIgaSA9IGZyb207IGkgPD0gdG87IGkrKykge1xuICAgICAgICAgICAgaWYgKGFyYy5qdW1wSGVpZ2h0IDwgZnJhZ21lbnRIZWlnaHRzW2kgKiAyXSkgYXJjLmp1bXBIZWlnaHQgPSBmcmFnbWVudEhlaWdodHNbaSAqIDJdO1xuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgLy8gc29ydCB0aGUgYXJjc1xuICAgICAgICBkYXRhLmFyY3Muc29ydChmdW5jdGlvbihhLCBiKSB7XG4gICAgICAgICAgLy8gZmlyc3Qgd3JpdGUgdGhvc2UgdGhhdCBoYXZlIGxlc3MgdG8ganVtcCBvdmVyXG4gICAgICAgICAgdmFyIHRtcCA9IGEuanVtcEhlaWdodCAtIGIuanVtcEhlaWdodDtcbiAgICAgICAgICBpZiAodG1wKSByZXR1cm4gdG1wIDwgMCA/IC0xIDogMTtcbiAgICAgICAgICAvLyBpZiBlcXVhbCwgdGhlbiB0aG9zZSB0aGF0IHNwYW4gbGVzcyBkaXN0YW5jZVxuICAgICAgICAgIHRtcCA9IGEuZGlzdCAtIGIuZGlzdDtcbiAgICAgICAgICBpZiAodG1wKSByZXR1cm4gdG1wIDwgMCA/IC0xIDogMTtcbiAgICAgICAgICAvLyBpZiBlcXVhbCwgdGhlbiB0aG9zZSB3aGVyZSBoZWlnaHRzIG9mIHRoZSB0YXJnZXRzIGFyZSBzbWFsbGVyXG4gICAgICAgICAgdG1wID0gZGF0YS5zcGFuc1thLm9yaWdpbl0uaGVhZEZyYWdtZW50LmhlaWdodCArIGRhdGEuc3BhbnNbYS50YXJnZXRdLmhlYWRGcmFnbWVudC5oZWlnaHQgLVxuICAgICAgICAgICAgZGF0YS5zcGFuc1tiLm9yaWdpbl0uaGVhZEZyYWdtZW50LmhlaWdodCAtIGRhdGEuc3BhbnNbYi50YXJnZXRdLmhlYWRGcmFnbWVudC5oZWlnaHQ7XG4gICAgICAgICAgaWYgKHRtcCkgcmV0dXJuIHRtcCA8IDAgPyAtMSA6IDE7XG4gICAgICAgICAgLy8gaWYgZXF1YWwsIHRoZW4gdGhvc2Ugd2l0aCB0aGUgbG93ZXIgb3JpZ2luXG4gICAgICAgICAgdG1wID0gZGF0YS5zcGFuc1thLm9yaWdpbl0uaGVhZEZyYWdtZW50LmhlaWdodCAtIGRhdGEuc3BhbnNbYi5vcmlnaW5dLmhlYWRGcmFnbWVudC5oZWlnaHQ7XG4gICAgICAgICAgaWYgKHRtcCkgcmV0dXJuIHRtcCA8IDAgPyAtMSA6IDE7XG4gICAgICAgICAgLy8gaWYgZXF1YWwsIHRoZXkncmUganVzdCBlcXVhbC5cbiAgICAgICAgICByZXR1cm4gMDtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgLy8gZHJhdyB0aGUgZHJhZyBhcmMgbWFya2VyXG4gICAgICAgIHZhciBhcnJvd2hlYWQgPSBzdmcubWFya2VyKGRlZnMsICdkcmFnX2Fycm93JyxcbiAgICAgICAgICA1LCAyLjUsIDUsIDUsICdhdXRvJyxcbiAgICAgICAgICB7XG4gICAgICAgICAgICBtYXJrZXJVbml0czogJ3N0cm9rZVdpZHRoJyxcbiAgICAgICAgICAgICdjbGFzcyc6ICdkcmFnX2ZpbGwnLFxuICAgICAgICAgIH0pO1xuICAgICAgICBzdmcucG9seWxpbmUoYXJyb3doZWFkLCBbWzAsIDBdLCBbNSwgMi41XSwgWzAsIDVdLCBbMC4yLCAyLjVdXSk7XG5cblV0aWwucHJvZmlsZUVuZCgnYXJjc1ByZXAnKTtcblV0aWwucHJvZmlsZVN0YXJ0KCdhcmNzJyk7XG5cbiAgICAgICAgLy8gYWRkIHRoZSBhcmNzXG4gICAgICAgICQuZWFjaChkYXRhLmFyY3MsIGZ1bmN0aW9uKGFyY05vLCBhcmMpIHtcbiAgICAgICAgICAvLyBzZXBhcmF0ZSBvdXQgcG9zc2libGUgbnVtZXJpYyBzdWZmaXggZnJvbSB0eXBlXG4gICAgICAgICAgdmFyIG5vTnVtQXJjVHlwZTtcbiAgICAgICAgICB2YXIgc3BsaXRBcmNUeXBlO1xuICAgICAgICAgIGlmIChhcmMudHlwZSkge1xuICAgICAgICAgICAgc3BsaXRBcmNUeXBlID0gYXJjLnR5cGUubWF0Y2goL14oLio/KShcXGQqKSQvKTtcbiAgICAgICAgICAgIG5vTnVtQXJjVHlwZSA9IHNwbGl0QXJjVHlwZVsxXTtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICB2YXIgb3JpZ2luU3BhbiA9IGRhdGEuc3BhbnNbYXJjLm9yaWdpbl07XG4gICAgICAgICAgdmFyIHRhcmdldFNwYW4gPSBkYXRhLnNwYW5zW2FyYy50YXJnZXRdO1xuXG4gICAgICAgICAgdmFyIGxlZnRUb1JpZ2h0ID0gb3JpZ2luU3Bhbi5oZWFkRnJhZ21lbnQudG93ZXJJZCA8IHRhcmdldFNwYW4uaGVhZEZyYWdtZW50LnRvd2VySWQ7XG4gICAgICAgICAgdmFyIGxlZnQsIHJpZ2h0O1xuICAgICAgICAgIGlmIChsZWZ0VG9SaWdodCkge1xuICAgICAgICAgICAgbGVmdCA9IG9yaWdpblNwYW4uaGVhZEZyYWdtZW50O1xuICAgICAgICAgICAgcmlnaHQgPSB0YXJnZXRTcGFuLmhlYWRGcmFnbWVudDtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgbGVmdCA9IHRhcmdldFNwYW4uaGVhZEZyYWdtZW50O1xuICAgICAgICAgICAgcmlnaHQgPSBvcmlnaW5TcGFuLmhlYWRGcmFnbWVudDtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICB2YXIgc3BhbkRlc2MgPSBzcGFuVHlwZXNbb3JpZ2luU3Bhbi50eXBlXTtcbiAgICAgICAgICAvLyBUT0RPOiBtaWdodCBtYWtlIG1vcmUgc2Vuc2UgdG8gcmVmb3JtYXQgdGhpcyBhcyBkaWN0IGluc3RlYWRcbiAgICAgICAgICAvLyBvZiBzZWFyY2hpbmcgdGhyb3VnaCB0aGUgbGlzdCBldmVyeSB0eXBlXG4gICAgICAgICAgdmFyIGFyY0Rlc2M7XG4gICAgICAgICAgaWYgKHNwYW5EZXNjICYmIHNwYW5EZXNjLmFyY3MpIHtcbiAgICAgICAgICAgICQuZWFjaChzcGFuRGVzYy5hcmNzLCBmdW5jdGlvbihhcmNEZXNjTm8sIGFyY0Rlc2NJdGVyKSB7XG4gICAgICAgICAgICAgICAgaWYgKGFyY0Rlc2NJdGVyLnR5cGUgPT0gYXJjLnR5cGUpIHtcbiAgICAgICAgICAgICAgICAgIGFyY0Rlc2MgPSBhcmNEZXNjSXRlcjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH1cbiAgICAgICAgICAvLyBmYWxsIGJhY2sgb24gdW5udW1iZXJlZCB0eXBlIGlmIG5vdCBmb3VuZCBpbiBmdWxsXG4gICAgICAgICAgaWYgKCFhcmNEZXNjICYmIG5vTnVtQXJjVHlwZSAmJiBub051bUFyY1R5cGUgIT0gYXJjLnR5cGUgJiZcbiAgICAgICAgICAgIHNwYW5EZXNjICYmIHNwYW5EZXNjLmFyY3MpIHtcbiAgICAgICAgICAgICQuZWFjaChzcGFuRGVzYy5hcmNzLCBmdW5jdGlvbihhcmNEZXNjTm8sIGFyY0Rlc2NJdGVyKSB7XG4gICAgICAgICAgICAgICAgaWYgKGFyY0Rlc2NJdGVyLnR5cGUgPT0gbm9OdW1BcmNUeXBlKSB7XG4gICAgICAgICAgICAgICAgICBhcmNEZXNjID0gYXJjRGVzY0l0ZXI7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICB9XG4gICAgICAgICAgLy8gZmFsbCBiYWNrIG9uIHJlbGF0aW9uIHR5cGVzIGluIGNhc2Ugd2Ugc3RpbGwgZG9uJ3QgaGF2ZVxuICAgICAgICAgIC8vIGFuIGFyYyBkZXNjcmlwdGlvbiwgd2l0aCBmaW5hbCBmYWxsYmFjayB0byB1bm51bWJlcmVkIHJlbGF0aW9uXG4gICAgICAgICAgaWYgKCFhcmNEZXNjKSB7XG4gICAgICAgICAgICBhcmNEZXNjID0gJC5leHRlbmQoe30sIHJlbGF0aW9uVHlwZXNIYXNoW2FyYy50eXBlXSB8fCByZWxhdGlvblR5cGVzSGFzaFtub051bUFyY1R5cGVdKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgdmFyIGNvbG9yID0gKChhcmNEZXNjICYmIGFyY0Rlc2MuY29sb3IpIHx8XG4gICAgICAgICAgICAgICAgICAgICAgIChzcGFuVHlwZXMuQVJDX0RFRkFVTFQgJiYgc3BhblR5cGVzLkFSQ19ERUZBVUxULmNvbG9yKSB8fFxuICAgICAgICAgICAgICAgICAgICAgICAnIzAwMDAwMCcpO1xuICAgICAgICAgIHZhciBzeW1tZXRyaWMgPSBhcmNEZXNjICYmIGFyY0Rlc2MucHJvcGVydGllcyAmJiBhcmNEZXNjLnByb3BlcnRpZXMuc3ltbWV0cmljO1xuICAgICAgICAgIHZhciBkYXNoQXJyYXkgPSBhcmNEZXNjICYmIGFyY0Rlc2MuZGFzaEFycmF5O1xuICAgICAgICAgIHZhciBhcnJvd0hlYWQgPSAoKGFyY0Rlc2MgJiYgYXJjRGVzYy5hcnJvd0hlYWQpIHx8XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAoc3BhblR5cGVzLkFSQ19ERUZBVUxUICYmIHNwYW5UeXBlcy5BUkNfREVGQVVMVC5hcnJvd0hlYWQpIHx8XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAndHJpYW5nbGUsNScpICsgJywnICsgY29sb3I7XG4gICAgICAgICAgdmFyIGxhYmVsQXJyb3dIZWFkID0gKChhcmNEZXNjICYmIGFyY0Rlc2MubGFiZWxBcnJvdykgfHxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKHNwYW5UeXBlcy5BUkNfREVGQVVMVCAmJiBzcGFuVHlwZXMuQVJDX0RFRkFVTFQubGFiZWxBcnJvdykgfHxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3RyaWFuZ2xlLDUnKSArICcsJyArIGNvbG9yO1xuXG4gICAgICAgICAgdmFyIGxlZnRCb3ggPSByb3dCQm94KGxlZnQpO1xuICAgICAgICAgIHZhciByaWdodEJveCA9IHJvd0JCb3gocmlnaHQpO1xuICAgICAgICAgIHZhciBsZWZ0Um93ID0gbGVmdC5jaHVuay5yb3cuaW5kZXg7XG4gICAgICAgICAgdmFyIHJpZ2h0Um93ID0gcmlnaHQuY2h1bmsucm93LmluZGV4O1xuXG4gICAgICAgICAgaWYgKCFhcnJvd3NbYXJyb3dIZWFkXSkge1xuICAgICAgICAgICAgdmFyIGFycm93ID0gbWFrZUFycm93KGRlZnMsIGFycm93SGVhZCk7XG4gICAgICAgICAgICBpZiAoYXJyb3cpIGFycm93c1thcnJvd0hlYWRdID0gYXJyb3c7XG4gICAgICAgICAgfVxuICAgICAgICAgIGlmICghYXJyb3dzW2xhYmVsQXJyb3dIZWFkXSkge1xuICAgICAgICAgICAgdmFyIGFycm93ID0gbWFrZUFycm93KGRlZnMsIGxhYmVsQXJyb3dIZWFkKTtcbiAgICAgICAgICAgIGlmIChhcnJvdykgYXJyb3dzW2xhYmVsQXJyb3dIZWFkXSA9IGFycm93O1xuICAgICAgICAgIH1cblxuICAgICAgICAgIC8vIGZpbmQgdGhlIG5leHQgaGVpZ2h0XG4gICAgICAgICAgdmFyIGhlaWdodCA9IDA7XG5cbiAgICAgICAgICB2YXIgZnJvbUluZGV4MiwgdG9JbmRleDI7XG4gICAgICAgICAgaWYgKGxlZnQuY2h1bmsuaW5kZXggPT0gcmlnaHQuY2h1bmsuaW5kZXgpIHtcbiAgICAgICAgICAgIGZyb21JbmRleDIgPSBsZWZ0LnRvd2VySWQgKiAyO1xuICAgICAgICAgICAgdG9JbmRleDIgPSByaWdodC50b3dlcklkICogMjtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgZnJvbUluZGV4MiA9IGxlZnQudG93ZXJJZCAqIDIgKyAxO1xuICAgICAgICAgICAgdG9JbmRleDIgPSByaWdodC50b3dlcklkICogMiAtIDE7XG4gICAgICAgICAgfVxuICAgICAgICAgIGZvciAodmFyIGkgPSBmcm9tSW5kZXgyOyBpIDw9IHRvSW5kZXgyOyBpKyspIHtcbiAgICAgICAgICAgIGlmIChmcmFnbWVudEhlaWdodHNbaV0gPiBoZWlnaHQpIGhlaWdodCA9IGZyYWdtZW50SGVpZ2h0c1tpXTtcbiAgICAgICAgICB9XG4gICAgICAgICAgaGVpZ2h0ICs9IENvbmZpZ3VyYXRpb24udmlzdWFsLmFyY1NwYWNpbmc7XG4gICAgICAgICAgdmFyIGxlZnRTbGFudEJvdW5kLCByaWdodFNsYW50Qm91bmQ7XG4gICAgICAgICAgZm9yICh2YXIgaSA9IGZyb21JbmRleDI7IGkgPD0gdG9JbmRleDI7IGkrKykge1xuICAgICAgICAgICAgaWYgKGZyYWdtZW50SGVpZ2h0c1tpXSA8IGhlaWdodCkgZnJhZ21lbnRIZWlnaHRzW2ldID0gaGVpZ2h0O1xuICAgICAgICAgIH1cblxuICAgICAgICAgIC8vIEFkanVzdCB0aGUgaGVpZ2h0IHRvIGFsaWduIHdpdGggcGl4ZWxzIHdoZW4gcmVuZGVyZWRcblxuICAgICAgICAgIC8vIFRPRE86IG9uIGF0IGxlYXN0IENocm9tZSwgdGhpcyBkb2Vzbid0IG1ha2UgYSBkaWZmZXJlbmNlOlxuICAgICAgICAgIC8vIHRoZSBsaW5lcyBjb21lIG91dCBwaXhlbC13aWR0aCBldmVuIHdpdGhvdXQgaXQuIENoZWNrLlxuICAgICAgICAgIGhlaWdodCArPSAwLjVcblxuICAgICAgICAgIHZhciBjaHVua1JldmVyc2UgPSBmYWxzZTtcbiAgICAgICAgICB2YXIgdWZvQ2F0Y2hlciA9IG9yaWdpblNwYW4uaGVhZEZyYWdtZW50LmNodW5rLmluZGV4ID09IHRhcmdldFNwYW4uaGVhZEZyYWdtZW50LmNodW5rLmluZGV4O1xuICAgICAgICAgIGlmICh1Zm9DYXRjaGVyKSB7XG4gICAgICAgICAgICBjaHVua1JldmVyc2UgPVxuICAgICAgICAgICAgICBsZWZ0Qm94LnggKyBsZWZ0Qm94LndpZHRoIC8gMiA8IHJpZ2h0Qm94LnggKyByaWdodEJveC53aWR0aCAvIDI7XG4gICAgICAgICAgfVxuICAgICAgICAgIHZhciB1Zm9DYXRjaGVyTW9kID0gdWZvQ2F0Y2hlciA/IGNodW5rUmV2ZXJzZSA/IC0wLjUgOiAwLjUgOiAxO1xuXG4gICAgICAgICAgZm9yICh2YXIgcm93SW5kZXggPSBsZWZ0Um93OyByb3dJbmRleCA8PSByaWdodFJvdzsgcm93SW5kZXgrKykge1xuICAgICAgICAgICAgdmFyIHJvdyA9IHJvd3Nbcm93SW5kZXhdO1xuICAgICAgICAgICAgcm93Lmhhc0Fubm90YXRpb25zID0gdHJ1ZTtcbiAgICAgICAgICAgIHZhciBhcmNHcm91cCA9IHN2Zy5ncm91cChyb3cuYXJjcywge1xuICAgICAgICAgICAgICAgICdkYXRhLWZyb20nOiBhcmMub3JpZ2luLFxuICAgICAgICAgICAgICAgICdkYXRhLXRvJzogYXJjLnRhcmdldFxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB2YXIgZnJvbSwgdG87XG5cbiAgICAgICAgICAgIGlmIChyb3dJbmRleCA9PSBsZWZ0Um93KSB7XG4gICAgICAgICAgICAgIGZyb20gPSBsZWZ0Qm94LnggKyAoY2h1bmtSZXZlcnNlID8gMCA6IGxlZnRCb3gud2lkdGgpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgZnJvbSA9IHNlbnROdW1NYXJnaW47XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmIChyb3dJbmRleCA9PSByaWdodFJvdykge1xuICAgICAgICAgICAgICB0byA9IHJpZ2h0Qm94LnggKyAoY2h1bmtSZXZlcnNlID8gcmlnaHRCb3gud2lkdGggOiAwKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgIHRvID0gY2FudmFzV2lkdGggLSAyICogQ29uZmlndXJhdGlvbi52aXN1YWwubWFyZ2luLnk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHZhciBvcmlnaW5UeXBlID0gZGF0YS5zcGFuc1thcmMub3JpZ2luXS50eXBlO1xuICAgICAgICAgICAgdmFyIGFyY0xhYmVscyA9IFV0aWwuZ2V0QXJjTGFiZWxzKHNwYW5UeXBlcywgb3JpZ2luVHlwZSwgYXJjLnR5cGUsIHJlbGF0aW9uVHlwZXNIYXNoKTtcbiAgICAgICAgICAgIHZhciBsYWJlbFRleHQgPSBVdGlsLmFyY0Rpc3BsYXlGb3JtKHNwYW5UeXBlcywgb3JpZ2luVHlwZSwgYXJjLnR5cGUsIHJlbGF0aW9uVHlwZXNIYXNoKTtcbiAgICAgICAgICAgIC8vIGlmIChDb25maWd1cmF0aW9uLmFiYnJldnNPbiAmJiAhdWZvQ2F0Y2hlciAmJiBhcmNMYWJlbHMpIHtcbiAgICAgICAgICAgIGlmIChDb25maWd1cmF0aW9uLmFiYnJldnNPbiAmJiBhcmNMYWJlbHMpIHtcbiAgICAgICAgICAgICAgdmFyIGxhYmVsSWR4ID0gMTsgLy8gZmlyc3QgYWJicmV2aWF0aW9uXG4gICAgICAgICAgICAgIC8vIHN0cmljdGx5IHNwZWFraW5nIDIqYXJjU2xhbnQgd291bGQgYmUgbmVlZGVkIHRvIGFsbG93IGZvclxuICAgICAgICAgICAgICAvLyB0aGUgZnVsbC13aWR0aCBhcmNzIHRvIGZpdCwgYnV0IGp1ZGdlZCB1bmFiYnJldmlhdGVkIHRleHRcbiAgICAgICAgICAgICAgLy8gdG8gYmUgbW9yZSBpbXBvcnRhbnQgdGhhbiB0aGUgc3BhY2UgZm9yIGFyY3MuXG4gICAgICAgICAgICAgIHZhciBtYXhMZW5ndGggPSAodG8gLSBmcm9tKSAtIChhcmNTbGFudCk7XG4gICAgICAgICAgICAgIHdoaWxlIChzaXplcy5hcmNzLndpZHRoc1tsYWJlbFRleHRdID4gbWF4TGVuZ3RoICYmXG4gICAgICAgICAgICAgICAgICAgICBhcmNMYWJlbHNbbGFiZWxJZHhdKSB7XG4gICAgICAgICAgICAgICAgbGFiZWxUZXh0ID0gYXJjTGFiZWxzW2xhYmVsSWR4XTtcbiAgICAgICAgICAgICAgICBsYWJlbElkeCsrO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHZhciBzaGFkb3dHcm91cDtcbiAgICAgICAgICAgIGlmIChhcmMuc2hhZG93Q2xhc3MgfHwgYXJjLm1hcmtlZCkge1xuICAgICAgICAgICAgICBzaGFkb3dHcm91cCA9IHN2Zy5ncm91cChhcmNHcm91cCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB2YXIgb3B0aW9ucyA9IHtcbiAgICAgICAgICAgICAgJ2ZpbGwnOiBjb2xvcixcbiAgICAgICAgICAgICAgJ2RhdGEtYXJjLXJvbGUnOiBhcmMudHlwZSxcbiAgICAgICAgICAgICAgJ2RhdGEtYXJjLW9yaWdpbic6IGFyYy5vcmlnaW4sXG4gICAgICAgICAgICAgICdkYXRhLWFyYy10YXJnZXQnOiBhcmMudGFyZ2V0LFxuICAgICAgICAgICAgICAvLyBUT0RPOiBjb25maXJtIHRoaXMgaXMgdW51c2VkIGFuZCByZW1vdmUuXG4gICAgICAgICAgICAgIC8vJ2RhdGEtYXJjLWlkJzogYXJjLmlkLFxuICAgICAgICAgICAgICAnZGF0YS1hcmMtZWQnOiBhcmMuZXZlbnREZXNjSWQsXG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAvLyBjb25zdHJ1Y3QgU1ZHIHRleHQsIHNob3dpbmcgcG9zc2libGUgdHJhaWxpbmcgaW5kZXhcbiAgICAgICAgICAgIC8vIG51bWJlcnMgKGFzIGluIGUuZy4gXCJUaGVtZTJcIikgYXMgc3Vic2NyaXB0c1xuICAgICAgICAgICAgdmFyIHN2Z1RleHQ7XG4gICAgICAgICAgICBpZiAoIXNwbGl0QXJjVHlwZVsyXSkge1xuICAgICAgICAgICAgICAgIC8vIG5vIHN1YnNjcmlwdCwgc2ltcGxlIHN0cmluZyBzdWZmaWNlc1xuICAgICAgICAgICAgICAgIHN2Z1RleHQgPSBsYWJlbFRleHQ7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIC8vIE5lZWQgdG8gcGFyc2Ugb3V0IHBvc3NpYmxlIG51bWVyaWMgc3VmZml4ZXMgdG8gYXZvaWRcbiAgICAgICAgICAgICAgICAvLyBkdXBsaWNhdGluZyBudW1iZXIgaW4gbGFiZWwgYW5kIGl0cyBzdWJzY3JpcHRcbiAgICAgICAgICAgICAgICB2YXIgc3BsaXRMYWJlbFRleHQgPSBsYWJlbFRleHQubWF0Y2goL14oLio/KShcXGQqKSQvKTtcbiAgICAgICAgICAgICAgICB2YXIgbm9OdW1MYWJlbFRleHQgPSBzcGxpdExhYmVsVGV4dFsxXTtcblxuICAgICAgICAgICAgICAgIHN2Z1RleHQgPSBzdmcuY3JlYXRlVGV4dCgpO1xuICAgICAgICAgICAgICAgIC8vIFRPRE86IHRvIGFkZHJlc3MgaXNzdWUgIzQ1MywgYXR0YWNoaW5nIG9wdGlvbnMgYWxzb1xuICAgICAgICAgICAgICAgIC8vIHRvIHNwYW5zLCBub3Qgb25seSBwcmltYXJ5IHRleHQuIE1ha2Ugc3VyZSB0aGVyZVxuICAgICAgICAgICAgICAgIC8vIGFyZSBubyBwcm9ibGVtcyB3aXRoIHRoaXMuXG4gICAgICAgICAgICAgICAgc3ZnVGV4dC5zcGFuKG5vTnVtTGFiZWxUZXh0LCBvcHRpb25zKTtcbiAgICAgICAgICAgICAgICB2YXIgc3Vic2NyaXB0U2V0dGluZ3MgPSB7XG4gICAgICAgICAgICAgICAgICAnZHknOiAnMC4zZW0nLFxuICAgICAgICAgICAgICAgICAgJ2ZvbnQtc2l6ZSc6ICc4MCUnXG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICAvLyBhbHRlcm5hdGUgcG9zc2liaWxpdHlcbi8vICAgICAgICAgICAgICAgICB2YXIgc3Vic2NyaXB0U2V0dGluZ3MgPSB7XG4vLyAgICAgICAgICAgICAgICAgICAnYmFzZWxpbmUtc2hpZnQnOiAnc3ViJyxcbi8vICAgICAgICAgICAgICAgICAgICdmb250LXNpemUnOiAnODAlJ1xuLy8gICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgJC5leHRlbmQoc3Vic2NyaXB0U2V0dGluZ3MsIG9wdGlvbnMpO1xuICAgICAgICAgICAgICAgIHN2Z1RleHQuc3BhbihzcGxpdEFyY1R5cGVbMl0sIHN1YnNjcmlwdFNldHRpbmdzKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gZ3Vlc3MgYXQgdGhlIGNvcnJlY3QgYmFzZWxpbmUgc2hpZnQgdG8gZ2V0IHZlcnRpY2FsIGNlbnRlcmluZy5cbiAgICAgICAgICAgIC8vIChDU1MgZG9taW5hbnQtYmFzZWxpbmUgY2FuJ3QgYmUgdXNlZCBhcyBub3QgYWxsIFNWRyByZW5kZXJlZHMgc3VwcG9ydCBpdC4pXG4gICAgICAgICAgICB2YXIgYmFzZWxpbmVfc2hpZnQgPSBzaXplcy5hcmNzLmhlaWdodCAvIDQ7XG4gICAgICAgICAgICB2YXIgdGV4dCA9IHN2Zy50ZXh0KGFyY0dyb3VwLCAoZnJvbSArIHRvKSAvIDIsIC1oZWlnaHQgKyBiYXNlbGluZV9zaGlmdCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3ZnVGV4dCwgb3B0aW9ucyk7XG5cbiAgICAgICAgICAgIHZhciB3aWR0aCA9IHNpemVzLmFyY3Mud2lkdGhzW2xhYmVsVGV4dF07XG4gICAgICAgICAgICB2YXIgdGV4dEJveCA9IHtcbiAgICAgICAgICAgICAgeDogKGZyb20gKyB0byAtIHdpZHRoKSAvIDIsXG4gICAgICAgICAgICAgIHdpZHRoOiB3aWR0aCxcbiAgICAgICAgICAgICAgeTogLWhlaWdodCAtIHNpemVzLmFyY3MuaGVpZ2h0IC8gMixcbiAgICAgICAgICAgICAgaGVpZ2h0OiBzaXplcy5hcmNzLmhlaWdodCxcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChhcmMubWFya2VkKSB7XG4gICAgICAgICAgICAgIHZhciBtYXJrZWRSZWN0ID0gc3ZnLnJlY3Qoc2hhZG93R3JvdXAsXG4gICAgICAgICAgICAgICAgICB0ZXh0Qm94LnggLSBtYXJrZWRBcmNTaXplLCB0ZXh0Qm94LnkgLSBtYXJrZWRBcmNTaXplLFxuICAgICAgICAgICAgICAgICAgdGV4dEJveC53aWR0aCArIDIgKiBtYXJrZWRBcmNTaXplLCB0ZXh0Qm94LmhlaWdodCArIDIgKiBtYXJrZWRBcmNTaXplLCB7XG4gICAgICAgICAgICAgICAgICAgIC8vIGZpbHRlcjogJ3VybCgjR2F1c3NpYW5fQmx1ciknLFxuICAgICAgICAgICAgICAgICAgICAnY2xhc3MnOiBcInNoYWRvd19FZGl0SGlnaGxpZ2h0XCIsXG4gICAgICAgICAgICAgICAgICAgIHJ4OiBtYXJrZWRBcmNTaXplLFxuICAgICAgICAgICAgICAgICAgICByeTogbWFya2VkQXJjU2l6ZSxcbiAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgIHN2Zy5vdGhlcihtYXJrZWRSZWN0LCAnYW5pbWF0ZScsIHtcbiAgICAgICAgICAgICAgICAnZGF0YS10eXBlJzogYXJjLm1hcmtlZCxcbiAgICAgICAgICAgICAgICBhdHRyaWJ1dGVOYW1lOiAnZmlsbCcsXG4gICAgICAgICAgICAgICAgdmFsdWVzOiAoYXJjLm1hcmtlZCA9PSAnbWF0Y2gnID8gaGlnaGxpZ2h0TWF0Y2hTZXF1ZW5jZVxuICAgICAgICAgICAgICAgICAgICAgICAgIDogaGlnaGxpZ2h0QXJjU2VxdWVuY2UpLFxuICAgICAgICAgICAgICAgIGR1cjogaGlnaGxpZ2h0RHVyYXRpb24sXG4gICAgICAgICAgICAgICAgcmVwZWF0Q291bnQ6ICdpbmRlZmluaXRlJyxcbiAgICAgICAgICAgICAgICBiZWdpbjogJ2luZGVmaW5pdGUnXG4gICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGFyYy5zaGFkb3dDbGFzcykge1xuICAgICAgICAgICAgICBzdmcucmVjdChzaGFkb3dHcm91cCxcbiAgICAgICAgICAgICAgICAgIHRleHRCb3gueCAtIGFyY0xhYmVsU2hhZG93U2l6ZSxcbiAgICAgICAgICAgICAgICAgIHRleHRCb3gueSAtIGFyY0xhYmVsU2hhZG93U2l6ZSxcbiAgICAgICAgICAgICAgICAgIHRleHRCb3gud2lkdGggICsgMiAqIGFyY0xhYmVsU2hhZG93U2l6ZSxcbiAgICAgICAgICAgICAgICAgIHRleHRCb3guaGVpZ2h0ICsgMiAqIGFyY0xhYmVsU2hhZG93U2l6ZSwge1xuICAgICAgICAgICAgICAgICAgICAnY2xhc3MnOiAnc2hhZG93XycgKyBhcmMuc2hhZG93Q2xhc3MsXG4gICAgICAgICAgICAgICAgICAgIGZpbHRlcjogJ3VybCgjR2F1c3NpYW5fQmx1ciknLFxuICAgICAgICAgICAgICAgICAgICByeDogYXJjTGFiZWxTaGFkb3dSb3VuZGluZyxcbiAgICAgICAgICAgICAgICAgICAgcnk6IGFyY0xhYmVsU2hhZG93Um91bmRpbmcsXG4gICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdmFyIHRleHRTdGFydCA9IHRleHRCb3gueDtcbiAgICAgICAgICAgIHZhciB0ZXh0RW5kID0gdGV4dEJveC54ICsgdGV4dEJveC53aWR0aDtcblxuICAgICAgICAgICAgLy8gYWRqdXN0IGJ5IG1hcmdpbiBmb3IgYXJjIGRyYXdpbmdcbiAgICAgICAgICAgIHRleHRTdGFydCAtPSBDb25maWd1cmF0aW9uLnZpc3VhbC5hcmNUZXh0TWFyZ2luO1xuICAgICAgICAgICAgdGV4dEVuZCArPSBDb25maWd1cmF0aW9uLnZpc3VhbC5hcmNUZXh0TWFyZ2luO1xuXG4gICAgICAgICAgICBpZiAoZnJvbSA+IHRvKSB7XG4gICAgICAgICAgICAgIHZhciB0bXAgPSB0ZXh0U3RhcnQ7IHRleHRTdGFydCA9IHRleHRFbmQ7IHRleHRFbmQgPSB0bXA7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHZhciBwYXRoO1xuXG4gICAgICAgICAgICBpZiAocm91bmRDb29yZGluYXRlcykge1xuICAgICAgICAgICAgICAvLyBkb24ndCBhc2tcbiAgICAgICAgICAgICAgaGVpZ2h0ID0gKGhlaWdodHwwKSswLjU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoaGVpZ2h0ID4gcm93Lm1heEFyY0hlaWdodCkgcm93Lm1heEFyY0hlaWdodCA9IGhlaWdodDtcblxuICAgICAgICAgICAgdmFyIG15QXJyb3dIZWFkICAgPSAoKGFyY0Rlc2MgJiYgYXJjRGVzYy5hcnJvd0hlYWQpIHx8XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAoc3BhblR5cGVzLkFSQ19ERUZBVUxUICYmIHNwYW5UeXBlcy5BUkNfREVGQVVMVC5hcnJvd0hlYWQpKTtcbiAgICAgICAgICAgIHZhciBhcnJvd05hbWUgPSAobGVmdFRvUmlnaHQgP1xuICAgICAgICAgICAgICAgIHN5bW1ldHJpYyAmJiBteUFycm93SGVhZCB8fCAnbm9uZScgOlxuICAgICAgICAgICAgICAgIG15QXJyb3dIZWFkIHx8ICd0cmlhbmdsZSw1JykgKyAnLCcgKyBjb2xvcjtcbiAgICAgICAgICAgIHZhciBhcnJvd1R5cGUgPSBhcnJvd3NbYXJyb3dOYW1lXTtcbiAgICAgICAgICAgIHZhciBhcnJvd0RlY2wgPSBhcnJvd1R5cGUgJiYgKCd1cmwoIycgKyBhcnJvd1R5cGUgKyAnKScpO1xuXG4gICAgICAgICAgICB2YXIgYXJyb3dBdExhYmVsQWRqdXN0ID0gMDtcbiAgICAgICAgICAgIHZhciBsYWJlbEFycm93RGVjbCA9IG51bGw7XG4gICAgICAgICAgICB2YXIgbXlMYWJlbEFycm93SGVhZCA9ICgoYXJjRGVzYyAmJiBhcmNEZXNjLmxhYmVsQXJyb3cpIHx8XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAoc3BhblR5cGVzLkFSQ19ERUZBVUxUICYmIHNwYW5UeXBlcy5BUkNfREVGQVVMVC5sYWJlbEFycm93KSk7XG4gICAgICAgICAgICBpZiAobXlMYWJlbEFycm93SGVhZCkge1xuICAgICAgICAgICAgICB2YXIgbGFiZWxBcnJvd05hbWUgPSAobGVmdFRvUmlnaHQgP1xuICAgICAgICAgICAgICAgICAgc3ltbWV0cmljICYmIG15TGFiZWxBcnJvd0hlYWQgfHwgJ25vbmUnIDpcbiAgICAgICAgICAgICAgICAgIG15TGFiZWxBcnJvd0hlYWQgfHwgJ3RyaWFuZ2xlLDUnKSArICcsJyArIGNvbG9yO1xuICAgICAgICAgICAgICB2YXIgbGFiZWxBcnJvd1NwbGl0ID0gbGFiZWxBcnJvd05hbWUuc3BsaXQoJywnKTtcbiAgICAgICAgICAgICAgYXJyb3dBdExhYmVsQWRqdXN0ID0gbGFiZWxBcnJvd1NwbGl0WzBdICE9ICdub25lJyAmJiBwYXJzZUludChsYWJlbEFycm93U3BsaXRbMV0sIDEwKSB8fCAwO1xuICAgICAgICAgICAgICB2YXIgbGFiZWxBcnJvd1R5cGUgPSBhcnJvd3NbbGFiZWxBcnJvd05hbWVdO1xuICAgICAgICAgICAgICB2YXIgbGFiZWxBcnJvd0RlY2wgPSBsYWJlbEFycm93VHlwZSAmJiAoJ3VybCgjJyArIGxhYmVsQXJyb3dUeXBlICsgJyknKTtcbiAgICAgICAgICAgICAgaWYgKHVmb0NhdGNoZXIpIGFycm93QXRMYWJlbEFkanVzdCA9IC1hcnJvd0F0TGFiZWxBZGp1c3Q7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB2YXIgYXJyb3dTdGFydCA9IHRleHRTdGFydCAtIGFycm93QXRMYWJlbEFkanVzdDtcbiAgICAgICAgICAgIHBhdGggPSBzdmcuY3JlYXRlUGF0aCgpLm1vdmUoYXJyb3dTdGFydCwgLWhlaWdodCk7XG4gICAgICAgICAgICBpZiAocm93SW5kZXggPT0gbGVmdFJvdykge1xuICAgICAgICAgICAgICB2YXIgY29ybmVyeCA9IGZyb20gKyB1Zm9DYXRjaGVyTW9kICogYXJjU2xhbnQ7XG4gICAgICAgICAgICAgIC8vIGZvciBub3JtYWwgY2FzZXMsIHNob3VsZCBub3QgYmUgcGFzdCB0ZXh0U3RhcnQgZXZlbiBpZiBuYXJyb3dcbiAgICAgICAgICAgICAgaWYgKCF1Zm9DYXRjaGVyICYmIGNvcm5lcnggPiBhcnJvd1N0YXJ0IC0gMSkgeyBjb3JuZXJ4ID0gYXJyb3dTdGFydCAtIDE7IH1cbiAgICAgICAgICAgICAgaWYgKHNtb290aEFyY0N1cnZlcykge1xuICAgICAgICAgICAgICAgIHZhciBjb250cm9seCA9IHVmb0NhdGNoZXIgPyBjb3JuZXJ4ICsgMip1Zm9DYXRjaGVyTW9kKnJldmVyc2VBcmNDb250cm9seCA6IHNtb290aEFyY1N0ZWVwbmVzcypmcm9tKygxLXNtb290aEFyY1N0ZWVwbmVzcykqY29ybmVyeDtcbiAgICAgICAgICAgICAgICB2YXIgZW5keSA9IGxlZnRCb3gueSArIChsZWZ0VG9SaWdodCB8fCBhcmMuZXF1aXYgPyBsZWZ0Qm94LmhlaWdodCAvIDIgOiBDb25maWd1cmF0aW9uLnZpc3VhbC5tYXJnaW4ueSk7XG4gICAgICAgICAgICAgICAgLy8gbm8gY3VydmluZyBmb3Igc2hvcnQgbGluZXMgY292ZXJpbmcgc2hvcnQgdmVydGljYWxcbiAgICAgICAgICAgICAgICAvLyBkaXN0YW5jZXMsIHRoZSBhcnJvd2hlYWRzIGNhbiBnbyBvZmYgKCM5MjUpXG4gICAgICAgICAgICAgICAgaWYgKE1hdGguYWJzKC1oZWlnaHQtZW5keSkgPCAyICYmXG4gICAgICAgICAgICAgICAgICAgIE1hdGguYWJzKGNvcm5lcngtZnJvbSkgPCA1KSB7XG4gICAgICAgICAgICAgICAgICBlbmR5ID0gLWhlaWdodDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgbGluZSA9IHBhdGgubGluZShjb3JuZXJ4LCAtaGVpZ2h0KS5cbiAgICAgICAgICAgICAgICAgICAgY3VydmVRKGNvbnRyb2x4LCAtaGVpZ2h0LCBmcm9tLCBlbmR5KTtcbiAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBwYXRoLmxpbmUoY29ybmVyeCwgLWhlaWdodCkuXG4gICAgICAgICAgICAgICAgICAgIGxpbmUoZnJvbSwgbGVmdEJveC55ICsgKGxlZnRUb1JpZ2h0IHx8IGFyYy5lcXVpdiA/IGxlZnRCb3guaGVpZ2h0IC8gMiA6IENvbmZpZ3VyYXRpb24udmlzdWFsLm1hcmdpbi55KSk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgIHBhdGgubGluZShmcm9tLCAtaGVpZ2h0KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHN2Zy5wYXRoKGFyY0dyb3VwLCBwYXRoLCB7XG4gICAgICAgICAgICAgICAgbWFya2VyRW5kOiBhcnJvd0RlY2wsXG4gICAgICAgICAgICAgICAgbWFya2VyU3RhcnQ6IGxhYmVsQXJyb3dEZWNsLFxuICAgICAgICAgICAgICAgIHN0eWxlOiAnc3Ryb2tlOiAnICsgY29sb3IsXG4gICAgICAgICAgICAgICAgJ3N0cm9rZURhc2hBcnJheSc6IGRhc2hBcnJheSxcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgaWYgKGFyYy5tYXJrZWQpIHtcbiAgICAgICAgICAgICAgc3ZnLnBhdGgoc2hhZG93R3JvdXAsIHBhdGgsIHtcbiAgICAgICAgICAgICAgICAgICdjbGFzcyc6ICdzaGFkb3dfRWRpdEhpZ2hsaWdodF9hcmMnLFxuICAgICAgICAgICAgICAgICAgc3Ryb2tlV2lkdGg6IG1hcmtlZEFyY1N0cm9rZSxcbiAgICAgICAgICAgICAgICAgICdzdHJva2VEYXNoQXJyYXknOiBkYXNoQXJyYXksXG4gICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICBzdmcub3RoZXIobWFya2VkUmVjdCwgJ2FuaW1hdGUnLCB7XG4gICAgICAgICAgICAgICAgJ2RhdGEtdHlwZSc6IGFyYy5tYXJrZWQsXG4gICAgICAgICAgICAgICAgYXR0cmlidXRlTmFtZTogJ2ZpbGwnLFxuICAgICAgICAgICAgICAgIHZhbHVlczogKGFyYy5tYXJrZWQgPT0gJ21hdGNoJyA/IGhpZ2hsaWdodE1hdGNoU2VxdWVuY2VcbiAgICAgICAgICAgICAgICAgICAgICAgICA6IGhpZ2hsaWdodEFyY1NlcXVlbmNlKSxcbiAgICAgICAgICAgICAgICBkdXI6IGhpZ2hsaWdodER1cmF0aW9uLFxuICAgICAgICAgICAgICAgIHJlcGVhdENvdW50OiAnaW5kZWZpbml0ZScsXG4gICAgICAgICAgICAgICAgYmVnaW46ICdpbmRlZmluaXRlJ1xuICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChhcmMuc2hhZG93Q2xhc3MpIHtcbiAgICAgICAgICAgICAgc3ZnLnBhdGgoc2hhZG93R3JvdXAsIHBhdGgsIHtcbiAgICAgICAgICAgICAgICAgICdjbGFzcyc6ICdzaGFkb3dfJyArIGFyYy5zaGFkb3dDbGFzcyxcbiAgICAgICAgICAgICAgICAgIHN0cm9rZVdpZHRoOiBzaGFkb3dTdHJva2UsXG4gICAgICAgICAgICAgICAgICAnc3Ryb2tlRGFzaEFycmF5JzogZGFzaEFycmF5LFxuICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHZhciBteUFycm93SGVhZCA9ICgoYXJjRGVzYyAmJiBhcmNEZXNjLmFycm93SGVhZCkgfHxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAoc3BhblR5cGVzLkFSQ19ERUZBVUxUICYmIHNwYW5UeXBlcy5BUkNfREVGQVVMVC5hcnJvd0hlYWQpKTtcbiAgICAgICAgICAgIHZhciBhcnJvd05hbWUgPSAobGVmdFRvUmlnaHQgP1xuICAgICAgICAgICAgICAgIG15QXJyb3dIZWFkIHx8ICd0cmlhbmdsZSw1JyA6XG4gICAgICAgICAgICAgICAgc3ltbWV0cmljICYmIG15QXJyb3dIZWFkIHx8ICdub25lJykgKyAnLCcgKyBjb2xvcjtcbiAgICAgICAgICAgIHZhciBhcnJvd1R5cGUgPSBhcnJvd3NbYXJyb3dOYW1lXTtcbiAgICAgICAgICAgIHZhciBhcnJvd0RlY2wgPSBhcnJvd1R5cGUgJiYgKCd1cmwoIycgKyBhcnJvd1R5cGUgKyAnKScpO1xuXG4gICAgICAgICAgICB2YXIgYXJyb3dBdExhYmVsQWRqdXN0ID0gMDtcbiAgICAgICAgICAgIHZhciBsYWJlbEFycm93RGVjbCA9IG51bGw7XG4gICAgICAgICAgICB2YXIgbXlMYWJlbEFycm93SGVhZCA9ICgoYXJjRGVzYyAmJiBhcmNEZXNjLmxhYmVsQXJyb3cpIHx8XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAoc3BhblR5cGVzLkFSQ19ERUZBVUxUICYmIHNwYW5UeXBlcy5BUkNfREVGQVVMVC5sYWJlbEFycm93KSk7XG4gICAgICAgICAgICBpZiAobXlMYWJlbEFycm93SGVhZCkge1xuICAgICAgICAgICAgICB2YXIgbGFiZWxBcnJvd05hbWUgPSAobGVmdFRvUmlnaHQgP1xuICAgICAgICAgICAgICAgICAgbXlMYWJlbEFycm93SGVhZCB8fCAndHJpYW5nbGUsNScgOlxuICAgICAgICAgICAgICAgICAgc3ltbWV0cmljICYmIG15TGFiZWxBcnJvd0hlYWQgfHwgJ25vbmUnKSArICcsJyArIGNvbG9yO1xuICAgICAgICAgICAgICB2YXIgbGFiZWxBcnJvd1NwbGl0ID0gbGFiZWxBcnJvd05hbWUuc3BsaXQoJywnKTtcbiAgICAgICAgICAgICAgYXJyb3dBdExhYmVsQWRqdXN0ID0gbGFiZWxBcnJvd1NwbGl0WzBdICE9ICdub25lJyAmJiBwYXJzZUludChsYWJlbEFycm93U3BsaXRbMV0sIDEwKSB8fCAwO1xuICAgICAgICAgICAgICB2YXIgbGFiZWxBcnJvd1R5cGUgPSBhcnJvd3NbbGFiZWxBcnJvd05hbWVdO1xuICAgICAgICAgICAgICB2YXIgbGFiZWxBcnJvd0RlY2wgPSBsYWJlbEFycm93VHlwZSAmJiAoJ3VybCgjJyArIGxhYmVsQXJyb3dUeXBlICsgJyknKTtcbiAgICAgICAgICAgICAgaWYgKHVmb0NhdGNoZXIpIGFycm93QXRMYWJlbEFkanVzdCA9IC1hcnJvd0F0TGFiZWxBZGp1c3Q7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB2YXIgYXJyb3dFbmQgPSB0ZXh0RW5kICsgYXJyb3dBdExhYmVsQWRqdXN0O1xuICAgICAgICAgICAgcGF0aCA9IHN2Zy5jcmVhdGVQYXRoKCkubW92ZShhcnJvd0VuZCwgLWhlaWdodCk7XG4gICAgICAgICAgICBpZiAocm93SW5kZXggPT0gcmlnaHRSb3cpIHtcbiAgICAgICAgICAgICAgdmFyIGNvcm5lcnggID0gdG8gLSB1Zm9DYXRjaGVyTW9kICogYXJjU2xhbnQ7XG4gICAgICAgICAgICAgIC8vIFRPRE86IGR1cGxpY2F0ZXMgYWJvdmUgaW4gcGFydCwgbWFrZSBmdW5jc1xuICAgICAgICAgICAgICAvLyBmb3Igbm9ybWFsIGNhc2VzLCBzaG91bGQgbm90IGJlIHBhc3QgdGV4dEVuZCBldmVuIGlmIG5hcnJvd1xuICAgICAgICAgICAgICBpZiAoIXVmb0NhdGNoZXIgJiYgY29ybmVyeCA8IGFycm93RW5kICsgMSkgeyBjb3JuZXJ4ID0gYXJyb3dFbmQgKyAxOyB9XG4gICAgICAgICAgICAgIGlmIChzbW9vdGhBcmNDdXJ2ZXMpIHtcbiAgICAgICAgICAgICAgICB2YXIgY29udHJvbHggPSB1Zm9DYXRjaGVyID8gY29ybmVyeCAtIDIqdWZvQ2F0Y2hlck1vZCpyZXZlcnNlQXJjQ29udHJvbHggOiBzbW9vdGhBcmNTdGVlcG5lc3MqdG8rKDEtc21vb3RoQXJjU3RlZXBuZXNzKSpjb3JuZXJ4O1xuICAgICAgICAgICAgICAgIHZhciBlbmR5ID0gcmlnaHRCb3gueSArIChsZWZ0VG9SaWdodCAmJiAhYXJjLmVxdWl2ID8gQ29uZmlndXJhdGlvbi52aXN1YWwubWFyZ2luLnkgOiByaWdodEJveC5oZWlnaHQgLyAyKTtcbiAgICAgICAgICAgICAgICAvLyBubyBjdXJ2aW5nIGZvciBzaG9ydCBsaW5lcyBjb3ZlcmluZyBzaG9ydCB2ZXJ0aWNhbFxuICAgICAgICAgICAgICAgIC8vIGRpc3RhbmNlcywgdGhlIGFycm93aGVhZHMgY2FuIGdvIG9mZiAoIzkyNSlcbiAgICAgICAgICAgICAgICBpZiAoTWF0aC5hYnMoLWhlaWdodC1lbmR5KSA8IDIgJiZcbiAgICAgICAgICAgICAgICAgICAgTWF0aC5hYnMoY29ybmVyeC10bykgPCA1KSB7XG4gICAgICAgICAgICAgICAgICBlbmR5ID0gLWhlaWdodDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcGF0aC5saW5lKGNvcm5lcngsIC1oZWlnaHQpLlxuICAgICAgICAgICAgICAgICAgICBjdXJ2ZVEoY29udHJvbHgsIC1oZWlnaHQsIHRvLCBlbmR5KTtcbiAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBwYXRoLmxpbmUoY29ybmVyeCwgLWhlaWdodCkuXG4gICAgICAgICAgICAgICAgICAgIGxpbmUodG8sIHJpZ2h0Qm94LnkgKyAobGVmdFRvUmlnaHQgJiYgIWFyYy5lcXVpdiA/IENvbmZpZ3VyYXRpb24udmlzdWFsLm1hcmdpbi55IDogcmlnaHRCb3guaGVpZ2h0IC8gMikpO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICBwYXRoLmxpbmUodG8sIC1oZWlnaHQpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgc3ZnLnBhdGgoYXJjR3JvdXAsIHBhdGgsIHtcbiAgICAgICAgICAgICAgICBtYXJrZXJFbmQ6IGFycm93RGVjbCxcbiAgICAgICAgICAgICAgICBtYXJrZXJTdGFydDogbGFiZWxBcnJvd0RlY2wsXG4gICAgICAgICAgICAgICAgc3R5bGU6ICdzdHJva2U6ICcgKyBjb2xvcixcbiAgICAgICAgICAgICAgICAnc3Ryb2tlRGFzaEFycmF5JzogZGFzaEFycmF5LFxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBpZiAoYXJjLm1hcmtlZCkge1xuICAgICAgICAgICAgICBzdmcucGF0aChzaGFkb3dHcm91cCwgcGF0aCwge1xuICAgICAgICAgICAgICAgICAgJ2NsYXNzJzogJ3NoYWRvd19FZGl0SGlnaGxpZ2h0X2FyYycsXG4gICAgICAgICAgICAgICAgICBzdHJva2VXaWR0aDogbWFya2VkQXJjU3Ryb2tlLFxuICAgICAgICAgICAgICAgICAgJ3N0cm9rZURhc2hBcnJheSc6IGRhc2hBcnJheSxcbiAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoc2hhZG93R3JvdXApIHtcbiAgICAgICAgICAgICAgc3ZnLnBhdGgoc2hhZG93R3JvdXAsIHBhdGgsIHtcbiAgICAgICAgICAgICAgICAgICdjbGFzcyc6ICdzaGFkb3dfJyArIGFyYy5zaGFkb3dDbGFzcyxcbiAgICAgICAgICAgICAgICAgIHN0cm9rZVdpZHRoOiBzaGFkb3dTdHJva2UsXG4gICAgICAgICAgICAgICAgICAnc3Ryb2tlRGFzaEFycmF5JzogZGFzaEFycmF5LFxuICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9IC8vIGFyYyByb3dzXG4gICAgICAgIH0pOyAvLyBhcmNzXG5cblV0aWwucHJvZmlsZUVuZCgnYXJjcycpO1xuVXRpbC5wcm9maWxlU3RhcnQoJ2ZyYWdtZW50Q29ubmVjdG9ycycpO1xuXG4gICAgICAgICQuZWFjaChkYXRhLnNwYW5zLCBmdW5jdGlvbihzcGFuTm8sIHNwYW4pIHtcbiAgICAgICAgICB2YXIgbnVtQ29ubmVjdG9ycyA9IHNwYW4uZnJhZ21lbnRzLmxlbmd0aCAtIDE7XG4gICAgICAgICAgZm9yICh2YXIgY29ubmVjdG9yTm8gPSAwOyBjb25uZWN0b3JObyA8IG51bUNvbm5lY3RvcnM7IGNvbm5lY3Rvck5vKyspIHtcbiAgICAgICAgICAgIHZhciBsZWZ0ID0gc3Bhbi5mcmFnbWVudHNbY29ubmVjdG9yTm9dO1xuICAgICAgICAgICAgdmFyIHJpZ2h0ID0gc3Bhbi5mcmFnbWVudHNbY29ubmVjdG9yTm8gKyAxXTtcblxuICAgICAgICAgICAgdmFyIGxlZnRCb3ggPSByb3dCQm94KGxlZnQpO1xuICAgICAgICAgICAgdmFyIHJpZ2h0Qm94ID0gcm93QkJveChyaWdodCk7XG4gICAgICAgICAgICB2YXIgbGVmdFJvdyA9IGxlZnQuY2h1bmsucm93LmluZGV4O1xuICAgICAgICAgICAgdmFyIHJpZ2h0Um93ID0gcmlnaHQuY2h1bmsucm93LmluZGV4O1xuXG4gICAgICAgICAgICBmb3IgKHZhciByb3dJbmRleCA9IGxlZnRSb3c7IHJvd0luZGV4IDw9IHJpZ2h0Um93OyByb3dJbmRleCsrKSB7XG4gICAgICAgICAgICAgIHZhciByb3cgPSByb3dzW3Jvd0luZGV4XTtcbiAgICAgICAgICAgICAgcm93Lmhhc0Fubm90YXRpb25zID0gdHJ1ZTtcblxuICAgICAgICAgICAgICBpZiAocm93SW5kZXggPT0gbGVmdFJvdykge1xuICAgICAgICAgICAgICAgIGZyb20gPSBsZWZ0Qm94LnggKyBsZWZ0Qm94LndpZHRoO1xuICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGZyb20gPSBzZW50TnVtTWFyZ2luO1xuICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgaWYgKHJvd0luZGV4ID09IHJpZ2h0Um93KSB7XG4gICAgICAgICAgICAgICAgdG8gPSByaWdodEJveC54O1xuICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHRvID0gY2FudmFzV2lkdGggLSAyICogQ29uZmlndXJhdGlvbi52aXN1YWwubWFyZ2luLnk7XG4gICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICB2YXIgaGVpZ2h0ID0gbGVmdEJveC55ICsgbGVmdEJveC5oZWlnaHQgLSBDb25maWd1cmF0aW9uLnZpc3VhbC5tYXJnaW4ueTtcbiAgICAgICAgICAgICAgaWYgKHJvdW5kQ29vcmRpbmF0ZXMpIHtcbiAgICAgICAgICAgICAgICAvLyBkb24ndCBhc2tcbiAgICAgICAgICAgICAgICBoZWlnaHQgPSAoaGVpZ2h0fDApKzAuNTtcbiAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgIHZhciBwYXRoID0gc3ZnLmNyZWF0ZVBhdGgoKS5tb3ZlKGZyb20sIGhlaWdodCkubGluZSh0bywgaGVpZ2h0KTtcbiAgICAgICAgICAgICAgc3ZnLnBhdGgocm93LmFyY3MsIHBhdGgsIHtcbiAgICAgICAgICAgICAgICBzdHlsZTogJ3N0cm9rZTogJyArIGZyYWdtZW50Q29ubmVjdG9yQ29sb3IsXG4gICAgICAgICAgICAgICAgJ3N0cm9rZURhc2hBcnJheSc6IGZyYWdtZW50Q29ubmVjdG9yRGFzaEFycmF5XG4gICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSAvLyByb3dJbmRleFxuICAgICAgICAgIH0gLy8gY29ubmVjdG9yTm9cbiAgICAgICAgfSk7IC8vIHNwYW5zXG5cblV0aWwucHJvZmlsZUVuZCgnZnJhZ21lbnRDb25uZWN0b3JzJyk7XG5VdGlsLnByb2ZpbGVTdGFydCgncm93cycpO1xuXG4gICAgICAgIC8vIHBvc2l0aW9uIHRoZSByb3dzXG4gICAgICAgIHZhciB5ID0gQ29uZmlndXJhdGlvbi52aXN1YWwubWFyZ2luLnk7XG4gICAgICAgIHZhciBzZW50TnVtR3JvdXAgPSBzdmcuZ3JvdXAoeydjbGFzcyc6ICdzZW50bnVtJ30pO1xuICAgICAgICB2YXIgY3VycmVudFNlbnQ7XG4gICAgICAgICQuZWFjaChyb3dzLCBmdW5jdGlvbihyb3dJZCwgcm93KSB7XG4gICAgICAgICAgJC5lYWNoKHJvdy5jaHVua3MsIGZ1bmN0aW9uKGNodW5rSWQsIGNodW5rKSB7XG4gICAgICAgICAgICAkLmVhY2goY2h1bmsuZnJhZ21lbnRzLCBmdW5jdGlvbihmcmFnbWVudElkLCBmcmFnbWVudCkge1xuICAgICAgICAgICAgICBpZiAocm93Lm1heFNwYW5IZWlnaHQgPCBmcmFnbWVudC5oZWlnaHQpIHJvdy5tYXhTcGFuSGVpZ2h0ID0gZnJhZ21lbnQuaGVpZ2h0O1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfSk7XG4gICAgICAgICAgaWYgKHJvdy5zZW50ZW5jZSkge1xuICAgICAgICAgICAgY3VycmVudFNlbnQgPSByb3cuc2VudGVuY2U7XG4gICAgICAgICAgfVxuICAgICAgICAgIC8vIFNMT1cgKCM3MjQpIGFuZCByZXBsYWNlZCB3aXRoIGNhbGN1bGF0aW9uczpcbiAgICAgICAgICAvL1xuICAgICAgICAgIC8vIHZhciByb3dCb3ggPSByb3cuZ3JvdXAuZ2V0QkJveCgpO1xuICAgICAgICAgIC8vIC8vIE1ha2UgaXQgd29yayBvbiBJRVxuICAgICAgICAgIC8vIHJvd0JveCA9IHsgeDogcm93Qm94LngsIHk6IHJvd0JveC55LCBoZWlnaHQ6IHJvd0JveC5oZWlnaHQsIHdpZHRoOiByb3dCb3gud2lkdGggfTtcbiAgICAgICAgICAvLyAvLyBNYWtlIGl0IHdvcmsgb24gRmlyZWZveCBhbmQgT3BlcmFcbiAgICAgICAgICAvLyBpZiAocm93Qm94LmhlaWdodCA9PSAtSW5maW5pdHkpIHtcbiAgICAgICAgICAvLyAgIHJvd0JveCA9IHsgeDogMCwgeTogMCwgaGVpZ2h0OiAwLCB3aWR0aDogMCB9O1xuICAgICAgICAgIC8vIH1cblxuICAgICAgICAgIC8vIFhYWCBUT0RPIEhBQ0s6IGZpbmQgb3V0IHdoZXJlIDUgYW5kIDEuNSBjb21lIGZyb20hXG4gICAgICAgICAgLy8gVGhpcyBpcyB0aGUgZml4IGZvciAjNzI0LCBidXQgdGhlIG51bWJlcnMgYXJlIGd1ZXNzZWQuXG4gICAgICAgICAgdmFyIHJvd0JveEhlaWdodCA9IE1hdGgubWF4KHJvdy5tYXhBcmNIZWlnaHQgKyA1LCByb3cubWF4U3BhbkhlaWdodCArIDEuNSk7IC8vIFhYWCBUT0RPIEhBQ0s6IHdoeSA1LCAxLjU/XG4gICAgICAgICAgaWYgKHJvdy5oYXNBbm5vdGF0aW9ucykge1xuICAgICAgICAgICAgLy8gcm93Qm94LmhlaWdodCA9IC1yb3dCb3gueSArIHJvd1NwYWNpbmc7XG4gICAgICAgICAgICByb3dCb3hIZWlnaHQgKz0gcm93U3BhY2luZyArIDEuNTsgLy8gWFhYIFRPRE8gSEFDSzogd2h5IDEuNT9cbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcm93Qm94SGVpZ2h0IC09IDU7IC8vIFhYWCBUT0RPIEhBQ0s6IHdoeSAtNT9cbiAgICAgICAgICB9XG5cbiAgICAgICAgICByb3dCb3hIZWlnaHQgKz0gcm93UGFkZGluZztcbiAgICAgICAgICB2YXIgYmdDbGFzcztcbiAgICAgICAgICBpZiAoZGF0YS5tYXJrZWRTZW50W2N1cnJlbnRTZW50XSkge1xuICAgICAgICAgICAgLy8gc3BlY2lmaWNhbGx5IGhpZ2hsaWdodGVkXG4gICAgICAgICAgICBiZ0NsYXNzID0gJ2JhY2tncm91bmRIaWdobGlnaHQnO1xuICAgICAgICAgIH0gZWxzZSBpZiAoQ29uZmlndXJhdGlvbi50ZXh0QmFja2dyb3VuZHMgPT0gXCJzdHJpcGVkXCIpIHtcbiAgICAgICAgICAgIC8vIGdpdmUgZXZlcnkgb3RoZXIgc2VudGVuY2UgYSBkaWZmZXJlbnQgYmcgY2xhc3NcbiAgICAgICAgICAgIGJnQ2xhc3MgPSAnYmFja2dyb3VuZCcrIHJvdy5iYWNrZ3JvdW5kSW5kZXg7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIC8vIHBsYWluIFwic3RhbmRhcmRcIiBiZ1xuICAgICAgICAgICAgYmdDbGFzcyA9ICdiYWNrZ3JvdW5kMCc7XG4gICAgICAgICAgfVxuICAgICAgICAgIHN2Zy5yZWN0KGJhY2tncm91bmRHcm91cCxcbiAgICAgICAgICAgIDAsIHkgKyBzaXplcy50ZXh0cy55ICsgc2l6ZXMudGV4dHMuaGVpZ2h0LFxuICAgICAgICAgICAgY2FudmFzV2lkdGgsIHJvd0JveEhlaWdodCArIHNpemVzLnRleHRzLmhlaWdodCArIDEsIHtcbiAgICAgICAgICAgICdjbGFzcyc6IGJnQ2xhc3MsXG4gICAgICAgICAgfSk7XG4gICAgICAgICAgeSArPSByb3dCb3hIZWlnaHQ7XG4gICAgICAgICAgeSArPSBzaXplcy50ZXh0cy5oZWlnaHQ7XG4gICAgICAgICAgcm93LnRleHRZID0geSAtIHJvd1BhZGRpbmc7XG4gICAgICAgICAgaWYgKHJvdy5zZW50ZW5jZSkge1xuICAgICAgICAgICAgdmFyIHNlbnRlbmNlX2hhc2ggPSBuZXcgVVJMSGFzaChjb2xsLCBkb2MsIHsgZm9jdXM6IFtbICdzZW50Jywgcm93LnNlbnRlbmNlIF1dIH0gKTtcbiAgICAgICAgICAgIHZhciBsaW5rID0gc3ZnLmxpbmsoc2VudE51bUdyb3VwLCBzZW50ZW5jZV9oYXNoLmdldEhhc2goKSk7XG4gICAgICAgICAgICB2YXIgdGV4dCA9IHN2Zy50ZXh0KGxpbmssIHNlbnROdW1NYXJnaW4gLSBDb25maWd1cmF0aW9uLnZpc3VhbC5tYXJnaW4ueCwgeSAtIHJvd1BhZGRpbmcsXG4gICAgICAgICAgICAgICAgJycgKyByb3cuc2VudGVuY2UsIHsgJ2RhdGEtc2VudCc6IHJvdy5zZW50ZW5jZSB9KTtcbiAgICAgICAgICAgIHZhciBzZW50Q29tbWVudCA9IGRhdGEuc2VudENvbW1lbnRbcm93LnNlbnRlbmNlXTtcbiAgICAgICAgICAgIGlmIChzZW50Q29tbWVudCkge1xuICAgICAgICAgICAgICB2YXIgYm94ID0gdGV4dC5nZXRCQm94KCk7XG4gICAgICAgICAgICAgIHN2Zy5yZW1vdmUodGV4dCk7XG4gICAgICAgICAgICAgIC8vIFRPRE86IHVzaW5nIHJlY3RTaGFkb3dTaXplLCBidXQgdGhpcyBzaGFkb3cgc2hvdWxkXG4gICAgICAgICAgICAgIC8vIHByb2JhYmx5IGhhdmUgaXRzIG93biBzZXR0aW5nIGZvciBzaGFkb3cgc2l6ZVxuICAgICAgICAgICAgICBzaGFkb3dSZWN0ID0gc3ZnLnJlY3Qoc2VudE51bUdyb3VwLFxuICAgICAgICAgICAgICAgICAgYm94LnggLSByZWN0U2hhZG93U2l6ZSwgYm94LnkgLSByZWN0U2hhZG93U2l6ZSxcbiAgICAgICAgICAgICAgICAgIGJveC53aWR0aCArIDIgKiByZWN0U2hhZG93U2l6ZSwgYm94LmhlaWdodCArIDIgKiByZWN0U2hhZG93U2l6ZSwge1xuXG4gICAgICAgICAgICAgICAgICAnY2xhc3MnOiAnc2hhZG93XycgKyBzZW50Q29tbWVudC50eXBlLFxuICAgICAgICAgICAgICAgICAgZmlsdGVyOiAndXJsKCNHYXVzc2lhbl9CbHVyKScsXG4gICAgICAgICAgICAgICAgICByeDogcmVjdFNoYWRvd1JvdW5kaW5nLFxuICAgICAgICAgICAgICAgICAgcnk6IHJlY3RTaGFkb3dSb3VuZGluZyxcbiAgICAgICAgICAgICAgICAgICdkYXRhLXNlbnQnOiByb3cuc2VudGVuY2UsXG4gICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICB2YXIgdGV4dCA9IHN2Zy50ZXh0KHNlbnROdW1Hcm91cCwgc2VudE51bU1hcmdpbiAtIENvbmZpZ3VyYXRpb24udmlzdWFsLm1hcmdpbi54LCB5IC0gcm93UGFkZGluZyxcbiAgICAgICAgICAgICAgICAgICcnICsgcm93LnNlbnRlbmNlLCB7ICdkYXRhLXNlbnQnOiByb3cuc2VudGVuY2UgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgdmFyIHJvd1kgPSB5IC0gcm93UGFkZGluZztcbiAgICAgICAgICBpZiAocm91bmRDb29yZGluYXRlcykge1xuICAgICAgICAgICAgcm93WSA9IHJvd1l8MDtcbiAgICAgICAgICB9XG4gICAgICAgICAgdHJhbnNsYXRlKHJvdywgMCwgcm93WSk7XG4gICAgICAgICAgeSArPSBDb25maWd1cmF0aW9uLnZpc3VhbC5tYXJnaW4ueTtcbiAgICAgICAgfSk7XG4gICAgICAgIHkgKz0gQ29uZmlndXJhdGlvbi52aXN1YWwubWFyZ2luLnk7XG5cblV0aWwucHJvZmlsZUVuZCgncm93cycpO1xuVXRpbC5wcm9maWxlU3RhcnQoJ2NodW5rRmluaXNoJyk7XG5cbiAgICAgICAgLy8gY2h1bmsgaW5kZXggc29ydCBmdW5jdGlvbnMgZm9yIG92ZXJsYXBwaW5nIGZyYWdtZW50IGRyYXdpbmdcbiAgICAgICAgLy8gYWxnb3JpdGhtOyBmaXJzdCBmb3IgbGVmdC10by1yaWdodCBwYXNzLCBzb3J0aW5nIHByaW1hcmlseVxuICAgICAgICAvLyBieSBzdGFydCBvZmZzZXQsIHNlY29uZCBmb3IgcmlnaHQtdG8tbGVmdCBwYXNzIGJ5IGVuZFxuICAgICAgICAvLyBvZmZzZXQuIFNlY29uZGFyeSBzb3J0IGJ5IGZyYWdtZW50IGxlbmd0aCBpbiBib3RoIGNhc2VzLlxuICAgICAgICB2YXIgY3VycmVudENodW5rO1xuICAgICAgICB2YXIgbHJDaHVua0NvbXAgPSBmdW5jdGlvbihhLGIpIHtcbiAgICAgICAgICB2YXIgYWMgPSBjdXJyZW50Q2h1bmsuZnJhZ21lbnRzW2FdO1xuICAgICAgICAgIHZhciBiYyA9IGN1cnJlbnRDaHVuay5mcmFnbWVudHNbYl1cbiAgICAgICAgICB2YXIgc3RhcnREaWZmID0gVXRpbC5jbXAoYWMuZnJvbSwgYmMuZnJvbSk7XG4gICAgICAgICAgcmV0dXJuIHN0YXJ0RGlmZiAhPSAwID8gc3RhcnREaWZmIDogVXRpbC5jbXAoYmMudG8tYmMuZnJvbSwgYWMudG8tYWMuZnJvbSk7XG4gICAgICAgIH1cbiAgICAgICAgdmFyIHJsQ2h1bmtDb21wID0gZnVuY3Rpb24oYSxiKSB7XG4gICAgICAgICAgdmFyIGFjID0gY3VycmVudENodW5rLmZyYWdtZW50c1thXTtcbiAgICAgICAgICB2YXIgYmMgPSBjdXJyZW50Q2h1bmsuZnJhZ21lbnRzW2JdXG4gICAgICAgICAgdmFyIGVuZERpZmYgPSBVdGlsLmNtcChiYy50bywgYWMudG8pO1xuICAgICAgICAgIHJldHVybiBlbmREaWZmICE9IDAgPyBlbmREaWZmIDogVXRpbC5jbXAoYmMudG8tYmMuZnJvbSwgYWMudG8tYWMuZnJvbSk7XG4gICAgICAgIH1cblxuICAgICAgICB2YXIgc2VudGVuY2VUZXh0ID0gbnVsbDtcbiAgICAgICAgJC5lYWNoKGRhdGEuY2h1bmtzLCBmdW5jdGlvbihjaHVua05vLCBjaHVuaykge1xuICAgICAgICAgIC8vIGNvbnRleHQgZm9yIHNvcnRcbiAgICAgICAgICBjdXJyZW50Q2h1bmsgPSBjaHVuaztcblxuICAgICAgICAgIC8vIHRleHQgcmVuZGVyaW5nXG4gICAgICAgICAgaWYgKGNodW5rLnNlbnRlbmNlKSB7XG4gICAgICAgICAgICBpZiAoc2VudGVuY2VUZXh0KSB7XG4gICAgICAgICAgICAgIC8vIHN2Zy50ZXh0KHRleHRHcm91cCwgc2VudGVuY2VUZXh0KTsgLy8gYXZvaWRzIGpRdWVyeVNWRyBidWdcbiAgICAgICAgICAgICAgc3ZnLnRleHQodGV4dEdyb3VwLCAwLCAwLCBzZW50ZW5jZVRleHQpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgc2VudGVuY2VUZXh0ID0gbnVsbDtcbiAgICAgICAgICB9XG4gICAgICAgICAgaWYgKCFzZW50ZW5jZVRleHQpIHtcbiAgICAgICAgICAgIHNlbnRlbmNlVGV4dCA9IHN2Zy5jcmVhdGVUZXh0KCk7XG4gICAgICAgICAgfVxuICAgICAgICAgIHZhciBuZXh0Q2h1bmsgPSBkYXRhLmNodW5rc1tjaHVua05vICsgMV07XG4gICAgICAgICAgdmFyIG5leHRTcGFjZSA9IG5leHRDaHVuayA/IG5leHRDaHVuay5zcGFjZSA6ICcnO1xuICAgICAgICAgIHNlbnRlbmNlVGV4dC5zcGFuKC8qY2h1bmsuc3BhY2UgKyovIGNodW5rLnRleHQgKyBuZXh0U3BhY2UsIHtcbiAgICAgICAgICAgIHg6IGNodW5rLnRleHRYLFxuICAgICAgICAgICAgeTogY2h1bmsucm93LnRleHRZLFxuICAgICAgICAgICAgJ2RhdGEtY2h1bmstaWQnOiBjaHVuay5pbmRleFxuICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgLy8gY2h1bmsgYmFja2dyb3VuZHNcbiAgICAgICAgICBpZiAoY2h1bmsuZnJhZ21lbnRzLmxlbmd0aCkge1xuICAgICAgICAgICAgdmFyIG9yZGVyZWRJZHggPSBbXTtcbiAgICAgICAgICAgIGZvciAodmFyIGk9Y2h1bmsuZnJhZ21lbnRzLmxlbmd0aC0xOyBpPj0wOyBpLS0pIHtcbiAgICAgICAgICAgICAgb3JkZXJlZElkeC5wdXNoKGkpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBNYXJrIGVudGl0eSBuZXN0aW5nIGhlaWdodC9kZXB0aCAobnVtYmVyIG9mXG4gICAgICAgICAgICAvLyBuZXN0ZWQvbmVzdGluZyBlbnRpdGllcykuIFRvIGFjY291bnQgZm9yIGNyb3NzaW5nXG4gICAgICAgICAgICAvLyBicmFja2V0cyBpbiBhIChtb3N0bHkpIHJlYXNvbmFibGUgd2F5LCBkZXRlcm1pbmVcbiAgICAgICAgICAgIC8vIGRlcHRoL2hlaWdodCBzZXBhcmF0ZWx5IGluIGEgbGVmdC10by1yaWdodCB0cmF2ZXJzYWxcbiAgICAgICAgICAgIC8vIGFuZCBhIHJpZ2h0LXRvLWxlZnQgdHJhdmVyc2FsLlxuICAgICAgICAgICAgb3JkZXJlZElkeC5zb3J0KGxyQ2h1bmtDb21wKTtcblxuICAgICAgICAgICAgdmFyIG9wZW5GcmFnbWVudHMgPSBbXTtcbiAgICAgICAgICAgIGZvcih2YXIgaT0wOyBpPG9yZGVyZWRJZHgubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgICAgdmFyIGN1cnJlbnQgPSBjaHVuay5mcmFnbWVudHNbb3JkZXJlZElkeFtpXV07XG4gICAgICAgICAgICAgIGN1cnJlbnQubmVzdGluZ0hlaWdodExSID0gMDtcbiAgICAgICAgICAgICAgY3VycmVudC5uZXN0aW5nRGVwdGhMUiA9IDA7XG4gICAgICAgICAgICAgIHZhciBzdGlsbE9wZW4gPSBbXTtcbiAgICAgICAgICAgICAgZm9yKHZhciBvPTA7IG88b3BlbkZyYWdtZW50cy5sZW5ndGg7IG8rKykge1xuICAgICAgICAgICAgICAgIGlmKG9wZW5GcmFnbWVudHNbb10udG8gPiBjdXJyZW50LmZyb20pIHtcbiAgICAgICAgICAgICAgICAgIHN0aWxsT3Blbi5wdXNoKG9wZW5GcmFnbWVudHNbb10pO1xuICAgICAgICAgICAgICAgICAgb3BlbkZyYWdtZW50c1tvXS5uZXN0aW5nSGVpZ2h0TFIrKztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgb3BlbkZyYWdtZW50cyA9IHN0aWxsT3BlbjtcbiAgICAgICAgICAgICAgY3VycmVudC5uZXN0aW5nRGVwdGhMUj1vcGVuRnJhZ21lbnRzLmxlbmd0aDtcbiAgICAgICAgICAgICAgb3BlbkZyYWdtZW50cy5wdXNoKGN1cnJlbnQpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyByZS1zb3J0IGZvciByaWdodC10by1sZWZ0IHRyYXZlcnNhbCBieSBlbmQgcG9zaXRpb25cbiAgICAgICAgICAgIG9yZGVyZWRJZHguc29ydChybENodW5rQ29tcCk7XG5cbiAgICAgICAgICAgIG9wZW5GcmFnbWVudHMgPSBbXTtcbiAgICAgICAgICAgIGZvcih2YXIgaT0wOyBpPG9yZGVyZWRJZHgubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgICAgdmFyIGN1cnJlbnQgPSBjaHVuay5mcmFnbWVudHNbb3JkZXJlZElkeFtpXV07XG4gICAgICAgICAgICAgIGN1cnJlbnQubmVzdGluZ0hlaWdodFJMID0gMDtcbiAgICAgICAgICAgICAgY3VycmVudC5uZXN0aW5nRGVwdGhSTCA9IDA7XG4gICAgICAgICAgICAgIHZhciBzdGlsbE9wZW4gPSBbXTtcbiAgICAgICAgICAgICAgZm9yKHZhciBvPTA7IG88b3BlbkZyYWdtZW50cy5sZW5ndGg7IG8rKykge1xuICAgICAgICAgICAgICAgIGlmKG9wZW5GcmFnbWVudHNbb10uZnJvbSA8IGN1cnJlbnQudG8pIHtcbiAgICAgICAgICAgICAgICAgIHN0aWxsT3Blbi5wdXNoKG9wZW5GcmFnbWVudHNbb10pO1xuICAgICAgICAgICAgICAgICAgb3BlbkZyYWdtZW50c1tvXS5uZXN0aW5nSGVpZ2h0UkwrKztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgb3BlbkZyYWdtZW50cyA9IHN0aWxsT3BlbjtcbiAgICAgICAgICAgICAgY3VycmVudC5uZXN0aW5nRGVwdGhSTD1vcGVuRnJhZ21lbnRzLmxlbmd0aDtcbiAgICAgICAgICAgICAgb3BlbkZyYWdtZW50cy5wdXNoKGN1cnJlbnQpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyB0aGUgZWZmZWN0aXZlIGRlcHRoIGFuZCBoZWlnaHQgYXJlIHRoZSBtYXggb2YgdGhvc2VcbiAgICAgICAgICAgIC8vIGZvciB0aGUgbGVmdC10by1yaWdodCBhbmQgcmlnaHQtdG8tbGVmdCB0cmF2ZXJzYWxzLlxuICAgICAgICAgICAgZm9yKHZhciBpPTA7IGk8b3JkZXJlZElkeC5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgICB2YXIgYyA9IGNodW5rLmZyYWdtZW50c1tvcmRlcmVkSWR4W2ldXTtcbiAgICAgICAgICAgICAgYy5uZXN0aW5nSGVpZ2h0ID0gYy5uZXN0aW5nSGVpZ2h0TFIgPiBjLm5lc3RpbmdIZWlnaHRSTCA/IGMubmVzdGluZ0hlaWdodExSIDogYy5uZXN0aW5nSGVpZ2h0Ukw7XG4gICAgICAgICAgICAgIGMubmVzdGluZ0RlcHRoID0gYy5uZXN0aW5nRGVwdGhMUiA+IGMubmVzdGluZ0RlcHRoUkwgPyBjLm5lc3RpbmdEZXB0aExSIDogYy5uZXN0aW5nRGVwdGhSTDtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gUmUtb3JkZXIgYnkgbmVzdGluZyBoZWlnaHQgYW5kIGRyYXcgaW4gb3JkZXJcbiAgICAgICAgICAgIG9yZGVyZWRJZHguc29ydChmdW5jdGlvbihhLGIpIHsgcmV0dXJuIFV0aWwuY21wKGNodW5rLmZyYWdtZW50c1tiXS5uZXN0aW5nSGVpZ2h0LCBjaHVuay5mcmFnbWVudHNbYV0ubmVzdGluZ0hlaWdodCkgfSk7XG5cbiAgICAgICAgICAgIGZvcih2YXIgaT0wOyBpPGNodW5rLmZyYWdtZW50cy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgICB2YXIgZnJhZ21lbnQ9Y2h1bmsuZnJhZ21lbnRzW29yZGVyZWRJZHhbaV1dO1xuICAgICAgICAgICAgICB2YXIgc3BhbkRlc2MgPSBzcGFuVHlwZXNbZnJhZ21lbnQuc3Bhbi50eXBlXTtcbiAgICAgICAgICAgICAgdmFyIGJnQ29sb3IgPSAoKHNwYW5EZXNjICYmIHNwYW5EZXNjLmJnQ29sb3IpIHx8XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgIChzcGFuVHlwZXMuU1BBTl9ERUZBVUxUICYmIHNwYW5UeXBlcy5TUEFOX0RFRkFVTFQuYmdDb2xvcikgfHxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJyNmZmZmZmYnKTtcblxuICAgICAgICAgICAgICAvLyBUd2VhayBmb3IgbmVzdGluZyBkZXB0aC9oZWlnaHQuIFJlY29nbml6ZSBqdXN0IHRocmVlXG4gICAgICAgICAgICAgIC8vIGxldmVscyBmb3Igbm93OiBub3JtYWwsIG5lc3RlZCwgYW5kIG5lc3RpbmcsIHdoZXJlXG4gICAgICAgICAgICAgIC8vIG5lc3RlZCtuZXN0aW5nIHlpZWxkcyBub3JtYWwuIChDdXJyZW50bHkgdGVzdGluZ1xuICAgICAgICAgICAgICAvLyBtaW5vciB0d2VhazogZG9uJ3Qgc2hyaW5rIGZvciBkZXB0aCAxIGFzIHRoZSBuZXN0aW5nXG4gICAgICAgICAgICAgIC8vIGhpZ2hsaWdodCB3aWxsIGdyb3cgYW55d2F5IFtjaGVjayBuZXN0aW5nRGVwdGggPiAxXSlcbiAgICAgICAgICAgICAgdmFyIHNocmluayA9IDA7XG4gICAgICAgICAgICAgIGlmKGZyYWdtZW50Lm5lc3RpbmdEZXB0aCA+IDEgJiYgZnJhZ21lbnQubmVzdGluZ0hlaWdodCA9PSAwKSB7XG4gICAgICAgICAgICAgICAgICBzaHJpbmsgPSAxO1xuICAgICAgICAgICAgICB9IGVsc2UgaWYoZnJhZ21lbnQubmVzdGluZ0RlcHRoID09IDAgJiYgZnJhZ21lbnQubmVzdGluZ0hlaWdodCA+IDApIHtcbiAgICAgICAgICAgICAgICAgIHNocmluayA9IC0xO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIHZhciB5U2hyaW5rID0gc2hyaW5rICogbmVzdGluZ0FkanVzdFlTdGVwU2l6ZTtcbiAgICAgICAgICAgICAgdmFyIHhTaHJpbmsgPSBzaHJpbmsgKiBuZXN0aW5nQWRqdXN0WFN0ZXBTaXplO1xuICAgICAgICAgICAgICAvLyBiaXQgbGlnaHRlclxuICAgICAgICAgICAgICB2YXIgbGlnaHRCZ0NvbG9yID0gVXRpbC5hZGp1c3RDb2xvckxpZ2h0bmVzcyhiZ0NvbG9yLCAwLjgpO1xuICAgICAgICAgICAgICAvLyB0d2VhayBmb3IgWSBzdGFydCBvZmZzZXQgKGFuZCBjb3JyZXNwb25kaW5nIGhlaWdodFxuICAgICAgICAgICAgICAvLyByZWR1Y3Rpb24pOiB0ZXh0IHJhcmVseSBoaXRzIGZvbnQgbWF4IGhlaWdodCwgc28gdGhpc1xuICAgICAgICAgICAgICAvLyB0ZW5kcyB0byBsb29rIGJldHRlclxuICAgICAgICAgICAgICB2YXIgeVN0YXJ0VHdlYWsgPSAxO1xuICAgICAgICAgICAgICAvLyBzdG9yZSB0byBoYXZlIHNhbWUgbW91c2VvdmVyIGhpZ2hsaWdodCB3aXRob3V0IHJlY2FsY1xuICAgICAgICAgICAgICBmcmFnbWVudC5oaWdobGlnaHRQb3MgPSB7XG4gICAgICAgICAgICAgICAgICB4OiBjaHVuay50ZXh0WCArIGZyYWdtZW50LmN1cmx5LmZyb20gKyB4U2hyaW5rLFxuICAgICAgICAgICAgICAgICAgeTogY2h1bmsucm93LnRleHRZICsgc2l6ZXMudGV4dHMueSArIHlTaHJpbmsgKyB5U3RhcnRUd2VhayxcbiAgICAgICAgICAgICAgICAgIHc6IGZyYWdtZW50LmN1cmx5LnRvIC0gZnJhZ21lbnQuY3VybHkuZnJvbSAtIDIqeFNocmluayxcbiAgICAgICAgICAgICAgICAgIGg6IHNpemVzLnRleHRzLmhlaWdodCAtIDIqeVNocmluayAtIHlTdGFydFR3ZWFrLFxuICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICBzdmcucmVjdChoaWdobGlnaHRHcm91cCxcbiAgICAgICAgICAgICAgICAgIGZyYWdtZW50LmhpZ2hsaWdodFBvcy54LCBmcmFnbWVudC5oaWdobGlnaHRQb3MueSxcbiAgICAgICAgICAgICAgICAgIGZyYWdtZW50LmhpZ2hsaWdodFBvcy53LCBmcmFnbWVudC5oaWdobGlnaHRQb3MuaCxcbiAgICAgICAgICAgICAgICAgIHsgZmlsbDogbGlnaHRCZ0NvbG9yLCAvL29wYWNpdHk6MSxcbiAgICAgICAgICAgICAgICAgICAgcng6IGhpZ2hsaWdodFJvdW5kaW5nLngsXG4gICAgICAgICAgICAgICAgICAgIHJ5OiBoaWdobGlnaHRSb3VuZGluZy55LFxuICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgaWYgKHNlbnRlbmNlVGV4dCkge1xuICAgICAgICAgIC8vIHN2Zy50ZXh0KHRleHRHcm91cCwgc2VudGVuY2VUZXh0KTsgLy8gYXZvaWRzIGpRdWVyeVNWRyBidWdcbiAgICAgICAgICBzdmcudGV4dCh0ZXh0R3JvdXAsIDAsIDAsIHNlbnRlbmNlVGV4dCk7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBkcmF3IHRoZSBtYXJrZWRUZXh0XG4gICAgICAgICQuZWFjaCh0ZXh0TWFya2VkUm93cywgZnVuY3Rpb24odGV4dFJvd05vLCB0ZXh0Um93RGVzYykgeyAvLyByb3csIGZyb20sIHRvXG4gICAgICAgICAgdmFyIHRleHRIaWdobGlnaHQgPSBzdmcucmVjdChoaWdobGlnaHRHcm91cCxcbiAgICAgICAgICAgICAgdGV4dFJvd0Rlc2NbMV0gLSAyLCB0ZXh0Um93RGVzY1swXS50ZXh0WSAtIHNpemVzLmZyYWdtZW50cy5oZWlnaHQsXG4gICAgICAgICAgICAgIHRleHRSb3dEZXNjWzJdIC0gdGV4dFJvd0Rlc2NbMV0gKyA0LCBzaXplcy5mcmFnbWVudHMuaGVpZ2h0ICsgNCxcbiAgICAgICAgICAgICAgeyBmaWxsOiAneWVsbG93JyB9IC8vIFRPRE86IHB1dCBpbnRvIGNzcyBmaWxlLCBhcyBkZWZhdWx0IC0gdHVybiBpbnRvIGNsYXNzXG4gICAgICAgICAgKTtcbiAgICAgICAgICAvLyBOT1RFOiBjaGFuZ2luZyBoaWdobGlnaHRUZXh0U2VxdWVuY2UgaGVyZSB3aWxsIGdpdmVcbiAgICAgICAgICAvLyBkaWZmZXJlbnQtY29sb3JlZCBoaWdobGlnaHRzXG4gICAgICAgICAgLy8gVE9ETzogZW50aXJlbHkgZGlmZmVyZW50IHNldHRpbmdzIGZvciBub24tYW5pbWF0aW9ucz9cbiAgICAgICAgICB2YXIgbWFya2VkVHlwZSA9IHRleHRSb3dEZXNjWzNdO1xuICAgICAgICAgIHN2Zy5vdGhlcih0ZXh0SGlnaGxpZ2h0LCAnYW5pbWF0ZScsIHtcbiAgICAgICAgICAgICdkYXRhLXR5cGUnOiBtYXJrZWRUeXBlLFxuICAgICAgICAgICAgYXR0cmlidXRlTmFtZTogJ2ZpbGwnLFxuICAgICAgICAgICAgdmFsdWVzOiAobWFya2VkVHlwZSA9PSAnbWF0Y2gnID8gaGlnaGxpZ2h0TWF0Y2hTZXF1ZW5jZVxuICAgICAgICAgICAgICAgICAgICAgOiBoaWdobGlnaHRUZXh0U2VxdWVuY2UpLFxuICAgICAgICAgICAgZHVyOiBoaWdobGlnaHREdXJhdGlvbixcbiAgICAgICAgICAgIHJlcGVhdENvdW50OiAnaW5kZWZpbml0ZScsXG4gICAgICAgICAgICBiZWdpbjogJ2luZGVmaW5pdGUnXG4gICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuXG5cblV0aWwucHJvZmlsZUVuZCgnY2h1bmtGaW5pc2gnKTtcblV0aWwucHJvZmlsZVN0YXJ0KCdmaW5pc2gnKTtcblxuICAgICAgICBzdmcucGF0aChzZW50TnVtR3JvdXAsIHN2Zy5jcmVhdGVQYXRoKCkuXG4gICAgICAgICAgbW92ZShzZW50TnVtTWFyZ2luLCAwKS5cbiAgICAgICAgICBsaW5lKHNlbnROdW1NYXJnaW4sIHkpKTtcblxuICAgICAgICAvLyByZXNpemUgdGhlIFNWR1xuICAgICAgICB2YXIgd2lkdGggPSBtYXhUZXh0V2lkdGggKyBzZW50TnVtTWFyZ2luICsgMiAqIENvbmZpZ3VyYXRpb24udmlzdWFsLm1hcmdpbi54ICsgMTtcbiAgICAgICAgaWYgKHdpZHRoID4gY2FudmFzV2lkdGgpIGNhbnZhc1dpZHRoID0gd2lkdGg7XG5cbiAgICAgICAgJHN2Zy53aWR0aChjYW52YXNXaWR0aCk7XG4gICAgICAgICRzdmcuaGVpZ2h0KHkpO1xuICAgICAgICAkc3ZnRGl2LmhlaWdodCh5KTtcblxuVXRpbC5wcm9maWxlRW5kKCdmaW5pc2gnKTtcblV0aWwucHJvZmlsZUVuZCgncmVuZGVyJyk7XG5VdGlsLnByb2ZpbGVSZXBvcnQoKTtcblxuXG4gICAgICAgIGRyYXdpbmcgPSBmYWxzZTtcbiAgICAgICAgaWYgKHJlZHJhdykge1xuICAgICAgICAgIHJlZHJhdyA9IGZhbHNlO1xuICAgICAgICAgIHJlbmRlckRhdGFSZWFsKCk7XG4gICAgICAgIH1cbiAgICAgICAgJHN2Zy5maW5kKCdhbmltYXRlJykuZWFjaChmdW5jdGlvbigpIHtcbiAgICAgICAgICBpZiAodGhpcy5iZWdpbkVsZW1lbnQpIHsgLy8gcHJvdGVjdCBhZ2FpbnN0IG5vbi1TTUlMIGJyb3dzZXJzXG4gICAgICAgICAgICB0aGlzLmJlZ2luRWxlbWVudCgpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIGRpc3BhdGNoZXIucG9zdCgnZG9uZVJlbmRlcmluZycsIFtjb2xsLCBkb2MsIGFyZ3NdKTtcbiAgICAgIH07XG5cbiAgICAgIHZhciByZW5kZXJFcnJvcnMgPSB7XG4gICAgICAgIHVuYWJsZVRvUmVhZFRleHRGaWxlOiB0cnVlLFxuICAgICAgICBhbm5vdGF0aW9uRmlsZU5vdEZvdW5kOiB0cnVlLFxuICAgICAgICBpc0RpcmVjdG9yeUVycm9yOiB0cnVlXG4gICAgICB9O1xuICAgICAgdmFyIHJlbmRlckRhdGEgPSBmdW5jdGlvbihzb3VyY2VEYXRhKSB7XG4gICAgICAgIFV0aWwucHJvZmlsZUVuZCgnaW52b2tlIGdldERvY3VtZW50Jyk7XG4gICAgICAgIGlmIChzb3VyY2VEYXRhICYmIHNvdXJjZURhdGEuZXhjZXB0aW9uKSB7XG4gICAgICAgICAgaWYgKHJlbmRlckVycm9yc1tzb3VyY2VEYXRhLmV4Y2VwdGlvbl0pIHtcbiAgICAgICAgICAgIGRpc3BhdGNoZXIucG9zdCgncmVuZGVyRXJyb3I6JyArIHNvdXJjZURhdGEuZXhjZXB0aW9uLCBbc291cmNlRGF0YV0pO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBkaXNwYXRjaGVyLnBvc3QoJ3Vua25vd25FcnJvcicsIFtzb3VyY2VEYXRhLmV4Y2VwdGlvbl0pO1xuICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAvLyBGaWxsIGluIGRlZmF1bHQgdmFsdWVzIHRoYXQgZG9uJ3QgbmVjZXNzYXJpbHkgZ28gb3ZlciB0aGUgcHJvdG9jb2xcbiAgICAgICAgICBpZiAoc291cmNlRGF0YSkge1xuICAgICAgICAgICAgc2V0U291cmNlRGF0YURlZmF1bHRzKHNvdXJjZURhdGEpO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIGRpc3BhdGNoZXIucG9zdCgnc3RhcnRlZFJlbmRlcmluZycsIFtjb2xsLCBkb2MsIGFyZ3NdKTtcbiAgICAgICAgICBkaXNwYXRjaGVyLnBvc3QoJ3NwaW4nKTtcbiAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgIHJlbmRlckRhdGFSZWFsKHNvdXJjZURhdGEpO1xuICAgICAgICAgICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgICAgICAgICAgLy8gV2UgYXJlIHN1cmUgbm90IHRvIGJlIGRyYXdpbmcgYW55bW9yZSwgcmVzZXQgdGhlIHN0YXRlXG4gICAgICAgICAgICAgICAgZHJhd2luZyA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIC8vIFRPRE86IEhvb2sgcHJpbnRvdXQgaW50byBkaXNwYXRjaCBlbHNld2hlcmU/XG4gICAgICAgICAgICAgICAgY29uc29sZS53YXJuKCdSZW5kZXJpbmcgdGVybWluYXRlZCBkdWUgdG86JywgZSk7XG4gICAgICAgICAgICAgICAgZGlzcGF0Y2hlci5wb3N0KCdyZW5kZXJFcnJvcjogRmF0YWwnLCBbc291cmNlRGF0YSwgZV0pO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIGRpc3BhdGNoZXIucG9zdCgndW5zcGluJyk7XG4gICAgICAgICAgfSwgMCk7XG4gICAgICAgIH1cbiAgICAgIH07XG5cbiAgICAgIHZhciByZW5kZXJEb2N1bWVudCA9IGZ1bmN0aW9uKCkge1xuICAgICAgICBVdGlsLnByb2ZpbGVTdGFydCgnaW52b2tlIGdldERvY3VtZW50Jyk7XG4gICAgICAgIGRpc3BhdGNoZXIucG9zdCgnYWpheCcsIFt7XG4gICAgICAgICAgICBhY3Rpb246ICdnZXREb2N1bWVudCcsXG4gICAgICAgICAgICBjb2xsZWN0aW9uOiBjb2xsLFxuICAgICAgICAgICAgJ2RvY3VtZW50JzogZG9jLFxuICAgICAgICAgIH0sICdyZW5kZXJEYXRhJywge1xuICAgICAgICAgICAgY29sbGVjdGlvbjogY29sbCxcbiAgICAgICAgICAgICdkb2N1bWVudCc6IGRvY1xuICAgICAgICAgIH1dKTtcbiAgICAgIH07XG5cbiAgICAgIHZhciB0cmlnZ2VyUmVuZGVyID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIGlmIChzdmcgJiYgKChpc1JlbmRlclJlcXVlc3RlZCAmJiBpc0NvbGxlY3Rpb25Mb2FkZWQpIHx8IHJlcXVlc3RlZERhdGEpICYmIFZpc3VhbGl6ZXIuYXJlRm9udHNMb2FkZWQpIHtcbiAgICAgICAgICBpc1JlbmRlclJlcXVlc3RlZCA9IGZhbHNlO1xuICAgICAgICAgIGlmIChyZXF1ZXN0ZWREYXRhKSB7XG5cblV0aWwucHJvZmlsZUNsZWFyKCk7XG5VdGlsLnByb2ZpbGVTdGFydCgnYmVmb3JlIHJlbmRlcicpO1xuXG4gICAgICAgICAgICByZW5kZXJEYXRhKHJlcXVlc3RlZERhdGEpO1xuICAgICAgICAgIH0gZWxzZSBpZiAoZG9jLmxlbmd0aCkge1xuXG5VdGlsLnByb2ZpbGVDbGVhcigpO1xuVXRpbC5wcm9maWxlU3RhcnQoJ2JlZm9yZSByZW5kZXInKTtcblxuICAgICAgICAgICAgcmVuZGVyRG9jdW1lbnQoKTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgZGlzcGF0Y2hlci5wb3N0KDAsICdyZW5kZXJFcnJvcjpub0ZpbGVTcGVjaWZpZWQnKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH07XG5cbiAgICAgIHZhciByZXF1ZXN0UmVuZGVyRGF0YSA9IGZ1bmN0aW9uKHNvdXJjZURhdGEpIHtcbiAgICAgICAgcmVxdWVzdGVkRGF0YSA9IHNvdXJjZURhdGE7XG4gICAgICAgIHRyaWdnZXJSZW5kZXIoKTtcbiAgICAgIH07XG5cbiAgICAgIHZhciBjb2xsZWN0aW9uQ2hhbmdlZCA9IGZ1bmN0aW9uKCkge1xuICAgICAgICBpc0NvbGxlY3Rpb25Mb2FkZWQgPSBmYWxzZTtcbiAgICAgIH07XG5cbiAgICAgIHZhciBnb3RDdXJyZW50ID0gZnVuY3Rpb24oX2NvbGwsIF9kb2MsIF9hcmdzLCByZWxvYWREYXRhKSB7XG4gICAgICAgIGNvbGwgPSBfY29sbDtcbiAgICAgICAgZG9jICA9IF9kb2M7XG4gICAgICAgIGFyZ3MgPSBfYXJncztcbiAgICAgICAgaWYgKHJlbG9hZERhdGEpIHtcbiAgICAgICAgICBpc1JlbmRlclJlcXVlc3RlZCA9IHRydWU7XG4gICAgICAgICAgdHJpZ2dlclJlbmRlcigpO1xuICAgICAgICB9XG4gICAgICB9O1xuXG5cbiAgICAgIC8vIGV2ZW50IGhhbmRsZXJzXG5cbiAgICAgIHZhciBoaWdobGlnaHQsIGhpZ2hsaWdodEFyY3MsIGhpZ2hsaWdodFNwYW5zLCBjb21tZW50SWQ7XG5cbiAgICAgIHZhciBvbk1vdXNlT3ZlciA9IGZ1bmN0aW9uKGV2dCkge1xuICAgICAgICB2YXIgdGFyZ2V0ID0gJChldnQudGFyZ2V0KTtcbiAgICAgICAgdmFyIGlkO1xuICAgICAgICBpZiAoaWQgPSB0YXJnZXQuYXR0cignZGF0YS1zcGFuLWlkJykpIHtcbiAgICAgICAgICBjb21tZW50SWQgPSBpZDtcbiAgICAgICAgICB2YXIgc3BhbiA9IGRhdGEuc3BhbnNbaWRdO1xuICAgICAgICAgIGRpc3BhdGNoZXIucG9zdCgnZGlzcGxheVNwYW5Db21tZW50JywgW1xuICAgICAgICAgICAgICBldnQsIHRhcmdldCwgaWQsIHNwYW4udHlwZSwgc3Bhbi5hdHRyaWJ1dGVUZXh0LFxuICAgICAgICAgICAgICBzcGFuLnRleHQsXG4gICAgICAgICAgICAgIHNwYW4uY29tbWVudCAmJiBzcGFuLmNvbW1lbnQudGV4dCxcbiAgICAgICAgICAgICAgc3Bhbi5jb21tZW50ICYmIHNwYW4uY29tbWVudC50eXBlLFxuICAgICAgICAgICAgICBzcGFuLm5vcm1hbGl6YXRpb25zXSk7XG5cbiAgICAgICAgICB2YXIgc3BhbkRlc2MgPSBzcGFuVHlwZXNbc3Bhbi50eXBlXTtcbiAgICAgICAgICB2YXIgYmdDb2xvciA9ICgoc3BhbkRlc2MgJiYgc3BhbkRlc2MuYmdDb2xvcikgfHxcbiAgICAgICAgICAgICAgICAgICAgICAgICAoc3BhblR5cGVzLlNQQU5fREVGQVVMVCAmJiBzcGFuVHlwZXMuU1BBTl9ERUZBVUxULmJnQ29sb3IpIHx8XG4gICAgICAgICAgICAgICAgICAgICAgICAgJyNmZmZmZmYnKTtcbiAgICAgICAgICBoaWdobGlnaHQgPSBbXTtcbiAgICAgICAgICAkLmVhY2goc3Bhbi5mcmFnbWVudHMsIGZ1bmN0aW9uKGZyYWdtZW50Tm8sIGZyYWdtZW50KSB7XG4gICAgICAgICAgICBoaWdobGlnaHQucHVzaChzdmcucmVjdChoaWdobGlnaHRHcm91cCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZyYWdtZW50LmhpZ2hsaWdodFBvcy54LCBmcmFnbWVudC5oaWdobGlnaHRQb3MueSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZyYWdtZW50LmhpZ2hsaWdodFBvcy53LCBmcmFnbWVudC5oaWdobGlnaHRQb3MuaCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsgJ2ZpbGwnOiBiZ0NvbG9yLCBvcGFjaXR5OjAuNzUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJ4OiBoaWdobGlnaHRSb3VuZGluZy54LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByeTogaGlnaGxpZ2h0Um91bmRpbmcueSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pKTtcbiAgICAgICAgICB9KTtcblxuICAgICAgICAgIGlmICh0aGF0LmFyY0RyYWdPcmlnaW4pIHtcbiAgICAgICAgICAgIHRhcmdldC5wYXJlbnQoKS5hZGRDbGFzcygnaGlnaGxpZ2h0Jyk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGhpZ2hsaWdodEFyY3MgPSAkc3ZnLlxuICAgICAgICAgICAgICAgIGZpbmQoJ2dbZGF0YS1mcm9tPVwiJyArIGlkICsgJ1wiXSwgZ1tkYXRhLXRvPVwiJyArIGlkICsgJ1wiXScpLlxuICAgICAgICAgICAgICAgIGFkZENsYXNzKCdoaWdobGlnaHQnKTtcbiAgICAgICAgICAgIHZhciBzcGFucyA9IHt9O1xuICAgICAgICAgICAgc3BhbnNbaWRdID0gdHJ1ZTtcbiAgICAgICAgICAgIHZhciBzcGFuSWRzID0gW107XG4gICAgICAgICAgICAkLmVhY2goc3Bhbi5pbmNvbWluZywgZnVuY3Rpb24oYXJjTm8sIGFyYykge1xuICAgICAgICAgICAgICAgIHNwYW5zW2FyYy5vcmlnaW5dID0gdHJ1ZTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgJC5lYWNoKHNwYW4ub3V0Z29pbmcsIGZ1bmN0aW9uKGFyY05vLCBhcmMpIHtcbiAgICAgICAgICAgICAgICBzcGFuc1thcmMudGFyZ2V0XSA9IHRydWU7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICQuZWFjaChzcGFucywgZnVuY3Rpb24oc3BhbklkLCBkdW1teSkge1xuICAgICAgICAgICAgICAgIHNwYW5JZHMucHVzaCgncmVjdFtkYXRhLXNwYW4taWQ9XCInICsgc3BhbklkICsgJ1wiXScpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBoaWdobGlnaHRTcGFucyA9ICRzdmcuXG4gICAgICAgICAgICAgICAgZmluZChzcGFuSWRzLmpvaW4oJywgJykpLlxuICAgICAgICAgICAgICAgIHBhcmVudCgpLlxuICAgICAgICAgICAgICAgIGFkZENsYXNzKCdoaWdobGlnaHQnKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgZm9yY2VSZWRyYXcoKTtcbiAgICAgICAgfSBlbHNlIGlmICghdGhhdC5hcmNEcmFnT3JpZ2luICYmIChpZCA9IHRhcmdldC5hdHRyKCdkYXRhLWFyYy1yb2xlJykpKSB7XG4gICAgICAgICAgdmFyIG9yaWdpblNwYW5JZCA9IHRhcmdldC5hdHRyKCdkYXRhLWFyYy1vcmlnaW4nKTtcbiAgICAgICAgICB2YXIgdGFyZ2V0U3BhbklkID0gdGFyZ2V0LmF0dHIoJ2RhdGEtYXJjLXRhcmdldCcpO1xuICAgICAgICAgIHZhciByb2xlID0gdGFyZ2V0LmF0dHIoJ2RhdGEtYXJjLXJvbGUnKTtcbiAgICAgICAgICB2YXIgc3ltbWV0cmljID0gKHJlbGF0aW9uVHlwZXNIYXNoICYmXG4gICAgICAgICAgICAgICAgICAgICAgICAgICByZWxhdGlvblR5cGVzSGFzaFtyb2xlXSAmJlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVsYXRpb25UeXBlc0hhc2hbcm9sZV0ucHJvcGVydGllcyAmJlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVsYXRpb25UeXBlc0hhc2hbcm9sZV0ucHJvcGVydGllcy5zeW1tZXRyaWMpO1xuICAgICAgICAgIC8vIE5PVEU6IG5vIGNvbW1lbnRUZXh0LCBjb21tZW50VHlwZSBmb3Igbm93XG4gICAgICAgICAgdmFyIGFyY0V2ZW50RGVzY0lkID0gdGFyZ2V0LmF0dHIoJ2RhdGEtYXJjLWVkJyk7XG4gICAgICAgICAgdmFyIGNvbW1lbnRUZXh0ID0gJyc7XG4gICAgICAgICAgdmFyIGNvbW1lbnRUeXBlID0gJyc7XG4gICAgICAgICAgdmFyIGFyY0lkO1xuICAgICAgICAgIGlmIChhcmNFdmVudERlc2NJZCkge1xuICAgICAgICAgICAgdmFyIGV2ZW50RGVzYyA9IGRhdGEuZXZlbnREZXNjc1thcmNFdmVudERlc2NJZF07XG4gICAgICAgICAgICB2YXIgY29tbWVudCA9IGV2ZW50RGVzYy5jb21tZW50O1xuICAgICAgICAgICAgaWYgKGNvbW1lbnQpIHtcbiAgICAgICAgICAgICAgY29tbWVudFRleHQgPSBjb21tZW50LnRleHQ7XG4gICAgICAgICAgICAgIGNvbW1lbnRUeXBlID0gY29tbWVudC50eXBlO1xuICAgICAgICAgICAgICBpZiAoY29tbWVudFRleHQgPT0gJycgJiYgY29tbWVudFR5cGUpIHtcbiAgICAgICAgICAgICAgICAgIC8vIGRlZmF1bHQgdG8gdHlwZSBpZiBtaXNzaW5nIHRleHRcbiAgICAgICAgICAgICAgICAgIGNvbW1lbnRUZXh0ID0gY29tbWVudFR5cGU7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChldmVudERlc2MucmVsYXRpb24pIHtcbiAgICAgICAgICAgICAgLy8gYW1vbmcgYXJjcywgb25seSBvbmVzIGNvcnJlc3BvbmRpbmcgdG8gcmVsYXRpb25zIGhhdmVcbiAgICAgICAgICAgICAgLy8gXCJpbmRlcGVuZGVudFwiIElEc1xuICAgICAgICAgICAgICBhcmNJZCA9IGFyY0V2ZW50RGVzY0lkO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgICB2YXIgb3JpZ2luU3BhblR5cGUgPSBkYXRhLnNwYW5zW29yaWdpblNwYW5JZF0udHlwZSB8fCAnJztcbiAgICAgICAgICB2YXIgdGFyZ2V0U3BhblR5cGUgPSBkYXRhLnNwYW5zW3RhcmdldFNwYW5JZF0udHlwZSB8fCAnJztcbiAgICAgICAgICBkaXNwYXRjaGVyLnBvc3QoJ2Rpc3BsYXlBcmNDb21tZW50JywgW1xuICAgICAgICAgICAgICBldnQsIHRhcmdldCwgc3ltbWV0cmljLCBhcmNJZCxcbiAgICAgICAgICAgICAgb3JpZ2luU3BhbklkLCBvcmlnaW5TcGFuVHlwZSwgcm9sZSxcbiAgICAgICAgICAgICAgdGFyZ2V0U3BhbklkLCB0YXJnZXRTcGFuVHlwZSxcbiAgICAgICAgICAgICAgY29tbWVudFRleHQsIGNvbW1lbnRUeXBlXSk7XG4gICAgICAgICAgaGlnaGxpZ2h0QXJjcyA9ICRzdmcuXG4gICAgICAgICAgICAgIGZpbmQoJ2dbZGF0YS1mcm9tPVwiJyArIG9yaWdpblNwYW5JZCArICdcIl1bZGF0YS10bz1cIicgKyB0YXJnZXRTcGFuSWQgKyAnXCJdJykuXG4gICAgICAgICAgICAgIGFkZENsYXNzKCdoaWdobGlnaHQnKTtcbiAgICAgICAgICBoaWdobGlnaHRTcGFucyA9ICQoJHN2ZykuXG4gICAgICAgICAgICAgIGZpbmQoJ3JlY3RbZGF0YS1zcGFuLWlkPVwiJyArIG9yaWdpblNwYW5JZCArICdcIl0sIHJlY3RbZGF0YS1zcGFuLWlkPVwiJyArIHRhcmdldFNwYW5JZCArICdcIl0nKS5cbiAgICAgICAgICAgICAgcGFyZW50KCkuXG4gICAgICAgICAgICAgIGFkZENsYXNzKCdoaWdobGlnaHQnKTtcbiAgICAgICAgfSBlbHNlIGlmIChpZCA9IHRhcmdldC5hdHRyKCdkYXRhLXNlbnQnKSkge1xuICAgICAgICAgIHZhciBjb21tZW50ID0gZGF0YS5zZW50Q29tbWVudFtpZF07XG4gICAgICAgICAgaWYgKGNvbW1lbnQpIHtcbiAgICAgICAgICAgIGRpc3BhdGNoZXIucG9zdCgnZGlzcGxheVNlbnRDb21tZW50JywgW2V2dCwgdGFyZ2V0LCBjb21tZW50LnRleHQsIGNvbW1lbnQudHlwZV0pO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfTtcblxuICAgICAgdmFyIG9uTW91c2VPdXQgPSBmdW5jdGlvbihldnQpIHtcbiAgICAgICAgdmFyIHRhcmdldCA9ICQoZXZ0LnRhcmdldCk7XG4gICAgICAgIHRhcmdldC5yZW1vdmVDbGFzcygnYmFkVGFyZ2V0Jyk7XG4gICAgICAgIGRpc3BhdGNoZXIucG9zdCgnaGlkZUNvbW1lbnQnKTtcbiAgICAgICAgaWYgKGhpZ2hsaWdodCkge1xuICAgICAgICAgICQuZWFjaChoaWdobGlnaHQsIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgc3ZnLnJlbW92ZSh0aGlzKTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgICBoaWdobGlnaHQgPSB1bmRlZmluZWQ7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGhpZ2hsaWdodFNwYW5zKSB7XG4gICAgICAgICAgaGlnaGxpZ2h0QXJjcy5yZW1vdmVDbGFzcygnaGlnaGxpZ2h0Jyk7XG4gICAgICAgICAgaGlnaGxpZ2h0U3BhbnMucmVtb3ZlQ2xhc3MoJ2hpZ2hsaWdodCcpO1xuICAgICAgICAgIGhpZ2hsaWdodFNwYW5zID0gdW5kZWZpbmVkO1xuICAgICAgICB9XG4gICAgICAgIGZvcmNlUmVkcmF3KCk7XG4gICAgICB9O1xuXG4gICAgICB2YXIgc2V0QWJicmV2cyA9IGZ1bmN0aW9uKF9hYmJyZXZzT24pIHtcbiAgICAgICAgLy8gVE9ETzogdGhpcyBpcyBhIHNsaWdodGx5IHdlaXJkIHBsYWNlIHRvIHR3ZWFrIHRoZSBjb25maWd1cmF0aW9uXG4gICAgICAgIENvbmZpZ3VyYXRpb24uYWJicmV2c09uID0gX2FiYnJldnNPbjtcbiAgICAgICAgZGlzcGF0Y2hlci5wb3N0KCdjb25maWd1cmF0aW9uQ2hhbmdlZCcpO1xuICAgICAgfVxuXG4gICAgICB2YXIgc2V0VGV4dEJhY2tncm91bmRzID0gZnVuY3Rpb24oX3RleHRCYWNrZ3JvdW5kcykge1xuICAgICAgICBDb25maWd1cmF0aW9uLnRleHRCYWNrZ3JvdW5kcyA9IF90ZXh0QmFja2dyb3VuZHM7XG4gICAgICAgIGRpc3BhdGNoZXIucG9zdCgnY29uZmlndXJhdGlvbkNoYW5nZWQnKTtcbiAgICAgIH1cblxuICAgICAgdmFyIHNldExheW91dERlbnNpdHkgPSBmdW5jdGlvbihfZGVuc2l0eSkge1xuICAgICAgICAvL2Rpc3BhdGNoZXIucG9zdCgnbWVzc2FnZXMnLCBbW1snU2V0dGluZyBsYXlvdXQgZGVuc2l0eSAnICsgX2RlbnNpdHksICdjb21tZW50J11dXSk7XG4gICAgICAgIC8vIFRPRE86IHN0b3JlIHN0YW5kYXJkIHNldHRpbmdzIGluc3RlYWQgb2YgaGFyZC1jb2RpbmdcbiAgICAgICAgLy8gdGhlbSBoZXJlIChhZ2FpbilcbiAgICAgICAgaWYgKF9kZW5zaXR5IDwgMikge1xuICAgICAgICAgIC8vIGRlbnNlXG4gICAgICAgICAgQ29uZmlndXJhdGlvbi52aXN1YWwubWFyZ2luID0geyB4OiAxLCB5OiAwIH07XG4gICAgICAgICAgQ29uZmlndXJhdGlvbi52aXN1YWwuYm94U3BhY2luZyA9IDE7XG4gICAgICAgICAgQ29uZmlndXJhdGlvbi52aXN1YWwuY3VybHlIZWlnaHQgPSAxO1xuICAgICAgICAgIENvbmZpZ3VyYXRpb24udmlzdWFsLmFyY1NwYWNpbmcgPSA3O1xuICAgICAgICAgIENvbmZpZ3VyYXRpb24udmlzdWFsLmFyY1N0YXJ0SGVpZ2h0ID0gMThcbiAgICAgICAgfSBlbHNlIGlmKF9kZW5zaXR5ID4gMikge1xuICAgICAgICAgIC8vIHNwYWNpb3VzXG4gICAgICAgICAgQ29uZmlndXJhdGlvbi52aXN1YWwubWFyZ2luID0geyB4OiAyLCB5OiAxIH07XG4gICAgICAgICAgQ29uZmlndXJhdGlvbi52aXN1YWwuYm94U3BhY2luZyA9IDM7XG4gICAgICAgICAgQ29uZmlndXJhdGlvbi52aXN1YWwuY3VybHlIZWlnaHQgPSA2O1xuICAgICAgICAgIENvbmZpZ3VyYXRpb24udmlzdWFsLmFyY1NwYWNpbmcgPSAxMjtcbiAgICAgICAgICBDb25maWd1cmF0aW9uLnZpc3VhbC5hcmNTdGFydEhlaWdodCA9IDIzO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIC8vIHN0YW5kYXJkXG4gICAgICAgICAgQ29uZmlndXJhdGlvbi52aXN1YWwubWFyZ2luID0geyB4OiAyLCB5OiAxIH07XG4gICAgICAgICAgQ29uZmlndXJhdGlvbi52aXN1YWwuYm94U3BhY2luZyA9IDE7XG4gICAgICAgICAgQ29uZmlndXJhdGlvbi52aXN1YWwuY3VybHlIZWlnaHQgPSA0O1xuICAgICAgICAgIENvbmZpZ3VyYXRpb24udmlzdWFsLmFyY1NwYWNpbmcgPSA5O1xuICAgICAgICAgIENvbmZpZ3VyYXRpb24udmlzdWFsLmFyY1N0YXJ0SGVpZ2h0ID0gMTk7XG4gICAgICAgIH1cbiAgICAgICAgZGlzcGF0Y2hlci5wb3N0KCdjb25maWd1cmF0aW9uQ2hhbmdlZCcpO1xuICAgICAgfVxuXG4gICAgICB2YXIgc2V0U3ZnV2lkdGggPSBmdW5jdGlvbihfd2lkdGgpIHtcbiAgICAgICAgJHN2Z0Rpdi53aWR0aChfd2lkdGgpO1xuICAgICAgICBpZiAoQ29uZmlndXJhdGlvbi5zdmdXaWR0aCAhPSBfd2lkdGgpIHtcbiAgICAgICAgICBDb25maWd1cmF0aW9uLnN2Z1dpZHRoID0gX3dpZHRoO1xuICAgICAgICAgIGRpc3BhdGNoZXIucG9zdCgnY29uZmlndXJhdGlvbkNoYW5nZWQnKTtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICAkc3ZnRGl2ID0gJCgkc3ZnRGl2KS5oaWRlKCk7XG5cbiAgICAgIC8vIHJlZ2lzdGVyIGV2ZW50IGxpc3RlbmVyc1xuICAgICAgdmFyIHJlZ2lzdGVySGFuZGxlcnMgPSBmdW5jdGlvbihlbGVtZW50LCBldmVudHMpIHtcbiAgICAgICAgJC5lYWNoKGV2ZW50cywgZnVuY3Rpb24oZXZlbnRObywgZXZlbnROYW1lKSB7XG4gICAgICAgICAgICBlbGVtZW50LmJpbmQoZXZlbnROYW1lLFxuICAgICAgICAgICAgICBmdW5jdGlvbihldnQpIHtcbiAgICAgICAgICAgICAgICBkaXNwYXRjaGVyLnBvc3QoZXZlbnROYW1lLCBbZXZ0XSwgJ2FsbCcpO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICApO1xuICAgICAgICB9KTtcbiAgICAgIH07XG4gICAgICByZWdpc3RlckhhbmRsZXJzKCRzdmdEaXYsIFtcbiAgICAgICAgICAnbW91c2VvdmVyJywgJ21vdXNlb3V0JywgJ21vdXNlbW92ZScsXG4gICAgICAgICAgJ21vdXNldXAnLCAnbW91c2Vkb3duJyxcbiAgICAgICAgICAnZHJhZ3N0YXJ0JyxcbiAgICAgICAgICAnZGJsY2xpY2snLCAnY2xpY2snXG4gICAgICBdKTtcbiAgICAgIHJlZ2lzdGVySGFuZGxlcnMoJChkb2N1bWVudCksIFtcbiAgICAgICAgICAna2V5ZG93bicsICdrZXlwcmVzcycsXG4gICAgICAgICAgJ3RvdWNoc3RhcnQnLCAndG91Y2hlbmQnXG4gICAgICBdKTtcbiAgICAgIHJlZ2lzdGVySGFuZGxlcnMoJCh3aW5kb3cpLCBbXG4gICAgICAgICAgJ3Jlc2l6ZSdcbiAgICAgIF0pO1xuXG4gICAgICAvLyBjcmVhdGUgdGhlIHN2ZyB3cmFwcGVyXG4gICAgICAkc3ZnRGl2LnN2Zyh7XG4gICAgICAgICAgb25Mb2FkOiBmdW5jdGlvbihfc3ZnKSB7XG4gICAgICAgICAgICAgIHRoYXQuc3ZnID0gc3ZnID0gX3N2ZztcbiAgICAgICAgICAgICAgJHN2ZyA9ICQoc3ZnLl9zdmcpO1xuXG4gICAgICAgICAgICAgIC8qIFhYWCBIQUNLIFJFTU9WRUQgLSBub3QgZWZmaWNpZW50P1xuXG4gICAgICAgICAgICAgIC8vIFhYWCBIQUNLIHRvIGFsbG93IG9mZi1ET00gU1ZHIGVsZW1lbnQgY3JlYXRpb25cbiAgICAgICAgICAgICAgLy8gd2UgbmVlZCB0byByZXBsYWNlIHRoZSBqUXVlcnkgU1ZHJ3MgX21ha2VOb2RlIGZ1bmN0aW9uXG4gICAgICAgICAgICAgIC8vIHdpdGggYSBtb2RpZmllZCBvbmUuXG4gICAgICAgICAgICAgIC8vIEJlIGF3YXJlIG9mIHBvdGVudGlhbCBicmVha2FnZSB1cG9uIGpRdWVyeSBTVkcgdXBncmFkZS5cbiAgICAgICAgICAgICAgc3ZnLl9tYWtlTm9kZSA9IGZ1bmN0aW9uKHBhcmVudCwgbmFtZSwgc2V0dGluZ3MpIHtcbiAgICAgICAgICAgICAgICAgIC8vIENPTU1FTlRFRCBPVVQ6IHBhcmVudCA9IHBhcmVudCB8fCB0aGlzLl9zdmc7XG4gICAgICAgICAgICAgICAgICB2YXIgbm9kZSA9IHRoaXMuX3N2Zy5vd25lckRvY3VtZW50LmNyZWF0ZUVsZW1lbnROUygkLnN2Zy5zdmdOUywgbmFtZSk7XG4gICAgICAgICAgICAgICAgICBmb3IgKHZhciBuYW1lIGluIHNldHRpbmdzKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciB2YWx1ZSA9IHNldHRpbmdzW25hbWVdO1xuICAgICAgICAgICAgICAgICAgICBpZiAodmFsdWUgIT0gbnVsbCAmJiB2YWx1ZSAhPSBudWxsICYmXG4gICAgICAgICAgICAgICAgICAgICAgICAodHlwZW9mIHZhbHVlICE9ICdzdHJpbmcnIHx8IHZhbHVlICE9ICcnKSkge1xuICAgICAgICAgICAgICAgICAgICAgIG5vZGUuc2V0QXR0cmlidXRlKCQuc3ZnLl9hdHRyTmFtZXNbbmFtZV0gfHwgbmFtZSwgdmFsdWUpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAvLyBBRERFRCBJTjpcbiAgICAgICAgICAgICAgICAgIGlmIChwYXJlbnQpXG4gICAgICAgICAgICAgICAgICAgIHBhcmVudC5hcHBlbmRDaGlsZChub2RlKTtcbiAgICAgICAgICAgICAgICAgIHJldHVybiBub2RlO1xuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICovXG5cbiAgICAgICAgICAgICAgdHJpZ2dlclJlbmRlcigpO1xuICAgICAgICAgIH1cbiAgICAgIH0pO1xuXG4gICAgICB2YXIgbG9hZFNwYW5UeXBlcyA9IGZ1bmN0aW9uKHR5cGVzKSB7XG4gICAgICAgICQuZWFjaCh0eXBlcywgZnVuY3Rpb24odHlwZU5vLCB0eXBlKSB7XG4gICAgICAgICAgaWYgKHR5cGUpIHtcbiAgICAgICAgICAgIHNwYW5UeXBlc1t0eXBlLnR5cGVdID0gdHlwZTtcbiAgICAgICAgICAgIHZhciBjaGlsZHJlbiA9IHR5cGUuY2hpbGRyZW47XG4gICAgICAgICAgICBpZiAoY2hpbGRyZW4gJiYgY2hpbGRyZW4ubGVuZ3RoKSB7XG4gICAgICAgICAgICAgIGxvYWRTcGFuVHlwZXMoY2hpbGRyZW4pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICB9XG5cbiAgICAgIHZhciBsb2FkQXR0cmlidXRlVHlwZXMgPSBmdW5jdGlvbihyZXNwb25zZV90eXBlcykge1xuICAgICAgICB2YXIgcHJvY2Vzc2VkID0ge307XG4gICAgICAgICQuZWFjaChyZXNwb25zZV90eXBlcywgZnVuY3Rpb24oYVR5cGVObywgYVR5cGUpIHtcbiAgICAgICAgICBwcm9jZXNzZWRbYVR5cGUudHlwZV0gPSBhVHlwZTtcbiAgICAgICAgICAvLyBjb3VudCB0aGUgdmFsdWVzOyBpZiBvbmx5IG9uZSwgaXQncyBhIGJvb2xlYW4gYXR0cmlidXRlXG4gICAgICAgICAgdmFyIHZhbHVlcyA9IFtdO1xuICAgICAgICAgIGZvciAodmFyIGkgaW4gYVR5cGUudmFsdWVzKSB7XG4gICAgICAgICAgICBpZiAoYVR5cGUudmFsdWVzLmhhc093blByb3BlcnR5KGkpKSB7XG4gICAgICAgICAgICAgIHZhbHVlcy5wdXNoKGkpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgICBpZiAodmFsdWVzLmxlbmd0aCA9PSAxKSB7XG4gICAgICAgICAgICBhVHlwZS5ib29sID0gdmFsdWVzWzBdO1xuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiBwcm9jZXNzZWQ7XG4gICAgICB9XG5cbiAgICAgIHZhciBsb2FkUmVsYXRpb25UeXBlcyA9IGZ1bmN0aW9uKHJlbGF0aW9uX3R5cGVzKSB7XG4gICAgICAgICQuZWFjaChyZWxhdGlvbl90eXBlcywgZnVuY3Rpb24ocmVsVHlwZU5vLCByZWxUeXBlKSB7XG4gICAgICAgICAgaWYgKHJlbFR5cGUpIHtcbiAgICAgICAgICAgIHJlbGF0aW9uVHlwZXNIYXNoW3JlbFR5cGUudHlwZV0gPSByZWxUeXBlO1xuICAgICAgICAgICAgdmFyIGNoaWxkcmVuID0gcmVsVHlwZS5jaGlsZHJlbjtcbiAgICAgICAgICAgIGlmIChjaGlsZHJlbiAmJiBjaGlsZHJlbi5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgbG9hZFJlbGF0aW9uVHlwZXMoY2hpbGRyZW4pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICB9XG5cbiAgICAgIHZhciBjb2xsZWN0aW9uTG9hZGVkID0gZnVuY3Rpb24ocmVzcG9uc2UpIHtcbiAgICAgICAgaWYgKCFyZXNwb25zZS5leGNlcHRpb24pIHtcbiAgICAgICAgICBzZXRDb2xsZWN0aW9uRGVmYXVsdHMocmVzcG9uc2UpO1xuICAgICAgICAgIGV2ZW50QXR0cmlidXRlVHlwZXMgPSBsb2FkQXR0cmlidXRlVHlwZXMocmVzcG9uc2UuZXZlbnRfYXR0cmlidXRlX3R5cGVzKTtcbiAgICAgICAgICBlbnRpdHlBdHRyaWJ1dGVUeXBlcyA9IGxvYWRBdHRyaWJ1dGVUeXBlcyhyZXNwb25zZS5lbnRpdHlfYXR0cmlidXRlX3R5cGVzKTtcbiAgICAgICAgICBzcGFuVHlwZXMgPSB7fTtcbiAgICAgICAgICBsb2FkU3BhblR5cGVzKHJlc3BvbnNlLmVudGl0eV90eXBlcyk7XG4gICAgICAgICAgbG9hZFNwYW5UeXBlcyhyZXNwb25zZS5ldmVudF90eXBlcyk7XG4gICAgICAgICAgbG9hZFNwYW5UeXBlcyhyZXNwb25zZS51bmNvbmZpZ3VyZWRfdHlwZXMpO1xuICAgICAgICAgIHJlbGF0aW9uVHlwZXNIYXNoID0ge307XG4gICAgICAgICAgbG9hZFJlbGF0aW9uVHlwZXMocmVzcG9uc2UucmVsYXRpb25fdHlwZXMpO1xuICAgICAgICAgIGxvYWRSZWxhdGlvblR5cGVzKHJlc3BvbnNlLnVuY29uZmlndXJlZF90eXBlcyk7XG4gICAgICAgICAgLy8gVE9ETyBYWFg6IGlzbid0IHRoZSBmb2xsb3dpbmcgY29tcGxldGVseSByZWR1bmRhbnQgd2l0aFxuICAgICAgICAgIC8vIGxvYWRSZWxhdGlvblR5cGVzP1xuICAgICAgICAgICQuZWFjaChyZXNwb25zZS5yZWxhdGlvbl90eXBlcywgZnVuY3Rpb24ocmVsVHlwZU5vLCByZWxUeXBlKSB7XG4gICAgICAgICAgICByZWxhdGlvblR5cGVzSGFzaFtyZWxUeXBlLnR5cGVdID0gcmVsVHlwZTtcbiAgICAgICAgICB9KTtcblxuICAgICAgICAgIGRpc3BhdGNoZXIucG9zdCgnc3BhbkFuZEF0dHJpYnV0ZVR5cGVzTG9hZGVkJywgW3NwYW5UeXBlcywgZW50aXR5QXR0cmlidXRlVHlwZXMsIGV2ZW50QXR0cmlidXRlVHlwZXMsIHJlbGF0aW9uVHlwZXNIYXNoXSk7XG5cbiAgICAgICAgICBpc0NvbGxlY3Rpb25Mb2FkZWQgPSB0cnVlO1xuICAgICAgICAgIHRyaWdnZXJSZW5kZXIoKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAvLyBleGNlcHRpb24gb24gY29sbGVjdGlvbiBsb2FkOyBhbGxvdyB2aXN1YWxpemVyX3VpXG4gICAgICAgICAgLy8gY29sbGVjdGlvbkxvYWRlZCB0byBoYW5kbGUgdGhpc1xuICAgICAgICB9XG4gICAgICB9O1xuXG4gICAgICB2YXIgaXNSZWxvYWRPa2F5ID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIC8vIGRvIG5vdCByZWxvYWQgd2hpbGUgdGhlIHVzZXIgaXMgaW4gdGhlIGRpYWxvZ1xuICAgICAgICByZXR1cm4gIWRyYXdpbmc7XG4gICAgICB9O1xuXG4gICAgICAvLyBJZiB3ZSBhcmUgeWV0IHRvIGxvYWQgb3VyIGZvbnRzLCBkaXNwYXRjaCB0aGVtXG4gICAgICBpZiAoIVZpc3VhbGl6ZXIuYXJlRm9udHNMb2FkZWQpIHtcbiAgICAgICAgdmFyIHdlYkZvbnRDb25maWcgPSB7XG4gICAgICAgICAgY3VzdG9tOiB7XG4gICAgICAgICAgICBmYW1pbGllczogW1xuICAgICAgICAgICAgICAnQXN0bG9jaCcsXG4gICAgICAgICAgICAgICdQVCBTYW5zIENhcHRpb24nLFxuICAgICAgICAgICAgICAvLyAgICAgICAgJ1VidW50dScsXG4gICAgICAgICAgICAgICdMaWJlcmF0aW9uIFNhbnMnXG4gICAgICAgICAgICBdLFxuICAgICAgICAgICAgLyogRm9yIHNvbWUgY2FzZXMsIGluIHBhcnRpY3VsYXIgZm9yIGVtYmVkZGluZywgd2UgbmVlZCB0b1xuICAgICAgICAgICAgICBhbGxvdyBmb3IgZm9udHMgYmVpbmcgaG9zdGVkIGVsc2V3aGVyZSAqL1xuICAgICAgICAgICAgdXJsczogd2ViRm9udFVSTHMgIT09IHVuZGVmaW5lZCA/IHdlYkZvbnRVUkxzIDogW1xuICAgICAgICAgICAgICAnc3RhdGljL2ZvbnRzL0FzdGxvY2gtQm9sZC50dGYnLFxuICAgICAgICAgICAgICAnc3RhdGljL2ZvbnRzL1BUX1NhbnMtQ2FwdGlvbi1XZWItUmVndWxhci50dGYnLFxuICAgICAgICAgICAgICAvL1xuICAgICAgICAgICAgICAnc3RhdGljL2ZvbnRzL0xpYmVyYXRpb25fU2Fucy1SZWd1bGFyLnR0ZidcbiAgICAgICAgICAgIF0sXG4gICAgICAgICAgfSxcbiAgICAgICAgICBhY3RpdmU6IHByb2NlZWRXaXRoRm9udHMsXG4gICAgICAgICAgaW5hY3RpdmU6IHByb2NlZWRXaXRoRm9udHMsXG4gICAgICAgICAgZm9udGFjdGl2ZTogZnVuY3Rpb24oZm9udEZhbWlseSwgZm9udERlc2NyaXB0aW9uKSB7XG4gICAgICAgICAgICAvLyBOb3RlOiBFbmFibGUgZm9yIGZvbnQgZGVidWdnaW5nXG4gICAgICAgICAgICAvL2NvbnNvbGUubG9nKFwiZm9udCBhY3RpdmU6IFwiLCBmb250RmFtaWx5LCBmb250RGVzY3JpcHRpb24pO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgZm9udGxvYWRpbmc6IGZ1bmN0aW9uKGZvbnRGYW1pbHksIGZvbnREZXNjcmlwdGlvbikge1xuICAgICAgICAgICAgLy8gTm90ZTogRW5hYmxlIGZvciBmb250IGRlYnVnZ2luZ1xuICAgICAgICAgICAgLy9jb25zb2xlLmxvZyhcImZvbnQgbG9hZGluZzpcIiwgZm9udEZhbWlseSwgZm9udERlc2NyaXB0aW9uKTtcbiAgICAgICAgICB9LFxuICAgICAgICB9O1xuICAgICAgICBXZWJGb250LmxvYWQod2ViRm9udENvbmZpZyk7XG4gICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgaWYgKCFWaXN1YWxpemVyLmFyZUZvbnRzTG9hZGVkKSB7XG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKCdUaW1lb3V0IGluIGxvYWRpbmcgZm9udHMnKTtcbiAgICAgICAgICAgIHByb2NlZWRXaXRoRm9udHMoKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0sIGZvbnRMb2FkVGltZW91dCk7XG4gICAgICB9XG5cbiAgICAgIGRpc3BhdGNoZXIuXG4gICAgICAgICAgb24oJ2NvbGxlY3Rpb25DaGFuZ2VkJywgY29sbGVjdGlvbkNoYW5nZWQpLlxuICAgICAgICAgIG9uKCdjb2xsZWN0aW9uTG9hZGVkJywgY29sbGVjdGlvbkxvYWRlZCkuXG4gICAgICAgICAgb24oJ3JlbmRlckRhdGEnLCByZW5kZXJEYXRhKS5cbiAgICAgICAgICBvbigndHJpZ2dlclJlbmRlcicsIHRyaWdnZXJSZW5kZXIpLlxuICAgICAgICAgIG9uKCdyZXF1ZXN0UmVuZGVyRGF0YScsIHJlcXVlc3RSZW5kZXJEYXRhKS5cbiAgICAgICAgICBvbignaXNSZWxvYWRPa2F5JywgaXNSZWxvYWRPa2F5KS5cbiAgICAgICAgICBvbigncmVzZXREYXRhJywgcmVzZXREYXRhKS5cbiAgICAgICAgICBvbignYWJicmV2cycsIHNldEFiYnJldnMpLlxuICAgICAgICAgIG9uKCd0ZXh0QmFja2dyb3VuZHMnLCBzZXRUZXh0QmFja2dyb3VuZHMpLlxuICAgICAgICAgIG9uKCdsYXlvdXREZW5zaXR5Jywgc2V0TGF5b3V0RGVuc2l0eSkuXG4gICAgICAgICAgb24oJ3N2Z1dpZHRoJywgc2V0U3ZnV2lkdGgpLlxuICAgICAgICAgIG9uKCdjdXJyZW50JywgZ290Q3VycmVudCkuXG4gICAgICAgICAgb24oJ2NsZWFyU1ZHJywgY2xlYXJTVkcpLlxuICAgICAgICAgIG9uKCdtb3VzZW92ZXInLCBvbk1vdXNlT3ZlcikuXG4gICAgICAgICAgb24oJ21vdXNlb3V0Jywgb25Nb3VzZU91dCk7XG4gICAgfTtcblxuICAgIFZpc3VhbGl6ZXIuYXJlRm9udHNMb2FkZWQgPSBmYWxzZTtcblxuICAgIHZhciBwcm9jZWVkV2l0aEZvbnRzID0gZnVuY3Rpb24oKSB7XG4gICAgICBWaXN1YWxpemVyLmFyZUZvbnRzTG9hZGVkID0gdHJ1ZTtcbiAgICAgIC8vIE5vdGU6IEVuYWJsZSBmb3IgZm9udCBkZWJ1Z2dpbmdcbiAgICAgIC8vY29uc29sZS5sb2coXCJmb250cyBkb25lXCIpO1xuICAgICAgRGlzcGF0Y2hlci5wb3N0KCd0cmlnZ2VyUmVuZGVyJyk7XG4gICAgfTtcblxuICAgIHJldHVybiBWaXN1YWxpemVyO1xufSkoalF1ZXJ5LCB3aW5kb3cpO1xuXG4vLyBCUkFUIFNUQU5EQUxPTkUgTElCUkFSWSBCRUdJTlxuLy8gQnJvd3NlcmlmeSBleHBvcnRcbm1vZHVsZS5leHBvcnRzID0gVmlzdWFsaXplcjtcbi8vIEJSQVQgU1RBTkRBTE9ORSBMSUJSQVJZIEVORFxuIiwiLy8gLSotIE1vZGU6IEphdmFTY3JpcHQ7IHRhYi13aWR0aDogMjsgaW5kZW50LXRhYnMtbW9kZTogbmlsOyAtKi1cbi8vIHZpbTpzZXQgZnQ9amF2YXNjcmlwdCB0cz0yIHN3PTIgc3RzPTIgY2luZGVudDpcbnZhciBWaXN1YWxpemVyVUkgPSAoZnVuY3Rpb24oJCwgd2luZG93LCB1bmRlZmluZWQpIHtcbiAgICB2YXIgVmlzdWFsaXplclVJID0gZnVuY3Rpb24oZGlzcGF0Y2hlciwgc3ZnLCBzaG93VG9vbHRpcCwgb3ZlcldyaXRlTW9kYWxzKSB7XG4gICAgICB2YXIgdGhhdCA9IHRoaXM7XG5cbiAgICAgIHZhciBtZXNzYWdlUG9zdE91dEZhZGVEZWxheSA9IDEwMDA7XG4gICAgICB2YXIgbWVzc2FnZURlZmF1bHRGYWRlRGVsYXkgPSAzMDAwO1xuICAgICAgdmFyIGRlZmF1bHRGbG9hdEZvcm1hdCA9ICclLjFmL3JpZ2h0JztcblxuICAgICAgdmFyIGRvY3VtZW50TGlzdGluZyA9IG51bGw7IC8vIGFsd2F5cyBkb2N1bWVudHMgb2YgY3VycmVudCBjb2xsZWN0aW9uXG4gICAgICB2YXIgc2VsZWN0b3JEYXRhID0gbnVsbDsgICAgLy8gY2FuIGJlIHNlYXJjaCByZXN1bHRzIHdoZW4gYXZhaWxhYmxlXG4gICAgICB2YXIgc2VhcmNoQWN0aXZlID0gZmFsc2U7ICAgLy8gd2hldGhlciBzZWFyY2ggcmVzdWx0cyByZWNlaXZlZCBhbmQgaW4gdXNlXG4gICAgICB2YXIgbG9hZGVkU2VhcmNoRGF0YSA9IG51bGw7XG5cbiAgICAgIHZhciBjdXJyZW50Rm9ybTtcbiAgICAgIHZhciBzcGFuVHlwZXMgPSBudWxsO1xuICAgICAgdmFyIHJlbGF0aW9uVHlwZXNIYXNoID0gbnVsbDtcbiAgICAgIC8vIFRPRE86IGNvbmZpcm0gdW5uZWNlc3NhcnkgYW5kIHJlbW92ZVxuLy8gICAgICAgdmFyIGF0dHJpYnV0ZVR5cGVzID0gbnVsbDtcbiAgICAgIHZhciBkYXRhID0gbnVsbDtcbiAgICAgIHZhciBtdGltZSA9IG51bGw7XG4gICAgICB2YXIgc2VhcmNoQ29uZmlnID0gbnVsbDtcbiAgICAgIHZhciBjb2xsLCBkb2MsIGFyZ3M7XG4gICAgICB2YXIgY29sbFNjcm9sbDtcbiAgICAgIHZhciBkb2NTY3JvbGw7XG4gICAgICB2YXIgdXNlciA9IG51bGw7XG4gICAgICB2YXIgYW5ub3RhdGlvbkF2YWlsYWJsZSA9IGZhbHNlO1xuXG4gICAgICB2YXIgc3ZnRWxlbWVudCA9ICQoc3ZnLl9zdmcpO1xuICAgICAgdmFyIHN2Z0lkID0gc3ZnRWxlbWVudC5wYXJlbnQoKS5hdHRyKCdpZCcpO1xuXG4gICAgICB2YXIgbWF4TWVzc2FnZXMgPSAxMDA7XG5cbiAgICAgIHZhciBjdXJyZW50RG9jdW1lbnRTVkdzYXZlZCA9IGZhbHNlO1xuICAgICAgdmFyIGZpbGVCcm93c2VyQ2xvc2VkV2l0aFN1Ym1pdCA9IGZhbHNlO1xuXG4gICAgICAvLyBub3JtYWxpemF0aW9uOiBzZXJ2ZXItc2lkZSBEQiBieSBub3JtIERCIG5hbWVcbiAgICAgIHZhciBub3JtU2VydmVyRGJCeU5vcm1EYk5hbWUgPSB7fTtcblxuICAgICAgdmFyIG1hdGNoRm9jdXMgPSAnJztcbiAgICAgIHZhciBtYXRjaGVzID0gJyc7XG5cbiAgICAgIC8qIFNUQVJUIFwibm8gc3ZnXCIgbWVzc2FnZSAtIHJlbGF0ZWQgKi9cblxuICAgICAgdmFyIG5vU3ZnVGltZXIgPSBudWxsO1xuXG4gICAgICAvLyB0aGlzIGlzIG5lY2Vzc2FyeSBmb3IgY2VudGVyaW5nXG4gICAgICAkKCcjbm9fc3ZnX3dyYXBwZXInKS5jc3MoJ2Rpc3BsYXknLCAndGFibGUnKTtcbiAgICAgIC8vIG9uIGluaXRpYWwgbG9hZCwgaGlkZSB0aGUgXCJubyBTVkdcIiBtZXNzYWdlXG4gICAgICAkKCcjbm9fc3ZnX3dyYXBwZXInKS5oaWRlKCk7XG5cbiAgICAgIHZhciBoaWRlTm9Eb2NNZXNzYWdlID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIGNsZWFyVGltZW91dChub1N2Z1RpbWVyKTtcbiAgICAgICAgJCgnI25vX3N2Z193cmFwcGVyJykuaGlkZSgwKTtcbiAgICAgICAgJCgnI3NvdXJjZV9maWxlcycpLnNob3coKTtcbiAgICAgIH1cblxuICAgICAgdmFyIHNob3dOb0RvY01lc3NhZ2UgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgY2xlYXJUaW1lb3V0KG5vU3ZnVGltZXIpO1xuICAgICAgICBub1N2Z1RpbWVyID0gc2V0VGltZW91dChmdW5jdGlvbigpIHtcbiAgICAgICAgICAkKCcjbm9fc3ZnX3dyYXBwZXInKS5mYWRlSW4oNTAwKTtcbiAgICAgICAgfSwgMjAwMCk7XG4gICAgICAgICQoJyNzb3VyY2VfZmlsZXMnKS5oaWRlKCk7XG4gICAgICB9XG4gICAgICBcbiAgICAgIC8qIEVORCBcIm5vIHN2Z1wiIG1lc3NhZ2UgLSByZWxhdGVkICovXG5cbiAgICAgIC8qIFNUQVJUIGNvbGxlY3Rpb24gYnJvd3NlciBzb3J0aW5nIC0gcmVsYXRlZCAqL1xuXG4gICAgICB2YXIgbGFzdEdvb2RDb2xsZWN0aW9uID0gJy8nO1xuICAgICAgdmFyIHNvcnRPcmRlciA9IFsyLCAxXTsgLy8gY29sdW1uICgwLi4pLCBzb3J0IG9yZGVyICgxLCAtMSlcbiAgICAgIHZhciBjb2xsZWN0aW9uU29ydE9yZGVyOyAvLyBob2xkcyBwcmV2aW91cyBzb3J0IHdoaWxlIHNlYXJjaCBpcyBhY3RpdmVcbiAgICAgIHZhciBkb2NTb3J0RnVuY3Rpb24gPSBmdW5jdGlvbihhLCBiKSB7XG4gICAgICAgICAgLy8gcGFyZW50IGF0IHRoZSB0b3BcbiAgICAgICAgICBpZiAoYVsyXSA9PT0gJy4uJykgcmV0dXJuIC0xO1xuICAgICAgICAgIGlmIChiWzJdID09PSAnLi4nKSByZXR1cm4gMTtcblxuICAgICAgICAgIC8vIHRoZW4gb3RoZXIgY29sbGVjdGlvbnNcbiAgICAgICAgICB2YXIgYUlzQ29sbCA9IGFbMF0gPT0gXCJjXCI7XG4gICAgICAgICAgdmFyIGJJc0NvbGwgPSBiWzBdID09IFwiY1wiO1xuICAgICAgICAgIGlmIChhSXNDb2xsICE9PSBiSXNDb2xsKSByZXR1cm4gYUlzQ29sbCA/IC0xIDogMTtcblxuICAgICAgICAgIC8vIGRlc2lyZWQgY29sdW1uIGluIHRoZSBkZXNpcmVkIG9yZGVyXG4gICAgICAgICAgdmFyIGNvbCA9IHNvcnRPcmRlclswXTtcbiAgICAgICAgICB2YXIgYWEgPSBhW2NvbF07XG4gICAgICAgICAgdmFyIGJiID0gYltjb2xdO1xuICAgICAgICAgIGlmIChzZWxlY3RvckRhdGEuaGVhZGVyW2NvbCAtIDJdWzFdID09PSAnc3RyaW5nLXJldmVyc2UnKSB7XG4gICAgICAgICAgICBhYSA9IGFhLnNwbGl0KCcnKS5yZXZlcnNlKCkuam9pbignJyk7XG4gICAgICAgICAgICBiYiA9IGJiLnNwbGl0KCcnKS5yZXZlcnNlKCkuam9pbignJyk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGlmIChhYSAhPSBiYikgcmV0dXJuIChhYSA8IGJiKSA/IC1zb3J0T3JkZXJbMV0gOiBzb3J0T3JkZXJbMV07XG5cbiAgICAgICAgICAvLyBwcmV2ZW50IHJhbmRvbSBzaHVmZmxlcyBvbiBjb2x1bW5zIHdpdGggZHVwbGljYXRlIHZhbHVlc1xuICAgICAgICAgIC8vIChhbHBoYWJldGljYWwgb3JkZXIgb2YgZG9jdW1lbnRzKVxuICAgICAgICAgIGFhID0gYVsyXTtcbiAgICAgICAgICBiYiA9IGJbMl07XG4gICAgICAgICAgaWYgKGFhICE9IGJiKSByZXR1cm4gKGFhIDwgYmIpID8gLTEgOiAxO1xuICAgICAgICAgIHJldHVybiAwO1xuICAgICAgfTtcblxuICAgICAgdmFyIG1ha2VTb3J0Q2hhbmdlRnVuY3Rpb24gPSBmdW5jdGlvbihzb3J0LCB0aCwgdGhObykge1xuICAgICAgICAgICQodGgpLmNsaWNrKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAvLyBUT0RPOiBhdm9pZCBtYWdpYyBudW1iZXJzIGluIGFjY2VzcyB0byB0aGUgc2VsZWN0b3JcbiAgICAgICAgICAgICAgLy8gZGF0YSAoY29sdW1uIDAgaXMgdHlwZSwgMSBpcyBhcmdzLCByZXN0IGlzIGRhdGEpXG4gICAgICAgICAgICAgIGlmIChzb3J0WzBdID09PSB0aE5vICsgMSkgc29ydFsxXSA9IC1zb3J0WzFdO1xuICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICB2YXIgdHlwZSA9IHNlbGVjdG9yRGF0YS5oZWFkZXJbdGhObyAtIDFdWzFdO1xuICAgICAgICAgICAgICAgIHZhciBhc2NlbmRpbmcgPSB0eXBlID09PSBcInN0cmluZ1wiO1xuICAgICAgICAgICAgICAgIHNvcnRbMF0gPSB0aE5vICsgMTtcbiAgICAgICAgICAgICAgICBzb3J0WzFdID0gYXNjZW5kaW5nID8gMSA6IC0xO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIHNlbGVjdG9yRGF0YS5pdGVtcy5zb3J0KGRvY1NvcnRGdW5jdGlvbik7XG4gICAgICAgICAgICAgIGRvY1Njcm9sbCA9IDA7XG4gICAgICAgICAgICAgIHNob3dGaWxlQnJvd3NlcigpOyAvLyByZXNvcnRcbiAgICAgICAgICB9KTtcbiAgICAgIH1cblxuICAgICAgLyogRU5EIGNvbGxlY3Rpb24gYnJvd3NlciBzb3J0aW5nIC0gcmVsYXRlZCAqL1xuXG5cbiAgICAgIC8qIFNUQVJUIG1lc3NhZ2UgZGlzcGxheSAtIHJlbGF0ZWQgKi9cblxuICAgICAgdmFyIHNob3dQdWxsdXBUcmlnZ2VyID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICQoJyNwdWxsdXB0cmlnZ2VyJykuc2hvdygncHVmZicpO1xuICAgICAgfVxuXG4gICAgICB2YXIgJG1lc3NhZ2VDb250YWluZXIgPSAkKCcjbWVzc2FnZXMnKTtcbiAgICAgIHZhciAkbWVzc2FnZXB1bGx1cCA9ICQoJyNtZXNzYWdlcHVsbHVwJyk7XG4gICAgICB2YXIgcHVsbHVwVGltZXIgPSBudWxsO1xuICAgICAgdmFyIGRpc3BsYXlNZXNzYWdlcyA9IGZ1bmN0aW9uKG1zZ3MpIHtcbiAgICAgICAgdmFyIGluaXRpYWxNZXNzYWdlTnVtID0gJG1lc3NhZ2VwdWxsdXAuY2hpbGRyZW4oKS5sZW5ndGg7XG5cbiAgICAgICAgaWYgKG1zZ3MgPT09IGZhbHNlKSB7XG4gICAgICAgICAgJG1lc3NhZ2VDb250YWluZXIuY2hpbGRyZW4oKS5lYWNoKGZ1bmN0aW9uKG1zZ0VsTm8sIG1zZ0VsKSB7XG4gICAgICAgICAgICAgICQobXNnRWwpLnJlbW92ZSgpO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICQuZWFjaChtc2dzLCBmdW5jdGlvbihtc2dObywgbXNnKSB7XG4gICAgICAgICAgICB2YXIgZWxlbWVudDtcbiAgICAgICAgICAgIHZhciB0aW1lciA9IG51bGw7XG4gICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICBlbGVtZW50ID0gJCgnPGRpdiBjbGFzcz1cIicgKyBtc2dbMV0gKyAnXCI+JyArIG1zZ1swXSArICc8L2Rpdj4nKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNhdGNoKHgpIHtcbiAgICAgICAgICAgICAgZXNjYXBlZCA9IG1zZ1swXS5yZXBsYWNlKC8mL2csIFwiJmFtcDtcIikucmVwbGFjZSgvPC9nLCBcIiZsdDtcIikucmVwbGFjZSgvPi9nLCBcIiZndDtcIik7XG4gICAgICAgICAgICAgIGVsZW1lbnQgPSAkKCc8ZGl2IGNsYXNzPVwiZXJyb3JcIj48Yj5bRVJST1I6IGNvdWxkIG5vdCBkaXNwbGF5IHRoZSBmb2xsb3dpbmcgbWVzc2FnZSBub3JtYWxseSBkdWUgdG8gbWFsZm9ybWVkIFhNTDpdPC9iPjxici8+JyArIGVzY2FwZWQgKyAnPC9kaXY+Jyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB2YXIgcHVsbHVwRWxlbWVudCA9IGVsZW1lbnQuY2xvbmUoKTtcbiAgICAgICAgICAgICRtZXNzYWdlQ29udGFpbmVyLmFwcGVuZChlbGVtZW50KTtcbiAgICAgICAgICAgICRtZXNzYWdlcHVsbHVwLmFwcGVuZChwdWxsdXBFbGVtZW50LmNzcygnZGlzcGxheScsICdub25lJykpO1xuICAgICAgICAgICAgc2xpZGVUb2dnbGUocHVsbHVwRWxlbWVudCwgdHJ1ZSwgdHJ1ZSk7XG5cbiAgICAgICAgICAgIHZhciBmYWRlciA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICBpZiAoJG1lc3NhZ2VwdWxsdXAuaXMoJzp2aXNpYmxlJykpIHtcbiAgICAgICAgICAgICAgICBlbGVtZW50LnJlbW92ZSgpO1xuICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGVsZW1lbnQuaGlkZSgnc2xvdycsIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgZWxlbWVudC5yZW1vdmUoKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIHZhciBkZWxheSA9IChtc2dbMl0gPT09IHVuZGVmaW5lZClcbiAgICAgICAgICAgICAgICAgICAgICAgICAgPyBtZXNzYWdlRGVmYXVsdEZhZGVEZWxheVxuICAgICAgICAgICAgICAgICAgICAgICAgICA6IChtc2dbMl0gPT09IC0xKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPyBudWxsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICA6IChtc2dbMl0gKiAxMDAwKTtcbiAgICAgICAgICAgIGlmIChkZWxheSA9PT0gbnVsbCkge1xuICAgICAgICAgICAgICB2YXIgYnV0dG9uID0gJCgnPGlucHV0IHR5cGU9XCJidXR0b25cIiB2YWx1ZT1cIk9LXCIvPicpO1xuICAgICAgICAgICAgICBlbGVtZW50LnByZXBlbmQoYnV0dG9uKTtcbiAgICAgICAgICAgICAgYnV0dG9uLmNsaWNrKGZ1bmN0aW9uKGV2dCkge1xuICAgICAgICAgICAgICAgIHRpbWVyID0gc2V0VGltZW91dChmYWRlciwgMCk7XG4gICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgdGltZXIgPSBzZXRUaW1lb3V0KGZhZGVyLCBkZWxheSk7XG4gICAgICAgICAgICAgIGVsZW1lbnQubW91c2VvdmVyKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgY2xlYXJUaW1lb3V0KHRpbWVyKTtcbiAgICAgICAgICAgICAgICAgIGVsZW1lbnQuc2hvdygpO1xuICAgICAgICAgICAgICB9KS5tb3VzZW91dChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgIHRpbWVyID0gc2V0VGltZW91dChmYWRlciwgbWVzc2FnZVBvc3RPdXRGYWRlRGVsYXkpO1xuICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8vIHNldFRpbWVvdXQoZmFkZXIsIG1lc3NhZ2VEZWZhdWx0RmFkZURlbGF5KTtcbiAgICAgICAgICB9KTtcblxuICAgICAgICAgIC8vIGxpbWl0ZWQgaGlzdG9yeSAtIGRlbGV0ZSBvbGRlc3RcbiAgICAgICAgICB2YXIgJG1lc3NhZ2VzID0gJG1lc3NhZ2VwdWxsdXAuY2hpbGRyZW4oKTtcbiAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8ICRtZXNzYWdlcy5sZW5ndGggLSBtYXhNZXNzYWdlczsgaSsrKSB7XG4gICAgICAgICAgICAkKCRtZXNzYWdlc1tpXSkucmVtb3ZlKCk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgLy8gaWYgdGhlcmUgaXMgY2hhbmdlIGluIHRoZSBudW1iZXIgb2YgbWVzc2FnZXMsIG1heSBuZWVkIHRvXG4gICAgICAgIC8vIHR3ZWFrIHRyaWdnZXIgdmlzaWJpbGl0eVxuICAgICAgICB2YXIgbWVzc2FnZU51bSA9ICRtZXNzYWdlcHVsbHVwLmNoaWxkcmVuKCkubGVuZ3RoO1xuICAgICAgICBpZiAobWVzc2FnZU51bSAhPSBpbml0aWFsTWVzc2FnZU51bSkge1xuICAgICAgICAgIGlmIChtZXNzYWdlTnVtID09IDApIHtcbiAgICAgICAgICAgIC8vIGFsbCBnb25lOyBub3RoaW5nIHRvIHRyaWdnZXJcbiAgICAgICAgICAgICQoJyNwdWxsdXB0cmlnZ2VyJykuaGlkZSgnc2xvdycpO1xuICAgICAgICAgIH0gZWxzZSBpZiAoaW5pdGlhbE1lc3NhZ2VOdW0gPT0gMCkge1xuICAgICAgICAgICAgLy8gZmlyc3QgbWVzc2FnZXMsIHNob3cgdHJpZ2dlciBhdCBmYWRlXG4gICAgICAgICAgICBzZXRUaW1lb3V0KHNob3dQdWxsdXBUcmlnZ2VyLCBtZXNzYWdlRGVmYXVsdEZhZGVEZWxheSsyNTApO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfTtcblxuICAgICAgLy8gaGlkZSBwdWxsdXAgdHJpZ2dlciBieSBkZWZhdWx0LCBzaG93IG9uIGZpcnN0IG1lc3NhZ2VcbiAgICAgICQoJyNwdWxsdXB0cmlnZ2VyJykuaGlkZSgpO1xuICAgICAgJCgnI3B1bGx1cHRyaWdnZXInKS5cbiAgICAgICAgbW91c2VlbnRlcihmdW5jdGlvbihldnQpIHtcbiAgICAgICAgICAkKCcjcHVsbHVwdHJpZ2dlcicpLmhpZGUoJ3B1ZmYnKTtcbiAgICAgICAgICBjbGVhclRpbWVvdXQocHVsbHVwVGltZXIpO1xuICAgICAgICAgIHNsaWRlVG9nZ2xlKCRtZXNzYWdlcHVsbHVwLnN0b3AoKSwgdHJ1ZSwgdHJ1ZSwgdHJ1ZSk7XG4gICAgICAgIH0pO1xuICAgICAgJCgnI21lc3NhZ2VwdWxsdXAnKS5cbiAgICAgICAgbW91c2VsZWF2ZShmdW5jdGlvbihldnQpIHtcbiAgICAgICAgICBzZXRUaW1lb3V0KHNob3dQdWxsdXBUcmlnZ2VyLCA1MDApO1xuICAgICAgICAgIGNsZWFyVGltZW91dChwdWxsdXBUaW1lcik7XG4gICAgICAgICAgcHVsbHVwVGltZXIgPSBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgc2xpZGVUb2dnbGUoJG1lc3NhZ2VwdWxsdXAuc3RvcCgpLCBmYWxzZSwgdHJ1ZSwgdHJ1ZSk7XG4gICAgICAgICAgfSwgNTAwKTtcbiAgICAgICAgfSk7XG5cblxuICAgICAgLyogRU5EIG1lc3NhZ2UgZGlzcGxheSAtIHJlbGF0ZWQgKi9cblxuXG4gICAgICAvKiBTVEFSVCBjb21tZW50IHBvcHVwIC0gcmVsYXRlZCAqL1xuXG4gICAgICB2YXIgYWRqdXN0VG9DdXJzb3IgPSBmdW5jdGlvbihldnQsIGVsZW1lbnQsIG9mZnNldCwgdG9wLCByaWdodCkge1xuICAgICAgICAvLyBnZXQgdGhlIHJlYWwgd2lkdGgsIHdpdGhvdXQgd3JhcHBpbmdcbiAgICAgICAgZWxlbWVudC5jc3MoeyBsZWZ0OiAwLCB0b3A6IDAgfSk7XG4gICAgICAgIHZhciBzY3JlZW5IZWlnaHQgPSAkKHdpbmRvdykuaGVpZ2h0KCk7XG4gICAgICAgIHZhciBzY3JlZW5XaWR0aCA9ICQod2luZG93KS53aWR0aCgpO1xuICAgICAgICAvLyBGSVhNRSB3aHkgdGhlIGhlbGwgaXMgdGhpcyAyMiBuZWNlc3Nhcnk/IT9cbiAgICAgICAgdmFyIGVsZW1lbnRIZWlnaHQgPSBlbGVtZW50LmhlaWdodCgpICsgMjI7XG4gICAgICAgIHZhciBlbGVtZW50V2lkdGggPSBlbGVtZW50LndpZHRoKCkgKyAyMjtcbiAgICAgICAgdmFyIHgsIHk7XG4gICAgICAgIG9mZnNldCA9IG9mZnNldCB8fCAwO1xuICAgICAgICBpZiAodG9wKSB7XG4gICAgICAgICAgeSA9IGV2dC5jbGllbnRZIC0gZWxlbWVudEhlaWdodCAtIG9mZnNldDtcbiAgICAgICAgICBpZiAoeSA8IDApIHRvcCA9IGZhbHNlO1xuICAgICAgICB9XG4gICAgICAgIGlmICghdG9wKSB7XG4gICAgICAgICAgeSA9IGV2dC5jbGllbnRZICsgb2Zmc2V0O1xuICAgICAgICB9XG4gICAgICAgIGlmIChyaWdodCkge1xuICAgICAgICAgIHggPSBldnQuY2xpZW50WCArIG9mZnNldDtcbiAgICAgICAgICBpZiAoeCA+PSBzY3JlZW5XaWR0aCAtIGVsZW1lbnRXaWR0aCkgcmlnaHQgPSBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoIXJpZ2h0KSB7XG4gICAgICAgICAgeCA9IGV2dC5jbGllbnRYIC0gZWxlbWVudFdpZHRoIC0gb2Zmc2V0O1xuICAgICAgICB9XG4gICAgICAgIGlmICh5IDwgMCkgeSA9IDA7XG4gICAgICAgIGlmICh4IDwgMCkgeCA9IDA7XG4gICAgICAgIGVsZW1lbnQuY3NzKHsgdG9wOiB5LCBsZWZ0OiB4IH0pO1xuICAgICAgfTtcblxuICAgICAgdmFyIGNvbW1lbnRQb3B1cCA9ICQoJyNjb21tZW50cG9wdXAnKTtcbiAgICAgIHZhciBjb21tZW50RGlzcGxheWVkID0gZmFsc2U7XG5cbiAgICAgIHZhciBkaXNwbGF5Q29tbWVudFRpbWVyID0gbnVsbDtcbiAgICAgIHZhciBkaXNwbGF5Q29tbWVudCA9IGZ1bmN0aW9uKGV2dCwgdGFyZ2V0LCBjb21tZW50LCBjb21tZW50VGV4dCwgY29tbWVudFR5cGUsIGltbWVkaWF0ZWx5KSB7XG4gICAgICAgIHZhciBpZHR5cGU7XG4gICAgICAgIGlmIChjb21tZW50VHlwZSkge1xuICAgICAgICAgIC8vIGxhYmVsIGNvbW1lbnQgYnkgdHlwZSwgd2l0aCBzcGVjaWFsIGNhc2UgZm9yIGRlZmF1bHQgbm90ZSB0eXBlXG4gICAgICAgICAgdmFyIGNvbW1lbnRMYWJlbDtcbiAgICAgICAgICBpZiAoY29tbWVudFR5cGUgPT0gJ0Fubm90YXRvck5vdGVzJykge1xuICAgICAgICAgICAgY29tbWVudExhYmVsID0gJzxiPk5vdGU6PC9iPiAnO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBjb21tZW50TGFiZWwgPSAnPGI+JytVdGlsLmVzY2FwZUhUTUwoY29tbWVudFR5cGUpKyc6PC9iPiAnO1xuICAgICAgICAgIH1cbiAgICAgICAgICBjb21tZW50ICs9IGNvbW1lbnRMYWJlbCArIFV0aWwuZXNjYXBlSFRNTHdpdGhOZXdsaW5lcyhjb21tZW50VGV4dCk7XG4gICAgICAgICAgaWR0eXBlID0gJ2NvbW1lbnRfJyArIGNvbW1lbnRUeXBlO1xuICAgICAgICB9XG4gICAgICAgIGNvbW1lbnRQb3B1cFswXS5jbGFzc05hbWUgPSBpZHR5cGU7XG4gICAgICAgIGNvbW1lbnRQb3B1cC5odG1sKGNvbW1lbnQpO1xuICAgICAgICBpZihzaG93VG9vbHRpcCkge1xuICAgICAgICAgIGFkanVzdFRvQ3Vyc29yKGV2dCwgY29tbWVudFBvcHVwLCAxMCwgdHJ1ZSwgdHJ1ZSk7XG4gICAgICAgICAgY2xlYXJUaW1lb3V0KGRpc3BsYXlDb21tZW50VGltZXIpO1xuICAgICAgICAgIC8qIHNsaWdodCBcInRvb2x0aXBcIiBkZWxheSB0byBhbGxvdyBoaWdobGlnaHRzIHRvIGJlIHNlZW5cbiAgICAgICAgICAgYmVmb3JlIHRoZSBwb3B1cCBvYnN0cnVjdHMgdGhlbS4gKi9cbiAgICAgICAgICBkaXNwbGF5Q29tbWVudFRpbWVyID0gc2V0VGltZW91dChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIGNvbW1lbnRQb3B1cC5zdG9wKHRydWUsIHRydWUpLmZhZGVJbigpO1xuICAgICAgICAgICAgY29tbWVudERpc3BsYXllZCA9IHRydWU7XG4gICAgICAgICAgfSwgaW1tZWRpYXRlbHkgPyAwIDogNTAwKTtcbiAgICAgICAgfVxuICAgICAgfTtcblxuICAgICAgLy8gdG8gYXZvaWQgY2xvYmJlcmluZyBvbiBkZWxheWVkIHJlc3BvbnNlXG4gICAgICB2YXIgY29tbWVudFBvcHVwTm9ybUluZm9TZXFJZCA9IDA7XG5cbiAgICAgIHZhciBub3JtSW5mb1NvcnRGdW5jdGlvbiA9IGZ1bmN0aW9uKGEsIGIpIHtcbiAgICAgICAgLy8gaW1hZ2VzIGF0IHRoZSB0b3BcbiAgICAgICAgaWYgKGFbMF0udG9Mb3dlckNhc2UoKSA9PSAnPGltZz4nKSByZXR1cm4gLTE7XG4gICAgICAgIGlmIChiWzBdLnRvTG93ZXJDYXNlKCkgPT0gJzxpbWc+JykgcmV0dXJuIDE7XG4gICAgICAgIC8vIG90aGVyd2lzZSBzdGFibGVcbiAgICAgICAgcmV0dXJuIFV0aWwuY21wKGFbMl0sYlsyXSk7XG4gICAgICB9XG5cbiAgICAgIHZhciBkaXNwbGF5U3BhbkNvbW1lbnQgPSBmdW5jdGlvbihcbiAgICAgICAgICBldnQsIHRhcmdldCwgc3BhbklkLCBzcGFuVHlwZSwgbW9kcywgc3BhblRleHQsIGNvbW1lbnRUZXh0LCBcbiAgICAgICAgICBjb21tZW50VHlwZSwgbm9ybWFsaXphdGlvbnMpIHtcblxuICAgICAgICB2YXIgaW1tZWRpYXRlbHkgPSBmYWxzZTtcbiAgICAgICAgdmFyIGNvbW1lbnQgPSAoICc8ZGl2PjxzcGFuIGNsYXNzPVwiY29tbWVudF90eXBlX2lkX3dyYXBwZXJcIj4nICtcbiAgICAgICAgICAgICAgICAgICAgICAgICc8c3BhbiBjbGFzcz1cImNvbW1lbnRfdHlwZVwiPicgK1xuICAgICAgICAgICAgICAgICAgICAgICAgVXRpbC5lc2NhcGVIVE1MKFV0aWwuc3BhbkRpc3BsYXlGb3JtKHNwYW5UeXBlcyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzcGFuVHlwZSkpICtcbiAgICAgICAgICAgICAgICAgICAgICAgICc8L3NwYW4+JyArXG4gICAgICAgICAgICAgICAgICAgICAgICAnICcgK1xuICAgICAgICAgICAgICAgICAgICAgICAgJzxzcGFuIGNsYXNzPVwiY29tbWVudF9pZFwiPicgK1xuICAgICAgICAgICAgICAgICAgICAgICAgJ0lEOicrVXRpbC5lc2NhcGVIVE1MKHNwYW5JZCkgK1xuICAgICAgICAgICAgICAgICAgICAgICAgJzwvc3Bhbj48L3NwYW4+JyApO1xuICAgICAgICBpZiAobW9kcy5sZW5ndGgpIHtcbiAgICAgICAgICBjb21tZW50ICs9ICc8ZGl2PicgKyBVdGlsLmVzY2FwZUhUTUwobW9kcy5qb2luKCcsICcpKSArICc8L2Rpdj4nO1xuICAgICAgICB9XG5cbiAgICAgICAgY29tbWVudCArPSAnPC9kaXY+JztcbiAgICAgICAgY29tbWVudCArPSAoJzxkaXYgY2xhc3M9XCJjb21tZW50X3RleHRcIj5cIicgKyBcbiAgICAgICAgICAgICAgICAgICAgVXRpbC5lc2NhcGVIVE1MKHNwYW5UZXh0KSArIFxuICAgICAgICAgICAgICAgICAgICAnXCI8L2Rpdj4nKTtcbiAgICAgICAgdmFyIHZhbGlkQXJjVHlwZXNGb3JEcmFnID0gZGlzcGF0Y2hlci5wb3N0KCdnZXRWYWxpZEFyY1R5cGVzRm9yRHJhZycsIFtzcGFuSWQsIHNwYW5UeXBlXSk7XG4gICAgICAgIGlmICh2YWxpZEFyY1R5cGVzRm9yRHJhZyAmJiB2YWxpZEFyY1R5cGVzRm9yRHJhZ1swXSkge1xuICAgICAgICAgIGlmICh2YWxpZEFyY1R5cGVzRm9yRHJhZ1swXS5sZW5ndGgpIHtcbiAgICAgICAgICAgIGNvbW1lbnQgKz0gJzxkaXY+JyArIHZhbGlkQXJjVHlwZXNGb3JEcmFnWzBdLmpvaW4oJywgJykgKyAnPC9kaXY+JztcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgJCgncmVjdFtkYXRhLXNwYW4taWQ9XCInICsgc3BhbklkICsgJ1wiXScpLmFkZENsYXNzKCdiYWRUYXJnZXQnKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgaW1tZWRpYXRlbHkgPSB0cnVlO1xuICAgICAgICB9XG4gICAgICAgIC8vIHByb2Nlc3Mgbm9ybWFsaXphdGlvbnNcbiAgICAgICAgdmFyIG5vcm1zVG9RdWVyeSA9IFtdO1xuICAgICAgICAkLmVhY2gobm9ybWFsaXphdGlvbnMsIGZ1bmN0aW9uKG5vcm1Obywgbm9ybSkge1xuICAgICAgICAgIHZhciBkYk5hbWUgPSBub3JtWzBdLCBkYktleSA9IG5vcm1bMV07XG4gICAgICAgICAgY29tbWVudCArPSAoICc8aHIvPicgK1xuICAgICAgICAgICAgICAgICAgICAgICAnPHNwYW4gY2xhc3M9XCJjb21tZW50X2lkXCI+JyArXG4gICAgICAgICAgICAgICAgICAgICAgIFV0aWwuZXNjYXBlSFRNTChkYk5hbWUpICsgJzonICtcbiAgICAgICAgICAgICAgICAgICAgICAgVXRpbC5lc2NhcGVIVE1MKGRiS2V5KSArICc8L3NwYW4+Jyk7XG4gICAgICAgICAgaWYgKGRiTmFtZSBpbiBub3JtU2VydmVyRGJCeU5vcm1EYk5hbWUgJiZcbiAgICAgICAgICAgICAgbm9ybVNlcnZlckRiQnlOb3JtRGJOYW1lW2RiTmFtZV0gIT0gJzxOT05FPicpIHtcbiAgICAgICAgICAgIC8vIERCIGF2YWlsYWJsZSwgYWRkIGRyb3Atb2ZmIHBvaW50IHRvIEhUTUwgYW5kIHN0b3JlXG4gICAgICAgICAgICAvLyBxdWVyeSBwYXJhbWV0ZXJzXG4gICAgICAgICAgICBjb21tZW50UG9wdXBOb3JtSW5mb1NlcUlkKys7XG4gICAgICAgICAgICBjb21tZW50ICs9ICgnPGJyLz48ZGl2IGlkPVwibm9ybV9pbmZvX2Ryb3BfcG9pbnRfJytcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbW1lbnRQb3B1cE5vcm1JbmZvU2VxSWQrJ1wiLz4nKTtcbiAgICAgICAgICAgIG5vcm1zVG9RdWVyeS5wdXNoKFtkYk5hbWUsIGRiS2V5LCBjb21tZW50UG9wdXBOb3JtSW5mb1NlcUlkXSk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIC8vIG5vIERCLCBqdXN0IGF0dGFjaCBcImh1bWFuLXJlYWRhYmxlXCIgdGV4dCBwcm92aWRlZFxuICAgICAgICAgICAgLy8gd2l0aCB0aGUgYW5ub3RhdGlvbiwgaWYgYW55XG4gICAgICAgICAgICBpZiAobm9ybVsyXSkge1xuICAgICAgICAgICAgICAgIGNvbW1lbnQgKz0gKCc8YnIvPjxzcGFuIGNsYXNzPVwibm9ybV9pbmZvX3ZhbHVlXCI+JytcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBVdGlsLmVzY2FwZUhUTUwobm9ybVsyXSkrJzwvc3Bhbj4nKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8vIGRpc3BsYXkgaW5pdGlhbCBjb21tZW50IEhUTUxcbiAgICAgICAgaWYgKHNob3dUb29sdGlwKSB7XG4gICAgICAgICAgZGlzcGxheUNvbW1lbnQoZXZ0LCB0YXJnZXQsIGNvbW1lbnQsIGNvbW1lbnRUZXh0LCBjb21tZW50VHlwZSxcbiAgICAgICAgICAgICAgaW1tZWRpYXRlbHkpO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gaW5pdGlhdGUgQUpBWCBjYWxscyBmb3IgdGhlIG5vcm1hbGl6YXRpb24gZGF0YSB0byBxdWVyeVxuICAgICAgICAkLmVhY2gobm9ybXNUb1F1ZXJ5LCBmdW5jdGlvbihub3JtcU5vLCBub3JtcSkge1xuICAgICAgICAgIC8vIFRPRE86IGNhY2hlIHNvbWUgbnVtYmVyIG9mIG1vc3QgcmVjZW50IG5vcm1fZ2V0X2RhdGEgcmVzdWx0c1xuICAgICAgICAgIHZhciBkYk5hbWUgPSBub3JtcVswXSwgZGJLZXkgPSBub3JtcVsxXSwgaW5mb1NlcUlkID0gbm9ybXFbMl07XG4gICAgICAgICAgZGlzcGF0Y2hlci5wb3N0KCdhamF4JywgW3tcbiAgICAgICAgICAgIGFjdGlvbjogJ25vcm1EYXRhJyxcbiAgICAgICAgICAgIGRhdGFiYXNlOiBkYk5hbWUsXG4gICAgICAgICAgICBrZXk6IGRiS2V5LFxuICAgICAgICAgICAgY29sbGVjdGlvbjogY29sbCxcbiAgICAgICAgICB9LFxuICAgICAgICAgIGZ1bmN0aW9uKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICBpZiAocmVzcG9uc2UuZXhjZXB0aW9uKSB7XG4gICAgICAgICAgICAgIDsgLy8gVE9ETzogcmVzcG9uc2UgdG8gZXJyb3JcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoIXJlc3BvbnNlLnZhbHVlKSB7XG4gICAgICAgICAgICAgIDsgLy8gVE9ETzogcmVzcG9uc2UgdG8gbWlzc2luZyBrZXlcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgIC8vIGV4dGVuZCBjb21tZW50IHBvcHVwIHdpdGggbm9ybWFsaXphdGlvbiBkYXRhXG4gICAgICAgICAgICAgIG5vcm1pbmZvID0gJyc7XG4gICAgICAgICAgICAgIC8vIGZsYXR0ZW4gb3V0ZXIgKG5hbWUsIGF0dHIsIGluZm8pIGFycmF5IChpZHggZm9yIHNvcnQpXG4gICAgICAgICAgICAgIGluZm9zID0gW107XG4gICAgICAgICAgICAgIHZhciBpZHggPSAwO1xuICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHJlc3BvbnNlLnZhbHVlLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCByZXNwb25zZS52YWx1ZVtpXS5sZW5ndGg7IGorKykge1xuICAgICAgICAgICAgICAgICAgdmFyIGxhYmVsID0gcmVzcG9uc2UudmFsdWVbaV1bal1bMF07XG4gICAgICAgICAgICAgICAgICB2YXIgdmFsdWUgPSByZXNwb25zZS52YWx1ZVtpXVtqXVsxXTtcbiAgICAgICAgICAgICAgICAgIGluZm9zLnB1c2goW2xhYmVsLCB2YWx1ZSwgaWR4KytdKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgLy8gc29ydCwgcHJpb3JpdGl6aW5nIGltYWdlcyAodG8gZ2V0IGZsb2F0cyByaWdodClcbiAgICAgICAgICAgICAgaW5mb3MgPSBpbmZvcy5zb3J0KG5vcm1JbmZvU29ydEZ1bmN0aW9uKTtcbiAgICAgICAgICAgICAgLy8gZ2VuZXJhdGUgSFRNTFxuICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGluZm9zLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgdmFyIGxhYmVsID0gaW5mb3NbaV1bMF07XG4gICAgICAgICAgICAgICAgdmFyIHZhbHVlID0gaW5mb3NbaV1bMV07XG4gICAgICAgICAgICAgICAgaWYgKGxhYmVsICYmIHZhbHVlKSB7XG4gICAgICAgICAgICAgICAgICAvLyBzcGVjaWFsIHRyZWF0bWVudCBmb3Igc29tZSBsYWJlbCB2YWx1ZXNcbiAgICAgICAgICAgICAgICAgIGlmIChsYWJlbC50b0xvd2VyQ2FzZSgpID09ICc8aW1nPicpIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gaW1hZ2VcbiAgICAgICAgICAgICAgICAgICAgbm9ybWluZm8gKz0gKCc8aW1nIGNsYXNzPVwibm9ybV9pbmZvX2ltZ1wiIHNyYz1cIicrXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZStcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdcIi8+Jyk7XG4gICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAvLyBub3JtYWwsIGFzIHRleHRcblxuICAgICAgICAgICAgICAgICAgICAvLyBtYXggbGVuZ3RoIHJlc3RyaWN0aW9uXG4gICAgICAgICAgICAgICAgICAgIGlmICh2YWx1ZS5sZW5ndGggPiAzMDApIHtcbiAgICAgICAgICAgICAgICAgICAgICB2YWx1ZSA9IHZhbHVlLnN1YnN0cigwLCAzMDApICsgJyAuLi4nO1xuICAgICAgICAgICAgICAgICAgICB9ICAgICAgICAgICAgICAgICAgICAgICAgICBcblxuICAgICAgICAgICAgICAgICAgICBub3JtaW5mbyArPSAoJzxzcGFuIGNsYXNzPVwibm9ybV9pbmZvX2xhYmVsXCI+JytcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFV0aWwuZXNjYXBlSFRNTChsYWJlbCkrXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnPC9zcGFuPicrXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnPHNwYW4gY2xhc3M9XCJub3JtX2luZm9fdmFsdWVcIj4nKyc6JytcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFV0aWwuZXNjYXBlSFRNTCh2YWx1ZSkrXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnPC9zcGFuPicrXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnPGJyLz4nKTtcbiAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgdmFyIGRyb3A9JCgnI25vcm1faW5mb19kcm9wX3BvaW50XycraW5mb1NlcUlkKTtcbiAgICAgICAgICAgICAgaWYgKGRyb3ApIHtcbiAgICAgICAgICAgICAgICBkcm9wLmh0bWwobm9ybWluZm8pO1xuICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdub3JtIGluZm8gZHJvcCBwb2ludCBub3QgZm91bmQhJyk7IC8vVE9ETyBYWFhcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgIH1dKTtcbiAgICAgICAgfSk7XG4gICAgICB9O1xuXG4gICAgICB2YXIgb25Eb2NDaGFuZ2VkID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIGNvbW1lbnRQb3B1cC5oaWRlKCk7XG4gICAgICAgIGNvbW1lbnREaXNwbGF5ZWQgPSBmYWxzZTtcbiAgICAgIH07XG5cbiAgICAgIHZhciBkaXNwbGF5QXJjQ29tbWVudCA9IGZ1bmN0aW9uKFxuICAgICAgICAgIGV2dCwgdGFyZ2V0LCBzeW1tZXRyaWMsIGFyY0lkLFxuICAgICAgICAgIG9yaWdpblNwYW5JZCwgb3JpZ2luU3BhblR5cGUsIHJvbGUsIFxuICAgICAgICAgIHRhcmdldFNwYW5JZCwgdGFyZ2V0U3BhblR5cGUsXG4gICAgICAgICAgY29tbWVudFRleHQsIGNvbW1lbnRUeXBlKSB7XG4gICAgICAgIHZhciBhcmNSb2xlID0gdGFyZ2V0LmF0dHIoJ2RhdGEtYXJjLXJvbGUnKTtcbiAgICAgICAgLy8gaW4gYXJyb3dTdHIsICYjODIxMiA9PSBtZGFzaCwgJiM4NTk0ID09IFVuaWNvZGUgcmlnaHQgYXJyb3dcbiAgICAgICAgdmFyIGFycm93U3RyID0gc3ltbWV0cmljID8gJyYjODIxMjsnIDogJyYjODU5NDsnO1xuICAgICAgICB2YXIgYXJjRGlzcGxheUZvcm0gPSBVdGlsLmFyY0Rpc3BsYXlGb3JtKHNwYW5UeXBlcywgXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YS5zcGFuc1tvcmlnaW5TcGFuSWRdLnR5cGUsIFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFyY1JvbGUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVsYXRpb25UeXBlc0hhc2gpO1xuICAgICAgICB2YXIgY29tbWVudCA9IFwiXCI7XG4gICAgICAgIGNvbW1lbnQgKz0gKCc8c3BhbiBjbGFzcz1cImNvbW1lbnRfdHlwZV9pZF93cmFwcGVyXCI+JyArXG4gICAgICAgICAgICAgICAgICAgICc8c3BhbiBjbGFzcz1cImNvbW1lbnRfdHlwZVwiPicgK1xuICAgICAgICAgICAgICAgICAgICBVdGlsLmVzY2FwZUhUTUwoVXRpbC5zcGFuRGlzcGxheUZvcm0oc3BhblR5cGVzLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3JpZ2luU3BhblR5cGUpKSArXG4gICAgICAgICAgICAgICAgICAgICcgJyArIGFycm93U3RyICsgJyAnICtcbiAgICAgICAgICAgICAgICAgICAgVXRpbC5lc2NhcGVIVE1MKGFyY0Rpc3BsYXlGb3JtKSArXG4gICAgICAgICAgICAgICAgICAgICcgJyArIGFycm93U3RyICsgJyAnICtcbiAgICAgICAgICAgICAgICAgICAgVXRpbC5lc2NhcGVIVE1MKFV0aWwuc3BhbkRpc3BsYXlGb3JtKHNwYW5UeXBlcyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhcmdldFNwYW5UeXBlKSkgK1xuICAgICAgICAgICAgICAgICAgICAnPC9zcGFuPicgK1xuICAgICAgICAgICAgICAgICAgICAnPHNwYW4gY2xhc3M9XCJjb21tZW50X2lkXCI+JyArXG4gICAgICAgICAgICAgICAgICAgIChhcmNJZCA/ICdJRDonK2FyY0lkIDogXG4gICAgICAgICAgICAgICAgICAgICBVdGlsLmVzY2FwZUhUTUwob3JpZ2luU3BhbklkKSArXG4gICAgICAgICAgICAgICAgICAgICBhcnJvd1N0ciArIFxuICAgICAgICAgICAgICAgICAgICAgVXRpbC5lc2NhcGVIVE1MKHRhcmdldFNwYW5JZCkpICtcbiAgICAgICAgICAgICAgICAgICAgJzwvc3Bhbj4nICtcbiAgICAgICAgICAgICAgICAgICAgJzwvc3Bhbj4nKTtcbiAgICAgICAgY29tbWVudCArPSAoJzxkaXYgY2xhc3M9XCJjb21tZW50X3RleHRcIj4nICsgXG4gICAgICAgICAgICAgICAgICAgIFV0aWwuZXNjYXBlSFRNTCgnXCInK2RhdGEuc3BhbnNbb3JpZ2luU3BhbklkXS50ZXh0KydcIicpICtcbiAgICAgICAgICAgICAgICAgICAgYXJyb3dTdHIgK1xuICAgICAgICAgICAgICAgICAgICBVdGlsLmVzY2FwZUhUTUwoJ1wiJytkYXRhLnNwYW5zW3RhcmdldFNwYW5JZF0udGV4dCArICdcIicpICtcbiAgICAgICAgICAgICAgICAgICAgJzwvZGl2PicpO1xuICAgICAgICBkaXNwbGF5Q29tbWVudChldnQsIHRhcmdldCwgY29tbWVudCwgY29tbWVudFRleHQsIGNvbW1lbnRUeXBlKTtcbiAgICAgIH07XG5cbiAgICAgIHZhciBkaXNwbGF5U2VudENvbW1lbnQgPSBmdW5jdGlvbihcbiAgICAgICAgICBldnQsIHRhcmdldCwgY29tbWVudFRleHQsIGNvbW1lbnRUeXBlKSB7XG4gICAgICAgIGRpc3BsYXlDb21tZW50KGV2dCwgdGFyZ2V0LCAnJywgY29tbWVudFRleHQsIGNvbW1lbnRUeXBlKTtcbiAgICAgIH07XG5cbiAgICAgIHZhciBoaWRlQ29tbWVudCA9IGZ1bmN0aW9uKCkge1xuICAgICAgICBjbGVhclRpbWVvdXQoZGlzcGxheUNvbW1lbnRUaW1lcik7XG4gICAgICAgIGlmIChjb21tZW50RGlzcGxheWVkKSB7XG4gICAgICAgICAgY29tbWVudFBvcHVwLnN0b3AodHJ1ZSwgdHJ1ZSkuZmFkZU91dChmdW5jdGlvbigpIHsgY29tbWVudERpc3BsYXllZCA9IGZhbHNlOyB9KTtcbiAgICAgICAgfVxuICAgICAgfTtcblxuICAgICAgdmFyIG9uTW91c2VNb3ZlID0gZnVuY3Rpb24oZXZ0KSB7XG4gICAgICAgIGlmIChjb21tZW50RGlzcGxheWVkICYmIHNob3dUb29sdGlwKSB7XG4gICAgICAgICAgYWRqdXN0VG9DdXJzb3IoZXZ0LCBjb21tZW50UG9wdXAsIDEwLCB0cnVlLCB0cnVlKTtcbiAgICAgICAgfVxuICAgICAgfTtcblxuICAgICAgLyogRU5EIGNvbW1lbnQgcG9wdXAgLSByZWxhdGVkICovXG5cblxuICAgICAgLyogU1RBUlQgZm9ybSBtYW5hZ2VtZW50IC0gcmVsYXRlZCAqL1xuICAgICAgaW5pdEZvcm0gPSBmdW5jdGlvbihmb3JtLCBvcHRzKSB7XG4gICAgICAgIG9wdHMgPSBvcHRzIHx8IHt9O1xuICAgICAgICB2YXIgZm9ybUlkID0gZm9ybS5hdHRyKCdpZCcpO1xuXG4gICAgICAgIC8vIGFsc29SZXNpemUgaXMgc3BlY2lhbFxuICAgICAgICB2YXIgYWxzb1Jlc2l6ZSA9IG9wdHMuYWxzb1Jlc2l6ZTtcbiAgICAgICAgZGVsZXRlIG9wdHMuYWxzb1Jlc2l6ZTtcblxuICAgICAgICAvLyBBbHdheXMgYWRkIE9LIGFuZCBDYW5jZWxcbiAgICAgICAgdmFyIGJ1dHRvbnMgPSAob3B0cy5idXR0b25zIHx8IFtdKTtcbiAgICAgICAgaWYgKG9wdHMubm9fb2spIHtcbiAgICAgICAgICBkZWxldGUgb3B0cy5ub19vaztcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBidXR0b25zLnB1c2goe1xuICAgICAgICAgICAgICBpZDogZm9ybUlkICsgXCItb2tcIixcbiAgICAgICAgICAgICAgdGV4dDogXCJPS1wiLFxuICAgICAgICAgICAgICBjbGljazogZnVuY3Rpb24oKSB7IGZvcm0uc3VibWl0KCk7IH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIGlmIChvcHRzLm5vX2NhbmNlbCkge1xuICAgICAgICAgIGRlbGV0ZSBvcHRzLm5vX2NhbmNlbDtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBidXR0b25zLnB1c2goe1xuICAgICAgICAgICAgICBpZDogZm9ybUlkICsgXCItY2FuY2VsXCIsXG4gICAgICAgICAgICAgIHRleHQ6IFwiQ2FuY2VsXCIsXG4gICAgICAgICAgICAgIGNsaWNrOiBmdW5jdGlvbigpIHsgZm9ybS5kaWFsb2coJ2Nsb3NlJyk7IH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIGRlbGV0ZSBvcHRzLmJ1dHRvbnM7XG5cbiAgICAgICAgb3B0cyA9ICQuZXh0ZW5kKHtcbiAgICAgICAgICAgIGF1dG9PcGVuOiBmYWxzZSxcbiAgICAgICAgICAgIGNsb3NlT25Fc2NhcGU6IHRydWUsXG4gICAgICAgICAgICBidXR0b25zOiBidXR0b25zLFxuICAgICAgICAgICAgbW9kYWw6IHRydWVcbiAgICAgICAgICB9LCBvcHRzKTtcblxuICAgICAgICBmb3JtLmRpYWxvZyhvcHRzKTtcbiAgICAgICAgZm9ybS5iaW5kKCdkaWFsb2djbG9zZScsIGZ1bmN0aW9uKCkge1xuICAgICAgICAgIGlmIChmb3JtID09IGN1cnJlbnRGb3JtKSB7XG4gICAgICAgICAgICBjdXJyZW50Rm9ybSA9IG51bGw7XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgICAgICAvLyBIQUNLOiBqUXVlcnkgVUkncyBkaWFsb2cgZG9lcyBub3Qgc3VwcG9ydCBhbHNvUmVzaXplXG4gICAgICAgIC8vIG5vciBkb2VzIHJlc2l6YWJsZSBzdXBwb3J0IGEgalF1ZXJ5IG9iamVjdCBvZiBzZXZlcmFsXG4gICAgICAgIC8vIGVsZW1lbnRzXG4gICAgICAgIC8vIFNlZTogaHR0cDovL2J1Z3MuanF1ZXJ5dWkuY29tL3RpY2tldC80NjY2XG4gICAgICAgIGlmIChhbHNvUmVzaXplKSB7XG4gICAgICAgICAgZm9ybS5wYXJlbnQoKS5yZXNpemFibGUoJ29wdGlvbicsICdhbHNvUmVzaXplJyxcbiAgICAgICAgICAgICAgJyMnICsgZm9ybS5hdHRyKCdpZCcpICsgJywgJyArIGFsc29SZXNpemUpO1xuICAgICAgICB9XG4gICAgICB9O1xuXG4gICAgICB2YXIgc2hvd0Zvcm0gPSBmdW5jdGlvbihmb3JtKSB7XG4gICAgICAgIGN1cnJlbnRGb3JtID0gZm9ybTtcbiAgICAgICAgaWYoIW92ZXJXcml0ZU1vZGFscyl7XG4gICAgICAgICAgLy8gYXMgc3VnZ2VzdGVkIGluIGh0dHA6Ly9zdGFja292ZXJmbG93LmNvbS9xdWVzdGlvbnMvMjY1NzA3Ni9qcXVlcnktdWktZGlhbG9nLWZpeGVkLXBvc2l0aW9uaW5nXG4gICAgICAgICAgZm9ybS5wYXJlbnQoKS5jc3Moe3Bvc2l0aW9uOlwiZml4ZWRcIn0pO1xuICAgICAgICAgIGZvcm0uZGlhbG9nKCdvcGVuJyk7XG4gICAgICAgICAgc2xpZGVUb2dnbGUoJCgnI3B1bGxkb3duJykuc3RvcCgpLCBmYWxzZSk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGZvcm07XG4gICAgICB9O1xuXG4gICAgICB2YXIgaGlkZUZvcm0gPSBmdW5jdGlvbigpIHtcbiAgICAgICAgaWYgKCFjdXJyZW50Rm9ybSkgcmV0dXJuO1xuICAgICAgICAvLyBjdXJyZW50Rm9ybS5mYWRlT3V0KGZ1bmN0aW9uKCkgeyBjdXJyZW50Rm9ybSA9IG51bGw7IH0pO1xuICAgICAgICBjdXJyZW50Rm9ybS5kaWFsb2coJ2Nsb3NlJyk7XG4gICAgICAgIGN1cnJlbnRGb3JtID0gbnVsbDtcbiAgICAgIH07XG5cbiAgICAgIC8qIEVORCBmb3JtIG1hbmFnZW1lbnQgLSByZWxhdGVkICovXG5cblxuICAgICAgLyogU1RBUlQgY29sbGVjdGlvbiBicm93c2VyIC0gcmVsYXRlZCAqL1xuXG4gICAgICB2YXIgc2VsZWN0RWxlbWVudEluVGFibGUgPSBmdW5jdGlvbih0YWJsZSwgZG9jbmFtZSwgbWYpIHtcbiAgICAgICAgdGFibGUgPSAkKHRhYmxlKTtcbiAgICAgICAgdGFibGUuZmluZCgndHInKS5yZW1vdmVDbGFzcygnc2VsZWN0ZWQnKTtcbiAgICAgICAgdmFyIHNlbCA9ICd0cic7XG4gICAgICAgIHZhciAkZWxlbWVudDtcbiAgICAgICAgaWYgKGRvY25hbWUpIHtcbiAgICAgICAgICBzZWwgKz0gJ1tkYXRhLWRvYz1cIicgKyBkb2NuYW1lICsgJ1wiXSc7XG4gICAgICAgICAgaWYgKG1mKSB7XG4gICAgICAgICAgICBzZWwgKz0gJ1tkYXRhLW1mPVwiJyArIFV0aWwucGFyYW1BcnJheShtZikgKyAnXCJdJztcbiAgICAgICAgICB9XG4gICAgICAgICAgdmFyICRlbGVtZW50ID0gdGFibGUuZmluZChzZWwpLmZpcnN0KCk7XG4gICAgICAgICAgJGVsZW1lbnQuYWRkQ2xhc3MoJ3NlbGVjdGVkJyk7XG4gICAgICAgIH1cbiAgICAgICAgbWF0Y2hGb2N1cyA9ICRlbGVtZW50ICYmICRlbGVtZW50LmF0dHIoJ2RhdGEtbWYnKTtcbiAgICAgICAgbWF0Y2hlcyA9ICRlbGVtZW50ICYmICRlbGVtZW50LmF0dHIoJ2RhdGEtbWF0Y2gnKTtcbiAgICAgIH1cblxuICAgICAgdmFyIGNob29zZURvY3VtZW50ID0gZnVuY3Rpb24oZXZ0KSB7XG4gICAgICAgIHZhciAkZWxlbWVudCA9ICQoZXZ0LnRhcmdldCkuY2xvc2VzdCgndHInKTtcbiAgICAgICAgJCgnI2RvY3VtZW50X3NlbGVjdCB0cicpLnJlbW92ZUNsYXNzKCdzZWxlY3RlZCcpO1xuICAgICAgICAkKCcjZG9jdW1lbnRfaW5wdXQnKS52YWwoJGVsZW1lbnQuYXR0cignZGF0YS1kb2MnKSk7XG5cbiAgICAgICAgJGVsZW1lbnQuYWRkQ2xhc3MoJ3NlbGVjdGVkJyk7XG4gICAgICAgIG1hdGNoRm9jdXMgPSAkZWxlbWVudC5hdHRyKCdkYXRhLW1mJyk7XG4gICAgICAgIG1hdGNoZXMgPSAkZWxlbWVudC5hdHRyKCdkYXRhLW1hdGNoJyk7XG4gICAgICB9XG5cbiAgICAgIHZhciBjaG9vc2VEb2N1bWVudEFuZFN1Ym1pdCA9IGZ1bmN0aW9uKGV2dCkge1xuICAgICAgICBjaG9vc2VEb2N1bWVudChldnQpO1xuICAgICAgICBmaWxlQnJvd3NlclN1Ym1pdChldnQpO1xuICAgICAgfVxuXG4gICAgICB2YXIgZmlsZUJyb3dzZXIgPSAkKCcjY29sbGVjdGlvbl9icm93c2VyJyk7XG4gICAgICBpbml0Rm9ybShmaWxlQnJvd3Nlciwge1xuICAgICAgICAgIGFsc29SZXNpemU6ICcjZG9jdW1lbnRfc2VsZWN0JyxcbiAgICAgICAgICBjbG9zZTogZnVuY3Rpb24oZXZ0KSB7XG4gICAgICAgICAgICBpZiAoIWRvYykge1xuICAgICAgICAgICAgICAvLyBubyBkb2N1bWVudDsgc2V0IGFuZCBzaG93IHRoZSByZWxldmFudCBtZXNzYWdlLCBhbmRcbiAgICAgICAgICAgICAgLy8gY2xlYXIgdGhlIFwiYmxpbmRcIiB1bmxlc3Mgd2FpdGluZyBmb3IgYSBjb2xsZWN0aW9uXG4gICAgICAgICAgICAgIGlmIChmaWxlQnJvd3NlckNsb3NlZFdpdGhTdWJtaXQpIHtcbiAgICAgICAgICAgICAgICAkKCcjbm9fZG9jdW1lbnRfbWVzc2FnZScpLmhpZGUoKTtcbiAgICAgICAgICAgICAgICAkKCcjbG9hZGluZ19tZXNzYWdlJykuc2hvdygpO1xuICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICQoJyNsb2FkaW5nX21lc3NhZ2UnKS5oaWRlKCk7XG4gICAgICAgICAgICAgICAgJCgnI25vX2RvY3VtZW50X21lc3NhZ2UnKS5zaG93KCk7XG4gICAgICAgICAgICAgICAgJCgnI3dhaXRlcicpLmRpYWxvZygnY2xvc2UnKTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICBzaG93Tm9Eb2NNZXNzYWdlKCk7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKCFmaWxlQnJvd3NlckNsb3NlZFdpdGhTdWJtaXQgJiYgIXNlYXJjaEFjdGl2ZSkge1xuICAgICAgICAgICAgICBkaXNwYXRjaGVyLnBvc3QoJ3NldEFyZ3VtZW50cycsIFt7fSwgdHJ1ZV0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0sXG4gICAgICAgICAgd2lkdGg6IDUwMFxuICAgICAgfSk7XG5cbiAgICAgIC8qIFhYWCByZW1vdmVkIHBlciAjOTAwXG4gICAgICAvLyBpbnNlcnQgdGhlIFNhdmUgbGlua1xuICAgICAgdmFyICRmaWxlQnJvd3NlckJ1dHRvbnNldCA9IGZpbGVCcm93c2VyLlxuICAgICAgICAgIHBhcmVudCgpLmZpbmQoJy51aS1kaWFsb2ctYnV0dG9ucGFuZSAudWktZGlhbG9nLWJ1dHRvbnNldCcpLnByZXBlbmQoJyAnKTtcbiAgICAgICQoJzxhIGhyZWY9XCJhamF4LmNnaT9hY3Rpb249ZG93bmxvYWRTZWFyY2hGaWxlXCIgaWQ9XCJzYXZlX3NlYXJjaFwiPlNhdmU8L2E+JykuXG4gICAgICAgICAgcHJlcGVuZFRvKCRmaWxlQnJvd3NlckJ1dHRvbnNldCkuYnV0dG9uKCkuY3NzKCdkaXNwbGF5JywgJ25vbmUnKTtcbiAgICAgICovXG5cbiAgICAgIHZhciBkb2NJbnB1dEhhbmRsZXIgPSBmdW5jdGlvbihldnQpIHtcbiAgICAgICAgc2VsZWN0RWxlbWVudEluVGFibGUoJyNkb2N1bWVudF9zZWxlY3QnLCAkKHRoaXMpLnZhbCgpKTtcbiAgICAgIH07XG4gICAgICAkKCcjZG9jdW1lbnRfaW5wdXQnKS5rZXl1cChkb2NJbnB1dEhhbmRsZXIpO1xuXG4gICAgICB2YXIgZmlsZUJyb3dzZXJTdWJtaXQgPSBmdW5jdGlvbihldnQpIHtcbiAgICAgICAgdmFyIF9jb2xsLCBfZG9jLCBfYXJncywgZm91bmQ7XG4gICAgICAgIHZhciBpbnB1dCA9ICQoJyNkb2N1bWVudF9pbnB1dCcpLlxuICAgICAgICAgICAgdmFsKCkuXG4gICAgICAgICAgICByZXBsYWNlKC9cXC8/XFxzKyQvLCAnJykuXG4gICAgICAgICAgICByZXBsYWNlKC9eXFxzKy8sICcnKTtcbiAgICAgICAgaWYgKCFpbnB1dC5sZW5ndGgpIHJldHVybiBmYWxzZTtcbiAgICAgICAgaWYgKGlucHV0LnN1YnN0cigwLCAyKSA9PT0gJy4uJykge1xuICAgICAgICAgIC8vIC4uXG4gICAgICAgICAgdmFyIHBvcyA9IGNvbGwuc3Vic3RyKDAsIGNvbGwubGVuZ3RoIC0gMSkubGFzdEluZGV4T2YoJy8nKTtcbiAgICAgICAgICBpZiAocG9zID09PSAtMSkge1xuICAgICAgICAgICAgZGlzcGF0Y2hlci5wb3N0KCdtZXNzYWdlcycsIFtbWydBdCB0aGUgcm9vdCcsICdlcnJvcicsIDJdXV0pO1xuICAgICAgICAgICAgJCgnI2RvY3VtZW50X2lucHV0JykuZm9jdXMoKS5zZWxlY3QoKTtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgX2NvbGwgPSBjb2xsLnN1YnN0cigwLCBwb3MgKyAxKTtcbiAgICAgICAgICAgIF9kb2MgPSAnJztcbiAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSBpZiAoZm91bmQgPSBpbnB1dC5tYXRjaCgvXihcXC8/KSgoPzpbXlxcL10qXFwvKSopKFteXFwvP10qKSQvKSkge1xuICAgICAgICAgIHZhciBhYnMgPSBmb3VuZFsxXTtcbiAgICAgICAgICB2YXIgY29sbG5hbWUgPSBmb3VuZFsyXS5zdWJzdHIoMCwgZm91bmRbMl0ubGVuZ3RoIC0gMSk7XG4gICAgICAgICAgdmFyIGRvY25hbWUgPSBmb3VuZFszXTtcbiAgICAgICAgICBpZiAoYWJzKSB7XG4gICAgICAgICAgICBfY29sbCA9IGFicyArIGNvbGxuYW1lO1xuICAgICAgICAgICAgaWYgKF9jb2xsLmxlbmd0aCA8IDIpIGNvbGwgKz0gJy8nO1xuICAgICAgICAgICAgX2RvYyA9IGRvY25hbWU7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGlmIChjb2xsbmFtZSkgY29sbG5hbWUgKz0gJy8nO1xuICAgICAgICAgICAgX2NvbGwgPSBjb2xsICsgY29sbG5hbWU7XG4gICAgICAgICAgICBfZG9jID0gZG9jbmFtZTtcbiAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgZGlzcGF0Y2hlci5wb3N0KCdtZXNzYWdlcycsIFtbWydJbnZhbGlkIGRvY3VtZW50IG5hbWUgZm9ybWF0JywgJ2Vycm9yJywgMl1dXSk7XG4gICAgICAgICAgJCgnI2RvY3VtZW50X2lucHV0JykuZm9jdXMoKS5zZWxlY3QoKTtcbiAgICAgICAgfVxuICAgICAgICBkb2NTY3JvbGwgPSAkKCcjZG9jdW1lbnRfc2VsZWN0JylbMF0uc2Nyb2xsVG9wO1xuICAgICAgICBmaWxlQnJvd3Nlci5maW5kKCcjZG9jdW1lbnRfc2VsZWN0IHRib2R5JykuZW1wdHkoKTtcblxuICAgICAgICBpZiAoY29sbCAhPSBfY29sbCB8fCBkb2MgIT0gX2RvYyB8fFxuICAgICAgICAgICAgVXRpbC5wYXJhbUFycmF5KGFyZ3MubWF0Y2hmb2N1cykgIT0gbWF0Y2hGb2N1cykge1xuICAgICAgICAgIC8vIHNvbWV0aGluZyBjaGFuZ2VkXG5cbiAgICAgICAgICAvLyBzZXQgdG8gYWxsb3cga2VlcGluZyBcImJsaW5kXCIgZG93biBkdXJpbmcgcmVsb2FkXG4gICAgICAgICAgZmlsZUJyb3dzZXJDbG9zZWRXaXRoU3VibWl0ID0gdHJ1ZTtcbiAgICAgICAgICAvLyAuLi4gYW5kIGNoYW5nZSBCRyBtZXNzYWdlIHRvIGEgbW9yZSBhcHByb3ByaWF0ZSBvbmVcblxuICAgICAgICAgIC8vIHRyaWdnZXIgY2xlYXIgYW5kIGNoYW5nZXMgaWYgc29tZXRoaW5nIG90aGVyIHRoYW4gdGhlXG4gICAgICAgICAgLy8gY3VycmVudCB0aGluZyBpcyBjaG9zZW4sIGJ1dCBvbmx5IGJsYW5rIHNjcmVlbiBiZWZvcmVcbiAgICAgICAgICAvLyByZW5kZXIgaWYgdGhlIGRvY3VtZW50IGNoYW5nZWQgKHByZXZlbnQgXCJmbGlja2VyXCIgb25cbiAgICAgICAgICAvLyBlLmcuIHBpY2tpbmcgc2VhcmNoIHJlc3VsdHMpXG4gICAgICAgICAgaWYgKGNvbGwgIT0gX2NvbGwgfHwgZG9jICE9IF9kb2MpIHtcbiAgICAgICAgICAgIGRpc3BhdGNoZXIucG9zdCgnY2xlYXJTVkcnKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgZGlzcGF0Y2hlci5wb3N0KCdhbGxvd1JlbG9hZEJ5VVJMJyk7XG4gICAgICAgICAgdmFyIG5ld0FyZ3MgPSBbXTtcbiAgICAgICAgICBpZiAobWF0Y2hGb2N1cykgbmV3QXJncy5wdXNoKCdtYXRjaGZvY3VzPScgKyBtYXRjaEZvY3VzKTtcbiAgICAgICAgICBpZiAobWF0Y2hlcykgbmV3QXJncy5wdXNoKCdtYXRjaD0nICsgbWF0Y2hlcyk7XG4gICAgICAgICAgZGlzcGF0Y2hlci5wb3N0KCdzZXRDb2xsZWN0aW9uJywgW19jb2xsLCBfZG9jLCBVdGlsLmRlcGFyYW0obmV3QXJncy5qb2luKCcmJykpXSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgLy8gaGlkZSBldmVuIG9uIHNlbGVjdCBjdXJyZW50IHRoaW5nXG4gICAgICAgICAgaGlkZUZvcm0oKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICB9O1xuICAgICAgZmlsZUJyb3dzZXIuXG4gICAgICAgICAgc3VibWl0KGZpbGVCcm93c2VyU3VibWl0KS5cbiAgICAgICAgICBiaW5kKCdyZXNldCcsIGhpZGVGb3JtKTtcblxuICAgICAgdmFyIGZpbGVCcm93c2VyV2FpdGluZyA9IGZhbHNlO1xuICAgICAgdmFyIHNob3dGaWxlQnJvd3NlciA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAvLyBrZWVwIHRhYnMgb24gaG93IHRoZSBicm93c2VyIGlzIGNsb3NlZDsgd2UgbmVlZCB0byBrZWVwIHRoZVxuICAgICAgICAvLyBcImJsaW5kXCIgdXAgd2hlbiByZXRyaWV2aW5nIGEgY29sbGVjdGlvbiwgYnV0IG5vdCB3aGVuIGNhbmNlbGluZ1xuICAgICAgICAvLyB3aXRob3V0IHNlbGVjdGlvbiAod291bGQgaGFuZyB0aGUgVUkpXG5cbi8vIEJSQVQgU1RBTkRBTE9ORSBMSUJSQVJZIEJFR0lOXG4vKlxuICAgICAgICBmaWxlQnJvd3NlckNsb3NlZFdpdGhTdWJtaXQgPSBmYWxzZTtcblxuICAgICAgICAvLyBubyBwb2ludCBpbiBzaG93aW5nIHRoaXMgd2hpbGUgdGhlIGJyb3dzZXIgaXMgc2hvd25cbiAgICAgICAgaGlkZU5vRG9jTWVzc2FnZSgpO1xuXG4gICAgICAgIGlmIChjdXJyZW50Rm9ybSA9PSB0dXRvcmlhbEZvcm0pIHtcbiAgICAgICAgICBmaWxlQnJvd3NlcldhaXRpbmcgPSB0cnVlO1xuICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBmaWxlQnJvd3NlcldhaXRpbmcgPSBmYWxzZTtcblxuICAgICAgICAvLyBoaWRlIFwibm8gZG9jdW1lbnRcIiBtZXNzYWdlIHdoZW4gZmlsZSBicm93c2VyIHNob3duXG4gICAgICAgIC8vIFRPRE86IGNhbid0IG1ha2UgdGhpcyB3b3JrOyBJIGNhbid0IGRldGVjdCB3aGVuIGl0IGdldHMgaGlkZGVuLlxuICAgICAgICAvLyBoaWRlTm9Eb2NNZXNzYWdlKCk7XG5cbiAgICAgICAgaWYgKCEoc2VsZWN0b3JEYXRhICYmIHNob3dGb3JtKGZpbGVCcm93c2VyKSkpIHJldHVybiBmYWxzZTtcblxuICAgICAgICB2YXIgaHRtbCA9IFsnPHRyPjx0aC8+J107XG4gICAgICAgIHZhciB0Ym9keTtcbiAgICAgICAgJC5lYWNoKHNlbGVjdG9yRGF0YS5oZWFkZXIsIGZ1bmN0aW9uKGhlYWRObywgaGVhZCkge1xuICAgICAgICAgIGh0bWwucHVzaCgnPHRoPicgKyBoZWFkWzBdICsgJzwvdGg+Jyk7XG4gICAgICAgIH0pO1xuICAgICAgICBodG1sLnB1c2goJzwvdHI+Jyk7XG4gICAgICAgICQoJyNkb2N1bWVudF9zZWxlY3QgdGhlYWQnKS5odG1sKGh0bWwuam9pbignJykpO1xuXG4gICAgICAgIGh0bWwgPSBbXTtcbiAgICAgICAgLy8gTk9URTogd2Ugc2VlbSB0byBoYXZlIHNvbWUgZXhjZXNzaXZlIHNvcnRpbmcgZ29pbmcgb247XG4gICAgICAgIC8vIGRpc2FibGluZyB0aGlzIGFzIGEgdGVzdC4gSWYgZXZlcnl0aGluZyB3b3JrcywganVzdCByZW1vdmVcbiAgICAgICAgLy8gdGhlIGZvbGxvd2luZyBjb21tZW50ZWQtb3V0IGxpbmUgKGFuZCB0aGlzIGNvbW1lbnQpOlxuICAgICAgICAvL3NlbGVjdG9yRGF0YS5pdGVtcy5zb3J0KGRvY1NvcnRGdW5jdGlvbik7XG4gICAgICAgICQuZWFjaChzZWxlY3RvckRhdGEuaXRlbXMsIGZ1bmN0aW9uKGRvY05vLCBkb2MpIHtcbiAgICAgICAgICB2YXIgaXNDb2xsID0gZG9jWzBdID09IFwiY1wiOyAvLyBcImNvbGxlY3Rpb25cIlxuICAgICAgICAgIC8vIHNlY29uZCBjb2x1bW4gaXMgb3B0aW9uYWwgYW5ub3RhdGlvbi1zcGVjaWZpYyBwb2ludGVyLFxuICAgICAgICAgIC8vIHVzZWQgKGF0IGxlYXN0KSBmb3Igc2VhcmNoIHJlc3VsdHNcbiAgICAgICAgICB2YXIgYW5ucCA9IGRvY1sxXSA/ICgnPycgKyBVdGlsLmVzY2FwZUhUTUwoVXRpbC5wYXJhbShkb2NbMV0pKSkgOiAnJztcbiAgICAgICAgICB2YXIgbmFtZSA9IFV0aWwuZXNjYXBlSFRNTChkb2NbMl0pO1xuICAgICAgICAgIHZhciBjb2xsRmlsZSA9IGlzQ29sbCA/ICdjb2xsZWN0aW9uJyA6ICdmaWxlJztcbiAgICAgICAgICAvL3ZhciBjb2xsRmlsZUltZyA9IGlzQ29sbCA/ICdpY19saXN0X2ZvbGRlci5wbmcnIDogJ2ljX2xpc3RfZHJhZnRzLnBuZyc7XG4gICAgICAgICAgLy92YXIgY29sbEZpbGVJbWcgPSBpc0NvbGwgPyAnRnVndWUtZm9sZGVyLWhvcml6b250YWwtb3Blbi5wbmcnIDogJ0Z1Z3VlLWRvY3VtZW50LnBuZyc7XG4gICAgICAgICAgdmFyIGNvbGxGaWxlSW1nID0gaXNDb2xsID8gJ0Z1Z3VlLXNoYWRvd2xlc3MtZm9sZGVyLWhvcml6b250YWwtb3Blbi5wbmcnIDogJ0Z1Z3VlLXNoYWRvd2xlc3MtZG9jdW1lbnQucG5nJztcbiAgICAgICAgICB2YXIgY29sbFN1ZmZpeCA9IGlzQ29sbCA/ICcvJyA6ICcnO1xuICAgICAgICAgIGlmIChkb2NbMV0pIHtcbiAgICAgICAgICAgIHZhciBtYXRjaGZvY3VzID0gZG9jWzFdLm1hdGNoZm9jdXMgfHwgW107XG4gICAgICAgICAgICB2YXIgbWZzdHIgPSAnIGRhdGEtbWY9XCInICsgVXRpbC5wYXJhbUFycmF5KG1hdGNoZm9jdXMpICsgJ1wiJztcbiAgICAgICAgICAgIHZhciBtYXRjaCA9IGRvY1sxXS5tYXRjaCB8fCBbXTtcbiAgICAgICAgICAgIHZhciBtYXRjaHN0ciA9ICcgZGF0YS1tYXRjaD1cIicgKyBVdGlsLnBhcmFtQXJyYXkobWF0Y2gpICsgJ1wiJztcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdmFyIG1hdGNoc3RyID0gJyc7XG4gICAgICAgICAgICB2YXIgbWZzdHIgPSAnJztcbiAgICAgICAgICB9XG4gICAgICAgICAgaHRtbC5wdXNoKCc8dHIgY2xhc3M9XCInICsgY29sbEZpbGUgKyAnXCIgZGF0YS1kb2M9XCInXG4gICAgICAgICAgICArIG5hbWUgKyBjb2xsU3VmZml4ICsgJ1wiJyArIG1hdGNoc3RyICsgbWZzdHIgKyAnPicpO1xuICAgICAgICAgIGh0bWwucHVzaCgnPHRoPjxpbWcgc3JjPVwic3RhdGljL2ltZy8nICsgY29sbEZpbGVJbWcgKyAnXCIgYWx0PVwiJyArIGNvbGxGaWxlICsgJ1wiLz48L3RoPicpO1xuICAgICAgICAgIGh0bWwucHVzaCgnPHRoPicgKyBuYW1lICsgY29sbFN1ZmZpeCArICc8L3RoPicpO1xuICAgICAgICAgIHZhciBsZW4gPSBzZWxlY3RvckRhdGEuaGVhZGVyLmxlbmd0aCAtIDE7XG4gICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBsZW47IGkrKykge1xuICAgICAgICAgICAgdmFyIHR5cGUgPSBzZWxlY3RvckRhdGEuaGVhZGVyW2kgKyAxXVsxXTtcbiAgICAgICAgICAgIHZhciBkYXR1bSA9IGRvY1tpICsgM107XG4gICAgICAgICAgICAvLyBmb3JtYXQgcmVzdCBhY2NvcmRpbmcgdG8gXCJkYXRhIHR5cGVcIiBzcGVjaWZpZWQgaW4gaGVhZGVyXG4gICAgICAgICAgICB2YXIgZm9ybWF0dGVkID0gbnVsbDtcbiAgICAgICAgICAgIHZhciBjc3NDbGFzcyA9IG51bGw7XG4gICAgICAgICAgICBpZiAoIXR5cGUpIHtcbiAgICAgICAgICAgICAgY29uc29sZS5lcnJvcignTWlzc2luZyBkb2N1bWVudCBsaXN0IGRhdGEgdHlwZScpO1xuICAgICAgICAgICAgICBmb3JtYXR0ZWQgPSBkYXR1bTtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoZGF0dW0gPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICBmb3JtYXR0ZWQgPSAnJztcbiAgICAgICAgICAgIH0gZWxzZSBpZiAodHlwZSA9PT0gJ3N0cmluZycpIHtcbiAgICAgICAgICAgICAgZm9ybWF0dGVkID0gVXRpbC5lc2NhcGVIVE1MKGRhdHVtKTtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAodHlwZSA9PT0gJ3N0cmluZy1yaWdodCcgfHwgdHlwZSA9PT0gJ3N0cmluZy1yZXZlcnNlJykge1xuICAgICAgICAgICAgICBmb3JtYXR0ZWQgPSBVdGlsLmVzY2FwZUhUTUwoZGF0dW0pO1xuICAgICAgICAgICAgICBjc3NDbGFzcyA9ICdyaWdodGFsaWduJztcbiAgICAgICAgICAgIH0gZWxzZSBpZiAodHlwZSA9PT0gJ3N0cmluZy1jZW50ZXInKSB7XG4gICAgICAgICAgICAgIGZvcm1hdHRlZCA9IFV0aWwuZXNjYXBlSFRNTChkYXR1bSk7XG4gICAgICAgICAgICAgIGNzc0NsYXNzID0gJ2NlbnRlcmFsaWduJztcbiAgICAgICAgICAgIH0gZWxzZSBpZiAodHlwZSA9PT0gJ3RpbWUnKSB7XG4gICAgICAgICAgICAgIGZvcm1hdHRlZCA9IFV0aWwuZm9ybWF0VGltZUFnbyhkYXR1bSAqIDEwMDApO1xuICAgICAgICAgICAgfSBlbHNlIGlmICh0eXBlID09PSAnZmxvYXQnKSB7XG4gICAgICAgICAgICAgIHR5cGUgPSBkZWZhdWx0RmxvYXRGb3JtYXQ7XG4gICAgICAgICAgICAgIGNzc0NsYXNzID0gJ3JpZ2h0YWxpZ24nO1xuICAgICAgICAgICAgfSBlbHNlIGlmICh0eXBlID09PSAnaW50Jykge1xuICAgICAgICAgICAgICBmb3JtYXR0ZWQgPSAnJyArIGRhdHVtO1xuICAgICAgICAgICAgICBjc3NDbGFzcyA9ICdyaWdodGFsaWduJztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChmb3JtYXR0ZWQgPT09IG51bGwpIHtcbiAgICAgICAgICAgICAgdmFyIG0gPSB0eXBlLm1hdGNoKC9eKC4qPykoPzpcXC8ocmlnaHQpKT8kLyk7XG4gICAgICAgICAgICAgIGNzc0NsYXNzID0gbVsyXSA/ICdyaWdodGFsaWduJyA6IG51bGw7XG4gICAgICAgICAgICAgIGZvcm1hdHRlZCA9ICQuc3ByaW50ZihtWzFdLCBkYXR1bSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBodG1sLnB1c2goJzx0ZCcgKyAoY3NzQ2xhc3MgPyAnIGNsYXNzPVwiJyArIGNzc0NsYXNzICsgJ1wiJyA6ICcnKSArICc+JyArXG4gICAgICAgICAgICAgICAgZm9ybWF0dGVkICsgJzwvdGQ+Jyk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGh0bWwucHVzaCgnPC90cj4nKTtcbiAgICAgICAgfSk7XG4gICAgICAgIGh0bWwgPSBodG1sLmpvaW4oJycpO1xuICAgICAgICB0Ym9keSA9ICQoJyNkb2N1bWVudF9zZWxlY3QgdGJvZHknKS5odG1sKGh0bWwpO1xuICAgICAgICAkKCcjZG9jdW1lbnRfc2VsZWN0JylbMF0uc2Nyb2xsVG9wID0gZG9jU2Nyb2xsO1xuICAgICAgICB0Ym9keS5maW5kKCd0cicpLlxuICAgICAgICAgICAgY2xpY2soY2hvb3NlRG9jdW1lbnQpLlxuICAgICAgICAgICAgZGJsY2xpY2soY2hvb3NlRG9jdW1lbnRBbmRTdWJtaXQpO1xuXG4gICAgICAgICQoJyNkb2N1bWVudF9zZWxlY3QgdGhlYWQgdHIgKicpLmVhY2goZnVuY3Rpb24odGhObywgdGgpIHtcbiAgICAgICAgICAgIG1ha2VTb3J0Q2hhbmdlRnVuY3Rpb24oc29ydE9yZGVyLCB0aCwgdGhObyk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgICQoJyNjb2xsZWN0aW9uX2lucHV0JykudmFsKHNlbGVjdG9yRGF0YS5jb2xsZWN0aW9uKTtcbiAgICAgICAgJCgnI2RvY3VtZW50X2lucHV0JykudmFsKGRvYyk7XG5cbiAgICAgICAgJCgnI3JlYWRtZScpLnZhbChzZWxlY3RvckRhdGEuZGVzY3JpcHRpb24gfHwgJycpO1xuICAgICAgICBpZiAoc2VsZWN0b3JEYXRhLmRlc2NyaXB0aW9uICYmIFxuICAgICAgICAgICAgKHNlbGVjdG9yRGF0YS5kZXNjcmlwdGlvbi5tYXRjaCgvXFxuLykgfHxcbiAgICAgICAgICAgICBzZWxlY3RvckRhdGEuZGVzY3JpcHRpb24ubGVuZ3RoID4gNTApKSB7XG4gICAgICAgICAgLy8gbXVsdGktbGluZSBvciBsb25nIGRlc2NyaXB0aW9uOyBzaG93IFwibW9yZVwiIGJ1dHRvbiBhbmQgZmlsbFxuICAgICAgICAgIC8vIGRpYWxvZyB0ZXh0XG4gICAgICAgICAgJCgnI21vcmVfcmVhZG1lX2J1dHRvbicpLmJ1dHRvbigpOyAvLyBUT0RPOiBtb3JlIHJlYXNvbmFibGUgcGxhY2VcbiAgICAgICAgICAkKCcjbW9yZV9yZWFkbWVfYnV0dG9uJykuc2hvdygpO1xuICAgICAgICAgIC8vIG9ubHkgZGlzcGxheSB0ZXh0IHVwIHRvIHRoZSBmaXJzdCBuZXdsaW5lIGluIHRoZSBzaG9ydCBpbmZvKi9cbiAgICAgICAgICAvL3ZhciBzcGxpdF9yZWFkbWVfdGV4dCA9IHNlbGVjdG9yRGF0YS5kZXNjcmlwdGlvbi5tYXRjaCgvXlteXFxuXSovKTtcbiAgICAgICAgICAvKiQoJyNyZWFkbWUnKS52YWwoc3BsaXRfcmVhZG1lX3RleHRbMF0pO1xuICAgICAgICAgICQoJyNtb3JlX2luZm9fcmVhZG1lJykudGV4dChzZWxlY3RvckRhdGEuZGVzY3JpcHRpb24pO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIC8vIGVtcHR5IG9yIHNob3J0LCBzaW5nbGUtbGluZSBkZXNjcmlwdGlvbjsgbm8gbmVlZCBmb3IgbW9yZVxuICAgICAgICAgICQoJyNtb3JlX3JlYWRtZV9idXR0b24nKS5oaWRlKCk7XG4gICAgICAgICAgJCgnI21vcmVfaW5mb19yZWFkbWUnKS50ZXh0KCcnKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHNlbGVjdEVsZW1lbnRJblRhYmxlKCQoJyNkb2N1bWVudF9zZWxlY3QnKSwgZG9jLCBhcmdzLm1hdGNoZm9jdXMpO1xuICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkge1xuICAgICAgICAgICQoJyNkb2N1bWVudF9pbnB1dCcpLmZvY3VzKCkuc2VsZWN0KCk7XG4gICAgICAgIH0sIDApO1xuXG4qL1xuLy8gQlJBVCBTVEFOREFMT05FIExJQlJBUlkgRU5EXG4gICAgICB9OyAvLyBlbmQgc2hvd0ZpbGVCcm93c2VyKClcblxuXG4gICAgICAkKCcjY29sbGVjdGlvbl9icm93c2VyX2J1dHRvbicpLmNsaWNrKGZ1bmN0aW9uKGV2dCkge1xuICAgICAgICBkaXNwYXRjaGVyLnBvc3QoJ2NsZWFyU2VhcmNoJyk7XG4gICAgICB9KTtcblxuICAgICAgdmFyIGN1cnJlbnRTZWxlY3RvclBvc2l0aW9uID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIHZhciBwb3M7XG4gICAgICAgICQuZWFjaChzZWxlY3RvckRhdGEuaXRlbXMsIGZ1bmN0aW9uKGRvY05vLCBkb2NSb3cpIHtcbiAgICAgICAgICBpZiAoZG9jUm93WzJdID09IGRvYykge1xuICAgICAgICAgICAgLy8gYXJncyBtYXkgaGF2ZSBjaGFuZ2VkLCBzbyBsYWNraW5nIGEgcGVyZmVjdCBtYXRjaCByZXR1cm5cbiAgICAgICAgICAgIC8vIGxhc3QgbWF0Y2hpbmcgZG9jdW1lbnQgYXMgYmVzdCBndWVzc1xuICAgICAgICAgICAgcG9zID0gZG9jTm87XG4gICAgICAgICAgICAvLyBjaGVjayB3aGV0aGVyICdmb2N1cycgYWdyZWVzOyB0aGUgcmVzdCBvZiB0aGUgYXJncyBhcmVcbiAgICAgICAgICAgIC8vIGlycmVsZXZhbnQgZm9yIGRldGVybWluaW5nIHBvc2l0aW9uLlxuICAgICAgICAgICAgdmFyIGNvbGxlY3Rpb25BcmdzID0gZG9jUm93WzFdIHx8IHt9O1xuICAgICAgICAgICAgaWYgKFV0aWwuaXNFcXVhbChjb2xsZWN0aW9uQXJncy5tYXRjaGZvY3VzLCBhcmdzLm1hdGNoZm9jdXMpKSB7XG4gICAgICAgICAgICAgIHBvcyA9IGRvY05vO1xuICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuIHBvcztcbiAgICAgIH1cblxuICAgICAgLyogRU5EIGNvbGxlY3Rpb24gYnJvd3NlciAtIHJlbGF0ZWQgKi9cblxuXG4gICAgICAvKiBTVEFSVCBzZWFyY2ggLSByZWxhdGVkICovXG5cbiAgICAgIHZhciBhZGRTcGFuVHlwZXNUb1NlbGVjdCA9IGZ1bmN0aW9uKCRzZWxlY3QsIHR5cGVzLCBpbmNsdWRlZCkge1xuICAgICAgICBpZiAoIWluY2x1ZGVkKSBpbmNsdWRlZCA9IHt9O1xuICAgICAgICBpZiAoIWluY2x1ZGVkWycnXSkge1xuICAgICAgICAgIGluY2x1ZGVkWycnXSA9IHRydWU7XG4gICAgICAgICAgJHNlbGVjdC5odG1sKCc8b3B0aW9uIHZhbHVlPVwiXCI+LSBBbnkgLTwvb3B0aW9uPicpO1xuICAgICAgICB9XG4gICAgICAgICQuZWFjaCh0eXBlcywgZnVuY3Rpb24odHlwZU5vLCB0eXBlKSB7XG4gICAgICAgICAgaWYgKHR5cGUgIT09IG51bGwpIHtcbiAgICAgICAgICAgIGlmICghaW5jbHVkZWRbdHlwZS5uYW1lXSkge1xuICAgICAgICAgICAgICBpbmNsdWRlZFt0eXBlLm5hbWVdID0gdHJ1ZTtcbiAgICAgICAgICAgICAgdmFyICRvcHRpb24gPSAkKCc8b3B0aW9uIHZhbHVlPVwiJyArIFV0aWwuZXNjYXBlUXVvdGVzKHR5cGUudHlwZSkgKyAnXCIvPicpLnRleHQodHlwZS5uYW1lKTtcbiAgICAgICAgICAgICAgJHNlbGVjdC5hcHBlbmQoJG9wdGlvbik7XG4gICAgICAgICAgICAgIGlmICh0eXBlLmNoaWxkcmVuKSB7XG4gICAgICAgICAgICAgICAgYWRkU3BhblR5cGVzVG9TZWxlY3QoJHNlbGVjdCwgdHlwZS5jaGlsZHJlbiwgaW5jbHVkZWQpO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgIH07XG5cbiAgICAgIHZhciByZW1lbWJlck5vcm1EYiA9IGZ1bmN0aW9uKHJlc3BvbnNlKSB7XG4gICAgICAgIC8vIHRoZSB2aXN1YWxpemVyIG5lZWRzIHRvIHJlbWVtYmVyIGFzcGVjdHMgb2YgdGhlIG5vcm0gc2V0dXBcbiAgICAgICAgLy8gc28gdGhhdCBpdCBjYW4gYXZvaWQgbWFraW5nIHF1ZXJpZXMgZm9yIHVuY29uZmlndXJlZCBvclxuICAgICAgICAvLyBtaXNzaW5nIG5vcm1hbGl6YXRpb24gREJzLlxuICAgICAgICB2YXIgbm9ybV9yZXNvdXJjZXMgPSByZXNwb25zZS5ub3JtYWxpemF0aW9uX2NvbmZpZyB8fCBbXTtcbiAgICAgICAgJC5lYWNoKG5vcm1fcmVzb3VyY2VzLCBmdW5jdGlvbihub3JtTm8sIG5vcm0pIHtcbiAgICAgICAgICB2YXIgbm9ybU5hbWUgPSBub3JtWzBdO1xuICAgICAgICAgIHZhciBzZXJ2ZXJEYiA9IG5vcm1bM107XG4gICAgICAgICAgbm9ybVNlcnZlckRiQnlOb3JtRGJOYW1lW25vcm1OYW1lXSA9IHNlcnZlckRiO1xuICAgICAgICB9KTtcbiAgICAgIH1cblxuICAgICAgdmFyIHNldHVwU2VhcmNoVHlwZXMgPSBmdW5jdGlvbihyZXNwb25zZSkge1xuICAgICAgICBhZGRTcGFuVHlwZXNUb1NlbGVjdCgkKCcjc2VhcmNoX2Zvcm1fZW50aXR5X3R5cGUnKSwgcmVzcG9uc2UuZW50aXR5X3R5cGVzKTtcbiAgICAgICAgYWRkU3BhblR5cGVzVG9TZWxlY3QoJCgnI3NlYXJjaF9mb3JtX2V2ZW50X3R5cGUnKSwgcmVzcG9uc2UuZXZlbnRfdHlwZXMpO1xuICAgICAgICBhZGRTcGFuVHlwZXNUb1NlbGVjdCgkKCcjc2VhcmNoX2Zvcm1fcmVsYXRpb25fdHlwZScpLCByZXNwb25zZS5yZWxhdGlvbl90eXBlcyk7XG4gICAgICAgIC8vIG5pY2UtbG9va2luZyBzZWxlY3RzIGFuZCB1cGxvYWQgZmllbGRzXG4gICAgICAgICQoJyNzZWFyY2hfZm9ybSBzZWxlY3QnKS5hZGRDbGFzcygndWktd2lkZ2V0IHVpLXN0YXRlLWRlZmF1bHQgdWktYnV0dG9uLXRleHQnKTtcbiAgICAgICAgJCgnI3NlYXJjaF9mb3JtX2xvYWRfZmlsZScpLmFkZENsYXNzKCd1aS13aWRnZXQgdWktc3RhdGUtZGVmYXVsdCB1aS1idXR0b24tdGV4dCcpO1xuICAgICAgfVxuXG4gICAgICAvLyB3aGVuIGV2ZW50IHJvbGUgY2hhbmdlcywgZXZlbnQgdHlwZXMgZG8gYXMgd2VsbFxuICAgICAgdmFyIHNlYXJjaEV2ZW50Um9sZXMgPSBbXTtcbiAgICAgIHZhciBzZWFyY2hFdmVudFJvbGVDaGFuZ2VkID0gZnVuY3Rpb24oZXZ0KSB7XG4gICAgICAgIHZhciAkdHlwZSA9ICQodGhpcykucGFyZW50KCkubmV4dCgpLmNoaWxkcmVuKCdzZWxlY3QnKTtcbiAgICAgICAgdmFyIHR5cGUgPSAkdHlwZS52YWwoKTtcbiAgICAgICAgdmFyIHJvbGUgPSAkKHRoaXMpLnZhbCgpO1xuICAgICAgICB2YXIgb3JpZ2luID0gJCgnI3NlYXJjaF9mb3JtX2V2ZW50X3R5cGUnKS52YWwoKTtcbiAgICAgICAgdmFyIGV2ZW50VHlwZSA9IHNwYW5UeXBlc1tvcmlnaW5dO1xuICAgICAgICB2YXIgYXJjVHlwZXMgPSBldmVudFR5cGUgJiYgZXZlbnRUeXBlLmFyY3MgfHwgW107XG4gICAgICAgIHZhciBhcmNUeXBlID0gbnVsbDtcbiAgICAgICAgJHR5cGUuaHRtbCgnPG9wdGlvbiB2YWx1ZT1cIlwiPi0gQW55IC08L29wdGlvbj4nKTtcbiAgICAgICAgJC5lYWNoKGFyY1R5cGVzLCBmdW5jdGlvbihhcmNObywgYXJjRGVzYykge1xuICAgICAgICAgIGlmIChhcmNEZXNjLnR5cGUgPT0gcm9sZSkge1xuICAgICAgICAgICAgYXJjVHlwZSA9IGFyY0Rlc2M7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgdmFyIHRhcmdldHMgPSBhcmNUeXBlICYmIGFyY1R5cGUudGFyZ2V0cyB8fCBbXTtcbiAgICAgICAgJC5lYWNoKHRhcmdldHMsIGZ1bmN0aW9uKHRhcmdldE5vLCB0YXJnZXQpIHtcbiAgICAgICAgICB2YXIgc3BhblR5cGUgPSBzcGFuVHlwZXNbdGFyZ2V0XTtcbiAgICAgICAgICB2YXIgc3Bhbk5hbWUgPSBzcGFuVHlwZS5uYW1lIHx8IHNwYW5UeXBlLmxhYmVsc1swXSB8fCB0YXJnZXQ7XG4gICAgICAgICAgdmFyIG9wdGlvbiA9ICc8b3B0aW9uIHZhbHVlPVwiJyArIFV0aWwuZXNjYXBlUXVvdGVzKHRhcmdldCkgKyAnXCI+JyArIFV0aWwuZXNjYXBlSFRNTChzcGFuTmFtZSkgKyAnPC9vcHRpb24+J1xuICAgICAgICAgICR0eXBlLmFwcGVuZChvcHRpb24pO1xuICAgICAgICB9KTtcbiAgICAgICAgLy8gcmV0dXJuIHRoZSB0eXBlIHRvIHRoZSBzYW1lIHZhbHVlLCBpZiBwb3NzaWJsZVxuICAgICAgICBpZiAodHlwZSkge1xuICAgICAgICAgICR0eXBlLnZhbCh0eXBlKTtcbiAgICAgICAgfTtcbiAgICAgIH07XG5cbiAgICAgICQoJyNzZWFyY2hfZm9ybV9ldmVudF9yb2xlcyAuc2VhcmNoX2V2ZW50X3JvbGUgc2VsZWN0JykubGl2ZSgnY2hhbmdlJywgc2VhcmNoRXZlbnRSb2xlQ2hhbmdlZCk7XG5cbiAgICAgIC8vIGFkZGluZyBuZXcgcm9sZSByb3dzXG4gICAgICB2YXIgYWRkRW1wdHlTZWFyY2hFdmVudFJvbGUgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgdmFyICRyb2xlcyA9ICQoJyNzZWFyY2hfZm9ybV9ldmVudF9yb2xlcycpO1xuICAgICAgICB2YXIgcm93Tm8gPSAkcm9sZXMuY2hpbGRyZW4oKS5sZW5ndGg7XG4gICAgICAgIHZhciAkcm9sZSA9ICQoJzxzZWxlY3QgY2xhc3M9XCJmdWxsd2lkdGhcIi8+Jyk7XG4gICAgICAgICRyb2xlLmFwcGVuZCgnPG9wdGlvbiB2YWx1ZT1cIlwiPi0gQW55IC08L29wdGlvbj4nKTtcbiAgICAgICAgJC5lYWNoKHNlYXJjaEV2ZW50Um9sZXMsIGZ1bmN0aW9uKGFyY1R5cGVQYWlyTm8sIGFyY1R5cGVQYWlyKSB7XG4gICAgICAgICAgdmFyIG9wdGlvbiA9ICc8b3B0aW9uIHZhbHVlPVwiJyArIFV0aWwuZXNjYXBlUXVvdGVzKGFyY1R5cGVQYWlyWzBdKSArICdcIj4nICsgVXRpbC5lc2NhcGVIVE1MKGFyY1R5cGVQYWlyWzFdKSArICc8L29wdGlvbj4nXG4gICAgICAgICAgJHJvbGUuYXBwZW5kKG9wdGlvbik7XG4gICAgICAgIH0pO1xuICAgICAgICB2YXIgJHR5cGUgPSAkKCc8c2VsZWN0IGNsYXNzPVwiZnVsbHdpZHRoXCIvPicpO1xuICAgICAgICB2YXIgJHRleHQgPSAkKCc8aW5wdXQgY2xhc3M9XCJmdWxsd2lkdGhcIi8+Jyk7XG4gICAgICAgIHZhciBidXR0b24gPSAkKCc8aW5wdXQgdHlwZT1cImJ1dHRvblwiLz4nKTtcbiAgICAgICAgdmFyIHJvd0J1dHRvbiA9ICQoJzx0ZC8+JykuYXBwZW5kKGJ1dHRvbik7XG4gICAgICAgIGlmIChyb3dObykge1xuICAgICAgICAgIHJvd0J1dHRvbi5hZGRDbGFzcygnc2VhcmNoX2V2ZW50X3JvbGVfZGVsJyk7XG4gICAgICAgICAgYnV0dG9uLnZhbCgnXFx1MjAxMycpOyAvLyBuLWRhc2hcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICByb3dCdXR0b24uYWRkQ2xhc3MoJ3NlYXJjaF9ldmVudF9yb2xlX2FkZCcpO1xuICAgICAgICAgIGJ1dHRvbi52YWwoJysnKTtcbiAgICAgICAgfVxuICAgICAgICB2YXIgJHRyID0gJCgnPHRyLz4nKS5cbiAgICAgICAgICBhcHBlbmQoJCgnPHRkIGNsYXNzPVwic2VhcmNoX2V2ZW50X3JvbGVcIi8+JykuYXBwZW5kKCRyb2xlKSkuXG4gICAgICAgICAgYXBwZW5kKCQoJzx0ZCBjbGFzcz1cInNlYXJjaF9ldmVudF90eXBlXCIvPicpLmFwcGVuZCgkdHlwZSkpLlxuICAgICAgICAgIGFwcGVuZCgkKCc8dGQgY2xhc3M9XCJzZWFyY2hfZXZlbnRfdGV4dFwiLz4nKS5hcHBlbmQoJHRleHQpKS5cbiAgICAgICAgICBhcHBlbmQocm93QnV0dG9uKTtcbiAgICAgICAgJHJvbGVzLmFwcGVuZCgkdHIpO1xuICAgICAgICAkcm9sZS50cmlnZ2VyKCdjaGFuZ2UnKTtcbiAgICAgICAgLy8gc3R5bGUgc2VsZWN0b3JcbiAgICAgICAgJHJvbGUuYWRkQ2xhc3MoJ3VpLXdpZGdldCB1aS1zdGF0ZS1kZWZhdWx0IHVpLWJ1dHRvbi10ZXh0Jyk7XG4gICAgICAgICR0eXBlLmFkZENsYXNzKCd1aS13aWRnZXQgdWktc3RhdGUtZGVmYXVsdCB1aS1idXR0b24tdGV4dCcpO1xuICAgICAgICAvLyBzdHlsZSBidXR0b25cbiAgICAgICAgYnV0dG9uLmJ1dHRvbigpO1xuICAgICAgICBidXR0b24uYWRkQ2xhc3MoJ3NtYWxsLWJ1dHRvbnMgdWktYnV0dG9uLXRleHQnKS5yZW1vdmVDbGFzcygndWktYnV0dG9uJyk7XG4gICAgICB9O1xuXG4gICAgICAvLyBkZWxldGluZyByb2xlIHJvd3NcbiAgICAgIHZhciBkZWxTZWFyY2hFdmVudFJvbGUgPSBmdW5jdGlvbihldnQpIHtcbiAgICAgICAgJHJvdyA9ICQodGhpcykuY2xvc2VzdCgndHInKTtcbiAgICAgICAgJHJvdy5yZW1vdmUoKTtcbiAgICAgIH1cblxuICAgICAgJCgnI3NlYXJjaF9mb3JtX2V2ZW50X3JvbGVzIC5zZWFyY2hfZXZlbnRfcm9sZV9hZGQgaW5wdXQnKS5saXZlKCdjbGljaycsIGFkZEVtcHR5U2VhcmNoRXZlbnRSb2xlKTtcbiAgICAgICQoJyNzZWFyY2hfZm9ybV9ldmVudF9yb2xlcyAuc2VhcmNoX2V2ZW50X3JvbGVfZGVsIGlucHV0JykubGl2ZSgnY2xpY2snLCBkZWxTZWFyY2hFdmVudFJvbGUpO1xuXG4gICAgICAvLyBXaGVuIGV2ZW50IHR5cGUgY2hhbmdlcywgdGhlIGV2ZW50IHJvbGVzIGRvIGFzIHdlbGxcbiAgICAgIC8vIEFsc28sIHB1dCBpbiBvbmUgZW1wdHkgcm9sZSByb3dcbiAgICAgICQoJyNzZWFyY2hfZm9ybV9ldmVudF90eXBlJykuY2hhbmdlKGZ1bmN0aW9uKGV2dCkge1xuICAgICAgICB2YXIgJHJvbGVzID0gJCgnI3NlYXJjaF9mb3JtX2V2ZW50X3JvbGVzJykuZW1wdHkoKTtcbiAgICAgICAgc2VhcmNoRXZlbnRSb2xlcyA9IFtdO1xuICAgICAgICB2YXIgZXZlbnRUeXBlID0gc3BhblR5cGVzWyQodGhpcykudmFsKCldO1xuICAgICAgICB2YXIgYXJjVHlwZXMgPSBldmVudFR5cGUgJiYgZXZlbnRUeXBlLmFyY3MgfHwgW107XG4gICAgICAgICQuZWFjaChhcmNUeXBlcywgZnVuY3Rpb24oYXJjVHlwZU5vLCBhcmNUeXBlKSB7XG4gICAgICAgICAgdmFyIGFyY1R5cGVOYW1lID0gYXJjVHlwZS5sYWJlbHMgJiYgYXJjVHlwZS5sYWJlbHNbMF0gfHwgYXJjVHlwZS50eXBlO1xuICAgICAgICAgIHNlYXJjaEV2ZW50Um9sZXMucHVzaChbYXJjVHlwZS50eXBlLCBhcmNUeXBlTmFtZV0pO1xuICAgICAgICB9KTtcbiAgICAgICAgYWRkRW1wdHlTZWFyY2hFdmVudFJvbGUoKTtcbiAgICAgIH0pO1xuXG4gICAgICAvLyB3aGVuIHJlbGF0aW9uIGNoYW5nZXMsIGNoYW5nZSBjaG9pY2VzIG9mIGFyZzEgdHlwZVxuICAgICAgJCgnI3NlYXJjaF9mb3JtX3JlbGF0aW9uX3R5cGUnKS5jaGFuZ2UoZnVuY3Rpb24oZXZ0KSB7XG4gICAgICAgIHZhciByZWxUeXBlVHlwZSA9ICQodGhpcykudmFsKCk7XG4gICAgICAgIHZhciAkYXJnMSA9ICQoJyNzZWFyY2hfZm9ybV9yZWxhdGlvbl9hcmcxX3R5cGUnKS5cbiAgICAgICAgICAgIGh0bWwoJzxvcHRpb24gdmFsdWU9XCJcIj4tIEFueSAtPC9vcHRpb24+Jyk7XG4gICAgICAgIHZhciAkYXJnMiA9ICQoJyNzZWFyY2hfZm9ybV9yZWxhdGlvbl9hcmcyX3R5cGUnKS5lbXB0eSgpO1xuICAgICAgICAkLmVhY2goc3BhblR5cGVzLFxuICAgICAgICAgIGZ1bmN0aW9uKHNwYW5UeXBlVHlwZSwgc3BhblR5cGUpIHtcbiAgICAgICAgICBpZiAoc3BhblR5cGUuYXJjcykge1xuICAgICAgICAgICAgJC5lYWNoKHNwYW5UeXBlLmFyY3MsIGZ1bmN0aW9uKGFyY1R5cGVObywgYXJjVHlwZSkge1xuICAgICAgICAgICAgICBpZiAoYXJjVHlwZS50eXBlID09PSByZWxUeXBlVHlwZSkge1xuICAgICAgICAgICAgICAgIHZhciBzcGFuTmFtZSA9IHNwYW5UeXBlLm5hbWU7XG4gICAgICAgICAgICAgICAgdmFyIG9wdGlvbiA9ICc8b3B0aW9uIHZhbHVlPVwiJyArIFV0aWwuZXNjYXBlUXVvdGVzKHNwYW5UeXBlVHlwZSkgKyAnXCI+JyArIFV0aWwuZXNjYXBlSFRNTChzcGFuTmFtZSkgKyAnPC9vcHRpb24+J1xuICAgICAgICAgICAgICAgICRhcmcxLmFwcGVuZChvcHRpb24pO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICAkKCcjc2VhcmNoX2Zvcm1fcmVsYXRpb25fYXJnMV90eXBlJykuY2hhbmdlKCk7XG4gICAgICAgIC8vIHN0eWxlIHRoZSBzZWxlY3RzXG4gICAgICAgICRhcmcxLmFkZENsYXNzKCd1aS13aWRnZXQgdWktc3RhdGUtZGVmYXVsdCB1aS1idXR0b24tdGV4dCcpO1xuICAgICAgICAkYXJnMi5hZGRDbGFzcygndWktd2lkZ2V0IHVpLXN0YXRlLWRlZmF1bHQgdWktYnV0dG9uLXRleHQnKTtcbiAgICAgIH0pO1xuXG4gICAgICAvLyB3aGVuIGFyZzEgdHlwZSBjaGFuZ2VzLCBjaGFuZ2UgY2hvaWNlcyBvZiBhcmcyIHR5cGVcbiAgICAgICQoJyNzZWFyY2hfZm9ybV9yZWxhdGlvbl9hcmcxX3R5cGUnKS5jaGFuZ2UoZnVuY3Rpb24oZXZ0KSB7XG4gICAgICAgIHZhciAkYXJnMiA9ICQoJyNzZWFyY2hfZm9ybV9yZWxhdGlvbl9hcmcyX3R5cGUnKS5cbiAgICAgICAgICAgIGh0bWwoJzxvcHRpb24gdmFsdWU9XCJcIj4tIEFueSAtPC9vcHRpb24+Jyk7XG4gICAgICAgIHZhciByZWxUeXBlID0gJCgnI3NlYXJjaF9mb3JtX3JlbGF0aW9uX3R5cGUnKS52YWwoKTtcbiAgICAgICAgdmFyIGFyZzFUeXBlID0gc3BhblR5cGVzWyQodGhpcykudmFsKCldO1xuICAgICAgICB2YXIgYXJjVHlwZXMgPSBhcmcxVHlwZSAmJiBhcmcxVHlwZS5hcmNzIHx8IFtdO1xuICAgICAgICB2YXIgYXJjVHlwZSA9IG51bGw7XG4gICAgICAgICQuZWFjaChhcmNUeXBlcywgZnVuY3Rpb24oYXJjTm8sIGFyY0Rlc2MpIHtcbiAgICAgICAgICBpZiAoYXJjRGVzYy50eXBlID09IHJlbFR5cGUpIHtcbiAgICAgICAgICAgIGFyY1R5cGUgPSBhcmNEZXNjO1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIGlmIChhcmNUeXBlICYmIGFyY1R5cGUudGFyZ2V0cykge1xuICAgICAgICAgICQuZWFjaChhcmNUeXBlLnRhcmdldHMsIGZ1bmN0aW9uKHNwYW5UeXBlTm8sIHNwYW5UeXBlVHlwZSkge1xuICAgICAgICAgICAgdmFyIHNwYW5OYW1lID0gVXRpbC5zcGFuRGlzcGxheUZvcm0oc3BhblR5cGVzLCBzcGFuVHlwZVR5cGUpO1xuICAgICAgICAgICAgdmFyIG9wdGlvbiA9ICc8b3B0aW9uIHZhbHVlPVwiJyArIFV0aWwuZXNjYXBlUXVvdGVzKHNwYW5UeXBlVHlwZSkgKyAnXCI+JyArIFV0aWwuZXNjYXBlSFRNTChzcGFuTmFtZSkgKyAnPC9vcHRpb24+J1xuICAgICAgICAgICAgJGFyZzIuYXBwZW5kKG9wdGlvbik7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuXG4gICAgICAkKCcjc2VhcmNoX2Zvcm1fbm90ZV9jYXRlZ29yeScpLmNoYW5nZShmdW5jdGlvbihldnQpIHtcbiAgICAgICAgdmFyIGNhdGVnb3J5ID0gJCh0aGlzKS52YWwoKTtcbiAgICAgICAgdmFyICR0eXBlID0gJCgnI3NlYXJjaF9mb3JtX25vdGVfdHlwZScpO1xuICAgICAgICBpZiAoJC5pbkFycmF5KGNhdGVnb3J5LCBbJ2VudGl0eScsICdldmVudCcsICdyZWxhdGlvbiddKSAhPSAtMSkge1xuICAgICAgICAgICR0eXBlLmh0bWwoJCgnI3NlYXJjaF9mb3JtXycgKyBjYXRlZ29yeSArICdfdHlwZScpLmh0bWwoKSkudmFsKCcnKTtcbiAgICAgICAgICAkKCcjc2VhcmNoX2Zvcm1fbm90ZV90eXBlX3Jvdzpub3QoOnZpc2libGUpJykuc2hvdygnaGlnaGxpZ2h0Jyk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgJHR5cGUuaHRtbCgnJyk7XG4gICAgICAgICAgJCgnI3NlYXJjaF9mb3JtX25vdGVfdHlwZV9yb3c6dmlzaWJsZScpLmhpZGUoJ2hpZ2hsaWdodCcpO1xuICAgICAgICB9XG4gICAgICB9KTtcblxuXG4gICAgICAvLyBjb250ZXh0IGxlbmd0aCBzZXR0aW5nIHNob3VsZCBvbmx5IGJlIHZpc2libGUgaWZcbiAgICAgIC8vIGNvbmNvcmRhbmNpbmcgaXMgb25cbiAgICAgIC8vIFRPRE86IEBhbWFkYW5tYXRoOiBoZWxwLCBteSBqUXVlcnkgaXMgaG9ycmlibGVcbiAgICAgIGlmICgkKCcjY29uY29yZGFuY2luZ19vbicpLmlzKCc6Y2hlY2tlZCcpKSB7XG4gICAgICAgICQoJyNjb250ZXh0X3NpemVfZGl2Jykuc2hvdyhcImhpZ2hsaWdodFwiKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgICQoJyNjb250ZXh0X3NpemVfZGl2JykuaGlkZShcImhpZ2hsaWdodFwiKTtcbiAgICAgIH1cbiAgICAgICQoJyNjb25jb3JkYW5jaW5nIGlucHV0W3R5cGU9XCJyYWRpb1wiXScpLmNoYW5nZShmdW5jdGlvbigpIHtcbiAgICAgICAgaWYgKCQoJyNjb25jb3JkYW5jaW5nX29uJykuaXMoJzpjaGVja2VkJykpIHtcbiAgICAgICAgICAkKCcjY29udGV4dF9zaXplX2RpdicpLnNob3coXCJoaWdobGlnaHRcIik7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgJCgnI2NvbnRleHRfc2l6ZV9kaXYnKS5oaWRlKFwiaGlnaGxpZ2h0XCIpO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICAgICQoJyNzZWFyY2hfb3B0aW9ucyBkaXYuYWR2YW5jZWRPcHRpb25zJykuaGlkZShcImhpZ2hsaWdodFwiKTtcbiAgICAgIC8vIHNldCB1cCBhZHZhbmNlZCBzZWFyY2ggb3B0aW9uczsgb25seSB2aXNpYmxlIGlzIGNsaWNrZWRcbiAgICAgIHZhciBhZHZhbmNlZFNlYXJjaE9wdGlvbnNWaXNpYmxlID0gZmFsc2U7XG4gICAgICAkKCcjYWR2YW5jZWRfc2VhcmNoX29wdGlvbl90b2dnbGUnKS5jbGljayhmdW5jdGlvbihldnQpIHtcbiAgICAgICAgaWYgKGFkdmFuY2VkU2VhcmNoT3B0aW9uc1Zpc2libGUpIHtcbiAgICAgICAgICAkKCcjc2VhcmNoX29wdGlvbnMgZGl2LmFkdmFuY2VkT3B0aW9ucycpLmhpZGUoXCJoaWdobGlnaHRcIik7XG4gICAgICAgICAgJCgnI2FkdmFuY2VkX3NlYXJjaF9vcHRpb25fdG9nZ2xlJykudGV4dChcIlNob3cgYWR2YW5jZWRcIik7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgJCgnI3NlYXJjaF9vcHRpb25zIGRpdi5hZHZhbmNlZE9wdGlvbnMnKS5zaG93KFwiaGlnaGxpZ2h0XCIpO1xuICAgICAgICAgICQoJyNhZHZhbmNlZF9zZWFyY2hfb3B0aW9uX3RvZ2dsZScpLnRleHQoXCJIaWRlIGFkdmFuY2VkXCIpO1xuICAgICAgICB9XG4gICAgICAgIGFkdmFuY2VkU2VhcmNoT3B0aW9uc1Zpc2libGUgPSAhYWR2YW5jZWRTZWFyY2hPcHRpb25zVmlzaWJsZTtcbiAgICAgICAgLy8gYmxvY2sgZGVmYXVsdFxuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICB9KTtcblxuICAgICAgdmFyIGFjdGl2ZVNlYXJjaFRhYiA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAvLyBhY3RpdmVUYWI6IDAgPSBUZXh0LCAxID0gRW50aXR5LCAyID0gRXZlbnQsIDMgPSBSZWxhdGlvbiwgNCA9IE5vdGVzLCA1ID0gTG9hZFxuICAgICAgICB2YXIgYWN0aXZlVGFiID0gJCgnI3NlYXJjaF90YWJzJykudGFicygnb3B0aW9uJywgJ3NlbGVjdGVkJyk7XG4gICAgICAgIHJldHVybiBbJ3NlYXJjaFRleHQnLCAnc2VhcmNoRW50aXR5JywgJ3NlYXJjaEV2ZW50JyxcbiAgICAgICAgICAgICdzZWFyY2hSZWxhdGlvbicsICdzZWFyY2hOb3RlJywgJ3NlYXJjaExvYWQnXVthY3RpdmVUYWJdO1xuICAgICAgfVxuXG4gICAgICB2YXIgb25TZWFyY2hUYWJTZWxlY3QgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgdmFyIGFjdGlvbiA9IGFjdGl2ZVNlYXJjaFRhYigpO1xuICAgICAgICBzd2l0Y2ggKGFjdGlvbikge1xuICAgICAgICAgIGNhc2UgJ3NlYXJjaFRleHQnOlxuICAgICAgICAgICAgJCgnI3NlYXJjaF9mb3JtX3RleHRfdGV4dCcpLmZvY3VzKCkuc2VsZWN0KCk7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgICBjYXNlICdzZWFyY2hFbnRpdHknOlxuICAgICAgICAgICAgJCgnI3NlYXJjaF9mb3JtX2VudGl0eV90ZXh0JykuZm9jdXMoKS5zZWxlY3QoKTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgIGNhc2UgJ3NlYXJjaEV2ZW50JzpcbiAgICAgICAgICAgICQoJyNzZWFyY2hfZm9ybV9ldmVudF90cmlnZ2VyJykuZm9jdXMoKS5zZWxlY3QoKTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgIGNhc2UgJ3NlYXJjaFJlbGF0aW9uJzpcbiAgICAgICAgICAgICQoJyNzZWFyY2hfZm9ybV9yZWxhdGlvbl90eXBlJykuZm9jdXMoKS5zZWxlY3QoKTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgIGNhc2UgJ3NlYXJjaE5vdGUnOlxuICAgICAgICAgICAgJCgnI3NlYXJjaF9mb3JtX25vdGVfdGV4dCcpLmZvY3VzKCkuc2VsZWN0KCk7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgICBjYXNlICdzZWFyY2hMb2FkJzpcbiAgICAgICAgICAgICQoJyNzZWFyY2hfZm9ybV9sb2FkX2ZpbGUnKS5mb2N1cygpLnNlbGVjdCgpO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICAgIH07XG5cbiAgICAgIC8vIHNldCB1cCBqUXVlcnkgVUkgZWxlbWVudHMgaW4gc2VhcmNoIGZvcm1cbiAgICAgICQoJyNzZWFyY2hfdGFicycpLnRhYnMoe1xuICAgICAgICBzaG93OiBvblNlYXJjaFRhYlNlbGVjdFxuICAgICAgfSk7XG4gICAgICAkKCcjc2VhcmNoX2Zvcm0nKS5maW5kKCcucmFkaW9fZ3JvdXAnKS5idXR0b25zZXQoKTtcblxuICAgICAgdmFyIGFwcGx5U2VhcmNoUmVzdWx0cyA9IGZ1bmN0aW9uKHJlc3BvbnNlKSB7XG4gICAgICAgIGlmICghc2VhcmNoQWN0aXZlKSB7XG4gICAgICAgICAgY29sbGVjdGlvblNvcnRPcmRlciA9IHNvcnRPcmRlcjtcbiAgICAgICAgfVxuICAgICAgICBkaXNwYXRjaGVyLnBvc3QoJ3NlYXJjaFJlc3VsdHNSZWNlaXZlZCcsIFtyZXNwb25zZV0pO1xuICAgICAgICBzZWFyY2hBY3RpdmUgPSB0cnVlO1xuICAgICAgICB1cGRhdGVTZWFyY2hCdXR0b25zKCk7XG4gICAgICB9O1xuXG4gICAgICB2YXIgc2VhcmNoRm9ybSA9ICQoJyNzZWFyY2hfZm9ybScpO1xuXG4gICAgICB2YXIgc2VhcmNoRm9ybVN1Ym1pdCA9IGZ1bmN0aW9uKGV2dCkge1xuICAgICAgICAvLyBoYWNrIGFyb3VuZCBlbXB0eSBkb2N1bWVudDsgXCJcIiB3b3VsZCBiZSBpbnRlcnByZXRlZCBhc1xuICAgICAgICAvLyBtaXNzaW5nIGFyZ3VtZW50IGJ5IHNlcnZlciBkaXNwYXRjaGVyIChpc3N1ZSAjNTEzKVxuICAgICAgICAvLyBUT0RPOiBkbyB0aGlzIHByb3Blcmx5LCBhdm9pZGluZyBtYWdpYyBzdHJpbmdzXG4gICAgICAgIHZhciBhY3Rpb24gPSBhY3RpdmVTZWFyY2hUYWIoKTtcbiAgICAgICAgdmFyIGRvY0FyZyA9IGRvYyA/IGRvYyA6IFwiL05PLURPQ1VNRU5UL1wiO1xuICAgICAgICB2YXIgb3B0cyA9IHtcbiAgICAgICAgICBhY3Rpb24gOiBhY3Rpb24sXG4gICAgICAgICAgY29sbGVjdGlvbiA6IGNvbGwsXG4gICAgICAgICAgZG9jdW1lbnQ6IGRvY0FyZyxcbiAgICAgICAgICAvLyBUT0RPIHRoZSBzZWFyY2ggZm9ybSBnb3QgY29tcGxleCA6KVxuICAgICAgICB9O1xuXG4gICAgICAgIHN3aXRjaCAoYWN0aW9uKSB7XG4gICAgICAgICAgY2FzZSAnc2VhcmNoVGV4dCc6XG4gICAgICAgICAgICBvcHRzLnRleHQgPSAkKCcjc2VhcmNoX2Zvcm1fdGV4dF90ZXh0JykudmFsKCk7XG4gICAgICAgICAgICBpZiAoIW9wdHMudGV4dC5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgZGlzcGF0Y2hlci5wb3N0KCdtZXNzYWdlcycsIFtbWydQbGVhc2UgZmlsbCBpbiB0aGUgdGV4dCB0byBzZWFyY2ggZm9yIScsICdjb21tZW50J11dXSk7XG4gICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgIGNhc2UgJ3NlYXJjaEVudGl0eSc6XG4gICAgICAgICAgICBvcHRzLnR5cGUgPSAkKCcjc2VhcmNoX2Zvcm1fZW50aXR5X3R5cGUnKS52YWwoKSB8fCAnJztcbiAgICAgICAgICAgIG9wdHMudGV4dCA9ICQoJyNzZWFyY2hfZm9ybV9lbnRpdHlfdGV4dCcpLnZhbCgpO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgY2FzZSAnc2VhcmNoRXZlbnQnOlxuICAgICAgICAgICAgb3B0cy50eXBlID0gJCgnI3NlYXJjaF9mb3JtX2V2ZW50X3R5cGUnKS52YWwoKSB8fCAnJztcbiAgICAgICAgICAgIG9wdHMudHJpZ2dlciA9ICQoJyNzZWFyY2hfZm9ybV9ldmVudF90cmlnZ2VyJykudmFsKCk7XG4gICAgICAgICAgICB2YXIgZWFyZ3MgPSBbXTtcbiAgICAgICAgICAgICQoJyNzZWFyY2hfZm9ybV9ldmVudF9yb2xlcyB0cicpLmVhY2goZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgIHZhciBlYXJnID0ge307XG4gICAgICAgICAgICAgIGVhcmcucm9sZSA9ICQodGhpcykuZmluZCgnLnNlYXJjaF9ldmVudF9yb2xlIHNlbGVjdCcpLnZhbCgpIHx8ICcnO1xuICAgICAgICAgICAgICBlYXJnLnR5cGUgPSAkKHRoaXMpLmZpbmQoJy5zZWFyY2hfZXZlbnRfdHlwZSBzZWxlY3QnKS52YWwoKSB8fCAnJztcbiAgICAgICAgICAgICAgZWFyZy50ZXh0ID0gJCh0aGlzKS5maW5kKCcuc2VhcmNoX2V2ZW50X3RleHQgaW5wdXQnKS52YWwoKTtcbiAgICAgICAgICAgICAgZWFyZ3MucHVzaChlYXJnKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgb3B0cy5hcmdzID0gJC50b0pTT04oZWFyZ3MpO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgY2FzZSAnc2VhcmNoUmVsYXRpb24nOlxuICAgICAgICAgICAgb3B0cy50eXBlID0gJCgnI3NlYXJjaF9mb3JtX3JlbGF0aW9uX3R5cGUnKS52YWwoKSB8fCAnJztcbiAgICAgICAgICAgIG9wdHMuYXJnMSA9ICQoJyNzZWFyY2hfZm9ybV9yZWxhdGlvbl9hcmcxX3RleHQnKS52YWwoKTtcbiAgICAgICAgICAgIG9wdHMuYXJnMXR5cGUgPSAkKCcjc2VhcmNoX2Zvcm1fcmVsYXRpb25fYXJnMV90eXBlJykudmFsKCkgfHwgJyc7XG4gICAgICAgICAgICBvcHRzLmFyZzIgPSAkKCcjc2VhcmNoX2Zvcm1fcmVsYXRpb25fYXJnMl90ZXh0JykudmFsKCk7XG4gICAgICAgICAgICBvcHRzLmFyZzJ0eXBlID0gJCgnI3NlYXJjaF9mb3JtX3JlbGF0aW9uX2FyZzJfdHlwZScpLnZhbCgpIHx8ICcnO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgY2FzZSAnc2VhcmNoTm90ZSc6XG4gICAgICAgICAgICBvcHRzLmNhdGVnb3J5ID0gJCgnI3NlYXJjaF9mb3JtX25vdGVfY2F0ZWdvcnknKS52YWwoKSB8fCAnJztcbiAgICAgICAgICAgIG9wdHMudHlwZSA9ICQoJyNzZWFyY2hfZm9ybV9ub3RlX3R5cGUnKS52YWwoKSB8fCAnJztcbiAgICAgICAgICAgIG9wdHMudGV4dCA9ICQoJyNzZWFyY2hfZm9ybV9ub3RlX3RleHQnKS52YWwoKSB8fCAnJztcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgIGNhc2UgJ3NlYXJjaExvYWQnOlxuICAgICAgICAgICAgYXBwbHlTZWFyY2hSZXN1bHRzKGxvYWRlZFNlYXJjaERhdGEpO1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gZmlsbCBpbiBzY29wZSBvZiBzZWFyY2ggKFwiZG9jdW1lbnRcIiAvIFwiY29sbGVjdGlvblwiKVxuICAgICAgICB2YXIgc2VhcmNoU2NvcGUgPSAkKCcjc2VhcmNoX3Njb3BlIGlucHV0OmNoZWNrZWQnKS52YWwoKTtcbiAgICAgICAgb3B0cy5zY29wZSA9IHNlYXJjaFNjb3BlO1xuXG4gICAgICAgIC8vIGFkanVzdCBzcGVjaWZpYyBhY3Rpb24gdG8gaW52b2tlIGJ5IHNjb3BlXG4gICAgICAgIGlmIChzZWFyY2hTY29wZSA9PSBcImRvY3VtZW50XCIpIHtcbiAgICAgICAgICBvcHRzLmFjdGlvbiA9IG9wdHMuYWN0aW9uICsgXCJJbkRvY3VtZW50XCI7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgb3B0cy5hY3Rpb24gPSBvcHRzLmFjdGlvbiArIFwiSW5Db2xsZWN0aW9uXCI7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBmaWxsIGluIGNvbmNvcmRhbmNpbmcgb3B0aW9uc1xuICAgICAgICBvcHRzLmNvbmNvcmRhbmNpbmcgPSAkKCcjY29uY29yZGFuY2luZ19vbicpLmlzKCc6Y2hlY2tlZCcpO1xuICAgICAgICBvcHRzLmNvbnRleHRfbGVuZ3RoID0gJCgnI2NvbnRleHRfbGVuZ3RoJykudmFsKCk7XG5cbiAgICAgICAgLy8gZmlsbCBpbiB0ZXh0IG1hdGNoIG9wdGlvbnNcbiAgICAgICAgb3B0cy50ZXh0X21hdGNoID0gJCgnI3RleHRfbWF0Y2ggaW5wdXQ6Y2hlY2tlZCcpLnZhbCgpXG4gICAgICAgIG9wdHMubWF0Y2hfY2FzZSA9ICQoJyNtYXRjaF9jYXNlX29uJykuaXMoJzpjaGVja2VkJyk7XG5cbiAgICAgICAgZGlzcGF0Y2hlci5wb3N0KCdoaWRlRm9ybScpO1xuICAgICAgICBkaXNwYXRjaGVyLnBvc3QoJ2FqYXgnLCBbb3B0cywgZnVuY3Rpb24ocmVzcG9uc2UpIHtcbiAgICAgICAgICBpZihyZXNwb25zZSAmJiByZXNwb25zZS5pdGVtcyAmJiByZXNwb25zZS5pdGVtcy5sZW5ndGggPT0gMCkge1xuICAgICAgICAgICAgLy8gVE9ETzogbWlnaHQgY29uc2lkZXIgaGF2aW5nIHRoaXMgbWVzc2FnZSBjb21lIGZyb20gdGhlXG4gICAgICAgICAgICAvLyBzZXJ2ZXIgaW5zdGVhZFxuICAgICAgICAgICAgZGlzcGF0Y2hlci5wb3N0KCdtZXNzYWdlcycsIFtbWydObyBtYXRjaGVzIHRvIHNlYXJjaC4nLCAnY29tbWVudCddXV0pO1xuICAgICAgICAgICAgZGlzcGF0Y2hlci5wb3N0KCdjbGVhclNlYXJjaCcsIFt0cnVlXSk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGFwcGx5U2VhcmNoUmVzdWx0cyhyZXNwb25zZSk7XG4gICAgICAgICAgfVxuICAgICAgICB9XSk7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgIH07XG5cbiAgICAgICQoJyNzZWFyY2hfZm9ybV9sb2FkX2ZpbGUnKS5jaGFuZ2UoZnVuY3Rpb24oZXZ0KSB7XG4gICAgICAgIHZhciAkZmlsZSA9ICQoJyNzZWFyY2hfZm9ybV9sb2FkX2ZpbGUnKTtcbiAgICAgICAgdmFyIGZpbGUgPSAkZmlsZVswXS5maWxlc1swXTtcbiAgICAgICAgdmFyIHJlYWRlciA9IG5ldyBGaWxlUmVhZGVyKCk7XG4gICAgICAgIHJlYWRlci5vbmVycm9yID0gZnVuY3Rpb24oZXZ0KSB7XG4gICAgICAgICAgZGlzcGF0Y2hlci5wb3N0KCdtZXNzYWdlcycsIFtbWydUaGUgZmlsZSBjb3VsZCBub3QgYmUgcmVhZC4nLCAnZXJyb3InXV1dKTtcbiAgICAgICAgfTtcbiAgICAgICAgcmVhZGVyLm9ubG9hZGVuZCA9IGZ1bmN0aW9uKGV2dCkge1xuICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICBsb2FkZWRTZWFyY2hEYXRhID0gSlNPTi5wYXJzZShldnQudGFyZ2V0LnJlc3VsdCk7XG4gICAgICAgICAgICAvLyBUT0RPIFhYWCBjaGVjayBmb3IgdmFsaWRpdHkgb2YgY29udGVudHMsIG5vdCBqdXN0IHdoZXRoZXJcbiAgICAgICAgICAgIC8vIGl0J3MgdmFsaWQgSlNPTiBvciBub3Q7IHRocm93IHNvbWV0aGluZyBpZiBub3RcbiAgICAgICAgICB9IGNhdGNoICh4KSB7XG4gICAgICAgICAgICBkaXNwYXRjaGVyLnBvc3QoJ21lc3NhZ2VzJywgW1tbJ1RoZSBmaWxlIGNvbnRhaW5zIGludmFsaWQgZGF0YS4nLCAnZXJyb3InXV1dKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICAgIHJlYWRlci5yZWFkQXNUZXh0KGZpbGUpO1xuICAgICAgfSk7XG5cbiAgICAgIHNlYXJjaEZvcm0uc3VibWl0KHNlYXJjaEZvcm1TdWJtaXQpO1xuXG4gICAgICBpbml0Rm9ybShzZWFyY2hGb3JtLCB7XG4gICAgICAgICAgd2lkdGg6IDUwMCxcbiAgICAgICAgICAvLyBhbHNvUmVzaXplOiAnI3NlYXJjaF90YWJzJyxcbiAgICAgICAgICByZXNpemFibGU6IGZhbHNlLFxuICAgICAgICAgIG9wZW46IGZ1bmN0aW9uKGV2dCkge1xuICAgICAgICAgICAga2V5bWFwID0ge307XG4gICAgICAgICAgfSxcbiAgICAgIH0pO1xuICAgICAgJCgnI3NlYXJjaF9mb3JtX2NsZWFyJykuYXR0cigndGl0bGUnLCAnQ2xlYXIgdGhlIHNlYXJjaCBhbmQgcmVzdW1lIG5vcm1hbCBjb2xsZWN0aW9uIGJyb3dzaW5nJyk7XG5cbiAgICAgIHZhciBzaG93U2VhcmNoRm9ybSA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAvLyB0aGlzLmNoZWNrZWQgPSBzZWFyY2hBY3RpdmU7IC8vIFRPRE86IGR1cD8gdW5uZWNlc3Nhcnk/IHJlbW92ZSBpZiB5ZXMuXG4gICAgICAgIHVwZGF0ZVNlYXJjaEJ1dHRvbnMoKTtcbiAgICAgICAgJCgnI3NlYXJjaF9mb3JtX2V2ZW50X3R5cGUnKS5jaGFuZ2UoKTtcbiAgICAgICAgJCgnI3NlYXJjaF9mb3JtX3JlbGF0aW9uX3R5cGUnKS5jaGFuZ2UoKTtcbiAgICAgICAgZGlzcGF0Y2hlci5wb3N0KCdzaG93Rm9ybScsIFtzZWFyY2hGb3JtXSk7XG4gICAgICAgIG9uU2VhcmNoVGFiU2VsZWN0KCk7XG4gICAgICB9XG5cbiAgICAgICQoJyNzZWFyY2hfYnV0dG9uJykuY2xpY2soc2hvd1NlYXJjaEZvcm0pO1xuXG4gICAgICB2YXIgY2xlYXJTZWFyY2hSZXN1bHRzID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIC8vIGNsZWFyIFVJLCBkb24ndCBzaG93IGNvbGxlY3Rpb24gYnJvd3NlclxuICAgICAgICBkaXNwYXRjaGVyLnBvc3QoJ2NsZWFyU2VhcmNoJywgW3RydWVdKTtcbiAgICAgICAgLy8gVE9ETzogdGhpcyB3YXMgdGhlIG9ubHkgd2F5IEkgZm91bmQgdG8gcmVzZXQgc2VhcmNoLiBJdFxuICAgICAgICAvLyB0cmlnZ2VyIGFuIHVubmVjZXNzYXJ5IHJvdW5kLXRyaXAgdG8gdGhlIHNlcnZlciwgdGhvdWdoLFxuICAgICAgICAvLyBzbyB0aGVyZSBzaG91bGQgYmUgYSBiZXR0ZXIgd2F5IC4uLlxuICAgICAgICBkaXNwYXRjaGVyLnBvc3QoJ3NldEFyZ3VtZW50cycsIFt7fSwgdHJ1ZV0pO1xuICAgICAgfVxuXG4gICAgICAkKCcjY2xlYXJfc2VhcmNoX2J1dHRvbicpLmNsaWNrKGNsZWFyU2VhcmNoUmVzdWx0cyk7XG5cbiAgICAgIHZhciB1cGRhdGVTZWFyY2hCdXR0b25zID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICRzZWFyY2hCdXR0b24gPSAkKCcjc2VhcmNoX2J1dHRvbicpO1xuICAgICAgICAkc2VhcmNoQnV0dG9uWzBdLmNoZWNrZWQgPSBzZWFyY2hBY3RpdmU7XG4gICAgICAgICRzZWFyY2hCdXR0b24uYnV0dG9uKCdyZWZyZXNoJyk7XG4gICAgICAgICRjbGVhclNlYXJjaEJ1dHRvbiA9ICQoJyNjbGVhcl9zZWFyY2hfYnV0dG9uJyk7XG4gICAgICAgIGlmIChzZWFyY2hBY3RpdmUpIHtcbiAgICAgICAgICAgIC8vIFRPRE86IHRoaXMgaXMgYSBiaXQgcG9vciBmb3JtLCB1c2luZyBqUXVlcnkgVUkgY2xhc3Nlc1xuICAgICAgICAgICAgLy8gZGlyZWN0bHkgLS0gYXJlIHRoZXNlIG5hbWVzIGd1YXJhbnRlZWQgdG8gYmUgc3RhYmxlP1xuICAgICAgICAgICAgJCgnI3NlYXJjaF9idXR0b25fbGFiZWwnKS5yZW1vdmVDbGFzcygndWktY29ybmVyLWFsbCcpO1xuICAgICAgICAgICAgJCgnI3NlYXJjaF9idXR0b25fbGFiZWwnKS5hZGRDbGFzcygndWktY29ybmVyLWxlZnQnKTtcbiAgICAgICAgICAgICRjbGVhclNlYXJjaEJ1dHRvbi5zaG93KCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAkKCcjc2VhcmNoX2J1dHRvbl9sYWJlbCcpLnJlbW92ZUNsYXNzKCd1aS1jb3JuZXItbGVmdCcpO1xuICAgICAgICAgICAgJCgnI3NlYXJjaF9idXR0b25fbGFiZWwnKS5hZGRDbGFzcygndWktY29ybmVyLWFsbCcpO1xuICAgICAgICAgICAgJGNsZWFyU2VhcmNoQnV0dG9uLmhpZGUoKTtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICAvKiBFTkQgc2VhcmNoIC0gcmVsYXRlZCAqL1xuXG5cbiAgICAgIC8qIFNUQVJUIGRhdGEgZGlhbG9nIC0gcmVsYXRlZCAqL1xuXG4gICAgICB2YXIgZGF0YUZvcm0gPSAkKCcjZGF0YV9mb3JtJyk7XG4gICAgICB2YXIgZGF0YUZvcm1TdWJtaXQgPSBmdW5jdGlvbihldnQpIHtcbiAgICAgICAgZGlzcGF0Y2hlci5wb3N0KCdoaWRlRm9ybScpO1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICB9O1xuICAgICAgZGF0YUZvcm0uc3VibWl0KGRhdGFGb3JtU3VibWl0KTtcbiAgICAgIGluaXRGb3JtKGRhdGFGb3JtLCB7XG4gICAgICAgICAgd2lkdGg6IDUwMCxcbiAgICAgICAgICByZXNpemFibGU6IGZhbHNlLFxuICAgICAgICAgIG5vX2NhbmNlbDogdHJ1ZSxcbiAgICAgICAgICBvcGVuOiBmdW5jdGlvbihldnQpIHtcbiAgICAgICAgICAgIGtleW1hcCA9IHt9O1xuICAgICAgICAgICAgLy8gYXNwZWN0cyBvZiB0aGUgZGF0YSBmb3JtIHJlbGF0aW5nIHRvIHRoZSBjdXJyZW50IGRvY3VtZW50IHNob3VsZFxuICAgICAgICAgICAgLy8gb25seSBiZSBzaG93biB3aGVuIGEgZG9jdW1lbnQgaXMgc2VsZWN0ZWQuXG4gICAgICAgICAgICBpZiAoIWRvYykge1xuICAgICAgICAgICAgICAkKCcjZG9jdW1lbnRfZXhwb3J0JykuaGlkZSgpO1xuICAgICAgICAgICAgICAkKCcjZG9jdW1lbnRfdmlzdWFsaXphdGlvbicpLmhpZGUoKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICQoJyNkb2N1bWVudF9leHBvcnQnKS5zaG93KCk7XG4gICAgICAgICAgICAgICQoJyNkb2N1bWVudF92aXN1YWxpemF0aW9uJykuc2hvdygpO1xuICAgICAgICAgICAgICAvLyB0aGUgU1ZHIGJ1dHRvbiBjYW4gb25seSBiZSBhY2Nlc3NlZCB0aHJvdWdoIHRoZSBkYXRhIGZvcm0sXG4gICAgICAgICAgICAgIC8vIHNvIHdlJ2xsIHNwYXJlIHVubmVjZXNzYXJ5IHNhdmVzIGJ5IG9ubHkgc2F2aW5nIGhlcmVcbiAgICAgICAgICAgICAgc2F2ZVNWRygpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgIH0pO1xuICAgICAgJCgnI2RhdGFfYnV0dG9uJykuY2xpY2soZnVuY3Rpb24oKSB7XG4gICAgICAgIGRpc3BhdGNoZXIucG9zdCgnc2hvd0Zvcm0nLCBbZGF0YUZvcm1dKTtcbiAgICAgIH0pO1xuICAgICAgLy8gbWFrZSBuaWNlLWxvb2tpbmcgYnV0dG9ucyBmb3IgY2hlY2tib3hlcyBhbmQgYnV0dG9uc1xuICAgICAgJCgnI2RhdGFfZm9ybScpLmZpbmQoJ2lucHV0W3R5cGU9XCJjaGVja2JveFwiXScpLmJ1dHRvbigpO1xuICAgICAgJCgnI2RhdGFfZm9ybScpLmZpbmQoJ2lucHV0W3R5cGU9XCJidXR0b25cIl0nKS5idXR0b24oKTtcblxuICAgICAgLy8gcmVzaXplIGludmFsaWRhdGVzIHN0b3JlZCB2aXN1YWxpemF0aW9uIChTVkcgZXRjLik7IGFkZCBhXG4gICAgICAvLyBidXR0b24gdG8gcmVnZW5cbiAgICAgICQoJyNzdG9yZWRfZmlsZV9yZWdlbmVyYXRlJykuYnV0dG9uKCkuaGlkZSgpO1xuICAgICAgJCgnI3N0b3JlZF9maWxlX3JlZ2VuZXJhdGUnKS5jbGljayhmdW5jdGlvbihldnQpIHtcbiAgICAgICAgJCgnI3N0b3JlZF9maWxlX3JlZ2VuZXJhdGUnKS5oaWRlKCk7XG4gICAgICAgIHNhdmVTVkcoKTtcbiAgICAgIH0pO1xuXG4gICAgICAvKiBFTkQgZGF0YSBkaWFsb2cgLSByZWxhdGVkICovXG5cblxuICAgICAgLyogU1RBUlQgb3B0aW9ucyBkaWFsb2cgLSByZWxhdGVkICovXG5cbiAgICAgIHZhciBvcHRpb25zRm9ybSA9ICQoJyNvcHRpb25zX2Zvcm0nKTtcbiAgICAgIHZhciBvcHRpb25zRm9ybVN1Ym1pdCA9IGZ1bmN0aW9uKGV2dCkge1xuICAgICAgICBkaXNwYXRjaGVyLnBvc3QoJ2hpZGVGb3JtJyk7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgIH07XG4gICAgICBvcHRpb25zRm9ybS5zdWJtaXQob3B0aW9uc0Zvcm1TdWJtaXQpO1xuICAgICAgaW5pdEZvcm0ob3B0aW9uc0Zvcm0sIHtcbiAgICAgICAgICB3aWR0aDogNTUwLFxuICAgICAgICAgIHJlc2l6YWJsZTogZmFsc2UsXG4gICAgICAgICAgbm9fY2FuY2VsOiB0cnVlLFxuICAgICAgICAgIG9wZW46IGZ1bmN0aW9uKGV2dCkge1xuICAgICAgICAgICAga2V5bWFwID0ge307XG4gICAgICAgICAgfVxuICAgICAgfSk7XG4gICAgICAkKCcjb3B0aW9uc19idXR0b24nKS5jbGljayhmdW5jdGlvbigpIHtcbiAgICAgICAgZGlzcGF0Y2hlci5wb3N0KCdzaG93Rm9ybScsIFtvcHRpb25zRm9ybV0pO1xuICAgICAgfSk7XG4gICAgICAvLyBtYWtlIG5pY2UtbG9va2luZyBidXR0b25zIGZvciBjaGVja2JveGVzIGFuZCByYWRpb3NcbiAgICAgICQoJyNvcHRpb25zX2Zvcm0nKS5maW5kKCdpbnB1dFt0eXBlPVwiY2hlY2tib3hcIl0nKS5idXR0b24oKTtcbiAgICAgICQoJyNvcHRpb25zX2Zvcm0nKS5maW5kKCcucmFkaW9fZ3JvdXAnKS5idXR0b25zZXQoKTtcbiAgICAgICQoJyNyYXBpZF9tb2RlbCcpLmFkZENsYXNzKCd1aS13aWRnZXQgdWktc3RhdGUtZGVmYXVsdCB1aS1idXR0b24tdGV4dCcpO1xuXG4gICAgICB2YXIgZmlsbERpc2FtYmlndWF0b3JPcHRpb25zID0gZnVuY3Rpb24oZGlzYW1iaWd1YXRvcnMpIHtcbiAgICAgICAgJCgnI2Fubm90YXRpb25fc3BlZWQzJykuYnV0dG9uKGRpc2FtYmlndWF0b3JzLmxlbmd0aCA/ICdlbmFibGUnOiAnZGlzYWJsZScpO1xuICAgICAgICAvL1hYWDogV2UgbmVlZCB0byBkaXNhYmxlIHJhcGlkIGluIHRoZSBjb25mIHRvbyBpZiBpdCBpcyBub3QgYXZhaWxhYmxlXG4gICAgICAgIHZhciAkcmFwaWRfbW9kZSA9ICQoJyNyYXBpZF9tb2RlbCcpLmh0bWwoJycpO1xuICAgICAgICAkLmVhY2goZGlzYW1iaWd1YXRvcnMsIGZ1bmN0aW9uKG1vZGVsTm8sIG1vZGVsKSB7XG4gICAgICAgICAgdmFyICRvcHRpb24gPSAkKCc8b3B0aW9uLz4nKS5hdHRyKCd2YWx1ZScsIG1vZGVsWzJdKS50ZXh0KG1vZGVsWzJdKTtcbiAgICAgICAgICAkcmFwaWRfbW9kZS5hcHBlbmQoJG9wdGlvbik7XG4gICAgICAgIH0pO1xuICAgICAgfTtcblxuICAgICAgLyogRU5EIG9wdGlvbnMgZGlhbG9nIC0gcmVsYXRlZCAqL1xuXG5cbiAgICAgIC8qIFNUQVJUIFwibW9yZSBjb2xsZWN0aW9uIGluZm9ybWF0aW9uXCIgZGlhbG9nIC0gcmVsYXRlZCAqL1xuXG4gICAgICB2YXIgbW9yZUluZm9EaWFsb2cgPSAkKCcjbW9yZV9pbmZvcm1hdGlvbl9kaWFsb2cnKTtcbiAgICAgIHZhciBtb3JlSW5mb0RpYWxvZ1N1Ym1pdCA9IGZ1bmN0aW9uKGV2dCkge1xuICAgICAgICBkaXNwYXRjaGVyLnBvc3QoJ2hpZGVGb3JtJyk7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgIH07XG4gICAgICBtb3JlSW5mb0RpYWxvZy5zdWJtaXQobW9yZUluZm9EaWFsb2dTdWJtaXQpO1xuICAgICAgaW5pdEZvcm0obW9yZUluZm9EaWFsb2csIHtcbiAgICAgICAgICB3aWR0aDogNTAwLFxuICAgICAgICAgIG5vX2NhbmNlbDogdHJ1ZSxcbiAgICAgICAgICBvcGVuOiBmdW5jdGlvbihldnQpIHtcbiAgICAgICAgICAgIGtleW1hcCA9IHt9O1xuICAgICAgICAgIH0sXG4gICAgICAgICAgYWxzb1Jlc2l6ZTogJyNtb3JlX2luZm9fcmVhZG1lJyxcbiAgICAgIH0pO1xuICAgICAgJCgnI21vcmVfcmVhZG1lX2J1dHRvbicpLmNsaWNrKGZ1bmN0aW9uKCkge1xuICAgICAgICBkaXNwYXRjaGVyLnBvc3QoJ3Nob3dGb3JtJywgW21vcmVJbmZvRGlhbG9nXSk7XG4gICAgICB9KTtcblxuICAgICAgLyogRU5EIFwibW9yZSBjb2xsZWN0aW9uIGluZm9ybWF0aW9uXCIgZGlhbG9nIC0gcmVsYXRlZCAqL1xuXG5cbiAgICAgIHZhciBvbktleURvd24gPSBmdW5jdGlvbihldnQpIHtcbiAgICAgICAgdmFyIGNvZGUgPSBldnQud2hpY2g7XG5cbiAgICAgICAgaWYgKGNvZGUgPT09ICQudWkua2V5Q29kZS5FU0NBUEUpIHtcbiAgICAgICAgICBkaXNwYXRjaGVyLnBvc3QoJ21lc3NhZ2VzJywgW2ZhbHNlXSk7XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKGN1cnJlbnRGb3JtKSB7XG4gICAgICAgICAgaWYgKGNvZGUgPT09ICQudWkua2V5Q29kZS5FTlRFUikge1xuICAgICAgICAgICAgLy8gZG9uJ3QgdHJpZ2dlciBzdWJtaXQgaW4gdGV4dGFyZWFzIHRvIGFsbG93IG11bHRpbGluZSB0ZXh0XG4gICAgICAgICAgICAvLyBlbnRyeVxuICAgICAgICAgICAgLy8gTk9URTogc3BlYyBzZWVtcyB0byByZXF1aXJlIHRoaXMgdG8gYmUgdXBwZXItY2FzZSxcbiAgICAgICAgICAgIC8vIGJ1dCBhdCBsZWFzdCBjaHJvbWUgOC4wLjU1Mi4yMTUgcmV0dXJucyBsb3dlcmNhc2VkXG4gICAgICAgICAgICB2YXIgbm9kZVR5cGUgPSBldnQudGFyZ2V0LnR5cGUgPyBldnQudGFyZ2V0LnR5cGUudG9Mb3dlckNhc2UoKSA6ICcnO1xuICAgICAgICAgICAgaWYgKGV2dC50YXJnZXQubm9kZU5hbWUgJiYgXG4gICAgICAgICAgICAgICAgZXZ0LnRhcmdldC5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpID09ICdpbnB1dCcgJiYgXG4gICAgICAgICAgICAgICAgKG5vZGVUeXBlID09ICd0ZXh0JyB8fCBcbiAgICAgICAgICAgICAgICAgbm9kZVR5cGUgPT0gJ3Bhc3N3b3JkJykpIHtcbiAgICAgICAgICAgICAgY3VycmVudEZvcm0udHJpZ2dlcignc3VibWl0Jyk7XG4gICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9IGVsc2UgaWYgKGV2dC5jdHJsS2V5ICYmXG4gICAgICAgICAgICAgICAgKGNvZGUgPT0gJ0YnLmNoYXJDb2RlQXQoMCkgfHwgY29kZSA9PSAnRycuY2hhckNvZGVBdCgwKSkpIHtcbiAgICAgICAgICAgIC8vIHByZXZlbnQgQ3RybC1GL0N0cmwtRyBpbiBmb3Jtc1xuICAgICAgICAgICAgZXZ0LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgfVxuICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChjb2RlID09PSAkLnVpLmtleUNvZGUuVEFCKSB7XG4gICAgICAgICAgc2hvd0ZpbGVCcm93c2VyKCk7XG4gICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9IGVsc2UgaWYgKGNvZGUgPT0gJC51aS5rZXlDb2RlLkxFRlQpIHtcbiAgICAgICAgICByZXR1cm4gbW92ZUluRmlsZUJyb3dzZXIoLTEpO1xuICAgICAgICB9IGVsc2UgaWYgKGNvZGUgPT09ICQudWkua2V5Q29kZS5SSUdIVCkge1xuICAgICAgICAgIHJldHVybiBtb3ZlSW5GaWxlQnJvd3NlcigrMSk7XG4gICAgICAgIH0gZWxzZSBpZiAoZXZ0LnNoaWZ0S2V5ICYmIGNvZGUgPT09ICQudWkua2V5Q29kZS5VUCkge1xuICAgICAgICAgIGF1dG9QYWdpbmcodHJ1ZSk7XG4gICAgICAgIH0gZWxzZSBpZiAoZXZ0LnNoaWZ0S2V5ICYmIGNvZGUgPT09ICQudWkua2V5Q29kZS5ET1dOKSB7XG4gICAgICAgICAgYXV0b1BhZ2luZyhmYWxzZSk7XG4gICAgICAgIH0gZWxzZSBpZiAoZXZ0LmN0cmxLZXkgJiYgY29kZSA9PSAnRicuY2hhckNvZGVBdCgwKSkge1xuICAgICAgICAgIGV2dC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgIHNob3dTZWFyY2hGb3JtKCk7XG4gICAgICAgIH0gZWxzZSBpZiAoc2VhcmNoQWN0aXZlICYmIGV2dC5jdHJsS2V5ICYmIGNvZGUgPT0gJ0cnLmNoYXJDb2RlQXQoMCkpIHtcbiAgICAgICAgICBldnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICByZXR1cm4gbW92ZUluRmlsZUJyb3dzZXIoKzEpO1xuICAgICAgICB9IGVsc2UgaWYgKHNlYXJjaEFjdGl2ZSAmJiBldnQuY3RybEtleSAmJiBjb2RlID09ICdLJy5jaGFyQ29kZUF0KDApKSB7XG4gICAgICAgICAgZXZ0LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgY2xlYXJTZWFyY2hSZXN1bHRzKCk7XG4gICAgICAgIH1cbiAgICAgIH07XG5cbiAgICAgIHZhciBtb3ZlSW5GaWxlQnJvd3NlciA9IGZ1bmN0aW9uKGRpcikge1xuICAgICAgICB2YXIgcG9zID0gY3VycmVudFNlbGVjdG9yUG9zaXRpb24oKTtcbiAgICAgICAgdmFyIG5ld1BvcyA9IHBvcyArIGRpcjtcbiAgICAgICAgaWYgKG5ld1BvcyA+PSAwICYmIG5ld1BvcyA8IHNlbGVjdG9yRGF0YS5pdGVtcy5sZW5ndGggJiZcbiAgICAgICAgICAgIHNlbGVjdG9yRGF0YS5pdGVtc1tuZXdQb3NdWzBdICE9IFwiY1wiKSB7XG4gICAgICAgICAgLy8gbm90IGF0IHRoZSBzdGFydCwgYW5kIHRoZSBwcmV2aW91cyBpcyBub3QgYSBjb2xsZWN0aW9uIChkaXIpXG4gICAgICAgICAgZGlzcGF0Y2hlci5wb3N0KCdhbGxvd1JlbG9hZEJ5VVJMJyk7XG4gICAgICAgICAgZGlzcGF0Y2hlci5wb3N0KCdzZXREb2N1bWVudCcsIFtzZWxlY3RvckRhdGEuaXRlbXNbbmV3UG9zXVsyXSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGVjdG9yRGF0YS5pdGVtc1tuZXdQb3NdWzFdXSk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgfTtcbiAgICAgXG4gICAgICAvKiBBdXRvbWF0aWNhbGx5IHByb2NlZWQgZnJvbSBkb2N1bWVudCB0byBkb2N1bWVudCAqLyBcbiAgICAgIHZhciBhdXRvUGFnaW5nVGltZW91dCA9IG51bGw7XG4gICAgICB2YXIgYXV0b1BhZ2luZyA9IGZ1bmN0aW9uKG9uKSB7XG4gICAgICAgICAgY2xlYXJUaW1lb3V0KGF1dG9QYWdpbmdUaW1lb3V0KTtcbiAgICAgICAgICBpZiAob24pIHtcbiAgICAgICAgICAgIGF1dG9QYWdpbmdUaW1lb3V0ID0gc2V0SW50ZXJ2YWwoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgIG1vdmVJbkZpbGVCcm93c2VyKCsxKTtcbiAgICAgICAgICAgIH0sIDIwMDApO1xuICAgICAgICAgIH1cbiAgICAgIH07XG5cbiAgICAgIHZhciByZXNpemVGdW5jdGlvbiA9IGZ1bmN0aW9uKGV2dCkge1xuICAgICAgICBkaXNwYXRjaGVyLnBvc3QoJ3JlbmRlckRhdGEnKTtcbiAgICAgIH07XG5cbiAgICAgIHZhciByZXNpemVyVGltZW91dCA9IG51bGw7XG4gICAgICB2YXIgb25SZXNpemUgPSBmdW5jdGlvbihldnQpIHtcbiAgICAgICAgaWYgKGV2dC50YXJnZXQgPT09IHdpbmRvdykge1xuICAgICAgICAgIGNsZWFyVGltZW91dChyZXNpemVyVGltZW91dCk7XG4gICAgICAgICAgcmVzaXplclRpbWVvdXQgPSBzZXRUaW1lb3V0KHJlc2l6ZUZ1bmN0aW9uLCAxMDApOyAvLyBUT0RPIGlzIDEwMG1zIG9rYXk/XG4gICAgICAgIH1cbiAgICAgIH07XG5cbiAgICAgIHZhciBjb2xsZWN0aW9uTG9hZGVkID0gZnVuY3Rpb24ocmVzcG9uc2UpIHtcbiAgICAgICAgaWYgKHJlc3BvbnNlLmV4Y2VwdGlvbikge1xuICAgICAgICAgIGlmIChyZXNwb25zZS5leGNlcHRpb24gPT0gJ2Fubm90YXRpb25Db2xsZWN0aW9uTm90Rm91bmQnIHx8XG4gICAgICAgICAgICAgIHJlc3BvbnNlLmV4Y2VwdGlvbiA9PSAnY29sbGVjdGlvbk5vdEFjY2Vzc2libGUnKSB7XG4gICAgICAgICAgICAgIC8vIHJldmVydCB0byBsYXN0IGdvb2RcbiAgICAgICAgICAgIGRpc3BhdGNoZXIucG9zdCgnc2V0Q29sbGVjdGlvbicsIFtsYXN0R29vZENvbGxlY3Rpb25dKTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICBkaXNwYXRjaGVyLnBvc3QoJ21lc3NhZ2VzJywgW1tbJ1Vua25vd24gZXJyb3I6ICcgKyByZXNwb25zZS5leGNlcHRpb24sICdlcnJvciddXV0pO1xuICAgICAgICAgICAgICBkaXNwYXRjaGVyLnBvc3QoJ3NldENvbGxlY3Rpb24nLCBbJy8nXSk7XG4gICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGxhc3RHb29kQ29sbGVjdGlvbiA9IHJlc3BvbnNlLmNvbGxlY3Rpb247XG4gICAgICAgICAgZmlsbERpc2FtYmlndWF0b3JPcHRpb25zKHJlc3BvbnNlLmRpc2FtYmlndWF0b3JfY29uZmlnKTtcbiAgICAgICAgICBzZWxlY3RvckRhdGEgPSByZXNwb25zZTtcbiAgICAgICAgICBkb2N1bWVudExpc3RpbmcgPSByZXNwb25zZTsgLy8gJ2JhY2t1cCdcbiAgICAgICAgICBzZWFyY2hDb25maWcgPSByZXNwb25zZS5zZWFyY2hfY29uZmlnO1xuICAgICAgICAgIHNlbGVjdG9yRGF0YS5pdGVtcy5zb3J0KGRvY1NvcnRGdW5jdGlvbik7XG4gICAgICAgICAgc2V0dXBTZWFyY2hUeXBlcyhyZXNwb25zZSk7XG4gICAgICAgICAgLy8gc2Nyb2xsZXIgYXQgdGhlIHRvcFxuICAgICAgICAgIGRvY1Njcm9sbCA9IDA7XG4gICAgICAgIH1cbiAgICAgIH07XG5cbiAgICAgIHZhciBzZWFyY2hSZXN1bHRzUmVjZWl2ZWQgPSBmdW5jdGlvbihyZXNwb25zZSkge1xuICAgICAgICBpZiAocmVzcG9uc2UuZXhjZXB0aW9uKSB7XG4gICAgICAgICAgICA7IC8vIFRPRE86IHJlYXNvbmFibGUgcmVhY3Rpb25cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBzZWxlY3RvckRhdGEgPSByZXNwb25zZTtcbiAgICAgICAgICBzb3J0T3JkZXIgPSBbMiwgMV07IC8vIHJlc2V0XG4gICAgICAgICAgLy8gTk9URTogZG9uJ3Qgc29ydCwgYWxsb3dpbmcgb3JkZXIgaW4gd2hpY2hcbiAgICAgICAgICAvLyByZXNwb25zZXMgYXJlIGdpdmVuIHRvIGJlIHVzZWQgYXMgZGVmYXVsdFxuICAgICAgICAgIC8vc2VsZWN0b3JEYXRhLml0ZW1zLnNvcnQoZG9jU29ydEZ1bmN0aW9uKTtcbiAgICAgICAgICBpZiAocmVzcG9uc2UuYWN0aW9uLm1hdGNoKC9Db2xsZWN0aW9uJC8pKSB7XG4gICAgICAgICAgICBzaG93RmlsZUJyb3dzZXIoKTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdmFyIGl0ZW0gPSByZXNwb25zZS5pdGVtc1swXTtcbiAgICAgICAgICAgIGRpc3BhdGNoZXIucG9zdCgnc2V0RG9jdW1lbnQnLCBbaXRlbVsyXSwgaXRlbVsxXV0pO1xuICAgICAgICAgIH1cbiAgICAgICAgICAkKCcjc2F2ZV9zZWFyY2gnKS5jc3MoJ2Rpc3BsYXknLCAnaW5saW5lLWJsb2NrJyk7XG4gICAgICAgIH1cbiAgICAgIH07XG5cbiAgICAgIHZhciBjbGVhclNlYXJjaCA9IGZ1bmN0aW9uKGRvbnRTaG93RmlsZUJyb3dzZXIpIHtcbiAgICAgICAgZGlzcGF0Y2hlci5wb3N0KCdoaWRlRm9ybScpO1xuXG4gICAgICAgIC8vIGJhY2sgb2ZmIHRvIGRvY3VtZW50IGNvbGxlY3Rpb25cbiAgICAgICAgaWYgKHNlYXJjaEFjdGl2ZSkge1xuICAgICAgICAgICQoJyNzYXZlX3NlYXJjaCcpLmNzcygnZGlzcGxheScsICdub25lJyk7XG4gICAgICAgICAgc2VsZWN0b3JEYXRhID0gZG9jdW1lbnRMaXN0aW5nO1xuICAgICAgICAgIHNvcnRPcmRlciA9IGNvbGxlY3Rpb25Tb3J0T3JkZXI7XG4gICAgICAgICAgc2VsZWN0b3JEYXRhLml0ZW1zLnNvcnQoZG9jU29ydEZ1bmN0aW9uKTtcbiAgICAgICAgICBzZWFyY2hBY3RpdmUgPSBmYWxzZTtcbiAgICAgICAgICB1cGRhdGVTZWFyY2hCdXR0b25zKCk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoIWRvbnRTaG93RmlsZUJyb3dzZXIpIHtcbiAgICAgICAgICBzaG93RmlsZUJyb3dzZXIoKTtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICB2YXIgc2F2ZVNWR1RpbWVyID0gbnVsbDtcbiAgICAgIHZhciBzYXZlU1ZHID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIGlmIChjdXJyZW50RG9jdW1lbnRTVkdzYXZlZCkge1xuICAgICAgICAgIC8vIG5vIG5lZWQgdG8gc3RvcmUgYWdhaW5cbiAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgY2xlYXJUaW1lb3V0KHNhdmVTVkdUaW1lcik7XG4gICAgICAgICQoJyNzdG9yZWRfZmlsZV9yZWdlbmVyYXRlJykuaGlkZSgpO1xuICAgICAgICAkKCcjc3RvcmVkX2ZpbGVfc3Bpbm5lcicpLnNob3coKVxuICAgICAgICBzYXZlU1ZHVGltZXIgPSBkaXNwYXRjaGVyLnBvc3QoMSwgJ2FqYXgnLCBbe1xuICAgICAgICAgIGFjdGlvbjogJ3N0b3JlU1ZHJyxcbiAgICAgICAgICBzdmc6ICQoJyNzdmcnKS5odG1sKCksXG4gICAgICAgICAgY29sbGVjdGlvbjogY29sbCxcbiAgICAgICAgICBkb2N1bWVudDogZG9jXG4gICAgICAgIH0sICdzYXZlZFNWRyddKTtcbiAgICAgIH07XG5cbiAgICAgIHZhciBvbkRvbmVSZW5kZXJpbmcgPSBmdW5jdGlvbihjb2xsLCBkb2MsIGFyZ3MpIHtcbiAgICAgICAgaWYgKGFyZ3MgJiYgIWFyZ3MuZWRpdGVkKSB7XG4gICAgICAgICAgdmFyIHN2Z3RvcCA9ICQoJ3N2ZycpLm9mZnNldCgpLnRvcDtcbiAgICAgICAgICB2YXIgJGluRm9jdXMgPSAkKCcjc3ZnIGFuaW1hdGVbZGF0YS10eXBlPVwiZm9jdXNcIl06Zmlyc3QnKS5wYXJlbnQoKTtcbiAgICAgICAgICBpZiAoJGluRm9jdXMubGVuZ3RoKSB7XG4gICAgICAgICAgICAkKCdodG1sLGJvZHknKS5cbiAgICAgICAgICAgICAgICBhbmltYXRlKHsgc2Nyb2xsVG9wOiAkaW5Gb2N1cy5vZmZzZXQoKS50b3AgLSBzdmd0b3AgLSB3aW5kb3cuaW5uZXJIZWlnaHQgLyAyIH0sIHsgZHVyYXRpb246ICdzbG93JywgZWFzaW5nOiAnc3dpbmcnfSk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGRpc3BhdGNoZXIucG9zdCgnYWxsb3dSZWxvYWRCeVVSTCcpO1xuICAgICAgICBpZiAoIWN1cnJlbnRGb3JtKSB7XG4gICAgICAgICAgJCgnI3dhaXRlcicpLmRpYWxvZygnY2xvc2UnKTtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICB2YXIgb25TdGFydGVkUmVuZGVyaW5nID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIGhpZGVGb3JtKCk7XG4gICAgICAgIGlmICghY3VycmVudEZvcm0pIHtcbiAgICAgICAgICAkKCcjd2FpdGVyJykuZGlhbG9nKCdvcGVuJyk7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgdmFyIHNhdmVkU1ZHcmVjZWl2ZWQgPSBmdW5jdGlvbihyZXNwb25zZSkge1xuICAgICAgICAkKCcjc3RvcmVkX2ZpbGVfc3Bpbm5lcicpLmhpZGUoKVxuXG4gICAgICAgIGlmIChyZXNwb25zZSAmJiByZXNwb25zZS5leGNlcHRpb24gPT0gJ2NvcnJ1cHRTVkcnKSB7XG4gICAgICAgICAgZGlzcGF0Y2hlci5wb3N0KCdtZXNzYWdlcycsIFtbWydDYW5ub3Qgc2F2ZSBTVkc6IGNvcnJ1cHQnLCAnZXJyb3InXV1dKTtcbiAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgdmFyICRkb3dubG9hZFN0b3JlZCA9ICQoJyNkb3dubG9hZF9zdG9yZWQnKS5lbXB0eSgpLnNob3coKTtcbiAgICAgICAgJC5lYWNoKHJlc3BvbnNlLnN0b3JlZCwgZnVuY3Rpb24oc3RvcmVkTm8sIHN0b3JlZCkge1xuICAgICAgICAgIHZhciBwYXJhbXMgPSB7XG4gICAgICAgICAgICAnYWN0aW9uJzogJ3JldHJpZXZlU3RvcmVkJyxcbiAgICAgICAgICAgICdkb2N1bWVudCc6IGRvYyxcbiAgICAgICAgICAgICdzdWZmaXgnOiBzdG9yZWQuc3VmZml4LFxuICAgICAgICAgICAgLy8gVE9ETzogRXh0cmFjdCB0aGUgcHJvdG9jb2wgdmVyc2lvbiBpbnRvIHNvbWV3aGVyZSBnbG9iYWxcbiAgICAgICAgICAgICdwcm90b2NvbCc6IDFcbiAgICAgICAgICB9O1xuICAgICAgICAgIHZhciAkZG93bmxvYWRMaW5rID0gJCgnPGEgaWQ9XCJkb3dubG9hZF8nK3N0b3JlZC5uYW1lKydcIicgK1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnIHRhcmdldD1cIicrc3RvcmVkLm5hbWUrJ1wiJyArXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICc+JytzdG9yZWQubmFtZSsnPC9hPicpO1xuICAgICAgICAgICRkb3dubG9hZExpbmsuYXR0cignaHJlZicsICdhamF4LmNnaT8nICsgJC5wYXJhbShwYXJhbXMpKTtcbiAgICAgICAgICAkZG93bmxvYWRMaW5rLmJ1dHRvbigpO1xuICAgICAgICAgIGlmIChzdG9yZWRObykgJGRvd25sb2FkU3RvcmVkLmFwcGVuZCgnICcpO1xuICAgICAgICAgICRkb3dubG9hZFN0b3JlZC5hcHBlbmQoJGRvd25sb2FkTGluayk7XG4gICAgICAgIH0pO1xuICAgICAgICBjdXJyZW50RG9jdW1lbnRTVkdzYXZlZCA9IHRydWU7XG4gICAgICB9O1xuXG4gICAgICB2YXIgaW52YWxpZGF0ZVNhdmVkU1ZHID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIC8vIGFzc3VtaW5nIHRoYXQgaW52YWxpZGF0aW9uIG9mIHRoZSBTVkcgaW52YWxpZGF0ZXMgYWxsIHN0b3JlZFxuICAgICAgICAvLyBzdGF0aWMgdmlzdWFsaXphdGlvbnMsIGFzIG90aGVycyBhcmUgZGVyaXZlZCBmcm9tIHRoZSBTVkdcbiAgICAgICAgJCgnI2Rvd25sb2FkX3N0b3JlZCcpLmhpZGUoKTtcbiAgICAgICAgLy8gaGF2ZSBhIHdheSB0byByZWdlbmVyYXRlIGlmIGRpYWxvZyBvcGVuIHdoZW4gZGF0YSBpbnZhbGlkYXRlZFxuICAgICAgICAkKCcjc3RvcmVkX2ZpbGVfcmVnZW5lcmF0ZScpLnNob3coKTtcbiAgICAgICAgY3VycmVudERvY3VtZW50U1ZHc2F2ZWQgPSBmYWxzZTtcbiAgICAgIH07XG5cbiAgICAgIHZhciBvbk5ld1NvdXJjZURhdGEgPSBmdW5jdGlvbihzb3VyY2VEYXRhKSB7XG4gICAgICAgIGlmICghc291cmNlRGF0YSkgcmV0dXJuO1xuICAgICAgICB2YXIgJHNvdXJjZUZpbGVzID0gJCgnI3NvdXJjZV9maWxlcycpLmVtcHR5KCk7XG4gICAgICAgIC8qIEFkZCBkb3dubG9hZCBsaW5rcyBmb3IgYWxsIGF2YWlsYWJsZSBleHRlbnNpb25zICovXG4gICAgICAgICQuZWFjaChzb3VyY2VEYXRhLnNvdXJjZV9maWxlcywgZnVuY3Rpb24oZXh0Tm8sIGV4dCkge1xuICAgICAgICAgIHZhciAkbGluayA9ICQoJzxhIHRhcmdldD1cImJyYXRfc2VhcmNoXCIvPicpLlxuICAgICAgICAgICAgICB0ZXh0KGV4dCkuXG4gICAgICAgICAgICAgIGF0dHIoJ2hyZWYnLFxuICAgICAgICAgICAgICAgICAgJ2FqYXguY2dpP2FjdGlvbj1kb3dubG9hZEZpbGUmY29sbGVjdGlvbj0nICsgZW5jb2RlVVJJQ29tcG9uZW50KGNvbGwpICtcbiAgICAgICAgICAgICAgICAgICcmZG9jdW1lbnQ9JyArIGVuY29kZVVSSUNvbXBvbmVudChkb2MpICsgJyZleHRlbnNpb249JyArIGVuY29kZVVSSUNvbXBvbmVudChleHQpICtcbiAgICAgICAgICAgICAgICAgIC8vIFRPRE86IEV4dHJhY3QgdGhlIHByb3RvY29sIHZlcnNpb24gaW50byBzb21ld2hlcmUgZ2xvYmFsXG4gICAgICAgICAgICAgICAgICAnJnByb3RvY29sPScgKyAxKTtcbiAgICAgICAgICAkbGluay5idXR0b24oKTtcbiAgICAgICAgICBpZiAoZXh0Tm8pICRzb3VyY2VGaWxlcy5hcHBlbmQoJyAnKTtcbiAgICAgICAgICAkc291cmNlRmlsZXMuYXBwZW5kKCRsaW5rKTtcbiAgICAgICAgfSk7XG4gICAgICAgIC8qIEFkZCBhIGRvd25sb2FkIGxpbmsgZm9yIHRoZSB3aG9sZSBjb2xsZWN0aW9uICovXG4gICAgICAgIGludmFsaWRhdGVTYXZlZFNWRygpO1xuXG4gICAgICAgIG10aW1lID0gc291cmNlRGF0YS5tdGltZTtcbiAgICAgICAgaWYgKG10aW1lKSB7XG4gICAgICAgICAgLy8gd2UncmUgZ2V0dGluZyBzZWNvbmRzIGFuZCBuZWVkIG1pbGxpc2Vjb25kc1xuICAgICAgICAgIC8vJCgnI2RvY3VtZW50X2N0aW1lJykudGV4dChcIkNyZWF0ZWQ6IFwiICsgQW5ub3RhdG9yLmZvcm1hdFRpbWUoMTAwMCAqIHNvdXJjZURhdGEuY3RpbWUpKS5jc3MoXCJkaXNwbGF5XCIsIFwiaW5saW5lXCIpO1xuICAgICAgICAgICQoJyNkb2N1bWVudF9tdGltZScpLnRleHQoXCJMYXN0IG1vZGlmaWVkOiBcIiArIFV0aWwuZm9ybWF0VGltZUFnbygxMDAwICogbXRpbWUpKS5zaG93KCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgLy8kKCcjZG9jdW1lbnRfY3RpbWUnKS5jc3MoXCJkaXNwbGF5XCIsIFwibm9uZVwiKTtcbiAgICAgICAgICAkKCcjZG9jdW1lbnRfbXRpbWUnKS5oaWRlKCk7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgLy9CUkFUIFNUQU5EQUxPTkUgTElCUkFSWSBCRUdJTlxuICAgICAgLy9XZSBkbyBubyB1c2Ugbm90aW9uIG9mIGRvY3VtZW50c1xuICAgICAgLyoqL1xuICAgICAgdmFyIGdvdEN1cnJlbnQgPSBmdW5jdGlvbihfY29sbCwgX2RvYywgX2FyZ3MpIHtcbiAgICAgICAgdmFyIG9sZENvbGwgPSBjb2xsO1xuXG4gICAgICAgIGNvbGwgPSBfY29sbDtcbiAgICAgICAgZG9jID0gX2RvYztcbiAgICAgICAgYXJncyA9IF9hcmdzO1xuXG4gICAgICAgIC8vIGlmIHdlIGhhdmUgYSBzcGVjaWZpYyBkb2N1bWVudCwgaGlkZSB0aGUgXCJubyBkb2N1bWVudFwiIG1lc3NhZ2VcbiAgICAgICAgaWYgKF9kb2MpIHtcbiAgICAgICAgICBoaWRlTm9Eb2NNZXNzYWdlKCk7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBpZiB3ZSBoYXZlIGEgY29sbGVjdGlvbiBjaGFuZ2UsIHVwZGF0ZSBcImNvbGxlY3Rpb24gZG93bmxvYWRcIiBhbmRcbiAgICAgICAgLy8gXCJzaWRlLWJ5LXNpZGUgY29tcGFyaXNvblwiIGJ1dHRvbnNcbiAgICAgICAgaWYgKG9sZENvbGwgIT0gY29sbCkge1xuICAgICAgICAgIHZhciAkc291cmNlQ29sbGVjdGlvbiA9ICQoJyNzb3VyY2VfY29sbGVjdGlvbicpLmVtcHR5KCk7XG4gICAgICAgICAgdmFyICRjb2xsZWN0aW9uRG93bmxvYWRMaW5rID0gJCgnPGEgdGFyZ2V0PVwiYnJhdF9zZWFyY2hcIi8+JylcbiAgICAgICAgICAgIC50ZXh0KCdEb3dubG9hZCB0YXIuZ3onKVxuICAgICAgICAgICAgLmF0dHIoJ2hyZWYnLCAnYWpheC5jZ2k/YWN0aW9uPWRvd25sb2FkQ29sbGVjdGlvbiZjb2xsZWN0aW9uPScgKyBlbmNvZGVVUklDb21wb25lbnQoY29sbClcbiAgICAgICAgICAgIC8vIFRPRE86IEV4dHJhY3QgdGhlIHByb3RvY29sIHZlcnNpb24gaW50byBzb21ld2hlcmUgZ2xvYmFsXG4gICAgICAgICAgICArICcmcHJvdG9jb2w9JyArIDEpO1xuICAgICAgICAgICRzb3VyY2VDb2xsZWN0aW9uLmFwcGVuZCgkY29sbGVjdGlvbkRvd25sb2FkTGluayk7XG4gICAgICAgICAgJGNvbGxlY3Rpb25Eb3dubG9hZExpbmsuYnV0dG9uKCk7XG5cbiAgICAgICAgICAkY21wQnV0dG9uID0gJCgnI3NpZGUtYnktc2lkZV9jbXAnKS5lbXB0eSgpO1xuICAgICAgICAgIHZhciAkY21wTGluayA9ICQoJzxhIHRhcmdldD1cIl9ibGFua1wiLz4nKVxuICAgICAgICAgICAgLnRleHQoJ0NvbXBhcmlzb24gbW9kZScpXG4gICAgICAgICAgICAuYXR0cignaHJlZicsICdkaWZmLnhodG1sP2RpZmY9JyArIGVuY29kZVVSSUNvbXBvbmVudChjb2xsKSk7XG4gICAgICAgICAgJGNtcEJ1dHRvbi5hcHBlbmQoJGNtcExpbmspO1xuICAgICAgICAgICRjbXBMaW5rLmJ1dHRvbigpO1xuICAgICAgICB9XG5cbiAgICAgICAgLy9CUkFUIFNUQU5EQUxPTkUgTElCUkFSWSBCRUdJTlxuICAgICAgICAvKlxuICAgICAgICAkZG9jTmFtZSA9ICQoJyNkb2N1bWVudF9uYW1lIGlucHV0JykudmFsKGNvbGwgKyBkb2MpO1xuICAgICAgICB2YXIgZG9jTmFtZSA9ICRkb2NOYW1lWzBdO1xuICAgICAgICAvLyBUT0RPIGRvIHRoaXMgb24gcmVzaXplLCBhcyB3ZWxsXG4gICAgICAgIC8vIHNjcm9sbCB0aGUgZG9jdW1lbnQgbmFtZSB0byB0aGUgcmlnaHQsIHNvIHRoZSBuYW1lIGlzIHZpc2libGVcbiAgICAgICAgLy8gKGV2ZW4gaWYgdGhlIGNvbGxlY3Rpb24gbmFtZSBpc24ndCwgZnVsbHkpXG4gICAgICAgIGRvY05hbWUuc2Nyb2xsTGVmdCA9IGRvY05hbWUuc2Nyb2xsV2lkdGg7XG5cbiAgICAgICAgJCgnI2RvY3VtZW50X210aW1lJykuaGlkZSgpO1xuICAgICAgICAqL1xuICAgICAgICAvL0JSQVQgU1RBTkRBTE9ORSBMSUJSQVJZIEVORFxuICAgICAgICBpbnZhbGlkYXRlU2F2ZWRTVkcoKTtcbiAgICAgIH07XG4gICAgICAvKiovXG4gICAgICAvL0JSQVQgU1RBTkRBTE9ORSBMSUJSQVJZIEVORFxuXG4gICAgICB2YXIgc2xpZGVUb2dnbGUgPSBmdW5jdGlvbihlbCwgc2hvdywgYXV0b0hlaWdodCwgYm90dG9tKSB7XG4gICAgICAgIHZhciBlbCA9ICQoZWwpO1xuICAgICAgICB2YXIgdmlzaWJsZSA9IGVsLmlzKFwiOnZpc2libGVcIik7XG4gICAgICAgIHZhciBoZWlnaHQ7XG5cbiAgICAgICAgaWYgKHNob3cgPT09IHVuZGVmaW5lZCkgc2hvdyA9ICF2aXNpYmxlO1xuXG4gICAgICAgIC8vIEBhbWFkYW5tYXRoOiBjb21tZW50aW5nIHRoaXMgb3V0IGFwcGVhcnMgdG8gcmVtb3ZlIHRoZSBhbm5veWluZ1xuICAgICAgICAvLyBtaXNmZWF0dXJlIHdoZXJlIGl0J3MgcG9zc2libGUgdG8gc3RvcCB0aGUgbWVudSBoYWxmd2F5IGJ5XG4gICAgICAgIC8vIG1vdXNpbmcgb3V0IGFuZCBiYWNrIGluIGR1cmluZyBjbG9zaW5nLiBQbGVhc2UgY2hlY2sgdGhhdFxuICAgICAgICAvLyB0aGlzIGRvZXNuJ3QgaW50cm9kdWNlIG90aGVyIHRyb3VibGUgYW5kIHJlbW92ZSB0aGVzZSBsaW5lcy5cbi8vICAgICAgICAgaWYgKHNob3cgPT09IHZpc2libGUpIHJldHVybiBmYWxzZTtcblxuICAgICAgICBpZiAoIWF1dG9IZWlnaHQpIHtcbiAgICAgICAgICBoZWlnaHQgPSBlbC5kYXRhKFwiY2FjaGVkSGVpZ2h0XCIpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGVsLmhlaWdodCgnYXV0bycpO1xuICAgICAgICB9XG4gICAgICAgIGlmICghaGVpZ2h0KSB7XG4gICAgICAgICAgaGVpZ2h0ID0gZWwuc2hvdygpLmhlaWdodCgpO1xuICAgICAgICAgIGVsLmRhdGEoJ2NhY2hlZEhlaWdodCcsIGhlaWdodCk7XG4gICAgICAgICAgaWYgKCF2aXNpYmxlKSBlbC5oaWRlKCkuY3NzKHsgaGVpZ2h0OiAwIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHNob3cpIHtcbiAgICAgICAgICBlbC5zaG93KCkuYW5pbWF0ZSh7IGhlaWdodDogaGVpZ2h0IH0sIHtcbiAgICAgICAgICAgIGR1cmF0aW9uOiAxNTAsXG4gICAgICAgICAgICBjb21wbGV0ZTogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgIGlmIChhdXRvSGVpZ2h0KSB7XG4gICAgICAgICAgICAgICAgZWwuaGVpZ2h0KCdhdXRvJyk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBzdGVwOiBib3R0b20gPyBmdW5jdGlvbihub3csIGZ4KSB7XG4gICAgICAgICAgICAgIGZ4LmVsZW0uc2Nyb2xsVG9wID0gZnguZWxlbS5zY3JvbGxIZWlnaHQ7XG4gICAgICAgICAgICB9IDogdW5kZWZpbmVkXG4gICAgICAgICAgfSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgZWwuYW5pbWF0ZSh7IGhlaWdodDogMCB9LCB7XG4gICAgICAgICAgICBkdXJhdGlvbjogMzAwLFxuICAgICAgICAgICAgY29tcGxldGU6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICBlbC5oaWRlKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgdmFyIG1lbnVUaW1lciA9IG51bGw7XG4gICAgICAkKCcjaGVhZGVyJykuXG4gICAgICAgIG1vdXNlZW50ZXIoZnVuY3Rpb24oZXZ0KSB7XG4gICAgICAgICAgY2xlYXJUaW1lb3V0KG1lbnVUaW1lcik7XG4gICAgICAgICAgc2xpZGVUb2dnbGUoJCgnI3B1bGxkb3duJykuc3RvcCgpLCB0cnVlKTtcbiAgICAgICAgfSkuXG4gICAgICAgIG1vdXNlbGVhdmUoZnVuY3Rpb24oZXZ0KSB7XG4gICAgICAgICAgY2xlYXJUaW1lb3V0KG1lbnVUaW1lcik7XG4gICAgICAgICAgbWVudVRpbWVyID0gc2V0VGltZW91dChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHNsaWRlVG9nZ2xlKCQoJyNwdWxsZG93bicpLnN0b3AoKSwgZmFsc2UpO1xuICAgICAgICAgIH0sIDUwMCk7XG4gICAgICAgIH0pO1xuXG4gICAgICAkKCcjbGFiZWxfYWJicmV2aWF0aW9ucyBpbnB1dCcpLmNsaWNrKGZ1bmN0aW9uKGV2dCkge1xuICAgICAgICB2YXIgdmFsID0gdGhpcy52YWx1ZTtcbiAgICAgICAgdmFsID0gdmFsID09PSAnb24nO1xuICAgICAgICBpZiAodmFsKSB7XG4gICAgICAgICAgZGlzcGF0Y2hlci5wb3N0KCdtZXNzYWdlcycsIFtbWydBYmJyZXZpYXRpb25zIGFyZSBub3cgb24nLCAnY29tbWVudCddXV0pO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGRpc3BhdGNoZXIucG9zdCgnbWVzc2FnZXMnLCBbW1snQWJicmV2aWF0aW9ucyBhcmUgbm93IG9mZicsICdjb21tZW50J11dXSk7XG4gICAgICAgIH1cbiAgICAgICAgZGlzcGF0Y2hlci5wb3N0KCdhYmJyZXZzJywgW3ZhbF0pO1xuICAgICAgICAvLyBUT0RPOiBYWFg6IGZvciBzb21lIGluc2FuZSByZWFzb24sIGRvaW5nIHRoZSBmb2xsb3dpbmcgY2FsbFxuICAgICAgICAvLyBzeW5jaHJvbm91c2x5IGJyZWFrcyB0aGUgY2hlY2tib3ggKCM0NTYpLiBJZiB5b3UgZXZlciBmaWd1cmVcbiAgICAgICAgLy8gb3V0IHdoeSwgaXQgd291bGQgbWFrZSBtb3JlIHNlbnNlIHRvIGNhbGxcbiAgICAgICAgLy8gICAgZGlzcGF0Y2hlci5wb3N0KCdyZXNldERhdGEnKTtcbiAgICAgICAgLy8gd2l0aG91dCB0aGUgYXN5bmNoLlxuICAgICAgICBkaXNwYXRjaGVyLnBvc3QoMSwgJ3Jlc2V0RGF0YScpO1xuICAgICAgfSk7XG5cbiAgICAgICQoJyN0ZXh0X2JhY2tncm91bmRzIGlucHV0JykuY2xpY2soZnVuY3Rpb24oZXZ0KSB7XG4gICAgICAgIHZhciB2YWwgPSB0aGlzLnZhbHVlO1xuICAgICAgICBkaXNwYXRjaGVyLnBvc3QoJ3RleHRCYWNrZ3JvdW5kcycsIFt2YWxdKTtcbiAgICAgICAgLy8gVE9ETzogWFhYOiBzZWUgY29tbWVudCBhYm92ZSBmb3Igd2h5IHRoaXMgaXMgYXN5bmNocm9ub3VzXG4gICAgICAgIGRpc3BhdGNoZXIucG9zdCgxLCAncmVzZXREYXRhJyk7XG4gICAgICB9KTtcblxuICAgICAgJCgnI2xheW91dF9kZW5zaXR5IGlucHV0JykuY2xpY2soZnVuY3Rpb24oZXZ0KSB7XG4gICAgICAgIHZhciB2YWwgPSB0aGlzLnZhbHVlO1xuICAgICAgICBkaXNwYXRjaGVyLnBvc3QoJ2xheW91dERlbnNpdHknLCBbdmFsXSk7XG4gICAgICAgIC8vIFRPRE86IFhYWDogc2VlIGNvbW1lbnQgYWJvdmUgZm9yIHdoeSB0aGlzIGlzIGFzeW5jaHJvbm91c1xuICAgICAgICBkaXNwYXRjaGVyLnBvc3QoMSwgJ3Jlc2V0RGF0YScpO1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICB9KTtcblxuICAgICAgJCgnI3N2Z193aWR0aF91bml0IGlucHV0JykuY2xpY2soZnVuY3Rpb24oZXZ0KSB7XG4gICAgICAgIHZhciB3aWR0aF91bml0ID0gdGhpcy52YWx1ZTtcbiAgICAgICAgdmFyIHdpZHRoX3ZhbHVlID0gJCgnI3N2Z193aWR0aF92YWx1ZScpWzBdLnZhbHVlO1xuICAgICAgICB2YXIgdmFsID0gd2lkdGhfdmFsdWUrd2lkdGhfdW5pdDtcbiAgICAgICAgZGlzcGF0Y2hlci5wb3N0KCdzdmdXaWR0aCcsIFt2YWxdKTtcbiAgICAgICAgLy8gVE9ETzogWFhYOiBzZWUgY29tbWVudCBhYm92ZSBmb3Igd2h5IHRoaXMgaXMgYXN5bmNocm9ub3VzXG4gICAgICAgIGRpc3BhdGNoZXIucG9zdCgxLCAncmVzZXREYXRhJyk7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgIH0pO1xuXG4gICAgICAkKCcjYW5ub3RhdGlvbl9zcGVlZCBpbnB1dCcpLmNsaWNrKGZ1bmN0aW9uKGV2dCkge1xuICAgICAgICB2YXIgdmFsID0gdGhpcy52YWx1ZTtcbiAgICAgICAgZGlzcGF0Y2hlci5wb3N0KCdhbm5vdGF0aW9uU3BlZWQnLCBbdmFsXSk7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgIH0pOyAgICAgIFxuICAgIFxuICAgICAgJCgnI3B1bGxkb3duJykuZmluZCgnaW5wdXQnKS5idXR0b24oKTtcbiAgICAgIHZhciBoZWFkZXJIZWlnaHQgPSAkKCcjbWFpbkhlYWRlcicpLmhlaWdodCgpO1xuICAgICAgJCgnI3N2ZycpLmNzcygnbWFyZ2luLXRvcCcsIGhlYWRlckhlaWdodCArIDEwKTtcbiAgICAgIGFib3V0RGlhbG9nID0gJCgnI2Fib3V0Jyk7XG4gICAgICBhYm91dERpYWxvZy5kaWFsb2coe1xuICAgICAgICAgICAgYXV0b09wZW46IGZhbHNlLFxuICAgICAgICAgICAgY2xvc2VPbkVzY2FwZTogdHJ1ZSxcbiAgICAgICAgICAgIHJlc2l6YWJsZTogZmFsc2UsXG4gICAgICAgICAgICBtb2RhbDogdHJ1ZSxcbiAgICAgICAgICAgIG9wZW46IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIGFib3V0RGlhbG9nLmZpbmQoJyonKS5ibHVyKCk7XG4gICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBiZWZvcmVDbG9zZTogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgY3VycmVudEZvcm0gPSBudWxsO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgfSk7XG4gICAgICAkKCcjbWFpbmxvZ28nKS5jbGljayhmdW5jdGlvbigpIHtcbiAgICAgICAgc2hvd0Zvcm0oYWJvdXREaWFsb2cpO1xuICAgICAgfSk7XG5cbiAgICAgIC8vIFRPRE86IGNvcHkgZnJvbSBhbm5vdGF0b3JfdWk7IERSWSBpdCB1cFxuICAgICAgdmFyIGFkanVzdEZvcm1Ub0N1cnNvciA9IGZ1bmN0aW9uKGV2dCwgZWxlbWVudCkge1xuICAgICAgICB2YXIgc2NyZWVuSGVpZ2h0ID0gJCh3aW5kb3cpLmhlaWdodCgpIC0gODsgLy8gVE9ETyBIQUNLIC0gbm8gaWRlYSB3aHkgLTggaXMgbmVlZGVkXG4gICAgICAgIHZhciBzY3JlZW5XaWR0aCA9ICQod2luZG93KS53aWR0aCgpIC0gODtcbiAgICAgICAgdmFyIGVsZW1lbnRIZWlnaHQgPSBlbGVtZW50LmhlaWdodCgpO1xuICAgICAgICB2YXIgZWxlbWVudFdpZHRoID0gZWxlbWVudC53aWR0aCgpO1xuICAgICAgICB2YXIgeSA9IE1hdGgubWluKGV2dC5jbGllbnRZLCBzY3JlZW5IZWlnaHQgLSBlbGVtZW50SGVpZ2h0KTtcbiAgICAgICAgdmFyIHggPSBNYXRoLm1pbihldnQuY2xpZW50WCwgc2NyZWVuV2lkdGggLSBlbGVtZW50V2lkdGgpO1xuICAgICAgICBlbGVtZW50LmNzcyh7IHRvcDogeSwgbGVmdDogeCB9KTtcbiAgICAgIH07XG4gICAgICB2YXIgdmlld3NwYW5Gb3JtID0gJCgnI3ZpZXdzcGFuX2Zvcm0nKTtcblxuICAgICAgdmFyIG9uU2luZ2xlQ2xpY2sgPSBmdW5jdGlvbihldnQpIHtcbiAgICAgICAgdmFyIHRhcmdldCA9ICQoZXZ0LnRhcmdldCk7XG4gICAgICAgIHZhciBpZDtcbiAgICAgICAgaWYgKGlkID0gdGFyZ2V0LmF0dHIoJ2RhdGEtc3Bhbi1pZCcpKSB7XG4gICAgICAgICAgdmFyIHNwYW4gPSBkYXRhLnNwYW5zW2lkXTtcbiAgICAgICAgICBkaXNwYXRjaGVyLnBvc3QoJ3NnbGNsaWNrJywgW3NwYW5dKTtcbiAgICAgICAgfVxuICAgICAgfTtcblxuICAgICAgdmFyIG9uRGJsQ2xpY2sgPSBmdW5jdGlvbihldnQpIHtcbiAgICAgICAgaWYgKHVzZXIgJiYgYW5ub3RhdGlvbkF2YWlsYWJsZSkgcmV0dXJuO1xuICAgICAgICB2YXIgdGFyZ2V0ID0gJChldnQudGFyZ2V0KTtcbiAgICAgICAgdmFyIGlkO1xuICAgICAgICBpZiAoaWQgPSB0YXJnZXQuYXR0cignZGF0YS1zcGFuLWlkJykpIHtcbiAgICAgICAgICB3aW5kb3cuZ2V0U2VsZWN0aW9uKCkucmVtb3ZlQWxsUmFuZ2VzKCk7XG4gICAgICAgICAgdmFyIHNwYW4gPSBkYXRhLnNwYW5zW2lkXTtcblxuICAgICAgICAgIHZhciB1cmxIYXNoID0gVVJMSGFzaC5wYXJzZSh3aW5kb3cubG9jYXRpb24uaGFzaCk7XG4gICAgICAgICAgdXJsSGFzaC5zZXRBcmd1bWVudCgnZm9jdXMnLCBbW3NwYW4uaWRdXSk7XG4gICAgICAgICAgJCgnI3ZpZXdzcGFuX2hpZ2hsaWdodF9saW5rJykuc2hvdygpLmF0dHIoJ2hyZWYnLCB1cmxIYXNoLmdldEhhc2goKSk7XG5cbiAgICAgICAgICAkKCcjdmlld3NwYW5fc2VsZWN0ZWQnKS50ZXh0KHNwYW4udGV4dCk7XG4gICAgICAgICAgdmFyIGVuY29kZWRUZXh0ID0gZW5jb2RlVVJJQ29tcG9uZW50KHNwYW4udGV4dCk7XG4gICAgICAgICAgJC5lYWNoKHNlYXJjaENvbmZpZywgZnVuY3Rpb24oc2VhcmNoTm8sIHNlYXJjaCkge1xuICAgICAgICAgICAgJCgnI3ZpZXdzcGFuXycrc2VhcmNoWzBdKS5hdHRyKCdocmVmJywgc2VhcmNoWzFdLnJlcGxhY2UoJyVzJywgZW5jb2RlZFRleHQpKTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgICAvLyBhbm5vdGF0b3IgY29tbWVudHNcbiAgICAgICAgICAkKCcjdmlld3NwYW5fbm90ZXMnKS52YWwoc3Bhbi5hbm5vdGF0b3JOb3RlcyB8fCAnJyk7XG4gICAgICAgICAgZGlzcGF0Y2hlci5wb3N0KCdzaG93Rm9ybScsIFt2aWV3c3BhbkZvcm1dKTtcbiAgICAgICAgICAkKCcjdmlld3NwYW5fZm9ybS1vaycpLmZvY3VzKCk7XG4gICAgICAgICAgYWRqdXN0Rm9ybVRvQ3Vyc29yKGV2dCwgdmlld3NwYW5Gb3JtLnBhcmVudCgpKTtcbiAgICAgICAgfVxuICAgICAgfTtcbiAgICAgIHZpZXdzcGFuRm9ybS5zdWJtaXQoZnVuY3Rpb24oZXZ0KSB7XG4gICAgICAgIGRpc3BhdGNoZXIucG9zdCgnaGlkZUZvcm0nKTtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgfSk7XG5cbiAgICAgIHZhciBhdXRoRm9ybSA9ICQoJyNhdXRoX2Zvcm0nKTtcbiAgICAgIGluaXRGb3JtKGF1dGhGb3JtLCB7IHJlc2l6YWJsZTogZmFsc2UgfSk7XG4gICAgICB2YXIgYXV0aEZvcm1TdWJtaXQgPSBmdW5jdGlvbihldnQpIHtcbiAgICAgICAgZGlzcGF0Y2hlci5wb3N0KCdoaWRlRm9ybScpO1xuICAgICAgICB2YXIgX3VzZXIgPSAkKCcjYXV0aF91c2VyJykudmFsKCk7XG4gICAgICAgIHZhciBwYXNzd29yZCA9ICQoJyNhdXRoX3Bhc3MnKS52YWwoKTtcbiAgICAgICAgZGlzcGF0Y2hlci5wb3N0KCdhamF4JywgW3tcbiAgICAgICAgICAgIGFjdGlvbjogJ2xvZ2luJyxcbiAgICAgICAgICAgIHVzZXI6IF91c2VyLFxuICAgICAgICAgICAgcGFzc3dvcmQ6IHBhc3N3b3JkLFxuICAgICAgICAgIH0sXG4gICAgICAgICAgZnVuY3Rpb24ocmVzcG9uc2UpIHtcbiAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLmV4Y2VwdGlvbikge1xuICAgICAgICAgICAgICAgIGRpc3BhdGNoZXIucG9zdCgnc2hvd0Zvcm0nLCBbYXV0aEZvcm1dKTtcbiAgICAgICAgICAgICAgICAkKCcjYXV0aF91c2VyJykuc2VsZWN0KCkuZm9jdXMoKTtcbiAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB1c2VyID0gX3VzZXI7XG4gICAgICAgICAgICAgICAgJCgnI2F1dGhfYnV0dG9uJykudmFsKCdMb2dvdXQgJyArIHVzZXIpO1xuICAgICAgICAgICAgICAgICQoJyNhdXRoX3VzZXInKS52YWwoJycpO1xuICAgICAgICAgICAgICAgICQoJyNhdXRoX3Bhc3MnKS52YWwoJycpO1xuICAgICAgICAgICAgICAgICQoJy5sb2dpbicpLnNob3coKTtcbiAgICAgICAgICAgICAgICBkaXNwYXRjaGVyLnBvc3QoJ3VzZXInLCBbdXNlcl0pO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgfV0pO1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICB9O1xuICAgICAgJCgnI2F1dGhfYnV0dG9uJykuY2xpY2soZnVuY3Rpb24oZXZ0KSB7XG4gICAgICAgIGlmICh1c2VyKSB7XG4gICAgICAgICAgZGlzcGF0Y2hlci5wb3N0KCdhamF4JywgW3tcbiAgICAgICAgICAgIGFjdGlvbjogJ2xvZ291dCdcbiAgICAgICAgICB9LCBmdW5jdGlvbihyZXNwb25zZSkge1xuICAgICAgICAgICAgdXNlciA9IG51bGw7XG4gICAgICAgICAgICAkKCcjYXV0aF9idXR0b24nKS52YWwoJ0xvZ2luJyk7XG4gICAgICAgICAgICAkKCcubG9naW4nKS5oaWRlKCk7XG4gICAgICAgICAgICBkaXNwYXRjaGVyLnBvc3QoJ3VzZXInLCBbbnVsbF0pO1xuICAgICAgICAgIH1dKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBkaXNwYXRjaGVyLnBvc3QoJ3Nob3dGb3JtJywgW2F1dGhGb3JtXSk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgICAgYXV0aEZvcm0uc3VibWl0KGF1dGhGb3JtU3VibWl0KTtcblxuXG4gICAgICB2YXIgdHV0b3JpYWxGb3JtID0gJCgnI3R1dG9yaWFsJyk7XG4gICAgICBpZiAoISQuYnJvd3Nlci53ZWJraXQpIHtcbiAgICAgICAgLy8gSW5qZWN0IHRoZSBicm93c2VyIHdhcm5pbmdcbiAgICAgICAgJCgnI2Jyb3dzZXJ3YXJuaW5nJykuY3NzKCdkaXNwbGF5JywgJ2Jsb2NrJyk7XG4gICAgICB9XG4gICAgICBpbml0Rm9ybSh0dXRvcmlhbEZvcm0sIHtcbiAgICAgICAgd2lkdGg6IDgwMCxcbiAgICAgICAgaGVpZ2h0OiA2MDAsXG4gICAgICAgIG5vX2NhbmNlbDogdHJ1ZSxcbiAgICAgICAgbm9fb2s6IHRydWUsXG4gICAgICAgIGJ1dHRvbnM6IFt7XG4gICAgICAgICAgaWQ6IFwidHV0b3JpYWwtb2tcIixcbiAgICAgICAgICB0ZXh0OiBcIk9LXCIsXG4gICAgICAgICAgY2xpY2s6IGZ1bmN0aW9uKCkgeyB0dXRvcmlhbEZvcm0uZGlhbG9nKCdjbG9zZScpOyB9XG4gICAgICAgIH1dLFxuICAgICAgICBjbG9zZTogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgaWYgKGZpbGVCcm93c2VyV2FpdGluZykge1xuICAgICAgICAgICAgc2hvd0ZpbGVCcm93c2VyKCk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9KTtcblxuICAgICAgdmFyIGluaXQgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgZGlzcGF0Y2hlci5wb3N0KCdpbml0Rm9ybScsIFt2aWV3c3BhbkZvcm0sIHtcbiAgICAgICAgICAgIHdpZHRoOiA3NjAsXG4gICAgICAgICAgICBub19jYW5jZWw6IHRydWVcbiAgICAgICAgICB9XSk7XG4gICAgICAgIGRpc3BhdGNoZXIucG9zdCgnYWpheCcsIFt7XG4gICAgICAgICAgICBhY3Rpb246ICd3aG9hbWknXG4gICAgICAgICAgfSwgZnVuY3Rpb24ocmVzcG9uc2UpIHtcbiAgICAgICAgICAgIHZhciBhdXRoX2J1dHRvbiA9ICQoJyNhdXRoX2J1dHRvbicpO1xuICAgICAgICAgICAgaWYgKHJlc3BvbnNlLnVzZXIpIHtcbiAgICAgICAgICAgICAgdXNlciA9IHJlc3BvbnNlLnVzZXI7XG4gICAgICAgICAgICAgIGRpc3BhdGNoZXIucG9zdCgnbWVzc2FnZXMnLCBbW1snV2VsY29tZSBiYWNrLCB1c2VyIFwiJyArIHVzZXIgKyAnXCInLCAnY29tbWVudCddXV0pO1xuICAgICAgICAgICAgICBhdXRoX2J1dHRvbi52YWwoJ0xvZ291dCAnICsgdXNlcik7XG4gICAgICAgICAgICAgIGRpc3BhdGNoZXIucG9zdCgndXNlcicsIFt1c2VyXSk7XG4gICAgICAgICAgICAgICQoJy5sb2dpbicpLnNob3coKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgIHVzZXIgPSBudWxsO1xuICAgICAgICAgICAgICBhdXRoX2J1dHRvbi52YWwoJ0xvZ2luJyk7XG4gICAgICAgICAgICAgIGRpc3BhdGNoZXIucG9zdCgndXNlcicsIFtudWxsXSk7XG4gICAgICAgICAgICAgICQoJy5sb2dpbicpLmhpZGUoKTtcbiAgICAgICAgICAgICAgLy8gZG9uJ3Qgc2hvdyB0dXRvcmlhbCBpZiB0aGVyZSdzIGEgc3BlY2lmaWMgZG9jdW1lbnQgKGFubm95YW5jZSlcbiAgICAgICAgICAgICAgaWYgKCFkb2MpIHtcbiAgICAgICAgICAgICAgICBkaXNwYXRjaGVyLnBvc3QoJ3Nob3dGb3JtJywgW3R1dG9yaWFsRm9ybV0pO1xuICAgICAgICAgICAgICAgICQoJyN0dXRvcmlhbC1vaycpLmZvY3VzKCk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9LFxuICAgICAgICAgIHsga2VlcDogdHJ1ZSB9XG4gICAgICAgIF0pO1xuICAgICAgICBkaXNwYXRjaGVyLnBvc3QoJ2FqYXgnLCBbeyBhY3Rpb246ICdsb2FkQ29uZicgfSwgZnVuY3Rpb24ocmVzcG9uc2UpIHtcbiAgICAgICAgICBpZiAocmVzcG9uc2UuY29uZmlnICE9IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgLy8gVE9ETzogY2hlY2sgZm9yIGV4Y2VwdGlvbnNcbiAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgIENvbmZpZ3VyYXRpb24gPSBKU09OLnBhcnNlKHJlc3BvbnNlLmNvbmZpZyk7XG4gICAgICAgICAgICB9IGNhdGNoKHgpIHtcbiAgICAgICAgICAgICAgLy8gWFhYIEJhZCBjb25maWdcbiAgICAgICAgICAgICAgQ29uZmlndXJhdGlvbiA9IHt9O1xuICAgICAgICAgICAgICBkaXNwYXRjaGVyLnBvc3QoJ21lc3NhZ2VzJywgW1tbJ0NvcnJ1cHRlZCBjb25maWd1cmF0aW9uOyByZXNldHRpbmcuJywgJ2Vycm9yJ11dXSk7XG4gICAgICAgICAgICAgIGNvbmZpZ3VyYXRpb25DaGFuZ2VkKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvLyBUT0RPOiBtYWtlIHdob2xlLW9iamVjdCBhc3NpZ25tZW50IHdvcmtcbiAgICAgICAgICAgIC8vIEBhbWFkYW5tYXRoOiBoZWxwISBUaGlzIGNvZGUgaXMgaG9ycmlibGVcbiAgICAgICAgICAgIC8vIENvbmZpZ3VyYXRpb24uc3ZnV2lkdGggPSBzdG9yZWRDb25mLnN2Z1dpZHRoO1xuICAgICAgICAgICAgZGlzcGF0Y2hlci5wb3N0KCdzdmdXaWR0aCcsIFtDb25maWd1cmF0aW9uLnN2Z1dpZHRoXSk7XG4gICAgICAgICAgICAvLyBDb25maWd1cmF0aW9uLmFiYnJldnNPbiA9IHN0b3JlZENvbmYuYWJicmV2c09uID09IFwidHJ1ZVwiO1xuICAgICAgICAgICAgLy8gQ29uZmlndXJhdGlvbi50ZXh0QmFja2dyb3VuZHMgPSBzdG9yZWRDb25mLnRleHRCYWNrZ3JvdW5kcztcbiAgICAgICAgICAgIC8vIENvbmZpZ3VyYXRpb24ucmFwaWRNb2RlT24gPSBzdG9yZWRDb25mLnJhcGlkTW9kZU9uID09IFwidHJ1ZVwiO1xuICAgICAgICAgICAgLy8gQ29uZmlndXJhdGlvbi5jb25maXJtTW9kZU9uID0gc3RvcmVkQ29uZi5jb25maXJtTW9kZU9uID09IFwidHJ1ZVwiO1xuICAgICAgICAgICAgLy8gQ29uZmlndXJhdGlvbi5hdXRvcmVmcmVzaE9uID0gc3RvcmVkQ29uZi5hdXRvcmVmcmVzaE9uID09IFwidHJ1ZVwiO1xuICAgICAgICAgICAgaWYgKENvbmZpZ3VyYXRpb24uYXV0b3JlZnJlc2hPbikge1xuICAgICAgICAgICAgICBjaGVja0ZvckRvY3VtZW50Q2hhbmdlcygpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLy8gQ29uZmlndXJhdGlvbi52aXN1YWwubWFyZ2luLnggPSBwYXJzZUludChzdG9yZWRDb25mLnZpc3VhbC5tYXJnaW4ueCk7XG4gICAgICAgICAgICAvLyBDb25maWd1cmF0aW9uLnZpc3VhbC5tYXJnaW4ueSA9IHBhcnNlSW50KHN0b3JlZENvbmYudmlzdWFsLm1hcmdpbi55KTtcbiAgICAgICAgICAgIC8vIENvbmZpZ3VyYXRpb24udmlzdWFsLmJveFNwYWNpbmcgPSBwYXJzZUludChzdG9yZWRDb25mLnZpc3VhbC5ib3hTcGFjaW5nKTtcbiAgICAgICAgICAgIC8vIENvbmZpZ3VyYXRpb24udmlzdWFsLmN1cmx5SGVpZ2h0ID0gcGFyc2VJbnQoc3RvcmVkQ29uZi52aXN1YWwuY3VybHlIZWlnaHQpO1xuICAgICAgICAgICAgLy8gQ29uZmlndXJhdGlvbi52aXN1YWwuYXJjU3BhY2luZyA9IHBhcnNlSW50KHN0b3JlZENvbmYudmlzdWFsLmFyY1NwYWNpbmcpO1xuICAgICAgICAgICAgLy8gQ29uZmlndXJhdGlvbi52aXN1YWwuYXJjU3RhcnRIZWlnaHQgPSBwYXJzZUludChzdG9yZWRDb25mLnZpc3VhbC5hcmNTdGFydEhlaWdodCk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGRpc3BhdGNoZXIucG9zdCgnY29uZmlndXJhdGlvblVwZGF0ZWQnKTtcbiAgICAgICAgfV0pO1xuICAgICAgfTtcblxuICAgICAgdmFyIG5vRmlsZVNwZWNpZmllZCA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAvLyBub3QgKG9ubHkpIGFuIGVycm9yLCBzbyBubyBtZXNzYWdpbmdcbiAgICAgICAgZGlzcGF0Y2hlci5wb3N0KCdjbGVhclNWRycpO1xuICAgICAgICBzaG93RmlsZUJyb3dzZXIoKTtcbiAgICAgIH1cblxuICAgICAgdmFyIHNob3dVbmFibGVUb1JlYWRUZXh0RmlsZSA9IGZ1bmN0aW9uKCkge1xuICAgICAgICBkaXNwYXRjaGVyLnBvc3QoJ21lc3NhZ2VzJywgW1tbJ1VuYWJsZSB0byByZWFkIHRoZSB0ZXh0IGZpbGUuJywgJ2Vycm9yJ11dXSk7XG4gICAgICAgIGRpc3BhdGNoZXIucG9zdCgnY2xlYXJTVkcnKTtcbiAgICAgICAgc2hvd0ZpbGVCcm93c2VyKCk7XG4gICAgICB9O1xuXG4gICAgICB2YXIgc2hvd0Fubm90YXRpb25GaWxlTm90Rm91bmQgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgZGlzcGF0Y2hlci5wb3N0KCdtZXNzYWdlcycsIFtbWydBbm5vdGF0aW9uIGZpbGUgbm90IGZvdW5kLicsICdlcnJvciddXV0pO1xuICAgICAgICBkaXNwYXRjaGVyLnBvc3QoJ2NsZWFyU1ZHJyk7XG4gICAgICAgIHNob3dGaWxlQnJvd3NlcigpO1xuICAgICAgfTtcblxuICAgICAgdmFyIHNob3dVbmtub3duRXJyb3IgPSBmdW5jdGlvbihleGNlcHRpb24pIHtcbiAgICAgICAgZGlzcGF0Y2hlci5wb3N0KCdtZXNzYWdlcycsIFtbWydVbmtub3duIGVycm9yOiAnICsgZXhjZXB0aW9uLCAnZXJyb3InXV1dKTtcbiAgICAgICAgZGlzcGF0Y2hlci5wb3N0KCdjbGVhclNWRycpO1xuICAgICAgICBzaG93RmlsZUJyb3dzZXIoKTtcbiAgICAgIH07XG5cbiAgICAgIHZhciByZWxvYWREaXJlY3RvcnlXaXRoU2xhc2ggPSBmdW5jdGlvbihzb3VyY2VEYXRhKSB7XG4gICAgICAgIHZhciBjb2xsZWN0aW9uID0gc291cmNlRGF0YS5jb2xsZWN0aW9uICsgc291cmNlRGF0YS5kb2N1bWVudCArICcvJztcbiAgICAgICAgZGlzcGF0Y2hlci5wb3N0KCdzZXRDb2xsZWN0aW9uJywgW2NvbGxlY3Rpb24sICcnLCBzb3VyY2VEYXRhLmFyZ3VtZW50c10pO1xuICAgICAgfTtcblxuICAgICAgLy8gVE9ETzogY29uZmlybSBhdHRyaWJ1dGVUeXBlcyB1bm5lY2Vzc2FyeSBhbmQgcmVtb3ZlXG4vLyAgICAgICB2YXIgc3BhbkFuZEF0dHJpYnV0ZVR5cGVzTG9hZGVkID0gZnVuY3Rpb24oX3NwYW5UeXBlcywgX2F0dHJpYnV0ZVR5cGVzKSB7XG4vLyAgICAgICAgIHNwYW5UeXBlcyA9IF9zcGFuVHlwZXM7XG4vLyAgICAgICAgIGF0dHJpYnV0ZVR5cGVzID0gX2F0dHJpYnV0ZVR5cGVzO1xuLy8gICAgICAgfTtcbiAgICAgIC8vIFRPRE86IHNwYW5BbmRBdHRyaWJ1dGVUeXBlc0xvYWRlZCBpcyBvYnZpb3VzbHkgbm90IGRlc2NyaXB0aXZlIG9mXG4gICAgICAvLyB0aGUgZnVsbCBmdW5jdGlvbi4gUmVuYW1lIHJlYXNvbmFibHkuXG4gICAgICB2YXIgc3BhbkFuZEF0dHJpYnV0ZVR5cGVzTG9hZGVkID0gZnVuY3Rpb24oX3NwYW5UeXBlcywgX2VudGl0eUF0dHJpYnV0ZVR5cGVzLCBfZXZlbnRBdHRyaWJ1dGVUeXBlcywgX3JlbGF0aW9uVHlwZXNIYXNoKSB7XG4gICAgICAgIHNwYW5UeXBlcyA9IF9zcGFuVHlwZXM7XG4gICAgICAgIHJlbGF0aW9uVHlwZXNIYXNoID0gX3JlbGF0aW9uVHlwZXNIYXNoO1xuICAgICAgfTtcblxuICAgICAgdmFyIGFubm90YXRpb25Jc0F2YWlsYWJsZSA9IGZ1bmN0aW9uKCkge1xuICAgICAgICBhbm5vdGF0aW9uQXZhaWxhYmxlID0gdHJ1ZTtcbiAgICAgIH07XG5cbiAgICAgIC8vIGhpZGUgYW55dGhpbmcgcmVxdWlyaW5nIGxvZ2luLCBqdXN0IGluIGNhc2VcbiAgICAgICQoJy5sb2dpbicpLmhpZGUoKTtcblxuICAgICAgLy8gWFhYIFRPRE8gYSBsb3RcbiAgICAgIHZhciB0b3VjaFN0YXJ0O1xuICAgICAgdmFyIG9uVG91Y2hTdGFydCA9IGZ1bmN0aW9uKGV2dCkge1xuICAgICAgICAvLyBldnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgZXZ0ID0gZXZ0Lm9yaWdpbmFsRXZlbnQ7XG4gICAgICAgIGlmIChldnQudG91Y2hlcy5sZW5ndGggPT0gMSkge1xuICAgICAgICAgIC8vIHNpbmdsZSB0b3VjaDsgc3RhcnQgdHJhY2tpbmcgdG8gc2VlIGlmIHdlJ3JlIGRvaW5nXG4gICAgICAgICAgLy8gbGVmdC9yaWdodFxuICAgICAgICAgIHRvdWNoU3RhcnQgPSAkLmV4dGVuZCh7fSwgZXZ0LnRvdWNoZXNbMF0pOyAvLyBjbG9uZVxuICAgICAgICB9IGVsc2UgaWYgKGV2dC50b3VjaGVzLmxlbmd0aCA9PSA0KSB7XG4gICAgICAgICAgLy8gNCBmaW5nZXIgdGFwOiBmaWxlIGJyb3dzZXJcbiAgICAgICAgICBzaG93RmlsZUJyb3dzZXIoKTtcbiAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgIH07XG4gICAgICB2YXIgb25Ub3VjaEVuZCA9IGZ1bmN0aW9uKGV2dCkge1xuICAgICAgICAvLyBldnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgZXZ0ID0gZXZ0Lm9yaWdpbmFsRXZlbnQ7XG4gICAgICAgICQuZWFjaChldnQuY2hhbmdlZFRvdWNoZXMsIGZ1bmN0aW9uKHRvdWNoRW5kTm8sIHRvdWNoRW5kKSB7XG4gICAgICAgICAgaWYgKHRvdWNoU3RhcnQuaWRlbnRpZmllciA9PSB0b3VjaEVuZC5pZGVudGlmaWVyKSB7XG4gICAgICAgICAgICB2YXIgZHggPSB0b3VjaEVuZC5zY3JlZW5YIC0gdG91Y2hTdGFydC5zY3JlZW5YO1xuICAgICAgICAgICAgdmFyIGR5ID0gdG91Y2hFbmQuc2NyZWVuWSAtIHRvdWNoU3RhcnQuc2NyZWVuWTtcbiAgICAgICAgICAgIHZhciBhZHggPSBNYXRoLmFicyhkeCk7XG4gICAgICAgICAgICB2YXIgYWR5ID0gTWF0aC5hYnMoZHkpO1xuICAgICAgICAgICAgaWYgKGFkeCA+IDIwMCAmJiBhZHkgPCBhZHggLyAyKSB7XG4gICAgICAgICAgICAgIC8vIGl0J3MgbGVmdC9yaWdodCFcbiAgICAgICAgICAgICAgcmV0dXJuIG1vdmVJbkZpbGVCcm93c2VyKGR4IDwgMCA/IC0xIDogKzEpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICB9O1xuXG4gICAgICB2YXIgZG9jdW1lbnRDaGFuZ2VzVGltZXIgPSBudWxsO1xuICAgICAgdmFyIG1heERvY3VtZW50Q2hhbmdlc1RpbWVvdXQgPSAzMiAqIDEwMDA7XG4gICAgICB2YXIgZG9jdW1lbnRDaGFuZ2VzVGltZW91dCA9IDEgKiAxMDAwO1xuICAgICAgdmFyIGNoZWNrRm9yRG9jdW1lbnRDaGFuZ2VzID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIGlmIChjb2xsICYmIGRvYyAmJiBkaXNwYXRjaGVyLnBvc3QoJ2lzUmVsb2FkT2theScsIFtdLCAnYWxsJykpIHtcbiAgICAgICAgICBvcHRzID0ge1xuICAgICAgICAgICAgJ2FjdGlvbic6ICdnZXREb2N1bWVudFRpbWVzdGFtcCcsXG4gICAgICAgICAgICAnY29sbGVjdGlvbic6IGNvbGwsXG4gICAgICAgICAgICAnZG9jdW1lbnQnOiBkb2NcbiAgICAgICAgICB9XG4gICAgICAgICAgZGlzcGF0Y2hlci5wb3N0KCdhamF4JywgW29wdHMsIGZ1bmN0aW9uKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICBpZiAoZGF0YSkge1xuICAgICAgICAgICAgICBpZiAobXRpbWUgIT0gcmVzcG9uc2UubXRpbWUpIHtcbiAgICAgICAgICAgICAgICBkaXNwYXRjaGVyLnBvc3QoJ2N1cnJlbnQnLCBbY29sbCwgZG9jLCBhcmdzLCB0cnVlXSk7XG4gICAgICAgICAgICAgICAgZG9jdW1lbnRDaGFuZ2VzVGltZW91dCA9IDEgKiAxMDAwO1xuICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGRvY3VtZW50Q2hhbmdlc1RpbWVvdXQgKj0gMjtcbiAgICAgICAgICAgICAgICBpZiAoZG9jdW1lbnRDaGFuZ2VzVGltZW91dCA+PSBtYXhEb2N1bWVudENoYW5nZXNUaW1lb3V0KVxuICAgICAgICAgICAgICAgICAgZG9jdW1lbnRDaGFuZ2VzVGltZW91dCA9IG1heERvY3VtZW50Q2hhbmdlc1RpbWVvdXQ7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgZG9jdW1lbnRDaGFuZ2VzVGltZW91dCA9IDEgKiAxMDAwO1xuICAgICAgICB9XG4gICAgICAgIGRvY3VtZW50Q2hhbmdlc1RpbWVyID0gc2V0VGltZW91dChjaGVja0ZvckRvY3VtZW50Q2hhbmdlcywgZG9jdW1lbnRDaGFuZ2VzVGltZW91dCk7XG4gICAgICB9XG5cbiAgICAgIGlmIChDb25maWd1cmF0aW9uLmF1dG9yZWZyZXNoT24pIHtcbiAgICAgICAgY2hlY2tGb3JEb2N1bWVudENoYW5nZXMoKTtcbiAgICAgIH1cblxuICAgICAgJCgnI2F1dG9yZWZyZXNoX21vZGUnKS5jbGljayhmdW5jdGlvbihldnQpIHtcbiAgICAgICAgdmFyIHZhbCA9IHRoaXMuY2hlY2tlZDtcbiAgICAgICAgaWYgKHZhbCkge1xuICAgICAgICAgIENvbmZpZ3VyYXRpb24uYXV0b3JlZnJlc2hPbiA9IHRydWU7XG4gICAgICAgICAgY2hlY2tGb3JEb2N1bWVudENoYW5nZXMoKTtcbiAgICAgICAgICBkaXNwYXRjaGVyLnBvc3QoJ21lc3NhZ2VzJywgW1tbJ0F1dG9yZWZyZXNoIG1vZGUgaXMgbm93IG9uJywgJ2NvbW1lbnQnXV1dKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBDb25maWd1cmF0aW9uLmF1dG9yZWZyZXNoT24gPSBmYWxzZTtcbiAgICAgICAgICBjbGVhclRpbWVvdXQoZG9jdW1lbnRDaGFuZ2VzVGltZXIpO1xuICAgICAgICAgIGRpc3BhdGNoZXIucG9zdCgnbWVzc2FnZXMnLCBbW1snQXV0b3JlZnJlc2ggbW9kZSBpcyBub3cgb2ZmJywgJ2NvbW1lbnQnXV1dKTtcbiAgICAgICAgfVxuICAgICAgICBkaXNwYXRjaGVyLnBvc3QoJ2NvbmZpZ3VyYXRpb25DaGFuZ2VkJyk7XG4gICAgICB9KTtcblxuICAgICAgdmFyIGlzUmVsb2FkT2theSA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAvLyBkbyBub3QgcmVsb2FkIHdoaWxlIHRoZSB1c2VyIGlzIGluIHRoZSBkaWFsb2dcbiAgICAgICAgcmV0dXJuIGN1cnJlbnRGb3JtID09IG51bGw7XG4gICAgICB9O1xuXG4gICAgICB2YXIgY29uZmlndXJhdGlvbkNoYW5nZWQgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgLy8ganVzdCBhc3N1bWUgdGhhdCBhbnkgY29uZmlnIGNoYW5nZSBtYWtlcyBzdG9yZWRcbiAgICAgICAgLy8gdmlzdWFsaXphdGlvbnMgaW52YWxpZC4gVGhpcyBpcyBhIGJpdCBleGNlc3NpdmUgKG5vdCBhbGxcbiAgICAgICAgLy8gb3B0aW9ucyBhZmZlY3QgdmlzdWFsaXphdGlvbikgYnV0IG1vc3RseSBoYXJtbGVzcy5cbiAgICAgICAgaW52YWxpZGF0ZVNhdmVkU1ZHKCk7XG5cbiAgICAgICAgLy8gc2F2ZSBjb25maWd1cmF0aW9uIGNoYW5nZWQgYnkgdXNlciBhY3Rpb25cbiAgICAgICAgZGlzcGF0Y2hlci5wb3N0KCdhamF4JywgW3tcbiAgICAgICAgICAgICAgICAgICAgYWN0aW9uOiAnc2F2ZUNvbmYnLFxuICAgICAgICAgICAgICAgICAgICBjb25maWc6IEpTT04uc3RyaW5naWZ5KENvbmZpZ3VyYXRpb24pLFxuICAgICAgICAgICAgICAgIH0sIG51bGxdKTtcbiAgICAgIH07XG5cbiAgICAgIC8vQlJBVCBTVEFOREFMT05FIExJQlJBUlkgQkVHSU5cbiAgICAgIC8vQ29uZmlnIG11c3QgYmUgbWFuYWdlZCBvdXRzaWRlIHRoZSBjb21wb25lbnRcbiAgICAgIC8qXG4gICAgICB2YXIgdXBkYXRlQ29uZmlndXJhdGlvblVJID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIC8vIHVwZGF0ZSBVSSB0byByZWZsZWN0IG5vbi11c2VyIGNvbmZpZyBjaGFuZ2VzIChlLmcuIGxvYWQpXG4gICAgICAgIFxuICAgICAgICAvLyBBbm5vdGF0aW9uIG1vZGVcbiAgICAgICAgaWYgKENvbmZpZ3VyYXRpb24uY29uZmlybU1vZGVPbikge1xuICAgICAgICAgICQoJyNhbm5vdGF0aW9uX3NwZWVkMScpWzBdLmNoZWNrZWQgPSB0cnVlO1xuICAgICAgICB9IGVsc2UgaWYgKENvbmZpZ3VyYXRpb24ucmFwaWRNb2RlT24pIHtcbiAgICAgICAgICAkKCcjYW5ub3RhdGlvbl9zcGVlZDMnKVswXS5jaGVja2VkID0gdHJ1ZTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAkKCcjYW5ub3RhdGlvbl9zcGVlZDInKVswXS5jaGVja2VkID0gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgICAkKCcjYW5ub3RhdGlvbl9zcGVlZCBpbnB1dCcpLmJ1dHRvbigncmVmcmVzaCcpO1xuXG4gICAgICAgIC8vIExhYmVsIGFiYnJldnNcbiAgICAgICAgJCgnI2xhYmVsX2FiYnJldmlhdGlvbnNfb24nKVswXS5jaGVja2VkICA9IENvbmZpZ3VyYXRpb24uYWJicmV2c09uO1xuICAgICAgICAkKCcjbGFiZWxfYWJicmV2aWF0aW9uc19vZmYnKVswXS5jaGVja2VkID0gIUNvbmZpZ3VyYXRpb24uYWJicmV2c09uOyBcbiAgICAgICAgJCgnI2xhYmVsX2FiYnJldmlhdGlvbnMgaW5wdXQnKS5idXR0b24oJ3JlZnJlc2gnKTtcblxuICAgICAgICAvLyBUZXh0IGJhY2tncm91bmRzICAgICAgICBcbiAgICAgICAgJCgnI3RleHRfYmFja2dyb3VuZHMgaW5wdXRbdmFsdWU9XCInK0NvbmZpZ3VyYXRpb24udGV4dEJhY2tncm91bmRzKydcIl0nKVswXS5jaGVja2VkID0gdHJ1ZTtcbiAgICAgICAgJCgnI3RleHRfYmFja2dyb3VuZHMgaW5wdXQnKS5idXR0b24oJ3JlZnJlc2gnKTtcblxuICAgICAgICAvLyBTVkcgd2lkdGhcbiAgICAgICAgdmFyIHNwbGl0U3ZnV2lkdGggPSBDb25maWd1cmF0aW9uLnN2Z1dpZHRoLm1hdGNoKC9eKC4qPykocHh8XFwlKSQvKTtcbiAgICAgICAgaWYgKCFzcGxpdFN2Z1dpZHRoKSB7XG4gICAgICAgICAgLy8gVE9ETzogcmVzZXQgdG8gc2Vuc2libGUgdmFsdWU/XG4gICAgICAgICAgZGlzcGF0Y2hlci5wb3N0KCdtZXNzYWdlcycsIFtbWydFcnJvciBwYXJzaW5nIFNWRyB3aWR0aCBcIicrQ29uZmlndXJhdGlvbi5zdmdXaWR0aCsnXCInLCAnZXJyb3InLCAyXV1dKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAkKCcjc3ZnX3dpZHRoX3ZhbHVlJylbMF0udmFsdWUgPSBzcGxpdFN2Z1dpZHRoWzFdO1xuICAgICAgICAgICQoJyNzdmdfd2lkdGhfdW5pdCBpbnB1dFt2YWx1ZT1cIicrc3BsaXRTdmdXaWR0aFsyXSsnXCJdJylbMF0uY2hlY2tlZCA9IHRydWU7XG4gICAgICAgICAgJCgnI3N2Z193aWR0aF91bml0IGlucHV0JykuYnV0dG9uKCdyZWZyZXNoJyk7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBBdXRvcmVmcmVzaFxuICAgICAgICAkKCcjYXV0b3JlZnJlc2hfbW9kZScpWzBdLmNoZWNrZWQgPSBDb25maWd1cmF0aW9uLmF1dG9yZWZyZXNoT247XG4gICAgICAgICQoJyNhdXRvcmVmcmVzaF9tb2RlJykuYnV0dG9uKCdyZWZyZXNoJyk7XG4gICAgICB9Ki9cblxuICAgICAgJCgnI3ByZXYnKS5idXR0b24oKS5jbGljayhmdW5jdGlvbigpIHtcbiAgICAgICAgcmV0dXJuIG1vdmVJbkZpbGVCcm93c2VyKC0xKTtcbiAgICAgIH0pO1xuICAgICAgJCgnI25leHQnKS5idXR0b24oKS5jbGljayhmdW5jdGlvbigpIHtcbiAgICAgICAgcmV0dXJuIG1vdmVJbkZpbGVCcm93c2VyKCsxKTtcbiAgICAgIH0pO1xuICAgICAgJCgnI2Zvb3RlcicpLnNob3coKTtcblxuICAgICAgdmFyIHJlbWVtYmVyRGF0YSA9IGZ1bmN0aW9uKF9kYXRhKSB7XG4gICAgICAgIGlmIChfZGF0YSAmJiAhX2RhdGEuZXhjZXB0aW9uKSB7XG4gICAgICAgICAgZGF0YSA9IF9kYXRhO1xuICAgICAgICB9XG4gICAgICB9O1xuXG4gICAgICB2YXIgb25TY3JlYW1pbmdIYWx0ID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICQoJyN3YWl0ZXInKS5kaWFsb2coJ2Nsb3NlJyk7XG4gICAgICAgICQoJyNwdWxsZG93biwgI25hdmJ1dHRvbnMsICNzcGlubmVyJykucmVtb3ZlKCk7XG4gICAgICAgIGRpc3BhdGNoZXIucG9zdCgnaGlkZUZvcm0nKTtcbiAgICAgIH07XG5cbiAgICAgIGRpc3BhdGNoZXIuXG4gICAgICAgICAgb24oJ2luaXQnLCBpbml0KS5cbiAgICAgICAgICBvbignZGF0YVJlYWR5JywgcmVtZW1iZXJEYXRhKS5cbiAgICAgICAgICBvbignYW5ub3RhdGlvbklzQXZhaWxhYmxlJywgYW5ub3RhdGlvbklzQXZhaWxhYmxlKS5cbiAgICAgICAgICBvbignbWVzc2FnZXMnLCBkaXNwbGF5TWVzc2FnZXMpLlxuICAgICAgICAgIG9uKCdkaXNwbGF5U3BhbkNvbW1lbnQnLCBkaXNwbGF5U3BhbkNvbW1lbnQpLlxuICAgICAgICAgIG9uKCdkaXNwbGF5QXJjQ29tbWVudCcsIGRpc3BsYXlBcmNDb21tZW50KS5cbiAgICAgICAgICBvbignZGlzcGxheVNlbnRDb21tZW50JywgZGlzcGxheVNlbnRDb21tZW50KS5cbiAgICAgICAgICBvbignZG9jQ2hhbmdlZCcsIG9uRG9jQ2hhbmdlZCkuXG4gICAgICAgICAgb24oJ2hpZGVDb21tZW50JywgaGlkZUNvbW1lbnQpLlxuICAgICAgICAgIG9uKCdzaG93Rm9ybScsIHNob3dGb3JtKS5cbiAgICAgICAgICBvbignaGlkZUZvcm0nLCBoaWRlRm9ybSkuXG4gICAgICAgICAgb24oJ2luaXRGb3JtJywgaW5pdEZvcm0pLlxuICAgICAgICAgIG9uKCdjb2xsZWN0aW9uTG9hZGVkJywgcmVtZW1iZXJOb3JtRGIpLlxuICAgICAgICAgIG9uKCdjb2xsZWN0aW9uTG9hZGVkJywgY29sbGVjdGlvbkxvYWRlZCkuXG4gICAgICAgICAgb24oJ3NwYW5BbmRBdHRyaWJ1dGVUeXBlc0xvYWRlZCcsIHNwYW5BbmRBdHRyaWJ1dGVUeXBlc0xvYWRlZCkuXG4gICAgICAgICAgb24oJ2lzUmVsb2FkT2theScsIGlzUmVsb2FkT2theSkuXG4gICAgICAgICAgb24oJ2N1cnJlbnQnLCBnb3RDdXJyZW50KS5cbiAgICAgICAgICBvbignZG9uZVJlbmRlcmluZycsIG9uRG9uZVJlbmRlcmluZykuXG4gICAgICAgICAgb24oJ3N0YXJ0ZWRSZW5kZXJpbmcnLCBvblN0YXJ0ZWRSZW5kZXJpbmcpLlxuICAgICAgICAgIG9uKCduZXdTb3VyY2VEYXRhJywgb25OZXdTb3VyY2VEYXRhKS5cbiAgICAgICAgICBvbignc2F2ZWRTVkcnLCBzYXZlZFNWR3JlY2VpdmVkKS5cbiAgICAgICAgICBvbigncmVuZGVyRXJyb3I6bm9GaWxlU3BlY2lmaWVkJywgbm9GaWxlU3BlY2lmaWVkKS5cbiAgICAgICAgICBvbigncmVuZGVyRXJyb3I6YW5ub3RhdGlvbkZpbGVOb3RGb3VuZCcsIHNob3dBbm5vdGF0aW9uRmlsZU5vdEZvdW5kKS5cbiAgICAgICAgICBvbigncmVuZGVyRXJyb3I6dW5hYmxlVG9SZWFkVGV4dEZpbGUnLCBzaG93VW5hYmxlVG9SZWFkVGV4dEZpbGUpLlxuICAgICAgICAgIG9uKCdyZW5kZXJFcnJvcjppc0RpcmVjdG9yeUVycm9yJywgcmVsb2FkRGlyZWN0b3J5V2l0aFNsYXNoKS5cbiAgICAgICAgICBvbigndW5rbm93bkVycm9yJywgc2hvd1Vua25vd25FcnJvcikuXG4gICAgICAgICAgb24oJ2tleWRvd24nLCBvbktleURvd24pLlxuICAgICAgICAgIG9uKCdtb3VzZW1vdmUnLCBvbk1vdXNlTW92ZSkuXG4gICAgICAgICAgb24oJ2RibGNsaWNrJywgb25EYmxDbGljaykuXG4gICAgICAgICAgb24oJ2NsaWNrJywgb25TaW5nbGVDbGljaykuXG4gICAgICAgICAgb24oJ3RvdWNoc3RhcnQnLCBvblRvdWNoU3RhcnQpLlxuICAgICAgICAgIG9uKCd0b3VjaGVuZCcsIG9uVG91Y2hFbmQpLlxuICAgICAgICAgIG9uKCdyZXNpemUnLCBvblJlc2l6ZSkuXG4gICAgICAgICAgb24oJ3NlYXJjaFJlc3VsdHNSZWNlaXZlZCcsIHNlYXJjaFJlc3VsdHNSZWNlaXZlZCkuXG4gICAgICAgICAgb24oJ2NsZWFyU2VhcmNoJywgY2xlYXJTZWFyY2gpLlxuICAgICAgICAgIG9uKCdjbGVhclNWRycsIHNob3dOb0RvY01lc3NhZ2UpLlxuICAgICAgICAgIG9uKCdzY3JlYW1pbmdIYWx0Jywgb25TY3JlYW1pbmdIYWx0KS5cbiAgICAgICAgICAvL29uKCdjb25maWd1cmF0aW9uVXBkYXRlZCcsIHVwZGF0ZUNvbmZpZ3VyYXRpb25VSSkuXG4gICAgICAgICAgb24oJ2NvbmZpZ3VyYXRpb25DaGFuZ2VkJywgY29uZmlndXJhdGlvbkNoYW5nZWQpO1xuICAgIH07XG5cbiAgICByZXR1cm4gVmlzdWFsaXplclVJO1xufSkoalF1ZXJ5LCB3aW5kb3cpO1xuXG4vLyBCUkFUIFNUQU5EQUxPTkUgTElCUkFSWSBCRUdJTlxuLy8gQnJvd3NlcmlmeSBleHBvcnRcbm1vZHVsZS5leHBvcnRzID0gVmlzdWFsaXplclVJO1xuLy8gQlJBVCBTVEFOREFMT05FIExJQlJBUlkgRU5EXG4iLCJ3aW5kb3cuJCA9IHJlcXVpcmUoJy4vY2xpZW50L2xpYi9ub2RlLWpxdWVyeS0xLjcuMScpOyAvL3JlcXVpcmUoJ2pxdWVyeS1ub2RlLWJyb3dzZXJpZnknKTsgLy8gQDEuNy4yICsrXG5MT05HX0FOTk9UQVRJT05fQ09OU1QgPSBcIkxvbmdBbm5vdGF0aW9uXCI7XG5cbndpbmRvdy5CcmF0RnJvbnRlbmRFZGl0b3IgPSBmdW5jdGlvbihlbGVtZW50LCBjb2xsRGF0YSwgZG9jRGF0YSwgb3B0aW9ucykge1xuICAgIGlmICghKGVsZW1lbnQgaW5zdGFuY2VvZiBFbGVtZW50KSkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ2VsZW1lbnQgc2hvdWxkIGJlIGFuIGluc3RhbmNlIG9mIEVsZW1lbnQnKTtcbiAgICB9XG5cbiAgICBjb2xsRGF0YSA9IGNvbGxEYXRhIHx8IHt9O1xuICAgIGRvY0RhdGEgPSBkb2NEYXRhIHx8IHt9O1xuICAgIG9wdGlvbnMgPSBvcHRpb25zIHx8IHt9O1xuXG4gICAgLy9ERUZBVUxUIE9QVElPTlNcbiAgICBuZXdPcHRpb25zID0ge1xuICAgICAgICBhY3RpdmF0ZUVkaXRpb246IHRydWUsXG4gICAgICAgIG92ZXJXcml0ZU1vZGFsczogZmFsc2UsXG4gICAgICAgIHNob3dUb29sdGlwOiBmYWxzZSxcbiAgICAgICAgYXNzZXRzUGF0aDogXCJzdGF0aWMvXCIsXG4gICAgICAgIG1heEZyYWdtZW50TGVuZ3RoOiA0MCxcbiAgICAgICAgc2hvd1Rvb2x0aXA6IHRydWUsXG4gICAgICAgIG92ZXJXcml0ZU1vZGFsczogZmFsc2UsXG4gICAgICAgIHdlYkZvbnRVUkxzOiBbXG4gICAgICAgICAgICAnZm9udHMvQXN0bG9jaC1Cb2xkLnR0ZicsXG4gICAgICAgICAgICAnZm9udHMvUFRfU2Fucy1DYXB0aW9uLVdlYi1SZWd1bGFyLnR0ZicsXG4gICAgICAgICAgICAnZm9udHMvTGliZXJhdGlvbl9TYW5zLVJlZ3VsYXIudHRmJ1xuICAgICAgICBdLFxuICAgICAgICBhamF4OiAnbG9jYWwnIC8vICdsb2NhbCcsICdleHRlcm5hbCcgb3IgJ25vcm1hbCdcbiAgICB9O1xuXG4gICAgLy8gSWYgb3B0aW9uIGRlZmluZWQsIG92ZXItd3JpdGUgbmV3T3B0aW9uc1xuICAgIGZvcih2YXIgb3B0IGluIG9wdGlvbnMpe1xuICAgICAgICBpZihvcHRpb25zLmhhc093blByb3BlcnR5KG9wdCkpe1xuICAgICAgICAgICAgbmV3T3B0aW9uc1tvcHRdID0gb3B0aW9uc1tvcHRdO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgdGhpcy5lbGVtZW50ID0gZWxlbWVudDtcbiAgICB0aGlzLmNvbGxEYXRhID0gY29sbERhdGE7XG4gICAgdGhpcy5kb2NEYXRhID0gZG9jRGF0YTtcbiAgICB0aGlzLm9wdGlvbnMgPSBuZXdPcHRpb25zO1xuICAgIHRoaXMuaW5pdCgpO1xufTtcblxuQnJhdEZyb250ZW5kRWRpdG9yLnByb3RvdHlwZSA9IHtcbiAgICBjb25zdHJ1Y3RvcjogQnJhdEZyb250ZW5kRWRpdG9yLFxuICAgIGluaXQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICB2YXIgc2VsZiA9IHRoaXM7XG4gICAgICAgIHZhciBodG1sID0gcmVxdWlyZSgnLi9icmF0Lmh0bWwnKTtcbiAgICAgICAgc2VsZi5lbGVtZW50LmlubmVySFRNTCA9IGh0bWw7XG4gICAgICAgIHNlbGYuc2V0SHRtbEltZ1NyYygpO1xuXG4gICAgICAgIHdpbmRvdy5qUXVlcnkgPSAkO1xuICAgICAgICAoZnVuY3Rpb24oJCl7XG4gICAgICAgICAgICAvLyByZXF1aXJlKCcuL2luZGV4LmNzcycpOyAvL1RPRE86IElmIHBvc3NpYmxlLCBpbmNsdWRlIGNzcyBpbiBtaW4uanMgKGJyb3dzZXJpZnktY3NzKVxuICAgICAgICAgICAgcmVxdWlyZSgnLi9jbGllbnQvbGliL2pxdWVyeS11aS5taW4nKTtcbiAgICAgICAgICAgIHJlcXVpcmUoJy4vY2xpZW50L2xpYi9qcXVlcnkuc3ZnLm1pbicpO1xuICAgICAgICAgICAgcmVxdWlyZSgnLi9jbGllbnQvbGliL2pxdWVyeS5zdmdkb20ubWluJyk7XG4gICAgICAgICAgICByZXF1aXJlKCdqcXVlcnktYmJxJyk7XG4gICAgICAgICAgICByZXF1aXJlKCcuL2NsaWVudC9saWIvanF1ZXJ5LnNwcmludGYnKTtcbiAgICAgICAgICAgIHJlcXVpcmUoJy4vY2xpZW50L2xpYi9qcXVlcnkuanNvbi5taW4nKTtcbiAgICAgICAgICAgIC8vVE9ETyBGaXggdGhpcyBlcnJvclxuICAgICAgICAgICAgd2luZG93LldlYkZvbnQgPSByZXF1aXJlKCcuL2NsaWVudC9saWIvd2ViZm9udC5qcycpLldlYkZvbnQ7IC8vVW5jYXVnaHQgVHlwZUVycm9yOiBDYW5ub3Qgc2V0IHByb3BlcnR5ICdXZWJGb250JyBvZiB1bmRlZmluZWRcblxuICAgICAgICAgICAgLy9icmF0IGdsb2JhbCBoZWxwZXJzXG4gICAgICAgICAgICB2YXIgQ29uZmlnPSByZXF1aXJlKCcuL2NsaWVudC9zcmMvY29uZmlndXJhdGlvbicpO1xuICAgICAgICAgICAgd2luZG93LkNvbmZpZ3VyYXRpb24gPSBuZXcgQ29uZmlnKCk7XG4gICAgICAgICAgICB3aW5kb3cuVXRpbCA9IHJlcXVpcmUoJy4vY2xpZW50L3NyYy91dGlsJyk7XG5cbiAgICAgICAgICAgIC8vIGJyYXQgbW9kdWxlc1xuICAgICAgICAgICAgd2luZG93LkRpc3BhdGNoZXIgPSByZXF1aXJlKCcuL2NsaWVudC9zcmMvZGlzcGF0Y2hlcicpO1xuICAgICAgICAgICAgd2luZG93LlVSTEhhc2ggPSByZXF1aXJlKCcuL2NsaWVudC9zcmMvdXJsX2hhc2gnKTsgLy9UT0RPIEZpZ3VyZSBvdXRcbiAgICAgICAgICAgIHdpbmRvdy5Mb2NhbEFqYXggPSByZXF1aXJlKCcuL2NsaWVudC9zcmMvbG9jYWxfYWpheCcpO1xuICAgICAgICAgICAgd2luZG93LkFqYXggPSByZXF1aXJlKCcuL2NsaWVudC9zcmMvYWpheC5qcycpO1xuICAgICAgICAgICAgd2luZG93LlZpc3VhbGl6ZXIgPSByZXF1aXJlKCcuL2NsaWVudC9zcmMvdmlzdWFsaXplcicpO1xuICAgICAgICAgICAgd2luZG93LlZpc3VhbGl6ZXJVSSA9IHJlcXVpcmUoJy4vY2xpZW50L3NyYy92aXN1YWxpemVyX3VpJyk7XG4gICAgICAgICAgICB3aW5kb3cuQW5ub3RhdG9yVUkgPSByZXF1aXJlKCcuL2NsaWVudC9zcmMvYW5ub3RhdG9yX3VpJyk7XG4gICAgICAgICAgICB3aW5kb3cuU3Bpbm5lciA9IHJlcXVpcmUoJy4vY2xpZW50L3NyYy9zcGlubmVyJyk7XG5cbiAgICAgICAgICAgICQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgc2VsZi5kaXNwYXRjaGVyID0gbmV3IERpc3BhdGNoZXIoKTtcbiAgICAgICAgICAgICAgICBzd2l0Y2goc2VsZi5vcHRpb25zLmFqYXgpIHtcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAnbG9jYWwnOlxuICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5hamF4ID0gbmV3IExvY2FsQWpheChzZWxmLmRpc3BhdGNoZXIsIHNlbGYub3B0aW9ucy5tYXhGcmFnbWVudExlbmd0aCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAnbm9ybWFsJzpcbiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuYWpheCA9IG5ldyBBamF4KHNlbGYuZGlzcGF0Y2hlcik7XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAnZXh0ZXJuYWwnOlxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmFqYXggPSBuZXcgTG9jYWxBamF4KHNlbGYuZGlzcGF0Y2hlciwgc2VsZi5vcHRpb25zLm1heEZyYWdtZW50TGVuZ3RoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB2YXIgYWJzb2x1dGVXZWJGb250c1VSTFMgPSBbXG4gICAgICAgICAgICAgICAgICAgIHNlbGYub3B0aW9ucy5hc3NldHNQYXRoICsgc2VsZi5vcHRpb25zLndlYkZvbnRVUkxzWzBdLFxuICAgICAgICAgICAgICAgICAgICBzZWxmLm9wdGlvbnMuYXNzZXRzUGF0aCArIHNlbGYub3B0aW9ucy53ZWJGb250VVJMc1sxXSxcbiAgICAgICAgICAgICAgICAgICAgc2VsZi5vcHRpb25zLmFzc2V0c1BhdGggKyBzZWxmLm9wdGlvbnMud2ViRm9udFVSTHNbMl0sXG4gICAgICAgICAgICAgICAgXTtcbiAgICAgICAgICAgICAgICBzZWxmLnZpc3VhbGl6ZXIgPSBuZXcgVmlzdWFsaXplcihzZWxmLmRpc3BhdGNoZXIsICdzdmcnLCBhYnNvbHV0ZVdlYkZvbnRzVVJMUyk7XG4gICAgICAgICAgICAgICAgc2VsZi5zdmcgPSBzZWxmLnZpc3VhbGl6ZXIuc3ZnO1xuICAgICAgICAgICAgICAgIGlmKHNlbGYub3B0aW9ucy5hY3RpdmF0ZUVkaXRpb24gPT09IHRydWUpe1xuICAgICAgICAgICAgICAgICAgICBzZWxmLnZpc3VhbGl6ZXJVSSA9IG5ldyBWaXN1YWxpemVyVUkoc2VsZi5kaXNwYXRjaGVyLCBzZWxmLnN2Zywgc2VsZi5vcHRpb25zLnNob3dUb29sdGlwLCBzZWxmLm9wdGlvbnMub3ZlcldyaXRlTW9kYWxzKTtcbiAgICAgICAgICAgICAgICAgICAgc2VsZi5hbm5vdGF0b3JVSSA9IG5ldyBBbm5vdGF0b3JVSShzZWxmLmRpc3BhdGNoZXIsIHNlbGYuc3ZnKTtcbiAgICAgICAgICAgICAgICAgICAgLy8gc2VsZi5zcGlubmVyID0gbmV3IFNwaW5uZXIoc2VsZi5kaXNwYXRjaGVyLCAnI3NwaW5uZXInKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgc2VsZi5kaXNwYXRjaGVyLnBvc3QoJ2luaXQnKTtcblxuICAgICAgICAgICAgICAgIGlmKHNlbGYub3B0aW9ucy5tYXhGcmFnbWVudExlbmd0aCA+IDApe1xuICAgICAgICAgICAgICAgICAgICBzZWxmLmFkZExvbmdBbm5vdGF0aW9uRW50aXR5QXR0cmlidXRlKCk7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgc2VsZi5kb2NEYXRhLmNvbGxlY3Rpb24gPSBudWxsO1xuICAgICAgICAgICAgICAgIHNlbGYuZGlzcGF0Y2hlci5wb3N0KCdjb2xsZWN0aW9uTG9hZGVkJywgW3NlbGYuY29sbERhdGFdKTtcbiAgICAgICAgICAgICAgICBzZWxmLmRpc3BhdGNoZXIucG9zdCgncmVxdWVzdFJlbmRlckRhdGEnLCBbc2VsZi5kb2NEYXRhXSk7XG4gICAgICAgICAgICAgICAgc2VsZi5kaXNwYXRjaGVyLnBvc3QoJ2N1cnJlbnQnLCBbc2VsZi5jb2xsRGF0YSwgc2VsZi5kb2NEYXRhLCB7fV0pO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgfSkoJCk7XG4gICAgfSxcbiAgICBhZGRMb25nQW5ub3RhdGlvbkVudGl0eUF0dHJpYnV0ZTogZnVuY3Rpb24oKXtcbiAgICAgICAgLy8gU3BlY2lhbCBzeW1ib2wgZm9yIHNwbGl0dGVkIGxvbmcgYW5ub3RhdGlvbnNcbiAgICAgICAgdGhpcy5jb2xsRGF0YS5lbnRpdHlfYXR0cmlidXRlX3R5cGVzLnB1c2goIHtcbiAgICAgICAgICAgIFwibmFtZVwiOiBMT05HX0FOTk9UQVRJT05fQ09OU1QsXG4gICAgICAgICAgICBcInR5cGVcIiAgOiBMT05HX0FOTk9UQVRJT05fQ09OU1QsXG4gICAgICAgICAgICBcInZhbHVlc1wiOiB7IExPTkdfQU5OT1RBVElPTl9DT05TVDogeyBcImdseXBoXCI6IFwi4oa5XCIgfSB9XG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLmNvbGxEYXRhLmVudGl0eV90eXBlcy5mb3JFYWNoKGZ1bmN0aW9uKHR5cGUpe1xuICAgICAgICAgICAgdHlwZS5hdHRyaWJ1dGVzLnB1c2goTE9OR19BTk5PVEFUSU9OX0NPTlNUKTtcbiAgICAgICAgfSk7XG4gICAgfSxcbiAgICBzZXRIdG1sSW1nU3JjOiBmdW5jdGlvbigpe1xuICAgICAgICB2YXIgc3Bpbm5lcnMgPSB0aGlzLmVsZW1lbnQuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZShcImJyYXQtc3Bpbm5lclwiKTtcbiAgICAgICAgdmFyIG1hZ25pZmllcnMgPSB0aGlzLmVsZW1lbnQuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZShcImJyYXQtZnVndWUtc2hhZG93bGVzcy1tYWduaWZpZXJcIik7XG4gICAgICAgIHZhciBleHRlcm5hbHMgPSB0aGlzLmVsZW1lbnQuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZShcImJyYXQtZnVndWUtc2hhZG93bGVzcy1leHRlcm5hbFwiKTtcblxuICAgICAgICBpZihzcGlubmVycyAmJiBzcGlubmVycy5sZW5ndGgpe1xuICAgICAgICAgICAgc3Bpbm5lcnNbMF0uc3JjID0gdGhpcy5vcHRpb25zLmFzc2V0c1BhdGggKyAnaW1nL3NwaW5uZXIuZ2lmJztcbiAgICAgICAgfVxuICAgICAgICBpZihtYWduaWZpZXJzICYmIG1hZ25pZmllcnMubGVuZ3RoKXtcbiAgICAgICAgICAgIG1hZ25pZmllcnNbMF0uc3JjID0gdGhpcy5vcHRpb25zLmFzc2V0c1BhdGggKyAnaW1nL0Z1Z3VlLXNoYWRvd2xlc3MtbWFnbmlmaWVyLnBuZyc7XG4gICAgICAgIH1cbiAgICAgICAgaWYoZXh0ZXJuYWxzICYmIGV4dGVybmFscy5sZW5ndGgpe1xuICAgICAgICAgICAgZXh0ZXJuYWxzWzBdLnNyYyA9IHRoaXMub3B0aW9ucy5hc3NldHNQYXRoICsgJ2ltZy9GdWd1ZS1zaGFkb3dsZXNzLWV4dGVybmFsLnBuZyc7XG4gICAgICAgIH1cbiAgICB9XG59O1xuIiwiLyohXG4gKiBqUXVlcnkgQkJROiBCYWNrIEJ1dHRvbiAmIFF1ZXJ5IExpYnJhcnkgLSB2MS4zcHJlIC0gOC8yNi8yMDEwXG4gKiBodHRwOi8vYmVuYWxtYW4uY29tL3Byb2plY3RzL2pxdWVyeS1iYnEtcGx1Z2luL1xuICpcbiAqIENvcHlyaWdodCAoYykgMjAxMCBcIkNvd2JveVwiIEJlbiBBbG1hblxuICogRHVhbCBsaWNlbnNlZCB1bmRlciB0aGUgTUlUIGFuZCBHUEwgbGljZW5zZXMuXG4gKiBodHRwOi8vYmVuYWxtYW4uY29tL2Fib3V0L2xpY2Vuc2UvXG4gKi9cblxuLy8gU2NyaXB0OiBqUXVlcnkgQkJROiBCYWNrIEJ1dHRvbiAmIFF1ZXJ5IExpYnJhcnlcbi8vXG4vLyAqVmVyc2lvbjogMS4zcHJlLCBMYXN0IHVwZGF0ZWQ6IDgvMjYvMjAxMCpcbi8vXG4vLyBQcm9qZWN0IEhvbWUgLSBodHRwOi8vYmVuYWxtYW4uY29tL3Byb2plY3RzL2pxdWVyeS1iYnEtcGx1Z2luL1xuLy8gR2l0SHViICAgICAgIC0gaHR0cDovL2dpdGh1Yi5jb20vY293Ym95L2pxdWVyeS1iYnEvXG4vLyBTb3VyY2UgICAgICAgLSBodHRwOi8vZ2l0aHViLmNvbS9jb3dib3kvanF1ZXJ5LWJicS9yYXcvbWFzdGVyL2pxdWVyeS5iYS1iYnEuanNcbi8vIChNaW5pZmllZCkgICAtIGh0dHA6Ly9naXRodWIuY29tL2Nvd2JveS9qcXVlcnktYmJxL3Jhdy9tYXN0ZXIvanF1ZXJ5LmJhLWJicS5taW4uanMgKDIuMmtiIGd6aXBwZWQpXG4vL1xuLy8gQWJvdXQ6IExpY2Vuc2Vcbi8vXG4vLyBDb3B5cmlnaHQgKGMpIDIwMTAgXCJDb3dib3lcIiBCZW4gQWxtYW4sXG4vLyBEdWFsIGxpY2Vuc2VkIHVuZGVyIHRoZSBNSVQgYW5kIEdQTCBsaWNlbnNlcy5cbi8vIGh0dHA6Ly9iZW5hbG1hbi5jb20vYWJvdXQvbGljZW5zZS9cbi8vXG4vLyBBYm91dDogRXhhbXBsZXNcbi8vXG4vLyBUaGVzZSB3b3JraW5nIGV4YW1wbGVzLCBjb21wbGV0ZSB3aXRoIGZ1bGx5IGNvbW1lbnRlZCBjb2RlLCBpbGx1c3RyYXRlIGEgZmV3XG4vLyB3YXlzIGluIHdoaWNoIHRoaXMgcGx1Z2luIGNhbiBiZSB1c2VkLlxuLy9cbi8vIEJhc2ljIEFKQVggICAgIC0gaHR0cDovL2JlbmFsbWFuLmNvbS9jb2RlL3Byb2plY3RzL2pxdWVyeS1iYnEvZXhhbXBsZXMvZnJhZ21lbnQtYmFzaWMvXG4vLyBBZHZhbmNlZCBBSkFYICAtIGh0dHA6Ly9iZW5hbG1hbi5jb20vY29kZS9wcm9qZWN0cy9qcXVlcnktYmJxL2V4YW1wbGVzL2ZyYWdtZW50LWFkdmFuY2VkL1xuLy8galF1ZXJ5IFVJIFRhYnMgLSBodHRwOi8vYmVuYWxtYW4uY29tL2NvZGUvcHJvamVjdHMvanF1ZXJ5LWJicS9leGFtcGxlcy9mcmFnbWVudC1qcXVlcnktdWktdGFicy9cbi8vIERlcGFyYW0gICAgICAgIC0gaHR0cDovL2JlbmFsbWFuLmNvbS9jb2RlL3Byb2plY3RzL2pxdWVyeS1iYnEvZXhhbXBsZXMvZGVwYXJhbS9cbi8vXG4vLyBBYm91dDogU3VwcG9ydCBhbmQgVGVzdGluZ1xuLy9cbi8vIEluZm9ybWF0aW9uIGFib3V0IHdoYXQgdmVyc2lvbiBvciB2ZXJzaW9ucyBvZiBqUXVlcnkgdGhpcyBwbHVnaW4gaGFzIGJlZW5cbi8vIHRlc3RlZCB3aXRoLCB3aGF0IGJyb3dzZXJzIGl0IGhhcyBiZWVuIHRlc3RlZCBpbiwgYW5kIHdoZXJlIHRoZSB1bml0IHRlc3RzXG4vLyByZXNpZGUgKHNvIHlvdSBjYW4gdGVzdCBpdCB5b3Vyc2VsZikuXG4vL1xuLy8galF1ZXJ5IFZlcnNpb25zIC0gMS4yLjYsIDEuMy4yLCAxLjQuMSwgMS40LjJcbi8vIEJyb3dzZXJzIFRlc3RlZCAtIEludGVybmV0IEV4cGxvcmVyIDYtOCwgRmlyZWZveCAyLTQsIENocm9tZSA1LTYsIFNhZmFyaSAzLjItNSxcbi8vICAgICAgICAgICAgICAgICAgIE9wZXJhIDkuNi0xMC42MCwgaVBob25lIDMuMSwgQW5kcm9pZCAxLjYtMi4yLCBCbGFja0JlcnJ5IDQuNi01LlxuLy8gVW5pdCBUZXN0cyAgICAgIC0gaHR0cDovL2JlbmFsbWFuLmNvbS9jb2RlL3Byb2plY3RzL2pxdWVyeS1iYnEvdW5pdC9cbi8vXG4vLyBBYm91dDogUmVsZWFzZSBIaXN0b3J5XG4vL1xuLy8gMS4zcHJlIC0gKDgvMjYvMjAxMCkgSW50ZWdyYXRlZCA8alF1ZXJ5IGhhc2hjaGFuZ2UgZXZlbnQ+IHYxLjMsIHdoaWNoIGFkZHNcbi8vICAgICAgICAgZG9jdW1lbnQudGl0bGUgYW5kIGRvY3VtZW50LmRvbWFpbiBzdXBwb3J0IGluIElFNi83LCBCbGFja0JlcnJ5XG4vLyAgICAgICAgIHN1cHBvcnQsIGJldHRlciBJZnJhbWUgaGlkaW5nIGZvciBhY2Nlc3NpYmlsaXR5IHJlYXNvbnMsIGFuZCB0aGUgbmV3XG4vLyAgICAgICAgIDxqUXVlcnkuZm4uaGFzaGNoYW5nZT4gXCJzaG9ydGN1dFwiIG1ldGhvZC4gQWRkZWQgdGhlXG4vLyAgICAgICAgIDxqUXVlcnkucGFyYW0uc29ydGVkPiBtZXRob2Qgd2hpY2ggcmVkdWNlcyB0aGUgcG9zc2liaWxpdHkgb2Zcbi8vICAgICAgICAgZXh0cmFuZW91cyBoYXNoY2hhbmdlIGV2ZW50IHRyaWdnZXJpbmcuIEFkZGVkIHRoZVxuLy8gICAgICAgICA8alF1ZXJ5LnBhcmFtLmZyYWdtZW50LmFqYXhDcmF3bGFibGU+IG1ldGhvZCB3aGljaCBjYW4gYmUgdXNlZCB0b1xuLy8gICAgICAgICBlbmFibGUgR29vZ2xlIFwiQUpBWCBDcmF3bGFibGUgbW9kZS5cIlxuLy8gMS4yLjEgLSAoMi8xNy8yMDEwKSBBY3R1YWxseSBmaXhlZCB0aGUgc3RhbGUgd2luZG93LmxvY2F0aW9uIFNhZmFyaSBidWcgZnJvbVxuLy8gICAgICAgICA8alF1ZXJ5IGhhc2hjaGFuZ2UgZXZlbnQ+IGluIEJCUSwgd2hpY2ggd2FzIHRoZSBtYWluIHJlYXNvbiBmb3IgdGhlXG4vLyAgICAgICAgIHByZXZpb3VzIHJlbGVhc2UhXG4vLyAxLjIgICAtICgyLzE2LzIwMTApIEludGVncmF0ZWQgPGpRdWVyeSBoYXNoY2hhbmdlIGV2ZW50PiB2MS4yLCB3aGljaCBmaXhlcyBhXG4vLyAgICAgICAgIFNhZmFyaSBidWcsIHRoZSBldmVudCBjYW4gbm93IGJlIGJvdW5kIGJlZm9yZSBET00gcmVhZHksIGFuZCBJRTYvN1xuLy8gICAgICAgICBwYWdlIHNob3VsZCBubyBsb25nZXIgc2Nyb2xsIHdoZW4gdGhlIGV2ZW50IGlzIGZpcnN0IGJvdW5kLiBBbHNvXG4vLyAgICAgICAgIGFkZGVkIHRoZSA8alF1ZXJ5LnBhcmFtLmZyYWdtZW50Lm5vRXNjYXBlPiBtZXRob2QsIGFuZCByZXdvcmtlZCB0aGVcbi8vICAgICAgICAgPGhhc2hjaGFuZ2UgZXZlbnQgKEJCUSk+IGludGVybmFsIFwiYWRkXCIgbWV0aG9kIHRvIGJlIGNvbXBhdGlibGUgd2l0aFxuLy8gICAgICAgICBjaGFuZ2VzIG1hZGUgdG8gdGhlIGpRdWVyeSAxLjQuMiBzcGVjaWFsIGV2ZW50cyBBUEkuXG4vLyAxLjEuMSAtICgxLzIyLzIwMTApIEludGVncmF0ZWQgPGpRdWVyeSBoYXNoY2hhbmdlIGV2ZW50PiB2MS4xLCB3aGljaCBmaXhlcyBhblxuLy8gICAgICAgICBvYnNjdXJlIElFOCBFbXVsYXRlSUU3IG1ldGEgdGFnIGNvbXBhdGliaWxpdHkgbW9kZSBidWcuXG4vLyAxLjEgICAtICgxLzkvMjAxMCkgQnJva2Ugb3V0IHRoZSBqUXVlcnkgQkJRIGV2ZW50LnNwZWNpYWwgPGhhc2hjaGFuZ2UgZXZlbnQ+XG4vLyAgICAgICAgIGZ1bmN0aW9uYWxpdHkgaW50byBhIHNlcGFyYXRlIHBsdWdpbiBmb3IgdXNlcnMgd2hvIHdhbnQganVzdCB0aGVcbi8vICAgICAgICAgYmFzaWMgZXZlbnQgJiBiYWNrIGJ1dHRvbiBzdXBwb3J0LCB3aXRob3V0IGFsbCB0aGUgZXh0cmEgYXdlc29tZW5lc3Ncbi8vICAgICAgICAgdGhhdCBCQlEgcHJvdmlkZXMuIFRoaXMgcGx1Z2luIHdpbGwgYmUgaW5jbHVkZWQgYXMgcGFydCBvZiBqUXVlcnkgQkJRLFxuLy8gICAgICAgICBidXQgYWxzbyBiZSBhdmFpbGFibGUgc2VwYXJhdGVseS4gU2VlIDxqUXVlcnkgaGFzaGNoYW5nZSBldmVudD5cbi8vICAgICAgICAgcGx1Z2luIGZvciBtb3JlIGluZm9ybWF0aW9uLiBBbHNvIGFkZGVkIHRoZSA8alF1ZXJ5LmJicS5yZW1vdmVTdGF0ZT5cbi8vICAgICAgICAgbWV0aG9kIGFuZCBhZGRlZCBhZGRpdGlvbmFsIDxqUXVlcnkuZGVwYXJhbT4gZXhhbXBsZXMuXG4vLyAxLjAuMyAtICgxMi8yLzIwMDkpIEZpeGVkIGFuIGlzc3VlIGluIElFIDYgd2hlcmUgbG9jYXRpb24uc2VhcmNoIGFuZFxuLy8gICAgICAgICBsb2NhdGlvbi5oYXNoIHdvdWxkIHJlcG9ydCBpbmNvcnJlY3RseSBpZiB0aGUgaGFzaCBjb250YWluZWQgdGhlID9cbi8vICAgICAgICAgY2hhcmFjdGVyLiBBbHNvIDxqUXVlcnkucGFyYW0ucXVlcnlzdHJpbmc+IGFuZCA8alF1ZXJ5LnBhcmFtLmZyYWdtZW50PlxuLy8gICAgICAgICB3aWxsIG5vIGxvbmdlciBwYXJzZSBwYXJhbXMgb3V0IG9mIGEgVVJMIHRoYXQgZG9lc24ndCBjb250YWluID8gb3IgIyxcbi8vICAgICAgICAgcmVzcGVjdGl2ZWx5LlxuLy8gMS4wLjIgLSAoMTAvMTAvMjAwOSkgRml4ZWQgYW4gaXNzdWUgaW4gSUUgNi83IHdoZXJlIHRoZSBoaWRkZW4gSUZSQU1FIGNhdXNlZFxuLy8gICAgICAgICBhIFwiVGhpcyBwYWdlIGNvbnRhaW5zIGJvdGggc2VjdXJlIGFuZCBub25zZWN1cmUgaXRlbXMuXCIgd2FybmluZyB3aGVuXG4vLyAgICAgICAgIHVzZWQgb24gYW4gaHR0cHM6Ly8gcGFnZS5cbi8vIDEuMC4xIC0gKDEwLzcvMjAwOSkgRml4ZWQgYW4gaXNzdWUgaW4gSUUgOC4gU2luY2UgYm90aCBcIklFN1wiIGFuZCBcIklFOFxuLy8gICAgICAgICBDb21wYXRpYmlsaXR5IFZpZXdcIiBtb2RlcyBlcnJvbmVvdXNseSByZXBvcnQgdGhhdCB0aGUgYnJvd3NlclxuLy8gICAgICAgICBzdXBwb3J0cyB0aGUgbmF0aXZlIHdpbmRvdy5vbmhhc2hjaGFuZ2UgZXZlbnQsIGEgc2xpZ2h0bHkgbW9yZVxuLy8gICAgICAgICByb2J1c3QgdGVzdCBuZWVkZWQgdG8gYmUgYWRkZWQuXG4vLyAxLjAgICAtICgxMC8yLzIwMDkpIEluaXRpYWwgcmVsZWFzZVxuXG4oZnVuY3Rpb24oJCx3aW5kb3cpe1xuICBjb25zb2xlLmluZm8oJ3llcyEnKVxuICAnJDpub211bmdlJzsgLy8gVXNlZCBieSBZVUkgY29tcHJlc3Nvci5cblxuICAvLyBTb21lIGNvbnZlbmllbnQgc2hvcnRjdXRzLlxuICB2YXIgdW5kZWZpbmVkLFxuICAgIGFwcyA9IEFycmF5LnByb3RvdHlwZS5zbGljZSxcbiAgICBkZWNvZGUgPSBkZWNvZGVVUklDb21wb25lbnQsXG5cbiAgICAvLyBNZXRob2QgLyBvYmplY3QgcmVmZXJlbmNlcy5cbiAgICBqcV9wYXJhbSA9ICQucGFyYW0sXG4gICAganFfcGFyYW1fc29ydGVkLFxuICAgIGpxX3BhcmFtX2ZyYWdtZW50LFxuICAgIGpxX2RlcGFyYW0sXG4gICAganFfZGVwYXJhbV9mcmFnbWVudCxcbiAgICBqcV9iYnEgPSAkLmJicSA9ICQuYmJxIHx8IHt9LFxuICAgIGpxX2JicV9wdXNoU3RhdGUsXG4gICAganFfYmJxX2dldFN0YXRlLFxuICAgIGpxX2VsZW1VcmxBdHRyLFxuICAgIHNwZWNpYWwgPSAkLmV2ZW50LnNwZWNpYWwsXG5cbiAgICAvLyBSZXVzZWQgc3RyaW5ncy5cbiAgICBzdHJfaGFzaGNoYW5nZSA9ICdoYXNoY2hhbmdlJyxcbiAgICBzdHJfcXVlcnlzdHJpbmcgPSAncXVlcnlzdHJpbmcnLFxuICAgIHN0cl9mcmFnbWVudCA9ICdmcmFnbWVudCcsXG4gICAgc3RyX2VsZW1VcmxBdHRyID0gJ2VsZW1VcmxBdHRyJyxcbiAgICBzdHJfaHJlZiA9ICdocmVmJyxcbiAgICBzdHJfc3JjID0gJ3NyYycsXG5cbiAgICAvLyBSZXVzZWQgUmVnRXhwLlxuICAgIHJlX3BhcmFtc19xdWVyeXN0cmluZyA9IC9eLipcXD98Iy4qJC9nLFxuICAgIHJlX3BhcmFtc19mcmFnbWVudCxcbiAgICByZV9mcmFnbWVudCxcbiAgICByZV9ub19lc2NhcGUsXG5cbiAgICBhamF4X2NyYXdsYWJsZSxcbiAgICBmcmFnbWVudF9wcmVmaXgsXG5cbiAgICAvLyBVc2VkIGJ5IGpRdWVyeS5lbGVtVXJsQXR0ci5cbiAgICBlbGVtVXJsQXR0cl9jYWNoZSA9IHt9O1xuXG4gIC8vIEEgZmV3IGNvbW1vbmx5IHVzZWQgYml0cywgYnJva2VuIG91dCB0byBoZWxwIHJlZHVjZSBtaW5pZmllZCBmaWxlIHNpemUuXG5cbiAgZnVuY3Rpb24gaXNfc3RyaW5nKCBhcmcgKSB7XG4gICAgcmV0dXJuIHR5cGVvZiBhcmcgPT09ICdzdHJpbmcnO1xuICB9O1xuXG4gIC8vIFdoeSB3cml0ZSB0aGUgc2FtZSBmdW5jdGlvbiB0d2ljZT8gTGV0J3MgY3VycnkhIE1tbW0sIGN1cnJ5Li5cblxuICBmdW5jdGlvbiBjdXJyeSggZnVuYyApIHtcbiAgICB2YXIgYXJncyA9IGFwcy5jYWxsKCBhcmd1bWVudHMsIDEgKTtcblxuICAgIHJldHVybiBmdW5jdGlvbigpIHtcbiAgICAgIHJldHVybiBmdW5jLmFwcGx5KCB0aGlzLCBhcmdzLmNvbmNhdCggYXBzLmNhbGwoIGFyZ3VtZW50cyApICkgKTtcbiAgICB9O1xuICB9O1xuXG4gIC8vIEdldCBsb2NhdGlvbi5oYXNoIChvciB3aGF0IHlvdSdkIGV4cGVjdCBsb2NhdGlvbi5oYXNoIHRvIGJlKSBzYW5zIGFueVxuICAvLyBsZWFkaW5nICMuIFRoYW5rcyBmb3IgbWFraW5nIHRoaXMgbmVjZXNzYXJ5LCBGaXJlZm94IVxuICBmdW5jdGlvbiBnZXRfZnJhZ21lbnQoIHVybCApIHtcbiAgICByZXR1cm4gdXJsLnJlcGxhY2UoIHJlX2ZyYWdtZW50LCAnJDInICk7XG4gIH07XG5cbiAgLy8gR2V0IGxvY2F0aW9uLnNlYXJjaCAob3Igd2hhdCB5b3UnZCBleHBlY3QgbG9jYXRpb24uc2VhcmNoIHRvIGJlKSBzYW5zIGFueVxuICAvLyBsZWFkaW5nICMuIFRoYW5rcyBmb3IgbWFraW5nIHRoaXMgbmVjZXNzYXJ5LCBJRTYhXG4gIGZ1bmN0aW9uIGdldF9xdWVyeXN0cmluZyggdXJsICkge1xuICAgIHJldHVybiB1cmwucmVwbGFjZSggLyg/Ol5bXj8jXSpcXD8oW14jXSopLiokKT8uKi8sICckMScgKTtcbiAgfTtcblxuICAvLyBTZWN0aW9uOiBQYXJhbSAodG8gc3RyaW5nKVxuICAvL1xuICAvLyBNZXRob2Q6IGpRdWVyeS5wYXJhbS5xdWVyeXN0cmluZ1xuICAvL1xuICAvLyBSZXRyaWV2ZSB0aGUgcXVlcnkgc3RyaW5nIGZyb20gYSBVUkwgb3IgaWYgbm8gYXJndW1lbnRzIGFyZSBwYXNzZWQsIHRoZVxuICAvLyBjdXJyZW50IHdpbmRvdy5sb2NhdGlvbi5ocmVmLlxuICAvL1xuICAvLyBVc2FnZTpcbiAgLy9cbiAgLy8gPiBqUXVlcnkucGFyYW0ucXVlcnlzdHJpbmcoIFsgdXJsIF0gKTtcbiAgLy9cbiAgLy8gQXJndW1lbnRzOlxuICAvL1xuICAvLyAgdXJsIC0gKFN0cmluZykgQSBVUkwgY29udGFpbmluZyBxdWVyeSBzdHJpbmcgcGFyYW1zIHRvIGJlIHBhcnNlZC4gSWYgdXJsXG4gIC8vICAgIGlzIG5vdCBwYXNzZWQsIHRoZSBjdXJyZW50IHdpbmRvdy5sb2NhdGlvbi5ocmVmIGlzIHVzZWQuXG4gIC8vXG4gIC8vIFJldHVybnM6XG4gIC8vXG4gIC8vICAoU3RyaW5nKSBUaGUgcGFyc2VkIHF1ZXJ5IHN0cmluZywgd2l0aCBhbnkgbGVhZGluZyBcIj9cIiByZW1vdmVkLlxuICAvL1xuXG4gIC8vIE1ldGhvZDogalF1ZXJ5LnBhcmFtLnF1ZXJ5c3RyaW5nIChidWlsZCB1cmwpXG4gIC8vXG4gIC8vIE1lcmdlIGEgVVJMLCB3aXRoIG9yIHdpdGhvdXQgcHJlLWV4aXN0aW5nIHF1ZXJ5IHN0cmluZyBwYXJhbXMsIHBsdXMgYW55XG4gIC8vIG9iamVjdCwgcGFyYW1zIHN0cmluZyBvciBVUkwgY29udGFpbmluZyBxdWVyeSBzdHJpbmcgcGFyYW1zIGludG8gYSBuZXcgVVJMLlxuICAvL1xuICAvLyBVc2FnZTpcbiAgLy9cbiAgLy8gPiBqUXVlcnkucGFyYW0ucXVlcnlzdHJpbmcoIHVybCwgcGFyYW1zIFssIG1lcmdlX21vZGUgXSApO1xuICAvL1xuICAvLyBBcmd1bWVudHM6XG4gIC8vXG4gIC8vICB1cmwgLSAoU3RyaW5nKSBBIHZhbGlkIFVSTCBmb3IgcGFyYW1zIHRvIGJlIG1lcmdlZCBpbnRvLiBUaGlzIFVSTCBtYXlcbiAgLy8gICAgY29udGFpbiBhIHF1ZXJ5IHN0cmluZyBhbmQvb3IgZnJhZ21lbnQgKGhhc2gpLlxuICAvLyAgcGFyYW1zIC0gKFN0cmluZykgQSBwYXJhbXMgc3RyaW5nIG9yIFVSTCBjb250YWluaW5nIHF1ZXJ5IHN0cmluZyBwYXJhbXMgdG9cbiAgLy8gICAgYmUgbWVyZ2VkIGludG8gdXJsLlxuICAvLyAgcGFyYW1zIC0gKE9iamVjdCkgQSBwYXJhbXMgb2JqZWN0IHRvIGJlIG1lcmdlZCBpbnRvIHVybC5cbiAgLy8gIG1lcmdlX21vZGUgLSAoTnVtYmVyKSBNZXJnZSBiZWhhdmlvciBkZWZhdWx0cyB0byAwIGlmIG1lcmdlX21vZGUgaXMgbm90XG4gIC8vICAgIHNwZWNpZmllZCwgYW5kIGlzIGFzLWZvbGxvd3M6XG4gIC8vXG4gIC8vICAgICogMDogcGFyYW1zIGluIHRoZSBwYXJhbXMgYXJndW1lbnQgd2lsbCBvdmVycmlkZSBhbnkgcXVlcnkgc3RyaW5nXG4gIC8vICAgICAgICAgcGFyYW1zIGluIHVybC5cbiAgLy8gICAgKiAxOiBhbnkgcXVlcnkgc3RyaW5nIHBhcmFtcyBpbiB1cmwgd2lsbCBvdmVycmlkZSBwYXJhbXMgaW4gdGhlIHBhcmFtc1xuICAvLyAgICAgICAgIGFyZ3VtZW50LlxuICAvLyAgICAqIDI6IHBhcmFtcyBhcmd1bWVudCB3aWxsIGNvbXBsZXRlbHkgcmVwbGFjZSBhbnkgcXVlcnkgc3RyaW5nIGluIHVybC5cbiAgLy9cbiAgLy8gUmV0dXJuczpcbiAgLy9cbiAgLy8gIChTdHJpbmcpIEEgVVJMIHdpdGggYSB1cmxlbmNvZGVkIHF1ZXJ5IHN0cmluZyBpbiB0aGUgZm9ybWF0ICc/YT1iJmM9ZCZlPWYnLlxuXG4gIC8vIE1ldGhvZDogalF1ZXJ5LnBhcmFtLmZyYWdtZW50XG4gIC8vXG4gIC8vIFJldHJpZXZlIHRoZSBmcmFnbWVudCAoaGFzaCkgZnJvbSBhIFVSTCBvciBpZiBubyBhcmd1bWVudHMgYXJlIHBhc3NlZCwgdGhlXG4gIC8vIGN1cnJlbnQgd2luZG93LmxvY2F0aW9uLmhyZWYuXG4gIC8vXG4gIC8vIFVzYWdlOlxuICAvL1xuICAvLyA+IGpRdWVyeS5wYXJhbS5mcmFnbWVudCggWyB1cmwgXSApO1xuICAvL1xuICAvLyBBcmd1bWVudHM6XG4gIC8vXG4gIC8vICB1cmwgLSAoU3RyaW5nKSBBIFVSTCBjb250YWluaW5nIGZyYWdtZW50IChoYXNoKSBwYXJhbXMgdG8gYmUgcGFyc2VkLiBJZlxuICAvLyAgICB1cmwgaXMgbm90IHBhc3NlZCwgdGhlIGN1cnJlbnQgd2luZG93LmxvY2F0aW9uLmhyZWYgaXMgdXNlZC5cbiAgLy9cbiAgLy8gUmV0dXJuczpcbiAgLy9cbiAgLy8gIChTdHJpbmcpIFRoZSBwYXJzZWQgZnJhZ21lbnQgKGhhc2gpIHN0cmluZywgd2l0aCBhbnkgbGVhZGluZyBcIiNcIiByZW1vdmVkLlxuXG4gIC8vIE1ldGhvZDogalF1ZXJ5LnBhcmFtLmZyYWdtZW50IChidWlsZCB1cmwpXG4gIC8vXG4gIC8vIE1lcmdlIGEgVVJMLCB3aXRoIG9yIHdpdGhvdXQgcHJlLWV4aXN0aW5nIGZyYWdtZW50IChoYXNoKSBwYXJhbXMsIHBsdXMgYW55XG4gIC8vIG9iamVjdCwgcGFyYW1zIHN0cmluZyBvciBVUkwgY29udGFpbmluZyBmcmFnbWVudCAoaGFzaCkgcGFyYW1zIGludG8gYSBuZXdcbiAgLy8gVVJMLlxuICAvL1xuICAvLyBVc2FnZTpcbiAgLy9cbiAgLy8gPiBqUXVlcnkucGFyYW0uZnJhZ21lbnQoIHVybCwgcGFyYW1zIFssIG1lcmdlX21vZGUgXSApO1xuICAvL1xuICAvLyBBcmd1bWVudHM6XG4gIC8vXG4gIC8vICB1cmwgLSAoU3RyaW5nKSBBIHZhbGlkIFVSTCBmb3IgcGFyYW1zIHRvIGJlIG1lcmdlZCBpbnRvLiBUaGlzIFVSTCBtYXlcbiAgLy8gICAgY29udGFpbiBhIHF1ZXJ5IHN0cmluZyBhbmQvb3IgZnJhZ21lbnQgKGhhc2gpLlxuICAvLyAgcGFyYW1zIC0gKFN0cmluZykgQSBwYXJhbXMgc3RyaW5nIG9yIFVSTCBjb250YWluaW5nIGZyYWdtZW50IChoYXNoKSBwYXJhbXNcbiAgLy8gICAgdG8gYmUgbWVyZ2VkIGludG8gdXJsLlxuICAvLyAgcGFyYW1zIC0gKE9iamVjdCkgQSBwYXJhbXMgb2JqZWN0IHRvIGJlIG1lcmdlZCBpbnRvIHVybC5cbiAgLy8gIG1lcmdlX21vZGUgLSAoTnVtYmVyKSBNZXJnZSBiZWhhdmlvciBkZWZhdWx0cyB0byAwIGlmIG1lcmdlX21vZGUgaXMgbm90XG4gIC8vICAgIHNwZWNpZmllZCwgYW5kIGlzIGFzLWZvbGxvd3M6XG4gIC8vXG4gIC8vICAgICogMDogcGFyYW1zIGluIHRoZSBwYXJhbXMgYXJndW1lbnQgd2lsbCBvdmVycmlkZSBhbnkgZnJhZ21lbnQgKGhhc2gpXG4gIC8vICAgICAgICAgcGFyYW1zIGluIHVybC5cbiAgLy8gICAgKiAxOiBhbnkgZnJhZ21lbnQgKGhhc2gpIHBhcmFtcyBpbiB1cmwgd2lsbCBvdmVycmlkZSBwYXJhbXMgaW4gdGhlXG4gIC8vICAgICAgICAgcGFyYW1zIGFyZ3VtZW50LlxuICAvLyAgICAqIDI6IHBhcmFtcyBhcmd1bWVudCB3aWxsIGNvbXBsZXRlbHkgcmVwbGFjZSBhbnkgcXVlcnkgc3RyaW5nIGluIHVybC5cbiAgLy9cbiAgLy8gUmV0dXJuczpcbiAgLy9cbiAgLy8gIChTdHJpbmcpIEEgVVJMIHdpdGggYSB1cmxlbmNvZGVkIGZyYWdtZW50IChoYXNoKSBpbiB0aGUgZm9ybWF0ICcjYT1iJmM9ZCZlPWYnLlxuXG4gIGZ1bmN0aW9uIGpxX3BhcmFtX3N1YiggaXNfZnJhZ21lbnQsIGdldF9mdW5jLCB1cmwsIHBhcmFtcywgbWVyZ2VfbW9kZSApIHtcbiAgICB2YXIgcmVzdWx0LFxuICAgICAgcXMsXG4gICAgICBtYXRjaGVzLFxuICAgICAgdXJsX3BhcmFtcyxcbiAgICAgIGhhc2g7XG5cbiAgICBpZiAoIHBhcmFtcyAhPT0gdW5kZWZpbmVkICkge1xuICAgICAgLy8gQnVpbGQgVVJMIGJ5IG1lcmdpbmcgcGFyYW1zIGludG8gdXJsIHN0cmluZy5cblxuICAgICAgLy8gbWF0Y2hlc1sxXSA9IHVybCBwYXJ0IHRoYXQgcHJlY2VkZXMgcGFyYW1zLCBub3QgaW5jbHVkaW5nIHRyYWlsaW5nID8vI1xuICAgICAgLy8gbWF0Y2hlc1syXSA9IHBhcmFtcywgbm90IGluY2x1ZGluZyBsZWFkaW5nID8vI1xuICAgICAgLy8gbWF0Y2hlc1szXSA9IGlmIGluICdxdWVyeXN0cmluZycgbW9kZSwgaGFzaCBpbmNsdWRpbmcgbGVhZGluZyAjLCBvdGhlcndpc2UgJydcbiAgICAgIG1hdGNoZXMgPSB1cmwubWF0Y2goIGlzX2ZyYWdtZW50ID8gcmVfZnJhZ21lbnQgOiAvXihbXiM/XSopXFw/PyhbXiNdKikoIz8uKikvICk7XG5cbiAgICAgIC8vIEdldCB0aGUgaGFzaCBpZiBpbiAncXVlcnlzdHJpbmcnIG1vZGUsIGFuZCBpdCBleGlzdHMuXG4gICAgICBoYXNoID0gbWF0Y2hlc1szXSB8fCAnJztcblxuICAgICAgaWYgKCBtZXJnZV9tb2RlID09PSAyICYmIGlzX3N0cmluZyggcGFyYW1zICkgKSB7XG4gICAgICAgIC8vIElmIG1lcmdlX21vZGUgaXMgMiBhbmQgcGFyYW1zIGlzIGEgc3RyaW5nLCBtZXJnZSB0aGUgZnJhZ21lbnQgLyBxdWVyeVxuICAgICAgICAvLyBzdHJpbmcgaW50byB0aGUgVVJMIHdob2xlc2FsZSwgd2l0aG91dCBjb252ZXJ0aW5nIGl0IGludG8gYW4gb2JqZWN0LlxuICAgICAgICBxcyA9IHBhcmFtcy5yZXBsYWNlKCBpc19mcmFnbWVudCA/IHJlX3BhcmFtc19mcmFnbWVudCA6IHJlX3BhcmFtc19xdWVyeXN0cmluZywgJycgKTtcblxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgLy8gQ29udmVydCByZWxldmFudCBwYXJhbXMgaW4gdXJsIHRvIG9iamVjdC5cbiAgICAgICAgdXJsX3BhcmFtcyA9IGpxX2RlcGFyYW0oIG1hdGNoZXNbMl0gKTtcblxuICAgICAgICBwYXJhbXMgPSBpc19zdHJpbmcoIHBhcmFtcyApXG5cbiAgICAgICAgICAvLyBDb252ZXJ0IHBhc3NlZCBwYXJhbXMgc3RyaW5nIGludG8gb2JqZWN0LlxuICAgICAgICAgID8ganFfZGVwYXJhbVsgaXNfZnJhZ21lbnQgPyBzdHJfZnJhZ21lbnQgOiBzdHJfcXVlcnlzdHJpbmcgXSggcGFyYW1zIClcblxuICAgICAgICAgIC8vIFBhc3NlZCBwYXJhbXMgb2JqZWN0LlxuICAgICAgICAgIDogcGFyYW1zO1xuXG4gICAgICAgIHFzID0gbWVyZ2VfbW9kZSA9PT0gMiA/IHBhcmFtcyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIHBhc3NlZCBwYXJhbXMgcmVwbGFjZSB1cmwgcGFyYW1zXG4gICAgICAgICAgOiBtZXJnZV9tb2RlID09PSAxICA/ICQuZXh0ZW5kKCB7fSwgcGFyYW1zLCB1cmxfcGFyYW1zICkgIC8vIHVybCBwYXJhbXMgb3ZlcnJpZGUgcGFzc2VkIHBhcmFtc1xuICAgICAgICAgIDogJC5leHRlbmQoIHt9LCB1cmxfcGFyYW1zLCBwYXJhbXMgKTsgICAgICAgICAgICAgICAgICAgICAvLyBwYXNzZWQgcGFyYW1zIG92ZXJyaWRlIHVybCBwYXJhbXNcblxuICAgICAgICAvLyBDb252ZXJ0IHBhcmFtcyBvYmplY3QgaW50byBhIHNvcnRlZCBwYXJhbXMgc3RyaW5nLlxuICAgICAgICBxcyA9IGpxX3BhcmFtX3NvcnRlZCggcXMgKTtcblxuICAgICAgICAvLyBVbmVzY2FwZSBjaGFyYWN0ZXJzIHNwZWNpZmllZCB2aWEgJC5wYXJhbS5ub0VzY2FwZS4gU2luY2Ugb25seSBoYXNoLVxuICAgICAgICAvLyBoaXN0b3J5IHVzZXJzIGhhdmUgcmVxdWVzdGVkIHRoaXMgZmVhdHVyZSwgaXQncyBvbmx5IGVuYWJsZWQgZm9yXG4gICAgICAgIC8vIGZyYWdtZW50LXJlbGF0ZWQgcGFyYW1zIHN0cmluZ3MuXG4gICAgICAgIGlmICggaXNfZnJhZ21lbnQgKSB7XG4gICAgICAgICAgcXMgPSBxcy5yZXBsYWNlKCByZV9ub19lc2NhcGUsIGRlY29kZSApO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIC8vIEJ1aWxkIFVSTCBmcm9tIHRoZSBiYXNlIHVybCwgcXVlcnlzdHJpbmcgYW5kIGhhc2guIEluICdxdWVyeXN0cmluZydcbiAgICAgIC8vIG1vZGUsID8gaXMgb25seSBhZGRlZCBpZiBhIHF1ZXJ5IHN0cmluZyBleGlzdHMuIEluICdmcmFnbWVudCcgbW9kZSwgI1xuICAgICAgLy8gaXMgYWx3YXlzIGFkZGVkLlxuICAgICAgcmVzdWx0ID0gbWF0Y2hlc1sxXSArICggaXNfZnJhZ21lbnQgPyBmcmFnbWVudF9wcmVmaXggOiBxcyB8fCAhbWF0Y2hlc1sxXSA/ICc/JyA6ICcnICkgKyBxcyArIGhhc2g7XG5cbiAgICB9IGVsc2Uge1xuICAgICAgLy8gSWYgVVJMIHdhcyBwYXNzZWQgaW4sIHBhcnNlIHBhcmFtcyBmcm9tIFVSTCBzdHJpbmcsIG90aGVyd2lzZSBwYXJzZVxuICAgICAgLy8gcGFyYW1zIGZyb20gd2luZG93LmxvY2F0aW9uLmhyZWYuXG4gICAgICByZXN1bHQgPSBnZXRfZnVuYyggdXJsICE9PSB1bmRlZmluZWQgPyB1cmwgOiBsb2NhdGlvbi5ocmVmICk7XG4gICAgfVxuXG4gICAgcmV0dXJuIHJlc3VsdDtcbiAgfTtcblxuICBqcV9wYXJhbVsgc3RyX3F1ZXJ5c3RyaW5nIF0gICAgICAgICAgICAgICAgICA9IGN1cnJ5KCBqcV9wYXJhbV9zdWIsIDAsIGdldF9xdWVyeXN0cmluZyApO1xuICBqcV9wYXJhbVsgc3RyX2ZyYWdtZW50IF0gPSBqcV9wYXJhbV9mcmFnbWVudCA9IGN1cnJ5KCBqcV9wYXJhbV9zdWIsIDEsIGdldF9mcmFnbWVudCApO1xuXG4gIC8vIE1ldGhvZDogalF1ZXJ5LnBhcmFtLnNvcnRlZFxuICAvL1xuICAvLyBSZXR1cm5zIGEgcGFyYW1zIHN0cmluZyBlcXVpdmFsZW50IHRvIHRoYXQgcmV0dXJuZWQgYnkgdGhlIGludGVybmFsXG4gIC8vIGpRdWVyeS5wYXJhbSBtZXRob2QsIGJ1dCBzb3J0ZWQsIHdoaWNoIG1ha2VzIGl0IHN1aXRhYmxlIGZvciB1c2UgYXMgYVxuICAvLyBjYWNoZSBrZXkuXG4gIC8vXG4gIC8vIEZvciBleGFtcGxlLCBpbiBtb3N0IGJyb3dzZXJzIGpRdWVyeS5wYXJhbSh7ejoxLGE6Mn0pIHJldHVybnMgXCJ6PTEmYT0yXCJcbiAgLy8gYW5kIGpRdWVyeS5wYXJhbSh7YToyLHo6MX0pIHJldHVybnMgXCJhPTImej0xXCIuIEV2ZW4gdGhvdWdoIGJvdGggdGhlXG4gIC8vIG9iamVjdHMgYmVpbmcgc2VyaWFsaXplZCBhbmQgdGhlIHJlc3VsdGluZyBwYXJhbXMgc3RyaW5ncyBhcmUgZXF1aXZhbGVudCxcbiAgLy8gaWYgdGhlc2UgcGFyYW1zIHN0cmluZ3Mgd2VyZSBzZXQgaW50byB0aGUgbG9jYXRpb24uaGFzaCBmcmFnbWVudFxuICAvLyBzZXF1ZW50aWFsbHksIHRoZSBoYXNoY2hhbmdlIGV2ZW50IHdvdWxkIGJlIHRyaWdnZXJlZCB1bm5lY2Vzc2FyaWx5LCBzaW5jZVxuICAvLyB0aGUgc3RyaW5ncyBhcmUgZGlmZmVyZW50IChldmVuIHRob3VnaCB0aGUgZGF0YSBkZXNjcmliZWQgYnkgdGhlbSBpcyB0aGVcbiAgLy8gc2FtZSkuIEJ5IHNvcnRpbmcgdGhlIHBhcmFtcyBzdHJpbmcsIHVuZWNlc3NhcnkgaGFzaGNoYW5nZSBldmVudCB0cmlnZ2VyaW5nXG4gIC8vIGNhbiBiZSBhdm9pZGVkLlxuICAvL1xuICAvLyBVc2FnZTpcbiAgLy9cbiAgLy8gPiBqUXVlcnkucGFyYW0uc29ydGVkKCBvYmogWywgdHJhZGl0aW9uYWwgXSApO1xuICAvL1xuICAvLyBBcmd1bWVudHM6XG4gIC8vXG4gIC8vICBvYmogLSAoT2JqZWN0KSBBbiBvYmplY3QgdG8gYmUgc2VyaWFsaXplZC5cbiAgLy8gIHRyYWRpdGlvbmFsIC0gKEJvb2xlYW4pIFBhcmFtcyBkZWVwL3NoYWxsb3cgc2VyaWFsaXphdGlvbiBtb2RlLiBTZWUgdGhlXG4gIC8vICAgIGRvY3VtZW50YXRpb24gYXQgaHR0cDovL2FwaS5qcXVlcnkuY29tL2pRdWVyeS5wYXJhbS8gZm9yIG1vcmUgZGV0YWlsLlxuICAvL1xuICAvLyBSZXR1cm5zOlxuICAvL1xuICAvLyAgKFN0cmluZykgQSBzb3J0ZWQgcGFyYW1zIHN0cmluZy5cblxuICBqcV9wYXJhbS5zb3J0ZWQgPSBqcV9wYXJhbV9zb3J0ZWQgPSBmdW5jdGlvbiggYSwgdHJhZGl0aW9uYWwgKSB7XG4gICAgdmFyIGFyciA9IFtdLFxuICAgICAgb2JqID0ge307XG5cbiAgICAkLmVhY2goIGpxX3BhcmFtKCBhLCB0cmFkaXRpb25hbCApLnNwbGl0KCAnJicgKSwgZnVuY3Rpb24oaSx2KXtcbiAgICAgIHZhciBrZXkgPSB2LnJlcGxhY2UoIC8oPzolNUJ8PSkuKiQvLCAnJyApLFxuICAgICAgICBrZXlfb2JqID0gb2JqWyBrZXkgXTtcblxuICAgICAgaWYgKCAha2V5X29iaiApIHtcbiAgICAgICAga2V5X29iaiA9IG9ialsga2V5IF0gPSBbXTtcbiAgICAgICAgYXJyLnB1c2goIGtleSApO1xuICAgICAgfVxuXG4gICAgICBrZXlfb2JqLnB1c2goIHYgKTtcbiAgICB9KTtcblxuICAgIHJldHVybiAkLm1hcCggYXJyLnNvcnQoKSwgZnVuY3Rpb24odil7XG4gICAgICByZXR1cm4gb2JqWyB2IF07XG4gICAgfSkuam9pbiggJyYnICk7XG4gIH07XG5cbiAgLy8gTWV0aG9kOiBqUXVlcnkucGFyYW0uZnJhZ21lbnQubm9Fc2NhcGVcbiAgLy9cbiAgLy8gU3BlY2lmeSBjaGFyYWN0ZXJzIHRoYXQgd2lsbCBiZSBsZWZ0IHVuZXNjYXBlZCB3aGVuIGZyYWdtZW50cyBhcmUgY3JlYXRlZFxuICAvLyBvciBtZXJnZWQgdXNpbmcgPGpRdWVyeS5wYXJhbS5mcmFnbWVudD4sIG9yIHdoZW4gdGhlIGZyYWdtZW50IGlzIG1vZGlmaWVkXG4gIC8vIHVzaW5nIDxqUXVlcnkuYmJxLnB1c2hTdGF0ZT4uIFRoaXMgb3B0aW9uIG9ubHkgYXBwbGllcyB0byBzZXJpYWxpemVkIGRhdGFcbiAgLy8gb2JqZWN0IGZyYWdtZW50cywgYW5kIG5vdCBzZXQtYXMtc3RyaW5nIGZyYWdtZW50cy4gRG9lcyBub3QgYWZmZWN0IHRoZVxuICAvLyBxdWVyeSBzdHJpbmcuIERlZmF1bHRzIHRvIFwiLC9cIiAoY29tbWEsIGZvcndhcmQgc2xhc2gpLlxuICAvL1xuICAvLyBOb3RlIHRoYXQgdGhpcyBpcyBjb25zaWRlcmVkIGEgcHVyZWx5IGFlc3RoZXRpYyBvcHRpb24sIGFuZCB3aWxsIGhlbHAgdG9cbiAgLy8gY3JlYXRlIFVSTHMgdGhhdCBcImxvb2sgcHJldHR5XCIgaW4gdGhlIGFkZHJlc3MgYmFyIG9yIGJvb2ttYXJrcywgd2l0aG91dFxuICAvLyBhZmZlY3RpbmcgZnVuY3Rpb25hbGl0eSBpbiBhbnkgd2F5LiBUaGF0IGJlaW5nIHNhaWQsIGJlIGNhcmVmdWwgdG8gbm90XG4gIC8vIHVuZXNjYXBlIGNoYXJhY3RlcnMgdGhhdCBhcmUgdXNlZCBhcyBkZWxpbWl0ZXJzIG9yIHNlcnZlIGEgc3BlY2lhbFxuICAvLyBwdXJwb3NlLCBzdWNoIGFzIHRoZSBcIiM/Jj0rXCIgKG9jdG90aG9ycGUsIHF1ZXN0aW9uIG1hcmssIGFtcGVyc2FuZCxcbiAgLy8gZXF1YWxzLCBwbHVzKSBjaGFyYWN0ZXJzLlxuICAvL1xuICAvLyBVc2FnZTpcbiAgLy9cbiAgLy8gPiBqUXVlcnkucGFyYW0uZnJhZ21lbnQubm9Fc2NhcGUoIFsgY2hhcnMgXSApO1xuICAvL1xuICAvLyBBcmd1bWVudHM6XG4gIC8vXG4gIC8vICBjaGFycyAtIChTdHJpbmcpIFRoZSBjaGFyYWN0ZXJzIHRvIG5vdCBlc2NhcGUgaW4gdGhlIGZyYWdtZW50LiBJZlxuICAvLyAgICB1bnNwZWNpZmllZCwgZGVmYXVsdHMgdG8gZW1wdHkgc3RyaW5nIChlc2NhcGUgYWxsIGNoYXJhY3RlcnMpLlxuICAvL1xuICAvLyBSZXR1cm5zOlxuICAvL1xuICAvLyAgTm90aGluZy5cblxuICBqcV9wYXJhbV9mcmFnbWVudC5ub0VzY2FwZSA9IGZ1bmN0aW9uKCBjaGFycyApIHtcbiAgICBjaGFycyA9IGNoYXJzIHx8ICcnO1xuICAgIHZhciBhcnIgPSAkLm1hcCggY2hhcnMuc3BsaXQoJycpLCBlbmNvZGVVUklDb21wb25lbnQgKTtcbiAgICByZV9ub19lc2NhcGUgPSBuZXcgUmVnRXhwKCBhcnIuam9pbignfCcpLCAnZycgKTtcbiAgfTtcblxuICAvLyBBIHNlbnNpYmxlIGRlZmF1bHQuIFRoZXNlIGFyZSB0aGUgY2hhcmFjdGVycyBwZW9wbGUgc2VlbSB0byBjb21wbGFpbiBhYm91dFxuICAvLyBcInVnbGlmeWluZyB1cCB0aGUgVVJMXCIgdGhlIG1vc3QuXG4gIGpxX3BhcmFtX2ZyYWdtZW50Lm5vRXNjYXBlKCAnLC8nICk7XG5cbiAgLy8gTWV0aG9kOiBqUXVlcnkucGFyYW0uZnJhZ21lbnQuYWpheENyYXdsYWJsZVxuICAvL1xuICAvLyBUT0RPOiBERVNDUklCRVxuICAvL1xuICAvLyBVc2FnZTpcbiAgLy9cbiAgLy8gPiBqUXVlcnkucGFyYW0uZnJhZ21lbnQuYWpheENyYXdsYWJsZSggWyBzdGF0ZSBdICk7XG4gIC8vXG4gIC8vIEFyZ3VtZW50czpcbiAgLy9cbiAgLy8gIHN0YXRlIC0gKEJvb2xlYW4pIFRPRE86IERFU0NSSUJFXG4gIC8vXG4gIC8vIFJldHVybnM6XG4gIC8vXG4gIC8vICAoQm9vbGVhbikgVGhlIGN1cnJlbnQgYWpheENyYXdsYWJsZSBzdGF0ZS5cblxuICBqcV9wYXJhbV9mcmFnbWVudC5hamF4Q3Jhd2xhYmxlID0gZnVuY3Rpb24oIHN0YXRlICkge1xuICAgIGlmICggc3RhdGUgIT09IHVuZGVmaW5lZCApIHtcbiAgICAgIGlmICggc3RhdGUgKSB7XG4gICAgICAgIHJlX3BhcmFtc19mcmFnbWVudCA9IC9eLiooPzojIXwjKS87XG4gICAgICAgIHJlX2ZyYWdtZW50ID0gL14oW14jXSopKD86IyF8Iyk/KC4qKSQvO1xuICAgICAgICBmcmFnbWVudF9wcmVmaXggPSAnIyEnO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcmVfcGFyYW1zX2ZyYWdtZW50ID0gL14uKiMvO1xuICAgICAgICByZV9mcmFnbWVudCA9IC9eKFteI10qKSM/KC4qKSQvO1xuICAgICAgICBmcmFnbWVudF9wcmVmaXggPSAnIyc7XG4gICAgICB9XG4gICAgICBhamF4X2NyYXdsYWJsZSA9ICEhc3RhdGU7XG4gICAgfVxuXG4gICAgcmV0dXJuIGFqYXhfY3Jhd2xhYmxlO1xuICB9O1xuXG4gIGpxX3BhcmFtX2ZyYWdtZW50LmFqYXhDcmF3bGFibGUoIDAgKTtcblxuICAvLyBTZWN0aW9uOiBEZXBhcmFtIChmcm9tIHN0cmluZylcbiAgLy9cbiAgLy8gTWV0aG9kOiBqUXVlcnkuZGVwYXJhbVxuICAvL1xuICAvLyBEZXNlcmlhbGl6ZSBhIHBhcmFtcyBzdHJpbmcgaW50byBhbiBvYmplY3QsIG9wdGlvbmFsbHkgY29lcmNpbmcgbnVtYmVycyxcbiAgLy8gYm9vbGVhbnMsIG51bGwgYW5kIHVuZGVmaW5lZCB2YWx1ZXM7IHRoaXMgbWV0aG9kIGlzIHRoZSBjb3VudGVycGFydCB0byB0aGVcbiAgLy8gaW50ZXJuYWwgalF1ZXJ5LnBhcmFtIG1ldGhvZC5cbiAgLy9cbiAgLy8gVXNhZ2U6XG4gIC8vXG4gIC8vID4galF1ZXJ5LmRlcGFyYW0oIHBhcmFtcyBbLCBjb2VyY2UgXSApO1xuICAvL1xuICAvLyBBcmd1bWVudHM6XG4gIC8vXG4gIC8vICBwYXJhbXMgLSAoU3RyaW5nKSBBIHBhcmFtcyBzdHJpbmcgdG8gYmUgcGFyc2VkLlxuICAvLyAgY29lcmNlIC0gKEJvb2xlYW4pIElmIHRydWUsIGNvZXJjZXMgYW55IG51bWJlcnMgb3IgdHJ1ZSwgZmFsc2UsIG51bGwsIGFuZFxuICAvLyAgICB1bmRlZmluZWQgdG8gdGhlaXIgYWN0dWFsIHZhbHVlLiBEZWZhdWx0cyB0byBmYWxzZSBpZiBvbWl0dGVkLlxuICAvL1xuICAvLyBSZXR1cm5zOlxuICAvL1xuICAvLyAgKE9iamVjdCkgQW4gb2JqZWN0IHJlcHJlc2VudGluZyB0aGUgZGVzZXJpYWxpemVkIHBhcmFtcyBzdHJpbmcuXG5cbiAgJC5kZXBhcmFtID0ganFfZGVwYXJhbSA9IGZ1bmN0aW9uKCBwYXJhbXMsIGNvZXJjZSApIHtcbiAgICB2YXIgb2JqID0ge30sXG4gICAgICBjb2VyY2VfdHlwZXMgPSB7ICd0cnVlJzogITAsICdmYWxzZSc6ICExLCAnbnVsbCc6IG51bGwgfTtcblxuICAgIC8vIEl0ZXJhdGUgb3ZlciBhbGwgbmFtZT12YWx1ZSBwYWlycy5cbiAgICAkLmVhY2goIHBhcmFtcy5yZXBsYWNlKCAvXFwrL2csICcgJyApLnNwbGl0KCAnJicgKSwgZnVuY3Rpb24oaix2KXtcbiAgICAgIHZhciBwYXJhbSA9IHYuc3BsaXQoICc9JyApLFxuICAgICAgICBrZXkgPSBkZWNvZGUoIHBhcmFtWzBdICksXG4gICAgICAgIHZhbCxcbiAgICAgICAgY3VyID0gb2JqLFxuICAgICAgICBpID0gMCxcblxuICAgICAgICAvLyBJZiBrZXkgaXMgbW9yZSBjb21wbGV4IHRoYW4gJ2ZvbycsIGxpa2UgJ2FbXScgb3IgJ2FbYl1bY10nLCBzcGxpdCBpdFxuICAgICAgICAvLyBpbnRvIGl0cyBjb21wb25lbnQgcGFydHMuXG4gICAgICAgIGtleXMgPSBrZXkuc3BsaXQoICddWycgKSxcbiAgICAgICAga2V5c19sYXN0ID0ga2V5cy5sZW5ndGggLSAxO1xuXG4gICAgICAvLyBJZiB0aGUgZmlyc3Qga2V5cyBwYXJ0IGNvbnRhaW5zIFsgYW5kIHRoZSBsYXN0IGVuZHMgd2l0aCBdLCB0aGVuIFtdXG4gICAgICAvLyBhcmUgY29ycmVjdGx5IGJhbGFuY2VkLlxuICAgICAgaWYgKCAvXFxbLy50ZXN0KCBrZXlzWzBdICkgJiYgL1xcXSQvLnRlc3QoIGtleXNbIGtleXNfbGFzdCBdICkgKSB7XG4gICAgICAgIC8vIFJlbW92ZSB0aGUgdHJhaWxpbmcgXSBmcm9tIHRoZSBsYXN0IGtleXMgcGFydC5cbiAgICAgICAga2V5c1sga2V5c19sYXN0IF0gPSBrZXlzWyBrZXlzX2xhc3QgXS5yZXBsYWNlKCAvXFxdJC8sICcnICk7XG5cbiAgICAgICAgLy8gU3BsaXQgZmlyc3Qga2V5cyBwYXJ0IGludG8gdHdvIHBhcnRzIG9uIHRoZSBbIGFuZCBhZGQgdGhlbSBiYWNrIG9udG9cbiAgICAgICAgLy8gdGhlIGJlZ2lubmluZyBvZiB0aGUga2V5cyBhcnJheS5cbiAgICAgICAga2V5cyA9IGtleXMuc2hpZnQoKS5zcGxpdCgnWycpLmNvbmNhdCgga2V5cyApO1xuXG4gICAgICAgIGtleXNfbGFzdCA9IGtleXMubGVuZ3RoIC0gMTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIC8vIEJhc2ljICdmb28nIHN0eWxlIGtleS5cbiAgICAgICAga2V5c19sYXN0ID0gMDtcbiAgICAgIH1cblxuICAgICAgLy8gQXJlIHdlIGRlYWxpbmcgd2l0aCBhIG5hbWU9dmFsdWUgcGFpciwgb3IganVzdCBhIG5hbWU/XG4gICAgICBpZiAoIHBhcmFtLmxlbmd0aCA9PT0gMiApIHtcbiAgICAgICAgdmFsID0gZGVjb2RlKCBwYXJhbVsxXSApO1xuXG4gICAgICAgIC8vIENvZXJjZSB2YWx1ZXMuXG4gICAgICAgIGlmICggY29lcmNlICkge1xuICAgICAgICAgIHZhbCA9IHZhbCAmJiAhaXNOYU4odmFsKSAgICAgICAgICAgID8gK3ZhbCAgICAgICAgICAgICAgLy8gbnVtYmVyXG4gICAgICAgICAgICA6IHZhbCA9PT0gJ3VuZGVmaW5lZCcgICAgICAgICAgICAgPyB1bmRlZmluZWQgICAgICAgICAvLyB1bmRlZmluZWRcbiAgICAgICAgICAgIDogY29lcmNlX3R5cGVzW3ZhbF0gIT09IHVuZGVmaW5lZCA/IGNvZXJjZV90eXBlc1t2YWxdIC8vIHRydWUsIGZhbHNlLCBudWxsXG4gICAgICAgICAgICA6IHZhbDsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBzdHJpbmdcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICgga2V5c19sYXN0ICkge1xuICAgICAgICAgIC8vIENvbXBsZXgga2V5LCBidWlsZCBkZWVwIG9iamVjdCBzdHJ1Y3R1cmUgYmFzZWQgb24gYSBmZXcgcnVsZXM6XG4gICAgICAgICAgLy8gKiBUaGUgJ2N1cicgcG9pbnRlciBzdGFydHMgYXQgdGhlIG9iamVjdCB0b3AtbGV2ZWwuXG4gICAgICAgICAgLy8gKiBbXSA9IGFycmF5IHB1c2ggKG4gaXMgc2V0IHRvIGFycmF5IGxlbmd0aCksIFtuXSA9IGFycmF5IGlmIG4gaXNcbiAgICAgICAgICAvLyAgIG51bWVyaWMsIG90aGVyd2lzZSBvYmplY3QuXG4gICAgICAgICAgLy8gKiBJZiBhdCB0aGUgbGFzdCBrZXlzIHBhcnQsIHNldCB0aGUgdmFsdWUuXG4gICAgICAgICAgLy8gKiBGb3IgZWFjaCBrZXlzIHBhcnQsIGlmIHRoZSBjdXJyZW50IGxldmVsIGlzIHVuZGVmaW5lZCBjcmVhdGUgYW5cbiAgICAgICAgICAvLyAgIG9iamVjdCBvciBhcnJheSBiYXNlZCBvbiB0aGUgdHlwZSBvZiB0aGUgbmV4dCBrZXlzIHBhcnQuXG4gICAgICAgICAgLy8gKiBNb3ZlIHRoZSAnY3VyJyBwb2ludGVyIHRvIHRoZSBuZXh0IGxldmVsLlxuICAgICAgICAgIC8vICogUmluc2UgJiByZXBlYXQuXG4gICAgICAgICAgZm9yICggOyBpIDw9IGtleXNfbGFzdDsgaSsrICkge1xuICAgICAgICAgICAga2V5ID0ga2V5c1tpXSA9PT0gJycgPyBjdXIubGVuZ3RoIDoga2V5c1tpXTtcbiAgICAgICAgICAgIGN1ciA9IGN1cltrZXldID0gaSA8IGtleXNfbGFzdFxuICAgICAgICAgICAgICA/IGN1cltrZXldIHx8ICgga2V5c1tpKzFdICYmIGlzTmFOKCBrZXlzW2krMV0gKSA/IHt9IDogW10gKVxuICAgICAgICAgICAgICA6IHZhbDtcbiAgICAgICAgICB9XG5cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAvLyBTaW1wbGUga2V5LCBldmVuIHNpbXBsZXIgcnVsZXMsIHNpbmNlIG9ubHkgc2NhbGFycyBhbmQgc2hhbGxvd1xuICAgICAgICAgIC8vIGFycmF5cyBhcmUgYWxsb3dlZC5cblxuICAgICAgICAgIGlmICggJC5pc0FycmF5KCBvYmpba2V5XSApICkge1xuICAgICAgICAgICAgLy8gdmFsIGlzIGFscmVhZHkgYW4gYXJyYXksIHNvIHB1c2ggb24gdGhlIG5leHQgdmFsdWUuXG4gICAgICAgICAgICBvYmpba2V5XS5wdXNoKCB2YWwgKTtcblxuICAgICAgICAgIH0gZWxzZSBpZiAoIG9ialtrZXldICE9PSB1bmRlZmluZWQgKSB7XG4gICAgICAgICAgICAvLyB2YWwgaXNuJ3QgYW4gYXJyYXksIGJ1dCBzaW5jZSBhIHNlY29uZCB2YWx1ZSBoYXMgYmVlbiBzcGVjaWZpZWQsXG4gICAgICAgICAgICAvLyBjb252ZXJ0IHZhbCBpbnRvIGFuIGFycmF5LlxuICAgICAgICAgICAgb2JqW2tleV0gPSBbIG9ialtrZXldLCB2YWwgXTtcblxuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAvLyB2YWwgaXMgYSBzY2FsYXIuXG4gICAgICAgICAgICBvYmpba2V5XSA9IHZhbDtcbiAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgfSBlbHNlIGlmICgga2V5ICkge1xuICAgICAgICAvLyBObyB2YWx1ZSB3YXMgZGVmaW5lZCwgc28gc2V0IHNvbWV0aGluZyBtZWFuaW5nZnVsLlxuICAgICAgICBvYmpba2V5XSA9IGNvZXJjZVxuICAgICAgICAgID8gdW5kZWZpbmVkXG4gICAgICAgICAgOiAnJztcbiAgICAgIH1cbiAgICB9KTtcblxuICAgIHJldHVybiBvYmo7XG4gIH07XG5cbiAgLy8gTWV0aG9kOiBqUXVlcnkuZGVwYXJhbS5xdWVyeXN0cmluZ1xuICAvL1xuICAvLyBQYXJzZSB0aGUgcXVlcnkgc3RyaW5nIGZyb20gYSBVUkwgb3IgdGhlIGN1cnJlbnQgd2luZG93LmxvY2F0aW9uLmhyZWYsXG4gIC8vIGRlc2VyaWFsaXppbmcgaXQgaW50byBhbiBvYmplY3QsIG9wdGlvbmFsbHkgY29lcmNpbmcgbnVtYmVycywgYm9vbGVhbnMsXG4gIC8vIG51bGwgYW5kIHVuZGVmaW5lZCB2YWx1ZXMuXG4gIC8vXG4gIC8vIFVzYWdlOlxuICAvL1xuICAvLyA+IGpRdWVyeS5kZXBhcmFtLnF1ZXJ5c3RyaW5nKCBbIHVybCBdIFssIGNvZXJjZSBdICk7XG4gIC8vXG4gIC8vIEFyZ3VtZW50czpcbiAgLy9cbiAgLy8gIHVybCAtIChTdHJpbmcpIEFuIG9wdGlvbmFsIHBhcmFtcyBzdHJpbmcgb3IgVVJMIGNvbnRhaW5pbmcgcXVlcnkgc3RyaW5nXG4gIC8vICAgIHBhcmFtcyB0byBiZSBwYXJzZWQuIElmIHVybCBpcyBvbWl0dGVkLCB0aGUgY3VycmVudFxuICAvLyAgICB3aW5kb3cubG9jYXRpb24uaHJlZiBpcyB1c2VkLlxuICAvLyAgY29lcmNlIC0gKEJvb2xlYW4pIElmIHRydWUsIGNvZXJjZXMgYW55IG51bWJlcnMgb3IgdHJ1ZSwgZmFsc2UsIG51bGwsIGFuZFxuICAvLyAgICB1bmRlZmluZWQgdG8gdGhlaXIgYWN0dWFsIHZhbHVlLiBEZWZhdWx0cyB0byBmYWxzZSBpZiBvbWl0dGVkLlxuICAvL1xuICAvLyBSZXR1cm5zOlxuICAvL1xuICAvLyAgKE9iamVjdCkgQW4gb2JqZWN0IHJlcHJlc2VudGluZyB0aGUgZGVzZXJpYWxpemVkIHBhcmFtcyBzdHJpbmcuXG5cbiAgLy8gTWV0aG9kOiBqUXVlcnkuZGVwYXJhbS5mcmFnbWVudFxuICAvL1xuICAvLyBQYXJzZSB0aGUgZnJhZ21lbnQgKGhhc2gpIGZyb20gYSBVUkwgb3IgdGhlIGN1cnJlbnQgd2luZG93LmxvY2F0aW9uLmhyZWYsXG4gIC8vIGRlc2VyaWFsaXppbmcgaXQgaW50byBhbiBvYmplY3QsIG9wdGlvbmFsbHkgY29lcmNpbmcgbnVtYmVycywgYm9vbGVhbnMsXG4gIC8vIG51bGwgYW5kIHVuZGVmaW5lZCB2YWx1ZXMuXG4gIC8vXG4gIC8vIFVzYWdlOlxuICAvL1xuICAvLyA+IGpRdWVyeS5kZXBhcmFtLmZyYWdtZW50KCBbIHVybCBdIFssIGNvZXJjZSBdICk7XG4gIC8vXG4gIC8vIEFyZ3VtZW50czpcbiAgLy9cbiAgLy8gIHVybCAtIChTdHJpbmcpIEFuIG9wdGlvbmFsIHBhcmFtcyBzdHJpbmcgb3IgVVJMIGNvbnRhaW5pbmcgZnJhZ21lbnQgKGhhc2gpXG4gIC8vICAgIHBhcmFtcyB0byBiZSBwYXJzZWQuIElmIHVybCBpcyBvbWl0dGVkLCB0aGUgY3VycmVudCB3aW5kb3cubG9jYXRpb24uaHJlZlxuICAvLyAgICBpcyB1c2VkLlxuICAvLyAgY29lcmNlIC0gKEJvb2xlYW4pIElmIHRydWUsIGNvZXJjZXMgYW55IG51bWJlcnMgb3IgdHJ1ZSwgZmFsc2UsIG51bGwsIGFuZFxuICAvLyAgICB1bmRlZmluZWQgdG8gdGhlaXIgYWN0dWFsIHZhbHVlLiBEZWZhdWx0cyB0byBmYWxzZSBpZiBvbWl0dGVkLlxuICAvL1xuICAvLyBSZXR1cm5zOlxuICAvL1xuICAvLyAgKE9iamVjdCkgQW4gb2JqZWN0IHJlcHJlc2VudGluZyB0aGUgZGVzZXJpYWxpemVkIHBhcmFtcyBzdHJpbmcuXG5cbiAgZnVuY3Rpb24ganFfZGVwYXJhbV9zdWIoIGlzX2ZyYWdtZW50LCB1cmxfb3JfcGFyYW1zLCBjb2VyY2UgKSB7XG4gICAgaWYgKCB1cmxfb3JfcGFyYW1zID09PSB1bmRlZmluZWQgfHwgdHlwZW9mIHVybF9vcl9wYXJhbXMgPT09ICdib29sZWFuJyApIHtcbiAgICAgIC8vIHVybF9vcl9wYXJhbXMgbm90IHNwZWNpZmllZC5cbiAgICAgIGNvZXJjZSA9IHVybF9vcl9wYXJhbXM7XG4gICAgICB1cmxfb3JfcGFyYW1zID0ganFfcGFyYW1bIGlzX2ZyYWdtZW50ID8gc3RyX2ZyYWdtZW50IDogc3RyX3F1ZXJ5c3RyaW5nIF0oKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdXJsX29yX3BhcmFtcyA9IGlzX3N0cmluZyggdXJsX29yX3BhcmFtcyApXG4gICAgICAgID8gdXJsX29yX3BhcmFtcy5yZXBsYWNlKCBpc19mcmFnbWVudCA/IHJlX3BhcmFtc19mcmFnbWVudCA6IHJlX3BhcmFtc19xdWVyeXN0cmluZywgJycgKVxuICAgICAgICA6IHVybF9vcl9wYXJhbXM7XG4gICAgfVxuXG4gICAgcmV0dXJuIGpxX2RlcGFyYW0oIHVybF9vcl9wYXJhbXMsIGNvZXJjZSApO1xuICB9O1xuXG4gIGpxX2RlcGFyYW1bIHN0cl9xdWVyeXN0cmluZyBdICAgICAgICAgICAgICAgICAgICA9IGN1cnJ5KCBqcV9kZXBhcmFtX3N1YiwgMCApO1xuICBqcV9kZXBhcmFtWyBzdHJfZnJhZ21lbnQgXSA9IGpxX2RlcGFyYW1fZnJhZ21lbnQgPSBjdXJyeSgganFfZGVwYXJhbV9zdWIsIDEgKTtcblxuICAvLyBTZWN0aW9uOiBFbGVtZW50IG1hbmlwdWxhdGlvblxuICAvL1xuICAvLyBNZXRob2Q6IGpRdWVyeS5lbGVtVXJsQXR0clxuICAvL1xuICAvLyBHZXQgdGhlIGludGVybmFsIFwiRGVmYXVsdCBVUkwgYXR0cmlidXRlIHBlciB0YWdcIiBsaXN0LCBvciBhdWdtZW50IHRoZSBsaXN0XG4gIC8vIHdpdGggYWRkaXRpb25hbCB0YWctYXR0cmlidXRlIHBhaXJzLCBpbiBjYXNlIHRoZSBkZWZhdWx0cyBhcmUgaW5zdWZmaWNpZW50LlxuICAvL1xuICAvLyBJbiB0aGUgPGpRdWVyeS5mbi5xdWVyeXN0cmluZz4gYW5kIDxqUXVlcnkuZm4uZnJhZ21lbnQ+IG1ldGhvZHMsIHRoaXMgbGlzdFxuICAvLyBpcyB1c2VkIHRvIGRldGVybWluZSB3aGljaCBhdHRyaWJ1dGUgY29udGFpbnMgdGhlIFVSTCB0byBiZSBtb2RpZmllZCwgaWZcbiAgLy8gYW4gXCJhdHRyXCIgcGFyYW0gaXMgbm90IHNwZWNpZmllZC5cbiAgLy9cbiAgLy8gRGVmYXVsdCBUYWctQXR0cmlidXRlIExpc3Q6XG4gIC8vXG4gIC8vICBhICAgICAgLSBocmVmXG4gIC8vICBiYXNlICAgLSBocmVmXG4gIC8vICBpZnJhbWUgLSBzcmNcbiAgLy8gIGltZyAgICAtIHNyY1xuICAvLyAgaW5wdXQgIC0gc3JjXG4gIC8vICBmb3JtICAgLSBhY3Rpb25cbiAgLy8gIGxpbmsgICAtIGhyZWZcbiAgLy8gIHNjcmlwdCAtIHNyY1xuICAvL1xuICAvLyBVc2FnZTpcbiAgLy9cbiAgLy8gPiBqUXVlcnkuZWxlbVVybEF0dHIoIFsgdGFnX2F0dHIgXSApO1xuICAvL1xuICAvLyBBcmd1bWVudHM6XG4gIC8vXG4gIC8vICB0YWdfYXR0ciAtIChPYmplY3QpIEFuIG9iamVjdCBjb250YWluaW5nIGEgbGlzdCBvZiB0YWcgbmFtZXMgYW5kIHRoZWlyXG4gIC8vICAgIGFzc29jaWF0ZWQgZGVmYXVsdCBhdHRyaWJ1dGUgbmFtZXMgaW4gdGhlIGZvcm1hdCB7IHRhZzogJ2F0dHInLCAuLi4gfSB0b1xuICAvLyAgICBiZSBtZXJnZWQgaW50byB0aGUgaW50ZXJuYWwgdGFnLWF0dHJpYnV0ZSBsaXN0LlxuICAvL1xuICAvLyBSZXR1cm5zOlxuICAvL1xuICAvLyAgKE9iamVjdCkgQW4gb2JqZWN0IGNvbnRhaW5pbmcgYWxsIHN0b3JlZCB0YWctYXR0cmlidXRlIHZhbHVlcy5cblxuICAvLyBPbmx5IGRlZmluZSBmdW5jdGlvbiBhbmQgc2V0IGRlZmF1bHRzIGlmIGZ1bmN0aW9uIGRvZXNuJ3QgYWxyZWFkeSBleGlzdCwgYXNcbiAgLy8gdGhlIHVybEludGVybmFsIHBsdWdpbiB3aWxsIHByb3ZpZGUgdGhpcyBtZXRob2QgYXMgd2VsbC5cbiAgJFsgc3RyX2VsZW1VcmxBdHRyIF0gfHwgKCRbIHN0cl9lbGVtVXJsQXR0ciBdID0gZnVuY3Rpb24oIG9iaiApIHtcbiAgICByZXR1cm4gJC5leHRlbmQoIGVsZW1VcmxBdHRyX2NhY2hlLCBvYmogKTtcbiAgfSkoe1xuICAgIGE6IHN0cl9ocmVmLFxuICAgIGJhc2U6IHN0cl9ocmVmLFxuICAgIGlmcmFtZTogc3RyX3NyYyxcbiAgICBpbWc6IHN0cl9zcmMsXG4gICAgaW5wdXQ6IHN0cl9zcmMsXG4gICAgZm9ybTogJ2FjdGlvbicsXG4gICAgbGluazogc3RyX2hyZWYsXG4gICAgc2NyaXB0OiBzdHJfc3JjXG4gIH0pO1xuXG4gIGpxX2VsZW1VcmxBdHRyID0gJFsgc3RyX2VsZW1VcmxBdHRyIF07XG5cbiAgLy8gTWV0aG9kOiBqUXVlcnkuZm4ucXVlcnlzdHJpbmdcbiAgLy9cbiAgLy8gVXBkYXRlIFVSTCBhdHRyaWJ1dGUgaW4gb25lIG9yIG1vcmUgZWxlbWVudHMsIG1lcmdpbmcgdGhlIGN1cnJlbnQgVVJMICh3aXRoXG4gIC8vIG9yIHdpdGhvdXQgcHJlLWV4aXN0aW5nIHF1ZXJ5IHN0cmluZyBwYXJhbXMpIHBsdXMgYW55IHBhcmFtcyBvYmplY3Qgb3JcbiAgLy8gc3RyaW5nIGludG8gYSBuZXcgVVJMLCB3aGljaCBpcyB0aGVuIHNldCBpbnRvIHRoYXQgYXR0cmlidXRlLiBMaWtlXG4gIC8vIDxqUXVlcnkucGFyYW0ucXVlcnlzdHJpbmcgKGJ1aWxkIHVybCk+LCBidXQgZm9yIGFsbCBlbGVtZW50cyBpbiBhIGpRdWVyeVxuICAvLyBjb2xsZWN0aW9uLlxuICAvL1xuICAvLyBVc2FnZTpcbiAgLy9cbiAgLy8gPiBqUXVlcnkoJ3NlbGVjdG9yJykucXVlcnlzdHJpbmcoIFsgYXR0ciwgXSBwYXJhbXMgWywgbWVyZ2VfbW9kZSBdICk7XG4gIC8vXG4gIC8vIEFyZ3VtZW50czpcbiAgLy9cbiAgLy8gIGF0dHIgLSAoU3RyaW5nKSBPcHRpb25hbCBuYW1lIG9mIGFuIGF0dHJpYnV0ZSB0aGF0IHdpbGwgY29udGFpbiBhIFVSTCB0b1xuICAvLyAgICBtZXJnZSBwYXJhbXMgb3IgdXJsIGludG8uIFNlZSA8alF1ZXJ5LmVsZW1VcmxBdHRyPiBmb3IgYSBsaXN0IG9mIGRlZmF1bHRcbiAgLy8gICAgYXR0cmlidXRlcy5cbiAgLy8gIHBhcmFtcyAtIChPYmplY3QpIEEgcGFyYW1zIG9iamVjdCB0byBiZSBtZXJnZWQgaW50byB0aGUgVVJMIGF0dHJpYnV0ZS5cbiAgLy8gIHBhcmFtcyAtIChTdHJpbmcpIEEgVVJMIGNvbnRhaW5pbmcgcXVlcnkgc3RyaW5nIHBhcmFtcywgb3IgcGFyYW1zIHN0cmluZ1xuICAvLyAgICB0byBiZSBtZXJnZWQgaW50byB0aGUgVVJMIGF0dHJpYnV0ZS5cbiAgLy8gIG1lcmdlX21vZGUgLSAoTnVtYmVyKSBNZXJnZSBiZWhhdmlvciBkZWZhdWx0cyB0byAwIGlmIG1lcmdlX21vZGUgaXMgbm90XG4gIC8vICAgIHNwZWNpZmllZCwgYW5kIGlzIGFzLWZvbGxvd3M6XG4gIC8vXG4gIC8vICAgICogMDogcGFyYW1zIGluIHRoZSBwYXJhbXMgYXJndW1lbnQgd2lsbCBvdmVycmlkZSBhbnkgcGFyYW1zIGluIGF0dHIgVVJMLlxuICAvLyAgICAqIDE6IGFueSBwYXJhbXMgaW4gYXR0ciBVUkwgd2lsbCBvdmVycmlkZSBwYXJhbXMgaW4gdGhlIHBhcmFtcyBhcmd1bWVudC5cbiAgLy8gICAgKiAyOiBwYXJhbXMgYXJndW1lbnQgd2lsbCBjb21wbGV0ZWx5IHJlcGxhY2UgYW55IHF1ZXJ5IHN0cmluZyBpbiBhdHRyXG4gIC8vICAgICAgICAgVVJMLlxuICAvL1xuICAvLyBSZXR1cm5zOlxuICAvL1xuICAvLyAgKGpRdWVyeSkgVGhlIGluaXRpYWwgalF1ZXJ5IGNvbGxlY3Rpb24gb2YgZWxlbWVudHMsIGJ1dCB3aXRoIG1vZGlmaWVkIFVSTFxuICAvLyAgYXR0cmlidXRlIHZhbHVlcy5cblxuICAvLyBNZXRob2Q6IGpRdWVyeS5mbi5mcmFnbWVudFxuICAvL1xuICAvLyBVcGRhdGUgVVJMIGF0dHJpYnV0ZSBpbiBvbmUgb3IgbW9yZSBlbGVtZW50cywgbWVyZ2luZyB0aGUgY3VycmVudCBVUkwgKHdpdGhcbiAgLy8gb3Igd2l0aG91dCBwcmUtZXhpc3RpbmcgZnJhZ21lbnQvaGFzaCBwYXJhbXMpIHBsdXMgYW55IHBhcmFtcyBvYmplY3Qgb3JcbiAgLy8gc3RyaW5nIGludG8gYSBuZXcgVVJMLCB3aGljaCBpcyB0aGVuIHNldCBpbnRvIHRoYXQgYXR0cmlidXRlLiBMaWtlXG4gIC8vIDxqUXVlcnkucGFyYW0uZnJhZ21lbnQgKGJ1aWxkIHVybCk+LCBidXQgZm9yIGFsbCBlbGVtZW50cyBpbiBhIGpRdWVyeVxuICAvLyBjb2xsZWN0aW9uLlxuICAvL1xuICAvLyBVc2FnZTpcbiAgLy9cbiAgLy8gPiBqUXVlcnkoJ3NlbGVjdG9yJykuZnJhZ21lbnQoIFsgYXR0ciwgXSBwYXJhbXMgWywgbWVyZ2VfbW9kZSBdICk7XG4gIC8vXG4gIC8vIEFyZ3VtZW50czpcbiAgLy9cbiAgLy8gIGF0dHIgLSAoU3RyaW5nKSBPcHRpb25hbCBuYW1lIG9mIGFuIGF0dHJpYnV0ZSB0aGF0IHdpbGwgY29udGFpbiBhIFVSTCB0b1xuICAvLyAgICBtZXJnZSBwYXJhbXMgaW50by4gU2VlIDxqUXVlcnkuZWxlbVVybEF0dHI+IGZvciBhIGxpc3Qgb2YgZGVmYXVsdFxuICAvLyAgICBhdHRyaWJ1dGVzLlxuICAvLyAgcGFyYW1zIC0gKE9iamVjdCkgQSBwYXJhbXMgb2JqZWN0IHRvIGJlIG1lcmdlZCBpbnRvIHRoZSBVUkwgYXR0cmlidXRlLlxuICAvLyAgcGFyYW1zIC0gKFN0cmluZykgQSBVUkwgY29udGFpbmluZyBmcmFnbWVudCAoaGFzaCkgcGFyYW1zLCBvciBwYXJhbXNcbiAgLy8gICAgc3RyaW5nIHRvIGJlIG1lcmdlZCBpbnRvIHRoZSBVUkwgYXR0cmlidXRlLlxuICAvLyAgbWVyZ2VfbW9kZSAtIChOdW1iZXIpIE1lcmdlIGJlaGF2aW9yIGRlZmF1bHRzIHRvIDAgaWYgbWVyZ2VfbW9kZSBpcyBub3RcbiAgLy8gICAgc3BlY2lmaWVkLCBhbmQgaXMgYXMtZm9sbG93czpcbiAgLy9cbiAgLy8gICAgKiAwOiBwYXJhbXMgaW4gdGhlIHBhcmFtcyBhcmd1bWVudCB3aWxsIG92ZXJyaWRlIGFueSBwYXJhbXMgaW4gYXR0ciBVUkwuXG4gIC8vICAgICogMTogYW55IHBhcmFtcyBpbiBhdHRyIFVSTCB3aWxsIG92ZXJyaWRlIHBhcmFtcyBpbiB0aGUgcGFyYW1zIGFyZ3VtZW50LlxuICAvLyAgICAqIDI6IHBhcmFtcyBhcmd1bWVudCB3aWxsIGNvbXBsZXRlbHkgcmVwbGFjZSBhbnkgZnJhZ21lbnQgKGhhc2gpIGluIGF0dHJcbiAgLy8gICAgICAgICBVUkwuXG4gIC8vXG4gIC8vIFJldHVybnM6XG4gIC8vXG4gIC8vICAoalF1ZXJ5KSBUaGUgaW5pdGlhbCBqUXVlcnkgY29sbGVjdGlvbiBvZiBlbGVtZW50cywgYnV0IHdpdGggbW9kaWZpZWQgVVJMXG4gIC8vICBhdHRyaWJ1dGUgdmFsdWVzLlxuXG4gIGZ1bmN0aW9uIGpxX2ZuX3N1YiggbW9kZSwgZm9yY2VfYXR0ciwgcGFyYW1zLCBtZXJnZV9tb2RlICkge1xuICAgIGlmICggIWlzX3N0cmluZyggcGFyYW1zICkgJiYgdHlwZW9mIHBhcmFtcyAhPT0gJ29iamVjdCcgKSB7XG4gICAgICAvLyBmb3JjZV9hdHRyIG5vdCBzcGVjaWZpZWQuXG4gICAgICBtZXJnZV9tb2RlID0gcGFyYW1zO1xuICAgICAgcGFyYW1zID0gZm9yY2VfYXR0cjtcbiAgICAgIGZvcmNlX2F0dHIgPSB1bmRlZmluZWQ7XG4gICAgfVxuXG4gICAgcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbigpe1xuICAgICAgdmFyIHRoYXQgPSAkKHRoaXMpLFxuXG4gICAgICAgIC8vIEdldCBhdHRyaWJ1dGUgc3BlY2lmaWVkLCBvciBkZWZhdWx0IHNwZWNpZmllZCB2aWEgJC5lbGVtVXJsQXR0ci5cbiAgICAgICAgYXR0ciA9IGZvcmNlX2F0dHIgfHwganFfZWxlbVVybEF0dHIoKVsgKCB0aGlzLm5vZGVOYW1lIHx8ICcnICkudG9Mb3dlckNhc2UoKSBdIHx8ICcnLFxuXG4gICAgICAgIC8vIEdldCBVUkwgdmFsdWUuXG4gICAgICAgIHVybCA9IGF0dHIgJiYgdGhhdC5hdHRyKCBhdHRyICkgfHwgJyc7XG5cbiAgICAgIC8vIFVwZGF0ZSBhdHRyaWJ1dGUgd2l0aCBuZXcgVVJMLlxuICAgICAgdGhhdC5hdHRyKCBhdHRyLCBqcV9wYXJhbVsgbW9kZSBdKCB1cmwsIHBhcmFtcywgbWVyZ2VfbW9kZSApICk7XG4gICAgfSk7XG5cbiAgfTtcblxuICAkLmZuWyBzdHJfcXVlcnlzdHJpbmcgXSA9IGN1cnJ5KCBqcV9mbl9zdWIsIHN0cl9xdWVyeXN0cmluZyApO1xuICAkLmZuWyBzdHJfZnJhZ21lbnQgXSAgICA9IGN1cnJ5KCBqcV9mbl9zdWIsIHN0cl9mcmFnbWVudCApO1xuXG4gIC8vIFNlY3Rpb246IEhpc3RvcnksIGhhc2hjaGFuZ2UgZXZlbnRcbiAgLy9cbiAgLy8gTWV0aG9kOiBqUXVlcnkuYmJxLnB1c2hTdGF0ZVxuICAvL1xuICAvLyBBZGRzIGEgJ3N0YXRlJyBpbnRvIHRoZSBicm93c2VyIGhpc3RvcnkgYXQgdGhlIGN1cnJlbnQgcG9zaXRpb24sIHNldHRpbmdcbiAgLy8gbG9jYXRpb24uaGFzaCBhbmQgdHJpZ2dlcmluZyBhbnkgYm91bmQgPGhhc2hjaGFuZ2UgZXZlbnQ+IGNhbGxiYWNrc1xuICAvLyAocHJvdmlkZWQgdGhlIG5ldyBzdGF0ZSBpcyBkaWZmZXJlbnQgdGhhbiB0aGUgcHJldmlvdXMgc3RhdGUpLlxuICAvL1xuICAvLyBJZiBubyBhcmd1bWVudHMgYXJlIHBhc3NlZCwgYW4gZW1wdHkgc3RhdGUgaXMgY3JlYXRlZCwgd2hpY2ggaXMganVzdCBhXG4gIC8vIHNob3J0Y3V0IGZvciBqUXVlcnkuYmJxLnB1c2hTdGF0ZSgge30sIDIgKS5cbiAgLy9cbiAgLy8gVXNhZ2U6XG4gIC8vXG4gIC8vID4galF1ZXJ5LmJicS5wdXNoU3RhdGUoIFsgcGFyYW1zIFssIG1lcmdlX21vZGUgXSBdICk7XG4gIC8vXG4gIC8vIEFyZ3VtZW50czpcbiAgLy9cbiAgLy8gIHBhcmFtcyAtIChTdHJpbmcpIEEgc2VyaWFsaXplZCBwYXJhbXMgc3RyaW5nIG9yIGEgaGFzaCBzdHJpbmcgYmVnaW5uaW5nXG4gIC8vICAgIHdpdGggIyB0byBtZXJnZSBpbnRvIGxvY2F0aW9uLmhhc2guXG4gIC8vICBwYXJhbXMgLSAoT2JqZWN0KSBBIHBhcmFtcyBvYmplY3QgdG8gbWVyZ2UgaW50byBsb2NhdGlvbi5oYXNoLlxuICAvLyAgbWVyZ2VfbW9kZSAtIChOdW1iZXIpIE1lcmdlIGJlaGF2aW9yIGRlZmF1bHRzIHRvIDAgaWYgbWVyZ2VfbW9kZSBpcyBub3RcbiAgLy8gICAgc3BlY2lmaWVkICh1bmxlc3MgYSBoYXNoIHN0cmluZyBiZWdpbm5pbmcgd2l0aCAjIGlzIHNwZWNpZmllZCwgaW4gd2hpY2hcbiAgLy8gICAgY2FzZSBtZXJnZSBiZWhhdmlvciBkZWZhdWx0cyB0byAyKSwgYW5kIGlzIGFzLWZvbGxvd3M6XG4gIC8vXG4gIC8vICAgICogMDogcGFyYW1zIGluIHRoZSBwYXJhbXMgYXJndW1lbnQgd2lsbCBvdmVycmlkZSBhbnkgcGFyYW1zIGluIHRoZVxuICAvLyAgICAgICAgIGN1cnJlbnQgc3RhdGUuXG4gIC8vICAgICogMTogYW55IHBhcmFtcyBpbiB0aGUgY3VycmVudCBzdGF0ZSB3aWxsIG92ZXJyaWRlIHBhcmFtcyBpbiB0aGUgcGFyYW1zXG4gIC8vICAgICAgICAgYXJndW1lbnQuXG4gIC8vICAgICogMjogcGFyYW1zIGFyZ3VtZW50IHdpbGwgY29tcGxldGVseSByZXBsYWNlIGN1cnJlbnQgc3RhdGUuXG4gIC8vXG4gIC8vIFJldHVybnM6XG4gIC8vXG4gIC8vICBOb3RoaW5nLlxuICAvL1xuICAvLyBBZGRpdGlvbmFsIE5vdGVzOlxuICAvL1xuICAvLyAgKiBTZXR0aW5nIGFuIGVtcHR5IHN0YXRlIG1heSBjYXVzZSB0aGUgYnJvd3NlciB0byBzY3JvbGwuXG4gIC8vICAqIFVubGlrZSB0aGUgZnJhZ21lbnQgYW5kIHF1ZXJ5c3RyaW5nIG1ldGhvZHMsIGlmIGEgaGFzaCBzdHJpbmcgYmVnaW5uaW5nXG4gIC8vICAgIHdpdGggIyBpcyBzcGVjaWZpZWQgYXMgdGhlIHBhcmFtcyBhZ3J1bWVudCwgbWVyZ2VfbW9kZSBkZWZhdWx0cyB0byAyLlxuXG4gIGpxX2JicS5wdXNoU3RhdGUgPSBqcV9iYnFfcHVzaFN0YXRlID0gZnVuY3Rpb24oIHBhcmFtcywgbWVyZ2VfbW9kZSApIHtcbiAgICBpZiAoIGlzX3N0cmluZyggcGFyYW1zICkgJiYgL14jLy50ZXN0KCBwYXJhbXMgKSAmJiBtZXJnZV9tb2RlID09PSB1bmRlZmluZWQgKSB7XG4gICAgICAvLyBQYXJhbXMgc3RyaW5nIGJlZ2lucyB3aXRoICMgYW5kIG1lcmdlX21vZGUgbm90IHNwZWNpZmllZCwgc28gY29tcGxldGVseVxuICAgICAgLy8gb3ZlcndyaXRlIHdpbmRvdy5sb2NhdGlvbi5oYXNoLlxuICAgICAgbWVyZ2VfbW9kZSA9IDI7XG4gICAgfVxuXG4gICAgdmFyIGhhc19hcmdzID0gcGFyYW1zICE9PSB1bmRlZmluZWQsXG4gICAgICAvLyBNZXJnZSBwYXJhbXMgaW50byB3aW5kb3cubG9jYXRpb24gdXNpbmcgJC5wYXJhbS5mcmFnbWVudC5cbiAgICAgIHVybCA9IGpxX3BhcmFtX2ZyYWdtZW50KCBsb2NhdGlvbi5ocmVmLFxuICAgICAgICBoYXNfYXJncyA/IHBhcmFtcyA6IHt9LCBoYXNfYXJncyA/IG1lcmdlX21vZGUgOiAyICk7XG5cbiAgICAvLyBTZXQgbmV3IHdpbmRvdy5sb2NhdGlvbi5ocmVmLiBOb3RlIHRoYXQgU2FmYXJpIDMgJiBDaHJvbWUgYmFyZiBvblxuICAgIC8vIGxvY2F0aW9uLmhhc2ggPSAnIycgc28gdGhlIGVudGlyZSBVUkwgaXMgc2V0LlxuICAgIGxvY2F0aW9uLmhyZWYgPSB1cmw7XG4gIH07XG5cbiAgLy8gTWV0aG9kOiBqUXVlcnkuYmJxLmdldFN0YXRlXG4gIC8vXG4gIC8vIFJldHJpZXZlcyB0aGUgY3VycmVudCAnc3RhdGUnIGZyb20gdGhlIGJyb3dzZXIgaGlzdG9yeSwgcGFyc2luZ1xuICAvLyBsb2NhdGlvbi5oYXNoIGZvciBhIHNwZWNpZmljIGtleSBvciByZXR1cm5pbmcgYW4gb2JqZWN0IGNvbnRhaW5pbmcgdGhlXG4gIC8vIGVudGlyZSBzdGF0ZSwgb3B0aW9uYWxseSBjb2VyY2luZyBudW1iZXJzLCBib29sZWFucywgbnVsbCBhbmQgdW5kZWZpbmVkXG4gIC8vIHZhbHVlcy5cbiAgLy9cbiAgLy8gVXNhZ2U6XG4gIC8vXG4gIC8vID4galF1ZXJ5LmJicS5nZXRTdGF0ZSggWyBrZXkgXSBbLCBjb2VyY2UgXSApO1xuICAvL1xuICAvLyBBcmd1bWVudHM6XG4gIC8vXG4gIC8vICBrZXkgLSAoU3RyaW5nKSBBbiBvcHRpb25hbCBzdGF0ZSBrZXkgZm9yIHdoaWNoIHRvIHJldHVybiBhIHZhbHVlLlxuICAvLyAgY29lcmNlIC0gKEJvb2xlYW4pIElmIHRydWUsIGNvZXJjZXMgYW55IG51bWJlcnMgb3IgdHJ1ZSwgZmFsc2UsIG51bGwsIGFuZFxuICAvLyAgICB1bmRlZmluZWQgdG8gdGhlaXIgYWN0dWFsIHZhbHVlLiBEZWZhdWx0cyB0byBmYWxzZS5cbiAgLy9cbiAgLy8gUmV0dXJuczpcbiAgLy9cbiAgLy8gIChBbnl0aGluZykgSWYga2V5IGlzIHBhc3NlZCwgcmV0dXJucyB0aGUgdmFsdWUgY29ycmVzcG9uZGluZyB3aXRoIHRoYXQga2V5XG4gIC8vICAgIGluIHRoZSBsb2NhdGlvbi5oYXNoICdzdGF0ZScsIG9yIHVuZGVmaW5lZC4gSWYgbm90LCBhbiBvYmplY3RcbiAgLy8gICAgcmVwcmVzZW50aW5nIHRoZSBlbnRpcmUgJ3N0YXRlJyBpcyByZXR1cm5lZC5cblxuICBqcV9iYnEuZ2V0U3RhdGUgPSBqcV9iYnFfZ2V0U3RhdGUgPSBmdW5jdGlvbigga2V5LCBjb2VyY2UgKSB7XG4gICAgcmV0dXJuIGtleSA9PT0gdW5kZWZpbmVkIHx8IHR5cGVvZiBrZXkgPT09ICdib29sZWFuJ1xuICAgICAgPyBqcV9kZXBhcmFtX2ZyYWdtZW50KCBrZXkgKSAvLyAna2V5JyByZWFsbHkgbWVhbnMgJ2NvZXJjZScgaGVyZVxuICAgICAgOiBqcV9kZXBhcmFtX2ZyYWdtZW50KCBjb2VyY2UgKVsga2V5IF07XG4gIH07XG5cbiAgLy8gTWV0aG9kOiBqUXVlcnkuYmJxLnJlbW92ZVN0YXRlXG4gIC8vXG4gIC8vIFJlbW92ZSBvbmUgb3IgbW9yZSBrZXlzIGZyb20gdGhlIGN1cnJlbnQgYnJvd3NlciBoaXN0b3J5ICdzdGF0ZScsIGNyZWF0aW5nXG4gIC8vIGEgbmV3IHN0YXRlLCBzZXR0aW5nIGxvY2F0aW9uLmhhc2ggYW5kIHRyaWdnZXJpbmcgYW55IGJvdW5kXG4gIC8vIDxoYXNoY2hhbmdlIGV2ZW50PiBjYWxsYmFja3MgKHByb3ZpZGVkIHRoZSBuZXcgc3RhdGUgaXMgZGlmZmVyZW50IHRoYW5cbiAgLy8gdGhlIHByZXZpb3VzIHN0YXRlKS5cbiAgLy9cbiAgLy8gSWYgbm8gYXJndW1lbnRzIGFyZSBwYXNzZWQsIGFuIGVtcHR5IHN0YXRlIGlzIGNyZWF0ZWQsIHdoaWNoIGlzIGp1c3QgYVxuICAvLyBzaG9ydGN1dCBmb3IgalF1ZXJ5LmJicS5wdXNoU3RhdGUoIHt9LCAyICkuXG4gIC8vXG4gIC8vIFVzYWdlOlxuICAvL1xuICAvLyA+IGpRdWVyeS5iYnEucmVtb3ZlU3RhdGUoIFsga2V5IFssIGtleSAuLi4gXSBdICk7XG4gIC8vXG4gIC8vIEFyZ3VtZW50czpcbiAgLy9cbiAgLy8gIGtleSAtIChTdHJpbmcpIE9uZSBvciBtb3JlIGtleSB2YWx1ZXMgdG8gcmVtb3ZlIGZyb20gdGhlIGN1cnJlbnQgc3RhdGUsXG4gIC8vICAgIHBhc3NlZCBhcyBpbmRpdmlkdWFsIGFyZ3VtZW50cy5cbiAgLy8gIGtleSAtIChBcnJheSkgQSBzaW5nbGUgYXJyYXkgYXJndW1lbnQgdGhhdCBjb250YWlucyBhIGxpc3Qgb2Yga2V5IHZhbHVlc1xuICAvLyAgICB0byByZW1vdmUgZnJvbSB0aGUgY3VycmVudCBzdGF0ZS5cbiAgLy9cbiAgLy8gUmV0dXJuczpcbiAgLy9cbiAgLy8gIE5vdGhpbmcuXG4gIC8vXG4gIC8vIEFkZGl0aW9uYWwgTm90ZXM6XG4gIC8vXG4gIC8vICAqIFNldHRpbmcgYW4gZW1wdHkgc3RhdGUgbWF5IGNhdXNlIHRoZSBicm93c2VyIHRvIHNjcm9sbC5cblxuICBqcV9iYnEucmVtb3ZlU3RhdGUgPSBmdW5jdGlvbiggYXJyICkge1xuICAgIHZhciBzdGF0ZSA9IHt9O1xuXG4gICAgLy8gSWYgb25lIG9yIG1vcmUgYXJndW1lbnRzIGlzIHBhc3NlZC4uXG4gICAgaWYgKCBhcnIgIT09IHVuZGVmaW5lZCApIHtcblxuICAgICAgLy8gR2V0IHRoZSBjdXJyZW50IHN0YXRlLlxuICAgICAgc3RhdGUgPSBqcV9iYnFfZ2V0U3RhdGUoKTtcblxuICAgICAgLy8gRm9yIGVhY2ggcGFzc2VkIGtleSwgZGVsZXRlIHRoZSBjb3JyZXNwb25kaW5nIHByb3BlcnR5IGZyb20gdGhlIGN1cnJlbnRcbiAgICAgIC8vIHN0YXRlLlxuICAgICAgJC5lYWNoKCAkLmlzQXJyYXkoIGFyciApID8gYXJyIDogYXJndW1lbnRzLCBmdW5jdGlvbihpLHYpe1xuICAgICAgICBkZWxldGUgc3RhdGVbIHYgXTtcbiAgICAgIH0pO1xuICAgIH1cblxuICAgIC8vIFNldCB0aGUgc3RhdGUsIGNvbXBsZXRlbHkgb3ZlcnJpZGluZyBhbnkgZXhpc3Rpbmcgc3RhdGUuXG4gICAganFfYmJxX3B1c2hTdGF0ZSggc3RhdGUsIDIgKTtcbiAgfTtcblxuICAvLyBFdmVudDogaGFzaGNoYW5nZSBldmVudCAoQkJRKVxuICAvL1xuICAvLyBVc2FnZSBpbiBqUXVlcnkgMS40IGFuZCBuZXdlcjpcbiAgLy9cbiAgLy8gSW4galF1ZXJ5IDEuNCBhbmQgbmV3ZXIsIHRoZSBldmVudCBvYmplY3QgcGFzc2VkIGludG8gYW55IGhhc2hjaGFuZ2UgZXZlbnRcbiAgLy8gY2FsbGJhY2sgaXMgYXVnbWVudGVkIHdpdGggYSBjb3B5IG9mIHRoZSBsb2NhdGlvbi5oYXNoIGZyYWdtZW50IGF0IHRoZSB0aW1lXG4gIC8vIHRoZSBldmVudCB3YXMgdHJpZ2dlcmVkIGFzIGl0cyBldmVudC5mcmFnbWVudCBwcm9wZXJ0eS4gSW4gYWRkaXRpb24sIHRoZVxuICAvLyBldmVudC5nZXRTdGF0ZSBtZXRob2Qgb3BlcmF0ZXMgb24gdGhpcyBwcm9wZXJ0eSAoaW5zdGVhZCBvZiBsb2NhdGlvbi5oYXNoKVxuICAvLyB3aGljaCBhbGxvd3MgdGhpcyBmcmFnbWVudC1hcy1hLXN0YXRlIHRvIGJlIHJlZmVyZW5jZWQgbGF0ZXIsIGV2ZW4gYWZ0ZXJcbiAgLy8gd2luZG93LmxvY2F0aW9uIG1heSBoYXZlIGNoYW5nZWQuXG4gIC8vXG4gIC8vIE5vdGUgdGhhdCBldmVudC5mcmFnbWVudCBhbmQgZXZlbnQuZ2V0U3RhdGUgYXJlIG5vdCBkZWZpbmVkIGFjY29yZGluZyB0b1xuICAvLyBXM0MgKG9yIGFueSBvdGhlcikgc3BlY2lmaWNhdGlvbiwgYnV0IHdpbGwgc3RpbGwgYmUgYXZhaWxhYmxlIHdoZXRoZXIgb3JcbiAgLy8gbm90IHRoZSBoYXNoY2hhbmdlIGV2ZW50IGV4aXN0cyBuYXRpdmVseSBpbiB0aGUgYnJvd3NlciwgYmVjYXVzZSBvZiB0aGVcbiAgLy8gdXRpbGl0eSB0aGV5IHByb3ZpZGUuXG4gIC8vXG4gIC8vIFRoZSBldmVudC5mcmFnbWVudCBwcm9wZXJ0eSBjb250YWlucyB0aGUgb3V0cHV0IG9mIDxqUXVlcnkucGFyYW0uZnJhZ21lbnQ+XG4gIC8vIGFuZCB0aGUgZXZlbnQuZ2V0U3RhdGUgbWV0aG9kIGlzIGVxdWl2YWxlbnQgdG8gdGhlIDxqUXVlcnkuYmJxLmdldFN0YXRlPlxuICAvLyBtZXRob2QuXG4gIC8vXG4gIC8vID4gJCh3aW5kb3cpLmJpbmQoICdoYXNoY2hhbmdlJywgZnVuY3Rpb24oIGV2ZW50ICkge1xuICAvLyA+ICAgdmFyIGhhc2hfc3RyID0gZXZlbnQuZnJhZ21lbnQsXG4gIC8vID4gICAgIHBhcmFtX29iaiA9IGV2ZW50LmdldFN0YXRlKCksXG4gIC8vID4gICAgIHBhcmFtX3ZhbCA9IGV2ZW50LmdldFN0YXRlKCAncGFyYW1fbmFtZScgKSxcbiAgLy8gPiAgICAgcGFyYW1fdmFsX2NvZXJjZWQgPSBldmVudC5nZXRTdGF0ZSggJ3BhcmFtX25hbWUnLCB0cnVlICk7XG4gIC8vID4gICAuLi5cbiAgLy8gPiB9KTtcbiAgLy9cbiAgLy8gVXNhZ2UgaW4galF1ZXJ5IDEuMy4yOlxuICAvL1xuICAvLyBJbiBqUXVlcnkgMS4zLjIsIHRoZSBldmVudCBvYmplY3QgY2Fubm90IHRvIGJlIGF1Z21lbnRlZCBhcyBpbiBqUXVlcnkgMS40KyxcbiAgLy8gc28gdGhlIGZyYWdtZW50IHN0YXRlIGlzbid0IGJvdW5kIHRvIHRoZSBldmVudCBvYmplY3QgYW5kIG11c3QgaW5zdGVhZCBiZVxuICAvLyBwYXJzZWQgdXNpbmcgdGhlIDxqUXVlcnkucGFyYW0uZnJhZ21lbnQ+IGFuZCA8alF1ZXJ5LmJicS5nZXRTdGF0ZT4gbWV0aG9kcy5cbiAgLy9cbiAgLy8gPiAkKHdpbmRvdykuYmluZCggJ2hhc2hjaGFuZ2UnLCBmdW5jdGlvbiggZXZlbnQgKSB7XG4gIC8vID4gICB2YXIgaGFzaF9zdHIgPSAkLnBhcmFtLmZyYWdtZW50KCksXG4gIC8vID4gICAgIHBhcmFtX29iaiA9ICQuYmJxLmdldFN0YXRlKCksXG4gIC8vID4gICAgIHBhcmFtX3ZhbCA9ICQuYmJxLmdldFN0YXRlKCAncGFyYW1fbmFtZScgKSxcbiAgLy8gPiAgICAgcGFyYW1fdmFsX2NvZXJjZWQgPSAkLmJicS5nZXRTdGF0ZSggJ3BhcmFtX25hbWUnLCB0cnVlICk7XG4gIC8vID4gICAuLi5cbiAgLy8gPiB9KTtcbiAgLy9cbiAgLy8gQWRkaXRpb25hbCBOb3RlczpcbiAgLy9cbiAgLy8gKiBEdWUgdG8gY2hhbmdlcyBpbiB0aGUgc3BlY2lhbCBldmVudHMgQVBJLCBqUXVlcnkgQkJRIHYxLjIgb3IgbmV3ZXIgaXNcbiAgLy8gICByZXF1aXJlZCB0byBlbmFibGUgdGhlIGF1Z21lbnRlZCBldmVudCBvYmplY3QgaW4galF1ZXJ5IDEuNC4yIGFuZCBuZXdlci5cbiAgLy8gKiBTZWUgPGpRdWVyeSBoYXNoY2hhbmdlIGV2ZW50PiBmb3IgbW9yZSBkZXRhaWxlZCBpbmZvcm1hdGlvbi5cblxuICBzcGVjaWFsWyBzdHJfaGFzaGNoYW5nZSBdID0gJC5leHRlbmQoIHNwZWNpYWxbIHN0cl9oYXNoY2hhbmdlIF0sIHtcblxuICAgIC8vIEF1Z21lbnRpbmcgdGhlIGV2ZW50IG9iamVjdCB3aXRoIHRoZSAuZnJhZ21lbnQgcHJvcGVydHkgYW5kIC5nZXRTdGF0ZVxuICAgIC8vIG1ldGhvZCByZXF1aXJlcyBqUXVlcnkgMS40IG9yIG5ld2VyLiBOb3RlOiB3aXRoIDEuMy4yLCBldmVyeXRoaW5nIHdpbGxcbiAgICAvLyB3b3JrLCBidXQgdGhlIGV2ZW50IHdvbid0IGJlIGF1Z21lbnRlZClcbiAgICBhZGQ6IGZ1bmN0aW9uKCBoYW5kbGVPYmogKSB7XG4gICAgICB2YXIgb2xkX2hhbmRsZXI7XG5cbiAgICAgIGZ1bmN0aW9uIG5ld19oYW5kbGVyKGUpIHtcbiAgICAgICAgLy8gZS5mcmFnbWVudCBpcyBzZXQgdG8gdGhlIHZhbHVlIG9mIGxvY2F0aW9uLmhhc2ggKHdpdGggYW55IGxlYWRpbmcgI1xuICAgICAgICAvLyByZW1vdmVkKSBhdCB0aGUgdGltZSB0aGUgZXZlbnQgaXMgdHJpZ2dlcmVkLlxuICAgICAgICB2YXIgaGFzaCA9IGVbIHN0cl9mcmFnbWVudCBdID0ganFfcGFyYW1fZnJhZ21lbnQoKTtcblxuICAgICAgICAvLyBlLmdldFN0YXRlKCkgd29ya3MganVzdCBsaWtlICQuYmJxLmdldFN0YXRlKCksIGJ1dCB1c2VzIHRoZVxuICAgICAgICAvLyBlLmZyYWdtZW50IHByb3BlcnR5IHN0b3JlZCBvbiB0aGUgZXZlbnQgb2JqZWN0LlxuICAgICAgICBlLmdldFN0YXRlID0gZnVuY3Rpb24oIGtleSwgY29lcmNlICkge1xuICAgICAgICAgIHJldHVybiBrZXkgPT09IHVuZGVmaW5lZCB8fCB0eXBlb2Yga2V5ID09PSAnYm9vbGVhbidcbiAgICAgICAgICAgID8ganFfZGVwYXJhbSggaGFzaCwga2V5ICkgLy8gJ2tleScgcmVhbGx5IG1lYW5zICdjb2VyY2UnIGhlcmVcbiAgICAgICAgICAgIDoganFfZGVwYXJhbSggaGFzaCwgY29lcmNlIClbIGtleSBdO1xuICAgICAgICB9O1xuXG4gICAgICAgIG9sZF9oYW5kbGVyLmFwcGx5KCB0aGlzLCBhcmd1bWVudHMgKTtcbiAgICAgIH07XG5cbiAgICAgIC8vIFRoaXMgbWF5IHNlZW0gYSBsaXR0bGUgY29tcGxpY2F0ZWQsIGJ1dCBpdCBub3JtYWxpemVzIHRoZSBzcGVjaWFsIGV2ZW50XG4gICAgICAvLyAuYWRkIG1ldGhvZCBiZXR3ZWVuIGpRdWVyeSAxLjQvMS40LjEgYW5kIDEuNC4yK1xuICAgICAgaWYgKCAkLmlzRnVuY3Rpb24oIGhhbmRsZU9iaiApICkge1xuICAgICAgICAvLyAxLjQsIDEuNC4xXG4gICAgICAgIG9sZF9oYW5kbGVyID0gaGFuZGxlT2JqO1xuICAgICAgICByZXR1cm4gbmV3X2hhbmRsZXI7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICAvLyAxLjQuMitcbiAgICAgICAgb2xkX2hhbmRsZXIgPSBoYW5kbGVPYmouaGFuZGxlcjtcbiAgICAgICAgaGFuZGxlT2JqLmhhbmRsZXIgPSBuZXdfaGFuZGxlcjtcbiAgICAgIH1cbiAgICB9XG5cbiAgfSk7XG5cbn0pKGpRdWVyeSx0aGlzKTtcblxuLyohXG4gKiBqUXVlcnkgaGFzaGNoYW5nZSBldmVudCAtIHYxLjMgLSA3LzIxLzIwMTBcbiAqIGh0dHA6Ly9iZW5hbG1hbi5jb20vcHJvamVjdHMvanF1ZXJ5LWhhc2hjaGFuZ2UtcGx1Z2luL1xuICpcbiAqIENvcHlyaWdodCAoYykgMjAxMCBcIkNvd2JveVwiIEJlbiBBbG1hblxuICogRHVhbCBsaWNlbnNlZCB1bmRlciB0aGUgTUlUIGFuZCBHUEwgbGljZW5zZXMuXG4gKiBodHRwOi8vYmVuYWxtYW4uY29tL2Fib3V0L2xpY2Vuc2UvXG4gKi9cblxuLy8gU2NyaXB0OiBqUXVlcnkgaGFzaGNoYW5nZSBldmVudFxuLy9cbi8vICpWZXJzaW9uOiAxLjMsIExhc3QgdXBkYXRlZDogNy8yMS8yMDEwKlxuLy9cbi8vIFByb2plY3QgSG9tZSAtIGh0dHA6Ly9iZW5hbG1hbi5jb20vcHJvamVjdHMvanF1ZXJ5LWhhc2hjaGFuZ2UtcGx1Z2luL1xuLy8gR2l0SHViICAgICAgIC0gaHR0cDovL2dpdGh1Yi5jb20vY293Ym95L2pxdWVyeS1oYXNoY2hhbmdlL1xuLy8gU291cmNlICAgICAgIC0gaHR0cDovL2dpdGh1Yi5jb20vY293Ym95L2pxdWVyeS1oYXNoY2hhbmdlL3Jhdy9tYXN0ZXIvanF1ZXJ5LmJhLWhhc2hjaGFuZ2UuanNcbi8vIChNaW5pZmllZCkgICAtIGh0dHA6Ly9naXRodWIuY29tL2Nvd2JveS9qcXVlcnktaGFzaGNoYW5nZS9yYXcvbWFzdGVyL2pxdWVyeS5iYS1oYXNoY2hhbmdlLm1pbi5qcyAoMC44a2IgZ3ppcHBlZClcbi8vXG4vLyBBYm91dDogTGljZW5zZVxuLy9cbi8vIENvcHlyaWdodCAoYykgMjAxMCBcIkNvd2JveVwiIEJlbiBBbG1hbixcbi8vIER1YWwgbGljZW5zZWQgdW5kZXIgdGhlIE1JVCBhbmQgR1BMIGxpY2Vuc2VzLlxuLy8gaHR0cDovL2JlbmFsbWFuLmNvbS9hYm91dC9saWNlbnNlL1xuLy9cbi8vIEFib3V0OiBFeGFtcGxlc1xuLy9cbi8vIFRoZXNlIHdvcmtpbmcgZXhhbXBsZXMsIGNvbXBsZXRlIHdpdGggZnVsbHkgY29tbWVudGVkIGNvZGUsIGlsbHVzdHJhdGUgYSBmZXdcbi8vIHdheXMgaW4gd2hpY2ggdGhpcyBwbHVnaW4gY2FuIGJlIHVzZWQuXG4vL1xuLy8gaGFzaGNoYW5nZSBldmVudCAtIGh0dHA6Ly9iZW5hbG1hbi5jb20vY29kZS9wcm9qZWN0cy9qcXVlcnktaGFzaGNoYW5nZS9leGFtcGxlcy9oYXNoY2hhbmdlL1xuLy8gZG9jdW1lbnQuZG9tYWluIC0gaHR0cDovL2JlbmFsbWFuLmNvbS9jb2RlL3Byb2plY3RzL2pxdWVyeS1oYXNoY2hhbmdlL2V4YW1wbGVzL2RvY3VtZW50X2RvbWFpbi9cbi8vXG4vLyBBYm91dDogU3VwcG9ydCBhbmQgVGVzdGluZ1xuLy9cbi8vIEluZm9ybWF0aW9uIGFib3V0IHdoYXQgdmVyc2lvbiBvciB2ZXJzaW9ucyBvZiBqUXVlcnkgdGhpcyBwbHVnaW4gaGFzIGJlZW5cbi8vIHRlc3RlZCB3aXRoLCB3aGF0IGJyb3dzZXJzIGl0IGhhcyBiZWVuIHRlc3RlZCBpbiwgYW5kIHdoZXJlIHRoZSB1bml0IHRlc3RzXG4vLyByZXNpZGUgKHNvIHlvdSBjYW4gdGVzdCBpdCB5b3Vyc2VsZikuXG4vL1xuLy8galF1ZXJ5IFZlcnNpb25zIC0gMS4yLjYsIDEuMy4yLCAxLjQuMSwgMS40LjJcbi8vIEJyb3dzZXJzIFRlc3RlZCAtIEludGVybmV0IEV4cGxvcmVyIDYtOCwgRmlyZWZveCAyLTQsIENocm9tZSA1LTYsIFNhZmFyaSAzLjItNSxcbi8vICAgICAgICAgICAgICAgICAgIE9wZXJhIDkuNi0xMC42MCwgaVBob25lIDMuMSwgQW5kcm9pZCAxLjYtMi4yLCBCbGFja0JlcnJ5IDQuNi01LlxuLy8gVW5pdCBUZXN0cyAgICAgIC0gaHR0cDovL2JlbmFsbWFuLmNvbS9jb2RlL3Byb2plY3RzL2pxdWVyeS1oYXNoY2hhbmdlL3VuaXQvXG4vL1xuLy8gQWJvdXQ6IEtub3duIGlzc3Vlc1xuLy9cbi8vIFdoaWxlIHRoaXMgalF1ZXJ5IGhhc2hjaGFuZ2UgZXZlbnQgaW1wbGVtZW50YXRpb24gaXMgcXVpdGUgc3RhYmxlIGFuZFxuLy8gcm9idXN0LCB0aGVyZSBhcmUgYSBmZXcgdW5mb3J0dW5hdGUgYnJvd3NlciBidWdzIHN1cnJvdW5kaW5nIGV4cGVjdGVkXG4vLyBoYXNoY2hhbmdlIGV2ZW50LWJhc2VkIGJlaGF2aW9ycywgaW5kZXBlbmRlbnQgb2YgYW55IEphdmFTY3JpcHRcbi8vIHdpbmRvdy5vbmhhc2hjaGFuZ2UgYWJzdHJhY3Rpb24uIFNlZSB0aGUgZm9sbG93aW5nIGV4YW1wbGVzIGZvciBtb3JlXG4vLyBpbmZvcm1hdGlvbjpcbi8vXG4vLyBDaHJvbWU6IEJhY2sgQnV0dG9uIC0gaHR0cDovL2JlbmFsbWFuLmNvbS9jb2RlL3Byb2plY3RzL2pxdWVyeS1oYXNoY2hhbmdlL2V4YW1wbGVzL2J1Zy1jaHJvbWUtYmFjay1idXR0b24vXG4vLyBGaXJlZm94OiBSZW1vdGUgWE1MSHR0cFJlcXVlc3QgLSBodHRwOi8vYmVuYWxtYW4uY29tL2NvZGUvcHJvamVjdHMvanF1ZXJ5LWhhc2hjaGFuZ2UvZXhhbXBsZXMvYnVnLWZpcmVmb3gtcmVtb3RlLXhoci9cbi8vIFdlYktpdDogQmFjayBCdXR0b24gaW4gYW4gSWZyYW1lIC0gaHR0cDovL2JlbmFsbWFuLmNvbS9jb2RlL3Byb2plY3RzL2pxdWVyeS1oYXNoY2hhbmdlL2V4YW1wbGVzL2J1Zy13ZWJraXQtaGFzaC1pZnJhbWUvXG4vLyBTYWZhcmk6IEJhY2sgQnV0dG9uIGZyb20gYSBkaWZmZXJlbnQgZG9tYWluIC0gaHR0cDovL2JlbmFsbWFuLmNvbS9jb2RlL3Byb2plY3RzL2pxdWVyeS1oYXNoY2hhbmdlL2V4YW1wbGVzL2J1Zy1zYWZhcmktYmFjay1mcm9tLWRpZmYtZG9tYWluL1xuLy9cbi8vIEFsc28gbm90ZSB0aGF0IHNob3VsZCBhIGJyb3dzZXIgbmF0aXZlbHkgc3VwcG9ydCB0aGUgd2luZG93Lm9uaGFzaGNoYW5nZVxuLy8gZXZlbnQsIGJ1dCBub3QgcmVwb3J0IHRoYXQgaXQgZG9lcywgdGhlIGZhbGxiYWNrIHBvbGxpbmcgbG9vcCB3aWxsIGJlIHVzZWQuXG4vL1xuLy8gQWJvdXQ6IFJlbGVhc2UgSGlzdG9yeVxuLy9cbi8vIDEuMyAgIC0gKDcvMjEvMjAxMCkgUmVvcmdhbml6ZWQgSUU2LzcgSWZyYW1lIGNvZGUgdG8gbWFrZSBpdCBtb3JlXG4vLyAgICAgICAgIFwicmVtb3ZhYmxlXCIgZm9yIG1vYmlsZS1vbmx5IGRldmVsb3BtZW50LiBBZGRlZCBJRTYvNyBkb2N1bWVudC50aXRsZVxuLy8gICAgICAgICBzdXBwb3J0LiBBdHRlbXB0ZWQgdG8gbWFrZSBJZnJhbWUgYXMgaGlkZGVuIGFzIHBvc3NpYmxlIGJ5IHVzaW5nXG4vLyAgICAgICAgIHRlY2huaXF1ZXMgZnJvbSBodHRwOi8vd3d3LnBhY2llbGxvZ3JvdXAuY29tL2Jsb2cvP3A9NjA0LiBBZGRlZFxuLy8gICAgICAgICBzdXBwb3J0IGZvciB0aGUgXCJzaG9ydGN1dFwiIGZvcm1hdCAkKHdpbmRvdykuaGFzaGNoYW5nZSggZm4gKSBhbmRcbi8vICAgICAgICAgJCh3aW5kb3cpLmhhc2hjaGFuZ2UoKSBsaWtlIGpRdWVyeSBwcm92aWRlcyBmb3IgYnVpbHQtaW4gZXZlbnRzLlxuLy8gICAgICAgICBSZW5hbWVkIGpRdWVyeS5oYXNoY2hhbmdlRGVsYXkgdG8gPGpRdWVyeS5mbi5oYXNoY2hhbmdlLmRlbGF5PiBhbmRcbi8vICAgICAgICAgbG93ZXJlZCBpdHMgZGVmYXVsdCB2YWx1ZSB0byA1MC4gQWRkZWQgPGpRdWVyeS5mbi5oYXNoY2hhbmdlLmRvbWFpbj5cbi8vICAgICAgICAgYW5kIDxqUXVlcnkuZm4uaGFzaGNoYW5nZS5zcmM+IHByb3BlcnRpZXMgcGx1cyBkb2N1bWVudC1kb21haW4uaHRtbFxuLy8gICAgICAgICBmaWxlIHRvIGFkZHJlc3MgYWNjZXNzIGRlbmllZCBpc3N1ZXMgd2hlbiBzZXR0aW5nIGRvY3VtZW50LmRvbWFpbiBpblxuLy8gICAgICAgICBJRTYvNy5cbi8vIDEuMiAgIC0gKDIvMTEvMjAxMCkgRml4ZWQgYSBidWcgd2hlcmUgY29taW5nIGJhY2sgdG8gYSBwYWdlIHVzaW5nIHRoaXMgcGx1Z2luXG4vLyAgICAgICAgIGZyb20gYSBwYWdlIG9uIGFub3RoZXIgZG9tYWluIHdvdWxkIGNhdXNlIGFuIGVycm9yIGluIFNhZmFyaSA0LiBBbHNvLFxuLy8gICAgICAgICBJRTYvNyBJZnJhbWUgaXMgbm93IGluc2VydGVkIGFmdGVyIHRoZSBib2R5ICh0aGlzIGFjdHVhbGx5IHdvcmtzKSxcbi8vICAgICAgICAgd2hpY2ggcHJldmVudHMgdGhlIHBhZ2UgZnJvbSBzY3JvbGxpbmcgd2hlbiB0aGUgZXZlbnQgaXMgZmlyc3QgYm91bmQuXG4vLyAgICAgICAgIEV2ZW50IGNhbiBhbHNvIG5vdyBiZSBib3VuZCBiZWZvcmUgRE9NIHJlYWR5LCBidXQgaXQgd29uJ3QgYmUgdXNhYmxlXG4vLyAgICAgICAgIGJlZm9yZSB0aGVuIGluIElFNi83LlxuLy8gMS4xICAgLSAoMS8yMS8yMDEwKSBJbmNvcnBvcmF0ZWQgZG9jdW1lbnQuZG9jdW1lbnRNb2RlIHRlc3QgdG8gZml4IElFOCBidWdcbi8vICAgICAgICAgd2hlcmUgYnJvd3NlciB2ZXJzaW9uIGlzIGluY29ycmVjdGx5IHJlcG9ydGVkIGFzIDguMCwgZGVzcGl0ZVxuLy8gICAgICAgICBpbmNsdXNpb24gb2YgdGhlIFgtVUEtQ29tcGF0aWJsZSBJRT1FbXVsYXRlSUU3IG1ldGEgdGFnLlxuLy8gMS4wICAgLSAoMS85LzIwMTApIEluaXRpYWwgUmVsZWFzZS4gQnJva2Ugb3V0IHRoZSBqUXVlcnkgQkJRIGV2ZW50LnNwZWNpYWxcbi8vICAgICAgICAgd2luZG93Lm9uaGFzaGNoYW5nZSBmdW5jdGlvbmFsaXR5IGludG8gYSBzZXBhcmF0ZSBwbHVnaW4gZm9yIHVzZXJzXG4vLyAgICAgICAgIHdobyB3YW50IGp1c3QgdGhlIGJhc2ljIGV2ZW50ICYgYmFjayBidXR0b24gc3VwcG9ydCwgd2l0aG91dCBhbGwgdGhlXG4vLyAgICAgICAgIGV4dHJhIGF3ZXNvbWVuZXNzIHRoYXQgQkJRIHByb3ZpZGVzLiBUaGlzIHBsdWdpbiB3aWxsIGJlIGluY2x1ZGVkIGFzXG4vLyAgICAgICAgIHBhcnQgb2YgalF1ZXJ5IEJCUSwgYnV0IGFsc28gYmUgYXZhaWxhYmxlIHNlcGFyYXRlbHkuXG5cbihmdW5jdGlvbigkLHdpbmRvdyx1bmRlZmluZWQpe1xuICAnJDpub211bmdlJzsgLy8gVXNlZCBieSBZVUkgY29tcHJlc3Nvci5cblxuICAvLyBSZXVzZWQgc3RyaW5nLlxuICB2YXIgc3RyX2hhc2hjaGFuZ2UgPSAnaGFzaGNoYW5nZScsXG5cbiAgICAvLyBNZXRob2QgLyBvYmplY3QgcmVmZXJlbmNlcy5cbiAgICBkb2MgPSBkb2N1bWVudCxcbiAgICBmYWtlX29uaGFzaGNoYW5nZSxcbiAgICBzcGVjaWFsID0gJC5ldmVudC5zcGVjaWFsLFxuXG4gICAgLy8gRG9lcyB0aGUgYnJvd3NlciBzdXBwb3J0IHdpbmRvdy5vbmhhc2hjaGFuZ2U/IE5vdGUgdGhhdCBJRTggcnVubmluZyBpblxuICAgIC8vIElFNyBjb21wYXRpYmlsaXR5IG1vZGUgcmVwb3J0cyB0cnVlIGZvciAnb25oYXNoY2hhbmdlJyBpbiB3aW5kb3csIGV2ZW5cbiAgICAvLyB0aG91Z2ggdGhlIGV2ZW50IGlzbid0IHN1cHBvcnRlZCwgc28gYWxzbyB0ZXN0IGRvY3VtZW50LmRvY3VtZW50TW9kZS5cbiAgICBkb2NfbW9kZSA9IGRvYy5kb2N1bWVudE1vZGUsXG4gICAgc3VwcG9ydHNfb25oYXNoY2hhbmdlID0gJ29uJyArIHN0cl9oYXNoY2hhbmdlIGluIHdpbmRvdyAmJiAoIGRvY19tb2RlID09PSB1bmRlZmluZWQgfHwgZG9jX21vZGUgPiA3ICk7XG5cbiAgLy8gR2V0IGxvY2F0aW9uLmhhc2ggKG9yIHdoYXQgeW91J2QgZXhwZWN0IGxvY2F0aW9uLmhhc2ggdG8gYmUpIHNhbnMgYW55XG4gIC8vIGxlYWRpbmcgIy4gVGhhbmtzIGZvciBtYWtpbmcgdGhpcyBuZWNlc3NhcnksIEZpcmVmb3ghXG4gIGZ1bmN0aW9uIGdldF9mcmFnbWVudCggdXJsICkge1xuICAgIHVybCA9IHVybCB8fCBsb2NhdGlvbi5ocmVmO1xuICAgIHJldHVybiAnIycgKyB1cmwucmVwbGFjZSggL15bXiNdKiM/KC4qKSQvLCAnJDEnICk7XG4gIH07XG5cbiAgLy8gTWV0aG9kOiBqUXVlcnkuZm4uaGFzaGNoYW5nZVxuICAvL1xuICAvLyBCaW5kIGEgaGFuZGxlciB0byB0aGUgd2luZG93Lm9uaGFzaGNoYW5nZSBldmVudCBvciB0cmlnZ2VyIGFsbCBib3VuZFxuICAvLyB3aW5kb3cub25oYXNoY2hhbmdlIGV2ZW50IGhhbmRsZXJzLiBUaGlzIGJlaGF2aW9yIGlzIGNvbnNpc3RlbnQgd2l0aFxuICAvLyBqUXVlcnkncyBidWlsdC1pbiBldmVudCBoYW5kbGVycy5cbiAgLy9cbiAgLy8gVXNhZ2U6XG4gIC8vXG4gIC8vID4galF1ZXJ5KHdpbmRvdykuaGFzaGNoYW5nZSggWyBoYW5kbGVyIF0gKTtcbiAgLy9cbiAgLy8gQXJndW1lbnRzOlxuICAvL1xuICAvLyAgaGFuZGxlciAtIChGdW5jdGlvbikgT3B0aW9uYWwgaGFuZGxlciB0byBiZSBib3VuZCB0byB0aGUgaGFzaGNoYW5nZVxuICAvLyAgICBldmVudC4gVGhpcyBpcyBhIFwic2hvcnRjdXRcIiBmb3IgdGhlIG1vcmUgdmVyYm9zZSBmb3JtOlxuICAvLyAgICBqUXVlcnkod2luZG93KS5iaW5kKCAnaGFzaGNoYW5nZScsIGhhbmRsZXIgKS4gSWYgaGFuZGxlciBpcyBvbWl0dGVkLFxuICAvLyAgICBhbGwgYm91bmQgd2luZG93Lm9uaGFzaGNoYW5nZSBldmVudCBoYW5kbGVycyB3aWxsIGJlIHRyaWdnZXJlZC4gVGhpc1xuICAvLyAgICBpcyBhIHNob3J0Y3V0IGZvciB0aGUgbW9yZSB2ZXJib3NlXG4gIC8vICAgIGpRdWVyeSh3aW5kb3cpLnRyaWdnZXIoICdoYXNoY2hhbmdlJyApLiBUaGVzZSBmb3JtcyBhcmUgZGVzY3JpYmVkIGluXG4gIC8vICAgIHRoZSA8aGFzaGNoYW5nZSBldmVudD4gc2VjdGlvbi5cbiAgLy9cbiAgLy8gUmV0dXJuczpcbiAgLy9cbiAgLy8gIChqUXVlcnkpIFRoZSBpbml0aWFsIGpRdWVyeSBjb2xsZWN0aW9uIG9mIGVsZW1lbnRzLlxuXG4gIC8vIEFsbG93IHRoZSBcInNob3J0Y3V0XCIgZm9ybWF0ICQoZWxlbSkuaGFzaGNoYW5nZSggZm4gKSBmb3IgYmluZGluZyBhbmRcbiAgLy8gJChlbGVtKS5oYXNoY2hhbmdlKCkgZm9yIHRyaWdnZXJpbmcsIGxpa2UgalF1ZXJ5IGRvZXMgZm9yIGJ1aWx0LWluIGV2ZW50cy5cbiAgJC5mblsgc3RyX2hhc2hjaGFuZ2UgXSA9IGZ1bmN0aW9uKCBmbiApIHtcbiAgICByZXR1cm4gZm4gPyB0aGlzLmJpbmQoIHN0cl9oYXNoY2hhbmdlLCBmbiApIDogdGhpcy50cmlnZ2VyKCBzdHJfaGFzaGNoYW5nZSApO1xuICB9O1xuXG4gIC8vIFByb3BlcnR5OiBqUXVlcnkuZm4uaGFzaGNoYW5nZS5kZWxheVxuICAvL1xuICAvLyBUaGUgbnVtZXJpYyBpbnRlcnZhbCAoaW4gbWlsbGlzZWNvbmRzKSBhdCB3aGljaCB0aGUgPGhhc2hjaGFuZ2UgZXZlbnQ+XG4gIC8vIHBvbGxpbmcgbG9vcCBleGVjdXRlcy4gRGVmYXVsdHMgdG8gNTAuXG5cbiAgLy8gUHJvcGVydHk6IGpRdWVyeS5mbi5oYXNoY2hhbmdlLmRvbWFpblxuICAvL1xuICAvLyBJZiB5b3UncmUgc2V0dGluZyBkb2N1bWVudC5kb21haW4gaW4geW91ciBKYXZhU2NyaXB0LCBhbmQgeW91IHdhbnQgaGFzaFxuICAvLyBoaXN0b3J5IHRvIHdvcmsgaW4gSUU2LzcsIG5vdCBvbmx5IG11c3QgdGhpcyBwcm9wZXJ0eSBiZSBzZXQsIGJ1dCB5b3UgbXVzdFxuICAvLyBhbHNvIHNldCBkb2N1bWVudC5kb21haW4gQkVGT1JFIGpRdWVyeSBpcyBsb2FkZWQgaW50byB0aGUgcGFnZS4gVGhpc1xuICAvLyBwcm9wZXJ0eSBpcyBvbmx5IGFwcGxpY2FibGUgaWYgeW91IGFyZSBzdXBwb3J0aW5nIElFNi83IChvciBJRTggb3BlcmF0aW5nXG4gIC8vIGluIFwiSUU3IGNvbXBhdGliaWxpdHlcIiBtb2RlKS5cbiAgLy9cbiAgLy8gSW4gYWRkaXRpb24sIHRoZSA8alF1ZXJ5LmZuLmhhc2hjaGFuZ2Uuc3JjPiBwcm9wZXJ0eSBtdXN0IGJlIHNldCB0byB0aGVcbiAgLy8gcGF0aCBvZiB0aGUgaW5jbHVkZWQgXCJkb2N1bWVudC1kb21haW4uaHRtbFwiIGZpbGUsIHdoaWNoIGNhbiBiZSByZW5hbWVkIG9yXG4gIC8vIG1vZGlmaWVkIGlmIG5lY2Vzc2FyeSAobm90ZSB0aGF0IHRoZSBkb2N1bWVudC5kb21haW4gc3BlY2lmaWVkIG11c3QgYmUgdGhlXG4gIC8vIHNhbWUgaW4gYm90aCB5b3VyIG1haW4gSmF2YVNjcmlwdCBhcyB3ZWxsIGFzIGluIHRoaXMgZmlsZSkuXG4gIC8vXG4gIC8vIFVzYWdlOlxuICAvL1xuICAvLyBqUXVlcnkuZm4uaGFzaGNoYW5nZS5kb21haW4gPSBkb2N1bWVudC5kb21haW47XG5cbiAgLy8gUHJvcGVydHk6IGpRdWVyeS5mbi5oYXNoY2hhbmdlLnNyY1xuICAvL1xuICAvLyBJZiwgZm9yIHNvbWUgcmVhc29uLCB5b3UgbmVlZCB0byBzcGVjaWZ5IGFuIElmcmFtZSBzcmMgZmlsZSAoZm9yIGV4YW1wbGUsXG4gIC8vIHdoZW4gc2V0dGluZyBkb2N1bWVudC5kb21haW4gYXMgaW4gPGpRdWVyeS5mbi5oYXNoY2hhbmdlLmRvbWFpbj4pLCB5b3UgY2FuXG4gIC8vIGRvIHNvIHVzaW5nIHRoaXMgcHJvcGVydHkuIE5vdGUgdGhhdCB3aGVuIHVzaW5nIHRoaXMgcHJvcGVydHksIGhpc3RvcnlcbiAgLy8gd29uJ3QgYmUgcmVjb3JkZWQgaW4gSUU2LzcgdW50aWwgdGhlIElmcmFtZSBzcmMgZmlsZSBsb2Fkcy4gVGhpcyBwcm9wZXJ0eVxuICAvLyBpcyBvbmx5IGFwcGxpY2FibGUgaWYgeW91IGFyZSBzdXBwb3J0aW5nIElFNi83IChvciBJRTggb3BlcmF0aW5nIGluIFwiSUU3XG4gIC8vIGNvbXBhdGliaWxpdHlcIiBtb2RlKS5cbiAgLy9cbiAgLy8gVXNhZ2U6XG4gIC8vXG4gIC8vIGpRdWVyeS5mbi5oYXNoY2hhbmdlLnNyYyA9ICdwYXRoL3RvL2ZpbGUuaHRtbCc7XG5cbiAgJC5mblsgc3RyX2hhc2hjaGFuZ2UgXS5kZWxheSA9IDUwO1xuICAvKlxuICAkLmZuWyBzdHJfaGFzaGNoYW5nZSBdLmRvbWFpbiA9IG51bGw7XG4gICQuZm5bIHN0cl9oYXNoY2hhbmdlIF0uc3JjID0gbnVsbDtcbiAgKi9cblxuICAvLyBFdmVudDogaGFzaGNoYW5nZSBldmVudFxuICAvL1xuICAvLyBGaXJlZCB3aGVuIGxvY2F0aW9uLmhhc2ggY2hhbmdlcy4gSW4gYnJvd3NlcnMgdGhhdCBzdXBwb3J0IGl0LCB0aGUgbmF0aXZlXG4gIC8vIEhUTUw1IHdpbmRvdy5vbmhhc2hjaGFuZ2UgZXZlbnQgaXMgdXNlZCwgb3RoZXJ3aXNlIGEgcG9sbGluZyBsb29wIGlzXG4gIC8vIGluaXRpYWxpemVkLCBydW5uaW5nIGV2ZXJ5IDxqUXVlcnkuZm4uaGFzaGNoYW5nZS5kZWxheT4gbWlsbGlzZWNvbmRzIHRvXG4gIC8vIHNlZSBpZiB0aGUgaGFzaCBoYXMgY2hhbmdlZC4gSW4gSUU2LzcgKGFuZCBJRTggb3BlcmF0aW5nIGluIFwiSUU3XG4gIC8vIGNvbXBhdGliaWxpdHlcIiBtb2RlKSwgYSBoaWRkZW4gSWZyYW1lIGlzIGNyZWF0ZWQgdG8gYWxsb3cgdGhlIGJhY2sgYnV0dG9uXG4gIC8vIGFuZCBoYXNoLWJhc2VkIGhpc3RvcnkgdG8gd29yay5cbiAgLy9cbiAgLy8gVXNhZ2UgYXMgZGVzY3JpYmVkIGluIDxqUXVlcnkuZm4uaGFzaGNoYW5nZT46XG4gIC8vXG4gIC8vID4gLy8gQmluZCBhbiBldmVudCBoYW5kbGVyLlxuICAvLyA+IGpRdWVyeSh3aW5kb3cpLmhhc2hjaGFuZ2UoIGZ1bmN0aW9uKGUpIHtcbiAgLy8gPiAgIHZhciBoYXNoID0gbG9jYXRpb24uaGFzaDtcbiAgLy8gPiAgIC4uLlxuICAvLyA+IH0pO1xuICAvLyA+XG4gIC8vID4gLy8gTWFudWFsbHkgdHJpZ2dlciB0aGUgZXZlbnQgaGFuZGxlci5cbiAgLy8gPiBqUXVlcnkod2luZG93KS5oYXNoY2hhbmdlKCk7XG4gIC8vXG4gIC8vIEEgbW9yZSB2ZXJib3NlIHVzYWdlIHRoYXQgYWxsb3dzIGZvciBldmVudCBuYW1lc3BhY2luZzpcbiAgLy9cbiAgLy8gPiAvLyBCaW5kIGFuIGV2ZW50IGhhbmRsZXIuXG4gIC8vID4galF1ZXJ5KHdpbmRvdykuYmluZCggJ2hhc2hjaGFuZ2UnLCBmdW5jdGlvbihlKSB7XG4gIC8vID4gICB2YXIgaGFzaCA9IGxvY2F0aW9uLmhhc2g7XG4gIC8vID4gICAuLi5cbiAgLy8gPiB9KTtcbiAgLy8gPlxuICAvLyA+IC8vIE1hbnVhbGx5IHRyaWdnZXIgdGhlIGV2ZW50IGhhbmRsZXIuXG4gIC8vID4galF1ZXJ5KHdpbmRvdykudHJpZ2dlciggJ2hhc2hjaGFuZ2UnICk7XG4gIC8vXG4gIC8vIEFkZGl0aW9uYWwgTm90ZXM6XG4gIC8vXG4gIC8vICogVGhlIHBvbGxpbmcgbG9vcCBhbmQgSWZyYW1lIGFyZSBub3QgY3JlYXRlZCB1bnRpbCBhdCBsZWFzdCBvbmUgaGFuZGxlclxuICAvLyAgIGlzIGFjdHVhbGx5IGJvdW5kIHRvIHRoZSAnaGFzaGNoYW5nZScgZXZlbnQuXG4gIC8vICogSWYgeW91IG5lZWQgdGhlIGJvdW5kIGhhbmRsZXIocykgdG8gZXhlY3V0ZSBpbW1lZGlhdGVseSwgaW4gY2FzZXMgd2hlcmVcbiAgLy8gICBhIGxvY2F0aW9uLmhhc2ggZXhpc3RzIG9uIHBhZ2UgbG9hZCwgdmlhIGJvb2ttYXJrIG9yIHBhZ2UgcmVmcmVzaCBmb3JcbiAgLy8gICBleGFtcGxlLCB1c2UgalF1ZXJ5KHdpbmRvdykuaGFzaGNoYW5nZSgpIG9yIHRoZSBtb3JlIHZlcmJvc2VcbiAgLy8gICBqUXVlcnkod2luZG93KS50cmlnZ2VyKCAnaGFzaGNoYW5nZScgKS5cbiAgLy8gKiBUaGUgZXZlbnQgY2FuIGJlIGJvdW5kIGJlZm9yZSBET00gcmVhZHksIGJ1dCBzaW5jZSBpdCB3b24ndCBiZSB1c2FibGVcbiAgLy8gICBiZWZvcmUgdGhlbiBpbiBJRTYvNyAoZHVlIHRvIHRoZSBuZWNlc3NhcnkgSWZyYW1lKSwgcmVjb21tZW5kZWQgdXNhZ2UgaXNcbiAgLy8gICB0byBiaW5kIGl0IGluc2lkZSBhIERPTSByZWFkeSBoYW5kbGVyLlxuXG4gIC8vIE92ZXJyaWRlIGV4aXN0aW5nICQuZXZlbnQuc3BlY2lhbC5oYXNoY2hhbmdlIG1ldGhvZHMgKGFsbG93aW5nIHRoaXMgcGx1Z2luXG4gIC8vIHRvIGJlIGRlZmluZWQgYWZ0ZXIgalF1ZXJ5IEJCUSBpbiBCQlEncyBzb3VyY2UgY29kZSkuXG4gIHNwZWNpYWxbIHN0cl9oYXNoY2hhbmdlIF0gPSAkLmV4dGVuZCggc3BlY2lhbFsgc3RyX2hhc2hjaGFuZ2UgXSwge1xuXG4gICAgLy8gQ2FsbGVkIG9ubHkgd2hlbiB0aGUgZmlyc3QgJ2hhc2hjaGFuZ2UnIGV2ZW50IGlzIGJvdW5kIHRvIHdpbmRvdy5cbiAgICBzZXR1cDogZnVuY3Rpb24oKSB7XG4gICAgICAvLyBJZiB3aW5kb3cub25oYXNoY2hhbmdlIGlzIHN1cHBvcnRlZCBuYXRpdmVseSwgdGhlcmUncyBub3RoaW5nIHRvIGRvLi5cbiAgICAgIGlmICggc3VwcG9ydHNfb25oYXNoY2hhbmdlICkgeyByZXR1cm4gZmFsc2U7IH1cblxuICAgICAgLy8gT3RoZXJ3aXNlLCB3ZSBuZWVkIHRvIGNyZWF0ZSBvdXIgb3duLiBBbmQgd2UgZG9uJ3Qgd2FudCB0byBjYWxsIHRoaXNcbiAgICAgIC8vIHVudGlsIHRoZSB1c2VyIGJpbmRzIHRvIHRoZSBldmVudCwganVzdCBpbiBjYXNlIHRoZXkgbmV2ZXIgZG8sIHNpbmNlIGl0XG4gICAgICAvLyB3aWxsIGNyZWF0ZSBhIHBvbGxpbmcgbG9vcCBhbmQgcG9zc2libHkgZXZlbiBhIGhpZGRlbiBJZnJhbWUuXG4gICAgICAkKCBmYWtlX29uaGFzaGNoYW5nZS5zdGFydCApO1xuICAgIH0sXG5cbiAgICAvLyBDYWxsZWQgb25seSB3aGVuIHRoZSBsYXN0ICdoYXNoY2hhbmdlJyBldmVudCBpcyB1bmJvdW5kIGZyb20gd2luZG93LlxuICAgIHRlYXJkb3duOiBmdW5jdGlvbigpIHtcbiAgICAgIC8vIElmIHdpbmRvdy5vbmhhc2hjaGFuZ2UgaXMgc3VwcG9ydGVkIG5hdGl2ZWx5LCB0aGVyZSdzIG5vdGhpbmcgdG8gZG8uLlxuICAgICAgaWYgKCBzdXBwb3J0c19vbmhhc2hjaGFuZ2UgKSB7IHJldHVybiBmYWxzZTsgfVxuXG4gICAgICAvLyBPdGhlcndpc2UsIHdlIG5lZWQgdG8gc3RvcCBvdXJzIChpZiBwb3NzaWJsZSkuXG4gICAgICAkKCBmYWtlX29uaGFzaGNoYW5nZS5zdG9wICk7XG4gICAgfVxuXG4gIH0pO1xuXG4gIC8vIGZha2Vfb25oYXNoY2hhbmdlIGRvZXMgYWxsIHRoZSB3b3JrIG9mIHRyaWdnZXJpbmcgdGhlIHdpbmRvdy5vbmhhc2hjaGFuZ2VcbiAgLy8gZXZlbnQgZm9yIGJyb3dzZXJzIHRoYXQgZG9uJ3QgbmF0aXZlbHkgc3VwcG9ydCBpdCwgaW5jbHVkaW5nIGNyZWF0aW5nIGFcbiAgLy8gcG9sbGluZyBsb29wIHRvIHdhdGNoIGZvciBoYXNoIGNoYW5nZXMgYW5kIGluIElFIDYvNyBjcmVhdGluZyBhIGhpZGRlblxuICAvLyBJZnJhbWUgdG8gZW5hYmxlIGJhY2sgYW5kIGZvcndhcmQuXG4gIGZha2Vfb25oYXNoY2hhbmdlID0gKGZ1bmN0aW9uKCl7XG4gICAgdmFyIHNlbGYgPSB7fSxcbiAgICAgIHRpbWVvdXRfaWQsXG5cbiAgICAgIC8vIFJlbWVtYmVyIHRoZSBpbml0aWFsIGhhc2ggc28gaXQgZG9lc24ndCBnZXQgdHJpZ2dlcmVkIGltbWVkaWF0ZWx5LlxuICAgICAgbGFzdF9oYXNoID0gZ2V0X2ZyYWdtZW50KCksXG5cbiAgICAgIGZuX3JldHZhbCA9IGZ1bmN0aW9uKHZhbCl7IHJldHVybiB2YWw7IH0sXG4gICAgICBoaXN0b3J5X3NldCA9IGZuX3JldHZhbCxcbiAgICAgIGhpc3RvcnlfZ2V0ID0gZm5fcmV0dmFsO1xuXG4gICAgLy8gU3RhcnQgdGhlIHBvbGxpbmcgbG9vcC5cbiAgICBzZWxmLnN0YXJ0ID0gZnVuY3Rpb24oKSB7XG4gICAgICB0aW1lb3V0X2lkIHx8IHBvbGwoKTtcbiAgICB9O1xuXG4gICAgLy8gU3RvcCB0aGUgcG9sbGluZyBsb29wLlxuICAgIHNlbGYuc3RvcCA9IGZ1bmN0aW9uKCkge1xuICAgICAgdGltZW91dF9pZCAmJiBjbGVhclRpbWVvdXQoIHRpbWVvdXRfaWQgKTtcbiAgICAgIHRpbWVvdXRfaWQgPSB1bmRlZmluZWQ7XG4gICAgfTtcblxuICAgIC8vIFRoaXMgcG9sbGluZyBsb29wIGNoZWNrcyBldmVyeSAkLmZuLmhhc2hjaGFuZ2UuZGVsYXkgbWlsbGlzZWNvbmRzIHRvIHNlZVxuICAgIC8vIGlmIGxvY2F0aW9uLmhhc2ggaGFzIGNoYW5nZWQsIGFuZCB0cmlnZ2VycyB0aGUgJ2hhc2hjaGFuZ2UnIGV2ZW50IG9uXG4gICAgLy8gd2luZG93IHdoZW4gbmVjZXNzYXJ5LlxuICAgIGZ1bmN0aW9uIHBvbGwoKSB7XG4gICAgICB2YXIgaGFzaCA9IGdldF9mcmFnbWVudCgpLFxuICAgICAgICBoaXN0b3J5X2hhc2ggPSBoaXN0b3J5X2dldCggbGFzdF9oYXNoICk7XG5cbiAgICAgIGlmICggaGFzaCAhPT0gbGFzdF9oYXNoICkge1xuICAgICAgICBoaXN0b3J5X3NldCggbGFzdF9oYXNoID0gaGFzaCwgaGlzdG9yeV9oYXNoICk7XG5cbiAgICAgICAgJCh3aW5kb3cpLnRyaWdnZXIoIHN0cl9oYXNoY2hhbmdlICk7XG5cbiAgICAgIH0gZWxzZSBpZiAoIGhpc3RvcnlfaGFzaCAhPT0gbGFzdF9oYXNoICkge1xuICAgICAgICBsb2NhdGlvbi5ocmVmID0gbG9jYXRpb24uaHJlZi5yZXBsYWNlKCAvIy4qLywgJycgKSArIGhpc3RvcnlfaGFzaDtcbiAgICAgIH1cblxuICAgICAgdGltZW91dF9pZCA9IHNldFRpbWVvdXQoIHBvbGwsICQuZm5bIHN0cl9oYXNoY2hhbmdlIF0uZGVsYXkgKTtcbiAgICB9O1xuXG4gICAgLy8gdnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2XG4gICAgLy8gdnZ2dnZ2dnZ2dnZ2dnZ2dnZ2diBSRU1PVkUgSUYgTk9UIFNVUFBPUlRJTkcgSUU2LzcvOCB2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2XG4gICAgLy8gdnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2XG4gICAgKC9tc2llfHRyaWRlbnQvaSkudGVzdChuYXZpZ2F0b3IudXNlckFnZW50KSAmJiAhc3VwcG9ydHNfb25oYXNoY2hhbmdlICYmIChmdW5jdGlvbigpe1xuICAgICAgLy8gTm90IG9ubHkgZG8gSUU2LzcgbmVlZCB0aGUgXCJtYWdpY2FsXCIgSWZyYW1lIHRyZWF0bWVudCwgYnV0IHNvIGRvZXMgSUU4XG4gICAgICAvLyB3aGVuIHJ1bm5pbmcgaW4gXCJJRTcgY29tcGF0aWJpbGl0eVwiIG1vZGUuXG5cbiAgICAgIHZhciBpZnJhbWUsXG4gICAgICAgIGlmcmFtZV9zcmM7XG5cbiAgICAgIC8vIFdoZW4gdGhlIGV2ZW50IGlzIGJvdW5kIGFuZCBwb2xsaW5nIHN0YXJ0cyBpbiBJRSA2LzcsIGNyZWF0ZSBhIGhpZGRlblxuICAgICAgLy8gSWZyYW1lIGZvciBoaXN0b3J5IGhhbmRsaW5nLlxuICAgICAgc2VsZi5zdGFydCA9IGZ1bmN0aW9uKCl7XG4gICAgICAgIGlmICggIWlmcmFtZSApIHtcbiAgICAgICAgICBpZnJhbWVfc3JjID0gJC5mblsgc3RyX2hhc2hjaGFuZ2UgXS5zcmM7XG4gICAgICAgICAgaWZyYW1lX3NyYyA9IGlmcmFtZV9zcmMgJiYgaWZyYW1lX3NyYyArIGdldF9mcmFnbWVudCgpO1xuXG4gICAgICAgICAgLy8gQ3JlYXRlIGhpZGRlbiBJZnJhbWUuIEF0dGVtcHQgdG8gbWFrZSBJZnJhbWUgYXMgaGlkZGVuIGFzIHBvc3NpYmxlXG4gICAgICAgICAgLy8gYnkgdXNpbmcgdGVjaG5pcXVlcyBmcm9tIGh0dHA6Ly93d3cucGFjaWVsbG9ncm91cC5jb20vYmxvZy8/cD02MDQuXG4gICAgICAgICAgaWZyYW1lID0gJCgnPGlmcmFtZSB0YWJpbmRleD1cIi0xXCIgdGl0bGU9XCJlbXB0eVwiLz4nKS5oaWRlKClcblxuICAgICAgICAgICAgLy8gV2hlbiBJZnJhbWUgaGFzIGNvbXBsZXRlbHkgbG9hZGVkLCBpbml0aWFsaXplIHRoZSBoaXN0b3J5IGFuZFxuICAgICAgICAgICAgLy8gc3RhcnQgcG9sbGluZy5cbiAgICAgICAgICAgIC5vbmUoICdsb2FkJywgZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgaWZyYW1lX3NyYyB8fCBoaXN0b3J5X3NldCggZ2V0X2ZyYWdtZW50KCkgKTtcbiAgICAgICAgICAgICAgcG9sbCgpO1xuICAgICAgICAgICAgfSlcblxuICAgICAgICAgICAgLy8gTG9hZCBJZnJhbWUgc3JjIGlmIHNwZWNpZmllZCwgb3RoZXJ3aXNlIG5vdGhpbmcuXG4gICAgICAgICAgICAuYXR0ciggJ3NyYycsIGlmcmFtZV9zcmMgfHwgJ2phdmFzY3JpcHQ6MCcgKVxuXG4gICAgICAgICAgICAvLyBBcHBlbmQgSWZyYW1lIGFmdGVyIHRoZSBlbmQgb2YgdGhlIGJvZHkgdG8gcHJldmVudCB1bm5lY2Vzc2FyeVxuICAgICAgICAgICAgLy8gaW5pdGlhbCBwYWdlIHNjcm9sbGluZyAoeWVzLCB0aGlzIHdvcmtzKS5cbiAgICAgICAgICAgIC5pbnNlcnRBZnRlciggJ2JvZHknIClbMF0uY29udGVudFdpbmRvdztcblxuICAgICAgICAgIC8vIFdoZW5ldmVyIGBkb2N1bWVudC50aXRsZWAgY2hhbmdlcywgdXBkYXRlIHRoZSBJZnJhbWUncyB0aXRsZSB0b1xuICAgICAgICAgIC8vIHByZXR0aWZ5IHRoZSBiYWNrL25leHQgaGlzdG9yeSBtZW51IGVudHJpZXMuIFNpbmNlIElFIHNvbWV0aW1lc1xuICAgICAgICAgIC8vIGVycm9ycyB3aXRoIFwiVW5zcGVjaWZpZWQgZXJyb3JcIiB0aGUgdmVyeSBmaXJzdCB0aW1lIHRoaXMgaXMgc2V0XG4gICAgICAgICAgLy8gKHllcywgdmVyeSB1c2VmdWwpIHdyYXAgdGhpcyB3aXRoIGEgdHJ5L2NhdGNoIGJsb2NrLlxuICAgICAgICAgIGRvYy5vbnByb3BlcnR5Y2hhbmdlID0gZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgIGlmICggZXZlbnQucHJvcGVydHlOYW1lID09PSAndGl0bGUnICkge1xuICAgICAgICAgICAgICAgIGlmcmFtZS5kb2N1bWVudC50aXRsZSA9IGRvYy50aXRsZTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSBjYXRjaChlKSB7fVxuICAgICAgICAgIH07XG5cbiAgICAgICAgfVxuICAgICAgfTtcblxuICAgICAgLy8gT3ZlcnJpZGUgdGhlIFwic3RvcFwiIG1ldGhvZCBzaW5jZSBhbiBJRTYvNyBJZnJhbWUgd2FzIGNyZWF0ZWQuIEV2ZW5cbiAgICAgIC8vIGlmIHRoZXJlIGFyZSBubyBsb25nZXIgYW55IGJvdW5kIGV2ZW50IGhhbmRsZXJzLCB0aGUgcG9sbGluZyBsb29wXG4gICAgICAvLyBpcyBzdGlsbCBuZWNlc3NhcnkgZm9yIGJhY2svbmV4dCB0byB3b3JrIGF0IGFsbCFcbiAgICAgIHNlbGYuc3RvcCA9IGZuX3JldHZhbDtcblxuICAgICAgLy8gR2V0IGhpc3RvcnkgYnkgbG9va2luZyBhdCB0aGUgaGlkZGVuIElmcmFtZSdzIGxvY2F0aW9uLmhhc2guXG4gICAgICBoaXN0b3J5X2dldCA9IGZ1bmN0aW9uKCkge1xuICAgICAgICByZXR1cm4gZ2V0X2ZyYWdtZW50KCBpZnJhbWUubG9jYXRpb24uaHJlZiApO1xuICAgICAgfTtcblxuICAgICAgLy8gU2V0IGEgbmV3IGhpc3RvcnkgaXRlbSBieSBvcGVuaW5nIGFuZCB0aGVuIGNsb3NpbmcgdGhlIElmcmFtZVxuICAgICAgLy8gZG9jdW1lbnQsICp0aGVuKiBzZXR0aW5nIGl0cyBsb2NhdGlvbi5oYXNoLiBJZiBkb2N1bWVudC5kb21haW4gaGFzXG4gICAgICAvLyBiZWVuIHNldCwgdXBkYXRlIHRoYXQgYXMgd2VsbC5cbiAgICAgIGhpc3Rvcnlfc2V0ID0gZnVuY3Rpb24oIGhhc2gsIGhpc3RvcnlfaGFzaCApIHtcbiAgICAgICAgdmFyIGlmcmFtZV9kb2MgPSBpZnJhbWUuZG9jdW1lbnQsXG4gICAgICAgICAgZG9tYWluID0gJC5mblsgc3RyX2hhc2hjaGFuZ2UgXS5kb21haW47XG5cbiAgICAgICAgaWYgKCBoYXNoICE9PSBoaXN0b3J5X2hhc2ggKSB7XG4gICAgICAgICAgLy8gVXBkYXRlIElmcmFtZSB3aXRoIGFueSBpbml0aWFsIGBkb2N1bWVudC50aXRsZWAgdGhhdCBtaWdodCBiZSBzZXQuXG4gICAgICAgICAgaWZyYW1lX2RvYy50aXRsZSA9IGRvYy50aXRsZTtcblxuICAgICAgICAgIC8vIE9wZW5pbmcgdGhlIElmcmFtZSdzIGRvY3VtZW50IGFmdGVyIGl0IGhhcyBiZWVuIGNsb3NlZCBpcyB3aGF0XG4gICAgICAgICAgLy8gYWN0dWFsbHkgYWRkcyBhIGhpc3RvcnkgZW50cnkuXG4gICAgICAgICAgaWZyYW1lX2RvYy5vcGVuKCk7XG5cbiAgICAgICAgICAvLyBTZXQgZG9jdW1lbnQuZG9tYWluIGZvciB0aGUgSWZyYW1lIGRvY3VtZW50IGFzIHdlbGwsIGlmIG5lY2Vzc2FyeS5cbiAgICAgICAgICBkb21haW4gJiYgaWZyYW1lX2RvYy53cml0ZSggJzxzY3JpcHQ+ZG9jdW1lbnQuZG9tYWluPVwiJyArIGRvbWFpbiArICdcIjwvc2NyaXB0PicgKTtcblxuICAgICAgICAgIGlmcmFtZV9kb2MuY2xvc2UoKTtcblxuICAgICAgICAgIC8vIFVwZGF0ZSB0aGUgSWZyYW1lJ3MgaGFzaCwgZm9yIGdyZWF0IGp1c3RpY2UuXG4gICAgICAgICAgaWZyYW1lLmxvY2F0aW9uLmhhc2ggPSBoYXNoO1xuICAgICAgICB9XG4gICAgICB9O1xuXG4gICAgfSkoKTtcbiAgICAvLyBeXl5eXl5eXl5eXl5eXl5eXl5eXl5eXl5eXl5eXl5eXl5eXl5eXl5eXl5eXl5eXl5eXl5eXl5eXl5eXl5eXl5eXl5eXl5eXl5cbiAgICAvLyBeXl5eXl5eXl5eXl5eXl5eXl5eIFJFTU9WRSBJRiBOT1QgU1VQUE9SVElORyBJRTYvNy84IF5eXl5eXl5eXl5eXl5eXl5eXl5cbiAgICAvLyBeXl5eXl5eXl5eXl5eXl5eXl5eXl5eXl5eXl5eXl5eXl5eXl5eXl5eXl5eXl5eXl5eXl5eXl5eXl5eXl5eXl5eXl5eXl5eXl5cblxuICAgIHJldHVybiBzZWxmO1xuICB9KSgpO1xuXG59KShqUXVlcnksdGhpcyk7XG4iXX0=
